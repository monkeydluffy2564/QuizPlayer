<!DOCTYPE html>
<html lang="th"><head>
                <script>
                    console.log("%cSTOP!", "color: red; font-size: 60px; font-weight: bold; text-shadow: 2px 2px black;");
                    console.log("%cProtected Content.", "font-size: 18px; color: gray;");
                </script>
            
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quiz Generator By Kru Amorn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&amp;display=swap" rel="stylesheet">
	
	<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <!-- Libraries for Exporting & Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Libraries for File Reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.18/mammoth.browser.min.js"></script>
	
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- MathJax for rendering math formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
	
	/* ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå A.html ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <style> */
.ai-content h1, .ai-content h2, .ai-content h3, .ai-content h4 { font-weight: 700; color: #1e3a8a; margin-top: 1.5rem; margin-bottom: 0.75rem; }
.ai-content h1 { font-size: 1.8rem; } .ai-content h2 { font-size: 1.5rem; } .ai-content h3 { font-size: 1.25rem; }
.ai-content p { margin-bottom: 1rem; line-height: 1.7; }
.ai-content ul, .ai-content ol { margin-left: 1.5rem; margin-bottom: 1rem; list-style-position: outside; }
.ai-content li { margin-bottom: 0.5rem; }
.ai-content blockquote { background-color: #eff6ff; border-left: 4px solid #3b82f6; padding: 0.75rem 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #1e40af; }
.ai-content table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
.ai-content th, .ai-content td { border: 1px solid #e2e8f0; padding: 0.75rem 1rem; text-align: left; }
.ai-content th { background-color: #fefce8; font-weight: 600; }
.ai-content code { background-color: #f1f5f9; color: #475569; padding: 0.2em 0.4em; border-radius: 3px; }
.ai-content svg { max-width: 100%; height: auto; margin: 1rem auto; display: block; }
.section-header { display: flex; align-items: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #1e3a8a; border-bottom: 2px solid #dbeafe; padding-bottom: 0.5rem; }
.section-header i { margin-right: 0.75rem; color: #3b82f6; }
	
        body {
            font-family: 'Sarabun', sans-serif;
        }
		#message-modal { z-index: 60; } /* <-- ‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ */
		
		.correct {
    background-color: #dcfce7 !important;
    border-color: #22c55e !important;
    color: #166534;
    font-weight: bold;
}

.incorrect {
    background-color: #fee2e2 !important;
    border-color: #ef4444 !important;
    color: #991b1b;
}
		
        .main-tab.active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        .generation-tab.active {
            border-color: #4f46e5;
            color: #4f46e5;
        }
		
		        .view-btn.active {
            background-color: white;
            color: #4f46e5; /* indigo-600 */
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
		
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4f46e5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Presentation Mode Styles */
        .presentation-option {
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        #presentation-modal:fullscreen {
            background-color: #1f2937; /* bg-gray-800 */
        }
        /* Timer Bar */
        #timer-bar-container {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        #timer-bar {
            height: 100%;
            background-color: #4f46e5;
            transition: width 1s linear;
        }
		
		#sync-timer-bar {
        /* * ‡πÄ‡∏û‡∏¥‡πà‡∏° transition 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (500ms) 
         * ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏≠‡∏á onSnapshot (500ms)
         * ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•
         */
        transition: width 0.5s linear;
    }
		
        [contenteditable="true"] {
            outline: 2px dashed #4f46e5;
            background-color: #eef2ff;
            padding: 2px;
        }
        .details-marker {
            transition: transform 0.2s;
        }
        details[open] .details-marker {
            transform: rotate(90deg);
        }
        .badge-icon {
            animation: popIn 0.5s ease-out forwards;
            transform: scale(0);
        }
        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .delete-svg-btn {
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .delete-svg-btn:hover {
            opacity: 1;
        }
        /* Live Game Styles */
        .live-game-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .podium-step {
            transition: transform 0.5s ease-out;
        }
        .podium-step:hover {
            transform: translateY(-10px);
        }
		
		.live-summary-tooltip {
    /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    opacity: 0;
    pointer-events: none; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà */
    transition: opacity 0.2s ease-in-out;
}

.live-summary-tooltip.visible {
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
    opacity: 1;
    pointer-events: auto;
}

.pen-color-btn {
    box-shadow: 0 0 0 2px white; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
}
.pen-color-btn.active {
    border-color: #3b82f6; /* border-blue-500 */
    box-shadow: 0 0 0 2px #3b82f6;
}

.tool-btn.active {
    background-color: #3b82f6; /* bg-blue-500 */
    color: white;
    border-color: #1d4ed8; /* border-blue-700 */
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-controls ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
#scratchpad-controls {
    display: flex;
    flex-wrap: wrap; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    align-items: center;
    gap: 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
    background-color: #f3f4f6; /* bg-gray-100 */
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
    z-index: 30;
}

/* ‚ñº‚ñº‚ñº ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á ‚ñº‚ñº‚ñº */
.tool-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.separator {
    width: 1px;
    height: 1.5rem; /* 24px */
    background-color: #d1d5db; /* bg-gray-300 */
    margin: 0 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤ */
}
/* ‚ñ≤‚ñ≤‚ñ≤ ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ‚ñ≤‚ñ≤‚ñ≤ */


/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î .scratchpad-content-wrapper ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
.scratchpad-content-wrapper {
    position: relative;
    overflow: hidden;
    flex-grow: 1; /* ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-canvas ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
#scratchpad-canvas {
    position: absolute;
    inset: 0;
    z-index: 10;
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-header ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ (‡∏•‡∏ö padding-right ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏Å‡πâ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ) ‚ñº‚ñº‚ñº */
#scratchpad-header {
    position: relative;
    z-index: 20;
    pointer-events: none;
    
}
		
		/* --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô <style> --- */

#dim-overlay {
    position: fixed; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
    inset: 0; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (top:0, right:0, bottom:0, left:0) */
    background-color: rgba(0, 0, 0, 1); /* ‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á 100% */
    z-index: 9998; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
    display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠ body ‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™ .dimmed ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ overlay ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
body.dimmed #dim-overlay {
    display: flex;
}

.pen-size-btn.active {
    background-color: #3b82f6; /* bg-blue-500 */
    color: white;
    border-color: #1d4ed8; /* border-blue-700 */
}

.confidence-choice-btn {
    background-color: #f3f4f6; /* bg-gray-100 */
    color: #4b5563; /* text-gray-600 */
    border: 1px solid #d1d5db; /* border-gray-300 */
    transition: all 0.2s;
}
.confidence-choice-btn.active.confident {
    background-color: #10b981; /* bg-emerald-500 */
    color: white;
    border-color: #059669; /* border-emerald-700 */
}
.confidence-choice-btn.active.not-confident {
    background-color: #6b7280; /* bg-gray-500 */
    color: white;
    border-color: #4b5563; /* border-gray-600 */
}
		
    </style>
<style>
                /* Security Mask */
                #admin-view, #admin-password-modal, #create-project-modal, #quiz-settings-modal, #quiz-editor-modal, #blueprint-projects-modal, #blueprint-settings-modal, #manual-blueprint-modal, #file-shortcut-editor-modal, #shortcut-editor-modal, #quiz-bank-modal, #topic-quiz-bank-modal, #global-activity-modal, #lesson-plan-modal, #comparison-modal, #export-pdf-modal, #lesson-view-modal, #quiz-status-modal, #rename-quiz-modal, #move-quiz-modal, #bulk-quiz-settings-modal, #mode-switcher-btn, #view-switcher, #save-project-name-btn, #open-global-live-btn, #update-old-quizzes-btn, #create-project-btn, #project-search-input, #project-sort-select, #admin-login-btn, #back-to-admin-btn {
                    display: none !important;
                    visibility: hidden !important;
                    pointer-events: none !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    z-index: -9999 !important;
                    width: 0 !important; height: 0 !important;
                    overflow: hidden !important;
                }
                .admin-only-btn, .teacher-control { display: none !important; }
                #student-view { display: block !important; }
            </style></head>

<body class="bg-gray-100 text-gray-800">

<div id="dim-overlay">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠</div>

    <div class="container mx-auto p-4 md:p-8 max-w-6xl relative">
        <!-- Admin Mode Toggle Button -->
        <button id="mode-switcher-btn" class="absolute top-4 right-4 text-gray-500 hover:text-indigo-600 transition-colors duration-300 z-10 p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" title="‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°">
            <i class="fas fa-user-shield fa-lg"></i>
        </button>

        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600">
                <i class="fas fa-brain mr-2"></i>AI Quiz Generator
            </h1>
            <p class="text-lg text-gray-600 mt-1">By Kru Amorn</p>
            <p class="text-gray-500 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="bg-white p-6 rounded-2xl shadow-lg min-h-[400px]">
            <!-- Admin View -->
            <div id="admin-view" class="hidden fade-in">
                <!-- Project Dashboard (Default Admin View) -->
                <div id="project-dashboard-view">
                    <!-- NEW: Starred Quizzes Section -->
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                        <h2 class="text-2xl font-bold text-indigo-700">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                         <div class="flex items-center gap-2 w-full md:w-auto flex-wrap md:justify-end">
						 
						         <div id="view-switcher" class="flex items-center p-1 bg-gray-100 rounded-lg mr-2">
            <button id="grid-view-btn" class="px-3 py-1 rounded-md text-gray-700 view-btn" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á">
                <i class="fas fa-th-large pointer-events-none"></i>
            </button>
            <button id="list-view-btn" class="px-3 py-1 rounded-md text-gray-500 view-btn" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                <i class="fas fa-list pointer-events-none"></i>
            </button>
        </div>
						 
                           <input type="text" id="project-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ..." class="w-full md:w-auto p-2 border border-gray-300 rounded-lg">
                           <select id="project-sort-select" class="p-2 border border-gray-300 rounded-lg">
                               <option value="date_desc">‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                               <option value="date_asc">‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
                               <option value="name_asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                               <option value="name_desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                           </select>
                           <button id="reset-project-order-btn" class="text-sm text-gray-500 hover:underline" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏•‡∏≥‡∏î‡∏±‡∏ö</button>
                           <button id="create-project-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-300 flex items-center shrink-0">
                               <i class="fas fa-plus-circle mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á
                           </button>
						   <button id="open-global-live-btn" class="bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-bolt mr-2"></i>Live Game
</button>
<button id="open-quiz-bank-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-book mr-2"></i>‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
</button>

<button id="open-blueprint-projects-btn" class="bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-all duration-300 flex items-center shrink-0">
    <i class="fas fa-sitemap mr-2"></i>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint
</button>

<button id="update-old-quizzes-btn" class="bg-yellow-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-yellow-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-wrench mr-2"></i>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
</button>

                        </div>
                    </div>
                    <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                        <!-- Project cards will be inserted here -->
                        <p id="no-projects-msg" class="text-gray-500 col-span-full text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ... ‡∏Ñ‡∏•‡∏¥‡∏Å '‡∏™‡∏£‡πâ‡∏≤‡∏á' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                    </div>
                </div>

                <!-- Project Detail View -->
                <div id="project-detail-view" class="hidden">
                    <button id="back-to-dashboard-btn" class="mb-4 text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
                    <div class="flex items-center gap-3 mb-2">
    <h2 id="project-title" contenteditable="true" class="text-3xl font-bold text-indigo-700 outline-none focus:ring-2 focus:ring-indigo-300 focus:bg-indigo-50 rounded-md px-2 py-1 transition-all" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠">
    </h2>
    <button id="save-project-name-btn" class="hidden bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition-all text-sm">
        <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    </button>
</div>
                    <p class="text-sm text-gray-500 mb-6">Project ID: <span id="project-id-display" class="font-mono"></span></p>
                    
                    <!-- Project Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-6">
                            <button id="manage-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                                <i class="fas fa-sliders-h mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            </button>
                            <button id="results-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-poll mr-2"></i>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                            </button>
                            <button id="leaderboard-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-trophy mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥
                            </button>
                        </nav>
                    </div>

                    <!-- Manage Tab Content -->
                    <div id="manage-tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Left Column: Settings & Students -->
                            <div class="space-y-6">
                                <!-- Quiz Settings -->
                                <div>
                                    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)</h3>
<div class="space-y-4 p-4 bg-gray-50 rounded-lg">
    <div>
        <label for="quiz-type-select" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
        <select id="quiz-type-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <optgroup label="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">
                <option value="multiple_choice">‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö (‡∏Å, ‡∏Ç, ‡∏Ñ, ‡∏á)</option>
                <option value="matching">‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠)</option>
                <option value="true_false">‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î</option>
            </optgroup>
            <optgroup label="‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥">
                <option value="fill_in_with_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ)</option>
                <option value="fill_in_no_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)</option>
                <option value="mixed">‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥)</option>
            </optgroup>
        </select>
    </div>

    <div>
        <label for="difficulty-level-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</label>
        <select id="difficulty-level-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="auto" selected="">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)</option>
            
            <optgroup label="üßí ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢">
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1 (K1)</option>
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2 (K2)</option>
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3 (K3)</option>
            </optgroup>

            <optgroup label="üìó ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (‡∏õ.1)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏õ.2)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3 (‡∏õ.3)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4 (‡∏õ.4)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5 (‡∏õ.5)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6 (‡∏õ.6)</option>
            </optgroup>
            
            <optgroup label="üìò ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (‡∏°.1)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏°.2)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3 (‡∏°.3)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4 (‡∏°.4)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5 (‡∏°.5)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6 (‡∏°.6)</option>
            </optgroup>

            <optgroup label="üéì ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó</option>
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</option>
            </optgroup>
        </select>
    </div>

    <div>
        <label for="question-complexity-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Bloom's Taxonomy):</label>
        <select id="question-complexity-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="mixed" selected="">‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏∞ (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</option>
            <option value="remembering">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≥ (Remembering)</option>
            <option value="understanding">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à (Understanding)</option>
            <option value="applying">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ (Applying)</option>
            <option value="analyzing">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Analyzing)</option>
            <option value="evaluating">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤ (Evaluating)</option>
            <option value="creating">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå (Creating)</option>
        </select>
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠):</label>
        <details class="mt-1 border border-gray-300 rounded-lg bg-white">
            <summary class="p-2 cursor-pointer text-gray-500">
                ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠... <span id="selected-topics-count" class="font-bold text-indigo-600"></span>
            </summary>
            
            <div class="sticky top-0 bg-white p-2 border-b border-gray-200 flex justify-between items-center gap-4">
                <input type="text" id="math-topic-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠..." class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                <div class="flex items-center gap-3 shrink-0">
                    <button id="select-all-topics-btn" class="text-xs font-semibold text-blue-600 hover:underline">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button id="deselect-all-topics-btn" class="text-xs font-semibold text-gray-500 hover:underline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>
            <div id="math-topics-checkbox-container" class="p-3 max-h-60 overflow-y-auto">
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</p>
            </div>
        </details>
    </div>

    <div class="mt-3 p-3 bg-gray-100 rounded-lg">
        <label for="custom-math-topic-input" class="block text-sm font-medium text-gray-700 mb-1">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á:
        </label>
        <div class="flex items-center gap-2">
            <input type="text" id="custom-math-topic-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏ö‡∏ó‡πÄ‡∏®‡∏©‡πÄ‡∏´‡∏•‡∏∑‡∏≠..." class="w-full p-2 border border-gray-300 rounded-lg text-sm">
            <button id="add-custom-math-topic-btn" class="bg-blue-600 text-white py-2 px-3 rounded-lg font-semibold hover:bg-blue-700 text-sm shrink-0">
                <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
            </button>
        </div>
    </div>								

    <div class="grid grid-cols-2 gap-4">
        <div>
            <label for="num-questions" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠:</label>
            <input type="number" id="num-questions" value="5" min="1" max="20" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label for="passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
            <input type="number" id="passing-score-input" value="3" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
    </div>
    <div id="num-choices-container">
        <label for="num-choices" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <input type="number" id="num-choices" value="4" min="2" max="6" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
    </div>
    <div>
        <label for="shuffle-setting-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <select id="shuffle-setting-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
            <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
            <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
        </select>
    </div>
    <div>
        <label for="results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
            <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
            <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
            <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>
            <optgroup label="‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÉ‡∏´‡∏°‡πà)">
                <option value="half_mark_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á/‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á</option>
                <option value="perfect_score_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°/‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</option>
            </optgroup>
        </select>
    </div>
    <div class="flex items-center mt-2">
        <input id="adaptive-quiz-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="adaptive-quiz-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
        </label>
    </div>
    
    <div class="flex items-center mt-2">
        <input id="loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
        </label>
    </div>

    <div class="flex items-center mt-2">
        <input id="force-math-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="force-math-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå)
        </label>
    </div>
    <div class="flex items-center mt-2">
        <input id="include-images-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="include-images-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï, ‡∏Å‡∏£‡∏≤‡∏ü, ‡∏Ø‡∏•‡∏Ø)
        </label>
    </div>
    <div class="p-3 border-t border-gray-200 mt-2 space-y-2 bg-indigo-50 rounded-lg">
        <div class="flex items-center">
            <input id="confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
            </label>
        </div>
        <div id="confidence-mode-container" class="hidden pl-6">
            <label for="confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
            <select id="confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
            </select>
        </div>
    </div>
    <div class="border-t pt-4 mt-2">
        <label for="timer-mode-select" class="block text-sm font-medium text-gray-700">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤:</label>
        <select id="timer-mode-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</option>
            <option value="whole_quiz">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ)</option>
            <option value="per_question">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</option>
        </select>
        <div id="timer-duration-container" class="mt-2 hidden">
            <label for="timer-duration-input" id="timer-duration-label" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
            <input type="number" id="timer-duration-input" value="10" min="1" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
    </div>
    <button id="save-settings-btn" class="w-full bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-colors text-sm">
        <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    </button>
</div>
                                </div>
								
								       <div id="project-visibility-settings">
    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</h3>
    <div class="p-4 bg-gray-50 rounded-lg">
        <div class="flex items-center">
            <input id="show-in-student-dashboard-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="show-in-student-dashboard-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
                ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" ‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </label>
        </div>
        <p class="text-xs text-gray-500 mt-2">
            ‡∏´‡∏≤‡∏Å‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥)
        </p>

        <div class="mt-4 pt-4 border-t">
            <div class="flex items-center mb-2">
                <input id="enable-passcode-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                <label for="enable-passcode-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
                    ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ
                </label>
            </div>
            <div id="passcode-input-container" class="hidden">
                <label for="project-passcode-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (4-8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</label>
                <input type="text" id="project-passcode-input" class="w-full p-2 border border-gray-300 rounded-lg" maxlength="8">
            </div>
            <p class="text-xs text-red-500 mt-1">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
        </div>
        <button id="save-visibility-settings-btn" class="mt-4 w-full bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-colors text-sm">
            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        </button>
    </div>
</div>
								
                                <!-- Student Management -->
                                <div>
								
                                    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex flex-col gap-2 mb-3">
                                            <label for="student-name-input" class="text-sm font-medium text-gray-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î):</label>
                                            <textarea id="student-name-input" rows="3" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ
‡∏™‡∏°‡∏®‡∏£‡∏µ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç"></textarea>
                                            <button id="add-student-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 self-end"><i class="fas fa-user-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
                                        </div>
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-semibold text-sm">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</h4>
                                            <button id="delete-all-students-btn" class="text-red-600 hover:text-red-800 text-xs font-semibold py-1 px-2 rounded-md bg-red-100 hover:bg-red-200 transition-colors hidden"><i class="fas fa-trash-alt mr-1"></i>‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                        </div>
                                        <div id="student-list" class="max-h-40 overflow-y-auto space-y-1 text-sm p-2 bg-white border rounded-md">
                                            <!-- Student names will be here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column: Quiz Generation -->
                            <div>
                                <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h3>
                                <div id="quiz-generation-container" class="p-4 bg-gray-50 rounded-lg">
                                    <!-- Generation Tabs -->
                                    <div class="flex border-b mb-4 flex-wrap">
                                        <button id="topic-tab" class="generation-tab py-2 px-4 font-semibold active"><i class="fas fa-lightbulb mr-2"></i>‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
                                        <button id="text-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-file-alt mr-2"></i>‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
                                        <button id="file-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-file-upload mr-2"></i>‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
                                        <button id="link-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-link mr-2"></i>‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
										<button id="blueprint-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-map-marked-alt mr-2"></i>‡∏à‡∏≤‡∏Å Test Blueprint</button>
										<button id="parallel-test-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-clone mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡∏ô‡∏≤‡∏ô</button>
                                        <button id="worksheet-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-print mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</button>
                                    </div>

<div id="blueprint-input-area" class="hidden space-y-4">

    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î (Blueprint Shortcuts):</label>
    <div id="blueprint-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <p id="shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
        <label for="blueprint-upload-input" class="text-sm text-gray-600 font-semibold hover:underline cursor-pointer">
            <i class="fas fa-upload mr-1"></i>‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
        </label>
        <input type="file" id="blueprint-upload-input" class="hidden" accept=".pdf">
    </div>
    <div id="blueprint-options-container" class="hidden mt-4 pt-4 border-t border-gray-200 space-y-3">
        <button id="save-blueprint-as-project-btn" class="hidden w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 mb-4 items-center justify-center">
            <i class="fas fa-save mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô Project
        </button>
        <div class="flex items-center p-3 bg-indigo-50 rounded-lg">
            <input id="separate-by-content-checkbox" type="checkbox" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="separate-by-content-checkbox" class="ml-3 block font-medium text-gray-800">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏ß‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
            </label>
        </div>
        <div id="blueprint-topics-list-container" class="hidden p-3 border rounded-md bg-white">
            <p class="text-sm font-semibold mb-2 text-gray-700">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
            <div id="blueprint-topics-list" class="space-y-2">
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠...</p>
            </div>
            <p class="text-xs text-gray-500 mt-3">*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≤‡∏Å Blueprint</p>
        </div>
    </div>

    <div class="mt-4 pt-4 border-t">
        <label for="reference-pdf-upload" class="block text-sm font-medium text-gray-700">
            (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°) ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (.pdf, .txt):
        </label>
        <input type="file" id="reference-pdf-upload" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100" accept=".pdf,.txt">
        <p class="text-xs text-gray-500 mt-1">
            AI ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏°‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        </p>
    </div>

    <button id="generate-from-blueprint-btn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏° Blueprint (‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)
    </button>
</div>

<div id="parallel-test-input-area" class="hidden space-y-4">
<div class="mt-4 pt-4 border-t">
    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Source Shortcuts):</label>
    <div id="parallel-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2">
        <p id="parallel-shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-parallel-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>
</div>
    <label for="parallel-test-upload-input" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (.pdf, .txt):</label>
    <input type="file" id="parallel-test-upload-input" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" accept=".pdf,.txt">
    <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∏‡∏î</p>

    <button id="generate-from-parallel-test-btn" class="w-full bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡∏ô‡∏≤‡∏ô
    </button>
</div>
                                    <!-- Topic Input -->
                                    <div id="topic-input-area" class="space-y-4">
                                        <input type="text" id="topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏ö‡∏ó‡∏û‡∏µ‡∏ó‡∏≤‡πÇ‡∏Å‡∏£‡∏±‡∏™">
                                        <button id="generate-from-topic-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center"><i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                                    </div>
                                    <!-- Text Input -->
                                    <div id="text-input-area" class="hidden space-y-4">
    <div class="flex justify-end gap-2 flex-wrap">
        <input type="file" id="camera-input" class="hidden" accept="image/*" capture="environment">
        
        <button id="camera-crop-btn" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 text-sm flex items-center gap-2 transition-all shadow-sm">
            <i class="fas fa-camera"></i> ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û &amp; ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (Crop)
        </button>

        <input type="file" id="scan-text-image-input" class="hidden" accept="image/*">
        <button id="scan-text-image-btn" class="bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 text-sm flex items-center gap-2 transition-all shadow-sm">
            <i class="fas fa-file-image"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢)
        </button>
    </div>

    <textarea id="text-content-input" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="‡∏ß‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô..."></textarea>
    
    <button id="generate-from-text-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center shadow-md transition-transform hover:scale-[1.01]">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    </button>
</div>
                                    <!-- File Input -->
                                    <div id="file-input-area" class="hidden space-y-4">
									<div class="mt-4 pt-4 border-t">
    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå (File Shortcuts):</label>
    <div id="file-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2">
        <p id="file-shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-file-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>
</div>
    <label for="file-upload-input" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF, Word (.docx), ‡∏´‡∏£‡∏∑‡∏≠ Text (.txt):</label>
    <input type="file" id="file-upload-input" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" accept=".pdf,.docx,.txt">
	
	<div id="pdf-page-selector" class="hidden mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
    <label class="block text-sm font-medium text-blue-800 mb-1">
        <i class="fas fa-print mr-1"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤ PDF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ = ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):
    </label>
    <input type="text" id="pdf-page-range" class="w-full p-2 border border-blue-300 rounded text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1, 3-5, 8 (‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤)">
    <p class="text-xs text-blue-600 mt-1">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
</div>
	
	<div class="flex items-center my-3 p-3 bg-indigo-50 rounded-lg">
    <input id="separate-by-content-from-file-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
    <label for="separate-by-content-from-file-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏ß‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
        <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</p>
    </label>
</div>

<div id="file-topics-list-container" class="hidden p-3 mt-4 border rounded-md bg-white">
    <p class="text-sm font-semibold mb-2 text-gray-700">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
    <div id="file-topics-list" class="space-y-2">
        <p class="text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
    </div>
</div>
	
	    <div class="flex items-center my-3 p-3 bg-indigo-50 rounded-lg">
        <input id="original-mode-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="original-mode-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Original Mode)
            <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        </label>
    </div>
	
    <input type="text" id="file-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)...">
    <p class="text-xs text-gray-500">‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</p>

    <button id="generate-from-file-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    </button>
</div>

<div id="file-shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="file-shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</h3>
        <div class="space-y-4">
            <div>
                <label for="file-shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="file-shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ .pdf">
            </div>
            <div>
                <label for="file-shortcut-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå (.pdf, .txt ‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="file-shortcut-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="file-shortcut-id-input">
            <button id="cancel-file-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-file-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-file-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-file-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="file-shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-file-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>

    <div id="additional-file-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

<div id="parallel-shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="parallel-shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</h3>
        <div class="space-y-4">
            <div>
                <label for="parallel-shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="parallel-shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô O-NET ‡∏õ.6 ‡∏õ‡∏µ 65">
            </div>
            <div>
                <label for="parallel-shortcut-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (.pdf, .txt ‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="parallel-shortcut-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="parallel-shortcut-id-input">
            <button id="cancel-parallel-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-parallel-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-parallel-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-parallel-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="parallel-shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-parallel-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>

    <div id="additional-parallel-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

                                    <!-- Link Input -->
                                    <div id="link-input-area" class="hidden space-y-4">
                                        <input type="url" id="link-url-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
                                        <input type="text" id="link-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)...">
                                        <button id="generate-from-link-btn" class="w-full bg-cyan-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-cyan-700 flex items-center justify-center">
                                            <i class="fas fa-cogs mr-2"></i>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                                        </button>
                                    </div>
                                    <!-- Worksheet Input -->
                                    <div id="worksheet-input-area" class="hidden space-y-4">
                                        <input type="text" id="worksheet-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å">
                                        <button id="generate-worksheet-btn" class="w-full bg-emerald-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-emerald-700 flex items-center justify-center"><i class="fas fa-file-alt mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå</button>
                                    </div>
                                </div>
                                <!-- Generation Result Area -->
                                <div id="quiz-generation-area" class="mt-6 hidden">
                                    <div id="loader" class="flex flex-col items-center justify-center hidden">
                                        <div class="loader"></div>
                                        <p id="loader-text" class="mt-3 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...</p>
                                    </div>
                                    <div id="generated-quiz-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Tab Content -->
                    <div id="results-tab-content" class="hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ</h3>
                             <input type="text" id="quiz-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö..." class="w-full md:w-auto p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div id="project-quizzes-list" class="space-y-3">
                            <p class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</p>
                        </div>
                    </div>

                    <!-- Leaderboard Tab Content -->
                    <div id="leaderboard-tab-content" class="hidden">
                        <h3 class="text-xl font-semibold mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-2 px-4 border-b text-center w-16">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                        <th class="py-2 px-4 border-b text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (Points)</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboard-table-body">
                                    <!-- Leaderboard rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Quiz Detail/Results View -->
                <div id="quiz-results-view" class="hidden">
<div class="flex items-center gap-4 mb-4">
        <button id="back-to-project-btn" class="text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</button>

        <!-- --- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ --- -->
        <button id="back-to-dashboard-from-results-btn" class="text-gray-500 hover:underline text-sm"><i class="fas fa-th-large mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
    </div>

    <h2 id="results-quiz-title" class="text-3xl font-bold text-indigo-700 mb-2"></h2>
    <p class="text-sm text-gray-500 mb-4">Quiz ID: <span id="results-quiz-id-display" class="font-mono"></span></p>

                    

                       <!-- Quiz Detail Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-6">
                            <button id="analytics-tab-btn" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                                <i class="fas fa-chart-line mr-2"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•
                            </button>
                            <button id="scores-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-users mr-2"></i>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                            <!-- NEW: Quiz Leaderboard Tab Button -->
                            <button id="leaderboard-quiz-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-trophy mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥
                            </button>
							
							        <button id="behavior-log-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
            <i class="fas fa-user-clock mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°
        </button>
							
                        </nav>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="analytics-tab-content">
                        <!-- Summary Cards -->
                        <div id="analytics-summary-cards" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <!-- Cards will be injected here -->
                        </div>
                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</h4>
                                <canvas id="submission-status-chart"></canvas>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2 text-center">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>
                                <canvas id="score-distribution-chart"></canvas>
                            </div>
                        </div>

                        <!-- NEW: AI Strength/Weakness Analysis Section -->
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold mb-3 border-b pb-2">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h3>
                            <div class="flex justify-center">
                                <button id="analyze-strengths-btn" class="bg-indigo-600 text-white py-2 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-300 flex items-center gap-2">
                                    <i class="fas fa-magic"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á-‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
                                </button>
                            </div>
                            <div id="strength-weakness-analysis-container" class="mt-4">
                                <!-- Analysis results will be displayed here -->
                            </div>
                        </div>

                        <!-- Per-Question Analysis -->
                        <div class="mt-8">
                             <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠</h3>
                             <div id="question-analytics-container" class="space-y-4">
                                 <!-- Accordions will be injected here -->
                             </div>
                        </div>
                    </div>

                    <!-- Scores Tab -->
                    <div id="scores-tab-content" class="hidden">
                        <!-- Export Buttons -->
                        <div class="mb-4 flex flex-wrap gap-2">
                            <span class="self-center font-semibold mr-2">Export ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</span>
                            <button id="export-image-btn" class="bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700 text-sm flex items-center gap-2"><i class="fas fa-file-image"></i>Image</button>
                            <button id="export-pdf-btn" class="bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700 text-sm flex items-center gap-2"><i class="fas fa-file-pdf"></i>PDF</button>
                            <button id="export-word-btn" class="bg-blue-600 text-white py-1 px-3 rounded-md hover:bg-blue-700 text-sm flex items-center gap-2"><i class="fas fa-file-word"></i>Word</button>
                            <button id="export-excel-btn" class="bg-green-600 text-white py-1 px-3 rounded-md hover:bg-green-700 text-sm flex items-center gap-2"><i class="fas fa-file-excel"></i>Excel</button>
                        </div>
						
						                        <h3 class="text-xl font-semibold mb-2 mt-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
                        <p class="text-sm text-gray-500 mb-2">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                        <div id="answer-grid-container" class="overflow-x-auto mb-8 border border-gray-200 rounded-lg">
                            </div>
						
                        <div class="overflow-x-auto" id="results-table-container">
                            <table class="min-w-full bg-white border border-gray-200" id="results-table">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏ú‡∏•</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                        <th class="py-2 px-4 border-b text-left">Points</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="py-2 px-4 border-b text-left">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                    </tr>
                                </thead>
                                <tbody id="quiz-results-table-body">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- NEW: Quiz Leaderboard Tab Content -->
                    <div id="leaderboard-quiz-tab-content" class="hidden">
    <h3 class="text-xl font-semibold mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ)</h3>

    <div class="mb-4 flex flex-wrap gap-2">
        <span class="self-center font-semibold mr-2">Export ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</span>
        <button id="export-leaderboard-image-btn" class="bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700 text-sm flex items-center gap-2"><i class="fas fa-file-image"></i>Image</button>
        <button id="export-leaderboard-pdf-btn" class="bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700 text-sm flex items-center gap-2"><i class="fas fa-file-pdf"></i>PDF</button>
        <button id="export-leaderboard-word-btn" class="bg-blue-600 text-white py-1 px-3 rounded-md hover:bg-blue-700 text-sm flex items-center gap-2"><i class="fas fa-file-word"></i>Word</button>
        <button id="export-leaderboard-excel-btn" class="bg-green-600 text-white py-1 px-3 rounded-md hover:bg-green-700 text-sm flex items-center gap-2"><i class="fas fa-file-excel"></i>Excel</button>
    </div>
    <div class="overflow-x-auto" id="quiz-leaderboard-table-container">
        <table class="min-w-full bg-white border border-gray-200" id="quiz-leaderboard-table">
            <thead class="bg-gray-100">
                <tr>
                    <th class="py-2 px-4 border-b text-center w-16">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                    <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                    <th class="py-2 px-4 border-b text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</th>
                    <th class="py-2 px-4 border-b text-center">‡∏ú‡∏•</th>
                    <th class="py-2 px-4 border-b text-center">Points (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</th>
                    <th class="py-2 px-4 border-b text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th>
                    <th class="py-2 px-4 border-b text-left">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                    <th class="py-2 px-4 border-b text-left">‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
                </tr>
            </thead>
            <tbody id="quiz-leaderboard-table-body">
                </tbody>
        </table>
    </div>
</div>

<div id="behavior-log-tab-content" class="hidden">
    <h3 class="text-xl font-semibold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
    <div id="behavior-log-container" class="space-y-4">
        </div>
</div>

                </div>
				
<div id="blueprint-project-manager-view" class="hidden fade-in">
    <button id="back-to-dashboard-from-bp-btn" class="mb-4 text-indigo-600 hover:underline">
        <i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard
    </button>

    <div class="flex justify-between items-center mb-4">
        <h2 id="bp-project-title" class="text-3xl font-bold text-teal-700"></h2>
        <button id="bp-quiz-settings-btn" class="bg-orange-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-orange-600 flex items-center gap-2">
            <i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        </button>
    </div>

<div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
    <label for="bp-reference-file-url" class="block text-sm font-medium text-yellow-800 mb-1">
        <i class="fas fa-link mr-1"></i> ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö O-NET ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô):
    </label>
    <div class="flex items-center gap-2">
        <input type="url" id="bp-reference-file-url" class="w-full p-2 border border-yellow-300 rounded-lg text-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå .pdf ‡∏´‡∏£‡∏∑‡∏≠ .txt ‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
        <button id="save-bp-reference-btn" class="bg-yellow-600 text-white py-2 px-3 rounded-lg font-semibold hover:bg-yellow-700 text-sm shrink-0">
            <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </button>
    </div>
    <p class="text-xs text-yellow-700 mt-1">
        AI ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå O-NET ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
    </p>
</div>

    <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</h3>
        
        <div id="bp-topic-list-container" class="space-y-2">
            </div>
        
        <div class="mt-4 pt-4 border-t">
            <button id="bp-add-topic-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 text-sm">
                <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>
</div>
				
            </div>

            <!-- Student View -->
            <div id="student-view" class="fade-in">
                <div id="student-initial-view">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-700 text-center">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
                    <div id="student-entry-area" class="space-y-4 max-w-md mx-auto">
                        <div>
                            <label for="quiz-id-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
                            <input type="text" id="quiz-id-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°">
                        </div>
                        <button id="load-quiz-btn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center">
                            <i class="fas fa-search mr-2"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                        </button>
                        <div class="relative flex py-3 items-center">
                            <div class="flex-grow border-t border-gray-300"></div>
                            <span class="flex-shrink mx-4 text-gray-500">‡∏´‡∏£‡∏∑‡∏≠</span>
                            <div class="flex-grow border-t border-gray-300"></div>
                        </div>
						
						<button id="view-my-progress-btn" class="w-full bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 flex items-center justify-center">
    <i class="fas fa-chart-line mr-2"></i>‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
</button>
						
                        <button id="join-live-game-btn" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-700 flex items-center justify-center">
                            <i class="fas fa-flag-checkered mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°‡∏™‡∏î
                        </button>
						<button id="join-group-activity-btn" class="w-full bg-cyan-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-cyan-700 flex items-center justify-center">
    <i class="fas fa-broadcast-tower mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Live)
</button>
                    </div>
                </div>

                <!-- NEW: Student Join Live Game View -->
                <div id="student-join-game-view" class="hidden max-w-md mx-auto">
                     <h2 class="text-2xl font-bold mb-4 text-indigo-700 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°‡∏™‡∏î</h2>
                     <div class="space-y-4">
                         <div>
                             <label for="game-pin-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (Game PIN):</label>
                             <input type="number" id="game-pin-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (2 ‡∏´‡∏•‡∏±‡∏Å)" maxlength="2">
                         </div>
                         <div>
                             <label for="nickname-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô:</label>
                             <input type="text" id="nickname-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                         </div>
                         <button id="confirm-join-game-btn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
                             <i class="fas fa-sign-in-alt mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                         </button>
                         <button id="back-to-student-initial-btn" class="w-full mt-2 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">
                             ‡∏Å‡∏•‡∏±‡∏ö
                         </button>
                     </div>
                </div>
                
                <div id="student-name-selection-view" class="hidden max-w-md mx-auto">
                    <h2 id="student-quiz-topic" class="text-2xl font-bold mb-4 text-indigo-700 text-center"></h2>
                    <label for="student-name-select" class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
                    <select id="student-name-select" class="w-full p-3 border border-gray-300 rounded-lg"></select>
                    <button id="start-quiz-btn" class="w-full mt-4 bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
                        <i class="fas fa-play-circle mr-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    </button>
                </div>
				
				<div id="student-team-selection-view" class="hidden max-w-md mx-auto">
    <h2 id="team-quiz-topic" class="text-2xl font-bold mb-4 text-cyan-700 text-center"></h2>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ:</label>
    <div id="team-student-list" class="space-y-2 p-3 border rounded-lg max-h-60 overflow-y-auto bg-gray-50">
        </div>
    <div class="flex gap-2 mt-4">
        <button id="cancel-team-selection-btn" class="w-1/3 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
        <button id="confirm-team-players-btn" class="w-2/3 bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
            <i class="fas fa-play-circle mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°
        </button>
    </div>
</div>
				
				<div id="student-progress-view" class="hidden max-w-4xl mx-auto">
    <button id="back-to-student-home-btn" class="mb-4 text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <h2 class="text-2xl font-bold mb-4 text-teal-700 text-center">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>

    <div class="flex flex-col md:flex-row gap-4 mb-6 p-4 bg-gray-100 rounded-lg">
        <div class="flex-1">
            <label for="progress-project-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <select id="progress-project-select" class="w-full p-2 border border-gray-300 rounded-lg"></select>
        </div>
        <div class="flex-1">
            <label for="progress-student-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
            <select id="progress-student-select" class="w-full p-2 border border-gray-300 rounded-lg" disabled=""></select>
        </div>
    </div>

    <div id="student-progress-content">
        <p class="text-center text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    </div>
</div>
				
                <div id="student-quiz-area" class="mt-6 hidden"></div>
                <div id="student-result-area" class="mt-6 hidden"></div>
                <div id="student-reading-area" class="mt-6 hidden"></div>
            </div>

            <!-- NEW: Live Game View (Covers the whole main content area) -->
            <div id="live-game-view" class="hidden fade-in">
                <!-- Content will be injected by JS -->
            </div>

        </main>
        
        <div id="user-info" class="text-center mt-6 text-xs text-gray-400">
            User ID: <span id="user-id-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="modal-message" class="text-lg mb-4"></p>
            <button id="modal-close-btn" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>
	
	<div id="export-pdf-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
        <h3 class="text-xl font-bold mb-6 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£ Export PDF</h3>
        <div class="space-y-4">
            <button id="export-compact-pdf-btn" class="w-full flex items-center justify-center gap-3 bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all">
                <i class="fas fa-columns fa-lg"></i>
                <div>
                    <p>‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö (2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)</p>
                    <p class="text-xs font-normal">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏à‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</p>
                </div>
            </button>
            <button id="export-tutor-pdf-btn" class="w-full flex items-center justify-center gap-3 bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-all">
                <i class="fas fa-chalkboard-teacher fa-lg"></i>
                <div>
                    <p>‡πÅ‡∏ö‡∏ö‡∏ï‡∏¥‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏Ç‡πâ‡∏≠‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤)</p>
                    <p class="text-xs font-normal">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏ô, ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                </div>
            </button>
        </div>
        <div class="flex justify-end mt-8">
            <button id="cancel-export-pdf-btn" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>
	
	<div id="comparison-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-5xl w-full h-[90vh] flex flex-col">
        <div class="flex justify-between items-center mb-2">
            <h3 id="comparison-title" class="text-2xl font-bold text-indigo-700">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h3>
            <button id="close-comparison-modal-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
        </div>

        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-6">
                <button id="comparison-overall-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                    <i class="fas fa-chart-pie mr-2"></i>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                </button>
                <button id="comparison-individual-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                    <i class="fas fa-user-friends mr-2"></i>‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </button>
            </nav>
        </div>
        
        <div class="flex-grow overflow-y-auto pt-4 bg-gray-50 p-2 md:p-6">
            <div id="comparison-overall-content">
                </div>
            <div id="comparison-individual-content" class="hidden">
                </div>
        </div>

        <div class="mt-4 pt-4 border-t flex justify-end">
            <button id="close-comparison-modal-footer-btn" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

<div id="lesson-view-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 p-4 flex items-center justify-center">
    <div class="bg-white w-full max-w-5xl h-[95vh] rounded-lg shadow-xl flex flex-col">
 <div class="flex justify-between items-center p-4 border-b">
    <h3 id="lesson-view-title" class="text-2xl font-bold text-indigo-700"></h3>
    <div class="flex items-center gap-4">
        <button id="fix-lesson-latex-btn" class="bg-yellow-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-yellow-600 transition-colors text-sm flex items-center gap-2">
            <i class="fas fa-magic-wand-sparkles"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£
        </button>
        <button id="export-lesson-to-pdf-btn" class="bg-red-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-red-700 transition-colors text-sm flex items-center gap-2">
            <i class="fas fa-file-pdf"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF
        </button>
        <button id="close-lesson-view-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
    </div>
</div>
        <div id="lesson-view-content" class="flex-grow overflow-y-auto p-6 bg-gray-50">
            <div id="lesson-loader" class="hidden text-center py-16">
                <div class="loader mx-auto"></div>
                <p id="lesson-loader-text" class="mt-4 text-gray-600">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
            </div>
            <div id="lesson-sections-container" class="hidden space-y-6 ai-content">
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-bullseye"></i>POINT ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏î‡∏µ</h3><div id="pointContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-sd-card"></i>MEMORY ‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏≥</h3><div id="memoryContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-pencil-alt"></i>APPLICATION ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ</h3><div id="applicationContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-file-alt"></i>ONE-PAGE SUMMARY ‡πÑ‡∏ß‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3><div id="summaryContent"></div></div>
            </div>
        </div>
    </div>
</div>

    <div id="create-project-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà</h3>
            <label for="project-name-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <input type="text" id="project-name-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°.1 ‡πÄ‡∏ó‡∏≠‡∏° 2">
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-create-project-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-create-project-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</button>
            </div>
        </div>
    </div>

    <div id="admin-password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full">
            <h3 class="text-xl font-bold mb-4 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</h3>
            <p class="text-center text-gray-600 mb-4">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</p>
            <input type="password" id="admin-password-input" class="w-full p-3 border border-gray-300 rounded-lg text-center" placeholder="******">
            <p id="password-error-msg" class="text-red-500 text-sm text-center mt-2 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-admin-login-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-admin-login-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-[60]">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
            <h3 class="text-xl font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</h3>
            <p id="confirmation-message" class="text-gray-600 mb-6"></p>
            <div class="flex justify-center gap-4">
                <button id="cancel-delete-btn" class="bg-gray-300 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-delete-btn" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>
	
	<div id="lesson-plan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col">
        <div class="flex justify-between items-center mb-4 border-b pb-3">
            <h3 id="lesson-plan-title" class="text-2xl font-bold text-indigo-700">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ó‡∏µ‡πà AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
            <button id="close-lesson-plan-modal-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
        </div>
        
        <div id="lesson-plan-content" class="flex-grow overflow-y-auto bg-gray-50 p-8">
            </div>

        <div class="mt-6 pt-4 border-t flex justify-end gap-3">
            <button id="close-lesson-plan-modal-footer-btn" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300">‡∏õ‡∏¥‡∏î</button>
            <button id="export-lesson-pdf-btn" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700 flex items-center gap-2">
                <i class="fas fa-file-pdf"></i> Export ‡πÄ‡∏õ‡πá‡∏ô PDF
            </button>
        </div>
    </div>
</div>

    <div id="rename-quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <label for="rename-quiz-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="text" id="rename-quiz-input" class="w-full p-3 border border-gray-300 rounded-lg">
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-rename-quiz-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-rename-quiz-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="move-quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô</h3>
            <label for="move-quiz-project-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</label>
            <select id="move-quiz-project-select" class="w-full p-3 border border-gray-300 rounded-lg">
                <!-- Project options will be populated here -->
            </select>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-move-quiz-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-move-quiz-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏¢‡πâ‡∏≤‡∏¢</button>
            </div>
        </div>
    </div>
	
	<div id="blueprint-projects-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl w-full flex flex-col">
<div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-bold text-teal-700">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h3>
    <div class="flex items-center gap-4">
        <button id="manual-create-blueprint-btn" class="bg-blue-600 text-white py-1 px-3 rounded-lg font-semibold hover:bg-blue-700 flex items-center text-sm">
            <i class="fas fa-plus mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏≠‡∏á
        </button>
        <button id="cancel-blueprint-projects-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>
</div>
    <div id="blueprint-project-list" class="max-h-96 overflow-y-auto border rounded-md">
        <p class="p-4 text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
  </div>
</div>

<div id="manual-blueprint-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col">
    <h3 class="text-xl font-bold text-blue-700 mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</h3>

    <div class="space-y-4">
        <div>
            <label for="manual-bp-project-name" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <input type="text" id="manual-bp-project-name" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô O-NET ‡∏õ.6 (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á)">
        </div>
        <div>
            <label for="manual-bp-grade-level" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</label>
            <input type="text" id="manual-bp-grade-level" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">
        </div>
        <div>
            <label for="manual-bp-content" class="block text-sm font-medium text-gray-700">
                ‡∏ß‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤):
            </label>
            <textarea id="manual-bp-content" rows="10" class="mt-1 w-full p-2 border border-gray-300 rounded-lg font-mono text-sm" placeholder="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏µ‡πà 1: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏µ‡∏ä‡∏Ñ‡∏ì‡∏¥‡∏ï
    ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å ‡∏•‡∏ö ‡∏Ñ‡∏π‡∏ì ‡∏´‡∏≤‡∏£‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö
        ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï
    ‡πÄ‡∏ß‡∏•‡∏≤
        ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤"></textarea>
            <p class="text-xs text-gray-500 mt-1">
                <b>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</b><br>
                ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ = ‡∏™‡∏≤‡∏£‡∏∞ (Sara)<br>
                ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö = ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å (Main Topic)<br>
                ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ 2 ‡∏£‡∏∞‡∏î‡∏±‡∏ö = ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢ (Sub Topic)
            </p>
        </div>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button id="cancel-manual-bp-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
      <button id="confirm-manual-bp-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
      </button>
    </div>
  </div>
</div>
	
<div id="global-activity-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-xl font-bold text-gray-700">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏ó‡∏∏‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ)
            <span id="global-quiz-count" class="text-base font-normal text-gray-500 ml-2"></span>
        </h3>
        <button id="cancel-global-activity-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <input id="global-quiz-search-input" type="text" class="w-full p-2 border border-gray-300 rounded-lg mb-3 flex-shrink-0" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ...">

    <div id="global-activity-quiz-list" class="flex-grow overflow-y-auto border rounded-md">
      </div>

    </div>
</div>

<div id="quiz-bank-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl w-full flex flex-col">
    <div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-bold">‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        <span id="quiz-bank-count" class="text-base font-normal text-gray-500 ml-2"></span>
    </h3>
    <div class="flex items-center gap-4">
        <button id="bulk-quiz-settings-btn" class="bg-orange-500 text-white py-2 px-3 rounded-lg font-semibold hover:bg-orange-600 text-sm flex items-center gap-2">
            <i class="fas fa-cogs"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
        <button id="cancel-quiz-bank-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>
</div>

    <input id="bank-quiz-search-input" type="text" class="w-full p-2 border border-gray-300 rounded-lg mb-3" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö, ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö...">

    <div id="bank-quiz-list" class="max-h-96 overflow-y-auto border rounded-md">
      </div>

  </div>
</div>

<div id="topic-quiz-bank-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[90vh]">
        <div class="flex justify-between items-center mb-4 border-b pb-3">
            <div>
                <h3 class="text-xl font-bold text-gray-800">‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
                <p id="topic-bank-subtopic-name" class="text-sm text-gray-500"></p>
            </div>
            <button id="close-topic-bank-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
        </div>
        
        <div id="topic-bank-list" class="flex-grow overflow-y-auto border rounded-md">
            </div>

        <div class="mt-4 pt-4 border-t flex justify-between items-center">
            <p class="text-xs text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞</p>
			<button id="clear-all-links-btn" class="hidden bg-red-100 text-red-700 py-2 px-4 rounded-lg font-semibold hover:bg-red-200 text-sm">
                <i class="fas fa-eraser mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button id="add-from-global-bank-btn" class="bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700">
                <i class="fas fa-plus-circle mr-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏°
            </button>
        </div>
    </div>
</div>

    <div id="quiz-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full" style="max-height: 90vh; overflow-y: auto;">
            <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div class="space-y-4">
                <div>
                    <label for="modal-shuffle-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                    <select id="modal-shuffle-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
                        <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
                        <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                        <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                    </select>
                </div>
                <div>
                    <label for="modal-results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                    <select id="modal-results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
                        <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
                        <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
                        <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>

                        <optgroup label="‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÉ‡∏´‡∏°‡πà)">
                            <option value="half_mark_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á/‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á</option>
                            <option value="perfect_score_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°/‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</option>
                        </optgroup>
                    </select>
                </div>
                <div class="flex items-center mt-2">
                    <input id="modal-adaptive-quiz-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="modal-adaptive-quiz-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
                    </label>
                </div>

                <div class="flex items-center mt-2">
                    <input id="modal-loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="modal-loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
                    </label>
                </div>
                <div class="p-3 border rounded-lg bg-indigo-50 space-y-2">
                    <div class="flex items-center">
                        <input id="modal-confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="modal-confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
                        </label>
                    </div>
                    <div id="modal-confidence-mode-container" class="hidden pl-6">
                        <label for="modal-confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
                        <select id="modal-confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                            <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                            <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
                        </select>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <label for="modal-timer-mode-select" class="block text-sm font-medium text-gray-700">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <select id="modal-timer-mode-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</option>
                        <option value="whole_quiz">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ)</option>
                        <option value="per_question">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</option>
                    </select>
                </div>
                <div id="modal-timer-duration-container" class="hidden">
                    <label for="modal-timer-duration-input" id="modal-timer-duration-label" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <input type="number" id="modal-timer-duration-input" value="10" min="1" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="border-t pt-4">
                    <label for="modal-passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
                    <input type="number" id="modal-passing-score-input" value="5" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="border-t pt-4 mt-2">
                    <p class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-balance-scale mr-1"></i> ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 1):
                    </p>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å / ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</label>
                            <input type="number" id="modal-score-mcq" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-blue-600">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö)</label>
                            <input type="number" id="modal-score-sa" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-purple-600">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡∏ñ‡∏π‡∏Å / ‡∏ú‡∏¥‡∏î</label>
                            <input type="number" id="modal-score-tf" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-green-600">
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">*‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° (‡πÄ‡∏ä‡πà‡∏ô 6.50, 7.125)</p>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-quiz-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-quiz-settings-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
	
	<div id="blueprint-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full flex flex-col">
        <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)</h3>
        
        <div class="space-y-4 max-h-[70vh] overflow-y-auto pr-4">
            
            <div>
                <label for="bp-modal-quiz-type-select" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
                <select id="bp-modal-quiz-type-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    <optgroup label="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">
                        <option value="multiple_choice">‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö (‡∏Å, ‡∏Ç, ‡∏Ñ, ‡∏á)</option>
                        <option value="matching">‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠)</option>
                        <option value="true_false">‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î</option>
                    </optgroup>
                    <optgroup label="‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥">
                        <option value="fill_in_with_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ)</option>
                        <option value="fill_in_no_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)</option>
                        <option value="mixed">‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥)</option>
                    </optgroup>
                </select>
            </div>

            <div>
                <label for="bp-modal-difficulty-level-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</label>
                <select id="bp-modal-difficulty-level-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                     </select>
            </div>

            <div>
                <label for="bp-modal-question-complexity-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
                <select id="bp-modal-question-complexity-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    </select>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="bp-modal-num-questions" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠:</label>
                    <input type="number" id="bp-modal-num-questions" value="5" min="1" max="20" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label for="bp-modal-passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
                    <input type="number" id="bp-modal-passing-score-input" value="3" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            
            <div id="bp-modal-num-choices-container">
                <label for="bp-modal-num-choices" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                <input type="number" id="bp-modal-num-choices" value="4" min="2" max="6" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            </div>

            <div>
                <label for="bp-modal-shuffle-setting-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                <select id="bp-modal-shuffle-setting-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
                    <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
                    <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                    <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                </select>
            </div>
            
            <div class="flex items-center mt-2">
                <input id="bp-modal-include-images-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                <label for="bp-modal-include-images-checkbox" class="ml-2 block text-sm font-medium text-gray-900">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
            </div>

        </div>
        
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-bp-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-bp-settings-btn" class="bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
    </div>
</div>
    
    <div id="quiz-status-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div class="space-y-4">
                <div class="space-y-2" id="quiz-status-options">
                    <!-- Radio buttons will be dynamically inserted here -->
                </div>
                <div id="quiz-schedule-end-container" class="hidden space-y-2 border-t pt-3">
                    <label for="quiz-end-time" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î:</label>
                    <input type="datetime-local" id="quiz-end-time" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div id="quiz-schedule-start-container" class="hidden space-y-2 border-t pt-3">
                    <label for="quiz-start-time" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î:</label>
                    <input type="datetime-local" id="quiz-start-time" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-quiz-status-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-quiz-status-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
	
	<div id="bulk-quiz-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full">
        <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</h3>
        <p class="text-sm text-red-600 mb-4">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö **‡∏ó‡∏∏‡∏Å‡∏ä‡∏∏‡∏î** ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
<div class="space-y-4">
    <div>
        <label for="bulk-shuffle-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <select id="bulk-shuffle-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
            <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
            <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
        </select>
    </div>
    <div>
        <label for="bulk-results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="bulk-results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
            <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
            <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
            <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>
        </select>
    </div>
    <div class="flex items-center mt-2">
        <input id="bulk-loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="bulk-loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
        </label>
    </div>

    <div class="p-3 border-t border-gray-200 mt-2 space-y-2 bg-indigo-50 rounded-lg">
        <div class="flex items-center">
            <input id="bulk-confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="bulk-confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
            </label>
        </div>
        <div id="bulk-confidence-mode-container" class="hidden pl-6">
            <label for="bulk-confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
            <select id="bulk-confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
            </select>
        </div>
    </div>
    </div>
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-bulk-quiz-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="confirm-bulk-quiz-settings-btn" class="bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
    </div>
</div>

<div id="quiz-editor-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-3">
                <h3 class="text-2xl font-bold text-indigo-700">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
                <button id="cancel-quiz-edits-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
            </div>
            <div class="flex-grow overflow-y-auto pr-2">
                <div class="mb-4">
                    <label for="editor-quiz-topic" class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
                    <input type="text" id="editor-quiz-topic" class="w-full p-2 border border-gray-300 rounded-lg text-lg font-semibold">
                </div>
                <div id="quiz-editor-questions-container" class="space-y-6">
                    </div>
            </div>
          <div class="mt-6 pt-4 border-t flex flex-col sm:flex-row sm:justify-end gap-3">
    <button id="auto-fix-latex-btn" class="bg-yellow-500 text-white py-2 px-6 rounded-lg hover:bg-yellow-600 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-magic-wand-sparkles"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </button>
    <button id="verify-answers-editor-btn" class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-check-double"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏¢ (AI)
    </button>
    <button id="cancel-quiz-edits-btn-footer" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 w-full sm:w-auto justify-center">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <button id="save-quiz-edits-btn" class="bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    </button>
</div>
			
        </div>
    </div>
	
	<div id="confirm-game-start-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full flex flex-col" style="max-height: 90vh;">
        
        <div class="p-6 border-b flex-shrink-0">
            <h3 id="game-start-modal-title" class="text-xl font-bold mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
            <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
        </div>

        <div class="flex-grow overflow-y-auto p-6">
            <div class="my-4">
                <label for="save-game-results-checkbox" class="flex items-center cursor-pointer">
                    <input id="save-game-results-checkbox" type="checkbox" checked="" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <span class="ml-3 text-gray-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                </label>
                <p class="text-xs text-gray-500 mt-1 pl-8">‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥</p>
            </div>
            
            <div id="sync-variant-selector" class="my-4 text-left">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¢ (Sync Mode):</label>
                <div class="space-y-2">
    
    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="anonymous" class="mr-3" checked="">
        <div>
            <p class="font-semibold">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (Anonymous)</p>
            <p class="text-xs text-gray-500">‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="anonymous_reveal_end" class="mr-3">
        <div>
            <p class="font-semibold">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô + ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢</p>
            <p class="text-xs text-gray-500">‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏°</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="classic" class="mr-3">
        <div>
            <p class="font-semibold">‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (Classic)</p>
            <p class="text-xs text-gray-500">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="reveal_at_end" class="mr-3">
        <div>
            <p class="font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢ (Reveal at End)</p>
            <p class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏Ç‡πâ‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏Å‡∏°)</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="competition" class="mr-3">
        <div>
            <p class="font-semibold">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</p>
            <p class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏µ‡πÉ‡∏î‡πÜ</p>
        </div>
    </label>
</div>

<div id="onet-mode-container" class="my-4 pt-4 border-t border-gray-200 text-left hidden">
                <label class="flex items-center cursor-pointer bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <input id="onet-mode-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <div class="ml-3">
                        <span class="text-blue-800 font-bold">‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á (O-NET Mode)</span>
                        <p class="text-xs text-blue-600 mt-1">
                            <i class="fas fa-info-circle"></i> ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏ä‡πà‡∏ô 6.5, 7.125) ‡πÅ‡∏•‡∏∞ <u>‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</u> (‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô, ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)
                        </p>
                    </div>
                </label>
            </div>

            </div>
			
			<div id="anon-settings-container" class="my-4 pl-8 text-left hidden">
            <label for="anon-show-answer-toggle" class="flex items-center cursor-pointer">
                <input id="anon-show-answer-toggle" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked="">
                <span class="ml-3 text-sm text-gray-700">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏•‡∏¢‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)</span>
            </label>
        </div>

            <div class="my-4 pt-4 border-t border-gray-200 text-left">
                <label for="sync-timer-enable-checkbox" class="flex items-center cursor-pointer">
                    <input id="sync-timer-enable-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="ml-3 text-gray-700 font-semibold">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</span>
                </label>
                <div id="sync-timer-duration-container" class="hidden mt-2 pl-8">
    <label for="sync-timer-duration-input" class="block text-sm font-medium text-gray-600">
        ‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):
    </label>
    <input type="number" id="sync-timer-duration-input" value="300" min="10" class="mt-1 w-24 p-2 border border-gray-300 rounded-lg text-sm">
    <p class="text-xs text-gray-500 mt-1">(‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 300 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ = 5 ‡∏ô‡∏≤‡∏ó‡∏µ)</p>
</div>
            </div>
			
			<div id="black-market-settings-container" class="my-4 pt-4 border-t border-gray-200 text-left hidden">
            <label for="enable-black-market-checkbox" class="flex items-center cursor-pointer">
                <input id="enable-black-market-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked="">
                <span class="ml-3 text-gray-700 font-semibold">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î (Black Market)</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 pl-8">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Points ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ ‡∏ã‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠</p>
        </div>
			
        </div>

        <div class="p-6 border-t flex-shrink-0">
            <input type="hidden" id="game-start-quiz-id">
            <input type="hidden" id="game-start-mode">
            <div class="flex justify-end gap-3">
                <button id="cancel-game-start-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-game-start-btn" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
            </div>
        </div>
        
    </div>
</div>

<div id="shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î</h3>
        <div class="space-y-4">
            <div>
                <label for="shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô Blueprint O-NET ‡∏õ.6">
            </div>
            <div>
                <label for="shortcut-blueprint-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå Test Blueprint (‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="shortcut-blueprint-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
            <div>
                <label for="shortcut-reference-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°):</label>
                <input type="url" id="shortcut-reference-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠ TXT">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="shortcut-id-input">
            <button id="cancel-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 id="shortcut-modal-main-title" class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>
    <div id="additional-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

    <!-- Presentation Mode Container -->
    <div id="presentation-modal" class="fixed inset-0 bg-gray-800 text-white flex-col items-center justify-center hidden z-50 p-4">
        <button id="close-presentation-btn" class="absolute top-4 right-6 text-4xl hover:text-gray-300">√ó</button>
        <div id="presentation-slide-container" class="w-full max-w-5xl h-full flex flex-col items-center justify-center">
            <!-- Slide content will be injected here -->
        </div>
<div class="absolute bottom-4 w-full flex justify-between items-center px-8 max-w-5xl mx-auto left-0 right-0">
            <button id="prev-question-btn" class="bg-indigo-600 py-2 px-5 rounded-lg hover:bg-indigo-700 disabled:bg-gray-500 disabled:cursor-not-allowed"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
            
            <div class="flex-grow flex justify-center items-center gap-8">
                <div id="slide-counter" class="text-lg font-semibold"></div>
                <button id="presentation-scratchpad-btn" class="bg-white/20 hover:bg-white/40 text-white font-bold py-2 px-5 rounded-lg text-lg flex items-center gap-2" title="‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ó‡∏î‡πÄ‡∏•‡∏Ç">
                    <i class="fas fa-pencil-alt"></i> ‡∏ó‡∏î‡πÄ‡∏•‡∏Ç
                </button>
            </div>
            
            <button id="next-question-btn" class="bg-indigo-600 py-2 px-5 rounded-lg hover:bg-indigo-700 disabled:bg-gray-500 disabled:cursor-not-allowed">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ<i class="fas fa-arrow-right ml-2"></i></button>
        </div>
    </div>
    <!-- NEW: Student Rankings Modal -->
    <div id="student-rankings-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-3xl w-full h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-indigo-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥</h3>
                <button id="close-student-rankings-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
            </div>
            <!-- Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6">
                    <button id="student-quiz-leaderboard-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                        <i class="fas fa-list-ol mr-2"></i>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
                    </button>
                    <button id="student-project-leaderboard-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500">
                        <i class="fas fa-trophy mr-2"></i>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
                    </button>
                </nav>
            </div>
            <!-- Content -->
            <div class="flex-grow overflow-y-auto mt-4">
                <div id="student-quiz-leaderboard-content">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-100 sticky top-0">
                            <!-- Header for Quiz Leaderboard -->
                        </thead>
                        <tbody id="student-quiz-leaderboard-table-body"></tbody>
                    </table>
                </div>
                <div id="student-project-leaderboard-content" class="hidden">
                     <table class="min-w-full bg-white">
                        <thead class="bg-gray-100 sticky top-0">
                           <!-- Header for Project Leaderboard -->
                        </thead>
                        <tbody id="student-project-leaderboard-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
	
	<div id="project-passcode-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full">
        <h3 class="text-xl font-bold mb-2 text-center">‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
        <p id="passcode-prompt-message" class="text-center text-gray-600 mb-4"></p>
        <input type="text" id="student-passcode-input" class="w-full p-3 border border-gray-300 rounded-lg text-center" placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        <p id="passcode-error-msg" class="text-red-500 text-sm text-center mt-2 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-passcode-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="confirm-passcode-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
</div>

<div id="confidence-modal" data-current-mode="" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 text-center max-w-sm w-full relative">
        <button id="cancel-confidence-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">
            √ó
        </button>
        <p class="text-xl font-semibold text-gray-800 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?</p>
 <div class="flex justify-center gap-4">
    <button id="confirm-confident" class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-green-700 transition-transform hover:scale-105">
        <i class="far fa-smile-beam mr-2"></i>‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
    </button>
    <button id="confirm-not-confident" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-gray-600 transition-transform hover:scale-105">
        <i class="far fa-meh mr-2"></i>‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
    </button>
</div>
        <input type="hidden" id="selected-answer-index-hidden">
    </div>
</div>

<div id="wager-modal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 text-center max-w-sm w-full relative">
        <button id="cancel-wager-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">
            √ó
        </button>
        <p class="text-xl font-semibold text-gray-800 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?</p>
        <p class="text-lg text-gray-600 mb-2">
            ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ <span id="wager-max-points" class="font-bold text-indigo-600">0</span> Points
        </p>
        
        <div class="my-4 flex items-center gap-3">
    <input id="wager-slider" type="range" min="0" max="0" value="0" class="flex-grow h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
    
    <button id="wager-all-in-btn" class="bg-gradient-to-r from-red-500 to-pink-600 text-white text-xs font-bold py-2 px-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all shrink-0 flex items-center gap-1">
        <span>‡∏ó‡∏∏‡πà‡∏°‡∏´‡∏°‡∏î!</span> <i class="fas fa-rocket"></i>
    </button>
</div>
        
        <p class="text-5xl font-bold text-indigo-700 mb-6">
            <span id="wager-amount-display">0</span>
        </p>
        
        <button id="confirm-wager-btn" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-green-700 transition-transform hover:scale-105">
            <i class="fas fa-gavel mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô
        </button>
        
        <input type="hidden" id="selected-answer-index-hidden-wager">
    </div>
</div>

<div id="black-market-modal" class="hidden fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 text-center max-w-lg w-full relative">
        <button id="close-market-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏õ‡∏¥‡∏î‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î">
            √ó
        </button>
        
        <h2 class="text-3xl font-bold text-gray-800 mb-2">
            <i class="fas fa-store text-purple-600"></i> ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î
        </h2>
        <p class="text-lg text-gray-600 mb-4">
            ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ <span id="market-current-points" class="font-bold text-purple-600">0</span> Points
        </p>
        
        <div id="market-timer-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
            <div id="market-timer-bar" class="bg-purple-600 h-2.5 rounded-full" style="width: 100%; transition: width 1s linear;"></div>
        </div>

        <div id="market-item-list" class="space-y-2 max-h-64 overflow-y-auto text-left">
            </div>
    </div>
</div>

<div id="pin-entry-modal" class="fixed inset-0 bg-black/80 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden flex flex-col">
        
        <div class="bg-indigo-600 p-6 text-center relative">
            <button id="close-pin-modal-btn" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-xl font-bold text-white mb-1">‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h3>
            <p class="text-indigo-200 text-sm">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 4 ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏£‡∏π</p>
        </div>

        <div class="p-6 flex justify-center gap-3 mb-2">
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
        </div>

        <div class="px-6 pb-8">
            <div class="grid grid-cols-3 gap-4">
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="1">1</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="2">2</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="3">3</button>
                
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="4">4</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="5">5</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="6">6</button>
                
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="7">7</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="8">8</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="9">9</button>
                
                <div class="flex items-center justify-center">
                     </div>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="0">0</button>
                <button id="pin-backspace-btn" class="bg-red-50 hover:bg-red-100 active:bg-red-200 text-red-500 font-bold text-xl py-4 rounded-xl transition-colors flex items-center justify-center">
                    <i class="fas fa-backspace"></i>
                </button>
            </div>
        </div>

    </div>
</div>

<!-- ‚ñº‚ñº‚ñº 3.1 ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà <div id="scratchpad-modal"> ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº -->
<div id="scratchpad-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 sm:p-6 md:p-8">
    <div class="bg-white w-full h-full rounded-lg shadow-xl flex flex-col overflow-hidden">
        
        <div id="scratchpad-controls" class="flex-shrink-0">
             </div>

        <div class="scratchpad-content-wrapper flex-grow relative">
            <canvas id="scratchpad-canvas" class="absolute inset-0 z-10"></canvas>
            <div id="scratchpad-header" class="p-4 sm:p-6 relative z-20 pointer-events-none">
                <h3 id="scratchpad-question" class="text-xl sm:text-2xl font-bold text-gray-800"></h3>
                <div id="scratchpad-options" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 mt-3 text-gray-700">
                </div>
            </div>
        </div>
    </div>
</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, addDoc, updateDoc, collection, query, where, getDocs, onSnapshot, deleteDoc, deleteField, writeBatch, runTransaction, serverTimestamp, increment, arrayUnion, arrayRemove, getCountFromServer } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// SECURE BOOTSTRAP
(function() {
    setInterval(function(){
        const t0 = Date.now();
        debugger; 
        const t1 = Date.now();
        if(t1 - t0 > 100) { console.warn("Debugger detected"); }
    }, 2000);
    
    const _secret = "CiAgICAgICAgLy8g4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCgkJCgkJLy8gLS0tIFsg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4LibIF0gLS0tCmNvbnN0IEFOT05ZTU9VU19OQU1FUyA9IFsKICAi4LiZ4Lix4LiB4Lil4LmI4Liy4Lid4Lix4LiZIiwgIuC4muC4seC4geC5geC4leC4h+C5guC4oSIsICLguYDguJfguJ7guJfguKPguLkiLCAi4LmA4Lir4Lih4Li14Lii4Lin4LiC4Li14LmJ4LmA4LiL4LiyIiwgIuC4meC4geC4ruC4ueC4geC4geC4peC4suC4h+C4p+C4seC4mSIsICLguYDguJXguYjguLLguKrguLLguKLguJ/guYnguLIiLCAi4LmC4Lil4Lih4Liy4Lia4Li04LiZIiwgIuC4quC4tOC4h+C5guC4leC4ouC4tOC5ieC4oSIsICLguYDguJ7guJnguIHguKfguLTguJnguYTguJ8iLCAi4LiI4Li04LiH4LmC4LiI4LmJ4Liq4LmC4Lil4Lin4LmM4LmE4Lil4Lif4LmMIiwKICAi4Lic4Li54LmJ4Lie4Li04LiK4Li04LiV4LiU4Liy4LinIiwgIuC4oeC4t+C4reC4m+C4o+C4suC4muC4quC4suC4ouC4o+C4uOC5ieC4hyIsICLguYDguIfguLLguJvguKPguLTguKjguJnguLIiLCAi4Liq4Liy4Lii4Lil4Lih4LmB4Lir4LmI4LiH4LmC4LiK4LiE4LiK4Liw4LiV4LiyIiwgIuC4reC4seC4qOC4p+C4tOC4meC4o+C4seC4leC4leC4tOC4geC4suC4pSIsICLguIjguK3guKHguYDguKfguJfguKLguYzguILguJnguKHguKvguKfguLLguJkiLCAi4LiZ4Li04LiZ4LiI4Liy4LiK4Liy4LmA4LiC4Li14Lii4LinIiwgIuC4i+C4suC4oeC4ueC5hOC4o+C4quC4suC4ouC5gOC4lOC4teC5iOC4ouC4pyIsICLguYLguIjguKPguKrguKXguLHguJTguK3guKfguIHguLLguKgiLCAi4Lih4Lix4LiH4LiB4Lij4LiB4Li04LiZ4LiI4Li4IiwKICAi4Lir4Lih4Li14LiC4Lix4LmJ4Lin4LmC4Lil4LiB4LmD4LiV4LmJIiwgIuC5geC4oeC4p+C5gOC4geC5ieC4suC4iuC4teC4p+C4tOC4lSIsICLguJvguKXguLLguJfguLnguITguLDguJnguK3guIciLCAi4LmE4LiB4LmI4Lif4LmJ4Liy4Lie4LiN4Liy4Lil4LitIiwgIuC4geC4uOC5ieC4h+C5gOC4leC5ieC4meC5geC4o+C5ieC4h+C4geC4siIsICLguKvguKHguLLguJvguYjguLLguYDguJTguLXguKLguKfguJTguLLguKIiLCAi4LiB4Lij4Liw4LiV4LmI4Liy4Lii4LiV4Li34LmI4LiZ4LiV4Li54LihIiwgIuC5gOC4quC4t+C4reC4i+C5iOC4reC4meC5gOC4peC5h+C4miIsICLguKHguYnguLLguJTguLXguJTguIHguLDguYLguKvguKXguIEiLCAi4Lir4LiZ4Lit4LiZ4Lir4LiZ4Lix4LiH4Liq4Li34LitIiwKICAi4Lii4Lit4LiU4LiZ4Lix4LiB4Liq4Li34LiaIiwgIuC4quC4suC4ouC4peC4seC4muC4iOC4seC4muC4muC5ieC4suC4meC5gOC4peC5h+C4gSIsICLguITguJnguJTguLXguKjguKPguLXguKrguKLguLLguKEiLCAi4LiU4Liy4LinVGlrVG9rIiwgIuC4ouC4ueC4l+C4ueC4m+C5gOC4muC4reC4o+C5jOC4neC4tuC4geC4q+C4seC4lCIsICJDRU/guJ7guLHguJnguKXguYnguLLguJkiLCAi4LmA4Lio4Lij4Lip4LiQ4Li14LiU4Li54LmE4LiaIiwgIuC4reC4tOC4meC4n+C4peC4ueC5gOC4reC4meC5gOC4i+C4reC4o+C5jCIsICLguYDguJnguYfguJXguYTguK3guJTguK3guKUiLCAi4LiU4Liy4Lin4Liq4Lig4LiyIiwKICAi4LiB4Liy4LmB4Lif4LiC4LihIiwgIuC4iuC4suC5hOC4guC5iOC4oeC4uOC4gSIsICLguKrguYnguKHguJXguLPguJvguLnguJvguKXguLLguKPguYnguLIiLCAi4Lie4Li04LiL4LiL4LmI4Liy4Lir4LiZ4LmJ4Liy4LiX4Li44LmA4Lij4Li14Lii4LiZIiwgIuC5hOC4reC4leC4tOC4oeC4l+C4reC4lCIsICLguILguYnguLLguKfguKHguLHguJnguYTguIHguYjguJ7guLTguYDguKjguKkiLCAi4Lir4Lih4Li54LiB4Lij4Liw4LiX4Liw4LiI4Liw4LmA4Lii4Li14Lii4Lin4Lii4Liy4LiX4Li44LiB4Liq4Li04LmI4LiHIiwgIuC4hOC4o+C4seC4p+C4i+C4reC4h+C4leC5jCIsICLguIrguLXguKrguYDguITguYnguIEiLCAi4Lil4Liy4LmA4LiV4LmJ4LmE4Lih4LmI4Lir4Lin4Liy4LiZIiwKICAi4Liq4Liy4Lii4LiV4Liy4Liq4Lix4LmJ4LiZIiwgIuC4m+C4p+C4lOC4q+C4peC4seC4hyIsICLguK3guK3guJ/guJ/guLTguKjguIvguLTguJnguYLguJTguKPguKEiLCAi4LiZ4Lit4LiZ4LmE4Lih4LmI4Lie4LitIiwgIuC4leC4tOC4lOC4i+C4teC4o+C4teC4quC5jCIsICLguYHguJrguJXguKvguKHguJQiLCAi4LmA4LiZ4LmH4LiV4LiK4LmJ4LiyIiwgIuC5guC4q+C4peC4lOC4meC4suC4mSIsICI0MDQgTm90IEZvdW5kIiwgIuC4geC4reC4h+C4lOC4reC4hyIsCiAgIuC4iOC4seC4meC4l+C4o+C5jOC5gOC4iOC5ieC4siIsICLguJXguLDguKfguLHguJnguInguLLguKIiLCAi4Liq4Liy4Lii4Lir4Lih4Lit4LiBIiwgIuC4geC5ieC4reC4meC5gOC4oeC4hiIsICLguJTguKfguIfguJTguLLguKciLCAi4LiX4LmJ4Lit4LiH4Lif4LmJ4LiyIiwgIuC4l+C4sOC5gOC4pSIsICLguKDguLnguYDguILguLIiLCAi4Lib4LmI4Liy4LmE4Lih4LmJIiwgIuC5geC4oeC5iOC4meC5ieC4syIsCiAgIuC4meC4seC4geC5gOC4lOC4tOC4meC4l+C4suC4hyIsICLguIrguYjguLLguIfguKDguLLguJ4iLCAi4LmA4LiB4Lih4LmA4Lih4Lit4Lij4LmMIiwgIuC4qOC4tOC4peC4m+C4tOC4mSIsICLguJnguLHguIHguJTguJnguJXguKPguLUiLCAi4LiZ4Lix4LiB4LmA4LiC4Li14Lii4LiZIiwgIuC4meC4seC4geC4p+C4tOC4l+C4ouC4suC4qOC4suC4quC4leC4o+C5jCIsICLguJnguLHguIHguJvguKPguLDguJTguLTguKnguJDguYwiLCAi4LiZ4Lix4LiB4LiB4Li14Lis4LiyIiwgIuC4hOC4o+C4ueC5g+C4q+C4jeC5iCIsCiAgIuC4nuC4peC4seC4h+C4hOC4peC4t+C5iOC4meC5gOC4leC5iOC4siIsICLguJvguKXguYjguK3guKLguJ7guKXguLHguIciLCAi4LmB4Lib4Lil4LiH4Lij4LmI4Liy4LiHIiwgIuC4leC4seC4p+C5geC4l+C4meC5geC4q+C5iOC4h+C4lOC4p+C4h+C4iOC4seC4meC4l+C4o+C5jCIsICLguJTguLLguJrguJ7guLTguIbguLLguJXguK3guKrguLnguKMiLCAi4LiE4Liy4LiW4Liy4LmB4Lii4LiB4LmA4LiH4Liy4Lie4Lix4LiZ4Lij4LmI4Liy4LiHIiwgIuC4mOC4reC4o+C5jOC4hOC5ieC4reC4meC4muC4tOC4mSIsICLguYTguK3guKPguK3guJnguYHguKHguJkiLCAi4LiB4Lix4Lib4LiV4Lix4LiZIiwgIuC4ruC4seC4peC4hOC5jCIsCiAgIuC4o+C4seC4geC5geC4o+C4geC4nuC4miIsICLguITguJnguYLguKrguJQiLCAi4LmB4Lit4Lia4LiK4Lit4LiaIiwgIuC4reC4geC4q+C4seC4gSIsICLguYDguJ7guLfguYjguK3guJnguKrguJnguLTguJciLCAi4LiE4Li54LmI4LiI4Li04LmJ4LiZIiwgIuC5geC4n+C4meC4l+C4tOC4nuC4ouC5jCIsICLguITguJnguITguLjguKIiLCAi4Liq4LiW4Liy4LiZ4Liw4LmE4Lih4LmI4LiK4Lix4LiU4LmA4LiI4LiZIiwgIuC4oeC4ueC5gOC4leC4peC4uSIKXTsKbGV0IGxhc3RTZWVuUXVlc3Rpb25JbmRleCA9IC0xOwpsZXQgb3JkZXJlZFBsYXllclNlbGVjdGlvbiA9IFtdOyAvLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguKPguLLguKLguIrguLfguYjguK3guJXguLLguKHguKXguLPguJTguLHguJrguJfguLXguYjguIHguJTguYDguKXguLfguK3guIEKbGV0IGNsaWVudFNpZGVIaWRkZW5PcHRpb25zID0ge307CmxldCBibHVlcHJpbnRTaG9ydGN1dHMgPSBbXTsKbGV0IHNob3J0Y3V0VGFicyA9IFtdOyAgICAgICAgIC8vIE5FVzog4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4LiX4LmH4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCmxldCBzaG9ydGN1dE9yZGVyID0ge307ICAgICAgICAvLyBORVc6IOC4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4muC4peC4s+C4lOC4seC4muC4geC4suC4o+C4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C4guC4reC4h+C5geC4leC5iOC4peC4sOC5geC4l+C5h+C4mgpsZXQgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyBORVc6IElEIOC4guC4reC4h+C5geC4l+C5h+C4muC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4luC4ueC4geC5gOC4peC4t+C4reC4gQpsZXQgZmlsZVNob3J0Y3V0VGFicyA9IFtdOwpsZXQgZmlsZVNob3J0Y3V0T3JkZXIgPSB7fTsKbGV0IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID0gJ2FsbCc7CmxldCBwYXJhbGxlbFNob3J0Y3V0VGFicyA9IFtdOwpsZXQgcGFyYWxsZWxTaG9ydGN1dE9yZGVyID0ge307CmxldCBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKbGV0IGZpbGVTaG9ydGN1dHMgPSBbXTsKbGV0IHBhcmFsbGVsVGVzdFNob3J0Y3V0cyA9IFtdOwpsZXQgY2FtZUZyb21CbHVlcHJpbnQgPSBmYWxzZTsKbGV0IHdha2VMb2NrID0gbnVsbDsKbGV0IGxvY2FsR3JvdXBRdWVzdGlvbkluZGV4ID0gMDsKCmxldCBibHVlcHJpbnRQYWdlU2V0dGluZ3MgPSBudWxsOyAvLyDguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguITguYjguLIgc2V0dGluZyDguIrguLHguYjguKfguITguKPguLLguKfguYPguJnguKvguJnguYnguLLguJnguLXguYkKCmxldCBleHRyYWN0ZWRCbHVlcHJpbnREYXRhID0gbnVsbDsgLy8g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmE4LiU4LmJ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCmxldCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkID0gbnVsbDsgLy8g4LmA4LiB4LmH4LiaIElEIOC4guC4reC4hyBQcm9qZWN0IOC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4lOC4ueC4reC4ouC4ueC5iAoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaICLguILguK0iIOC5g+C4q+C5ieC5gOC4muC4o+C4suC4p+C5jOC5gOC4i+C4reC4o+C5jOC5gOC4m+C4tOC4lOC4geC4suC4o+C4peC5h+C4reC4geC4q+C4meC5ieC4suC4iOC4rQpjb25zdCByZXF1ZXN0V2FrZUxvY2sgPSBhc3luYyAoKSA9PiB7CiAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Lin4LmI4Liy4LmA4Lia4Lij4Liy4Lin4LmM4LmA4LiL4Lit4Lij4LmM4LiZ4Li14LmJ4Lij4Lit4LiH4Lij4Lix4LiaIFdha2UgTG9jayDguKvguKPguLfguK3guYTguKHguYgKICBpZiAoJ3dha2VMb2NrJyBpbiBuYXZpZ2F0b3IpIHsKICAgIHRyeSB7CiAgICAgIC8vIOC4quC5iOC4h+C4hOC4s+C4guC4reC5geC4peC4sOC5gOC4geC5h+C4miBvYmplY3Qgd2FrZUxvY2sg4LmE4Lin4LmJ4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijCiAgICAgIHdha2VMb2NrID0gYXdhaXQgbmF2aWdhdG9yLndha2VMb2NrLnJlcXVlc3QoJ3NjcmVlbicpOwogICAgICBjb25zb2xlLmxvZygnV2FrZSBMb2NrIOC4l+C4s+C4h+C4suC4meC5geC4peC5ieC4pzog4Lir4LiZ4LmJ4Liy4LiI4Lit4LiI4Liw4LmE4Lih4LmI4LiU4Lix4Lia4LmA4Lit4LiHJyk7CgogICAgICAvLyDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXIg4LmA4Lic4Li34LmI4Lit4LiB4Lij4LiT4Li14LiX4Li14LmI4LiB4Liy4Lij4Lil4LmH4Lit4LiB4Lir4Lil4Li44LiU4LmE4Lib4LmA4Lit4LiHICjguYDguIrguYjguJkg4LmB4Lia4LiV4LmD4LiB4Lil4LmJ4Lir4Lih4LiUKQogICAgICB3YWtlTG9jay5hZGRFdmVudExpc3RlbmVyKCdyZWxlYXNlJywgKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdXYWtlIExvY2sg4LiW4Li54LiB4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4LmB4Lil4LmJ4LinJyk7CiAgICAgIH0pOwoKICAgIH0gY2F0Y2ggKGVycikgewogICAgICAvLyDguIHguKPguJPguLXguJfguLXguYjguITguLPguILguK3guKXguYnguKHguYDguKvguKXguKcgKOC5gOC4iuC5iOC4mSDguJzguLnguYnguYPguIrguYnguJXguLHguYnguIfguITguYjguLLguYDguJrguKPguLLguKfguYzguYDguIvguK3guKPguYzguYTguKHguYjguK3guJnguLjguI3guLLguJUpCiAgICAgIGNvbnNvbGUuZXJyb3IoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4m+C4tOC4lCBXYWtlIExvY2s6ICR7ZXJyLm5hbWV9LCAke2Vyci5tZXNzYWdlfWApOwogICAgfQogIH0gZWxzZSB7CiAgICBjb25zb2xlLndhcm4oJ+C5gOC4muC4o+C4suC4p+C5jOC5gOC4i+C4reC4o+C5jOC4meC4teC5ieC5hOC4oeC5iOC4o+C4reC4h+C4o+C4seC4miBXYWtlIExvY2sgQVBJJyk7CiAgfQp9OwoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaICLguJvguKXguYjguK3guKIiIOC4q+C4o+C4t+C4reC4m+C4tOC4lOC4geC4suC4o+C4peC5h+C4reC4geC4q+C4meC5ieC4suC4iOC4rQpjb25zdCByZWxlYXNlV2FrZUxvY2sgPSBhc3luYyAoKSA9PiB7CiAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4LiyIHdha2VMb2NrIOC4geC4s+C4peC4seC4h+C4l+C4s+C4h+C4suC4meC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogIGlmICh3YWtlTG9jayAhPT0gbnVsbCkgewogICAgYXdhaXQgd2FrZUxvY2sucmVsZWFzZSgpOyAvLyDguKrguLHguYjguIfguJvguLTguJQKICAgIHdha2VMb2NrID0gbnVsbDsgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4Liy4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijCiAgICBjb25zb2xlLmxvZygnV2FrZSBMb2NrIOC4luC4ueC4geC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC5geC4peC5ieC4pzog4Lir4LiZ4LmJ4Liy4LiI4Lit4LiB4Lil4Lix4Lia4Liq4Li54LmI4LmC4Lir4Lih4LiU4Lib4LiB4LiV4Li0Jyk7CiAgfQp9OwovLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEgXSAtLS0KCmxldCBkaW1UaW1lciA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4miB0aW1lcgpjb25zdCBpbmFjdGl2aXR5VGltZSA9IDYwMDAwOyAvLyA2MCDguKfguLTguJnguLLguJfguLUgKDYwMDAwIOC4oeC4tOC4peC4peC4tOC4p+C4tOC4meC4suC4l+C4tSkKCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4o+C4teC5gOC4i+C5h+C4lSBUaW1lciDguYHguKXguLDguJfguLPguYPguKvguYnguIjguK0gIuC4quC4p+C5iOC4suC4hyIKZnVuY3Rpb24gcmVzZXREaW1UaW1lcigpIHsKICAgIC8vIOC5gOC4o+C4suC4iOC4sOC4o+C4teC5gOC4i+C5h+C4leC4leC4seC4p+C4meC4seC4muC5gOC4p+C4peC4siDguIHguYfguJXguYjguK3guYDguKHguLfguYjguK3guKvguJnguYnguLLguIjguK3guKLguLHguIfguYTguKHguYjguKvguKPguLXguYjguYDguJfguYjguLLguJnguLHguYnguJkKICAgIC8vIOC4luC5ieC4suC4q+C4meC5ieC4suC4iOC4reC4q+C4o+C4teC5iOC5hOC4m+C5geC4peC5ieC4pyDguIHguLLguKPguILguKLguLHguJrguYDguKHguLLguKrguYwo4LiX4Li14LmI4LmE4Lih4LmI4LmE4LiU4LmJ4Lit4Lii4Li54LmI4Lia4LiZIE92ZXJsYXkpIOC4iOC4sOC5hOC4oeC5iOC4m+C4peC4uOC4geC4iOC4rQogICAgaWYgKCFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGltbWVkJykpIHsKICAgICAgICBpZiAoZGltVGltZXIpIGNsZWFyVGltZW91dChkaW1UaW1lcik7CiAgICAgICAgCiAgICAgICAgZGltVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LiE4Lij4LiaIDEg4LiZ4Liy4LiX4Li1IOC5g+C4q+C5ieC4q+C4o+C4teC5iOC4iOC4rSAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2RpbW1lZCcpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn4Lir4LiZ4LmJ4Liy4LiI4Lit4Lir4Lij4Li14LmI4LmB4Liq4LiH4Lil4LiH4LmA4LiZ4Li34LmI4Lit4LiH4LiI4Liy4LiB4LmE4Lih4LmI4LmD4LiK4LmJ4LiH4Liy4LiZJyk7CiAgICAgICAgfSwgaW5hY3Rpdml0eVRpbWUpOwogICAgfQp9CgpmdW5jdGlvbiB3YWtlVXBTY3JlZW4oZXZlbnQpIHsKICAgIGlmIChldmVudCkgewogICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOyAvLyA8LS0tIOC4hOC4s+C4quC4seC5iOC4h+C4quC4s+C4hOC4seC4jTog4Lir4Lii4Li44LiU4LmE4Lih4LmI4LmD4Lir4LmJ4LiE4Lil4Li04LiB4LiX4Liw4Lil4Li4CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIH0KICAgIAogICAgLy8gMS4g4Liq4Lix4LmI4LiH4LmD4Lir4LmJIE92ZXJsYXkg4Lir4Liy4Lii4LmE4LibCiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2RpbW1lZCcpOyAKICAgIAogICAgLy8gMi4g4Lir4Lil4Lix4LiH4LiI4Liy4LiB4Lib4Lil4Li44LiB4LiI4Lit4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC5gOC4o+C4tOC5iOC4oeC4meC4seC4muC5gOC4p+C4peC4suC4nuC4seC4geC4q+C4meC5ieC4suC4iOC4reC5g+C4q+C4oeC5iAogICAgaWYgKGRpbVRpbWVyKSBjbGVhclRpbWVvdXQoZGltVGltZXIpOwogICAgZGltVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2RpbW1lZCcpOwogICAgfSwgaW5hY3Rpdml0eVRpbWUpOwp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKvguKLguLjguJTguKPguLDguJrguJrguIjguLHguJrguYDguKfguKXguLLguJfguLHguYnguIfguKvguKHguJQKZnVuY3Rpb24gc3RvcERpbVRpbWVyKCkgewogICAgaWYgKGRpbVRpbWVyKSBjbGVhclRpbWVvdXQoZGltVGltZXIpOwogICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdkaW1tZWQnKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCByZXNldERpbVRpbWVyKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCByZXNldERpbVRpbWVyKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgcmVzZXREaW1UaW1lcik7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHJlc2V0RGltVGltZXIpOwogICAgY29uc29sZS5sb2coJ+C4q+C4ouC4uOC4lOC4o+C4sOC4muC4muC4iOC4seC4muC5gOC4p+C4peC4suC4q+C4o+C4teC5iOC4q+C4meC5ieC4suC4iOC4rScpOwp9CgogICAgICAgIC8vIC0tLSBHbG9iYWwgU3RhdGUgJiBDb25maWcgLS0tCgkJCgkJLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vID09PSBb4LmA4Lie4Li04LmI4LihXSDguJXguLHguKfguYHguJvguKMgR2xvYmFsIOC5g+C4q+C4oeC5iOC4quC4s+C4q+C4o+C4seC4miBUZWFtIFF1aXogPT09Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyDguKfguLLguIfguYTguKfguYnguYPguIHguKXguYnguYYg4LiB4Lix4Lia4LiV4Lix4Lin4LmB4Lib4LijIEdsb2JhbCDguK3guLfguYjguJnguYYg4LiU4LmJ4Liy4LiZ4Lia4LiZ4LiC4Lit4LiHIFNjcmlwdApsZXQgY3VycmVudFRlYW1RdWl6SWQgPSBudWxsOwpsZXQgdW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyID0gbnVsbDsKbGV0IGxvY2FsVGVhbVBsYXllcnMgPSBbXTsgLy8g4LmA4LiB4LmH4Lia4LiK4Li34LmI4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmA4Lil4Li34Lit4LiB4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCmxldCBsb2NhbFBsYXllclR1cm5JbmRleCA9IDA7IC8vIOC4peC4s+C4lOC4seC4muC4nOC4ueC5ieC5gOC4peC5iOC4meC5g+C4meC5gOC4hOC4o+C4t+C5iOC4reC4h+C4meC4teC5iQpsZXQgbG9jYWxRdWVzdGlvbkluZGV4ID0gMDsgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguJnguLHguJrguILguYnguK3guJvguLHguIjguIjguLjguJrguLHguJkKbGV0IGxvY2FsUGxheWVySW5kZXggPSAwOyAgICAgLy8gW+C5gOC4nuC4tOC5iOC4oV0g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LiZ4Lix4Lia4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LiC4LmJ4Lit4LiZ4Lix4LmJ4LiZ4LmGCmxldCBjdXJyZW50QXBwbGljYXRpb25EYXRhID0gW107CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IFvguYDguJ7guLTguYjguKFdIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4miBUZWFtIFF1aXogKOC4neC4seC5iOC4hyBBZG1pbikgPT09Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovKioKICog4LmA4Lij4Li04LmI4LihIFRlYW0gUXVpeiBTZXNzaW9uIOC5g+C4q+C4oeC5iCAoQWRtaW4pCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVTdGFydFRlYW1RdWl6KHF1aXpJZCwgc2hvdWxkU2F2ZSA9IGZhbHNlKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiByZW5kZXJBZG1pblRlYW1RdWl6RGFzaGJvYXJkKHBpbiwgdG9waWMsIG1vZGUgPSAndGVhbScpIHsgLy8gMS4g4LmA4Lie4Li04LmI4Lih4Lie4Liy4Lij4Liy4Lih4Li04LmA4LiV4Lit4Lij4LmMIG1vZGUKICAgIC8vIDIuIOC5gOC4nuC4tOC5iOC4oeC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5gOC4nuC4t+C5iOC4reC5gOC4peC4t+C4reC4geC4q+C4seC4p+C4guC5ieC4rQogICAgY29uc3QgbW9kZVRpdGxlID0gKG1vZGUgPT09ICdncm91cCcpID8gJ0dyb3VwIE1vZGUnIDogJ1RlYW0gUXVpeic7CgogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1jeWFuLTYwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIG1iLTIiPiR7bW9kZVRpdGxlfTogJHt0b3BpY308L2gyPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBtYi00Ij7guYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguYDguILguYnguLLguKPguYjguKfguKHguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYk6PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSB0ZXh0LWdyYXktODAwIHJvdW5kZWQtbGcgcC00IG1iLTQiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNnhsIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QiPiR7cGlufTwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy0yeGwgYmctd2hpdGUvMjAgcC00IHJvdW5kZWQtbGcgbXQtNCBmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIj4KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LXNlbWlib2xkIG1iLTIgdGV4dC1jZW50ZXIiPuC4quC4luC4suC4meC4sOC4nOC4ueC5ieC5gOC4peC5iOC4mTwvaDM+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ0ZWFtLXBsYXllci1zdGF0dXMtZ3JpZCIgY2xhc3M9InNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtY3lhbi0yMDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4nOC4ueC5ieC5gOC4peC5iOC4meC5gOC4guC5ieC4suC4o+C5iOC4p+C4oS4uLjwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgIDxidXR0b24gaWQ9ImVuZC10ZWFtLXF1aXotYnRuIiBjbGFzcz0ibXQtNiBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMiBweC02IHJvdW5kZWQtbGcgaG92ZXI6YmctcmVkLTcwMCI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSBtci0yIj48L2k+4LiI4Lia4LiB4Li04LiI4LiB4Lij4Lij4LihCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW5kLXRlYW0tcXVpei1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICBzaG93Q29uZmlybWF0aW9uKCLguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguIjguJrguIHguLTguIjguIHguKPguKPguKHguJnguLXguYk/IiwgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBpZih1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIpIHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lcigpOwogICAgICAgICAgICBhd2FpdCBkZWxldGVEb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpKTsKICAgICAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CiAgICAgICAgfSk7CiAgICB9KTsKfQoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBsaXN0ZW5Gb3JUZWFtUXVpelVwZGF0ZXMg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpmdW5jdGlvbiBsaXN0ZW5Gb3JUZWFtUXVpelVwZGF0ZXMoKSB7CiAgICBpZiAodW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKSB1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIoKTsKCiAgICBjb25zdCB0ZWFtUXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKTsKICAgIHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lciA9IG9uU25hcHNob3QodGVhbVF1aXpSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgaWYgKCFkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4guC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgICAgICAgICAgaWYgKHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lcikgdW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKCk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguLTguIjguIHguKPguKPguKHguKrguLTguYnguJnguKrguLjguJTguKXguIfguYHguKXguYnguKciKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjYW1lRnJvbUJsdWVwcmludCAmJiBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4siBCbHVlcHJpbnQgTWFuYWdlcgogICAgICAgICAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSBmYWxzZTsgLy8g4Lil4LmJ4Liy4LiH4LiE4Lin4Liy4Lih4LiI4LizCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4mSBhZG1pbiDguYHguJXguYjguYTguKHguYjguYTguJTguYnguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4siBQcm9qZWN0IERldGFpbAogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguYDguJvguYfguJkgc3R1ZGVudCDguYPguKvguYnguIHguKXguLHguJrguKvguJnguYnguLLguYHguKPguIEKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBkb2NTbmFwLmRhdGEoKTsKCiAgICAgICAgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4nKSB7CiAgICAgICAgICAgIGlmIChnYW1lRGF0YS5tb2RlID09PSAnZ3JvdXAnICYmIGdhbWVEYXRhLnN0YXR1cyAhPT0gJ3BvZGl1bScgJiYgZ2FtZURhdGEuc3RhdHVzICE9PSAnZmluaXNoZWQnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBncm91cHMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLmdyb3VwcyB8fCB7fSk7CiAgICAgICAgICAgICAgICBpZiAoZ3JvdXBzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxGaW5pc2hlZCA9IGdyb3Vwcy5ldmVyeShnID0+IGcuaXNGaW5pc2hlZCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFsbEZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEdyb3VwTW9kZUdhbWUoY3VycmVudFRlYW1RdWl6SWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVBZG1pblRlYW1EYXNoYm9hcmQoZ2FtZURhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChnYW1lRGF0YS5zdGF0dXMgPT09ICdwb2RpdW0nIHx8IGdhbWVEYXRhLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgICAgICAgICAgaWYgKHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lcikgdW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKCk7CiAgICAgICAgICAgICAgICBkaXNwbGF5VGVhbVF1aXpGaW5hbFJlc3VsdHMoKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lRGF0YS5tb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBteUdyb3VwID0gZ2FtZURhdGEuZ3JvdXBzW3VzZXJJZF07CiAgICAgICAgICAgICAgICBpZiAoIW15R3JvdXAgfHwgIW15R3JvdXAuaXNGaW5pc2hlZCkgewogICAgICAgICAgICAgICAgICAgICByZW5kZXJUZWFtUXVpelF1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKfQoKLyoqCiAqIFtIZWxwZXIgRnVuY3Rpb25dIOC4quC4seC5iOC4h+C4iOC4muC5gOC4geC4oeC4quC4s+C4q+C4o+C4seC4miBHcm91cCBNb2RlIChBZG1pbiBvbmx5KQogKi8KYXN5bmMgZnVuY3Rpb24gZW5kR3JvdXBNb2RlR2FtZShnYW1lSWQpIHsKICAgIGNvbnNvbGUubG9nKCJBbGwgZ3JvdXBzIGhhdmUgZmluaXNoZWQuIEVuZGluZyBnYW1lLiIpOwogICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGdhbWVJZCk7CiAgICB0cnkgewoJCgkgICAgICAgIGNvbnN0IGdhbWVTbmFwID0gYXdhaXQgZ2V0RG9jKGdhbWVSZWYpOwogICAgICAgIGlmIChnYW1lU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICBjb25zdCBmaW5hbEdhbWVEYXRhID0gZ2FtZVNuYXAuZGF0YSgpOwogICAgICAgICAgICBpZiAoZmluYWxHYW1lRGF0YS5zaG91bGRTYXZlUmVzdWx0cykgewogICAgICAgICAgICAgICAgYXdhaXQgc2F2ZUdhbWVSZXN1bHRzQXNTdWJtaXNzaW9ucyhmaW5hbEdhbWVEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJnguKrguJbguLLguJnguLDguYDguJvguYfguJkgcG9kaXVtIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4l+C4uOC4geC4hOC4meC5gOC4q+C5h+C4meC4q+C4meC5ieC4suC4quC4o+C4uOC4m+C4nOC4pQogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBlbmQgZ3JvdXAgbW9kZSBnYW1lOiIsIGVycm9yKTsKICAgIH0KfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSB1cGRhdGVBZG1pblRlYW1EYXNoYm9hcmQg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApmdW5jdGlvbiB1cGRhdGVBZG1pblRlYW1EYXNoYm9hcmQoZ2FtZURhdGEpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWFtLXBsYXllci1zdGF0dXMtZ3JpZCcpOwogICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKCiAgICBjb25zdCBtb2RlID0gZ2FtZURhdGEubW9kZSB8fCAndGVhbSc7CiAgICBjb25zdCB0b3RhbFF1ZXN0aW9ucyA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoOwoKICAgIGlmIChtb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgY29uc3QgZ3JvdXBzID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5ncm91cHMgfHwge30pOwogICAgICAgIGlmIChncm91cHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtY3lhbi0yMDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4geC4peC4uOC5iOC4oeC5gOC4guC5ieC4suC4o+C5iOC4p+C4oS4uLjwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gW1NUQVJUXSDguKrguYjguKfguJnguYHguIHguYnguYTguILguKrguLPguKvguKPguLHguJogR3JvdXAgTW9kZSAtLS0KICAgICAgICBjb25zdCBzb3J0ZWRHcm91cHMgPSBbLi4uZ3JvdXBzXS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICAgICAgY29uc3QgZ3JvdXBTY29yZXNIdG1sID0gc29ydGVkR3JvdXBzLm1hcCgoZywgaW5kZXgpID0+IHsKICAgICAgICAgICAgLy8gMS4g4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiB4Lil4Li44LmI4Lih4LiZ4Li14LmJ4LiV4Lit4Lia4LmE4Lib4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uc0Fuc3dlcmVkID0gZy5hbnN3ZXJzPy5sZW5ndGggfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIOC4quC4o+C5ieC4suC4hyBIVE1MIOC4nuC4o+C5ieC4reC4oeC5geC4quC4lOC4h+C4hOC4p+C4suC4oeC4hOC4t+C4muC4q+C4meC5ieC4sgogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmxhY2svMjAgcC0zIHJvdW5kZWQtbWQgdHJhbnNpdGlvbi1hbGwgaG92ZXI6YmctYmxhY2svNDAiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke2luZGV4ICsgMX0uIOC4geC4peC4uOC5iOC4oTogPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtY3lhbi0yMDAiPiR7Zy5tZW1iZXJzLmpvaW4oJywgJyl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTMwMCBtbC0yIj4oJHtxdWVzdGlvbnNBbnN3ZXJlZH0vJHt0b3RhbFF1ZXN0aW9uc30g4LiC4LmJ4LitKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC13aGl0ZSI+JHtnLnNjb3JlfSDguITguLDguYHguJnguJk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LmB4LiB4LmJ4LmE4LiCIC0tLQoKICAgICAgICBjb25zdCBxdWVzdGlvblN1bW1hcnlIdG1sID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgIGxldCBjb3JyZWN0R3JvdXBDb3VudCA9IDAsIGFuc3dlcmVkR3JvdXBDb3VudCA9IDA7CiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckZvclRoaXNRID0gZ3JvdXAuYW5zd2Vycz8uZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IGluZGV4KTsKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJGb3JUaGlzUSkgewogICAgICAgICAgICAgICAgICAgIGFuc3dlcmVkR3JvdXBDb3VudCsrOwogICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJGb3JUaGlzUS5pc0NvcnJlY3QpIGNvcnJlY3RHcm91cENvdW50Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zdCBpc0NvbXBsZXRlID0gYW5zd2VyZWRHcm91cENvdW50ID4gMCAmJiBhbnN3ZXJlZEdyb3VwQ291bnQgPT09IGdyb3Vwcy5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGNhcmRDbGFzcyA9IGlzQ29tcGxldGUgPyAnYmctZ3JlZW4tMjAwIHRleHQtZ3JlZW4tOTAwIGZvbnQtYm9sZCcgOiAnYmctYmxhY2svMTAnOwogICAgICAgICAgICBjb25zdCBzdGF0dXNJY29uID0gaXNDb21wbGV0ZSA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSB0ZXh0LWdyZWVuLTcwMCBtbC0xIj48L2k+JyA6ICcnOwogICAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InAtMiByb3VuZGVkLW1kICR7Y2FyZENsYXNzfSI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPjxzcGFuPuC4guC5ieC4rSAke2luZGV4ICsgMX06PC9zcGFuPjxzcGFuPiR7c3RhdHVzSWNvbn08L3NwYW4+PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtjb3JyZWN0R3JvdXBDb3VudH0vJHtncm91cHMubGVuZ3RofSDguIHguKXguLjguYjguKE8L3A+PC9kaXY+YDsKICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTQiPjxkaXY+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4LiE4Liw4LmB4LiZ4LiZ4LiB4Lil4Li44LmI4LihPC9oND48ZGl2IGNsYXNzPSJzcGFjZS15LTIgdGV4dC1sZyI+JHtncm91cFNjb3Jlc0h0bWx9PC9kaXY+PC9kaXY+PGRpdj48aDQgY2xhc3M9ImZvbnQtYm9sZCBtYi0yIj7guKrguKPguLjguJvguKPguLLguKLguILguYnguK08L2g0PjxkaXYgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTIgbGc6Z3JpZC1jb2xzLTMgZ2FwLTIiPiR7cXVlc3Rpb25TdW1tYXJ5SHRtbH08L2Rpdj48L2Rpdj48L2Rpdj5gOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8gLS0tIExvZ2ljIGZvciBUZWFtIE1vZGUgKOC5hOC4oeC5iOC4oeC4teC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4hykgLS0tCiAgICBjb25zdCByZXNwb25zZXMgPSBnYW1lRGF0YS5yZXNwb25zZXMgfHwge307CiAgICBjb25zdCBwbGF5ZXJzID0gT2JqZWN0LmtleXMocmVzcG9uc2VzKTsKICAgIGlmIChwbGF5ZXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtY3lhbi0yMDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4nOC4ueC5ieC5gOC4peC5iOC4meC5gOC4guC5ieC4suC4o+C5iOC4p+C4oS4uLjwvcD4nOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBsYXllclNjb3JlcyA9IHBsYXllcnMubWFwKG5hbWUgPT4gKHsgbmFtZSwgc2NvcmU6IHJlc3BvbnNlc1tuYW1lXS5zY29yZSB8fCAwIH0pKS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICBjb25zdCBwbGF5ZXJTY29yZXNIdG1sID0gcGxheWVyU2NvcmVzLm1hcChwID0+IHsKICAgICAgICBjb25zdCB0dXJuc1Rha2VuID0gcmVzcG9uc2VzW3AubmFtZV0/LmFuc3dlcnM/Lmxlbmd0aCB8fCAwOwogICAgICAgIGNvbnN0IHRvdGFsVHVybnNGb3JQbGF5ZXIgPSBNYXRoLmNlaWwodG90YWxRdWVzdGlvbnMgLyBwbGF5ZXJzLmxlbmd0aCk7CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgYmctYmxhY2svMjAgcC0yIHJvdW5kZWQtbWQiPjxzcGFuPiR7cC5uYW1lfSA8c3BhbiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktMzAwIj4oJHt0dXJuc1Rha2VufS8ke3RvdGFsVHVybnNGb3JQbGF5ZXJ9IOC4leC4sik8L3NwYW4+PC9zcGFuPjxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7cC5zY29yZX0g4LiE4Liw4LmB4LiZ4LiZPC9zcGFuPjwvZGl2PmA7CiAgICB9KS5qb2luKCcnKTsKICAgIGNvbnN0IHRvdGFsQW5zd2Vyc1N1Ym1pdHRlZCA9IHBsYXllcnMucmVkdWNlKChzdW0sIG5hbWUpID0+IHN1bSArIChyZXNwb25zZXNbbmFtZV0uYW5zd2Vycz8ubGVuZ3RoIHx8IDApLCAwKTsKICAgIGNvbnN0IHF1ZXN0aW9uU3VtbWFyeUh0bWwgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICBsZXQgYW5zd2VyRGF0YSA9IG51bGwsIHBsYXllck5hbWUgPSBudWxsOwogICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBwbGF5ZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IGZvdW5kQW5zd2VyID0gcmVzcG9uc2VzW25hbWVdLmFuc3dlcnM/LmZpbmQoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IGluZGV4KTsKICAgICAgICAgICAgaWYgKGZvdW5kQW5zd2VyKSB7CiAgICAgICAgICAgICAgICBhbnN3ZXJEYXRhID0gZm91bmRBbnN3ZXI7CiAgICAgICAgICAgICAgICBwbGF5ZXJOYW1lID0gbmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGlzQW5zd2VyZWQgPSAhIWFuc3dlckRhdGE7CiAgICAgICAgY29uc3QgaXNDb3JyZWN0ID0gaXNBbnN3ZXJlZCAmJiBhbnN3ZXJEYXRhLmlzQ29ycmVjdDsKICAgICAgICBjb25zdCByb3VuZEVuZEluZGV4ID0gKE1hdGguZmxvb3IoaW5kZXggLyBwbGF5ZXJzLmxlbmd0aCkgKyAxKSAqIHBsYXllcnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGlzQ29tcGxldGUgPSB0b3RhbEFuc3dlcnNTdWJtaXR0ZWQgPj0gcm91bmRFbmRJbmRleDsKICAgICAgICBjb25zdCBjYXJkQ2xhc3MgPSBpc0NvbXBsZXRlID8gJ2JnLWdyZWVuLTIwMCB0ZXh0LWdyZWVuLTkwMCcgOiAnYmctYmxhY2svMTAnOwogICAgICAgIGNvbnN0IHN0YXR1c0ljb24gPSBpc0NvbXBsZXRlID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtZ3JlZW4tNzAwIG1sLTEiPjwvaT4nIDogJyc7CiAgICAgICAgbGV0IHN1bW1hcnlUZXh0ID0gJ+C4o+C4rS4uLic7CiAgICAgICAgaWYgKGlzQW5zd2VyZWQpIHsKICAgICAgICAgICAgc3VtbWFyeVRleHQgPSBgJHtwbGF5ZXJOYW1lfSDguJXguK3guJoke2lzQ29ycmVjdCA/ICfguJbguLnguIEnIDogJ+C4nOC4tOC4lCd9YDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJwLTIgcm91bmRlZC1tZCAke2NhcmRDbGFzc30iPjxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj48c3Bhbj7guILguYnguK0gJHtpbmRleCArIDF9Ojwvc3Bhbj48c3Bhbj4ke3N0YXR1c0ljb259PC9zcGFuPjwvcD48cCBjbGFzcz0idGV4dC14cyBmb250LW5vcm1hbCI+JHtzdW1tYXJ5VGV4dH08L3A+PC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC02Ij48ZGl2PjxoNCBjbGFzcz0iZm9udC1ib2xkIG1iLTIiPuC4quC4o+C4uOC4m+C4hOC4sOC5geC4meC4meC4o+C4p+C4oSAo4Lij4Liy4Lii4Lia4Li44LiE4LiE4LilKTwvaDQ+PGRpdiBjbGFzcz0ic3BhY2UteS0xIHRleHQtbGciPiR7cGxheWVyU2NvcmVzSHRtbH08L2Rpdj48L2Rpdj48ZGl2PjxoNCBjbGFzcz0iZm9udC1ib2xkIG1iLTIiPuC4quC4o+C4uOC4m+C4o+C4suC4ouC4guC5ieC4rTwvaDQ+PGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMiBtZDpncmlkLWNvbHMtMyBnYXAtMiI+JHtxdWVzdGlvblN1bW1hcnlIdG1sfTwvZGl2PjwvZGl2PjwvZGl2PmA7Cn0KCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IFvguYDguJ7guLTguYjguKFdIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4miBUZWFtIFF1aXogKOC4neC4seC5iOC4hyBTdHVkZW50KSA9PT0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8qKgogKiDguYDguKPguLTguYjguKHguIHguKPguLDguJrguKfguJnguIHguLLguKPguYDguILguYnguLLguKPguYjguKfguKEgVGVhbSBRdWl6IChTdHVkZW50KQogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlSm9pblRlYW1RdWl6KCkgewogICAgY29uc3QgcGluID0gcHJvbXB0KCLguIHguKPguLjguJPguLLguJvguYnguK3guJnguKPguKvguLHguKogVGVhbSBRdWl6ICg0IOC4q+C4peC4seC4gSk6Iik7CiAgICBpZiAoIXBpbiB8fCBwaW4udHJpbSgpLmxlbmd0aCAhPT0gNCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguKPguKvguLHguKrguYTguKHguYjguJbguLnguIHguJXguYnguK3guIciKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBxdWl6emVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2ApOwogICAgICAgIGNvbnN0IHEgPSBxdWVyeShxdWl6emVzUmVmLCB3aGVyZSgicGluIiwgIj09IiwgcGluLnRyaW0oKSksIHdoZXJlKCJzdGF0dXMiLCAiPT0iLCAibG9iYnkiKSk7CiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpOwoKICAgICAgICBpZiAoc25hcHNob3QuZW1wdHkpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4miBUZWFtIFF1aXog4LiU4LmJ4Lin4Lii4Lij4Lir4Lix4Liq4LiZ4Li14LmJIOC4q+C4o+C4t+C4reC4geC4tOC4iOC4geC4o+C4o+C4oeC5hOC4lOC5ieC5gOC4o+C4tOC5iOC4oeC5hOC4m+C5geC4peC5ieC4pyIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBnYW1lRG9jID0gc25hcHNob3QuZG9jc1swXTsKICAgICAgICBjdXJyZW50VGVhbVF1aXpJZCA9IGdhbWVEb2MuaWQ7CiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lRG9jLmRhdGEoKTsKCiAgICAgICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54LilIFByb2plY3Qg4LmB4Lil4LiwIFF1aXog4LiX4Li14LmI4LmA4LiB4Li14LmI4Lii4Lin4LiC4LmJ4Lit4LiHCiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGdhbWVEYXRhLnByb2plY3RJZCk7CiAgICAgICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZ2FtZURhdGEucXVpeklkKTsKICAgICAgICBjb25zdCBbcHJvamVjdFNuYXAsIHF1aXpTbmFwXSA9IGF3YWl0IFByb21pc2UuYWxsKFtnZXREb2MocHJvamVjdFJlZiksIGdldERvYyhxdWl6UmVmKV0pOwoKICAgICAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpIHx8ICFxdWl6U25hcC5leGlzdHMoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5guC4m+C4o+C5gOC4iOC4hOC4q+C4o+C4t+C4reC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudFF1aXpEYXRhID0gZ2V0U2h1ZmZsZWRRdWl6KHsgaWQ6IHF1aXpTbmFwLmlkLCAuLi5xdWl6U25hcC5kYXRhKCkgfSk7CiAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBwcm9qZWN0U25hcC5kYXRhKCk7CgogICAgICAgIC8vIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4reC5gOC4peC4t+C4reC4geC4nOC4ueC5ieC5gOC4peC5iOC4mQogICAgICAgIHNob3dUZWFtUGxheWVyU2VsZWN0aW9uKHByb2plY3REYXRhLnN0dWRlbnRzLCBjdXJyZW50UXVpekRhdGEudG9waWMpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyB0ZWFtIHF1aXo6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiE4LmI4LiyIFBJTiDguJfguLXguYjguIHguLPguKXguLHguIfguIHguKPguK3guIEKbGV0IGN1cnJlbnRJbnB1dFBpbiA9ICIiOwoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4Lib4Li04LiUIE1vZGFsIOC5geC4l+C4meC4geC4suC4o+C5g+C4iuC5iSBwcm9tcHQKZnVuY3Rpb24gaGFuZGxlSm9pbkdyb3VwQWN0aXZpdHkoKSB7CiAgICBjdXJyZW50SW5wdXRQaW4gPSAiIjsgLy8g4Lij4Li14LmA4LiL4LmH4LiV4LiE4LmI4LiyCiAgICB1cGRhdGVQaW5EaXNwbGF5KCk7IC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4q+C4meC5ieC4suC4iOC4rQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpbi1lbnRyeS1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguK3guLHguJvguYDguJTguJXguKvguJnguYnguLLguIjguK0gUElOICjguIjguLjguJTguYYg4Lir4Lij4Li34LitIOC4leC4seC4p+C5gOC4peC4gikKZnVuY3Rpb24gdXBkYXRlUGluRGlzcGxheSgpIHsKICAgIGNvbnN0IGJveGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBpbi1kaWdpdC1ib3gnKTsKICAgIGJveGVzLmZvckVhY2goKGJveCwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoaW5kZXggPCBjdXJyZW50SW5wdXRQaW4ubGVuZ3RoKSB7CiAgICAgICAgICAgIGJveC50ZXh0Q29udGVudCA9IGN1cnJlbnRJbnB1dFBpbltpbmRleF07CiAgICAgICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKCdib3JkZXItaW5kaWdvLTUwMCcsICdiZy13aGl0ZScpOwogICAgICAgICAgICBib3guY2xhc3NMaXN0LnJlbW92ZSgnYm9yZGVyLWdyYXktMzAwJywgJ2JnLWdyYXktNTAnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBib3gudGV4dENvbnRlbnQgPSAiIjsKICAgICAgICAgICAgYm94LmNsYXNzTGlzdC5yZW1vdmUoJ2JvcmRlci1pbmRpZ28tNTAwJywgJ2JnLXdoaXRlJyk7CiAgICAgICAgICAgIGJveC5jbGFzc0xpc3QuYWRkKCdib3JkZXItZ3JheS0zMDAnLCAnYmctZ3JheS01MCcpOwogICAgICAgIH0KICAgIH0pOwp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguYDguKHguLfguYjguK3guIHguJTguJvguLjguYjguKHguJXguLHguKfguYDguKXguIIKYXN5bmMgZnVuY3Rpb24gaGFuZGxlUGluS2V5UHJlc3Moa2V5KSB7CiAgICBpZiAoa2V5ID09PSAnYmFja3NwYWNlJykgewogICAgICAgIGN1cnJlbnRJbnB1dFBpbiA9IGN1cnJlbnRJbnB1dFBpbi5zbGljZSgwLCAtMSk7CiAgICB9IGVsc2UgaWYgKGN1cnJlbnRJbnB1dFBpbi5sZW5ndGggPCA0KSB7CiAgICAgICAgY3VycmVudElucHV0UGluICs9IGtleTsKICAgIH0KCiAgICB1cGRhdGVQaW5EaXNwbGF5KCk7CgogICAgLy8g4LiW4LmJ4Liy4LiB4Lij4Lit4LiB4LiE4Lij4LiaIDQg4Lir4Lil4Lix4LiBIOC5g+C4q+C5ieC4quC5iOC4h+C4l+C4seC4meC4l+C4tSAoQXV0by1zdWJtaXQpCiAgICBpZiAoY3VycmVudElucHV0UGluLmxlbmd0aCA9PT0gNCkgewogICAgICAgIC8vIOC4q+C4meC5iOC4p+C4h+C5gOC4p+C4peC4suC4meC4tOC4lOC4meC4tuC4h+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4nOC4ueC5ieC5g+C4iuC5ieC5gOC4q+C5h+C4meC5gOC4peC4guC4leC4seC4p+C4quC4uOC4lOC4l+C5ieC4suC4ouC4geC5iOC4reC4mQogICAgICAgIHNldFRpbWVvdXQoYXN5bmMgKCkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGluLWVudHJ5LW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGF3YWl0IHByb2Nlc3NKb2luV2l0aFBpbihjdXJyZW50SW5wdXRQaW4pOwogICAgICAgICAgICBjdXJyZW50SW5wdXRQaW4gPSAiIjsgLy8g4Lij4Li14LmA4LiL4LmH4LiVCiAgICAgICAgICAgIHVwZGF0ZVBpbkRpc3BsYXkoKTsKICAgICAgICB9LCAzMDApOwogICAgfQp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguKrguLPguKvguKPguLHguJrguJvguKPguLDguKHguKfguKXguJzguKXguIHguLLguKPguYDguILguYnguLLguKPguYjguKfguKEgKOC4ouC5ieC4suC4oiBMb2dpYyDguYDguJTguLTguKHguKHguLLguYTguKfguYnguJfguLXguYjguJnguLXguYgpCmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NKb2luV2l0aFBpbihwaW4pIHsKICAgIGNvbnN0IHRyaW1tZWRQaW4gPSBwaW4udHJpbSgpOwogICAgc2hvd01lc3NhZ2UoIuC4geC4s+C4peC4seC4h+C4hOC5ieC4meC4q+C4suC4geC4tOC4iOC4geC4o+C4o+C4oS4uLiIpOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4LiE4LmJ4LiZ4Lir4Liy4LmD4LiZIFRlYW0gUXVpenplcwogICAgICAgIGNvbnN0IHRlYW1RdWl6emVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2ApOwogICAgICAgIGNvbnN0IHRlYW1RdWVyeSA9IHF1ZXJ5KHRlYW1RdWl6emVzUmVmLCB3aGVyZSgicGluIiwgIj09IiwgdHJpbW1lZFBpbiksIHdoZXJlKCJzdGF0dXMiLCAiPT0iLCAibG9iYnkiKSk7CiAgICAgICAgY29uc3QgdGVhbVNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyh0ZWFtUXVlcnkpOwoKICAgICAgICBpZiAoIXRlYW1TbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygi4Lie4LiaIFRlYW0gUXVpeiEiKTsKICAgICAgICAgICAgYXdhaXQgcHJvY2VlZFdpdGhUZWFtUXVpekpvaW4odGVhbVNuYXBzaG90LmRvY3NbMF0pOwogICAgICAgICAgICByZXR1cm47IAogICAgICAgIH0KCiAgICAgICAgLy8gMi4g4LiE4LmJ4LiZ4Lir4Liy4LmD4LiZIFN5bmMgR2FtZXMKICAgICAgICBjb25zdCBzeW5jR2FtZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2ApOwogICAgICAgIGNvbnN0IHN5bmNRdWVyeSA9IHF1ZXJ5KHN5bmNHYW1lc1JlZiwgd2hlcmUoInBpbiIsICI9PSIsIHRyaW1tZWRQaW4pLCB3aGVyZSgic3RhdHVzIiwgImluIiwgWyJsb2JieSIsICJxdWVzdGlvbiIsICJzdW1tYXJ5IiwgInJlc3VsdHMiXSkpOwogICAgICAgIGNvbnN0IHN5bmNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3Moc3luY1F1ZXJ5KTsKCiAgICAgICAgaWYgKCFzeW5jU25hcHNob3QuZW1wdHkpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIuC4nuC4miBTeW5jIEdhbWUhIik7CiAgICAgICAgICAgIGF3YWl0IHByb2NlZWRXaXRoU3luY1F1aXpKb2luKHN5bmNTbmFwc2hvdC5kb2NzWzBdKTsKICAgICAgICAgICAgcmV0dXJuOyAKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gMy4g4LiW4LmJ4Liy4LmE4Lih4LmI4LmA4LiI4LitCiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4geC4tOC4iOC4geC4o+C4o+C4oeC4lOC5ieC4p+C4ouC4o+C4q+C4seC4quC4meC4teC5iSDguKvguKPguLfguK3guIHguLTguIjguIHguKPguKPguKHguK3guLLguIjguYDguKPguLTguYjguKHguYTguJvguYHguKXguYnguKciKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGpvaW5pbmcgYWN0aXZpdHk6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguIrguLfguYjguK3guKHguJXguYjguK06ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gcHJvY2VlZFdpdGhUZWFtUXVpekpvaW4oZ2FtZURvYykgewogICAgY3VycmVudFRlYW1RdWl6SWQgPSBnYW1lRG9jLmlkOwogICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lRG9jLmRhdGEoKTsKICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBnYW1lRGF0YS5wcm9qZWN0SWQpOwogICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZ2FtZURhdGEucXVpeklkKTsKICAgIGNvbnN0IFtwcm9qZWN0U25hcCwgcXVpelNuYXBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2dldERvYyhwcm9qZWN0UmVmKSwgZ2V0RG9jKHF1aXpSZWYpXSk7CgogICAgaWYgKCFwcm9qZWN0U25hcC5leGlzdHMoKSB8fCAhcXVpelNuYXAuZXhpc3RzKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5guC4m+C4o+C5gOC4iOC4hOC4q+C4o+C4t+C4reC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgfQogICAgY3VycmVudFF1aXpEYXRhID0gZ2V0U2h1ZmZsZWRRdWl6KHsgaWQ6IHF1aXpTbmFwLmlkLCAuLi5xdWl6U25hcC5kYXRhKCkgfSk7CiAgICBzaG93VGVhbVBsYXllclNlbGVjdGlvbihwcm9qZWN0U25hcC5kYXRhKCkuc3R1ZGVudHMsIGN1cnJlbnRRdWl6RGF0YS50b3BpYywgZ2FtZURhdGEubW9kZSB8fCAndGVhbScpOyAvLyDguKrguYjguIcgbW9kZSDguYDguILguYnguLLguYTguJvguJTguYnguKfguKIKICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfQoKYXN5bmMgZnVuY3Rpb24gcHJvY2VlZFdpdGhTeW5jUXVpekpvaW4oZ2FtZURvYykgewogICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lRG9jLmlkOwogICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lRG9jLmRhdGEoKTsKICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGdhbWVEYXRhLnF1aXpJZCk7CiAgICBjb25zdCBxdWl6U25hcCA9IGF3YWl0IGdldERvYyhxdWl6UmVmKTsKICAgIGlmICghcXVpelNuYXAuZXhpc3RzKCkpIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAKICAgIGNvbnN0IHF1aXpEYXRhID0gcXVpelNuYXAuZGF0YSgpOwogICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHF1aXpEYXRhLnByb2plY3RJZCk7CiAgICBjb25zdCBwcm9qZWN0U25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgIGlmICghcHJvamVjdFNuYXAuZXhpc3RzKCkpIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmC4Lib4Lij4LmA4LiI4LiEIik7CiAgICAKICAgIGN1cnJlbnRRdWl6RGF0YSA9IGdhbWVEYXRhLnNodWZmbGVkUXVpejsKICAgIAogICAgc2hvd1ZpZXcoJ3N0dWRlbnQtdGVhbS1qb2luJyk7CiAgICBzaG93VGVhbVBsYXllclNlbGVjdGlvbihwcm9qZWN0U25hcC5kYXRhKCkuc3R1ZGVudHMsIHF1aXpEYXRhLnRvcGljLCAnc3luYycpOyAvLyDguKrguYjguIcgbW9kZSAnc3luYycg4LmA4LiC4LmJ4Liy4LmE4LibCiAgICAKICAgIC8vIC0tLSBbIFNUQVJUOiDguJnguLXguYjguITguLfguK3guKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgQnVnIExpc3RlbmVyIOC4l+C4seC4muC4i+C5ieC4reC4mSBdIC0tLQogICAgCiAgICAvLyAxLiDguITguYnguJnguKvguLLguJvguLjguYjguKHguYDguJTguLTguKEKICAgIGNvbnN0IG9sZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXRlYW0tcGxheWVycy1idG4nKTsKICAgIAogICAgLy8gMi4g4LmC4LiE4Lil4LiZ4Lib4Li44LmI4LihICjguIHguLLguKPguYLguITguKXguJnguIjguLDguKXguJogRXZlbnQgTGlzdGVuZXJzIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4l+C4teC5iOC4leC4tOC4lOC4oeC4suC4geC4seC4muC4m+C4uOC5iOC4oeC5gOC4geC5iOC4sikKICAgIGNvbnN0IG5ld0J0biA9IG9sZEJ0bi5jbG9uZU5vZGUodHJ1ZSk7CiAgICAKICAgIC8vIDMuIOC4meC4s+C4m+C4uOC5iOC4oeC5g+C4q+C4oeC5iCAo4LiX4Li14LmI4Liq4Liw4Lit4Liy4LiU4LmB4Lil4LmJ4LinKSDguYTguJvguYHguJfguJnguJfguLXguYjguJvguLjguYjguKHguYDguIHguYjguLLguYPguJnguKvguJnguYnguLLguYDguKfguYfguJoKICAgIG9sZEJ0bi5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChuZXdCdG4sIG9sZEJ0bik7CiAgICAKICAgIC8vIDQuIOC4nOC4ueC4gSBFdmVudCBMaXN0ZW5lciDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKOC5gOC4nuC4teC4ouC4h+C4reC4seC4meC5gOC4lOC4teC4ouC4pykg4LmD4Lir4LmJ4LiB4Lix4Lia4Lib4Li44LmI4Lih4LmD4Lir4Lih4LmICiAgICBuZXdCdG4ub25jbGljayA9IGNvbmZpcm1BbmRKb2luU3luY0dhbWU7IAogICAgCiAgICAvLyAtLS0gWyBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4giBdIC0tLQoKICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIHBvcC11cCAi4LiB4Liz4Lil4Lix4LiH4LiE4LmJ4LiZ4Lir4LiyIgp9CgpmdW5jdGlvbiBnZXRDbGVhbkFwcGxpY2F0aW9uSFRNTCgpIHsKICAgIGNvbnN0IGFwcGxpY2F0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcGxpY2F0aW9uQ29udGVudCcpOwogICAgaWYgKCFhcHBsaWNhdGlvbkNvbnRhaW5lcikgcmV0dXJuICcnOwoKICAgIC8vIOC4quC4o+C5ieC4suC4h+C4quC4s+C5gOC4meC4suC4guC4reC4hyBFbGVtZW50IOC4guC4tuC5ieC4meC4oeC4suC5g+C4meC4q+C4meC5iOC4p+C4ouC4hOC4p+C4suC4oeC4iOC4syDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguIHguKPguLDguJfguJrguKvguJnguYnguLLguIjguK3guJfguLXguYjguJzguLnguYnguYPguIrguYnguYDguKvguYfguJnguK3guKLguLnguYgKICAgIGNvbnN0IGNsb25lID0gYXBwbGljYXRpb25Db250YWluZXIuY2xvbmVOb2RlKHRydWUpOwoKICAgIC8vIOC4hOC5ieC4meC4q+C4suC4m+C4uOC5iOC4oeC4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4meC4quC4s+C5gOC4meC4siDguYHguKXguYnguKfguKXguYnguLLguIfguKrguJbguLLguJnguLDguK3guK3guIEKICAgIGNsb25lLnF1ZXJ5U2VsZWN0b3JBbGwoJy5hcHBsaWNhdGlvbi1vcHRpb25zIGJ1dHRvbicpLmZvckVhY2goYnV0dG9uID0+IHsKICAgICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnY29ycmVjdCcsICdpbmNvcnJlY3QnKTsKICAgICAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0pOwoKICAgIC8vIOC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBIVE1MIOC4l+C4teC5iOC4quC4sOC4reC4suC4lOC5geC4peC5ieC4pwogICAgcmV0dXJuIGNsb25lLmlubmVySFRNTDsKfQoKZnVuY3Rpb24gc2hvd1RlYW1QbGF5ZXJTZWxlY3Rpb24oc3R1ZGVudHMsIHRvcGljLCBtb2RlID0gJ3RlYW0nKSB7CiAgICBzdHVkZW50SW5pdGlhbFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50Sm9pbkdhbWVWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtdGVhbS1zZWxlY3Rpb24tdmlldycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIOC4o+C4teC5gOC4i+C5h+C4leC4peC4s+C4lOC4seC4muC4geC4suC4o+C5gOC4peC4t+C4reC4geC4l+C4uOC4geC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC5gOC4m+C4tOC4lOC4q+C4meC5ieC4suC4meC4teC5iQogICAgb3JkZXJlZFBsYXllclNlbGVjdGlvbiA9IFtdOwoKICAgIGxldCBtb2RlVGl0bGUgPSAnVGVhbSBRdWl6JzsgCiAgICBpZiAobW9kZSA9PT0gJ2dyb3VwJykgewogICAgICAgIG1vZGVUaXRsZSA9ICdHcm91cCBNb2RlJzsKICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gJ3N5bmMnKSB7CiAgICAgICAgbW9kZVRpdGxlID0gJ1N5bmMgTW9kZSc7CiAgICB9CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVhbS1xdWl6LXRvcGljJykudGV4dENvbnRlbnQgPSBgJHttb2RlVGl0bGV9OiAke3RvcGljfWA7CgogICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWFtLXN0dWRlbnQtbGlzdCcpOwogICAgaWYgKCFzdHVkZW50cyB8fCBzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBsaXN0Q29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1ncmF5LTUwMCI+4LmC4Lib4Lij4LmA4LiI4LiE4LiZ4Li14LmJ4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZPC9wPic7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tdGVhbS1wbGF5ZXJzLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8g4Liq4Lij4LmJ4Liy4LiH4Lij4Liy4Lii4LiB4Liy4Lij4Lie4Lij4LmJ4Lit4LihIEJhZGdlIOC4quC4s+C4q+C4o+C4seC4muC5geC4quC4lOC4h+C5gOC4peC4guC4peC4s+C4lOC4seC4miAo4LiL4LmI4Lit4LiZ4LmE4Lin4LmJ4LiB4LmI4Lit4LiZKQogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzdHVkZW50cy5tYXAobmFtZSA9PiBgCiAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctZ3JheS0xMDAgY3Vyc29yLXBvaW50ZXIgYm9yZGVyIGJvcmRlci10cmFuc3BhcmVudCBob3Zlcjpib3JkZXItZ3JheS0yMDAgdHJhbnNpdGlvbi1hbGwgc2VsZWN0LW5vbmUiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9InRlYW1fcGxheWVyIiB2YWx1ZT0iJHtuYW1lfSIgY2xhc3M9ImgtNSB3LTUgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1jeWFuLTYwMCBmb2N1czpyaW5nLWN5YW4tNTAwIG1yLTMiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtbGcgdGV4dC1ncmF5LTcwMCI+JHtuYW1lfTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJvcmRlci1iYWRnZSBiZy1pbmRpZ28tNjAwIHRleHQtd2hpdGUgdGV4dC14cyBmb250LWJvbGQgcHgtMiBweS0xIHJvdW5kZWQtZnVsbCBoaWRkZW4gc2hhZG93LXNtIj48L3NwYW4+CiAgICAgICAgPC9sYWJlbD4KICAgIGApLmpvaW4oJycpOwogICAgCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS10ZWFtLXBsYXllcnMtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTsKCiAgICAvLyDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4LiB4Lix4LiaIENoZWNrYm94IOC4l+C4uOC4geC4leC4seC4pwogICAgY29uc3QgY2hlY2tib3hlcyA9IGxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZT0idGVhbV9wbGF5ZXIiXScpOwogICAgY2hlY2tib3hlcy5mb3JFYWNoKGNiID0+IHsKICAgICAgICBjYi5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICBjb25zdCB2YWwgPSBlLnRhcmdldC52YWx1ZTsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4peC4t+C4reC4gSAtPiDguYDguJ7guLTguYjguKHguJXguYjguK3guJfguYnguLLguKLguYPguJnguK3guLLguYDguKPguKLguYwKICAgICAgICAgICAgICAgIGlmICghb3JkZXJlZFBsYXllclNlbGVjdGlvbi5pbmNsdWRlcyh2YWwpKSB7CiAgICAgICAgICAgICAgICAgICAgb3JkZXJlZFBsYXllclNlbGVjdGlvbi5wdXNoKHZhbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguYDguK3guLLguK3guK3guIEgLT4g4Lil4Lia4Lit4Lit4LiB4LiI4Liy4LiB4Lit4Liy4LmA4Lij4Lii4LmMCiAgICAgICAgICAgICAgICBvcmRlcmVkUGxheWVyU2VsZWN0aW9uID0gb3JkZXJlZFBsYXllclNlbGVjdGlvbi5maWx0ZXIocCA9PiBwICE9PSB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOC4reC4seC4m+C5gOC4lOC4leC4leC4seC4p+C5gOC4peC4guC4peC4s+C4lOC4seC4muC4muC4meC4q+C4meC5ieC4suC4iOC4rQogICAgICAgICAgICB1cGRhdGVTZWxlY3Rpb25PcmRlclZpc3VhbHMobGlzdENvbnRhaW5lcik7CiAgICAgICAgfSk7CiAgICB9KTsKfQoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiK4LmI4Lin4Lii4LmB4Liq4LiU4LiH4LiV4Lix4Lin4LmA4Lil4LiC4Lil4Liz4LiU4Lix4LiaCmZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbk9yZGVyVmlzdWFscyhjb250YWluZXIpIHsKICAgIGNvbnN0IGNoZWNrYm94ZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbbmFtZT0idGVhbV9wbGF5ZXIiXScpOwogICAgY2hlY2tib3hlcy5mb3JFYWNoKGNiID0+IHsKICAgICAgICBjb25zdCBsYWJlbCA9IGNiLmNsb3Nlc3QoJ2xhYmVsJyk7CiAgICAgICAgY29uc3QgYmFkZ2UgPSBsYWJlbC5xdWVyeVNlbGVjdG9yKCcub3JkZXItYmFkZ2UnKTsKICAgICAgICAKICAgICAgICBpZiAoY2IuY2hlY2tlZCkgewogICAgICAgICAgICAvLyDguKvguLLguKfguYjguLLguIrguLfguYjguK3guJnguLXguYnguK3guKLguLnguYjguK3guLHguJnguJTguLHguJrguJfguLXguYjguYDguJfguYjguLLguYTguKvguKPguYjguYPguJnguK3guLLguYDguKPguKLguYwKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBvcmRlcmVkUGxheWVyU2VsZWN0aW9uLmluZGV4T2YoY2IudmFsdWUpOwogICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICBiYWRnZS50ZXh0Q29udGVudCA9IGDguITguJnguJfguLXguYggJHtpbmRleCArIDF9YDsKICAgICAgICAgICAgICAgIGJhZGdlLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiHIGxhYmVsIOC5g+C4q+C5ieC4lOC4uSBhY3RpdmUKICAgICAgICAgICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ2JnLWluZGlnby01MCcsICdib3JkZXItaW5kaWdvLTIwMCcpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYmFkZ2UuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGxhYmVsLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWluZGlnby01MCcsICdib3JkZXItaW5kaWdvLTIwMCcpOwogICAgICAgIH0KICAgIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBjb25maXJtQW5kU3RhcnRUZWFtUXVpeigpIHsKICAgIC8vIOC5g+C4iuC5ieC4o+C4suC4ouC4iuC4t+C5iOC4reC4iOC4suC4geC4leC4seC4p+C5geC4m+C4o+C4l+C4teC5iOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC5hOC4p+C5ieC5geC4peC5ieC4pwogICAgY29uc3Qgc2VsZWN0ZWRQbGF5ZXJzID0gWy4uLm9yZGVyZWRQbGF5ZXJTZWxlY3Rpb25dOwoKICAgIGlmIChzZWxlY3RlZFBsYXllcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4nOC4ueC5ieC5gOC4peC5iOC4meC4reC4ouC5iOC4suC4h+C4meC5ieC4reC4oiAxIOC4hOC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8g4Lij4Li14LmA4LiL4LmH4LiV4LiV4Lix4Lin4LiZ4Lix4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICBsb2NhbFRlYW1QbGF5ZXJzID0gc2VsZWN0ZWRQbGF5ZXJzOyAvLyDguKXguLPguJTguLHguJrguYPguJnguJnguLXguYnguIjguLDguIHguLPguKvguJnguJTguKXguLPguJTguLHguJrguIHguLLguKPguYDguKXguYjguJkKICAgIGxvY2FsUXVlc3Rpb25JbmRleCA9IDA7CiAgICBsb2NhbFBsYXllckluZGV4ID0gMDsKCQogICAgY29uc3QgdGVhbVF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvdGVhbVF1aXp6ZXNgLCBjdXJyZW50VGVhbVF1aXpJZCk7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGdhbWVTbmFwID0gYXdhaXQgZ2V0RG9jKHRlYW1RdWl6UmVmKTsKICAgICAgICBpZiAoIWdhbWVTbmFwLmV4aXN0cygpKSB0aHJvdyBuZXcgRXJyb3IoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5gOC4geC4oSIpOwogICAgICAgIGNvbnN0IGdhbWVEYXRhID0gZ2FtZVNuYXAuZGF0YSgpOwoKICAgICAgICBpZiAoZ2FtZURhdGEubW9kZSA9PT0gJ2dyb3VwJykgewogICAgICAgICAgICBjb25zdCBncm91cFBheWxvYWQgPSB7IFtgZ3JvdXBzLiR7dXNlcklkfWBdOiB7IG1lbWJlcnM6IGxvY2FsVGVhbVBsYXllcnMsIHNjb3JlOiAwLCBhbnN3ZXJzOiBbXSB9IH07CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyh0ZWFtUXVpelJlZiwgZ3JvdXBQYXlsb2FkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBpbml0aWFsUmVzcG9uc2VzID0gZ2FtZURhdGEucmVzcG9uc2VzIHx8IHt9OwogICAgICAgICAgICBsb2NhbFRlYW1QbGF5ZXJzLmZvckVhY2gobmFtZSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWluaXRpYWxSZXNwb25zZXNbbmFtZV0pIHsKICAgICAgICAgICAgICAgICAgICBpbml0aWFsUmVzcG9uc2VzW25hbWVdID0geyBzY29yZTogMCwgYW5zd2VyczogW10gfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyh0ZWFtUXVpelJlZiwgeyByZXNwb25zZXM6IGluaXRpYWxSZXNwb25zZXMgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXRlYW0tc2VsZWN0aW9uLXZpZXcnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICByZW5kZXJUZWFtUXVpelF1ZXN0aW9uKCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgZ2FtZVN0YXRlID0geyBnYW1lSWQ6IGN1cnJlbnRUZWFtUXVpeklkLCBtb2RlOiBnYW1lRGF0YS5tb2RlIHx8ICd0ZWFtJywgcGxheWVyczogbG9jYWxUZWFtUGxheWVycywgdHVybkluZGV4OiAwIH07CiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nLCBKU09OLnN0cmluZ2lmeShnYW1lU3RhdGUpKTsKICAgICAgICBsaXN0ZW5Gb3JUZWFtUXVpelVwZGF0ZXMoKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNvbmZpcm1pbmcgcGxheWVyczoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4ouC4t+C4meC4ouC4seC4meC4nOC4ueC5ieC5gOC4peC5iOC4mSIpOwogICAgfQp9CgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclRlYW1RdWl6UXVlc3Rpb24g4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiByZW5kZXJUZWFtUXVpelF1ZXN0aW9uKCkgewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiX4Liz4LiE4Lij4Lia4LiX4Li44LiB4LiC4LmJ4Lit4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICBpZiAobG9jYWxRdWVzdGlvbkluZGV4ID49IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgZGlzcGxheVRlYW1RdWl6RmluYWxSZXN1bHRzKCk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguJTguLbguIfguILguYnguK3guKHguLnguKXguITguLPguJbguLLguKHguYHguKXguLDguJzguLnguYnguYDguKXguYjguJnguJXguLLguKHguKPguK3guJrguJvguLHguIjguIjguLjguJrguLHguJkKICAgIGNvbnN0IHEgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2xvY2FsUXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBjdXJyZW50UGxheWVyTmFtZSA9IGxvY2FsVGVhbVBsYXllcnNbbG9jYWxQbGF5ZXJJbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgcXVlc3Rpb25UZXh0SFRNTCA9IHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dDsKICAgIGxldCBvcHRpb25zSFRNTCA9ICcnOwoKICAgIC8vICjguKrguYjguKfguJkgc3dpdGNoIGNhc2Ug4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lij4LmJ4Liy4LiHIG9wdGlvbnMg4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgc3dpdGNoIChxdWVzdGlvblR5cGUpIHsKICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOiBjYXNlICdmaWxsX2luX3dpdGhfY2hvaWNlcyc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gcS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgPGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJ0ZWFtX29wdCR7aX0iIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0iJHtpfSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdCR7aX0iPiR7b3B0fTwvbGFiZWw+PC9kaXY+YCkuam9pbignJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InRlYW1fb3B0X3RydWUiIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0idHJ1ZSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdF90cnVlIj7guYPguIrguYggLyDguJbguLnguIE8L2xhYmVsPjwvZGl2PjxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0idGVhbV9vcHRfZmFsc2UiIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0iZmFsc2UiIGNsYXNzPSJtci0yIGFjY2VudC1jeWFuLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0idGVhbV9vcHRfZmFsc2UiPuC5hOC4oeC5iOC5g+C4iuC5iCAvIOC4nOC4tOC4lDwvbGFiZWw+PC9kaXY+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzogY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBgPHRleHRhcmVhIG5hbWU9InRlYW1fYW5zd2VyIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJvd3M9IjMiIHJlcXVpcmVkIHBsYWNlaG9sZGVyPSLguJ7guLTguKHguJ7guYzguITguLPguJXguK3guJrguILguK3guIfguITguLjguJMuLi4iPjwvdGV4dGFyZWE+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxzZWxlY3QgbmFtZT0idGVhbV9hbnN3ZXIiIGNsYXNzPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyIgcmVxdWlyZWQ+PG9wdGlvbiB2YWx1ZT0iIj4tLSDguYDguKXguLfguK3guIHguITguLPguJXguK3guJrguJfguLXguYjguITguLnguYjguIHguLHguJkgLS08L29wdGlvbj4ke3EuYWxsUmVzcG9uc2VzLm1hcChyZXNwID0+IGA8b3B0aW9uIHZhbHVlPSIke3Jlc3B9Ij4ke3Jlc3B9PC9vcHRpb24+YCkuam9pbignJyl9PC9zZWxlY3Q+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSAnPHAgY2xhc3M9InRleHQtcmVkLTUwMCI+4LmE4Lih4LmI4Lij4Li54LmJ4LiI4Lix4LiB4Lib4Lij4Liw4LmA4Lig4LiX4LiC4Lit4LiH4LiE4Liz4LiW4Liy4Lih4LiZ4Li14LmJPC9wPic7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0icC00IGZhZGUtaW4iPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIj7guILguYnguK3guJfguLXguYggJHtsb2NhbFF1ZXN0aW9uSW5kZXggKyAxfSAvICR7Y3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGh9PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIHRleHQtY3lhbi03MDAgbXktMiI+4LiV4Liy4LiC4Lit4LiHOiAke2N1cnJlbnRQbGF5ZXJOYW1lfTwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXktNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb250LXNlbWlib2xkIG1iLTMiPgogICAgICAgICAgICAgICAgICAgIDxwPiR7bG9jYWxRdWVzdGlvbkluZGV4ICsgMX0uICR7cXVlc3Rpb25UZXh0SFRNTH08L3A+CiAgICAgICAgICAgICAgICAgICAgJHtxLmltYWdlQ29kZSA/IGA8ZGl2IGNsYXNzPSJteS00IGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTIgdGV4dC1sZyI+JHtvcHRpb25zSFRNTH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InN1Ym1pdC10ZWFtLWFuc3dlci1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctY3lhbi02MDAgdGV4dC13aGl0ZSBweS0zIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLWN5YW4tNzAwIj7guKrguYjguIfguITguLPguJXguK3guJo8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UXVpekFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW3N0dWRlbnRRdWl6QXJlYV0pOwogICAgCiAgICAvLyDguYDguKPguLLguIjguLDguYPguIrguYkgaGFuZGxlVGVhbUFuc3dlclN1Ym1pdCDguKrguLPguKvguKPguLHguJrguJfguLHguYnguIcgVGVhbSDguYHguKXguLAgR3JvdXAgTW9kZSDguYDguJ7guKPguLLguLAgR3JvdXAgTW9kZSDguKHguLUgTG9naWMg4LmB4Lii4LiB4Lit4Lii4Li54LmI4LiC4LmJ4Liy4LiH4LmD4LiZ4LmB4Lil4LmJ4LinCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VibWl0LXRlYW0tYW5zd2VyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVGVhbUFuc3dlclN1Ym1pdCk7Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlR3JvdXBBbnN3ZXJTdWJtaXQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBoYW5kbGVHcm91cEFuc3dlclN1Ym1pdCgpIHsKICAgIGNvbnN0IHEgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2xvY2FsUXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgdXNlckFuc3dlciA9IG51bGw7CiAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CgogICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGV4dGFyZWFbbmFtZT0idGVhbV9hbnN3ZXIiXScpOwogICAgICAgIGlmICghdGV4dGFyZWEgfHwgIXRleHRhcmVhLnZhbHVlLnRyaW0oKSkgeyBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiB4Lil4Li44LmI4LihIik7IHJldHVybjsgfQogICAgICAgIHVzZXJBbnN3ZXIgPSB0ZXh0YXJlYS52YWx1ZS50cmltKCk7CiAgICAgICAgaXNDb3JyZWN0ID0gYXdhaXQgZ3JhZGVTaG9ydEFuc3dlcih1c2VyQW5zd2VyLCBxKTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPSJ0ZWFtX2Fuc3dlciJdOmNoZWNrZWQsIHNlbGVjdFtuYW1lPSJ0ZWFtX2Fuc3dlciJdJyk7CiAgICAgICAgaWYgKCFzZWxlY3RlZElucHV0IHx8IHNlbGVjdGVkSW5wdXQudmFsdWUgPT09ICIiKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguITguLPguJXguK3guJrguILguK3guIfguIHguKXguLjguYjguKEiKTsgcmV0dXJuOyB9CiAgICAgICAgdXNlckFuc3dlciA9IHNlbGVjdGVkSW5wdXQudmFsdWU7CiAgICAgICAgc3dpdGNoKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzogaXNDb3JyZWN0ID0gKCh1c2VyQW5zd2VyID09PSAndHJ1ZScpID09PSBxLmNvcnJlY3RBbnN3ZXIpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6IGlzQ29ycmVjdCA9ICh1c2VyQW5zd2VyID09PSBxLmNvcnJlY3RSZXNwb25zZSk7IGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OiBpc0NvcnJlY3QgPSAocGFyc2VJbnQodXNlckFuc3dlcikgPT09IHEuY29ycmVjdEFuc3dlckluZGV4KTsgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IGFuc3dlclJlY29yZCA9IHsgcXVlc3Rpb25JbmRleDogbG9jYWxRdWVzdGlvbkluZGV4LCBpc0NvcnJlY3Q6IGlzQ29ycmVjdCB9OwogICAgY29uc3QgZ3JvdXBJZCA9IHVzZXJJZDsKICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7CiAgICAgICAgW2Bncm91cHMuJHtncm91cElkfS5hbnN3ZXJzYF06IGFycmF5VW5pb24oYW5zd2VyUmVjb3JkKQogICAgfTsKICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICB1cGRhdGVQYXlsb2FkW2Bncm91cHMuJHtncm91cElkfS5zY29yZWBdID0gaW5jcmVtZW50KDEpOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvdGVhbVF1aXp6ZXNgLCBjdXJyZW50VGVhbVF1aXpJZCksIHVwZGF0ZVBheWxvYWQpOwogICAgICAgIAogICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4m+C4peC4teC5iOC4ouC4meC5hOC4m+C5g+C4iuC5ieC4leC4seC4p+C5geC4m+C4o+C4geC4peC4suC4hyDguYHguKXguLDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICBsb2NhbFF1ZXN0aW9uSW5kZXgrKzsKICAgICAgICAKICAgICAgICBpZiAobG9jYWxRdWVzdGlvbkluZGV4ID49IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgIGRpc3BsYXlUZWFtUXVpekZpbmFsUmVzdWx0cygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlbmRlckdyb3VwTW9kZVF1ZXN0aW9uKCk7IC8vIOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5geC4quC4lOC4h+C4nOC4peC4quC4s+C4q+C4o+C4seC4miBHcm91cCBNb2RlIOC5guC4lOC4ouC5gOC4ieC4nuC4suC4sAogICAgICAgIH0KICAgICAgICAKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzdWJtaXR0aW5nIGdyb3VwIGFuc3dlcjoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4quC5iOC4h+C4hOC4s+C4leC4reC4miIpOwogICAgfQp9CgoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVUZWFtQW5zd2VyU3VibWl0IOC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVGVhbUFuc3dlclN1Ym1pdCgpIHsKICAgIGNvbnN0IGdhbWVTbmFwID0gYXdhaXQgZ2V0RG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKSk7CiAgICBpZiAoIWdhbWVTbmFwLmV4aXN0cygpKSByZXR1cm47CiAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVTbmFwLmRhdGEoKTsKCiAgICAvLyDguJbguYnguLLguYDguJvguYfguJkgR3JvdXAgTW9kZSDguYPguKvguYnguYTguJvguYPguIrguYkgTG9naWMg4LmA4LiU4Li04Lih4LiC4Lit4LiHIEdyb3VwIE1vZGUKICAgIGlmIChnYW1lRGF0YS5tb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgaGFuZGxlR3JvdXBBbnN3ZXJTdWJtaXQoKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIExvZ2ljIOC5g+C4q+C4oeC5iOC4quC4s+C4q+C4o+C4seC4miBUZWFtIE1vZGUgKOC4l+C4uOC4geC4hOC4meC4leC4reC4muC4l+C4uOC4geC4guC5ieC4rSkgLS0tCiAgICBjb25zdCBjdXJyZW50UGxheWVyTmFtZSA9IGxvY2FsVGVhbVBsYXllcnNbbG9jYWxQbGF5ZXJJbmRleF07CiAgICBjb25zdCBxID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1tsb2NhbFF1ZXN0aW9uSW5kZXhdOwogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgbGV0IHVzZXJBbnN3ZXIgPSBudWxsOwogICAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOwoKICAgIC8vICjguKrguYjguKfguJnguJXguKPguKfguIjguITguLPguJXguK3guJrguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtuYW1lPSJ0ZWFtX2Fuc3dlciJdJyk7CiAgICAgICAgaWYgKCF0ZXh0YXJlYSB8fCAhdGV4dGFyZWEudmFsdWUudHJpbSgpKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguJ7guLTguKHguJ7guYzguITguLPguJXguK3guJoiKTsgcmV0dXJuOyB9CiAgICAgICAgdXNlckFuc3dlciA9IHRleHRhcmVhLnZhbHVlLnRyaW0oKTsKICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKHVzZXJBbnN3ZXIsIHEpOyAKICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tuYW1lPSJ0ZWFtX2Fuc3dlciJdOmNoZWNrZWQsIHNlbGVjdFtuYW1lPSJ0ZWFtX2Fuc3dlciJdJyk7CiAgICAgICAgaWYgKCFzZWxlY3RlZElucHV0IHx8IHNlbGVjdGVkSW5wdXQudmFsdWUgPT09ICIiKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguITguLPguJXguK3guJoiKTsgcmV0dXJuOyB9CiAgICAgICAgdXNlckFuc3dlciA9IHNlbGVjdGVkSW5wdXQudmFsdWU7CiAgICAgICAgc3dpdGNoKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzogaXNDb3JyZWN0ID0gKCh1c2VyQW5zd2VyID09PSAndHJ1ZScpID09PSBxLmNvcnJlY3RBbnN3ZXIpOyBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6IGlzQ29ycmVjdCA9ICh1c2VyQW5zd2VyID09PSBxLmNvcnJlY3RSZXNwb25zZSk7IGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OiBpc0NvcnJlY3QgPSAocGFyc2VJbnQodXNlckFuc3dlcikgPT09IHEuY29ycmVjdEFuc3dlckluZGV4KTsgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IGFuc3dlclJlY29yZCA9IHsgcXVlc3Rpb25JbmRleDogbG9jYWxRdWVzdGlvbkluZGV4LCBpc0NvcnJlY3Q6IGlzQ29ycmVjdCwgYW5zd2VyVmFsdWU6IHVzZXJBbnN3ZXIgfTsKICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7IFtgcmVzcG9uc2VzLiR7Y3VycmVudFBsYXllck5hbWV9LmFuc3dlcnNgXTogYXJyYXlVbmlvbihhbnN3ZXJSZWNvcmQpIH07CiAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgdXBkYXRlUGF5bG9hZFtgcmVzcG9uc2VzLiR7Y3VycmVudFBsYXllck5hbWV9LnNjb3JlYF0gPSBpbmNyZW1lbnQoMSk7CiAgICB9CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKSwgdXBkYXRlUGF5bG9hZCk7CiAgICAgICAgCiAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lil4Li34LmI4Lit4LiZ4LmE4Lib4Lii4Lix4LiH4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiE4LiZ4LiW4Lix4LiU4LmE4LibCiAgICAgICAgbG9jYWxQbGF5ZXJJbmRleCsrOwoKICAgICAgICBpZiAobG9jYWxQbGF5ZXJJbmRleCA+PSBsb2NhbFRlYW1QbGF5ZXJzLmxlbmd0aCkgewogICAgICAgICAgICAvLyDguYDguKHguLfguYjguK3guJfguLjguIHguITguJnguJXguK3guJrguILguYnguK3guJnguLXguYnguITguKPguJrguYHguKXguYnguKcg4LmD4Lir4LmJ4LiC4Li24LmJ4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmIIOC5geC4peC4sOC4o+C4teC5gOC4i+C5h+C4leC4hOC4meC4leC4reC4muC5gOC4m+C5h+C4meC4hOC4meC5geC4o+C4gQogICAgICAgICAgICBsb2NhbFF1ZXN0aW9uSW5kZXgrKzsKICAgICAgICAgICAgbG9jYWxQbGF5ZXJJbmRleCA9IDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHJlbmRlclRlYW1RdWl6UXVlc3Rpb24oKTsgLy8g4LmB4Liq4LiU4LiH4Lic4Lil4LmD4Lir4Lih4LmIICjguK3guLLguIjguIjguLDguYDguJvguYfguJnguITguJnguJbguLHguJTguYTguJvguYPguJnguILguYnguK3guYDguJTguLTguKEg4Lir4Lij4Li34Lit4LiE4LiZ4LmB4Lij4LiB4LmD4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmIKQoKICAgIH0gY2F0Y2goZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzdWJtaXR0aW5nIHRlYW0gYW5zd2VyOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgZGlzcGxheVRlYW1RdWl6RmluYWxSZXN1bHRzIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKLyoqCiAqIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4quC4o+C4uOC4m+C4nOC4peC4quC4uOC4lOC4l+C5ieC4suC4oiAo4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4LmB4LiB4LmJ4LmE4LiCOiBHcm91cCBNb2RlIOC5geC4quC4lOC4h+C4nOC4peC5gOC4ieC4nuC4suC4sOC4geC4peC4uOC5iOC4oeC4leC4seC4p+C5gOC4reC4hykKICovCmFzeW5jIGZ1bmN0aW9uIGRpc3BsYXlUZWFtUXVpekZpbmFsUmVzdWx0cygpIHsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIGNvbnN0IHRlYW1RdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpOwogICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyh0ZWFtUXVpelJlZik7CiAgICBpZiAoIWRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSBgPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LXJlZC01MDAiPuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5gOC4geC4oSDguK3guLLguIjguKrguLTguYnguJnguKrguLjguJTguYTguJvguYHguKXguYnguKc8L3A+YDsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBnYW1lRGF0YSA9IGRvY1NuYXAuZGF0YSgpOwoKICAgIGxldCBmaW5hbFNjb3JlcyA9IFtdOwogICAgY29uc3QgbW9kZSA9IGdhbWVEYXRhLm1vZGUgfHwgJ3RlYW0nOwoKICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgIGlmIChtb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgLy8gTG9naWMgZm9yIEdyb3VwIE1vZGU6IOC5geC4quC4lOC4h+C4nOC4peC5gOC4ieC4nuC4suC4sOC4hOC4sOC5geC4meC4meC4guC4reC4h+C4geC4peC4uOC5iOC4oeC4leC4seC4p+C5gOC4reC4hwogICAgICAgIGNvbnN0IG15R3JvdXBEYXRhID0gZ2FtZURhdGEuZ3JvdXBzW3VzZXJJZF07IC8vIHVzZXJJZCDguITguLfguK0gSUQg4LiC4Lit4LiH4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCiAgICAgICAgaWYgKG15R3JvdXBEYXRhKSB7CiAgICAgICAgICAgIGZpbmFsU2NvcmVzID0gW3sKICAgICAgICAgICAgICAgIG5hbWU6IGDguIHguKXguLjguYjguKE6ICR7bG9jYWxUZWFtUGxheWVycy5qb2luKCcsICcpfWAsIC8vIOC5g+C4iuC5iSBsb2NhbFRlYW1QbGF5ZXJzIOC4l+C4teC5iOC5gOC4geC5h+C4muC4iuC4t+C5iOC4reC4nOC4ueC5ieC5gOC4peC5iOC4meC5g+C4meC5gOC4hOC4o+C4t+C5iOC4reC4h+C4meC4teC5iQogICAgICAgICAgICAgICAgc2NvcmU6IG15R3JvdXBEYXRhLnNjb3JlIHx8IDAKICAgICAgICAgICAgfV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiJ4Li44LiB4LmA4LiJ4Li04LiZIOC4q+C4suC4geC4q+C4suC4guC5ieC4reC4oeC4ueC4peC4geC4peC4uOC5iOC4oeC4leC4seC4p+C5gOC4reC4h+C5hOC4oeC5iOC5gOC4iOC4rQogICAgICAgICAgICBmaW5hbFNjb3JlcyA9IFt7IG5hbWU6ICfguIHguKXguLjguYjguKHguILguK3guIfguITguLjguJMnLCBzY29yZTogJ04vQScgfV07CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAvLyBMb2dpYyBmb3IgVGVhbSBNb2RlICjguILguK3guIfguYDguJTguLTguKEpCiAgICAgICAgZmluYWxTY29yZXMgPSBsb2NhbFRlYW1QbGF5ZXJzLm1hcChuYW1lID0+ICh7CiAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgIHNjb3JlOiBnYW1lRGF0YS5yZXNwb25zZXNbbmFtZV0/LnNjb3JlIHx8IDAKICAgICAgICB9KSkuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpOwogICAgfQogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgIAogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy1jeWFuLTEwMCByb3VuZGVkLWxnIj4KICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1jeWFuLTgwMCI+4LiI4Lia4LiB4Li04LiI4LiB4Lij4Lij4Lih4LmB4Lil4LmJ4LinITwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00Ij7guKrguKPguLjguJvguITguLDguYHguJnguJk6PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTIgbXQtMiBtYXgtdy1zbSBteC1hdXRvIj4KICAgICAgICAgICAgICAgICR7ZmluYWxTY29yZXMubWFwKHJlcyA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gdGV4dC1sZyBwLTIgYmctd2hpdGUvNTAgcm91bmRlZC1tZCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+JHtyZXMubmFtZX08L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtyZXMuc2NvcmV9IOC4hOC4sOC5geC4meC4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3aW5kb3cubG9jYXRpb24ucmVsb2FkKCkiIGNsYXNzPSJtdC02IGJnLWJsdWUtNjAwIHRleHQtd2hpdGUgcHktMiBweC01IHJvdW5kZWQtbGciPuC4geC4peC4seC4muC4q+C4meC5ieC4suC5geC4o+C4gTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIAoJc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicgJiYgY3VycmVudFRlYW1RdWl6SWQpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgZGVsZXRlRG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKSk7CiAgICAgICAgfSwgMzAwMDAwKTsKICAgIH0KfQoJCQoJCWxldCBoaXN0b3J5ID0gW107CmxldCBoaXN0b3J5U3RlcCA9IC0xOwoJCWxldCBtb2RhbENvbmZpcm1BY3Rpb24gPSBudWxsOyAvLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIHguYfguJogIuC4hOC4s+C4quC4seC5iOC4h+C4nuC4tOC5gOC4qOC4qSIg4LiX4Li14LmI4LiI4Liw4LmD4Lir4LmJ4Lib4Li44LmI4LihICLguJXguIHguKXguIciIOC4l+C4s+C4h+C4suC4mQoJCWxldCBjaGVhdEF0dGVtcHRzID0gMDsKCQlsZXQgY2hlYXREZXRlY3Rpb25UaW1lb3V0ID0gbnVsbDsKY29uc3QgbWF4Q2hlYXRBdHRlbXB0cyA9IDM7IC8vIOC4geC4s+C4q+C4meC4lOC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4reC4meC4uOC4jeC4suC4leC5g+C4q+C5ieC4reC4reC4geC4iOC4suC4geC4iOC4rSAo4Lib4Lij4Lix4Lia4LmB4LiB4LmJ4LmE4LiU4LmJKQpsZXQgaXNRdWl6QWN0aXZlID0gZmFsc2U7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4iuC5h+C4hOC4p+C5iOC4suC4geC4s+C4peC4seC4h+C4l+C4s+C4guC5ieC4reC4quC4reC4muC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAoJCQoJCWxldCBnbG9iYWxEYXNoYm9hcmRTZXR0aW5ncyA9IHsKICAgIHByb2plY3RTb3J0OiAnZGF0ZV9kZXNjJywgLy8g4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCiAgICBwaW5uZWRQcm9qZWN0czogW10sICAgICAgLy8g4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCglwcm9qZWN0VmlldzogJ2dyaWQnIC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKfTsKCQkKCQkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IOC5guC4hOC5ieC4lOC4quC4s+C4q+C4o+C4seC4muC4iOC4seC4lOC4geC4suC4oyBEcm9wZG93biDguYDguIjguLLguLDguIjguIfguKvguLHguKfguILguYnguK3guITguJPguLTguJXguKjguLLguKrguJXguKPguYwgPT09Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gMS4g4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCmNvbnN0IGFsbE1hdGhUb3BpY3MgPSBbCiAgICAvLyDguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4LiZ4Lix4LiaJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKPguLDguJrguJrguYDguKXguILguYHguKXguLDguITguYjguLLguJvguKPguLDguIjguLPguKvguKXguLHguIEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4m+C4seC4lOC5gOC4qOC4qeC5geC4peC4sOC4m+C4o+C4sOC4oeC4suC4k+C4hOC5iOC4sicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Lil4Liz4LiU4Lix4Lia4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijIChQRU1EQVMpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguJrguKfguIEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4peC4micgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4LiE4Li54LiTJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguKvguLLguKMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4iOC4s+C4meC4p+C4meC5gOC4leC5h+C4oeC4muC4p+C4gScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiI4Liz4LiZ4Lin4LiZ4LmA4LiV4LmH4Lih4Lil4LiaJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKjguLnguJnguKLguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4hOC5iOC4suC4quC4seC4oeC4muC4ueC4o+C4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LmA4Liq4LmJ4LiZ4LiI4Liz4LiZ4Lin4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguJXguLHguKfguJvguKPguLDguIHguK3guJrguYHguKXguLDguJXguLHguKfguJvguKPguLDguIHguK3guJrguYDguInguJ7guLLguLAnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4qy7guKMu4LihLiAoR0NEKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiELuC4oy7guJkuIChMQ00pJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguK3guLHguJXguKPguLLguKrguYjguKfguJnguYHguKXguLDguKrguLHguJTguKrguYjguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4reC4seC4leC4o+C4suC5geC4peC4sOC4reC4seC4leC4o+C4suC4q+C4meC5iOC4p+C4oicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LmA4Lio4Lip4Liq4LmI4Lin4LiZICjguKLguYjguK0v4LiC4Lii4Liy4LiiKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lia4Lin4LiB4LmA4Lio4Lip4Liq4LmI4Lin4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguKXguJrguYDguKjguKnguKrguYjguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4hOC4ueC4k+C5gOC4qOC4qeC4quC5iOC4p+C4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lir4Liy4Lij4LmA4Lio4Lip4Liq4LmI4Lin4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIjguLPguJnguKfguJnguITguKXguLAnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4l+C4qOC4meC4tOC4ouC4oSAo4LiE4LmI4Liy4Lib4Lij4Liw4LiI4Liz4Lir4Lil4Lix4LiBKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lia4Lin4LiB4LiX4Lio4LiZ4Li04Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguKXguJrguJfguKjguJnguLTguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4hOC4ueC4k+C4l+C4qOC4meC4tOC4ouC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lir4Liy4Lij4LiX4Lio4LiZ4Li04Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguYHguJvguKXguIcg4LmA4Lio4Lip4Liq4LmI4Lin4LiZ4oaU4LiX4Lio4LiZ4Li04Lii4Lih4oaU4Lij4LmJ4Lit4Lii4Lil4LiwJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKPguYnguK3guKLguKXguLDguJ7guLfguYnguJnguJDguLLguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4m+C4o+C4seC4muC5gOC4nuC4tOC5iOC4oS/guKXguJTguYDguJvguYfguJnguKPguYnguK3guKLguKXguLAnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4quC5iOC4p+C4meC4peC4lCDguKDguLLguKnguLUg4LiB4Liz4LmE4LijIOC4guC4suC4lOC4l+C4uOC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LmA4Lil4LiC4Lii4LiB4LiB4Liz4Lil4Lix4LiHICjguIHguI4v4Lio4Li54LiZ4Lii4LmML+C4peC4miknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4o+C4suC4geC4l+C4teC5iOC4quC4reC4h+C5geC4peC4sOC4l+C4teC5iOC4quC4suC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Lij4Li54Lib4Liq4LmB4LiE4Lin4Lij4LmM4Lij4Li54LiXIChzdXJkKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Liq4Lix4LiN4LiB4Lij4LiT4LmM4Lin4Li04LiX4Lii4Liy4Lio4Liy4Liq4LiV4Lij4LmMJyB9LAogICAgLy8g4LiB4Liy4Lij4Lin4Lix4LiUCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4q+C4meC5iOC4p+C4ouC4hOC4p+C4suC4oeC4ouC4suC4p+C5geC4peC4sOC4geC4suC4o+C5geC4m+C4peC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lir4LiZ4LmI4Lin4Lii4Lih4Lin4LilL+C4meC5ieC4s+C4q+C4meC4seC4geC5geC4peC4sOC4geC4suC4o+C5geC4m+C4peC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lir4LiZ4LmI4Lin4Lii4LmA4Lin4Lil4Liy4LmB4Lil4Liw4LiB4Liy4Lij4LiE4Liz4LiZ4Lin4LiT4LmA4Lin4Lil4LiyJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguJvguKPguLTguKHguLLguJXguKMv4LiE4Lin4Liy4Lih4LiI4Li44LmB4Lil4Liw4LiB4Liy4Lij4LmB4Lib4Lil4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguK3guLjguJPguKvguKDguLnguKHguLTguYHguKXguLDguIHguLLguKPguYHguJvguKXguIcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C5gOC4quC5ieC4meC4o+C4reC4muC4o+C4ueC4mycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lie4Li34LmJ4LiZ4LiX4Li14LmI4Liq4Li14LmI4LmA4Lir4Lil4Li14LmI4Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguJ7guLfguYnguJnguJfguLXguYjguKrguLLguKHguYDguKvguKXguLXguYjguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4nuC4t+C5ieC4meC4l+C4teC5iOC4p+C4h+C4geC4peC4oS/guKrguYjguKfguJnguILguK3guIfguKfguIfguIHguKXguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4nuC4t+C5ieC4meC4l+C4teC5iOC4nOC4tOC4p+C4o+C4ueC4m+C4l+C4o+C4h+C4quC4suC4oeC4oeC4tOC4leC4tCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lib4Lij4Li04Lih4Liy4LiV4Lij4Lij4Li54Lib4LiX4Lij4LiH4Liq4Liy4Lih4Lih4Li04LiV4Li0JyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguKHguLjguKHguYHguKXguLDguIHguLLguKPguKfguLHguJTguKHguLjguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4quC5gOC4geC4peC5geC4peC4sOC5geC4nOC4meC4l+C4teC5iCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4LiE4LmI4Liy4LiE4Lil4Liy4LiU4LmA4LiE4Lil4Li34LmI4Lit4LiZ4LiC4Lit4LiH4LiB4Liy4Lij4Lin4Lix4LiUJyB9LAogICAgLy8g4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4iOC4uOC4lCDguYDguKrguYnguJkg4Lij4Liw4LiZ4Liy4LiaJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguITguKfguLLguKHguKrguLHguKHguJ7guLHguJnguJjguYzguILguK3guIfguKHguLjguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4quC4suC4oeC5gOC4q+C4peC4teC5iOC4ouC4oSAo4LiK4LiZ4Li04LiUL+C4quC4oeC4muC4seC4leC4tCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4nuC4t+C5ieC4meC4l+C4teC5iOC4quC4suC4oeC5gOC4q+C4peC4teC5iOC4ouC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LmA4LiX4LmI4Liy4LiB4Lix4LiZ4LiX4Li44LiB4Lib4Lij4Liw4LiB4Liy4Lij4LiC4Lit4LiH4Liq4Liy4Lih4LmA4Lir4Lil4Li14LmI4Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguITguKfguLLguKHguITguKXguYnguLLguKLguILguK3guIfguKPguLnguJsnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4o+C4ueC4m+C4quC4teC5iOC5gOC4q+C4peC4teC5iOC4ouC4oeC5geC4peC4sOC4quC4oeC4muC4seC4leC4tCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Lij4Li54Lib4Lir4Lil4Liy4Lii4LmA4Lir4Lil4Li14LmI4Lii4Lih4LmB4Lil4Liw4Lih4Li44Lih4Lig4Liy4Lii4LmD4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguKfguIfguIHguKXguKE6IOC4hOC4reC4o+C5jOC4lOC5geC4peC4sOC5gOC4quC5ieC4meC4quC4seC4oeC4nOC4seC4qicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Lin4LiH4LiB4Lil4LihOiDguKHguLjguKHguJfguLXguYjguKjguLnguJnguKLguYzguIHguKXguLLguIcv4Lia4LiZ4Lin4LiH4LiB4Lil4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguKfguIfguIHguKXguKE6IOC4quC5iOC4p+C4meC5guC4hOC5ieC4hyDguYDguIvguIHguYDguJXguK3guKPguYwg4LmA4LiL4LiB4LmA4Lih4LiZ4LiV4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguIHguLLguKPguYHguJvguKXguIfguJfguLLguIfguYDguKPguILguLLguITguJPguLTguJUgKOC5gOC4peC4t+C5iOC4reC4mS/guKvguKHguLjguJkv4Liq4Liw4LiX4LmJ4Lit4LiZL+C4guC4ouC4suC4oiknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4quC4oeC4oeC4suC4leC4oyAo4LmB4LiB4LiZL+C4iOC4uOC4lCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4geC4suC4o+C4quC4o+C5ieC4suC4h+C4o+C4ueC4m+C4lOC5ieC4p+C4ouC4p+C4h+C5gOC4p+C4teC4ouC4meKAk+C4quC4seC4meC4leC4o+C4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4LiX4Lik4Lip4LiO4Li14Lia4LiX4Lie4Li14LiX4Liy4LmC4LiB4Lij4Lix4Liq4LmB4Lil4Liw4LiB4Liy4Lij4Lib4Lij4Liw4Lii4Li44LiB4LiV4LmMJyB9LAogICAgLy8g4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4leC4seC4p+C5geC4m+C4o+C5geC4peC4sOC4meC4tOC4nuC4iOC4meC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LiB4Liy4Lij4LiB4Lij4Liw4LiI4Liy4Lii4LmB4Lil4Liw4LiB4Liy4Lij4LiI4Lix4LiU4Lir4Lih4Li54LmIJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ7guKvguLjguJnguLLguKEgKOC4muC4p+C4gS/guKXguJov4LiE4Li54LiTL+C4q+C4suC4oyknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4geC4suC4o+C5geC4ouC4geC4leC4seC4p+C4m+C4o+C4sOC4geC4reC4micgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4LmA4LiK4Li04LiH4LmA4Liq4LmJ4LiZ4LiV4Lix4Lin4LmB4Lib4Lij4LmA4LiU4Li14Lii4LinJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKPguLDguJrguJrguKrguKHguIHguLLguKPguYDguIrguLTguIfguYDguKrguYnguJnguKrguK3guIfguJXguLHguKfguYHguJvguKMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C4geC4s+C4peC4seC4h+C4quC4reC4hyAo4LiX4Liz4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4LiB4Liz4Lil4Lix4LiH4Liq4Lit4LiH4Liq4Lih4Lia4Li54Lij4LiT4LmMKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4LiB4Liz4Lil4Lix4LiH4Liq4Lit4LiHICjguYPguIrguYnguKrguLnguJXguKPguIHguLPguKXguLHguIfguKrguK3guIcpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKrguKHguIHguLLguKPguITguYjguLLguKrguLHguKHguJrguLnguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C5gOC4q+C4leC4uOC4nOC4pSAocmF0aW9uYWwpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKrguKHguIHguLLguKPguKPguLLguIEgKHJhZGljYWwpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKrguKHguIHguLLguKPguKLguIHguIHguLPguKXguLHguIcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C4peC4reC4geC4suC4o+C4tOC4l+C4tuC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lit4Liq4Lih4LiB4Liy4Lij4LmA4LiK4Li04LiH4LmA4Liq4LmJ4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguK3guKrguKHguIHguLLguKPguITguYjguLLguKrguLHguKHguJrguLnguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4o+C4sOC4muC4muC4reC4quC4oeC4geC4suC4oycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZOiDguYHguJnguKfguITguLTguJTguYHguKXguLDguKrguLHguI3guIHguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C5guC4lOC5gOC4oeC4meC5geC4peC4sOC5gOC4o+C4meC4iOC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lit4LiH4LiE4LmM4Lib4Lij4Liw4LiB4Lit4Lia4LiC4Lit4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguJzguIHguJzguLHguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4geC4suC4o+C5geC4m+C4peC4h+C4geC4o+C4suC4nyAo4LmA4Lil4Li34LmI4Lit4LiZL+C4ouC4t+C4lC/guKrguLDguJfguYnguK3guJkpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguYDguIrguLTguIfguYDguKrguYnguJnguYHguKXguLDguIHguKPguLLguJ8nIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4geC4s+C4peC4seC4h+C4quC4reC4h+C5geC4peC4sOC4geC4o+C4suC4nycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lie4Lir4Li44LiZ4Liy4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLHguKHguJ7guLHguJfguJjguYwgKHJhdGlvbmFsKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lij4Liy4LiBIChyb290KScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiE4LmI4Liy4Liq4Lix4Lih4Lia4Li54Lij4LiT4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguYHguJrguJrguIrguLTguYnguJnguKrguYjguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4ouC4geC4geC4s+C4peC4seC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lil4Lit4LiB4Liy4Lij4Li04LiX4Li24LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKXguLPguJTguLHguJrguYDguKXguILguITguJPguLTguJUgKEFQKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lil4Liz4LiU4Lix4Lia4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVIChHUCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4nOC4peC4o+C4p+C4oeC4reC4meC4uOC4geC4o+C4oSAozqMpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJfguKTguKnguI7guLXguJfguKfguLTguJnguLLguKEgKOC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4iOC4s+C4meC4p+C4meC5gOC4iuC4tOC4h+C4i+C5ieC4reC4mSAo4LmA4Liq4Lij4Li04LihKScgfSwKICAgIC8vIOC5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguKPguLDguKLguLDguJfguLLguIfguYHguKXguLDguIjguLjguJTguIHguLbguYjguIfguIHguKXguLLguIcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4iuC4seC4meC5geC4peC4sOC5gOC4quC5ieC4meC4leC4o+C4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4LmA4Liq4LmJ4LiZ4LiV4Lij4LiHOiDguKPguLnguJvguYHguJrguJrguKrguKHguIHguLLguKMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C5gOC4quC5ieC4meC4leC4o+C4hzog4LiC4LiZ4Liy4LiZL+C4leC4seC5ieC4h+C4ieC4suC4gScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4Lij4Liw4Lii4Liw4LiI4Liy4LiB4LiI4Li44LiU4LiW4Li24LiH4LmA4Liq4LmJ4LiZ4LiV4Lij4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguKfguIfguIHguKXguKE6IOC4quC4oeC4geC4suC4o+C5geC4peC4sOC4quC4oeC4muC4seC4leC4tCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4Lie4Liy4Lij4Liy4LmC4Lia4Lil4LiyJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguKfguIfguKPguLUnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C5hOC4ruC5gOC4nuC4reC4o+C5jOC5guC4muC4peC4sicgfSwKICAgIC8vIOC4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguK3guLHguJXguKPguLLguKrguYjguKfguJnguJXguKPguLXguYLguIHguJPguKHguLTguJXguLTguYPguJnguKrguLLguKHguYDguKvguKXguLXguYjguKLguKHguKHguLjguKHguInguLLguIEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4oeC4uOC4oeC4nuC4tOC5gOC4qOC4qSAzMMKwLTYwwrAtOTDCsCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4Lih4Li44Lih4Lie4Li04LmA4Lio4LipIDQ1wrAtNDXCsC05MMKwJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguYDguKPguYDguJTguLXguKLguJnguYHguKXguLDguIHguLLguKPguYHguJvguKXguIfguKvguJnguYjguKfguKInIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4geC4juC4guC4reC4h+C5hOC4i+C4meC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4LiB4LiO4LiC4Lit4LiH4LmC4LiE4LmE4LiL4LiZ4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguK3guLHguJXguKXguLHguIHguKnguJPguYzguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQgKOC4nuC4t+C5ieC4meC4kOC4suC4mSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4geC4suC4o+C5geC4m+C4peC4h+C4o+C4ueC4m+C4reC4seC4leC4peC4seC4geC4qeC4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguIHguKPguLLguJ/guJ/guLHguIfguIHguYzguIrguLHguJnguJXguKPguLXguYLguIHguJMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4leC4o+C4teC5guC4geC4k+C4nOC4geC4nOC4seC4mSAo4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZKScgfSwKICAgIC8vIOC4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mQogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguIrguJnguLTguJTguILguK3guIfguILguYnguK3guKHguLnguKXguYHguKXguLDguIHguLLguKPguYDguIHguYfguJrguILguYnguK3guKHguLnguKUnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4suC4o+C4iOC4seC4lOC4geC4peC4uOC5iOC4oeC4guC5ieC4reC4oeC4ueC4pScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiV4Liy4Lij4Liy4LiH4LiE4Lin4Liy4Lih4LiW4Li14LmIJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguIHguKPguLLguJ/guYHguJfguYjguIcg4LiB4Lij4Liy4Lif4LmA4Liq4LmJ4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguK7guLTguKrguYLguJXguYHguIHguKPguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C5geC4nOC4meC4oOC4suC4nuC4geC4peC5iOC4reC4hyAoYm94IHBsb3QpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguITguYjguLLguYDguInguKXguLXguYjguKInIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4oeC4seC4mOC4ouC4kOC4suC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiQ4Liy4LiZ4LiZ4Li04Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguJ7guLTguKrguLHguKInIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4quC5iOC4p+C4meC5gOC4muC4teC5iOC4ouC4h+C5gOC4muC4meC5gOC4ieC4peC4teC5iOC4oicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LmB4Lib4Lij4Lib4Lij4Lin4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguKrguYjguKfguJnguYDguJrguLXguYjguKLguIfguYDguJrguJnguKHguLLguJXguKPguJDguLLguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4suC4o+C5geC4iOC4geC5geC4iOC4h+C4m+C4geC4leC4tOC5geC4peC4sCB6LXNjb3JlJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguKrguKvguKrguLHguKHguJ7guLHguJnguJjguYzguYHguKXguLDguYDguKrguYnguJnguJbguJTguJbguK3guKLguYDguIrguLTguIfguYDguKrguYnguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4suC4o+C4l+C4lOC4peC4reC4h+C4quC4uOC5iOC4oS/guJ7guLfguYnguJnguJfguLXguYjguJXguLHguKfguK3guKLguYjguLLguIcv4LmA4Lir4LiV4Li44LiB4Liy4Lij4LiT4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguIHguI7guJrguKfguIHguYHguKXguLDguIHguI7guITguLnguJMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C5geC4nOC4meC4oOC4suC4nuC5gOC4p+C4meC4meC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZ4LmB4Lia4Lia4Lih4Li14LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguITguKfguLLguKHguYDguJvguYfguJnguK3guLTguKrguKPguLDguILguK3guIfguYDguKvguJXguLjguIHguLLguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4suC4o+C5gOC4o+C4teC4ouC4h+C4quC4seC4muC5gOC4m+C4peC4teC5iOC4ouC4mSAoUGVybXV0YXRpb24pJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguIHguLLguKPguIjguLHguJTguKvguKHguLnguYggKENvbWJpbmF0aW9uKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiB4Liy4Lij4LmB4LiI4LiB4LmB4LiI4LiH4LiX4Lin4Li04LiZ4Liy4LihICjguJ7guLfguYnguJnguJDguLLguJkpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguITguKfguLLguKHguITguLLguJTguKvguKHguLLguKIgKEV4cGVjdGVkIHZhbHVlKScgfSwKICAgIC8vIOC5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mQogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguKXguLTguKHguLTguJUnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4leC5iOC4reC5gOC4meC4t+C5iOC4reC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lit4LiZ4Li44Lie4Lix4LiZ4LiY4LmMOiDguIHguI7guJ7guLfguYnguJnguJDguLLguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4reC4meC4uOC4nuC4seC4meC4mOC5jDog4LiB4LiO4Lil4Li54LiB4LmC4LiL4LmIJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguK3guJnguLjguJ7guLHguJnguJjguYw6IOC4nOC4peC4hOC4ueC4ky/guJzguKXguKvguLLguKMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4reC4meC4uOC4nuC4seC4meC4mOC5jOC4guC4reC4hyBleHAvbG9nL3RyaWcgKOC4nuC4t+C5ieC4meC4kOC4suC4mSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4iuC4seC4meC5gOC4quC5ieC4meC4quC4seC4oeC4nOC4seC4qicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lit4Lix4LiV4Lij4Liy4LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmB4Lib4Lil4LiH4LiX4Lix4LiZ4LiX4Li1JyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICdPcHRpbWl6YXRpb24gKOC4hOC5iOC4suC4quC4ueC4h+C4quC4uOC4lOKAk+C4leC5iOC4s+C4quC4uOC4lCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4m+C4o+C4tOC4nuC4seC4meC4mOC5jOC5hOC4oeC5iOC4iOC4s+C4geC4seC4lCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lib4Lij4Li04Lie4Lix4LiZ4LiY4LmM4LiI4Liz4LiB4Lix4LiUJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguJfguKTguKnguI7guLXguJrguJfguJ7guLfguYnguJnguJDguLLguJnguILguK3guIfguYHguITguKXguITguLnguKXguLHguKonIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4nuC4t+C5ieC4meC4l+C4teC5iOC5g+C4leC5ieC4geC4o+C4suC4ny/guKPguLDguKvguKfguYjguLLguIfguIHguKPguLLguJ8nIH0sCiAgICAvLyDguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSkKICAgIHsgY2F0ZWdvcnk6ICfguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmMIDIg4Lih4Li04LiV4Li0OiDguJrguKfguIEv4LiE4Li54LiT4Liq4LmA4LiB4Lil4Liy4Lij4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguJTguK3guJfguYLguJvguKPguJTguLHguIHguJXguYwgKGRvdCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmM4LmB4Lil4Liw4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4geC4suC4o+C4m+C4o+C4sOC4ouC4uOC4geC4leC5jOC5gOC4p+C4geC5gOC4leC4reC4o+C5jOC4nuC4t+C5ieC4meC4kOC4suC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMOiDguJrguKfguIEv4LiE4Li54LiTJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguK3guLTguJnguYDguKfguK3guKPguYzguKrguILguK3guIfguYDguKHguJfguKPguLTguIHguIvguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmM4LmB4Lil4Liw4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4lOC4teC5gOC4l+C4reC4o+C5jOC4oeC4tOC5geC4meC4meC4leC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LmB4LiB4LmJ4Lij4Liw4Lia4Lia4Liq4Lih4LiB4Liy4Lij4LiU4LmJ4Lin4Lii4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMJyB9LAogICAgLy8g4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4owogICAgeyBjYXRlZ29yeTogJ+C4hOC4k+C4tOC4leC4geC4suC4o+C5gOC4h+C4tOC4mS/guJrguLnguKPguJPguLLguIHguLLguKMnLCBuYW1lOiAn4LiU4Lit4LiB4LmA4Lia4Li14LmJ4Lii4Lit4Lii4LmI4Liy4LiH4LiH4LmI4Liy4LiiJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4hOC4k+C4tOC4leC4geC4suC4o+C5gOC4h+C4tOC4mS/guJrguLnguKPguJPguLLguIHguLLguKMnLCBuYW1lOiAn4LiU4Lit4LiB4LmA4Lia4Li14LmJ4Lii4LiX4Lia4LiV4LmJ4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4hOC4k+C4tOC4leC4geC4suC4o+C5gOC4h+C4tOC4mS/guJrguLnguKPguJPguLLguIHguLLguKMnLCBuYW1lOiAn4LmA4LiH4Li04LiZ4LiH4Lin4LiUICjguK3guJnguLjguIHguKPguKHguYDguIfguLTguJnguIfguKfguJQpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4hOC4k+C4tOC4leC4geC4suC4o+C5gOC4h+C4tOC4mS/guJrguLnguKPguJPguLLguIHguLLguKMnLCBuYW1lOiAn4LiE4LmI4Liy4LmA4Liq4Li34LmI4Lit4Lih4Lij4Liy4LiE4LiyJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4hOC4k+C4tOC4leC4geC4suC4o+C5gOC4h+C4tOC4mS/guJrguLnguKPguJPguLLguIHguLLguKMnLCBuYW1lOiAn4Lij4LmJ4Lit4Lii4Lil4Liw4Lib4Lij4Liw4Lii4Li44LiB4LiV4LmMJyB9LAogICAgLy8g4LiV4Lij4Lij4LiB4LiwL+C4l+C4seC4geC4qeC4sOC4geC4suC4o+C4nuC4tOC4quC4ueC4iOC4meC5jCAo4LmA4Liq4Lij4Li04LihKQogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4o+C4geC4sC/guJfguLHguIHguKnguLDguIHguLLguKPguJ7guLTguKrguLnguIjguJnguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LiE4LmI4Liy4LiE4Lin4Liy4Lih4LiI4Lij4Li04LiHL+C4leC4suC4o+C4suC4h+C4hOC5iOC4suC4hOC4p+C4suC4oeC4iOC4o+C4tOC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguKPguIHguLAv4LiX4Lix4LiB4Lip4Liw4LiB4Liy4Lij4Lie4Li04Liq4Li54LiI4LiZ4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4o+C4ueC4m+C5geC4muC4muC4geC4suC4o+C5g+C4q+C5ieC5gOC4q+C4leC4uOC4nOC4pScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguKPguIHguLAv4LiX4Lix4LiB4Lip4Liw4LiB4Liy4Lij4Lie4Li04Liq4Li54LiI4LiZ4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4nuC4tOC4quC4ueC4iOC4meC5jOC5gOC4iuC4tOC4h+C4leC4o+C4hy/guK3guLjguJvguJnguLHguKIgKOC4nuC4t+C5ieC4meC4kOC4suC4mSknIH0sCl07CgovLyAyLiDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgRHJvcGRvd24KLy8gPT09IOC5geC4l+C4meC4l+C4teC5iOC4n+C4seC4h+C4geC5jOC4iuC4seC4mSByZW5kZXJUb3BpY1JlZmluZURyb3Bkb3duIOC5gOC4lOC4tOC4oeC4lOC5ieC4p+C4ouC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5iSA9PT0KLy8gPT09IOC5geC4l+C4meC4l+C4teC5iOC4n+C4seC4h+C4geC5jOC4iuC4seC4mSByZW5kZXJUb3BpY0NoZWNrYm94ZXMg4LmA4LiU4Li04Lih4LiU4LmJ4Lin4Lii4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJID09PQpmdW5jdGlvbiByZW5kZXJUb3BpY0NoZWNrYm94ZXMoKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgIGNvbnN0IHN0YW5kYXJkVG9waWNzID0gYWxsTWF0aFRvcGljczsKICAgIGNvbnN0IHVzZXJDcmVhdGVkVG9waWNzID0gY3VzdG9tTWF0aFRvcGljcy5tYXAodCA9PiAoeyBpZDogdC5pZCwgY2F0ZWdvcnk6ICfguKvguLHguKfguILguYnguK3guJfguLXguYjguKrguKPguYnguLLguIfguYDguK3guIcnLCBuYW1lOiB0Lm5hbWUgfSkpOwogICAgY29uc3QgY29tYmluZWRUb3BpY3MgPSBbLi4uc3RhbmRhcmRUb3BpY3MsIC4uLnVzZXJDcmVhdGVkVG9waWNzXTsKICAgIAogICAgY29uc3QgdG9waWNzQnlDYXRlZ29yeSA9IGNvbWJpbmVkVG9waWNzLnJlZHVjZSgoYWNjLCB0b3BpYykgPT4gewogICAgICAgIGlmICghYWNjW3RvcGljLmNhdGVnb3J5XSkgewogICAgICAgICAgICBhY2NbdG9waWMuY2F0ZWdvcnldID0gW107CiAgICAgICAgfQogICAgICAgIGFjY1t0b3BpYy5jYXRlZ29yeV0ucHVzaCh0b3BpYyk7CiAgICAgICAgcmV0dXJuIGFjYzsKICAgIH0sIHt9KTsKCiAgICBsZXQgaHRtbCA9ICcnOwogICAgY29uc3QgY2F0ZWdvcnlPcmRlciA9IFsn4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LmA4Lit4LiHJywgLi4uT2JqZWN0LmtleXModG9waWNzQnlDYXRlZ29yeSkuZmlsdGVyKGMgPT4gYyAhPT0gJ+C4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5gOC4reC4hycpXTsKCiAgICBmb3IgKGNvbnN0IGNhdGVnb3J5IG9mIGNhdGVnb3J5T3JkZXIpIHsKICAgICAgICBpZiAodG9waWNzQnlDYXRlZ29yeVtjYXRlZ29yeV0pIHsKICAgICAgICAgICAgY29uc3QgaXNDdXN0b21DYXRlZ29yeSA9IGNhdGVnb3J5ID09PSAn4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LmA4Lit4LiHJzsKICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnlJY29uID0gaXNDdXN0b21DYXRlZ29yeSA/ICdmYXMgZmEtdXNlci1lZGl0JyA6ICdmYXMgZmEtYm9va21hcmsnOwogICAgICAgICAgICBjb25zdCBjYXRlZ29yeUNvbG9yID0gaXNDdXN0b21DYXRlZ29yeSA/ICd0ZXh0LWJsdWUtNzAwJyA6ICd0ZXh0LWluZGlnby03MDAnOwoKICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibWItMyB0b3BpYy1jYXRlZ29yeSI+YDsgLy8g4pa84pa84pa8IOC5geC4geC5ieC5hOC4gjog4LmA4Lie4Li04LmI4LihIGNsYXNzIGB0b3BpYy1jYXRlZ29yeWAg4pa84pa84pa8CiAgICAgICAgICAgIGh0bWwgKz0gYDxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1zbSAke2NhdGVnb3J5Q29sb3J9IGJvcmRlci1iIG1iLTEgcGItMSI+PGkgY2xhc3M9IiR7Y2F0ZWdvcnlJY29ufSBtci0yIj48L2k+JHtjYXRlZ29yeX08L3A+YDsKCiAgICAgICAgICAgIHRvcGljc0J5Q2F0ZWdvcnlbY2F0ZWdvcnldLmZvckVhY2godG9waWMgPT4gewogICAgICAgICAgICAgICAgLy8g4pa84pa84pa8IOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4gjog4Liq4Lij4LmJ4Liy4LiH4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LiX4Li14LmI4LmA4Lir4Lih4Li34Lit4LiZ4LiB4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiX4Li44LiB4Lir4Lix4Lin4LiC4LmJ4LitIOKWvOKWvOKWvAogICAgICAgICAgICAgICAgY29uc3QgaXNDdXN0b20gPSAhIXRvcGljLmlkOyAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguYDguJvguYfguJnguKvguLHguKfguILguYnguK3guJfguLXguYjguKrguKPguYnguLLguIfguYDguK3guIfguKvguKPguLfguK3guYTguKHguYgKCiAgICAgICAgICAgICAgICBjb25zdCBhY3Rpb25CdXR0b25zID0gaXNDdXN0b20gPyBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9waWMtYWN0aW9ucy12aWV3IGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3RvcGljLmlkfSIgY2xhc3M9ImVkaXQtY3VzdG9tLXRvcGljLWJ0biB0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtYmx1ZS02MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7dG9waWMuaWR9IiBjbGFzcz0iZGVsZXRlLWN1c3RvbS10b3BpYy1idG4gdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXJlZC02MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0IHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idG9waWMtYWN0aW9ucy1lZGl0IGhpZGRlbiBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHt0b3BpYy5pZH0iIGNsYXNzPSJzYXZlLWN1c3RvbS10b3BpYy1idG4gdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyZWVuLTYwMCBwLTEgcm91bmRlZC1mdWxsIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjayBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7dG9waWMuaWR9IiBjbGFzcz0iY2FuY2VsLWVkaXQtdG9waWMtYnRuIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC1ncmF5LTgwMCBwLTEgcm91bmRlZC1mdWxsIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10aW1lcyBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYCA6ICcnOwoKICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHAtMSBob3ZlcjpiZy1ncmF5LTEwMCByb3VuZGVkLW1kIGdyb3VwIHRvcGljLXJvdyIgZGF0YS10b3BpYy1jb250YWluZXItaWQ9IiR7dG9waWMuaWQgfHwgJyd9Ij4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMiBjdXJzb3ItcG9pbnRlciBmbGV4LWdyb3ciPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIG5hbWU9Im1hdGhfdG9waWMiIHZhbHVlPSIke3RvcGljLm5hbWV9IiBjbGFzcz0iaC00IHctNCByb3VuZGVkIGJvcmRlci1ncmF5LTMwMCB0ZXh0LWluZGlnby02MDAgZm9jdXM6cmluZy1pbmRpZ28tNTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gdG9waWMtbmFtZS1kaXNwbGF5Ij4ke3RvcGljLm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAke2lzQ3VzdG9tID8gYDxpbnB1dCB0eXBlPSJ0ZXh0IiBjbGFzcz0idG9waWMtbmFtZS1pbnB1dCBoaWRkZW4gdy1mdWxsIHRleHQtc20gcC0xIGJvcmRlciByb3VuZGVkIiB2YWx1ZT0iJHt0b3BpYy5uYW1lfSI+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgJHthY3Rpb25CdXR0b25zfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giDilrLilrLilrIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sIHx8ICc8cCBjbGFzcz0idGV4dC1ncmF5LTQwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lir4Lix4Lin4LiC4LmJ4LitPC9wPic7CiAgICBjb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlU2VsZWN0ZWRUb3BpY3NDb3VudCk7CiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlU2VsZWN0ZWRUb3BpY3NDb3VudCk7Cn0KCi8qKgogKiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguK3guLHguJvguYDguJTguJXguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guJfguLXguYjguJzguLnguYnguYPguIrguYnguKrguKPguYnguLLguIfguYDguK3guIcKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljSWQgLSBJRCDguILguK3guIfguYDguK3guIHguKrguLLguKPguKvguLHguKfguILguYnguK3guYPguJkgRmlyZXN0b3JlCiAqIEBwYXJhbSB7c3RyaW5nfSBuZXdOYW1lIC0g4LiK4Li34LmI4Lit4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVVcGRhdGVDdXN0b21Ub3BpYyh0b3BpY0lkLCBuZXdOYW1lKSB7CiAgICBpZiAoIXRvcGljSWQgfHwgIW5ld05hbWUudHJpbSgpKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4q+C5ieC4suC4oeC4p+C5iOC4suC4hyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IHRvcGljUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2N1c3RvbU1hdGhUb3BpY3NgLCB0b3BpY0lkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2ModG9waWNSZWYsIHsgbmFtZTogbmV3TmFtZS50cmltKCkgfSk7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5geC4geC5ieC5hOC4guC4q+C4seC4p+C4guC5ieC4reC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgIC8vIG9uU25hcHNob3Qg4LiI4LiwIHJlLXJlbmRlciDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQg4LiL4Li24LmI4LiH4LiI4Liw4LiX4Liz4LmD4Lir4LmJIFVJIOC4geC4peC4seC4muC5gOC4m+C5h+C4meC5guC4q+C4oeC4lOC4m+C4geC4leC4tOC5gOC4reC4hwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBjdXN0b20gdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYHguIHguYnguYTguILguKvguLHguKfguILguYnguK0iKTsKICAgIH0KfQoKLyoqCiAqIOC4quC4peC4seC4miBVSSDguKPguLDguKvguKfguYjguLLguIfguYLguKvguKHguJTguYHguKrguJTguIfguJzguKXguYHguKXguLDguYLguKvguKHguJTguYHguIHguYnguYTguILguKrguLPguKvguKPguLHguJrguKvguLHguKfguILguYnguK0KICogQHBhcmFtIHtIVE1MRWxlbWVudH0gdG9waWNDb250YWluZXIgLSBFbGVtZW50IGRpdiDguKvguKXguLHguIHguILguK3guIfguKvguLHguKfguILguYnguK3guJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguKrguKXguLHguJoKICogQHBhcmFtIHtib29sZWFufSBpc0VkaXRpbmcgLSB0cnVlIOC5gOC4nuC4t+C5iOC4reC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4giwgZmFsc2Ug4LmA4Lie4Li34LmI4Lit4Lit4Lit4LiB4LiI4Liy4LiB4LmC4Lir4Lih4LiU4LmB4LiB4LmJ4LmE4LiCCiAqLwpmdW5jdGlvbiB0b2dnbGVUb3BpY0VkaXRNb2RlKHRvcGljQ29udGFpbmVyLCBpc0VkaXRpbmcpIHsKICAgIGlmICghdG9waWNDb250YWluZXIpIHJldHVybjsKCiAgICBjb25zdCBuYW1lRGlzcGxheSA9IHRvcGljQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50b3BpYy1uYW1lLWRpc3BsYXknKTsKICAgIGNvbnN0IG5hbWVJbnB1dCA9IHRvcGljQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50b3BpYy1uYW1lLWlucHV0Jyk7CiAgICBjb25zdCB2aWV3QWN0aW9ucyA9IHRvcGljQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50b3BpYy1hY3Rpb25zLXZpZXcnKTsKICAgIGNvbnN0IGVkaXRBY3Rpb25zID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLWFjdGlvbnMtZWRpdCcpOwoKICAgIG5hbWVEaXNwbGF5LmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGlzRWRpdGluZyk7CiAgICBuYW1lSW5wdXQuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgIWlzRWRpdGluZyk7CiAgICB2aWV3QWN0aW9ucy5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBpc0VkaXRpbmcpOwogICAgZWRpdEFjdGlvbnMuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgIWlzRWRpdGluZyk7CgogICAgaWYgKGlzRWRpdGluZykgewogICAgICAgIG5hbWVJbnB1dC5mb2N1cygpOwogICAgICAgIG5hbWVJbnB1dC5zZWxlY3QoKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3RhcnRMaXZlUmFjZShxdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIHVwZGF0ZVNlbGVjdGVkVG9waWNzQ291bnQoKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CiAgICBjb25zdCBjb3VudCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdOmNoZWNrZWQnKS5sZW5ndGg7CiAgICBjb25zdCBjb3VudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGVkLXRvcGljcy1jb3VudCcpOwogICAgaWYgKGNvdW50ID4gMCkgewogICAgICAgIGNvdW50RWwudGV4dENvbnRlbnQgPSBgKOC5gOC4peC4t+C4reC4geC5geC4peC5ieC4pyAke2NvdW50fSDguKvguLHguKfguILguYnguK0pYDsKICAgIH0gZWxzZSB7CiAgICAgICAgY291bnRFbC50ZXh0Q29udGVudCA9ICcnOwogICAgfQp9Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoJCQoJCWNvbnN0IHNhcmFidW5CYXNlNjQgPSAnJzsKICAgICAgICBsZXQgZGIsIGF1dGgsIHVzZXJJZDsKCQlsZXQgY3VzdG9tTWF0aFRvcGljcyA9IFtdOyAvLyAgPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgIGxldCBjdXJyZW50TW9kZSA9ICdzdHVkZW50JzsgLy8gJ3N0dWRlbnQnLCAnYWRtaW4nLCBvciAnYWRtaW4tdGVzdGluZycKICAgICAgICBsZXQgY3VycmVudFByb2plY3RJZCA9IG51bGw7CiAgICAgICAgbGV0IGN1cnJlbnRQcm9qZWN0RGF0YSA9IG51bGw7CiAgICAgICAgbGV0IGN1cnJlbnRRdWl6RGF0YSA9IG51bGw7CiAgICAgICAgbGV0IGN1cnJlbnREaXNwbGF5ZWRRdWl6ID0gbnVsbDsgLy8gSG9sZHMgdGhlIHBvdGVudGlhbGx5IHNodWZmbGVkIHF1aXogZm9yIHRoZSBzdHVkZW50CgkJbGV0IGN1cnJlbnRTdWJtaXNzaW9ucyA9IFtdOyAvLyDguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguILguYnguK3guKHguLnguKXguIHguLLguKPguKrguYjguIfguIfguLLguJnguKXguYjguLLguKrguLjguJQKbGV0IHF1aXpMZWFkZXJib2FyZFNvcnRCeSA9ICdiZXN0U2NvcmUnOyAvLyDguITguK3guKXguLHguKHguJnguYzguJfguLXguYjguYPguIrguYnguIjguLHguJTguYDguKPguLXguKLguIcgKOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mSkKbGV0IHF1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9ICdkZXNjJzsgLy8g4LiX4Li04Lio4LiX4Liy4LiH4LiB4Liy4Lij4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiHICjguITguYjguLLguYDguKPguLTguYjguKHguJXguYnguJkpCiAgICAgICAgbGV0IGN1cnJlbnRTdHVkZW50TmFtZSA9IG51bGw7CiAgICAgICAgbGV0IGN1cnJlbnRTdHVkZW50UHJvamVjdERhdGEgPSBudWxsOyAKICAgICAgICBsZXQgY3VycmVudFByZXNlbnRhdGlvblNsaWRlID0gMDsKICAgICAgICBsZXQgYWxsUHJvamVjdHMgPSBbXTsgLy8gQ2FjaGUgZm9yIHByb2plY3RzCgkJbGV0IGFsbFF1aXp6ZXNHbG9iYWwgPSBbXTsgICAgICAgIC8vIOC5geC4hOC4iuC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4uOC4geC5guC4m+C4o+C5gOC4iOC4hCAo4Lit4LmI4Liy4LiZ4Lij4Lin4LiU4LmA4LiU4Li14Lii4LinKQoJCWxldCBzZWxlY3RlZEdsb2JhbFF1aXpJZCA9IG51bGw7ICAvLyBpZCDguYHguJrguJrguJfguJTguKrguK3guJrguJfguLXguYjguJzguLnguYnguYPguIrguYnguYDguKXguLfguK3guIHguYPguJkgbW9kYWwKICAgICAgICBsZXQgYWxsUXVpenplcyA9IFtdOyAvLyBDYWNoZSBmb3IgcXVpenplcyBpbiBhIHByb2plY3QKCQlsZXQgc3RhcnJlZFF1aXp6ZXMgPSBbXTsgLy8gQ2FjaGUgZm9yIHN0YXJyZWQgcXVpenplcwogICAgICAgIGxldCBjaGFydEluc3RhbmNlcyA9IHt9OyAvLyBUbyBob2xkIGNoYXJ0IG9iamVjdHMKICAgICAgICBsZXQgdW5zdWJzY3JpYmVQcm9qZWN0c0xpc3RlbmVyID0gbnVsbDsKICAgICAgICBsZXQgdW5zdWJzY3JpYmVTdHVkZW50c0xpc3RlbmVyID0gbnVsbDsKICAgICAgICBsZXQgdW5zdWJzY3JpYmVRdWl6emVzTGlzdGVuZXIgPSBudWxsOwogICAgICAgIGxldCB1bnN1YnNjcmliZVN1Ym1pc3Npb25zTGlzdGVuZXIgPSBudWxsOwogICAgICAgIGxldCB1bnN1YnNjcmliZVN0dWRlbnRQcm9maWxlc0xpc3RlbmVyID0gbnVsbDsgLy8gRm9yIExlYWRlcmJvYXJkCiAgICAgICAgbGV0IGNvbmZpcm1BY3Rpb24gPSBudWxsOwogICAgICAgIGxldCBjYW5jZWxBY3Rpb24gPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgbGV0IGFjdGlvblRhcmdldElkID0gbnVsbDsgLy8gVXNlZCBmb3IgcmVuYW1lL21vdmUvdGltZXIgYWN0aW9ucwoJCWxldCBzZWxlY3RlZEZpbGUgPSBudWxsOyAvLyAgPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC5gOC4guC5ieC4suC4oeC4sgogICAgICAgIGxldCBkcmFnZ2VkU3ZnRWxlbWVudCA9IG51bGw7IC8vIOC4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4miBlbGVtZW50IOC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4luC4ueC4geC4peC4suC4gQogICAgICAgIGxldCBzdmdPZmZzZXQgPSB7IHg6IDAsIHk6IDAgfTsgLy8g4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4Lij4Liw4Lii4Liw4Lir4LmI4Liy4LiH4Lij4Liw4Lir4Lin4LmI4Liy4LiH4LmA4Lih4Liy4Liq4LmML+C4meC4tOC5ieC4p+C4geC4seC4muC4oeC4uOC4oeC4guC4reC4hyBlbGVtZW50CiAgICAgICAgLy8gVGltZXItcmVsYXRlZCBzdGF0ZQogICAgICAgIGxldCBxdWl6VGltZXJJbnRlcnZhbCA9IG51bGw7CiAgICAgICAgbGV0IHBlclF1ZXN0aW9uVGltZXJJbnRlcnZhbCA9IG51bGw7CiAgICAgICAgbGV0IHF1aXpTdGFydFRpbWUgPSBudWxsOyAvLyBGb3IgY2FsY3VsYXRpbmcgZHVyYXRpb24KICAgICAgICBsZXQgY3VycmVudFF1ZXN0aW9uSW5kZXggPSAwOwogICAgICAgIGxldCBzdHVkZW50QW5zd2Vyc1BlclF1ZXN0aW9uID0gW107CiAgICAgICAgLy8gTGl2ZSBHYW1lIFN0YXRlCgkJbGV0IGNhY2hlZE90aGVyUGxheWVyc0ZvclF1ZXN0aW9uID0gbnVsbDsKCQlsZXQgY2FjaGVkUXVlc3Rpb25JbmRleEZvclBsYXllcnMgPSAtMTsKICAgICAgICBsZXQgY3VycmVudExpdmVHYW1lSWQgPSBudWxsOwogICAgICAgIGxldCBjdXJyZW50TGl2ZUdhbWVQaW4gPSBudWxsOwoJCWxldCBsb2NrZWRGYXN0ZXN0UmVzcG9uZGVyTmFtZSA9IG51bGw7IAoJCWxldCBsYXN0TG9ja2VkUXVlc3Rpb25JbmRleCA9IC0xOwogICAgICAgIGxldCB1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIgPSBudWxsOwoJCWxldCBzeW5jUXVlc3Rpb25UaW1lckludGVydmFsID0gbnVsbDsKCQlsZXQgbGFzdFJlbmRlcmVkQWRtaW5RdWVzdGlvbkluZGV4ID0gLTE7CgkJIAkJIAovLyDilrzilrzilrwgW1NUQVJUXSDguKfguLLguIfguJfguLHguJrguYLguITguYnguJTguKrguYjguKfguJkgU2NyYXRjaHBhZCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguIrguLjguJTguYPguKvguKHguYjguJnguLXguYkg4pa84pa84pa8CgovLyAtLS0g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LiI4Lix4LiU4LiB4Liy4Lij4Liq4LiW4Liy4LiZ4Liw4LiC4Lit4LiH4LiB4Lij4Liw4LiU4Liy4LiZ4LiX4LiUIC0tLQpsZXQgaXNBbmltYXRpbmdUcmFpbCA9IGZhbHNlOyAvLyDguJXguLHguKfguYHguJvguKPguYDguIrguYfguITguKfguYjguLIgYW5pbWF0aW9uIOC4geC4s+C4peC4seC4h+C4l+C4s+C4h+C4suC4meC4q+C4o+C4t+C4reC5hOC4oeC5iApjb25zdCBUUkFJTF9EVVJBVElPTiA9IDE1MDA7IC8vIOC4o+C4sOC4ouC4sOC5gOC4p+C4peC4suC4l+C4teC5iOC5gOC4quC5ieC4meC4iOC4sOC5geC4quC4lOC4h+C4reC4ouC4ueC5iCAoMTUwMG1zID0gMS41IOC4p+C4tOC4meC4suC4l+C4tSkKbGV0IHNjcmF0Y2hwYWRDdHggPSBudWxsOwpsZXQgaXNEcmF3aW5nT25TY3JhdGNocGFkID0gZmFsc2U7CmxldCBzY3JhdGNocGFkSGlnaGxpZ2h0ZXJDb2xvciA9ICdyZ2JhKDI1NSwgMjU1LCAwLCAwLjUpJzsgLy8g4Liq4Li14LmA4Lir4Lil4Li34Lit4LiH4LmC4Lib4Lij4LmI4LiH4LmB4Liq4LiH4LmA4Lib4LmH4LiZ4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCmxldCBzY3JhdGNocGFkSGlnaGxpZ2h0ZXJTaXplID0gMjA7IC8vIOC4guC4meC4suC4lOC5gOC4o+C4tOC5iOC4oeC4leC5ieC4meC4guC4reC4h+C5hOC4ruC5hOC4peC4l+C5jApsZXQgaXNQYW5uaW5nID0gZmFsc2U7CmxldCBpc01vdXNlUGFubmluZyA9IGZhbHNlOwoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LmB4Lib4Lil4LiHICjguKLguYjguK0v4LiC4Lii4Liy4LiiL+C5gOC4peC4t+C5iOC4reC4mSkKbGV0IHNjcmF0Y2hwYWRTY2FsZSA9IDE7CmxldCBzY3JhdGNocGFkT2Zmc2V0ID0geyB4OiAwLCB5OiAwIH07CmxldCBwYW5TdGFydCA9IHsgeDogMCwgeTogMCB9OwpsZXQgaW5pdGlhbFBpbmNoRGlzdGFuY2UgPSBudWxsOwpjb25zdCBNSU5fU0NBTEUgPSAwLjI7CmNvbnN0IE1BWF9TQ0FMRSA9IDU7CgovLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguJvguKPguLDguKfguLHguJXguLTguIHguLLguKPguKfguLLguJQgKOC5gOC4quC5ieC4mSkKbGV0IHN0cm9rZXMgPSBbXTsgLy8g4LmA4LiB4LmH4Lia4LmA4Liq4LmJ4LiZ4LiX4Li14LmI4Lin4Liy4LiU4LmA4Liq4Lij4LmH4LiI4LmB4Lil4LmJ4LinCmxldCByZWRvU3Ryb2tlcyA9IFtdOyAvLyDguYDguIHguYfguJrguYDguKrguYnguJnguJfguLXguYggdW5kbyDguYTguJsKbGV0IGN1cnJlbnRTdHJva2UgPSBudWxsOyAvLyDguYDguIHguYfguJrguYDguKrguYnguJnguJfguLXguYjguIHguLPguKXguLHguIfguKfguLLguJTguK3guKLguLnguYgKCi8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4hOC4o+C4t+C5iOC4reC4h+C4oeC4t+C4rQpsZXQgYWN0aXZlVG9vbCA9ICdwZW4nOyAvLyAncGVuJywgJ2VyYXNlcicsIG9yICdsYXNlcicKbGV0IHNjcmF0Y2hwYWRQZW5Db2xvciA9ICcjMDAwMDAwJzsKbGV0IHNjcmF0Y2hwYWRQZW5TaXplID0gNTsKbGV0IHNjcmF0Y2hwYWRFcmFzZXJTaXplID0gNDA7CgpsZXQgbGFzZXJGYWRlVGltZXIgPSBudWxsOyAvLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIHguYfguJogSW5hY3Rpdml0eSBUaW1lcgpjb25zdCBMQVNFUl9JTkFDVElWSVRZX1RJTUVPVVQgPSAxNTAwOyAvLyAxLjUg4Lin4Li04LiZ4Liy4LiX4Li1OiDguYDguKfguKXguLLguJfguLXguYjguJXguYnguK3guIfguKvguKLguLjguJTguKfguLLguJTguIHguYjguK3guJnguJfguLXguYjguYDguKrguYnguJnguIjguLDguYDguKPguLTguYjguKHguKvguLLguKIKCgovLyAtLS0g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIEhlbHBlciAtLS0KZnVuY3Rpb24gZ2V0RGlzdGFuY2UocDEsIHAyKSB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHAxLnggLSBwMi54LCAyKSArIE1hdGgucG93KHAxLnkgLSBwMi55LCAyKSk7Cn0KCmZ1bmN0aW9uIGdldE1pZHBvaW50KHAxLCBwMikgewogICAgcmV0dXJuIHsgeDogKHAxLnggKyBwMi54KSAvIDIsIHk6IChwMS55ICsgcDIueSkgLyAyIH07Cn0KCi8vIOC5geC4m+C4peC4h+C4nuC4tOC4geC4seC4lOC4muC4meC4iOC4rSAoU2NyZWVuKSDguYTguJvguYDguJvguYfguJnguJ7guLTguIHguLHguJTguJrguJnguIHguKPguLDguJTguLLguJnguIjguKPguLTguIcgKFdvcmxkKQpmdW5jdGlvbiBnZXRUcmFuc2Zvcm1lZFBvaW50KHgsIHkpIHsKICAgIHJldHVybiB7CiAgICAgICAgeDogKHggLSBzY3JhdGNocGFkT2Zmc2V0LngpIC8gc2NyYXRjaHBhZFNjYWxlLAogICAgICAgIHk6ICh5IC0gc2NyYXRjaHBhZE9mZnNldC55KSAvIHNjcmF0Y2hwYWRTY2FsZSwKICAgIH07Cn0KCgpmdW5jdGlvbiByZWRyYXdTY3JhdGNocGFkKCkgewogICAgaWYgKCFzY3JhdGNocGFkQ3R4KSByZXR1cm47CiAgICBjb25zdCBjYW52YXMgPSBzY3JhdGNocGFkQ3R4LmNhbnZhczsKICAgIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CgogICAgLy8gLS0tIFsgU1RBUlQ6IOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4siBdIC0tLQogICAgLy8gMS4g4Lir4LiyIEVsZW1lbnQg4LiC4Lit4LiHIEhlYWRlciDguJfguLXguYjguYHguKrguJTguIfguYLguIjguJfguKLguYwKICAgIGNvbnN0IGhlYWRlckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtaGVhZGVyJyk7CgogICAgLy8gMi4g4Liq4Lix4LmI4LiH4LmD4Lir4LmJIEhlYWRlciDguYPguIrguYkgQ1NTIFRyYW5zZm9ybSDguJXguLLguKHguITguYjguLLguIHguLLguKPguIvguLnguKEv4LmA4Lil4Li34LmI4Lit4LiZ4LiC4Lit4LiHIENhbnZhcwogICAgaWYgKGhlYWRlckVsKSB7CiAgICAgICAgaGVhZGVyRWwuc3R5bGUudHJhbnNmb3JtT3JpZ2luID0gJzAgMCc7IC8vIOC4geC4s+C4q+C4meC4lOC4iOC4uOC4lOC4q+C4oeC4uOC4meC4l+C4teC5iOC4oeC4uOC4oeC4i+C5ieC4suC4ouC4muC4mQogICAgICAgIGhlYWRlckVsLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGUoJHtzY3JhdGNocGFkT2Zmc2V0Lnh9cHgsICR7c2NyYXRjaHBhZE9mZnNldC55fXB4KSBzY2FsZSgke3NjcmF0Y2hwYWRTY2FsZX0pYDsKICAgIH0KICAgIC8vIC0tLSBbIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmA4Lie4Li04LmI4Lih4LmA4LiC4LmJ4Liy4Lih4LiyIF0gLS0tCgogICAgLy8gMS4g4Lil4LmJ4Liy4LiHIENhbnZhcyAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgc2NyYXRjaHBhZEN0eC5zYXZlKCk7CiAgICBzY3JhdGNocGFkQ3R4LnNldFRyYW5zZm9ybShkcHIsIDAsIDAsIGRwciwgMCwgMCk7CiAgICBzY3JhdGNocGFkQ3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgc2NyYXRjaHBhZEN0eC5yZXN0b3JlKCk7CgogICAgLy8gMi4g4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIFRyYW5zZm9ybSAoU2NhbGUg4LmB4Lil4LiwIFBhbikgKOC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIHNjcmF0Y2hwYWRDdHguc2F2ZSgpOwogICAgc2NyYXRjaHBhZEN0eC50cmFuc2xhdGUoc2NyYXRjaHBhZE9mZnNldC54LCBzY3JhdGNocGFkT2Zmc2V0LnkpOwogICAgc2NyYXRjaHBhZEN0eC5zY2FsZShzY3JhdGNocGFkU2NhbGUsIHNjcmF0Y2hwYWRTY2FsZSk7CgogICAgLy8gMy4g4Lin4Liy4LiU4LmA4Liq4LmJ4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Li14LmI4Lia4Lix4LiZ4LiX4Li24LiB4LmE4Lin4LmJ4LmD4LiZIHN0cm9rZXMgKOC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIHN0cm9rZXMuZm9yRWFjaChzdHJva2UgPT4gewogICAgICAgIGRyYXdTdHJva2Uoc3Ryb2tlKTsKICAgIH0pOwoKICAgIC8vIDQuIOC4p+C4suC4lOC5gOC4quC5ieC4meC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4p+C4suC4lOC4reC4ouC4ueC5iCAo4LiW4LmJ4Liy4Lih4Li1KSAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgaWYgKGN1cnJlbnRTdHJva2UpIHsKICAgICAgICBkcmF3U3Ryb2tlKGN1cnJlbnRTdHJva2UpOwogICAgfQoKICAgIC8vIDUuIOC4hOC4t+C4meC4hOC5iOC4siBUcmFuc2Zvcm0gKOC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIHNjcmF0Y2hwYWRDdHgucmVzdG9yZSgpOwp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApmdW5jdGlvbiByZW5kZXJHcm91cE1vZGVRdWVzdGlvbigpIHsKICAgIGlmIChsb2NhbFF1ZXN0aW9uSW5kZXggPj0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBkaXNwbGF5VGVhbVF1aXpGaW5hbFJlc3VsdHMoKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcSA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbbG9jYWxRdWVzdGlvbkluZGV4XTsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWl6VHlwZTsKICAgIGxldCBxdWVzdGlvblRleHRIVE1MID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0OwogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CgogICAgc3dpdGNoIChxdWVzdGlvblR5cGUpIHsKICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOiBjYXNlICdmaWxsX2luX3dpdGhfY2hvaWNlcyc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gcS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgPGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJ0ZWFtX29wdCR7aX0iIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0iJHtpfSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdCR7aX0iPiR7b3B0fTwvbGFiZWw+PC9kaXY+YCkuam9pbignJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InRlYW1fb3B0X3RydWUiIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0idHJ1ZSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdF90cnVlIj7guYPguIrguYggLyDguJbguLnguIE8L2xhYmVsPjwvZGl2PjxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0idGVhbV9vcHRfZmFsc2UiIG5hbWU9InRlYW1fYW5zd2VyIiB2YWx1ZT0iZmFsc2UiIGNsYXNzPSJtci0yIGFjY2VudC1jeWFuLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0idGVhbV9vcHRfZmFsc2UiPuC5hOC4oeC5iOC5g+C4iuC5iCAvIOC4nOC4tOC4lDwvbGFiZWw+PC9kaXY+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzogY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBgPHRleHRhcmVhIG5hbWU9InRlYW1fYW5zd2VyIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJvd3M9IjMiIHJlcXVpcmVkIHBsYWNlaG9sZGVyPSLguJ7guLTguKHguJ7guYzguITguLPguJXguK3guJrguILguK3guIfguIHguKXguLjguYjguKEuLi4iPjwvdGV4dGFyZWE+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxzZWxlY3QgbmFtZT0idGVhbV9hbnN3ZXIiIGNsYXNzPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyIgcmVxdWlyZWQ+PG9wdGlvbiB2YWx1ZT0iIj4tLSDguYDguKXguLfguK3guIHguITguLPguJXguK3guJrguJfguLXguYjguITguLnguYjguIHguLHguJkgLS08L29wdGlvbj4ke3EuYWxsUmVzcG9uc2VzLm1hcChyZXNwID0+IGA8b3B0aW9uIHZhbHVlPSIke3Jlc3B9Ij4ke3Jlc3B9PC9vcHRpb24+YCkuam9pbignJyl9PC9zZWxlY3Q+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSAnPHAgY2xhc3M9InRleHQtcmVkLTUwMCI+4LmE4Lih4LmI4Lij4Li54LmJ4LiI4Lix4LiB4Lib4Lij4Liw4LmA4Lig4LiX4LiC4Lit4LiH4LiE4Liz4LiW4Liy4Lih4LiZ4Li14LmJPC9wPic7CiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0icC00IGZhZGUtaW4iPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIj7guILguYnguK3guJfguLXguYggJHtsb2NhbFF1ZXN0aW9uSW5kZXggKyAxfSAvICR7Y3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGh9PC9wPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIHRleHQtY3lhbi03MDAgbXktMiI+4LiB4Lil4Li44LmI4LihOiAke2xvY2FsVGVhbVBsYXllcnMuam9pbignLCAnKX08L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im15LTQgcC00IGJvcmRlciByb3VuZGVkLWxnIGJnLWdyYXktNTAiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1zZW1pYm9sZCBtYi0zIj4KICAgICAgICAgICAgICAgICAgICA8cD4ke2xvY2FsUXVlc3Rpb25JbmRleCArIDF9LiAke3F1ZXN0aW9uVGV4dEhUTUx9PC9wPgogICAgICAgICAgICAgICAgICAgICR7cS5pbWFnZUNvZGUgPyBgPGRpdiBjbGFzcz0ibXktNCBmbGV4IGp1c3RpZnktY2VudGVyIj4ke3EuaW1hZ2VDb2RlfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS0yIHRleHQtbGciPiR7b3B0aW9uc0hUTUx9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIGlkPSJzdWJtaXQtZ3JvdXAtYW5zd2VyLWJ0biIgY2xhc3M9InctZnVsbCBiZy1jeWFuLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctY3lhbi03MDAiPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFF1aXpBcmVhXSk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Ym1pdC1ncm91cC1hbnN3ZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVHcm91cEFuc3dlclN1Ym1pdCk7Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljKHRvcGljLCBsZXNzb25UZXh0ID0gbnVsbCwgcHJvamVjdElkLCBibHVlcHJpbnRUb3BpY0lkID0gbnVsbCwgZm9yY2VBcHBTdHlsZSA9IGZhbHNlLCBleHRyYVBhcnRzID0gbnVsbCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uKHRvcGljLCBncmFkZSkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctbW9kYWwnKTsKICAgIGNvbnN0IHRpdGxlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctdGl0bGUnKTsKICAgIGNvbnN0IGxvYWRlckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1sb2FkZXInKTsKICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXNlY3Rpb25zLWNvbnRhaW5lcicpOwoJCgkgICAgWydwb2ludENvbnRlbnQnLCAnbWVtb3J5Q29udGVudCcsICdhcHBsaWNhdGlvbkNvbnRlbnQnLCAnc3VtbWFyeUNvbnRlbnQnXS5mb3JFYWNoKGlkID0+IHsKICAgICAgICBjb25zdCBwYXJlbnRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnBhcmVudEVsZW1lbnQ7CiAgICAgICAgaWYgKHBhcmVudFNlY3Rpb24pIHsKICAgICAgICAgICAgcGFyZW50U2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CiAgICB9KTsKICAgIAogICAgLy8gMS4gUmVzZXQg4LmB4Lil4Liw4LmB4Liq4LiU4LiHIE1vZGFsIOC4nuC4o+C5ieC4reC4oSBMb2FkZXIKICAgIHRpdGxlRWwudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZOiAke3RvcGljfWA7CiAgICBjb250ZW50Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgbG9hZGVyRWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIAogICAgLy8gMi4g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGdlbmVyYXRlTGVzc29uIOC4l+C4teC5iOC5gOC4o+C4suC4hOC4seC4lOC4peC4reC4geC4oeC4sgogICAgZ2VuZXJhdGVMZXNzb24odG9waWMsIGdyYWRlKS5jYXRjaChlcnIgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBnZW5lcmF0ZSBsZXNzb246IiwgZXJyKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LiC4Lit4Lit4Lig4Lix4LiiLCDguYTguKHguYjguKrguLLguKHguLLguKPguJbguKrguKPguYnguLLguIfguJrguJfguYDguKPguLXguKLguJnguKrguLPguKvguKPguLHguJrguKvguLHguKfguILguYnguK3guJnguLXguYnguYTguJTguYkiKTsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsIOC4luC5ieC4suC5gOC4geC4tOC4lCBFcnJvcgogICAgfSk7Cn0KCmZ1bmN0aW9uIGhhbmRsZVBvaW50ZXJEb3duKGUpIHsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IGNhbnZhcyA9IHNjcmF0Y2hwYWRDdHguY2FudmFzOwogICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgIGNvbnN0IHBvaW50ZXJUeXBlID0gZS5wb2ludGVyVHlwZSB8fCAoZS50b3VjaGVzID8gJ3RvdWNoJyA6ICdtb3VzZScpOwogICAgCiAgICBpZiAocG9pbnRlclR5cGUgPT09ICdwZW4nIHx8IHBvaW50ZXJUeXBlID09PSAnbW91c2UnKSB7CiAgICAgICAgaWYgKGUucG9pbnRlclR5cGUgPT09ICdtb3VzZScgJiYgZS5idXR0b24gIT09IDApIHsgCiAgICAgICAgICAgIGlmIChlLmJ1dHRvbiA9PT0gMSkgeyAKICAgICAgICAgICAgICAgIGlzTW91c2VQYW5uaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHBhblN0YXJ0ID0geyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9OwogICAgICAgICAgICAgICAgY2FudmFzLnN0eWxlLmN1cnNvciA9ICdncmFiYmluZyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOyAKICAgICAgICB9CgkJCgkJICAgIGlmIChhY3RpdmVUb29sID09PSAndHJhaWwnKSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4Lih4Li1IFRpbWVyIOC4meC4seC4muC4luC4reC4ouC4q+C4peC4seC4h+C4reC4ouC4ueC5iCDguYPguKvguYnguKLguIHguYDguKXguLTguIHguJfguLHguJnguJfguLUKICAgICAgICAvLyDguJnguLXguYjguITguLfguK3guKrguYjguKfguJnguJfguLXguYjguJfguLPguYPguKvguYnguYDguKrguYnguJnguYDguIHguYjguLLguKLguLHguIfguYTguKHguYjguKvguLLguKLguYTguJvguYDguKHguLfguYjguK3guYDguKPguLLguYDguKPguLTguYjguKHguKfguLLguJTguYDguKrguYnguJnguYPguKvguKHguYgKICAgICAgICBpZiAobGFzZXJGYWRlVGltZXIpIHsKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGxhc2VyRmFkZVRpbWVyKTsKICAgICAgICB9CiAgICB9CgogICAgICAgIGlzRHJhd2luZ09uU2NyYXRjaHBhZCA9IHRydWU7CiAgICAgICAgcmVkb1N0cm9rZXMgPSBbXTsKICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZFBvaW50ID0gZ2V0VHJhbnNmb3JtZWRQb2ludChlLmNsaWVudFggLSByZWN0LmxlZnQsIGUuY2xpZW50WSAtIHJlY3QudG9wKTsKICAgICAgICAKICAgICAgICAvLyDguIHguLPguKvguJnguJTguITguLjguJPguKrguKHguJrguLHguJXguLTguILguK3guIfguYDguKrguYnguJnguJXguLLguKHguYDguITguKPguLfguYjguK3guIfguKHguLfguK3guJfguLXguYjguYDguKXguLfguK3guIEKICAgICAgICBsZXQgc3Ryb2tlUHJvcGVydGllcyA9IHsKICAgICAgICAgICAgdG9vbDogYWN0aXZlVG9vbCwKICAgICAgICAgICAgcG9pbnRzOiBbdHJhbnNmb3JtZWRQb2ludF0KICAgICAgICB9OwoKICAgICAgICBpZiAoYWN0aXZlVG9vbCA9PT0gJ3BlbicpIHsKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5jb2xvciA9IHNjcmF0Y2hwYWRQZW5Db2xvcjsKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5zaXplID0gc2NyYXRjaHBhZFBlblNpemU7CiAgICAgICAgfSBlbHNlIGlmIChhY3RpdmVUb29sID09PSAnZXJhc2VyJykgewogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLmNvbG9yID0gc2NyYXRjaHBhZFBlbkNvbG9yOyAvLyDguKrguLXguYTguKHguYjguKrguLPguITguLHguI3guKrguLPguKvguKPguLHguJrguKLguLLguIfguKXguJoKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5zaXplID0gc2NyYXRjaHBhZEVyYXNlclNpemU7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXSDguYPguIrguYnguJXguLHguKfguYHguJvguKPguYPguKvguKHguYgKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRvb2wgPT09ICdoaWdobGlnaHRlcicpIHsKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5jb2xvciA9IHNjcmF0Y2hwYWRIaWdobGlnaHRlckNvbG9yOwogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLnNpemUgPSBzY3JhdGNocGFkSGlnaGxpZ2h0ZXJTaXplOyAKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRvb2wgPT09ICd0cmFpbCcpIHsKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5jb2xvciA9IHNjcmF0Y2hwYWRQZW5Db2xvcjsKICAgICAgICAgICAgc3Ryb2tlUHJvcGVydGllcy5zaXplID0gc2NyYXRjaHBhZFBlblNpemU7IC8vIFRyYWlsIOC4ouC4seC4h+C4hOC4h+C5g+C4iuC5ieC4guC4meC4suC4lOC4guC4reC4h+C4m+C4suC4geC4geC4sgogICAgICAgIH0KCiAgICAgICAgY3VycmVudFN0cm9rZSA9IHN0cm9rZVByb3BlcnRpZXM7CgogICAgfSBlbHNlIGlmIChlLnRvdWNoZXMpIHsKICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgICBpc1Bhbm5pbmcgPSB0cnVlOwogICAgICAgICAgICBwYW5TdGFydCA9IGdldE1pZHBvaW50KHsgeDogZS50b3VjaGVzWzBdLmNsaWVudFgsIHk6IGUudG91Y2hlc1swXS5jbGllbnRZIH0sIHsgeDogZS50b3VjaGVzWzFdLmNsaWVudFgsIHk6IGUudG91Y2hlc1sxXS5jbGllbnRZIH0pOwogICAgICAgICAgICBpbml0aWFsUGluY2hEaXN0YW5jZSA9IGdldERpc3RhbmNlKHsgeDogZS50b3VjaGVzWzBdLmNsaWVudFgsIHk6IGUudG91Y2hlc1swXS5jbGllbnRZIH0sIHsgeDogZS50b3VjaGVzWzFdLmNsaWVudFgsIHk6IGUudG91Y2hlc1sxXS5jbGllbnRZIH0pOwogICAgICAgIH0KICAgIH0KfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBhbmltYXRlVHJhaWwg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApmdW5jdGlvbiBhbmltYXRlVHJhaWwoKSB7CiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgbGV0IGhhc0FjdGl2ZVRyYWlscyA9IGZhbHNlOwoKICAgIC8vIOC4p+C4meC4peC4ueC4m+C4iOC4suC4geC4q+C4peC4seC4h+C4oeC4suC4q+C4meC5ieC4suC5gOC4quC4oeC4rSDguYDguKHguLfguYjguK3guKHguLXguIHguLLguKPguKXguJogaXRlbSDguYPguJkgYXJyYXkKICAgIGZvciAobGV0IGkgPSBzdHJva2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgY29uc3Qgc3Ryb2tlID0gc3Ryb2tlc1tpXTsKCiAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LmA4LiJ4Lie4Liy4Liw4LmA4Liq4LmJ4LiZ4LiX4Li14LmI4LmA4Lib4LmH4LiZICd0cmFpbCcg4LmB4Lil4Liw4Lih4Li14LmA4Lin4Lil4LiyICLguYDguKPguLTguYjguKHguIjguLLguIfguKvguLLguKIiIOC5geC4peC5ieC4p+C5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgIGlmIChzdHJva2UudG9vbCA9PT0gJ3RyYWlsJyAmJiBzdHJva2UuZmFkZVN0YXJ0VGltZSkgewogICAgICAgICAgICBjb25zdCBlbGFwc2VkVGltZSA9IG5vdyAtIHN0cm9rZS5mYWRlU3RhcnRUaW1lOwoKICAgICAgICAgICAgaWYgKGVsYXBzZWRUaW1lID49IFRSQUlMX0RVUkFUSU9OKSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguKvguKHguJTguYDguKfguKXguLLguYHguKXguYnguKcg4LmD4Lir4LmJ4Lil4Lia4LmA4Liq4LmJ4LiZ4LiZ4Li14LmJ4LiX4Li04LmJ4LiH4LmE4Lib4LmA4Lil4LiiCiAgICAgICAgICAgICAgICBzdHJva2VzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC4q+C4oeC4lOC5gOC4p+C4peC4siDguYPguKvguYnguITguLPguJnguKfguJPguITguKfguLLguKHguYLguJvguKPguYjguIfguYPguKoKICAgICAgICAgICAgICAgIHN0cm9rZS5vcGFjaXR5ID0gMSAtIChlbGFwc2VkVGltZSAvIFRSQUlMX0RVUkFUSU9OKTsKICAgICAgICAgICAgICAgIGhhc0FjdGl2ZVRyYWlscyA9IHRydWU7IC8vIOC4muC4reC4geC5g+C4q+C5ieC4o+C4ueC5ieC4p+C5iOC4suC4ouC4seC4h+C4leC5ieC4reC4h+C4l+C4syBhbmltYXRpb24g4LiV4LmI4LitCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIOC4p+C4suC4lCBDYW52YXMg4LmD4Lir4Lih4LmICiAgICByZWRyYXdTY3JhdGNocGFkKCk7CgogICAgLy8g4LiW4LmJ4Liy4Lii4Lix4LiH4Lih4Li14LmA4Liq4LmJ4LiZ4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiX4LizIGFuaW1hdGlvbiDguK3guKLguLnguYgg4LmD4Lir4LmJ4Lin4LiZIExvb3Ag4LiV4LmI4Lit4LmE4LibCiAgICBpZiAoaGFzQWN0aXZlVHJhaWxzKSB7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVUcmFpbCk7CiAgICB9IGVsc2UgewogICAgICAgIGlzQW5pbWF0aW5nVHJhaWwgPSBmYWxzZTsgLy8g4Lir4Lii4Li44LiUIGFuaW1hdGlvbgogICAgfQp9CgpmdW5jdGlvbiBzdGFydFRyYWlsQW5pbWF0aW9uKCkgewogICAgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LmA4Lij4Li14Lii4LiBIGFuaW1hdGlvbiDguIvguYnguLPguIvguYnguK3guJkKICAgIGlmICghaXNBbmltYXRpbmdUcmFpbCkgewogICAgICAgIGlzQW5pbWF0aW5nVHJhaWwgPSB0cnVlOwogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlVHJhaWwpOwogICAgfQp9CgpmdW5jdGlvbiBkcmF3U3Ryb2tlKHN0cm9rZSkgewogICAgaWYgKCFzdHJva2UgfHwgc3Ryb2tlLnBvaW50cy5sZW5ndGggPCAxKSByZXR1cm47CgogICAgc2NyYXRjaHBhZEN0eC5zYXZlKCk7CiAgICBzY3JhdGNocGFkQ3R4LmxpbmVKb2luID0gJ3JvdW5kJzsKICAgIHNjcmF0Y2hwYWRDdHgubGluZUNhcCA9ICdyb3VuZCc7CgogICAgaWYgKHN0cm9rZS50b29sID09PSAndHJhaWwnKSB7CiAgICAgICAgY29uc3QgYWRqdXN0ZWRTaXplID0gc3Ryb2tlLnNpemUgLyBzY3JhdGNocGFkU2NhbGU7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5nbG9iYWxBbHBoYSA9IHN0cm9rZS5vcGFjaXR5ID8/IDEuMDsgCiAgICAgICAgc2NyYXRjaHBhZEN0eC5zaGFkb3dDb2xvciA9ICdyZ2JhKDIzOSwgNjgsIDY4LCAwLjkpJzsKICAgICAgICBzY3JhdGNocGFkQ3R4LnNoYWRvd0JsdXIgPSBhZGp1c3RlZFNpemUgKiAzOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyMzksIDY4LCA2OCwgMC43KSc7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5saW5lV2lkdGggPSBhZGp1c3RlZFNpemUgKiAyLjU7CiAgICAgICAgCiAgICAgICAgc2NyYXRjaHBhZEN0eC5iZWdpblBhdGgoKTsKICAgICAgICBzY3JhdGNocGFkQ3R4Lm1vdmVUbyhzdHJva2UucG9pbnRzWzBdLngsIHN0cm9rZS5wb2ludHNbMF0ueSk7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdHJva2UucG9pbnRzLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgICBjb25zdCBtaWRQb2ludCA9IGdldE1pZHBvaW50KHN0cm9rZS5wb2ludHNbaV0sIHN0cm9rZS5wb2ludHNbaSArIDFdKTsKICAgICAgICAgICAgc2NyYXRjaHBhZEN0eC5xdWFkcmF0aWNDdXJ2ZVRvKHN0cm9rZS5wb2ludHNbaV0ueCwgc3Ryb2tlLnBvaW50c1tpXS55LCBtaWRQb2ludC54LCBtaWRQb2ludC55KTsKICAgICAgICB9CiAgICAgICAgc2NyYXRjaHBhZEN0eC5zdHJva2UoKTsKICAgICAgICAKICAgICAgICBzY3JhdGNocGFkQ3R4LnNoYWRvd0NvbG9yID0gJ3RyYW5zcGFyZW50JzsKICAgICAgICBzY3JhdGNocGFkQ3R4LnNoYWRvd0JsdXIgPSAwOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlU3R5bGUgPSAnI0ZGRkZGRic7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5saW5lV2lkdGggPSBhZGp1c3RlZFNpemU7CiAgICAgICAgCiAgICAgICAgc2NyYXRjaHBhZEN0eC5zdHJva2UoKTsgLy8gUmUtc3Ryb2tlIHRoZSBjZW50ZXIgbGluZQogICAgICAgIHNjcmF0Y2hwYWRDdHguY2xvc2VQYXRoKCk7CgogICAgfSBlbHNlIGlmIChzdHJva2UudG9vbCA9PT0gJ2hpZ2hsaWdodGVyJykgewogICAgICAgIC8vIOC5g+C4iuC5iSAnbXVsdGlwbHknIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4quC4teC4i+C5ieC4reC4meC4l+C4seC4muC4geC4seC4meC5geC4peC5ieC4p+C5gOC4guC5ieC4oeC4guC4tuC5ieC4meC5gOC4q+C4oeC4t+C4reC4meC5hOC4ruC5hOC4peC4l+C5jOC4iOC4o+C4tOC4hwogICAgICAgIHNjcmF0Y2hwYWRDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ211bHRpcGx5JzsKICAgICAgICBzY3JhdGNocGFkQ3R4LnN0cm9rZVN0eWxlID0gc3Ryb2tlLmNvbG9yOyAvLyDguIjguLDguYDguJvguYfguJnguKrguLXguYHguJrguJogcmdiYShyLCBnLCBiLCAwLjUpCiAgICAgICAgc2NyYXRjaHBhZEN0eC5saW5lV2lkdGggPSBzdHJva2Uuc2l6ZTsKICAgICAgICAKICAgICAgICBzY3JhdGNocGFkQ3R4LmJlZ2luUGF0aCgpOwogICAgICAgIHNjcmF0Y2hwYWRDdHgubW92ZVRvKHN0cm9rZS5wb2ludHNbMF0ueCwgc3Ryb2tlLnBvaW50c1swXS55KTsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN0cm9rZS5wb2ludHMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG1pZFBvaW50ID0gZ2V0TWlkcG9pbnQoc3Ryb2tlLnBvaW50c1tpXSwgc3Ryb2tlLnBvaW50c1tpICsgMV0pOwogICAgICAgICAgICBzY3JhdGNocGFkQ3R4LnF1YWRyYXRpY0N1cnZlVG8oc3Ryb2tlLnBvaW50c1tpXS54LCBzdHJva2UucG9pbnRzW2ldLnksIG1pZFBvaW50LngsIG1pZFBvaW50LnkpOwogICAgICAgIH0KICAgICAgICBzY3JhdGNocGFkQ3R4LnN0cm9rZSgpOwogICAgICAgIHNjcmF0Y2hwYWRDdHguY2xvc2VQYXRoKCk7CgogICAgfSBlbHNlIHsgLy8g4Liq4Liz4Lir4Lij4Lix4LiaICdwZW4nIOC5geC4peC4sCAnZXJhc2VyJwogICAgICAgIHNjcmF0Y2hwYWRDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gc3Ryb2tlLnRvb2wgPT09ICdlcmFzZXInID8gJ2Rlc3RpbmF0aW9uLW91dCcgOiAnc291cmNlLW92ZXInOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlU3R5bGUgPSBzdHJva2UuY29sb3I7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5saW5lV2lkdGggPSBzdHJva2Uuc2l6ZTsKICAgICAgICAKICAgICAgICBzY3JhdGNocGFkQ3R4LmJlZ2luUGF0aCgpOwogICAgICAgIHNjcmF0Y2hwYWRDdHgubW92ZVRvKHN0cm9rZS5wb2ludHNbMF0ueCwgc3Ryb2tlLnBvaW50c1swXS55KTsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN0cm9rZS5wb2ludHMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG1pZFBvaW50ID0gZ2V0TWlkcG9pbnQoc3Ryb2tlLnBvaW50c1tpXSwgc3Ryb2tlLnBvaW50c1tpICsgMV0pOwogICAgICAgICAgICBzY3JhdGNocGFkQ3R4LnF1YWRyYXRpY0N1cnZlVG8oc3Ryb2tlLnBvaW50c1tpXS54LCBzdHJva2UucG9pbnRzW2ldLnksIG1pZFBvaW50LngsIG1pZFBvaW50LnkpOwogICAgICAgIH0KICAgICAgICBzY3JhdGNocGFkQ3R4LnN0cm9rZSgpOwogICAgICAgIHNjcmF0Y2hwYWRDdHguY2xvc2VQYXRoKCk7CiAgICB9CiAgICAKICAgIHNjcmF0Y2hwYWRDdHgucmVzdG9yZSgpOwp9CgpmdW5jdGlvbiBoYW5kbGVQb2ludGVyTW92ZShlKSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBjYW52YXMgPSBzY3JhdGNocGFkQ3R4LmNhbnZhczsKICAgIGNvbnN0IHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgaWYgKGUudG91Y2hlcykgeyAvLyBUb3VjaCBFdmVudHMKICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PT0gMSAmJiBpc0RyYXdpbmdPblNjcmF0Y2hwYWQpIHsKICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWRQb2ludCA9IGdldFRyYW5zZm9ybWVkUG9pbnQoZS50b3VjaGVzWzBdLmNsaWVudFggLSByZWN0LmxlZnQsIGUudG91Y2hlc1swXS5jbGllbnRZIC0gcmVjdC50b3ApOwogICAgICAgICAgICBjdXJyZW50U3Ryb2tlLnBvaW50cy5wdXNoKHRyYW5zZm9ybWVkUG9pbnQpOwogICAgICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICAgICAgfSBlbHNlIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAyICYmIGlzUGFubmluZykgewogICAgICAgICAgICAvLyAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICBjb25zdCBjdXJyZW50UGluY2hEaXN0YW5jZSA9IGdldERpc3RhbmNlKHsgeDogZS50b3VjaGVzWzBdLmNsaWVudFgsIHk6IGUudG91Y2hlc1swXS5jbGllbnRZIH0sIHsgeDogZS50b3VjaGVzWzFdLmNsaWVudFgsIHk6IGUudG91Y2hlc1sxXS5jbGllbnRZIH0pOwogICAgICAgICAgICBjb25zdCBtaWRQb2ludCA9IGdldE1pZHBvaW50KHsgeDogZS50b3VjaGVzWzBdLmNsaWVudFgsIHk6IGUudG91Y2hlc1swXS5jbGllbnRZIH0sIHsgeDogZS50b3VjaGVzWzFdLmNsaWVudFgsIHk6IGUudG91Y2hlc1sxXS5jbGllbnRZIH0pOwogICAgICAgICAgICBjb25zdCBzY2FsZUZhY3RvciA9IGN1cnJlbnRQaW5jaERpc3RhbmNlIC8gaW5pdGlhbFBpbmNoRGlzdGFuY2U7CiAgICAgICAgICAgIGNvbnN0IG5ld1NjYWxlID0gTWF0aC5taW4oTWF0aC5tYXgoc2NyYXRjaHBhZFNjYWxlICogc2NhbGVGYWN0b3IsIE1JTl9TQ0FMRSksIE1BWF9TQ0FMRSk7CiAgICAgICAgICAgIGNvbnN0IGR4ID0gbWlkUG9pbnQueCAtIHBhblN0YXJ0Lng7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gbWlkUG9pbnQueSAtIHBhblN0YXJ0Lnk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRPZmZzZXQueCA9IG1pZFBvaW50LnggLSAobWlkUG9pbnQueCAtIHNjcmF0Y2hwYWRPZmZzZXQueCkgKiAobmV3U2NhbGUgLyBzY3JhdGNocGFkU2NhbGUpOwogICAgICAgICAgICBzY3JhdGNocGFkT2Zmc2V0LnkgPSBtaWRQb2ludC55IC0gKG1pZFBvaW50LnkgLSBzY3JhdGNocGFkT2Zmc2V0LnkpICogKG5ld1NjYWxlIC8gc2NyYXRjaHBhZFNjYWxlKTsKICAgICAgICAgICAgc2NyYXRjaHBhZE9mZnNldC54ICs9IGR4OwogICAgICAgICAgICBzY3JhdGNocGFkT2Zmc2V0LnkgKz0gZHk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRTY2FsZSA9IG5ld1NjYWxlOwogICAgICAgICAgICBpbml0aWFsUGluY2hEaXN0YW5jZSA9IGN1cnJlbnRQaW5jaERpc3RhbmNlOwogICAgICAgICAgICBwYW5TdGFydCA9IG1pZFBvaW50OwogICAgICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICAgICAgfQogICAgfSBlbHNlIHsgLy8gTW91c2UgRXZlbnQKICAgICAgICAvLyDilrzilrzilrwtLS0g4LmB4LiB4LmJ4LmE4LiCL+C5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lOC5g+C4meC4quC5iOC4p+C4meC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS3ilrzilrzilrwKICAgICAgICBpZiAoaXNNb3VzZVBhbm5pbmcpIHsKICAgICAgICAgICAgY29uc3QgZHggPSBlLmNsaWVudFggLSBwYW5TdGFydC54OwogICAgICAgICAgICBjb25zdCBkeSA9IGUuY2xpZW50WSAtIHBhblN0YXJ0Lnk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRPZmZzZXQueCArPSBkeDsKICAgICAgICAgICAgc2NyYXRjaHBhZE9mZnNldC55ICs9IGR5OwogICAgICAgICAgICBwYW5TdGFydCA9IHsgeDogZS5jbGllbnRYLCB5OiBlLmNsaWVudFkgfTsKICAgICAgICAgICAgcmVkcmF3U2NyYXRjaHBhZCgpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEcmF3aW5nT25TY3JhdGNocGFkKSB7CiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkUG9pbnQgPSBnZXRUcmFuc2Zvcm1lZFBvaW50KGUuY2xpZW50WCAtIHJlY3QubGVmdCwgZS5jbGllbnRZIC0gcmVjdC50b3ApOwogICAgICAgICAgICBjdXJyZW50U3Ryb2tlLnBvaW50cy5wdXNoKHRyYW5zZm9ybWVkUG9pbnQpOwogICAgICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICAgICAgfQogICAgICAgIC8vIOKWsuKWsuKWsi0tLSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0t4pay4pay4payCiAgICB9Cn0KCmZ1bmN0aW9uIGhhbmRsZVBvaW50ZXJVcChlKSB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICBjb25zdCBjYW52YXMgPSBzY3JhdGNocGFkQ3R4LmNhbnZhczsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQoKICAgIC8vIOKWvOKWvOKWvC0tLSDguYDguJ7guLTguYjguKHguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYkgLS0t4pa84pa84pa8CiAgICBpZiAoaXNNb3VzZVBhbm5pbmcpIHsKICAgICAgICBpc01vdXNlUGFubmluZyA9IGZhbHNlOwogICAgICAgIGNhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7IC8vIOC5gOC4m+C4peC4teC5iOC4ouC4mSBjdXJzb3Ig4LiB4Lil4Lix4Lia4LmA4Lib4LmH4LiZ4Lib4LiB4LiV4Li0CiAgICB9CiAgICAvLyDilrLilrLilrItLS0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmA4Lie4Li04LmI4LihIC0tLeKWsuKWsuKWsgoKICAgIGlzUGFubmluZyA9IGZhbHNlOwogICAgaW5pdGlhbFBpbmNoRGlzdGFuY2UgPSBudWxsOwoKICAgIGlmIChpc0RyYXdpbmdPblNjcmF0Y2hwYWQpIHsKICAgICAgICBpc0RyYXdpbmdPblNjcmF0Y2hwYWQgPSBmYWxzZTsKICAgICAgICBpZiAoY3VycmVudFN0cm9rZSAmJiBjdXJyZW50U3Ryb2tlLnBvaW50cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHN0cm9rZXMucHVzaChjdXJyZW50U3Ryb2tlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguYLguITguYnguJTguJrguKXguYfguK3guIHguJnguLXguYnguYDguILguYnguLLguYTguJsg4pa84pa84pa8CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4quC5ieC4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4h+C4p+C4suC4lOC5gOC4quC4o+C5h+C4iOC5gOC4m+C5h+C4mSB0cmFpbCDguYPguKvguYnguYDguKPguLTguYjguKEgYW5pbWF0aW9uCmlmIChjdXJyZW50U3Ryb2tlLnRvb2wgPT09ICd0cmFpbCcpIHsKICAgIC8vIOC4ouC4geC5gOC4peC4tOC4gSBUaW1lciDguYDguIHguYjguLLguJfguLXguYjguK3guLLguIjguIjguLDguIHguLPguKXguLHguIfguJfguLPguIfguLLguJkgKOC4geC4o+C4k+C4teC4hOC4peC4tOC4geC5gOC4o+C5h+C4p+C5hikKICAgIGlmIChsYXNlckZhZGVUaW1lcikgewogICAgICAgIGNsZWFyVGltZW91dChsYXNlckZhZGVUaW1lcik7CiAgICB9CiAgICAKICAgIC8vIOC4leC4seC5ieC4hyBUaW1lciDguYPguKvguKHguYjguYDguJ7guLfguYjguK3guJnguLHguJrguJbguK3guKLguKvguKXguLHguIcKICAgIGxhc2VyRmFkZVRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgLy8g4LmA4Lih4Li34LmI4LitIFRpbWVyIOC4l+C4s+C4h+C4suC4meC4iOC4meC4hOC4o+C4miAo4Lir4Lih4Liy4Lii4LiE4Lin4Liy4Lih4Lin4LmI4Liy4Lic4Li54LmJ4LmD4LiK4LmJ4Lir4Lii4Li44LiU4Lin4Liy4LiU4LmB4Lil4LmJ4LinKQogICAgICAgIC8vIDEuIOC4hOC5ieC4meC4q+C4suC5gOC4quC5ieC4mSB0cmFpbCDguJfguLHguYnguIfguKvguKHguJTguJfguLXguYjguKLguLHguIfguYTguKHguYjguJbguLnguIHguKrguLHguYjguIfguYPguKvguYnguIjguLLguIfguKvguLLguKIKICAgICAgICBjb25zdCBzdHJva2VzVG9GYWRlID0gc3Ryb2tlcy5maWx0ZXIocyA9PiBzLnRvb2wgPT09ICd0cmFpbCcgJiYgIXMuZmFkZVN0YXJ0VGltZSk7CgogICAgICAgIGlmIChzdHJva2VzVG9GYWRlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgLy8gMi4g4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4LiX4Li44LiB4LmA4Liq4LmJ4LiZ4LmA4Lij4Li04LmI4Lih4LiI4Liy4LiH4Lir4Liy4LiiIOC4kyDguYDguKfguKXguLLguYDguJTguLXguKLguKfguIHguLHguJkKICAgICAgICAgICAgc3Ryb2tlc1RvRmFkZS5mb3JFYWNoKHMgPT4gcy5mYWRlU3RhcnRUaW1lID0gbm93KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIOC5gOC4o+C4tOC5iOC4oSBBbmltYXRpb24g4LiB4Liy4Lij4LiI4Liy4LiH4Lir4Liy4LiiCiAgICAgICAgICAgIHN0YXJ0VHJhaWxBbmltYXRpb24oKTsKICAgICAgICB9CgogICAgfSwgTEFTRVJfSU5BQ1RJVklUWV9USU1FT1VUKTsgLy8g4Lij4LitIDEuNSDguKfguLTguJnguLLguJfguLXguIHguYjguK3guJnguYDguKPguLTguYjguKHguJfguLPguIfguLLguJkKfQogICAgICAgIH0KICAgICAgICBjdXJyZW50U3Ryb2tlID0gbnVsbDsKICAgICAgICB1cGRhdGVVbmRvUmVkb0J1dHRvbnMoKTsKICAgIH0KfQoKLy8g4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LiL4Li54Lih4LiU4LmJ4Lin4LiiIE1vdXNlIFdoZWVsCmZ1bmN0aW9uIGhhbmRsZVdoZWVsKGUpIHsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IHNjYWxlQW1vdW50ID0gZS5kZWx0YVkgKiAtMC4wMDU7CiAgICBjb25zdCBuZXdTY2FsZSA9IE1hdGgubWluKE1hdGgubWF4KHNjcmF0Y2hwYWRTY2FsZSArIHNjYWxlQW1vdW50LCBNSU5fU0NBTEUpLCBNQVhfU0NBTEUpOwoKICAgIC8vIEFkanVzdCBvZmZzZXQgdG8gem9vbSB0b3dhcmRzIHRoZSBtb3VzZSBwb2ludGVyCiAgICBzY3JhdGNocGFkT2Zmc2V0LnggPSBlLmNsaWVudFggLSAoZS5jbGllbnRYIC0gc2NyYXRjaHBhZE9mZnNldC54KSAqIChuZXdTY2FsZSAvIHNjcmF0Y2hwYWRTY2FsZSk7CiAgICBzY3JhdGNocGFkT2Zmc2V0LnkgPSBlLmNsaWVudFkgLSAoZS5jbGllbnRZIC0gc2NyYXRjaHBhZE9mZnNldC55KSAqIChuZXdTY2FsZSAvIHNjcmF0Y2hwYWRTY2FsZSk7CgogICAgc2NyYXRjaHBhZFNjYWxlID0gbmV3U2NhbGU7CiAgICByZWRyYXdTY3JhdGNocGFkKCk7Cn0KCmZ1bmN0aW9uIHVuZG8oKSB7CiAgICBpZiAoc3Ryb2tlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVkb1N0cm9rZXMucHVzaChzdHJva2VzLnBvcCgpKTsKICAgICAgICB1cGRhdGVVbmRvUmVkb0J1dHRvbnMoKTsKICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHJlZG8oKSB7CiAgICBpZiAocmVkb1N0cm9rZXMubGVuZ3RoID4gMCkgewogICAgICAgIHN0cm9rZXMucHVzaChyZWRvU3Ryb2tlcy5wb3AoKSk7CiAgICAgICAgdXBkYXRlVW5kb1JlZG9CdXR0b25zKCk7CiAgICAgICAgcmVkcmF3U2NyYXRjaHBhZCgpOwogICAgfQp9CgpmdW5jdGlvbiB1cGRhdGVVbmRvUmVkb0J1dHRvbnMoKSB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndW5kby1idG4nKS5kaXNhYmxlZCA9IHN0cm9rZXMubGVuZ3RoID09PSAwOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZG8tYnRuJykuZGlzYWJsZWQgPSByZWRvU3Ryb2tlcy5sZW5ndGggPT09IDA7Cn0KCmZ1bmN0aW9uIG9wZW5TY3JhdGNocGFkKHF1ZXN0aW9uLCBvcHRpb25zKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JhdGNocGFkLW1vZGFsJyk7CiAgICBjb25zdCBxdWVzdGlvbkVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtcXVlc3Rpb24nKTsKICAgIGNvbnN0IG9wdGlvbnNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JhdGNocGFkLW9wdGlvbnMnKTsKICAgIGNvbnN0IGNvbnRyb2xzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtY29udHJvbHMnKTsgLy8g4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4Lit4Liy4LiI4Lii4Lix4LiH4Lit4Lii4Li54LmIICjguYTguKHguYjguYDguJvguYfguJnguYTguKMpCgogICAgcXVlc3Rpb25FbC5pbm5lckhUTUwgPSBxdWVzdGlvbi5zdGVtIHx8IHF1ZXN0aW9uLnF1ZXN0aW9uVGV4dDsKICAgIG9wdGlvbnNFbC5pbm5lckhUTUwgPSBvcHRpb25zLm1hcCgob3B0LCBpbmRleCkgPT4gYDxkaXY+JHtTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpfS4gJHtvcHR9PC9kaXY+YCkuam9pbignJyk7CiAgICAKICAgIC8vIOC5guC4hOC5ieC4lOC4l+C4teC5iOC4quC4o+C5ieC4suC4hyBpbm5lckhUTUwg4LiC4Lit4LiHIGNvbnRyb2xzQ29udGFpbmVyIOC4luC4ueC4geC4peC4muC5hOC4m+C5geC4peC5ieC4pwoKICAgIHNldHVwU2NyYXRjaHBhZENvbnRyb2xzKCk7IC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC5gOC4nuC4t+C5iOC4reC4quC4o+C5ieC4suC4hyBUb29sYmFyIOC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hwogICAgCiAgICAvLyDguKPguLXguYDguIvguYfguJXguKrguJbguLLguJnguLDguJfguLHguYnguIfguKvguKHguJTguIHguYjguK3guJnguYDguJvguLTguJQKICAgIHN0cm9rZXMgPSBbXTsKICAgIHJlZG9TdHJva2VzID0gW107CiAgICBjdXJyZW50U3Ryb2tlID0gbnVsbDsKICAgIHNjcmF0Y2hwYWRTY2FsZSA9IDE7CiAgICBzY3JhdGNocGFkT2Zmc2V0ID0geyB4OiAwLCB5OiAwIH07CiAgICAKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaW5pdGlhbGl6ZVNjcmF0Y2hwYWRDYW52YXMoKTsKICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICB9LCA1MCk7CgogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtxdWVzdGlvbkVsLCBvcHRpb25zRWxdKTsKfQoKLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKCi8qKgogKiBb4LmD4Lir4Lih4LmIXSDguYDguJvguLTguJQgTW9kYWwg4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCDguYHguKXguLDguIjguLHguJTguIHguLLguKPguIHguLLguKPguJrguLHguJnguJfguLbguIHguIrguLHguYjguKfguITguKPguLLguKcKICovCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgb3BlbkJsdWVwcmludFF1aXpTZXR0aW5ncyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8Ci8qKgogKiBb4LmD4Lir4Lih4LmIXSDguYDguJvguLTguJQgTW9kYWwg4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LiJ4Lia4Lix4Lia4Liq4Lih4Lia4Li54Lij4LiT4LmM4Liq4Liz4Lir4Lij4Lix4Lia4Lir4LiZ4LmJ4LiyIEJsdWVwcmludAogKi8KZnVuY3Rpb24gb3BlbkJsdWVwcmludFF1aXpTZXR0aW5ncygpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zZXR0aW5ncy1tb2RhbCcpOwoKICAgIC8vIDEuIOC4geC4s+C4q+C4meC4lOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mTog4LmD4LiK4LmJ4LiE4LmI4Liy4LiX4Li14LmI4Lia4Lix4LiZ4LiX4Li24LiB4LmE4Lin4LmJ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinICjguJbguYnguLLguKHguLUpIOC4q+C4o+C4t+C4reC5g+C4iuC5ieC4hOC5iOC4suC4iOC4suC4geC5guC4m+C4o+C5gOC4iOC4hOC4q+C4peC4seC4gQogICAgY29uc3Qgc2V0dGluZ3MgPSBibHVlcHJpbnRQYWdlU2V0dGluZ3MgfHwgKGN1cnJlbnRQcm9qZWN0RGF0YSA/IGN1cnJlbnRQcm9qZWN0RGF0YS5zZXR0aW5ncyA6IHt9KSB8fCB7fTsKCiAgICAvLyAyLiDguJnguLPguITguYjguLLguYTguJvguYPguKrguYjguYPguJnguJ/guK3guKPguYzguKHguILguK3guIcgTW9kYWwgKOC5g+C4iuC5iSBJRCDguJfguLXguYjguKHguLUgYnAtbW9kYWwtIOC4meC4s+C4q+C4meC5ieC4sikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1xdWl6LXR5cGUtc2VsZWN0JykudmFsdWUgPSBzZXR0aW5ncy5xdWl6VHlwZSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei10eXBlLXNlbGVjdCcpLnZhbHVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLWRpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykuaW5uZXJIVE1MID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykuaW5uZXJIVE1MOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLWRpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykudmFsdWUgPSBzZXR0aW5ncy5kaWZmaWN1bHR5VmFsdWUgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykudmFsdWU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtcXVlc3Rpb24tY29tcGxleGl0eS1zZWxlY3QnKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVlc3Rpb24tY29tcGxleGl0eS1zZWxlY3QnKS5pbm5lckhUTUw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtcXVlc3Rpb24tY29tcGxleGl0eS1zZWxlY3QnKS52YWx1ZSA9IHNldHRpbmdzLmNvbXBsZXhpdHlWYWx1ZSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVlc3Rpb24tY29tcGxleGl0eS1zZWxlY3QnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1udW0tcXVlc3Rpb25zJykudmFsdWUgPSBzZXR0aW5ncy5udW1RdWVzdGlvbnMgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1xdWVzdGlvbnMnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1wYXNzaW5nLXNjb3JlLWlucHV0JykudmFsdWUgPSBzZXR0aW5ncy5wYXNzaW5nU2NvcmUgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3Npbmctc2NvcmUtaW5wdXQnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1udW0tY2hvaWNlcycpLnZhbHVlID0gc2V0dGluZ3MubnVtQ2hvaWNlcyB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLWNob2ljZXMnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1zaHVmZmxlLXNldHRpbmctc2VsZWN0JykudmFsdWUgPSBzZXR0aW5ncy5zaHVmZmxlIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaHVmZmxlLXNldHRpbmctc2VsZWN0JykudmFsdWU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtaW5jbHVkZS1pbWFnZXMtY2hlY2tib3gnKS5jaGVja2VkID0gc2V0dGluZ3MuaW5jbHVkZUltYWdlcyB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5jbHVkZS1pbWFnZXMtY2hlY2tib3gnKS5jaGVja2VkOwoKICAgIC8vIDMuIOC5geC4quC4lOC4hyBNb2RhbAogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguYPguJkgPHNjcmlwdD4g4pa84pa84pa8Ci8qKgogKiBb4LmD4Lir4Lih4LmIXSDguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguIjguLLguIEgTW9kYWwg4Lil4LiH4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4Lij4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinIGJsdWVwcmludFBhZ2VTZXR0aW5ncwogKi8KZnVuY3Rpb24gaGFuZGxlU2F2ZUJsdWVwcmludFBhZ2VTZXR0aW5ncygpIHsKICAgIGJsdWVwcmludFBhZ2VTZXR0aW5ncyA9IHsKICAgICAgICBxdWl6VHlwZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXF1aXotdHlwZS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICBkaWZmaWN1bHR5VmFsdWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1kaWZmaWN1bHR5LWxldmVsLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIGNvbXBsZXhpdHlWYWx1ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXF1ZXN0aW9uLWNvbXBsZXhpdHktc2VsZWN0JykudmFsdWUsCiAgICAgICAgbnVtUXVlc3Rpb25zOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtbnVtLXF1ZXN0aW9ucycpLnZhbHVlLAogICAgICAgIHBhc3NpbmdTY29yZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXBhc3Npbmctc2NvcmUtaW5wdXQnKS52YWx1ZSwKICAgICAgICBudW1DaG9pY2VzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtbnVtLWNob2ljZXMnKS52YWx1ZSwKICAgICAgICBzaHVmZmxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtc2h1ZmZsZS1zZXR0aW5nLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIGluY2x1ZGVJbWFnZXM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1pbmNsdWRlLWltYWdlcy1jaGVja2JveCcpLmNoZWNrZWQsCiAgICB9OwoKICAgIHNob3dNZXNzYWdlKCLguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguYPguJnguKvguJnguYnguLLguJnguLXguYnguYHguKXguYnguKciKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtc2V0dGluZ3MtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfQoKLy8g4pa84pa84pa8IFNUQVJUOiDguKfguLLguIfguYLguITguYnguJTguIrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguJfguLHguYnguIfguKvguKHguJTguYDguILguYnguLLguYTguJvguYPguJkgPHNjcmlwdD4g4pa84pa84pa8CgovKioKICogW1BhcmFsbGVsIFNob3J0Y3V0c10g4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiBIEZpcmVzdG9yZQogKi8KZnVuY3Rpb24gbGlzdGVuRm9yUGFyYWxsZWxUZXN0U2hvcnRjdXRzKCkgewogICAgY29uc3Qgc2hvcnRjdXRzUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAicGFyYWxsZWxUZXN0U2hvcnRjdXRzQ29uZmlnIik7CgogICAgb25TbmFwc2hvdChzaG9ydGN1dHNSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgbGV0IHNob3J0Y3V0cyA9IFtdOwogICAgICAgIGxldCB0YWJzID0gW107CiAgICAgICAgbGV0IG9yZGVyID0ge307CgogICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgc2hvcnRjdXRzID0gZGF0YS5zaG9ydGN1dHMgfHwgW107CiAgICAgICAgICAgIHRhYnMgPSBkYXRhLnBhcmFsbGVsU2hvcnRjdXRUYWJzIHx8IFtdOyAvLyA8LS0gW+C5geC4geC5ieC5hOC4gl0KICAgICAgICAgICAgb3JkZXIgPSBkYXRhLnBhcmFsbGVsU2hvcnRjdXRPcmRlciB8fCB7fTsgICAvLyA8LS0gW+C5geC4geC5ieC5hOC4gl0KICAgICAgICB9CgogICAgICAgIGlmICghdGFicy5maW5kKHQgPT4gdC5pZCA9PT0gJ2FsbCcpKSB7CiAgICAgICAgICAgIHRhYnMudW5zaGlmdCh7IGlkOiAnYWxsJywgbmFtZTogJ+C4leC5ieC4meC4ieC4muC4seC4muC4l+C4seC5ieC4h+C4q+C4oeC4lCcsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGlmICghc2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSAncGFyYWxsZWwtZGVmYXVsdC0xJykpIHsKICAgICAgICAgICAgc2hvcnRjdXRzLnVuc2hpZnQoeyBpZDogJ3BhcmFsbGVsLWRlZmF1bHQtMScsIG5hbWU6ICfguJXguYnguJnguInguJrguLHguJogMScsIHVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdwYXJhbGxlbC1kZWZhdWx0LTInKSkgewogICAgICAgICAgICBzaG9ydGN1dHMudW5zaGlmdCh7IGlkOiAncGFyYWxsZWwtZGVmYXVsdC0yJywgbmFtZTogJ+C4leC5ieC4meC4ieC4muC4seC4miAyJywgdXJsOiAnJywgaXNEZWZhdWx0OiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgcGFyYWxsZWxUZXN0U2hvcnRjdXRzID0gc2hvcnRjdXRzOwogICAgICAgIHBhcmFsbGVsU2hvcnRjdXRUYWJzID0gdGFiczsgLy8gPC0tIFvguYHguIHguYnguYTguIJdCiAgICAgICAgcGFyYWxsZWxTaG9ydGN1dE9yZGVyID0gb3JkZXI7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXQoKICAgICAgICByZW5kZXJQYXJhbGxlbFRlc3RTaG9ydGN1dHMoKTsKCiAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7CiAgICAgICAgICAgIHJlbmRlckFkZGl0aW9uYWxQYXJhbGxlbFNob3J0Y3V0c01vZGFsKCk7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXQogICAgICAgIH0KICAgIH0pOwp9CgovLyDilrzilrzilrwgW+C5g+C4q+C4oeC5iF0g4LmA4Lie4Li04LmI4Lih4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiI4Lix4LiU4LiB4Liy4LijIFBhcmFsbGVsIFRlc3QgU2hvcnRjdXQgVGFicyDguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8Cgphc3luYyBmdW5jdGlvbiBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpIHsKICAgIGNvbnN0IGNvbmZpZ1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgInBhcmFsbGVsVGVzdFNob3J0Y3V0c0NvbmZpZyIpOwogICAgdHJ5IHsKICAgICAgICBhd2FpdCBzZXREb2MoY29uZmlnUmVmLCB7IAogICAgICAgICAgICBwYXJhbGxlbFNob3J0Y3V0VGFiczogcGFyYWxsZWxTaG9ydGN1dFRhYnMsCiAgICAgICAgICAgIHBhcmFsbGVsU2hvcnRjdXRPcmRlcjogcGFyYWxsZWxTaG9ydGN1dE9yZGVyCiAgICAgICAgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBwYXJhbGxlbCBzaG9ydGN1dCBjb25maWc6IiwgZXJyb3IpOyB9Cn0KCmZ1bmN0aW9uIHJlbmRlckFkZGl0aW9uYWxQYXJhbGxlbFNob3J0Y3V0c01vZGFsKCkgewogICAgY29uc3QgbmF2Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LXRhYnMtbmF2Jyk7CiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtcGFyYWxsZWwtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGlmICghbmF2Q29udGFpbmVyIHx8ICFsaXN0Q29udGFpbmVyKSByZXR1cm47CgogICAgbmF2Q29udGFpbmVyLmlubmVySFRNTCA9IHBhcmFsbGVsU2hvcnRjdXRUYWJzLm1hcCh0YWIgPT4gewogICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGFiLmlkID09PSBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQ7CiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSBncm91cCBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXRhYi1pZD0iJHt0YWIuaWR9IiBjbGFzcz0icGFyYWxsZWwtc2hvcnRjdXQtdGFiLWJ0biB3aGl0ZXNwYWNlLW5vd3JhcCBweS0zIHB4LTIgYm9yZGVyLWItMiBmb250LW1lZGl1bSB0ZXh0LXNtICR7aXNBY3RpdmUgPyAnYm9yZGVyLWluZGlnby01MDAgdGV4dC1pbmRpZ28tNjAwJyA6ICdib3JkZXItdHJhbnNwYXJlbnQgdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWdyYXktNzAwIGhvdmVyOmJvcmRlci1ncmF5LTMwMCd9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRhYi1uYW1lLWRpc3BsYXkgcG9pbnRlci1ldmVudHMtbm9uZSI+JHt0YWIubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHt0YWIubmFtZX0iIGNsYXNzPSJ0YWItbmFtZS1pbnB1dCBoaWRkZW4gYmctdHJhbnNwYXJlbnQgYm9yZGVyLWItMiBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIHctMzIiPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICR7IXRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXRhYi1pZD0iJHt0YWIuaWR9IiBjbGFzcz0iZGVsZXRlLXBhcmFsbGVsLXNob3J0Y3V0LXRhYi1idG4gYWJzb2x1dGUgLXRvcC0xIC1yaWdodC0xIHRleHQtcmVkLTQwMCBob3Zlcjp0ZXh0LXJlZC03MDAgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIj4mdGltZXM7PC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwoKICAgIGNvbnN0IGFjdGl2ZVRhYiA9IHBhcmFsbGVsU2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQpOwogICAgbGV0IHNob3J0Y3V0c1RvU2hvdyA9IGFjdGl2ZVRhYj8uaXNEZWZhdWx0ID8gWy4uLnBhcmFsbGVsVGVzdFNob3J0Y3V0c10gOiBwYXJhbGxlbFRlc3RTaG9ydGN1dHMuZmlsdGVyKHMgPT4gKGFjdGl2ZVRhYj8uc2hvcnRjdXRJZHMgfHwgW10pLmluY2x1ZGVzKHMuaWQpKTsKICAgIAogICAgY29uc3QgY3VycmVudE9yZGVyID0gcGFyYWxsZWxTaG9ydGN1dE9yZGVyW2FjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZF0gfHwgW107CiAgICBzaG9ydGN1dHNUb1Nob3cuc29ydCgoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGluZGV4QSA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGEuaWQpOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGIuaWQpOwogICAgICAgIHJldHVybiAoaW5kZXhBID09PSAtMSA/IEluZmluaXR5IDogaW5kZXhBKSAtIChpbmRleEIgPT09IC0xID8gSW5maW5pdHkgOiBpbmRleEIpOwogICAgfSk7CgogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzaG9ydGN1dHNUb1Nob3cubWFwKHNob3J0Y3V0ID0+IHsKICAgICAgICBjb25zdCBpY29uID0gc2hvcnRjdXQudXJsID8gJ/CflIEnIDogJ/CflJcnOwogICAgICAgIGNvbnN0IG90aGVyVGFicyA9IHBhcmFsbGVsU2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+ICF0LmlzRGVmYXVsdCk7CiAgICAgICAgY29uc3QgbW92ZURyb3Bkb3duSFRNTCA9IGFjdGl2ZVRhYi5pc0RlZmF1bHQgJiYgb3RoZXJUYWJzLmxlbmd0aCA+IDAgPyBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGlubGluZS1ibG9jayB0ZXh0LWxlZnQgZ3JvdXAvZHJvcGRvd24tcGFyYWxsZWwiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1tZW51LWJ0biB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS03MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIj48aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLXYiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtZHJvcGRvd24gb3JpZ2luLXRvcC1yaWdodCBhYnNvbHV0ZSByaWdodC0wIG10LTIgdy00OCByb3VuZGVkLW1kIHNoYWRvdy1sZyBiZy13aGl0ZSByaW5nLTEgcmluZy1ibGFjayByaW5nLW9wYWNpdHktNSBoaWRkZW4gei0yMCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icHktMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJweC00IHB0LTEgcGItMiB0ZXh0LXhzIHRleHQtZ3JheS00MDAiPuC5gOC4nuC4tOC5iOC4oeC5hOC4m+C4ouC4seC4h+C5geC4l+C5h+C4mjo8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICR7b3RoZXJUYWJzLm1hcCh0YWIgPT4gYDxhIGhyZWY9IiMiIGNsYXNzPSJtb3ZlLXBhcmFsbGVsLXNob3J0Y3V0LWl0ZW0gYmxvY2sgcHgtNCBweS0yIHRleHQtc20gdGV4dC1ncmF5LTcwMCBob3ZlcjpiZy1ncmF5LTEwMCIgZGF0YS1zaG9ydGN1dC1pZD0iJHtzaG9ydGN1dC5pZH0iIGRhdGEtdGFyZ2V0LXRhYi1pZD0iJHt0YWIuaWR9Ij4ke3RhYi5uYW1lfTwvYT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gIDogJyc7CgogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0ic2hvcnRjdXQtbGlzdC1pdGVtIHAtMyBib3JkZXItYiBob3ZlcjpiZy1ncmF5LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiIgZGF0YS1zaG9ydGN1dC1pZD0iJHtzaG9ydGN1dC5pZH0iIGRyYWdnYWJsZT0idHJ1ZSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdj48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXRlYWwtNzAwIj4ke2ljb259ICR7c2hvcnRjdXQubmFtZX08L3A+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0idXNlLWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4gYmctdGVhbC0xMDAgdGV4dC10ZWFsLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXRlYWwtMjAwIj7guKrguKPguYnguLLguIfguYDguKXguKI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXllbGxvdy0yMDAiPuC5geC4geC5ieC5hOC4gjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCI+4Lil4LiaPC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAkeyFhY3RpdmVUYWIuaXNEZWZhdWx0ID8gYDxidXR0b24gZGF0YS1zaG9ydGN1dC1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJyZW1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtZnJvbS10YWItYnRuIHRleHQtcmVkLTUwMCBtbC0yIiB0aXRsZT0i4LiZ4Liz4Lit4Lit4LiB4LiI4Liy4LiB4LmB4LiX4LmH4Lia4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHttb3ZlRHJvcGRvd25IVE1MfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpIHx8ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5g+C4meC5geC4l+C5h+C4muC4meC4teC5iTwvcD4nOwogICAgCiAgICBzZXR1cFBhcmFsbGVsU2hvcnRjdXRNb2RhbEV2ZW50TGlzdGVuZXJzKCk7Cn0KCmZ1bmN0aW9uIHNldHVwUGFyYWxsZWxTaG9ydGN1dE1vZGFsRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGFyYWxsZWwtc2hvcnRjdXQtdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4ub25jbGljayA9IGUgPT4geyBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC50YWJJZDsgcmVuZGVyQWRkaXRpb25hbFBhcmFsbGVsU2hvcnRjdXRzTW9kYWwoKTsgfTsKICAgICAgICBidG4ub25kYmxjbGljayA9IGUgPT4gewogICAgICAgICAgICBjb25zdCBpbnB1dCA9IGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCcudGFiLW5hbWUtaW5wdXQnKTsKICAgICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1kaXNwbGF5JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyBpbnB1dC5mb2N1cygpOyBpbnB1dC5zZWxlY3QoKTsKICAgICAgICB9OwogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjcGFyYWxsZWwtc2hvcnRjdXQtdGFicy1uYXYgLnRhYi1uYW1lLWlucHV0JykuZm9yRWFjaChpbnB1dCA9PiB7CiAgICAgICAgY29uc3Qgc2F2ZSA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdGFiSWQgPSBpbnB1dC5jbG9zZXN0KCcucGFyYWxsZWwtc2hvcnRjdXQtdGFiLWJ0bicpLmRhdGFzZXQudGFiSWQ7CiAgICAgICAgICAgIGNvbnN0IHRhYiA9IHBhcmFsbGVsU2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSB0YWJJZCk7CiAgICAgICAgICAgIGlmKHRhYikgeyB0YWIubmFtZSA9IGlucHV0LnZhbHVlLnRyaW0oKSB8fCB0YWIubmFtZTsgc2F2ZVBhcmFsbGVsU2hvcnRjdXRDb25maWcoKTsgfQogICAgICAgIH07CiAgICAgICAgaW5wdXQub25ibHVyID0gc2F2ZTsKICAgICAgICBpbnB1dC5vbmtleWRvd24gPSBlID0+IHsgaWYgKGUua2V5ID09PSAnRW50ZXInKSBpbnB1dC5ibHVyKCk7IH07CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxldGUtcGFyYWxsZWwtc2hvcnRjdXQtdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IGJ0bi5vbmNsaWNrID0gZSA9PiB7CiAgICAgICAgY29uc3QgdGFiSWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC50YWJJZDsKICAgICAgICBzaG93Q29uZmlybWF0aW9uKCLguITguLjguJPguYHguJnguYjguYPguIjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguYHguJfguYfguJrguJnguLXguYk/IiwgKCkgPT4gewogICAgICAgICAgICBwYXJhbGxlbFNob3J0Y3V0VGFicyA9IHBhcmFsbGVsU2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+IHQuaWQgIT09IHRhYklkKTsKICAgICAgICAgICAgZGVsZXRlIHBhcmFsbGVsU2hvcnRjdXRPcmRlclt0YWJJZF07CiAgICAgICAgICAgIGlmIChhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPT09IHRhYklkKSBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKICAgICAgICAgICAgc2F2ZVBhcmFsbGVsU2hvcnRjdXRDb25maWcoKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtaXRlbScpLmZvckVhY2goaXRlbSA9PiBpdGVtLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc3QgeyBzaG9ydGN1dElkLCB0YXJnZXRUYWJJZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQ7CiAgICAgICAgY29uc3QgdGFiID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhcmdldFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5zaG9ydGN1dElkcy5pbmNsdWRlcyhzaG9ydGN1dElkKSkgeyB0YWIuc2hvcnRjdXRJZHMucHVzaChzaG9ydGN1dElkKTsgc2F2ZVBhcmFsbGVsU2hvcnRjdXRDb25maWcoKTsgfQogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVtb3ZlLXBhcmFsbGVsLXNob3J0Y3V0LWZyb20tdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IGJ0bi5vbmNsaWNrID0gZSA9PiB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnNob3J0Y3V0SWQ7CiAgICAgICAgY29uc3QgdGFiID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZCk7CiAgICAgICAgaWYodGFiICYmICF0YWIuaXNEZWZhdWx0KSB7IHRhYi5zaG9ydGN1dElkcyA9IHRhYi5zaG9ydGN1dElkcy5maWx0ZXIoaWQgPT4gaWQgIT09IHNob3J0Y3V0SWQpOyBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpOyB9CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb3ZlLXBhcmFsbGVsLXNob3J0Y3V0LW1lbnUtYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZS5jdXJyZW50VGFyZ2V0Lm5leHRFbGVtZW50U2libGluZzsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1kcm9wZG93bicpLmZvckVhY2goZCA9PiBkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgICAgICBkcm9wZG93bi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0pOwogICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1saXN0Jyk7CiAgICBsZXQgZHJhZ2dlZEl0ZW0gPSBudWxsOwogICAgbGlzdENvbnRhaW5lci5vbmRyYWdzdGFydCA9IGUgPT4gewogICAgICAgIGRyYWdnZWRJdGVtID0gZS50YXJnZXQuY2xvc2VzdCgnLnNob3J0Y3V0LWxpc3QtaXRlbScpOwogICAgICAgIGlmKGRyYWdnZWRJdGVtKSBzZXRUaW1lb3V0KCgpID0+IGRyYWdnZWRJdGVtLmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnKSwgMCk7CiAgICB9OwogICAgbGlzdENvbnRhaW5lci5vbmRyYWdlbmQgPSAoKSA9PiB7IGlmKGRyYWdnZWRJdGVtKSB7IGRyYWdnZWRJdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ29wYWNpdHktNTAnKTsgZHJhZ2dlZEl0ZW0gPSBudWxsOyB9fTsKICAgIGxpc3RDb250YWluZXIub25kcmFnb3ZlciA9IGUgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IH07CiAgICBsaXN0Q29udGFpbmVyLm9uZHJvcCA9IGUgPT4gewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgY29uc3QgYWZ0ZXJFbGVtZW50ID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbTpub3QoLm9wYWNpdHktNTApJyldLnJlZHVjZSgoY2xvc2VzdCwgY2hpbGQpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJveCA9IGNoaWxkLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZS5jbGllbnRZIC0gYm94LnRvcCAtIGJveC5oZWlnaHQgLyAyOwogICAgICAgICAgICAgICAgcmV0dXJuIChvZmZzZXQgPCAwICYmIG9mZnNldCA+IGNsb3Nlc3Qub2Zmc2V0KSA/IHsgb2Zmc2V0OiBvZmZzZXQsIGVsZW1lbnQ6IGNoaWxkIH0gOiBjbG9zZXN0OwogICAgICAgICAgICB9LCB7IG9mZnNldDogTnVtYmVyLk5FR0FUSVZFX0lORklOSVRZIH0pLmVsZW1lbnQ7CiAgICAgICAgICAgIGlmIChhZnRlckVsZW1lbnQgPT0gbnVsbCkgeyBsaXN0Q29udGFpbmVyLmFwcGVuZENoaWxkKGRyYWdnZWRJdGVtKTsgfSAKICAgICAgICAgICAgZWxzZSB7IGxpc3RDb250YWluZXIuaW5zZXJ0QmVmb3JlKGRyYWdnZWRJdGVtLCBhZnRlckVsZW1lbnQpOyB9CiAgICAgICAgICAgIGNvbnN0IG5ld09yZGVyID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbScpXS5tYXAoaXRlbSA9PiBpdGVtLmRhdGFzZXQuc2hvcnRjdXRJZCk7CiAgICAgICAgICAgIHBhcmFsbGVsU2hvcnRjdXRPcmRlclthY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWRdID0gbmV3T3JkZXI7CiAgICAgICAgICAgIHNhdmVQYXJhbGxlbFNob3J0Y3V0Q29uZmlnKCk7CiAgICAgICAgfQogICAgfTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkUGFyYWxsZWxTaG9ydGN1dFRhYigpIHsKICAgIGNvbnN0IG5hbWUgPSBwcm9tcHQoIuC4geC4o+C4uOC4k+C4suC4leC4seC5ieC4h+C4iuC4t+C5iOC4reC5geC4l+C5h+C4muC5g+C4q+C4oeC5iDoiLCAi4LmB4LiX4LmH4Lia4LmD4Lir4Lih4LmIIik7CiAgICBpZiAobmFtZSAmJiBuYW1lLnRyaW0oKSkgewogICAgICAgIHBhcmFsbGVsU2hvcnRjdXRUYWJzLnB1c2goeyBpZDogYHRhYl8ke0RhdGUubm93KCl9YCwgbmFtZTogbmFtZS50cmltKCksIHNob3J0Y3V0SWRzOiBbXSB9KTsKICAgICAgICBhd2FpdCBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpOwogICAgfQp9Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguIrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgg4pay4pay4payCgpmdW5jdGlvbiByZW5kZXJQYXJhbGxlbFRlc3RTaG9ydGN1dHMoKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtY29udGFpbmVyJyk7CiAgICBjb25zdCBhZGRpdGlvbmFsTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1saXN0Jyk7CiAgICBjb25zdCBsb2FkaW5nTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0cy1sb2FkaW5nLW1zZycpOwoKICAgIGlmIChsb2FkaW5nTXNnKSBsb2FkaW5nTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgaWYgKCFjb250YWluZXIgfHwgIWFkZGl0aW9uYWxMaXN0KSByZXR1cm47CgogICAgY29uc3QgdmlzaWJsZVNob3J0Y3V0cyA9IHBhcmFsbGVsVGVzdFNob3J0Y3V0cy5zbGljZSgwLCA0KTsKICAgIGNvbnN0IGhpZGRlblNob3J0Y3V0cyA9IHBhcmFsbGVsVGVzdFNob3J0Y3V0cy5zbGljZSg0KTsKCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdmlzaWJsZVNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGNvbnN0IGhhc1VybCA9IHNob3J0Y3V0LnVybCAmJiBzaG9ydGN1dC51cmwudHJpbSgpICE9PSAnJzsKICAgICAgICBjb25zdCBiZ0NvbG9yID0gaGFzVXJsID8gJ2JnLXRlYWwtNTAwIGhvdmVyOmJnLXRlYWwtNjAwIHRleHQtd2hpdGUnIDogJ2JnLWdyYXktMjAwIGhvdmVyOmJnLWdyYXktMzAwIHRleHQtZ3JheS03MDAnOwogICAgICAgIGNvbnN0IGljb24gPSBoYXNVcmwgPyAn8J+UgScgOiAn8J+Ulyc7CgogICAgICAgIGNvbnN0IGRlbGV0ZUJ0bkh0bWwgPSAhc2hvcnRjdXQuaXNEZWZhdWx0ID8gCiAgICAgICAgICAgIGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSB0b3AtMSByaWdodC0xIHctNiBoLTYgYmctcmVkLTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguKXguJoiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyc7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJwYXJhbGxlbC1zaG9ydGN1dC1idG4gcm91bmRlZC0yeGwgc2hhZG93LWxnIHAtNCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciBmb250LXNlbWlib2xkIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBoLTI0ICR7YmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJwb2ludGVyLWV2ZW50cy1ub25lIj4ke2ljb259ICR7c2hvcnRjdXQubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJlZGl0LXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSBib3R0b20tMSByaWdodC0xIHctNiBoLTYgYmctd2hpdGUvNTAgdGV4dC1ncmF5LTgwMCByb3VuZGVkLWZ1bGwgdGV4dC14cyBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHtkZWxldGVCdG5IdG1sfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfSkuam9pbignJyk7CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgIDxkaXYgaWQ9Im9wZW4tYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtYnRuIiBjbGFzcz0icm91bmRlZC0yeGwgc2hhZG93LWxnIHAtNCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciBmb250LXNlbWlib2xkIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBoLTI0IGJnLWdyYXktMTAwIGhvdmVyOmJnLWdyYXktMjAwIHRleHQtZ3JheS02MDAiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1lbGxpcHNpcy1oIHRleHQteGwiPjwvaT4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtdC0yIHRleHQtc20iPuC4m+C4uOC5iOC4oeC4peC4seC4lOC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgIH0KCiAgICBpZiAoaGlkZGVuU2hvcnRjdXRzLmxlbmd0aCA+IDApIHsKICAgICAgICBhZGRpdGlvbmFsTGlzdC5pbm5lckhUTUwgPSBoaWRkZW5TaG9ydGN1dHMubWFwKHNob3J0Y3V0ID0+IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC0zIGJvcmRlci1iIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXRlYWwtNzAwIj4ke3Nob3J0Y3V0LnVybCA/ICfwn5SBJyA6ICfwn5SXJ30gJHtzaG9ydGN1dC5uYW1lfTwvcD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0idXNlLWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4gYmctdGVhbC0xMDAgdGV4dC10ZWFsLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXRlYWwtMjAwIj7guKrguKPguYnguLLguIfguYDguKXguKI8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1oaWRkZW4tcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmcteWVsbG93LTIwMCI+4LmB4LiB4LmJ4LmE4LiCPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgJHshc2hvcnRjdXQuaXNEZWZhdWx0ID8gYDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJkZWxldGUtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBiZy1yZWQtMTAwIHRleHQtcmVkLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXJlZC0yMDAiPuC4peC4mjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKICAgIH0gZWxzZSB7CiAgICAgICAgYWRkaXRpb25hbExpc3QuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lih4Li14Lib4Li44LmI4Lih4Lil4Lix4LiU4LmA4Lie4Li04LmI4Lih4LmA4LiV4Li04LihPC9wPic7CiAgICB9Cn0KCi8qKgogKiBbUGFyYWxsZWwgU2hvcnRjdXRzXSDguYDguJvguLTguJQgTW9kYWwg4Liq4Liz4Lir4Lij4Lix4Lia4LmB4LiB4LmJ4LmE4LiC4Lir4Lij4Li34Lit4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4Lir4Lih4LmICiAqLwpmdW5jdGlvbiBvcGVuUGFyYWxsZWxUZXN0U2hvcnRjdXRFZGl0b3Ioc2hvcnRjdXRJZCA9IG51bGwpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpOwogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtbW9kYWwtdGl0bGUnKTsKICAgIGNvbnN0IGlkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtaWQtaW5wdXQnKTsKICAgIGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1uYW1lLWlucHV0Jyk7CiAgICBjb25zdCB1cmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC11cmwtaW5wdXQnKTsKCiAgICBpZiAoc2hvcnRjdXRJZCkgewogICAgICAgIGNvbnN0IHNob3J0Y3V0ID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgICAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4LiB4LmJ4LmE4LiC4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiC4LmJ4Lit4Liq4Lit4Lia4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gc2hvcnRjdXQuaWQ7CiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gc2hvcnRjdXQubmFtZTsKICAgICAgICB1cmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LnVybCB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiC4LmJ4Lit4Liq4Lit4Lia4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gJyc7IG5hbWVJbnB1dC52YWx1ZSA9ICcnOyB1cmxJbnB1dC52YWx1ZSA9ICcnOwogICAgfQogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCi8qKgogKiBbUGFyYWxsZWwgU2hvcnRjdXRzXSDguJrguLHguJnguJfguLbguIHguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIfguIjguLLguIEgTW9kYWwg4Lil4LiHIEZpcmViYXNlCiAqLwphc3luYyBmdW5jdGlvbiBzYXZlUGFyYWxsZWxUZXN0U2hvcnRjdXRDaGFuZ2VzKCkgewogICAgY29uc3QgaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtaWQtaW5wdXQnKS52YWx1ZTsKICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtbmFtZS1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICAgIGNvbnN0IHVybCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC11cmwtaW5wdXQnKS52YWx1ZS50cmltKCk7CgogICAgaWYgKCFuYW1lKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguIHguKPguK3guIEgJ+C4iuC4t+C5iOC4reC4m+C4uOC5iOC4oeC4peC4seC4lCciKTsgcmV0dXJuOyB9CgogICAgY29uc3QgbmV3U2hvcnRjdXREYXRhID0gewogICAgICAgIGlkOiBpZCB8fCBgcGFyYWxsZWwtc2hvcnRjdXRfJHtEYXRlLm5vdygpfWAsCiAgICAgICAgbmFtZTogbmFtZSwgdXJsOiB1cmwsIGlzRGVmYXVsdDogaWQuc3RhcnRzV2l0aCgncGFyYWxsZWwtZGVmYXVsdC0nKQogICAgfTsKCiAgICBsZXQgdXBkYXRlZFNob3J0Y3V0czsKICAgIGlmIChpZCkgewogICAgICAgIHVwZGF0ZWRTaG9ydGN1dHMgPSBwYXJhbGxlbFRlc3RTaG9ydGN1dHMubWFwKHMgPT4gcy5pZCA9PT0gaWQgPyBuZXdTaG9ydGN1dERhdGEgOiBzKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdXBkYXRlZFNob3J0Y3V0cyA9IFsuLi5wYXJhbGxlbFRlc3RTaG9ydGN1dHMsIG5ld1Nob3J0Y3V0RGF0YV07CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAicGFyYWxsZWxUZXN0U2hvcnRjdXRzQ29uZmlnIik7CiAgICAgICAgYXdhaXQgc2V0RG9jKHByZWZSZWYsIHsgc2hvcnRjdXRzOiB1cGRhdGVkU2hvcnRjdXRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgcGFyYWxsZWwgc2hvcnRjdXQ6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIEiKTsKICAgIH0KfQoKLyoqCiAqIFtQYXJhbGxlbCBTaG9ydGN1dHNdIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4q+C4peC4seC4geC5gOC4oeC4t+C5iOC4reC4hOC4peC4tOC4geC4l+C4teC5iOC4m+C4uOC5iOC4oeC4peC4seC4lDog4LmC4Lir4Lil4LiU4LmE4Lif4Lil4LmM4LmB4Lil4Liw4LmA4Lij4Li04LmI4Lih4Liq4Lij4LmJ4Liy4LiH4LiX4Lix4LiZ4LiX4Li1CiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVQYXJhbGxlbFRlc3RTaG9ydGN1dENsaWNrKHNob3J0Y3V0SWQpIHsKICAgIGNvbnN0IHNob3J0Y3V0ID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgIGlmICghc2hvcnRjdXQpIHJldHVybjsKCiAgICBpZiAoIXNob3J0Y3V0LnVybCB8fCBzaG9ydGN1dC51cmwudHJpbSgpID09PSAnJykgewogICAgICAgIG9wZW5QYXJhbGxlbFRlc3RTaG9ydGN1dEVkaXRvcihzaG9ydGN1dElkKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIOC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lOC4l+C4teC5iOC4quC5iOC4p+C4meC4geC4peC4suC4hwogICAgY29uc3QgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlcicpOwogICAgY29uc3QgbG9hZGVyVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkZXItdGV4dCcpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZ2VuZXJhdGlvbi1hcmVhJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGVkLXF1aXotY29udGFpbmVyJykuaW5uZXJIVE1MID0gJyc7CiAgICBsb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBsb2FkZXJUZXh0LnRleHRDb250ZW50ID0gJ+C4geC4s+C4peC4seC4h+C4lOC4tuC4h+C5hOC4n+C4peC5jOC4iOC4suC4geC4peC4tOC4h+C4geC5jOC5geC4peC4sOC4quC4o+C5ieC4suC4h+C4guC5ieC4reC4quC4reC4muC4hOC4ueC5iOC4guC4meC4suC4mS4uLic7Cgp0cnkgewogICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguJnguLLguKHguKrguIHguLjguKXguIjguLLguIEgVVJMIOC5guC4lOC4ouC4leC4o+C4h+C5geC4peC4sOC4geC4s+C4q+C4meC4lOC4iuC4t+C5iOC4reC5hOC4n+C4peC5jOC5g+C4q+C5ieC4luC4ueC4geC4leC5ieC4reC4hwogICAgICAgIGxldCBmaWxlbmFtZTsKICAgICAgICBpZiAoc2hvcnRjdXQudXJsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJy50eHQnKSkgewogICAgICAgICAgICBmaWxlbmFtZSA9ICJzb3VyY2VfZG9jdW1lbnQudHh0IjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguIHguKPguJPguLXguK3guLfguYjguJnguYYg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4Lir4LmJ4LiW4Li34Lit4Lin4LmI4Liy4LmA4Lib4LmH4LiZIFBERiAo4LiL4Li24LmI4LiH4LmA4Lib4LmH4LiZ4Lie4Lik4LiV4Li04LiB4Lij4Lij4Lih4LmA4LiU4Li04Lih4LiX4Li14LmI4LiX4Liz4LiH4Liy4LiZ4LmE4LiU4LmJ4LiU4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinKQogICAgICAgICAgICBmaWxlbmFtZSA9ICJzb3VyY2VfZG9jdW1lbnQucGRmIjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgZmlsZU9iamVjdCA9IGF3YWl0IGZldGNoRmlsZUZyb21Vcmwoc2hvcnRjdXQudXJsLCBmaWxlbmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gKirguIjguLjguJTguYDguIrguLfguYjguK3guKHguJXguYjguK3guJfguLXguYjguKrguLPguITguLHguI06Kiog4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxUZXN0IOC5guC4lOC4ouC4leC4o+C4hwogICAgICAgIC8vIOC5geC4peC4sOC4quC5iOC4hyBGaWxlIG9iamVjdCDguJfguLXguYjguYTguJTguYnguYDguILguYnguLLguYTguJvguYDguJvguYfguJnguJ7guLLguKPguLLguKHguLTguYDguJXguK3guKPguYwKICAgICAgICBhd2FpdCBoYW5kbGVHZW5lcmF0ZVBhcmFsbGVsVGVzdChmaWxlT2JqZWN0KTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHByb2Nlc3NpbmcgcGFyYWxsZWwgc2hvcnRjdXQgY2xpY2s6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGDguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICBsb2FkZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4quC4luC4suC4meC4sOC5guC4q+C4peC4lOC4luC5ieC4suC4oeC4teC4m+C4seC4jeC4q+C4sgogICAgfQp9Ci8vIOKWsuKWsuKWsiBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4iuC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCmZ1bmN0aW9uIGluaXRpYWxpemVTY3JhdGNocGFkQ2FudmFzKCkgewogICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtY2FudmFzJyk7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NyYXRjaHBhZC1jb250ZW50LXdyYXBwZXInKTsKICAgIGlmICghY2FudmFzIHx8ICFjb250YWluZXIpIHJldHVybjsKCiAgICBzY3JhdGNocGFkQ3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJywgeyB3aWxsUmVhZEZyZXF1ZW50bHk6IHRydWUgfSk7CiAgICAKICAgIGNvbnN0IGRwciA9IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIHx8IDE7CiAgICBjb25zdCByZWN0ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY2FudmFzLndpZHRoID0gcmVjdC53aWR0aCAqIGRwcjsKICAgIGNhbnZhcy5oZWlnaHQgPSByZWN0LmhlaWdodCAqIGRwcjsKICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IGAke3JlY3Qud2lkdGh9cHhgOwogICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGAke3JlY3QuaGVpZ2h0fXB4YDsKICAgIHNjcmF0Y2hwYWRDdHguc2NhbGUoZHByLCBkcHIpOwoKICAgIHNjcmF0Y2hwYWRDdHgubGluZUpvaW4gPSAncm91bmQnOwogICAgc2NyYXRjaHBhZEN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCiAgICAvLyDguKXguJogRXZlbnQgTGlzdGVuZXJzIOC5gOC4geC5iOC4suC4reC4reC4geC4geC5iOC4reC4mQogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJkb3duJywgaGFuZGxlUG9pbnRlckRvd24pOwogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJtb3ZlJywgaGFuZGxlUG9pbnRlck1vdmUpOwogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJ1cCcsIGhhbmRsZVBvaW50ZXJVcCk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmNhbmNlbCcsIGhhbmRsZVBvaW50ZXJVcCk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBoYW5kbGVXaGVlbCk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGhhbmRsZVBvaW50ZXJEb3duKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBoYW5kbGVQb2ludGVyTW92ZSk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hlbmQnLCBoYW5kbGVQb2ludGVyVXApOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lcnMg4LiK4Li44LiU4LmD4Lir4Lih4LmICiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBoYW5kbGVQb2ludGVyRG93bik7CiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBoYW5kbGVQb2ludGVyTW92ZSk7CiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgaGFuZGxlUG9pbnRlclVwKTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyY2FuY2VsJywgaGFuZGxlUG9pbnRlclVwKTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIGhhbmRsZVdoZWVsLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgLy8g4Liq4Liz4Lir4Lij4Lix4LiaIFRvdWNoIChTYWZhcmkvaU9TKQogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBoYW5kbGVQb2ludGVyRG93biwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBoYW5kbGVQb2ludGVyTW92ZSwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZVBvaW50ZXJVcCwgeyBwYXNzaXZlOiBmYWxzZSB9KTsKfQoKZnVuY3Rpb24gc2V0dXBTY3JhdGNocGFkQ29udHJvbHMoKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JhdGNocGFkLW1vZGFsJyk7CiAgICBjb25zdCBjb250cm9sc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JhdGNocGFkLWNvbnRyb2xzJyk7CiAgICAKICAgIC8vIFVJIOC4guC4reC4h+C4m+C4uOC5iOC4oeC4hOC4p+C4muC4hOC4uOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAo4Lij4Lin4Lih4Lib4Li44LmI4Lih4LmE4Liu4LmE4Lil4LiX4LmMLCDguIHguKXguLjguYjguKHguKrguLUsIOC5geC4peC4sCBTbGlkZXIpCiAgICBjb250cm9sc0NvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idG9vbC1ncm91cCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InNjcmF0Y2hwYWQtY2xvc2UtYnRuIiBjbGFzcz0iYmctcmVkLTUwMCB0ZXh0LXdoaXRlIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgaG92ZXI6YmctcmVkLTYwMCIgdGl0bGU9IuC4m+C4tOC4lOC4geC4o+C4sOC4lOC4suC4meC4l+C4lOC5gOC4peC4giI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcyI+PC9pPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InNlcGFyYXRvciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idG9vbC1ncm91cCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InJlc2V0LXZpZXctYnRuIiBjbGFzcz0idy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBib3JkZXItMiIgdGl0bGU9IuC4o+C4teC5gOC4i+C5h+C4leC4oeC4uOC4oeC4oeC4reC4hyI+PGkgY2xhc3M9ImZhcyBmYS1leHBhbmQtYXJyb3dzLWFsdCI+PC9pPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InNlcGFyYXRvciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idG9vbC1ncm91cCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InVuZG8tYnRuIiBjbGFzcz0idy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBib3JkZXItMiBkaXNhYmxlZDpvcGFjaXR5LTUwIiB0aXRsZT0i4Lii4LmJ4Lit4LiZ4LiB4Lil4Lix4LiaIiBkaXNhYmxlZD48aSBjbGFzcz0iZmFzIGZhLXVuZG8iPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0icmVkby1idG4iIGNsYXNzPSJ3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIGRpc2FibGVkOm9wYWNpdHktNTAiIHRpdGxlPSLguJfguLPguIvguYnguLMiIGRpc2FibGVkPjxpIGNsYXNzPSJmYXMgZmEtcmVkbyI+PC9pPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InNlcGFyYXRvciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0idG9vbC1ncm91cCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InBlbi10b29sLWJ0biIgY2xhc3M9InRvb2wtYnRuIGFjdGl2ZSB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIiB0aXRsZT0i4Lib4Liy4LiB4LiB4LiyIj48aSBjbGFzcz0iZmFzIGZhLXBlbmNpbC1hbHQiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0iaGlnaGxpZ2h0ZXItdG9vbC1idG4iIGNsYXNzPSJ0b29sLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIiB0aXRsZT0i4Lib4Liy4LiB4LiB4Liy4LmE4Liu4LmE4Lil4LiX4LmMIj48aSBjbGFzcz0iZmFzIGZhLWhpZ2hsaWdodGVyIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImVyYXNlci10b29sLWJ0biIgY2xhc3M9InRvb2wtYnRuIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgYm9yZGVyLTIiIHRpdGxlPSLguKLguLLguIfguKXguJoiPjxpIGNsYXNzPSJmYXMgZmEtZXJhc2VyIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InRyYWlsLXRvb2wtYnRuIiBjbGFzcz0idG9vbC1idG4gdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBib3JkZXItMiIgdGl0bGU9IuC4m+C4suC4geC4geC4siBUcmFpbCAo4LiI4Liy4LiH4Lir4Liy4LiiKSI+PGkgY2xhc3M9ImZhcyBmYS1zaWduYXR1cmUiPjwvaT48L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJzZXBhcmF0b3IiPjwvZGl2PgoJCQoJCTxkaXYgaWQ9ImVyYXNlci10b29scy1ncm91cCIgY2xhc3M9InRvb2wtZ3JvdXAgaGlkZGVuIGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImVyYXNlci1zaXplLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iMjAiIHRpdGxlPSLguKLguLLguIfguKXguJrguILguJnguLLguJTguYDguKXguYfguIEgKDIwKSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTIgaC0yIGJnLWdyYXktNjAwIHJvdW5kZWQtZnVsbCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2Rpdj4KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImVyYXNlci1zaXplLWJ0biBhY3RpdmUgdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJvcmRlci0yIiBkYXRhLXNpemU9IjQwIiB0aXRsZT0i4Lii4Liy4LiH4Lil4Lia4LiC4LiZ4Liy4LiU4LiB4Lil4Liy4LiHICg0MCkiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0zIGgtMyBiZy1ncmF5LTYwMCByb3VuZGVkLWZ1bGwgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9kaXY+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJlcmFzZXItc2l6ZS1idG4gdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGJvcmRlci0yIiBkYXRhLXNpemU9IjgwIiB0aXRsZT0i4Lii4Liy4LiH4Lil4Lia4LiC4LiZ4Liy4LiU4LmD4Lir4LiN4LmIICg4MCkiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy00IGgtNCBiZy1ncmF5LTYwMCByb3VuZGVkLWZ1bGwgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9kaXY+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGlkPSJwZW4tdG9vbHMtZ3JvdXAiIGNsYXNzPSJ0b29sLWdyb3VwIGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tc2l6ZS1idG4gdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQteHMgZm9udC1ib2xkIGJvcmRlci0yIiBkYXRhLXNpemU9IjIiIHRpdGxlPSLguILguJnguLLguJTguYDguKXguYfguIEiPlM8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGVuLXNpemUtYnRuIGFjdGl2ZSB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1zbSBmb250LWJvbGQgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iNSIgdGl0bGU9IuC4guC4meC4suC4lOC4geC4peC4suC4hyI+TTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tc2l6ZS1idG4gdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBmb250LWJvbGQgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iMTAiIHRpdGxlPSLguILguJnguLLguJTguYPguKvguI3guYgiPkw8L2J1dHRvbj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIG14LTEiPjwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tY29sb3ItYnRuIGFjdGl2ZSB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0iIzAwMDAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMwMDAwMDA7IiB0aXRsZT0i4Liq4Li14LiU4LizIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGVuLWNvbG9yLWJ0biB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0iI0VGNDQ0NCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNFRjQ0NDQ7IiB0aXRsZT0i4Liq4Li14LmB4LiU4LiHIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icGVuLWNvbG9yLWJ0biB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0iIzNCODJGNiIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMzQjgyRjY7IiB0aXRsZT0i4Liq4Li14LiZ4LmJ4Liz4LmA4LiH4Li04LiZIj48L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBpZD0iaGlnaGxpZ2h0ZXItdG9vbHMtZ3JvdXAiIGNsYXNzPSJ0b29sLWdyb3VwIGhpZGRlbiBpdGVtcy1jZW50ZXIgZ2FwLTMiPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJoaWdobGlnaHRlci1jb2xvci1idG4gYWN0aXZlIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDI1NSwgMjU1LCAwLCAwLjUpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogeWVsbG93OyIgdGl0bGU9IuC4quC4teC5gOC4q+C4peC4t+C4reC4hyI+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImhpZ2hsaWdodGVyLWNvbG9yLWJ0biB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0icmdiYSg1OSwgMTMwLCAyNDYsIDAuNSkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjM0I4MkY2OyIgdGl0bGU9IuC4quC4teC4meC5ieC4s+C5gOC4h+C4tOC4mSI+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImhpZ2hsaWdodGVyLWNvbG9yLWJ0biB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0icmdiYSgyMzYsIDcyLCAxNTMsIDAuNSkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjRUM0ODk5OyIgdGl0bGU9IuC4quC4teC4iuC4oeC4nuC4uSI+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImhpZ2hsaWdodGVyLWNvbG9yLWJ0biB3LTcgaC03IHJvdW5kZWQtZnVsbCBib3JkZXItMiIgZGF0YS1jb2xvcj0icmdiYSgzNCwgMTk3LCA5NCwgMC41KSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMyMkM1NUU7IiB0aXRsZT0i4Liq4Li14LmA4LiC4Li14Lii4LinIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaGlnaGxpZ2h0ZXItY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDI0OSwgMTE1LCAyMiwgMC41KSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNGOTczMTY7IiB0aXRsZT0i4Liq4Li14Liq4LmJ4LihIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaGlnaGxpZ2h0ZXItY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDE2OCwgODUsIDI0NywgMC41KSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNBODU1Rjc7IiB0aXRsZT0i4Liq4Li14Lih4LmI4Lin4LiHIj48L2J1dHRvbj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNlcGFyYXRvciBteC0xIj48L2Rpdj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGV4dC1oZWlnaHQiPjwvaT4KICAgICAgICAgICAgPGlucHV0IGlkPSJoaWdobGlnaHRlci1zaXplLXNsaWRlciIgdHlwZT0icmFuZ2UiIG1pbj0iNSIgbWF4PSI1MCIgdmFsdWU9IjIwIiBjbGFzcz0idy0yNCBoLTIgYmctZ3JheS0yMDAgcm91bmRlZC1sZyBhcHBlYXJhbmNlLW5vbmUgY3Vyc29yLXBvaW50ZXIiPgogICAgICAgICAgICA8c3BhbiBpZD0iaGlnaGxpZ2h0ZXItc2l6ZS12YWx1ZSIgY2xhc3M9InRleHQtc20gZm9udC1tb25vIHctOCB0ZXh0LWNlbnRlciI+JHtzY3JhdGNocGFkSGlnaGxpZ2h0ZXJTaXplfTwvc3Bhbj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIG1sLWF1dG8iPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJzY3JhdGNocGFkLWNsZWFyLWJ0biIgY2xhc3M9ImJnLXllbGxvdy01MDAgdGV4dC13aGl0ZSB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGhvdmVyOmJnLXllbGxvdy02MDAiIHRpdGxlPSLguKXguJrguJfguLHguYnguIfguKvguKHguJQiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwovLyAtLS0g4Liq4LmI4Lin4LiZ4LiI4Lix4LiU4LiB4Liy4LijIEV2ZW50IExpc3RlbmVycyAtLS0KICAgIGNvbnN0IHBlblRvb2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVuLXRvb2wtYnRuJyk7CiAgICBjb25zdCBlcmFzZXJUb29sQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VyYXNlci10b29sLWJ0bicpOwogICAgY29uc3QgdHJhaWxUb29sQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RyYWlsLXRvb2wtYnRuJyk7CiAgICBjb25zdCBoaWdobGlnaHRlclRvb2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGlnaGxpZ2h0ZXItdG9vbC1idG4nKTsKICAgIAogICAgY29uc3QgcGVuVG9vbHNHcm91cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW4tdG9vbHMtZ3JvdXAnKTsKICAgIGNvbnN0IGhpZ2hsaWdodGVyVG9vbHNHcm91cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaWdobGlnaHRlci10b29scy1ncm91cCcpOwoJY29uc3QgZXJhc2VyVG9vbHNHcm91cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlcmFzZXItdG9vbHMtZ3JvdXAnKTsKCiAgICBjb25zdCBhbGxUb29sQnV0dG9ucyA9IFtwZW5Ub29sQnRuLCBlcmFzZXJUb29sQnRuLCB0cmFpbFRvb2xCdG4sIGhpZ2hsaWdodGVyVG9vbEJ0bl07CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtY2xvc2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzZXQtdmlldy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBzY3JhdGNocGFkU2NhbGUgPSAxOwogICAgICAgIHNjcmF0Y2hwYWRPZmZzZXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICB9KTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JhdGNocGFkLWNsZWFyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIHN0cm9rZXMgPSBbXTsKICAgICAgICByZWRvU3Ryb2tlcyA9IFtdOwogICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgICAgICB1cGRhdGVVbmRvUmVkb0J1dHRvbnMoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VuZG8tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB1bmRvKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWRvLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVkbyk7CgogICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIEhlbHBlciDguKrguLPguKvguKPguLHguJrguKrguKXguLHguJrguYLguKvguKHguJQKICAgIGNvbnN0IHNldEFjdGl2ZVRvb2xVSSA9IChhY3RpdmVCdG4pID0+IHsKICAgICAgICAgYWxsVG9vbEJ1dHRvbnMuZm9yRWFjaChidG4gPT4gYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICAgYWN0aXZlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAKICAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4LiX4Li44LiB4LiB4Lil4Li44LmI4Lih4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lih4Li34LitCiAgICAgICAgIHBlblRvb2xzR3JvdXAuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgIGhpZ2hsaWdodGVyVG9vbHNHcm91cC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgZXJhc2VyVG9vbHNHcm91cC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8gPC0tIFvguYDguJ7guLTguYjguKFdIOC4i+C5iOC4reC4meC4ouC4suC4h+C4peC4mgoKICAgICAgICAgLy8g4LmB4Liq4LiU4LiH4LmA4LiJ4Lie4Liy4Liw4LiB4Lil4Li44LmI4Lih4LiX4Li14LmI4LmA4LiB4Li14LmI4Lii4Lin4LiC4LmJ4Lit4LiHCiAgICAgICAgIGlmIChhY3RpdmVUb29sID09PSAncGVuJyB8fCBhY3RpdmVUb29sID09PSAndHJhaWwnKSB7CiAgICAgICAgICAgICBwZW5Ub29sc0dyb3VwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRvb2wgPT09ICdoaWdobGlnaHRlcicpIHsKICAgICAgICAgICAgIGhpZ2hsaWdodGVyVG9vbHNHcm91cC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgfSBlbHNlIGlmIChhY3RpdmVUb29sID09PSAnZXJhc2VyJykgewogICAgICAgICAgICAgZXJhc2VyVG9vbHNHcm91cC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgLy8gPC0tIFvguYDguJ7guLTguYjguKFdIOC5geC4quC4lOC4h+C4ouC4suC4h+C4peC4mgogICAgICAgICB9CiAgICAgfTsKCiAgICAvLyBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKHguYDguKXguLfguK3guIHguYDguITguKPguLfguYjguK3guIfguKHguLfguK0KICAgIHBlblRvb2xCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGFjdGl2ZVRvb2wgPSAncGVuJzsgc2V0QWN0aXZlVG9vbFVJKHBlblRvb2xCdG4pOyB9KTsKICAgIGVyYXNlclRvb2xCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7IGFjdGl2ZVRvb2wgPSAnZXJhc2VyJzsgc2V0QWN0aXZlVG9vbFVJKGVyYXNlclRvb2xCdG4pOyB9KTsKICAgIHRyYWlsVG9vbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgYWN0aXZlVG9vbCA9ICd0cmFpbCc7IHNldEFjdGl2ZVRvb2xVSSh0cmFpbFRvb2xCdG4pOyB9KTsKICAgIGhpZ2hsaWdodGVyVG9vbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgYWN0aXZlVG9vbCA9ICdoaWdobGlnaHRlcic7IHNldEFjdGl2ZVRvb2xVSShoaWdobGlnaHRlclRvb2xCdG4pOyB9KTsKICAgIAogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lih4Li34Lit4Lib4Liy4LiB4LiB4LiyCiAgICBwZW5Ub29sc0dyb3VwLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW4tc2l6ZS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgc2NyYXRjaHBhZFBlblNpemUgPSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LnNpemUsIDEwKTsKICAgICAgICAgICAgcGVuVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcucGVuLXNpemUtYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICB9KTsKICAgIH0pOwoJCgllcmFzZXJUb29sc0dyb3VwLnF1ZXJ5U2VsZWN0b3JBbGwoJy5lcmFzZXItc2l6ZS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAvLyDguYPguIrguYkgY3VycmVudFRhcmdldCDguYDguJ7guLfguYjguK3guYPguKvguYnguYHguJnguYjguYPguIjguKfguYjguLLguITguKXguLTguIHguJfguLXguYjguJvguLjguYjguKEg4LmE4Lih4LmI4LmD4LiK4LmI4LiX4Li14LmI4Lin4LiH4LiB4Lil4Lih4LiU4LmJ4Liy4LiZ4LmD4LiZCiAgICAgICAgICAgICBjb25zdCB0YXJnZXRCdG4gPSBlLmN1cnJlbnRUYXJnZXQ7CiAgICAgICAgICAgICBzY3JhdGNocGFkRXJhc2VyU2l6ZSA9IHBhcnNlSW50KHRhcmdldEJ0bi5kYXRhc2V0LnNpemUsIDEwKTsKICAgICAgICAgICAgIGVyYXNlclRvb2xzR3JvdXAucXVlcnlTZWxlY3RvckFsbCgnLmVyYXNlci1zaXplLWJ0bicpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICAgICAgIHRhcmdldEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgfSk7CiAgICAgfSk7CgkKICAgIHBlblRvb2xzR3JvdXAucXVlcnlTZWxlY3RvckFsbCgnLnBlbi1jb2xvci1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgc2NyYXRjaHBhZFBlbkNvbG9yID0gZS50YXJnZXQuZGF0YXNldC5jb2xvcjsKICAgICAgICAgICAgcGVuVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcucGVuLWNvbG9yLWJ0bicpLmZvckVhY2goYiA9PiBiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgIAogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lih4Li34Lit4LmE4Liu4LmE4Lil4LiX4LmMCiAgICBoaWdobGlnaHRlclRvb2xzR3JvdXAucXVlcnlTZWxlY3RvckFsbCgnLmhpZ2hsaWdodGVyLWNvbG9yLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBzY3JhdGNocGFkSGlnaGxpZ2h0ZXJDb2xvciA9IGUudGFyZ2V0LmRhdGFzZXQuY29sb3I7CiAgICAgICAgICAgIGhpZ2hsaWdodGVyVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcuaGlnaGxpZ2h0ZXItY29sb3ItYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICBjb25zdCBoaWdobGlnaHRlclNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaWdobGlnaHRlci1zaXplLXNsaWRlcicpOwogICAgY29uc3QgaGlnaGxpZ2h0ZXJTaXplVmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGlnaGxpZ2h0ZXItc2l6ZS12YWx1ZScpOwogICAgaGlnaGxpZ2h0ZXJTbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4gewogICAgICAgIGNvbnN0IG5ld1NpemUgPSBwYXJzZUludChlLnRhcmdldC52YWx1ZSwgMTApOwogICAgICAgIHNjcmF0Y2hwYWRIaWdobGlnaHRlclNpemUgPSBuZXdTaXplOyAvLyDguK3guLHguJvguYDguJTguJXguJXguLHguKfguYHguJvguKMKICAgICAgICBoaWdobGlnaHRlclNpemVWYWx1ZS50ZXh0Q29udGVudCA9IG5ld1NpemU7IC8vIOC5geC4quC4lOC4h+C4hOC5iOC4suC4muC4mSBVSQogICAgfSk7CgogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHsKICAgICAgICBpZiAoIW1vZGFsLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHsKICAgICAgICAgICAgaW5pdGlhbGl6ZVNjcmF0Y2hwYWRDYW52YXMoKTsKICAgICAgICAgICAgcmVkcmF3U2NyYXRjaHBhZCgpOwogICAgICAgIH0KICAgIH0pOwp9IC8vIDwtLSDguJvguLTguJTguJ/guLHguIfguIHguYzguIrguLHguJkgc2V0dXBTY3JhdGNocGFkQ29udHJvbHMgICAgCgogICAgICAgIC8vIEdhbWlmaWNhdGlvbiBDb25zdGFudHMKICAgICAgICBjb25zdCBCQURHRVMgPSB7CiAgICAgICAgICAgIFBFUkZFQ1RfU0NPUkU6IHsgaWQ6ICdwZXJmZWN0X3Njb3JlJywgbmFtZTogJ+C4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oScsIGRlc2NyaXB0aW9uOiAn4LiV4Lit4Lia4LiW4Li54LiB4LiX4Li44LiB4LiC4LmJ4Lit4LmD4LiZ4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJJywgaWNvbjogJ2ZhLWNyb3duIHRleHQteWVsbG93LTUwMCcgfSwKICAgICAgICAgICAgUVVJQ0tfVEhJTktFUjogeyBpZDogJ3F1aWNrX3RoaW5rZXInLCBuYW1lOiAn4LmA4LiL4Li14Lii4LiZ4Liq4Lih4Lit4LiH4LmE4LinJywgZGVzY3JpcHRpb246ICfguJfguLPguYHguJrguJrguJfguJTguKrguK3guJrguYDguKrguKPguYfguIjguYDguKPguYfguKfguIHguKfguYjguLLguITguKPguLbguYjguIfguILguK3guIfguYDguKfguKXguLLguJfguLXguYjguIHguLPguKvguJnguJQnLCBpY29uOiAnZmEtYm9sdCB0ZXh0LWJsdWUtNTAwJyB9LAogICAgICAgICAgICBPTl9GSVJFOiB7IGlkOiAnb25fZmlyZScsIG5hbWU6ICfguJfguYfguK3guJvguJ/guK3guKPguYzguKEnLCBkZXNjcmlwdGlvbjogJ+C4leC4reC4muC4luC4ueC4gSAzIOC4guC5ieC4reC4leC4tOC4lOC4leC5iOC4reC4geC4seC4mScsIGljb246ICdmYS1maXJlIHRleHQtb3JhbmdlLTUwMCcgfSwKICAgICAgICAgICAgRklSU1RfVFJZX0FDRTogeyBpZDogJ2ZpcnN0X3RyeV9hY2UnLCBuYW1lOiAn4Lic4LmI4Liy4LiZ4LiJ4Lil4Li44LiiJywgZGVzY3JpcHRpb246ICfguJfguLPguITguLDguYHguJnguJnguYDguJXguYfguKHguYPguJnguIHguLLguKPguJfguLPguITguKPguLHguYnguIfguYHguKPguIEnLCBpY29uOiAnZmEtcm9ja2V0IHRleHQtcHVycGxlLTUwMCcgfSwKICAgICAgICAgICAgQ09NRUJBQ0tfS0lORzogeyBpZDogJ2NvbWViYWNrX2tpbmcnLCBuYW1lOiAn4Lij4Liy4LiK4Liy4LiE4Lix4Lih4LmB4Lia4LmH4LiBJywgZGVzY3JpcHRpb246ICfguKrguK3guJrguJXguIHguYPguJnguITguKPguLHguYnguIfguYHguKPguIEg4LmB4LiV4LmI4LiB4Lil4Lix4Lia4Lih4Liy4Liq4Lit4Lia4Lic4LmI4Liy4LiZ4LmE4LiU4LmJJywgaWNvbjogJ2ZhLXNoaWVsZC1hbHQgdGV4dC1ncmF5LTYwMCcgfSwKICAgICAgICAgICAgU1BFQ0lBTElTVDogeyBpZDogJ3NwZWNpYWxpc3QnLCBuYW1lOiAn4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiNJywgZGVzY3JpcHRpb246ICfguYTguJTguYnguITguLDguYHguJnguJnguYDguJXguYfguKHguYPguJnguJfguLjguIHguYHguJrguJrguJfguJTguKrguK3guJrguILguK3guIfguYLguJvguKPguYDguIjguIQnLCBpY29uOiAnZmEtdXNlci1hc3Ryb25hdXQgdGV4dC1ibHVlLTcwMCcgfSwKICAgICAgICAgICAgUEVSU0VWRVJBTkNFOiB7IGlkOiAncGVyc2V2ZXJhbmNlJywgbmFtZTogJ+C4nOC4ueC5ieC5hOC4oeC5iOC4ouC4reC4oeC5geC4nuC5iScsIGRlc2NyaXB0aW9uOiAn4LiX4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmA4LiU4Li14Lii4Lin4LiB4Lix4LiZ4LiE4Lij4LiaIDUg4LiE4Lij4Lix4LmJ4LiHJywgaWNvbjogJ2ZhLWR1bWJiZWxsIHRleHQtZ3JheS03MDAnIH0KICAgICAgICB9OwoKICAgICAgICAvLyBVc2UgdGhlIGNvbmZpZyBwcm92aWRlZCBieSB0aGUgZW52aXJvbm1lbnQsIHdpdGggYSBmYWxsYmFjayBmb3IgbG9jYWwgZGV2ZWxvcG1lbnQKY29uc3QgZmlyZWJhc2VDb25maWcgPSB7CiAgYXBpS2V5OiAiQUl6YVN5Q1FsVnp5X0xCSW1OcDVUSk53UnVlcEZ6dnhXbThBeVprIiwKICBhdXRoRG9tYWluOiAiYWktcXVpei1hcHAtYWVmZWUuZmlyZWJhc2VhcHAuY29tIiwKICBwcm9qZWN0SWQ6ICJhaS1xdWl6LWFwcC1hZWZlZSIsCiAgc3RvcmFnZUJ1Y2tldDogImFpLXF1aXotYXBwLWFlZmVlLmZpcmViYXNlc3RvcmFnZS5hcHAiLAogIG1lc3NhZ2luZ1NlbmRlcklkOiAiMjc0MTkyMjU4MTExIiwKICBhcHBJZDogIjE6Mjc0MTkyMjU4MTExOndlYjo0MTIwYzkxMTgyMjliNTY0NGRkNDhhIiwKICBtZWFzdXJlbWVudElkOiAiRy1WOTBLUk0wTDYzIgp9OwogICAgICAgIGNvbnN0IGFwcElkID0gdHlwZW9mIF9fYXBwX2lkICE9PSAndW5kZWZpbmVkJyA/IF9fYXBwX2lkIDogJ2FpLXF1aXotZ2VuZXJhdG9yLXYzJzsKCiAgICAgICAgLy8gLS0tIERPTSBFbGVtZW50cyAtLS0KICAgICAgICBjb25zdCBhZG1pblZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW4tdmlldycpOwogICAgICAgIGNvbnN0IHN0dWRlbnRWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtdmlldycpOwogICAgICAgIGNvbnN0IHByb2plY3REYXNoYm9hcmRWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtZGFzaGJvYXJkLXZpZXcnKTsKICAgICAgICBjb25zdCBwcm9qZWN0RGV0YWlsVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWRldGFpbC12aWV3Jyk7CiAgICAgICAgY29uc3QgcXVpelJlc3VsdHNWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcmVzdWx0cy12aWV3Jyk7CiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1saXN0Jyk7CiAgICAgICAgY29uc3Qgbm9Qcm9qZWN0c01zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduby1wcm9qZWN0cy1tc2cnKTsKICAgICAgICBjb25zdCBwcm9qZWN0VGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC10aXRsZScpOwogICAgICAgIGNvbnN0IHByb2plY3RJZERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1pZC1kaXNwbGF5Jyk7CiAgICAgICAgY29uc3Qgc3R1ZGVudExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1saXN0Jyk7CiAgICAgICAgY29uc3QgbWVzc2FnZU1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2UtbW9kYWwnKTsKICAgICAgICBjb25zdCBtb2RhbE1lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtbWVzc2FnZScpOwogICAgICAgIGNvbnN0IGNyZWF0ZVByb2plY3RNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcmVhdGUtcHJvamVjdC1tb2RhbCcpOwogICAgICAgIGNvbnN0IGFkbWluUGFzc3dvcmRNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1wYXNzd29yZC1tb2RhbCcpOwogICAgICAgIGNvbnN0IGNvbmZpcm1hdGlvbk1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm1hdGlvbi1tb2RhbCcpOwogICAgICAgIGNvbnN0IHVzZXJJZERpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlci1pZC1kaXNwbGF5Jyk7CiAgICAgICAgY29uc3QgdG9waWNUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9waWMtdGFiJyk7CiAgICAgICAgY29uc3QgdGV4dFRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZXh0LXRhYicpOwogICAgICAgIGNvbnN0IHRvcGljSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLWlucHV0LWFyZWEnKTsKICAgICAgICBjb25zdCB0ZXh0SW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RleHQtaW5wdXQtYXJlYScpOwogICAgICAgIGNvbnN0IG1hbmFnZVRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW5hZ2UtdGFiJyk7CiAgICAgICAgY29uc3QgcmVzdWx0c1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLXRhYicpOwogICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkVGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlYWRlcmJvYXJkLXRhYicpOwogICAgICAgIGNvbnN0IG1hbmFnZVRhYkNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFuYWdlLXRhYi1jb250ZW50Jyk7CiAgICAgICAgY29uc3QgcmVzdWx0c1RhYkNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy10YWItY29udGVudCcpOwogICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkVGFiQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkZXJib2FyZC10YWItY29udGVudCcpOwogICAgICAgIGNvbnN0IHByb2plY3RRdWl6emVzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXF1aXp6ZXMtbGlzdCcpOwogICAgICAgIGNvbnN0IGZpbGVUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10YWInKTsKICAgICAgICBjb25zdCBmaWxlSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtaW5wdXQtYXJlYScpOwogICAgICAgIGNvbnN0IGZpbGVVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXVwbG9hZC1pbnB1dCcpOwogICAgICAgIGNvbnN0IHdvcmtzaGVldFRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3b3Jrc2hlZXQtdGFiJyk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgd29ya3NoZWV0SW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dvcmtzaGVldC1pbnB1dC1hcmVhJyk7CiAgICAgICAgY29uc3QgZ2VuZXJhdGVXb3Jrc2hlZXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtd29ya3NoZWV0LWJ0bicpOwogICAgICAgIC8vIFN0dWRlbnQgdmlldyBlbGVtZW50cwogICAgICAgIGNvbnN0IHN0dWRlbnRJbml0aWFsVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWluaXRpYWwtdmlldycpOwogICAgICAgIGNvbnN0IHN0dWRlbnROYW1lU2VsZWN0aW9uVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LW5hbWUtc2VsZWN0aW9uLXZpZXcnKTsKICAgICAgICBjb25zdCBzdHVkZW50UXVpekFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1xdWl6LWFyZWEnKTsKICAgICAgICBjb25zdCBzdHVkZW50UmVzdWx0QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXJlc3VsdC1hcmVhJyk7CiAgICAgICAgY29uc3Qgc3R1ZGVudFJlYWRpbmdBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcmVhZGluZy1hcmVhJyk7CiAgICAgICAgY29uc3QgbG9hZFF1aXpCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZC1xdWl6LWJ0bicpOwogICAgICAgIGNvbnN0IHN0YXJ0UXVpekJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1xdWl6LWJ0bicpOwogICAgICAgIGNvbnN0IHN0dWRlbnRKb2luR2FtZVZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1qb2luLWdhbWUtdmlldycpOwogICAgICAgIAogICAgICAgIC8vIFByZXNlbnRhdGlvbiBNb2RlIGVsZW1lbnRzCiAgICAgICAgY29uc3QgcHJlc2VudGF0aW9uTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlc2VudGF0aW9uLW1vZGFsJyk7CgogICAgICAgIC8vIE1vZGFscwogICAgICAgIGNvbnN0IHJlbmFtZVF1aXpNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW5hbWUtcXVpei1tb2RhbCcpOwogICAgICAgIGNvbnN0IG1vdmVRdWl6TW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LW1vZGFsJyk7CiAgICAgICAgY29uc3QgcXVpelNldHRpbmdzTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1zZXR0aW5ncy1tb2RhbCcpOwogICAgICAgIGNvbnN0IHF1aXpTdGF0dXNNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXN0YXR1cy1tb2RhbCcpOwoKICAgICAgICAvLyBMaXZlIEdhbWUgVmlldwogICAgICAgIGNvbnN0IGxpdmVHYW1lVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLWdhbWUtdmlldycpOwoKLyoqCiAqIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC5geC4geC4meC5geC4peC4sOC5geC4geC5ieC5hOC4guC5guC4hOC5ieC4lCBMYVRlWCDguJfguLXguYjguJzguLTguJTguJ7guKXguLLguJTguYLguJTguKLguK3guLHguJXguYLguJnguKHguLHguJXguLQKICogKOC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4q+C4meC5ieC4suC4leC5iOC4suC4h+C4muC4l+C5gOC4o+C4teC4ouC4meC5guC4lOC4ouC5gOC4ieC4nuC4suC4sCkKICovCmZ1bmN0aW9uIGhhbmRsZUZpeExlc3NvbkxhdGV4KCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C5guC4hOC5ieC4lOC4meC4teC5ieC4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVBdXRvRml4TGF0ZXgg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApmdW5jdGlvbiBoYW5kbGVBdXRvRml4TGF0ZXgoKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBsaXN0ZW5Gb3JDdXN0b21NYXRoVG9waWNzKCkgewogICAgLy8gaWYgKCF1c2VySWQpIHJldHVybjsgLy8g4LmE4Lih4LmI4LiI4Liz4LmA4Lib4LmH4LiZ4LiV4LmJ4Lit4LiH4LmA4LiK4LmH4LiEIHVzZXJJZCDguYHguKXguYnguKcg4LmA4Lie4Lij4Liy4Liw4LmA4Lib4LmH4LiZ4LiC4LmJ4Lit4Lih4Li54Lil4Liq4Liy4LiY4Liy4Lij4LiT4LiwCiAgICBjb25zdCBjdXN0b21Ub3BpY3NSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2N1c3RvbU1hdGhUb3BpY3NgKTsKCiAgICBvblNuYXBzaG90KGN1c3RvbVRvcGljc1JlZiwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgY3VzdG9tTWF0aFRvcGljcyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKICAgICAgICAvLyDguYDguKHguLfguYjguK3guILguYnguK3guKHguLnguKXguK3guLHguJvguYDguJTguJUg4LmD4Lir4LmJ4Lin4Liy4LiU4Lij4Liy4Lii4LiB4Liy4Lij4Lir4Lix4Lin4LiC4LmJ4Lit4LmD4Lir4Lih4LmICiAgICAgICAgcmVuZGVyVG9waWNDaGVja2JveGVzKCk7IAogICAgfSwgKGVycm9yKSA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgbGlzdGVuaW5nIGZvciBjdXN0b20gbWF0aCB0b3BpY3M6IiwgZXJyb3IpOwogICAgfSk7Cn0KCmZ1bmN0aW9uIGhhbmRsZVNlbGVjdEFsbFRvcGljcygpIHsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CiAgICAgICAgY29uc3QgY2hlY2tib3hlcyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJjaGVja2JveCJdJyk7CiAgICAgICAgY2hlY2tib3hlcy5mb3JFYWNoKGNiID0+IHsKICAgICAgICAgICAgY2IuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiI4Liz4LiZ4Lin4LiZ4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBCiAgICAgICAgdXBkYXRlU2VsZWN0ZWRUb3BpY3NDb3VudCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIGhhbmRsZURlc2VsZWN0QWxsVG9waWNzKCkgewogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRoLXRvcGljcy1jaGVja2JveC1jb250YWluZXInKTsKICAgICAgICBjb25zdCBjaGVja2JveGVzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKTsKICAgICAgICBjaGVja2JveGVzLmZvckVhY2goY2IgPT4gewogICAgICAgICAgICBjYi5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgfSk7CiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiI4Liz4LiZ4Lin4LiZ4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBCiAgICAgICAgdXBkYXRlU2VsZWN0ZWRUb3BpY3NDb3VudCgpOwogICAgfQoJCgkvKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmM4LiX4Li14LmI4Lic4Li54LmJ4LmD4LiK4LmJ4Liq4Lij4LmJ4Liy4LiH4LmA4Lit4LiHCiAqIEBwYXJhbSB7c3RyaW5nfSB0b3BpY0lkIC0gSUQg4LiC4Lit4LiH4LmA4Lit4LiB4Liq4Liy4Lij4Lir4Lix4Lin4LiC4LmJ4Lit4LmD4LiZIEZpcmVzdG9yZQogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ3VzdG9tVG9waWModG9waWNJZCkgewogICAgaWYgKCF0b3BpY0lkKSByZXR1cm47CgogICAgdHJ5IHsKICAgICAgICBjb25zdCB0b3BpY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9jdXN0b21NYXRoVG9waWNzYCwgdG9waWNJZCk7CiAgICAgICAgYXdhaXQgZGVsZXRlRG9jKHRvcGljUmVmKTsKICAgICAgICBzaG93TWVzc2FnZSgi4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgLy8g4LmE4Lih4LmI4LiV4LmJ4Lit4LiHIHJlLXJlbmRlciDguYDguK3guIcg4LmA4Lie4Lij4Liy4LiwIG9uU25hcHNob3Qg4LiI4Liw4LiV4Lij4Lin4LiI4LiI4Lix4Lia4LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmB4Lib4Lil4LiH4LmB4Lil4LiwIHJlLXJlbmRlciDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgY3VzdG9tIHRvcGljOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4LitIik7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFkZEN1c3RvbU1hdGhUb3BpYygpIHsKICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1c3RvbS1tYXRoLXRvcGljLWlucHV0Jyk7CiAgICBjb25zdCB0b3BpY05hbWUgPSBpbnB1dC52YWx1ZS50cmltKCk7CgogICAgaWYgKCF0b3BpY05hbWUpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4Lib4LmJ4Lit4LiZ4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LmA4Lie4Li04LmI4LihIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF1c2VySWQpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmD4LiK4LmJIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4muC4seC4meC4l+C4tuC4geC5hOC4lOC5iSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IGN1c3RvbVRvcGljc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvY3VzdG9tTWF0aFRvcGljc2ApOwogICAgICAgIGF3YWl0IGFkZERvYyhjdXN0b21Ub3BpY3NSZWYsIHsKICAgICAgICAgICAgbmFtZTogdG9waWNOYW1lLAogICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpCiAgICAgICAgfSk7CiAgICAgICAgaW5wdXQudmFsdWUgPSAnJzsgLy8g4Lil4LmJ4Liy4LiH4LiK4LmI4Lit4LiH4LiB4Lij4Lit4LiB4LiC4LmJ4Lit4Lih4Li54LilCiAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4nuC4tOC5iOC4oeC4q+C4seC4p+C4guC5ieC4rSAiJHt0b3BpY05hbWV9IiDguKrguLPguYDguKPguYfguIhgKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgYWRkaW5nIGN1c3RvbSB0b3BpYzoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4q+C4seC4p+C4guC5ieC4rSIpOwogICAgfQp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAovKioKICog4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Liq4LmB4LiB4LiZ4LmB4Lil4Liw4Lit4Lix4Lib4LmA4LiU4LiV4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmA4LiB4LmI4Liy4LiX4Li14LmI4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1IElEIOC5g+C4meC5geC4leC5iOC4peC4sOC4hOC4s+C4luC4suC4oQogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXBkYXRlT2xkUXVpenplcygpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlQnVsa1VwZGF0ZVF1aXpTZXR0aW5ncyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUJ1bGtVcGRhdGVRdWl6U2V0dGluZ3MoKSAgeyAvKiBSZW1vdmVkICovIH0gCgovKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4LiK4Li34LmI4Lit4LmC4Lib4Lij4LmA4LiI4LiE4LmD4Lir4Lih4LmI4Lir4Lil4Lix4LiH4LiI4Liy4LiB4LmB4LiB4LmJ4LmE4LiCCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVTYXZlUHJvamVjdE5hbWUoKSB7CiAgICBjb25zdCBwcm9qZWN0VGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXRpdGxlJyk7CiAgICBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtcHJvamVjdC1uYW1lLWJ0bicpOwogICAgY29uc3QgbmV3TmFtZSA9IHByb2plY3RUaXRsZUVsLnRleHRDb250ZW50LnRyaW0oKTsKCiAgICBpZiAoIW5ld05hbWUgfHwgIWN1cnJlbnRQcm9qZWN0SWQpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiK4Li34LmI4Lit4LmC4Lib4Lij4LmA4LiI4LiE4Lir4LmJ4Liy4Lih4Lin4LmI4Liy4LiHIik7CiAgICAgICAgcHJvamVjdFRpdGxlRWwudGV4dENvbnRlbnQgPSBjdXJyZW50UHJvamVjdERhdGEucHJvamVjdE5hbWU7IC8vIOC4hOC4t+C4meC4hOC5iOC4suC5gOC4lOC4tOC4oQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBzYXZlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIHNhdmVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+JzsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBjdXJyZW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgeyBwcm9qZWN0TmFtZTogbmV3TmFtZSB9KTsKCiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiC4LmJ4Lit4Lih4Li54Lil4LmD4LiZIHN0YXRlIOC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4lOC5ieC4p+C4ogogICAgICAgIGlmKGN1cnJlbnRQcm9qZWN0RGF0YSkgewogICAgICAgICAgICBjdXJyZW50UHJvamVjdERhdGEucHJvamVjdE5hbWUgPSBuZXdOYW1lOwogICAgICAgIH0KCiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4m+C4peC4teC5iOC4ouC4meC4iuC4t+C5iOC4reC5guC4m+C4o+C5gOC4iOC4hOC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBwcm9qZWN0IG5hbWU6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIEiKTsKICAgICAgICBwcm9qZWN0VGl0bGVFbC50ZXh0Q29udGVudCA9IGN1cnJlbnRQcm9qZWN0RGF0YS5wcm9qZWN0TmFtZTsgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4LiU4Li04LihCiAgICB9IGZpbmFsbHkgewogICAgICAgIHNhdmVCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgc2F2ZUJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIHNhdmVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2F2ZSBtci0yIj48L2k+4Lia4Lix4LiZ4LiX4Li24LiBJzsKICAgIH0KfQoKLy8g4pyFIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCAxOiDguIjguLHguJTguIHguLLguKMgVUkg4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCmZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlUHJhY3RpY2VUZXN0KHRvcGljLCBncmFkZSkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctbW9kYWwnKTsKICAgIGNvbnN0IHRpdGxlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctdGl0bGUnKTsKICAgIGNvbnN0IGxvYWRlckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1sb2FkZXInKTsKICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXNlY3Rpb25zLWNvbnRhaW5lcicpOwoKICAgIC8vIDEuIFJlc2V0IOC5geC4peC4sOC5geC4quC4lOC4hyBNb2RhbCDguJ7guKPguYnguK3guKEgTG9hZGVyCiAgICB0aXRsZUVsLnRleHRDb250ZW50ID0gYOC4geC4s+C4peC4seC4h+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mjogJHt0b3BpY31gOwogICAgY29udGVudENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIGxvYWRlckVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8gMi4g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGdlbmVyYXRvciDguJXguLHguKfguYPguKvguKHguYgKICAgIGdlbmVyYXRlUHJhY3RpY2VUZXN0KHRvcGljLCBncmFkZSkuY2F0Y2goZXJyID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gZ2VuZXJhdGUgcHJhY3RpY2UgdGVzdDoiLCBlcnIpOwogICAgICAgIHNob3dNZXNzYWdlKCLguILguK3guK3guKDguLHguKIsIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C4q+C4o+C4seC4muC4q+C4seC4p+C4guC5ieC4reC4meC4teC5ieC5hOC4lOC5iSIpOwogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSk7Cn0KCi8vIOKchSDguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYggMjog4LmA4Lij4Li14Lii4LiBIEFQSSDguYHguKXguLDguYHguKrguJTguIfguJzguKXguYDguInguJ7guLLguLDguKrguYjguKfguJnguYHguJrguJrguJfguJTguKrguK3guJoKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVQcmFjdGljZVRlc3QodG9waWMsIGdyYWRlTGV2ZWwpIHsKICAgIC8vIOC4i+C5iOC4reC4meC4l+C4uOC4geC4quC5iOC4p+C4meC4guC4reC4h+C4muC4l+C5gOC4o+C4teC4ouC4meC4geC5iOC4reC4mQogICAgWydwb2ludENvbnRlbnQnLCAnbWVtb3J5Q29udGVudCcsICdhcHBsaWNhdGlvbkNvbnRlbnQnLCAnc3VtbWFyeUNvbnRlbnQnXS5mb3JFYWNoKGlkID0+IHsKICAgICAgICBjb25zdCBwYXJlbnRTZWN0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpLnBhcmVudEVsZW1lbnQ7CiAgICAgICAgaWYgKHBhcmVudFNlY3Rpb24pIHsKICAgICAgICAgICAgcGFyZW50U2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIH0KICAgIH0pOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgb25ldEZvY3VzUHJvbXB0ID0gYOC5guC4lOC4ouC5gOC4meC5ieC4meC4quC4o+C5ieC4suC4h+C5guC4iOC4l+C4ouC5jOC4l+C4teC5iOC4quC4reC4lOC4hOC4peC5ieC4reC4h+C4geC4seC4muC5geC4meC4p+C4l+C4suC4h+C4guC5ieC4reC4quC4reC4miBPLU5FVCDguKrguLPguKvguKPguLHguJrguKPguLDguJTguLHguJrguIrguLHguYnguJnguJnguLXguYnguK3guKLguYjguLLguIfguYDguITguKPguYjguIfguITguKPguLHguJRgOwogICAgICAgIGNvbnN0IGFwcFByb21wdCA9IGDguKrguKPguYnguLLguIfguYHguJrguJrguJ3guLbguIHguKvguLHguJTguYHguJrguJrguJvguKPguJnguLHguKIgNCDguJXguLHguKfguYDguKXguLfguK3guIEg4LiI4Liz4LiZ4Lin4LiZIDUg4LiC4LmJ4LitIOC4quC4s+C4q+C4o+C4seC4muC4meC4seC4geC5gOC4o+C4teC4ouC4meC4o+C4sOC4lOC4seC4muC4iuC4seC5ieC4mSAnJHtncmFkZUxldmVsfScg4LmD4LiZ4Lir4Lix4Lin4LiC4LmJ4LitICcke3RvcGljfScuIOC5guC4iOC4l+C4ouC5jOC5geC4peC4sOC4leC4seC4p+C5gOC4peC4t+C4reC4geC4leC5ieC4reC4h+C4oeC4teC4hOC4p+C4suC4oeC4i+C4seC4muC4i+C5ieC4reC4meC5g+C4geC4peC5ieC5gOC4hOC4teC4ouC4h+C4geC4seC4muC5geC4meC4p+C4guC5ieC4reC4quC4reC4miBPLU5FVCDguIjguKPguLTguIfguYYuIOC4o+C4sOC4muC4uOC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAo4LmA4Lib4LmH4LiZIGluZGV4IDAtMykg4LmB4Lil4Liw4Lir4Liy4LiB4Lih4Li14Liq4Li54LiV4Lij4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmM4LmD4Lir4LmJ4LmD4LiK4LmJ4Lij4Li54Lib4LmB4Lia4LiaIExhVGVYYDsKCiAgICAgICAgY29uc3QgYXBwQ29udGVudEpzb24gPSBhd2FpdCBjYWxsR2VtaW5pKGFwcFByb21wdCwgdHJ1ZSk7CgogICAgICAgIC8vIC0tLSDguKrguYjguKfguJnguYHguKrguJTguIfguJzguKUgLS0tCiAgICAgICAgY29uc3QgdGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy10aXRsZScpOwogICAgICAgIGNvbnN0IGxvYWRlckVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1sb2FkZXInKTsKICAgICAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1zZWN0aW9ucy1jb250YWluZXInKTsKICAgICAgICBjb25zdCBhcHBsaWNhdGlvblNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwbGljYXRpb25Db250ZW50JykucGFyZW50RWxlbWVudDsKCiAgICAgICAgdGl0bGVFbC5pbm5lclRleHQgPSBg4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lid4Li24LiB4Lid4LiZ4LmA4Lij4Li34LmI4Lit4LiHOiAke3RvcGljLnJlcGxhY2UoL+KAolxzL2csICcnKX0gKOC4quC4s+C4q+C4o+C4seC4miAke2dyYWRlTGV2ZWx9KWA7CgogICAgICAgIGN1cnJlbnRBcHBsaWNhdGlvbkRhdGEgPSBKU09OLnBhcnNlKGFwcENvbnRlbnRKc29uKTsKICAgICAgICBjb25zdCBhcHBsaWNhdGlvbkNvbnRlbnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBsaWNhdGlvbkNvbnRlbnQnKTsKICAgICAgICBhcHBsaWNhdGlvbkNvbnRlbnRFbC5pbm5lckhUTUwgPSBjdXJyZW50QXBwbGljYXRpb25EYXRhLm1hcCgocSwgaW5kZXgpID0+IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iYXBwbGljYXRpb24tcXVlc3Rpb24gbWItNCI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtpbmRleCArIDF9LiAke21hcmtlZC5wYXJzZUlubGluZShxLnF1ZXN0aW9uKX08L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhcHBsaWNhdGlvbi1vcHRpb25zIG10LTIiIGlkPSJxJHtpbmRleH0tb3B0aW9ucyI+CiAgICAgICAgICAgICAgICAgICAgJHtxLm9wdGlvbnMubWFwKChvcHQsIG9wdEluZGV4KSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InctZnVsbCB0ZXh0LWxlZnQgcC0yIGJvcmRlciByb3VuZGVkLW1kIG10LTEgaG92ZXI6YmctZ3JheS0xMDAiIG9uY2xpY2s9ImNoZWNrQW5zd2VyKCR7aW5kZXh9LCAke29wdEluZGV4fSkiPiR7U3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIG9wdEluZGV4KX0uICR7bWFya2VkLnBhcnNlSW5saW5lKG9wdCl9PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYCkuam9pbignJyk7CgogICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgewogICAgICAgICAgICBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFthcHBsaWNhdGlvbkNvbnRlbnRFbF0pOwogICAgICAgIH0KCiAgICAgICAgLy8g4LmB4Liq4LiU4LiH4LmA4LiJ4Lie4Liy4Liw4Liq4LmI4Lin4LiZIEFQUExJQ0FUSU9OCiAgICAgICAgaWYgKGFwcGxpY2F0aW9uU2VjdGlvbikgewogICAgICAgICAgICBhcHBsaWNhdGlvblNlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgfQoKICAgICAgICBsb2FkZXJFbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBjb250ZW50Q29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGNhbGxHZW1pbmkocHJvbXB0LCBpc0pzb24gPSBmYWxzZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVMZXNzb24odG9waWNPdmVycmlkZSA9IG51bGwsIGdyYWRlTGV2ZWxPdmVycmlkZSA9IG51bGwpICB7IC8qIFJlbW92ZWQgKi8gfSAKCQkKCQkgICAgICAgIGZ1bmN0aW9uIGNoZWNrQW5zd2VyKHF1ZXN0aW9uSW5kZXgsIHNlbGVjdGVkT3B0aW9uSW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25EYXRhID0gY3VycmVudEFwcGxpY2F0aW9uRGF0YVtxdWVzdGlvbkluZGV4XTsKICAgICAgICAgICAgY29uc3Qgb3B0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxJHtxdWVzdGlvbkluZGV4fS1vcHRpb25zYCk7CiAgICAgICAgICAgIGNvbnN0IGJ1dHRvbnMgPSBvcHRpb25zQ29udGFpbmVyLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdidXR0b24nKTsKCiAgICAgICAgICAgIGZvciAobGV0IGJ0biBvZiBidXR0b25zKSB7IGJ0bi5kaXNhYmxlZCA9IHRydWU7IH0KCiAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbkluZGV4ID09PSBxdWVzdGlvbkRhdGEuYW5zd2VyKSB7CiAgICAgICAgICAgICAgICBidXR0b25zW3NlbGVjdGVkT3B0aW9uSW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2NvcnJlY3QnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJ1dHRvbnNbc2VsZWN0ZWRPcHRpb25JbmRleF0uY2xhc3NMaXN0LmFkZCgnaW5jb3JyZWN0Jyk7CiAgICAgICAgICAgICAgICBidXR0b25zW3F1ZXN0aW9uRGF0YS5hbnN3ZXJdLmNsYXNzTGlzdC5hZGQoJ2NvcnJlY3QnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCQkKd2luZG93LmhhbmRsZUdlbmVyYXRlQW5kU2hvd0xlc3NvbiA9IGhhbmRsZUdlbmVyYXRlQW5kU2hvd0xlc3NvbjsKd2luZG93LmNoZWNrQW5zd2VyID0gY2hlY2tBbnN3ZXI7CndpbmRvdy5oYW5kbGVHZW5lcmF0ZVByYWN0aWNlVGVzdCA9IGhhbmRsZUdlbmVyYXRlUHJhY3RpY2VUZXN0Owp3aW5kb3cuaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljID0gaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljOwoKLy8gLS0tIOC4leC4seC4p+C5geC4m+C4o+C5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4miBDcm9wcGVyICjguInguJrguLHguJrguYHguIHguYnguJvguLHguI3guKvguLLguKvguLIgZWxlbWVudCDguYTguKHguYjguYDguIjguK0pIC0tLQpsZXQgY3JvcHBlckluc3RhbmNlID0gbnVsbDsKCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4o+C5ieC4suC4hyBIVE1MIOC4guC4reC4hyBNb2RhbCDguK3guLHguJXguYLguJnguKHguLHguJXguLQgKOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC4oeC4tSkKZnVuY3Rpb24gZW5zdXJlQ3JvcHBlck1vZGFsRXhpc3RzKCkgewogICAgLy8g4LiW4LmJ4Liy4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC5hOC4oeC5iOC4leC5ieC4reC4h+C4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcm9wcGVyLW1vZGFsJykpIHJldHVybjsKCiAgICAvLyDguKrguKPguYnguLLguIcgSFRNTCDguJTguYnguKfguKIgSmF2YVNjcmlwdCDguYHguKXguLDguKLguLHguJTguYPguKrguYggYm9keSDguYLguJTguKLguJXguKPguIcKICAgIGNvbnN0IG1vZGFsSFRNTCA9IGAKICAgIDxkaXYgaWQ9ImNyb3BwZXItbW9kYWwiIGNsYXNzPSJmaXhlZCBpbnNldC0wIGJnLWJsYWNrIGJnLW9wYWNpdHktOTAgei1bNzBdIGhpZGRlbiBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBwLTQiPgogICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIHctZnVsbCBtYXgtdy00eGwgaC1bNzB2aF0gYmctYmxhY2sgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICA8aW1nIGlkPSJpbWFnZS10by1jcm9wIiBzcmM9IiIgY2xhc3M9Im1heC13LWZ1bGwgbWF4LWgtZnVsbCBibG9jayIgc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyBtYXgtd2lkdGg6IDEwMCU7Ij4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGdhcC00IG10LTQiPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJjYW5jZWwtY3JvcC1idG4iIGNsYXNzPSJiZy1ncmF5LTUwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyYXktNjAwIGZvbnQtYm9sZCI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+IOC4ouC4geC5gOC4peC4tOC4gQogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlybS1jcm9wLWJ0biIgY2xhc3M9ImJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyZWVuLTcwMCBmb250LWJvbGQgc2hhZG93LWxnIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNyb3AtYWx0Ij48L2k+IOC4leC4seC4lOC4quC5iOC4p+C4meC4meC4teC5iSAmIOC4quC5geC4geC4mQogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PmA7CiAgICAKICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBtb2RhbEhUTUwpOwogICAgCiAgICAvLyDguJzguLnguIEgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4Lib4Li44LmI4Lih4LiX4Li14LmI4LmA4Lie4Li04LmI4LiH4Liq4Lij4LmJ4Liy4LiHCiAgICBzZXR1cENyb3BwZXJCdXR0b25zKCk7Cn0KCmZ1bmN0aW9uIHNldHVwQ3JvcHBlckJ1dHRvbnMoKSB7CiAgICAvLyDguJvguLjguYjguKHguKLguIHguYDguKXguLTguIEKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtY3JvcC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3JvcHBlci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGlmIChjcm9wcGVySW5zdGFuY2UpIHsKICAgICAgICAgICAgY3JvcHBlckluc3RhbmNlLmRlc3Ryb3koKTsKICAgICAgICAgICAgY3JvcHBlckluc3RhbmNlID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbWVyYS1pbnB1dCcpLnZhbHVlID0gJyc7CiAgICB9KTsKCiAgICAvLyDguJvguLjguYjguKHguKLguLfguJnguKLguLHguJkKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWNyb3AtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKCFjcm9wcGVySW5zdGFuY2UpIHJldHVybjsKICAgICAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tY3JvcC1idG4nKTsKICAgICAgICBjb25zdCBvcmlnaW5hbFRleHQgPSBjb25maXJtQnRuLmlubmVySFRNTDsKICAgICAgICBjb25maXJtQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiI+PC9pPiDguIHguLPguKXguLHguIfguJvguKPguLDguKHguKfguKXguJzguKUuLi4nOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlOwoKICAgICAgICBjcm9wcGVySW5zdGFuY2UuZ2V0Q3JvcHBlZENhbnZhcygpLnRvQmxvYihhc3luYyAoYmxvYikgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3JvcHBlci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY3JvcHBlZEZpbGUgPSBuZXcgRmlsZShbYmxvYl0sICJjcm9wcGVkX2ltYWdlLnBuZyIsIHsgdHlwZTogImltYWdlL3BuZyIgfSk7CiAgICAgICAgICAgIGF3YWl0IGhhbmRsZVNjYW5JbWFnZUZvclRleHQoY3JvcHBlZEZpbGUpOwoKICAgICAgICAgICAgY29uZmlybUJ0bi5pbm5lckhUTUwgPSBvcmlnaW5hbFRleHQ7CiAgICAgICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgY3JvcHBlckluc3RhbmNlLmRlc3Ryb3koKTsKICAgICAgICAgICAgY3JvcHBlckluc3RhbmNlID0gbnVsbDsKICAgICAgICB9LCAnaW1hZ2UvcG5nJyk7CiAgICB9KTsKfQoKZnVuY3Rpb24gc3RhcnRDcm9wcGVyKGZpbGUpIHsKICAgIC8vIDEuIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC4geC5iOC4reC4meC5gOC4quC4oeC4rSDguYDguJ7guLfguYjguK3guKrguKPguYnguLLguIcgTW9kYWwg4LiW4LmJ4Liy4Lih4Lix4LiZ4Lir4Liy4Lii4LmE4LibCiAgICBlbnN1cmVDcm9wcGVyTW9kYWxFeGlzdHMoKTsKCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcm9wcGVyLW1vZGFsJyk7CiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1hZ2UtdG8tY3JvcCcpOwogICAgCiAgICAvLyAyLiDguK3guYjguLLguJnguYTguJ/guKXguYwKICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICByZWFkZXIub25sb2FkID0gKGUpID0+IHsKICAgICAgICAvLyDguJXguK3guJnguJnguLXguYkgaW1hZ2VFbGVtZW50IOC4leC5ieC4reC4h+C4oeC4teC4reC4ouC4ueC5iOC4iOC4o+C4tOC4h+C5geC4meC5iOC4meC4reC4mSAxMDAlCiAgICAgICAgaW1hZ2VFbGVtZW50LnNyYyA9IGUudGFyZ2V0LnJlc3VsdDsgCiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgICAgIGlmIChjcm9wcGVySW5zdGFuY2UpIGNyb3BwZXJJbnN0YW5jZS5kZXN0cm95KCk7CgogICAgICAgIGNyb3BwZXJJbnN0YW5jZSA9IG5ldyBDcm9wcGVyKGltYWdlRWxlbWVudCwgewogICAgICAgICAgICB2aWV3TW9kZTogMSwKICAgICAgICAgICAgZHJhZ01vZGU6ICdtb3ZlJywKICAgICAgICAgICAgYXV0b0Nyb3BBcmVhOiAwLjgsCiAgICAgICAgICAgIHJlc3RvcmU6IGZhbHNlLAogICAgICAgICAgICBndWlkZXM6IHRydWUsCiAgICAgICAgICAgIGNlbnRlcjogdHJ1ZSwKICAgICAgICAgICAgaGlnaGxpZ2h0OiBmYWxzZSwKICAgICAgICAgICAgY3JvcEJveE1vdmFibGU6IHRydWUsCiAgICAgICAgICAgIGNyb3BCb3hSZXNpemFibGU6IHRydWUsCiAgICAgICAgICAgIHRvZ2dsZURyYWdNb2RlT25EYmxjbGljazogZmFsc2UsCiAgICAgICAgfSk7CiAgICB9OwogICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7Cn0KCi8vIEV2ZW50IExpc3RlbmVycyDguKvguKXguLHguIEgKOC4p+C4suC4h+C4leC5iOC4reC4l+C5ieC4suC4oiBjb2RlIOC4meC4teC5ieC5hOC4lOC5ieC5gOC4peC4oikKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgIGNvbnN0IGNhbWVyYUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbWVyYS1pbnB1dCcpOwogICAgY29uc3QgY2FtZXJhQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbWVyYS1jcm9wLWJ0bicpOwogICAgCiAgICBpZiAoY2FtZXJhQnRuICYmIGNhbWVyYUlucHV0KSB7CiAgICAgICAgY2FtZXJhQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBjYW1lcmFJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICBjYW1lcmFJbnB1dC5jbGljaygpOwogICAgICAgIH0pOwoKICAgICAgICBjYW1lcmFJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuZmlsZXMgJiYgZS50YXJnZXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgc3RhcnRDcm9wcGVyKGUudGFyZ2V0LmZpbGVzWzBdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9KTsKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNjYW5JbWFnZUZvclRleHQoZmlsZSkgewogICAgY29uc3QgdGV4dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGV4dC1jb250ZW50LWlucHV0Jyk7CiAgICBjb25zdCBzY2FuQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW4tdGV4dC1pbWFnZS1idG4nKTsKICAgIAogICAgaWYgKCFmaWxlKSByZXR1cm47CgogICAgLy8g4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LiB4Liz4Lil4Lix4LiH4LiX4Liz4LiH4Liy4LiZCiAgICBzY2FuQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIHNjYW5CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IOC4geC4s+C4peC4seC4h+C4reC5iOC4suC4meC4o+C4ueC4m+C4oOC4suC4ni4uLic7CiAgICB0ZXh0QXJlYS5wbGFjZWhvbGRlciA9ICJBSSDguIHguLPguKXguLHguIfguJ7guKLguLLguKLguLLguKHguK3guYjguLLguJnguILguYnguK3guITguKfguLLguKHguIjguLLguIHguKPguLnguJvguKDguLLguJ7guILguK3guIfguITguLjguJMg4LiB4Lij4Li44LiT4Liy4Lij4Lit4Liq4Lix4LiB4LiE4Lij4Li54LmILi4uIjsKCiAgICB0cnkgewogICAgICAgIC8vIDEuIOC5geC4m+C4peC4h+C5hOC4n+C4peC5jOC4o+C4ueC4m+C5gOC4m+C5h+C4mSBCYXNlNjQKICAgICAgICBjb25zdCBiYXNlNjRTdHJpbmcgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0LnNwbGl0KCcsJylbMV0pOwogICAgICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsKICAgICAgICB9KTsKCiAgICAgICAgLy8gMi4g4LmA4LiV4Lij4Li14Lii4Lih4LiE4Liz4Liq4Lix4LmI4LiH4LmD4Lir4LmJIEFJCiAgICAgICAgY29uc3QgcHJvbXB0ID0gYAogICAgICAgICAgICDguKDguLLguKPguIHguLTguIg6IOC5geC4geC4sOC4guC5ieC4reC4hOC4p+C4suC4oeC4iOC4suC4geC4o+C4ueC4m+C4oOC4suC4nuC4meC4teC5iSAoT0NSKQogICAgICAgICAgICDguITguLPguKrguLHguYjguIc6CiAgICAgICAgICAgIDEuIOC4reC5iOC4suC4meC4leC4seC4p+C4reC4seC4geC4qeC4o+C4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4meC4o+C4ueC4m+C4oOC4suC4niDguYTguKHguYjguKfguYjguLLguIjguLDguYDguJvguYfguJnguKDguLLguKnguLLguYTguJfguKLguKvguKPguLfguK3guK3guLHguIfguIHguKTguKkKICAgICAgICAgICAgMi4g4LiI4Lix4LiU4Lij4Li54Lib4LmB4Lia4Lia4LmA4Lin4LmJ4LiZ4Lin4Lij4Lij4LiE4LmB4Lil4Liw4Lia4Lij4Lij4LiX4Lix4LiU4LmD4Lir4LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LiV4LmJ4LiZ4LiJ4Lia4Lix4Lia4Lih4Liy4LiB4LiX4Li14LmI4Liq4Li44LiUCiAgICAgICAgICAgIDMuIOC5hOC4oeC5iOC4leC5ieC4reC4h+C5g+C4quC5iOC4hOC4s+C4meC4s+C4q+C4meC5ieC4suC4reC4ouC5iOC4suC4hyAi4LiZ4Li14LmI4LiE4Li34Lit4LiC4LmJ4Lit4LiE4Lin4Liy4LihIiDguYPguKvguYnguKrguYjguIfguITguLfguJnguYDguInguJ7guLLguLDguYDguJnguLfguYnguK3guKvguLLguYPguJnguKPguLnguJvguYDguJfguYjguLLguJnguLHguYnguJkKICAgICAgICBgOwoKICAgICAgICAvLyAzLiDguYDguKPguLXguKLguIHguYPguIrguYkgaGFuZGxlQXBpQ2FsbCAo4Liq4LmI4LiH4LmE4Lib4LmB4Lia4Lia4LmE4Lih4LmI4Lih4Li1IFNjaGVtYSDguYDguJ7guLfguYjguK3guILguK0gVGV4dCDguKXguYnguKfguJnguYYpCiAgICAgICAgY29uc3QgcGFydHMgPSBbCiAgICAgICAgICAgIHsgdGV4dDogcHJvbXB0IH0sCiAgICAgICAgICAgIHsgaW5saW5lRGF0YTogeyBtaW1lVHlwZTogZmlsZS50eXBlLCBkYXRhOiBiYXNlNjRTdHJpbmcgfSB9CiAgICAgICAgXTsKCiAgICAgICAgLy8g4LmD4LiK4LmJIGZhbHNlIOC5gOC4nuC4t+C5iOC4reC5hOC4oeC5iOC5g+C4q+C5ieC5geC4quC4lOC4h+C4nOC4pSBRdWl6LCDguYHguKXguLAgbnVsbCBzY2hlbWEg4LmA4Lie4Li34LmI4Lit4LiC4LitIFN0cmluZwogICAgICAgIGNvbnN0IGV4dHJhY3RlZFRleHQgPSBhd2FpdCBoYW5kbGVBcGlDYWxsKHBhcnRzLCAiQUkg4LiB4Liz4Lil4Lix4LiH4Liq4LmB4LiB4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4LihLi4uIiwgbnVsbCwgbnVsbCwgZmFsc2UpOwoKICAgICAgICBpZiAoZXh0cmFjdGVkVGV4dCkgewogICAgICAgICAgICAvLyA0LiDguJnguLPguILguYnguK3guITguKfguLLguKHguJfguLXguYjguYTguJTguYnguKHguLLguYPguKrguYjguKXguIfguYPguJkgVGV4dGFyZWEgKOC4leC5iOC4reC4iOC4suC4geC4guC4reC4h+C5gOC4lOC4tOC4oeC4luC5ieC4suC4oeC4tSkKICAgICAgICAgICAgY29uc3QgY3VycmVudFRleHQgPSB0ZXh0QXJlYS52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIHRleHRBcmVhLnZhbHVlID0gY3VycmVudFRleHQgPyBjdXJyZW50VGV4dCArICJcblxuIiArIGV4dHJhY3RlZFRleHQgOiBleHRyYWN0ZWRUZXh0OwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4Liq4LmB4LiB4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinISDguITguLjguJPguKrguLLguKHguLLguKPguJbguJXguKPguKfguIjguKrguK3guJrguYHguKXguLDguYHguIHguYnguYTguILguYTguJTguYnguIHguYjguK3guJnguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFJIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4reC5iOC4suC4meC4guC5ieC4reC4hOC4p+C4suC4oeC5hOC4lOC5iSIpOwogICAgICAgIH0KCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIk9DUiBFcnJvcjoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4reC5iOC4suC4meC4o+C4ueC4m+C4oOC4suC4njogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyDguITguLfguJnguITguYjguLLguJvguLjguYjguKEKICAgICAgICBzY2FuQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgc2NhbkJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1jYW1lcmEiPjwvaT4g4Liq4LmB4LiB4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiI4Liy4LiB4Lij4Li54Lib4Lig4Liy4LieJzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nhbi10ZXh0LWltYWdlLWlucHV0JykudmFsdWUgPSAnJzsgLy8g4Lij4Li14LmA4LiL4LmH4LiVIGlucHV0CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICB0cnkgewogICAgICAgIGNvbnN0IGFwcCA9IGluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpOwogICAgICAgIGRiID0gZ2V0RmlyZXN0b3JlKGFwcCk7CiAgICAgICAgYXV0aCA9IGdldEF1dGgoYXBwKTsKICAgICAgICBzZXR1cEF1dGhMaXN0ZW5lcigpOwogICAgICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTsKICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOyAKICAgICAgICByZW5kZXJUb3BpY0NoZWNrYm94ZXMoKTsKICAgICAgICAKICAgICAgICAvLyAtLS0gWyDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYnguYDguILguYnguLLguYTguJvguYPguJnguJXguK3guJnguJfguYnguLLguKLguILguK3guIcgdHJ5IGJsb2NrIF0gLS0tCiAgICAgICAgc2V0dXBTdHVkZW50UHJvZ3Jlc3NMaXN0ZW5lcnMoKTsKCQlyZXN1bWVBY3RpdmVHYW1lU2Vzc2lvbigpOwoJCWxpc3RlbkZvckZpbGVTaG9ydGN1dHMoKTsKCQlsaXN0ZW5Gb3JQYXJhbGxlbFRlc3RTaG9ydGN1dHMoKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZpcmViYXNlIGluaXRpYWxpemF0aW9uIGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC5gOC4iuC4t+C5iOC4reC4oeC4leC5iOC4reC4geC4seC4muC4kOC4suC4meC4guC5ieC4reC4oeC4ueC4peC5hOC4lOC5iSIpOwogICAgfQp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVZlcmlmeUFuc3dlcnNJbkVkaXRvcigpICB7IC8qIFJlbW92ZWQgKi8gfSAKCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVZlcmlmaWNhdGlvblJlc3VsdHNJbkVkaXRvcihyZXN1bHRzKSB7CiAgICAgICAgICAgIHJlc3VsdHMuZm9yRWFjaChyZXMgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25EaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAucXVlc3Rpb24tZWRpdG9yLWl0ZW1bZGF0YS1xLWluZGV4PSIke3Jlcy5xdWVzdGlvbkluZGV4fSJdYCk7CiAgICAgICAgICAgICAgICBpZiAoIXF1ZXN0aW9uRGl2KSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZlcmlmaWNhdGlvbiA9IHF1ZXN0aW9uRGl2LnF1ZXJ5U2VsZWN0b3IoJy52ZXJpZmljYXRpb24tcmVzdWx0LWVkaXRvcicpOwogICAgICAgICAgICAgICAgaWYgKG9sZFZlcmlmaWNhdGlvbikgb2xkVmVyaWZpY2F0aW9uLnJlbW92ZSgpOwoKICAgICAgICAgICAgICAgIGxldCByZXN1bHRIdG1sID0gJyc7CgogICAgICAgICAgICAgICAgLy8g4pa84pa84pa8IFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4leC4o+C4o+C4geC4sOC4quC4s+C4hOC4seC4jTog4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4LiyIEFJIOC4quC4seC5iOC4h+C5g+C4q+C5ieC4quC4o+C5ieC4suC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4q+C4oeC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iCDilrzilrzilrwKICAgICAgICAgICAgICAgIGlmIChyZXMubmV3T3B0aW9uc1BheWxvYWQgJiYgcmVzLm5ld09wdGlvbnNQYXlsb2FkLm5ld09wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdPcHRpb25zID0gcmVzLm5ld09wdGlvbnNQYXlsb2FkLm5ld09wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Q29ycmVjdEluZGV4ID0gcmVzLm5ld09wdGlvbnNQYXlsb2FkLm5ld0NvcnJlY3RJbmRleDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbkRpdi5kYXRhc2V0LnFUeXBlOwoKICAgICAgICAgICAgICAgICAgICAvLyDguYPguIrguYnguYTguJTguYnguYDguInguJ7guLLguLDguIHguLHguJogbXVsdGlwbGVfY2hvaWNlCiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDEuIOC4hOC5ieC4meC4q+C4suC4iuC5iOC4reC4h+C4geC4o+C4reC4geC4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4meC4guC5ieC4reC4meC4seC5ieC4mQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25JbnB1dHMgPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJ0ZXh0Il0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIuIOC4p+C4meC4peC4ueC4m+C5gOC4guC4teC4ouC4meC4l+C4seC4muC4hOC5iOC4siAodmFsdWUpIOC4guC4reC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5gOC4lOC4tOC4oeC4lOC5ieC4p+C4ouC4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4q+C4oeC5iOC4iOC4suC4gSBBSQogICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25JbnB1dHMuZm9yRWFjaCgoaW5wdXQsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdPcHRpb25zW2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSBuZXdPcHRpb25zW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguIHguKPguJPguLXguJnguLXguYnguJnguYjguLLguIjguLDguYTguKHguYjguYDguIHguLTguJQg4LmB4LiV4LmI4LmD4Liq4LmI4LmE4Lin4LmJ4LiB4Lix4LiZ4Lie4Lil4Liy4LiUCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsdWUgPSAiLS0tIChBSSDguYTguKHguYjguYTguJTguYnguKrguKPguYnguLLguIfguJXguLHguKfguYDguKXguLfguK3guIHguJnguLXguYkpIC0tLSI7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDMuIOC4hOC5ieC4meC4q+C4suC4m+C4uOC5iOC4oSBSYWRpbyDguJfguLXguYjguJXguKPguIfguIHguLHguJrguYDguInguKXguKLguYPguKvguKHguYgg4LmB4Lil4LmJ4Lin4Liq4Lix4LmI4LiHICdjaGVja2VkJwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpb1RvU2VsZWN0ID0gcXVlc3Rpb25EaXYucXVlcnlTZWxlY3RvcihgaW5wdXRbdHlwZT0icmFkaW8iXVt2YWx1ZT0iJHtuZXdDb3JyZWN0SW5kZXh9Il1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJhZGlvVG9TZWxlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvVG9TZWxlY3QuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDQuIOC5geC4quC4lOC4h+C4guC5ieC4reC4hOC4p+C4suC4oeC5geC4iOC5ieC4h+C5gOC4leC4t+C4reC4meC4quC4teC5gOC4q+C4peC4t+C4reC4hyAo4Lij4Li44LiZ4LmB4Lij4LiH4LiB4Lin4LmI4LiyKQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmVyaWZpY2F0aW9uLXJlc3VsdC1lZGl0b3IgbXQtMiBwLTMgYm9yZGVyLWwtNCBib3JkZXIteWVsbG93LTQwMCBiZy15ZWxsb3ctNTAgdGV4dC15ZWxsb3ctODAwIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIiPjxpIGNsYXNzPSJmYXMgZmEtbWFnaWMtd2FuZC1zcGFya2xlcyBtci0yIj48L2k+QUkg4LiV4Lij4Lin4LiI4LmE4Lih4LmI4Lie4Lia4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHITwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD7guKPguLDguJrguJrguYTguJTguYnguKrguKPguYnguLLguIfguIrguLjguJTguJXguLHguKfguYDguKXguLfguK3guIHguYPguKvguKHguYgg4LmB4Lil4Liw4LmB4LiB4LmJ4LmE4LiC4LmA4LiJ4Lil4Lii4LmD4Lir4LmJ4LiW4Li54LiB4LiV4LmJ4Lit4LiH4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li04LmB4Lil4LmJ4LinPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIDUuIOC5hOC4ruC5hOC4peC4l+C5jOC4geC4suC4o+C5jOC4lOC4hOC4s+C4luC4suC4oeC4meC4seC5ieC4meC5g+C4q+C5ieC5gOC4m+C5h+C4meC4quC4teC5gOC4q+C4peC4t+C4reC4h+C4iuC4seC5iOC4p+C4guC4k+C4sAogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkRpdi5jbGFzc0xpc3QuYWRkKCdiZy15ZWxsb3ctMjAwJywgJ3RyYW5zaXRpb24tYWxsJywgJ2R1cmF0aW9uLTMwMCcpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGl2LmNsYXNzTGlzdC5yZW1vdmUoJ2JnLXllbGxvdy0yMDAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgMjUwMCk7IC8vIOC5geC4quC4lOC4h+C5hOC4ruC5hOC4peC4l+C5jCAyLjUg4Lin4Li04LiZ4Liy4LiX4Li1CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyDilrzilrzilrwgW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4LihIGVsc2UgaWYg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4LiV4Lij4Lij4LiB4Liw4LmA4LiU4Li04Lih4Lii4Lix4LiH4LiX4Liz4LiH4Liy4LiZ4LmE4LiU4LmJIOKWvOKWvOKWvAogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcmVzLmlzQ29ycmVjdCAmJiByZXMuc3VnZ2VzdGVkQW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gKOC4leC4o+C4o+C4geC4sOC5gOC4lOC4tOC4oeC4guC4reC4h+C4hOC4uOC4kzog4LiW4LmJ4Liy4LmA4LiJ4Lil4Lii4Lic4Li04LiUIOC5geC4leC5iOC4oeC4teC5gOC4ieC4peC4ouC5g+C4meC4leC4seC4p+C5gOC4peC4t+C4reC4geC4reC4t+C5iOC4mSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhdXRvRml4TWVzc2FnZSA9IHJlcy5zdWdnZXN0ZWRBbnN3ZXIgPyAnIDxzdHJvbmcgY2xhc3M9InRleHQtZ3JlZW4tNjAwIj4o4LmB4LiB4LmJ4LmE4LiC4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0KTwvc3Ryb25nPicgOiAnJzsKICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb24tcmVzdWx0LWVkaXRvciBtdC0yIHAtMyBib3JkZXItbC00IGJvcmRlci1yZWQtNDAwIGJnLXJlZC01MCB0ZXh0LXJlZC04MDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIj48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIG1yLTIiPjwvaT5BSSDguJXguKPguKfguIjguJ7guJrguKfguYjguLLguYDguInguKXguKLguK3guLLguIjguYTguKHguYjguJbguLnguIHguJXguYnguK3guIcke2F1dG9GaXhNZXNzYWdlfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+4LmA4Lir4LiV4Li44Lic4LilOjwvc3Ryb25nPiAke3Jlcy5qdXN0aWZpY2F0aW9ufTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVzLnN1Z2dlc3RlZEFuc3dlciA/IGA8cD48c3Ryb25nPuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC5geC4meC4sOC4meC4szo8L3N0cm9uZz4gJHtyZXMuc3VnZ2VzdGVkQW5zd2VyfTwvcD5gIDogJyd9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gKOC4quC5iOC4p+C4mSBhdXRvLWZpeCDguILguK3guIfguITguLjguJPguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb25EaXYuZGF0YXNldC5xVHlwZTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBoaWdobGlnaHRFbGVtZW50ID0gKGVsKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZWwpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnYmctZ3JlZW4tMjAwJywgJ3RyYW5zaXRpb24tYWxsJywgJ2R1cmF0aW9uLTMwMCcpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgZWwuY2xhc3NMaXN0LnJlbW92ZSgnYmctZ3JlZW4tMjAwJyk7IH0sIDI1MDApOwogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbE9wdGlvbklucHV0cyA9IEFycmF5LmZyb20ocXVlc3Rpb25EaXYucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0idGV4dCJdJykpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWdnZXN0ZWRJbmRleCA9IGFsbE9wdGlvbklucHV0cy5maW5kSW5kZXgob3B0ID0+IG9wdC52YWx1ZS50cmltKCkudG9Mb3dlckNhc2UoKSA9PT0gcmVzLnN1Z2dlc3RlZEFuc3dlci50cmltKCkudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWdnZXN0ZWRJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvVG9TZWxlY3QgPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yKGBpbnB1dFt0eXBlPSJyYWRpbyJdW3ZhbHVlPSIke3N1Z2dlc3RlZEluZGV4fSJdYCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFkaW9Ub1NlbGVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhZGlvVG9TZWxlY3QuY2hlY2tlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudChyYWRpb1RvU2VsZWN0LmNsb3Nlc3QoJ2RpdicpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnB1dEZpZWxkID0gcXVlc3Rpb25EaXYucXVlcnlTZWxlY3RvcignLmlkZWFsLWFuc3dlci1pbnB1dCwgLmNvcnJlY3QtcmVzcG9uc2UtaW5wdXQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlucHV0RmllbGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0RmllbGQudmFsdWUgPSByZXMuc3VnZ2VzdGVkQW5zd2VyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudChpbnB1dEZpZWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VnZ2VzdGVkVmFsdWUgPSByZXMuc3VnZ2VzdGVkQW5zd2VyLnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYWRpb1RvU2VsZWN0ID0gcXVlc3Rpb25EaXYucXVlcnlTZWxlY3RvcihgaW5wdXRbdHlwZT0icmFkaW8iXVt2YWx1ZT0iJHtzdWdnZXN0ZWRWYWx1ZX0iXWApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFkaW9Ub1NlbGVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9Ub1NlbGVjdC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodEVsZW1lbnQocmFkaW9Ub1NlbGVjdC5jbG9zZXN0KCdkaXYnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcy5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAvLyAo4LiV4Lij4Lij4LiB4Liw4LmA4LiU4Li04LihOiDguJbguYnguLLguJbguLnguIHguJXguYnguK3guIcpCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SHRtbCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmVyaWZpY2F0aW9uLXJlc3VsdC1lZGl0b3IgbXQtMiB0ZXh0LXNtIHRleHQtZ3JlZW4tNzAwIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIiPjwvaT4gQUkg4Lii4Li34LiZ4Lii4Lix4LiZ4Lin4LmI4Liy4LmA4LiJ4Lil4Lii4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyDilrLilrLilrIgW+C4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4gl0g4pay4pay4payCgogICAgICAgICAgICAgICAgcXVlc3Rpb25EaXYuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCByZXN1bHRIdG1sKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguJXguKPguKfguIjguJfguLLguJnguYDguInguKXguKLguYDguKrguKPguYfguIjguKrguLTguYnguJkhIik7CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVWZXJpZnlBbnN3ZXJzKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICAvKioKICAgICAgICAgKiDguYHguKrguJTguIfguJzguKXguKXguLHguJ7guJjguYzguIHguLLguKPguJXguKPguKfguIjguJfguLLguJnguJrguJkgVUkKICAgICAgICAgKiBAcGFyYW0ge0FycmF5fSByZXN1bHRzIC0g4Lic4Lil4Lil4Lix4Lie4LiY4LmM4LiX4Li14LmI4LmE4LiU4LmJ4LiI4Liy4LiBIEFJIOC4leC4o+C4p+C4iOC4l+C4suC4mQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlWZXJpZmljYXRpb25SZXN1bHRzKHJlc3VsdHMpIHsKICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvbkRpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltkYXRhLXF1ZXN0aW9uLWluZGV4PSIke3Jlcy5xdWVzdGlvbkluZGV4fSJdYCk7CiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25EaXYpIHsKICAgICAgICAgICAgICAgICAgICAvLyDguKXguJrguJzguKXguIHguLLguKPguJXguKPguKfguIjguJfguLLguJnguYDguIHguYjguLLguK3guK3guIHguIHguYjguK3guJkgKOC4luC5ieC4suC4oeC4tSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRWZXJpZmljYXRpb24gPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uLXJlc3VsdCcpOwogICAgICAgICAgICAgICAgICAgIGlmIChvbGRWZXJpZmljYXRpb24pIG9sZFZlcmlmaWNhdGlvbi5yZW1vdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdEh0bWwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmVyaWZpY2F0aW9uLXJlc3VsdCBtdC0yIHRleHQtc20gdGV4dC1ncmVlbi03MDAgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIiPjwvaT4gQUkg4Lii4Li34LiZ4Lii4Lix4LiZ4Lin4LmI4Liy4LmA4LiJ4Lil4Lii4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idmVyaWZpY2F0aW9uLXJlc3VsdCBtdC0yIHAtMyBib3JkZXItbC00IGJvcmRlci1yZWQtNDAwIGJnLXJlZC01MCB0ZXh0LXJlZC04MDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciI+PGkgY2xhc3M9ImZhcyBmYS1leGNsYW1hdGlvbi10cmlhbmdsZSBtci0yIj48L2k+QUkg4LiV4Lij4Lin4LiI4Lie4Lia4Lin4LmI4Liy4LmA4LiJ4Lil4Lii4Lit4Liy4LiI4LmE4Lih4LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+4LmA4Lir4LiV4Li44Lic4LilOjwvc3Ryb25nPiAke3Jlcy5qdXN0aWZpY2F0aW9ufTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3Jlcy5zdWdnZXN0ZWRBbnN3ZXIgPyBgPHA+PHN0cm9uZz7guITguLPguJXguK3guJrguJfguLXguYjguYHguJnguLDguJnguLM6PC9zdHJvbmc+ICR7cmVzLnN1Z2dlc3RlZEFuc3dlcn08L3A+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGl2Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgcmVzdWx0SHRtbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiV4Lij4Lin4LiI4LiX4Liy4LiZ4LmA4LiJ4Lil4Lii4LmA4Liq4Lij4LmH4LiI4Liq4Li04LmJ4LiZISIpOwogICAgICAgIH0KCQkKCQkvKioKICog4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LmA4Lib4Lij4Li14Lii4Lia4LmA4LiX4Li14Lii4Lia4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LmC4LiU4Lii4LmA4LiJ4Lie4Liy4LiwCiAqIEBwYXJhbSB7c3RyaW5nfSB1c2VyQW5zd2VyIOC4hOC4s+C4leC4reC4muC4iOC4suC4geC4nOC4ueC5ieC5g+C4iuC5iQogKiBAcGFyYW0ge3N0cmluZ30gaWRlYWxBbnN3ZXIg4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAqIEByZXR1cm5zIHtib29sZWFufSDguITguLfguJnguITguYjguLIgdHJ1ZSDguJbguYnguLLguJXguLHguKfguYDguKXguILguYDguJfguLXguKLguJrguYDguJfguYjguLLguIHguLHguJkKICovCmZ1bmN0aW9uIGNvbXBhcmVOdW1lcmljYWxBbnN3ZXJzKHVzZXJBbnN3ZXIsIGlkZWFsQW5zd2VyKSB7CiAgICAvLyDguYHguJvguKXguIcgY29tbWEg4LmA4Lib4LmH4LiZIHBlcmlvZCDguYHguKXguLDguJXguLHguJTguJXguLHguKfguK3guLHguIHguKnguKPguJfguLXguYjguYTguKHguYjguYPguIrguYjguJXguLHguKfguYDguKXguILguK3guK3guIEgKOC4ouC4geC5gOC4p+C5ieC4meC4iOC4uOC4lOC4l+C4qOC4meC4tOC4ouC4oeC5geC4peC4sOC5gOC4hOC4o+C4t+C5iOC4reC4h+C4q+C4oeC4suC4ouC4peC4mikKICAgIGNvbnN0IGNsZWFuVXNlclN0ciA9IFN0cmluZyh1c2VyQW5zd2VyKS5yZXBsYWNlKCcsJywgJy4nKS5yZXBsYWNlKC9bXlxkLi1dL2csICcnKS50cmltKCk7CiAgICBjb25zdCBjbGVhbklkZWFsU3RyID0gU3RyaW5nKGlkZWFsQW5zd2VyKS5yZXBsYWNlKCcsJywgJy4nKS5yZXBsYWNlKC9bXlxkLi1dL2csICcnKS50cmltKCk7CgogICAgLy8g4LiW4LmJ4Liy4Liq4LiV4Lij4Li04LiH4Lin4LmI4Liy4LiH4LmA4Lib4Lil4LmI4Liy4Lir4Lil4Lix4LiH4LiI4Liy4LiB4LiB4Liy4Lij4Lil4LmJ4Liy4LiH4LiE4LmI4LiyIOC5g+C4q+C5ieC4luC4t+C4reC4p+C5iOC4suC5hOC4oeC5iOC5g+C4iuC5iOC4leC4seC4p+C5gOC4peC4ggogICAgaWYgKGNsZWFuVXNlclN0ciA9PT0gJycgfHwgY2xlYW5JZGVhbFN0ciA9PT0gJycpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgY29uc3QgdXNlck51bSA9IHBhcnNlRmxvYXQoY2xlYW5Vc2VyU3RyKTsKICAgIGNvbnN0IGlkZWFsTnVtID0gcGFyc2VGbG9hdChjbGVhbklkZWFsU3RyKTsKCiAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJfguLHguYnguIfguKrguK3guIfguITguYjguLLguYDguJvguYfguJnguJXguLHguKfguYDguKXguILguJfguLXguYjguJbguLnguIHguJXguYnguK3guIfguKvguKPguLfguK3guYTguKHguYgKICAgIGlmIChpc05hTih1c2VyTnVtKSB8fCBpc05hTihpZGVhbE51bSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgLy8g4LmA4Lib4Lij4Li14Lii4Lia4LmA4LiX4Li14Lii4Lia4LiV4Lix4Lin4LmA4Lil4LiC4LmC4LiU4Lii4Lii4Lit4Lih4Lij4Lix4Lia4LiE4LmI4Liy4LiE4Lil4Liy4LiU4LmA4LiE4Lil4Li34LmI4Lit4LiZ4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4LiiIChFcHNpbG9uKSDguKrguLPguKvguKPguLHguJrguJfguKjguJnguLTguKLguKEKICAgIHJldHVybiBNYXRoLmFicyh1c2VyTnVtIC0gaWRlYWxOdW0pIDwgMC4wMDE7Cn0KCi8qKgogKiBb4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIXSBIZWxwZXIg4Liq4Liz4Lir4Lij4Lix4Lia4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4Lih4Li14LmB4LiZ4Lin4LmC4LiZ4LmJ4Lih4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4Lir4Lij4Li34Lit4LmE4Lih4LmICiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gc3RyIC0g4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiV4Lij4Lin4LiI4Liq4Lit4LiaCiAqIEByZXR1cm5zIHtib29sZWFufQogKi8KZnVuY3Rpb24gaXNQb3RlbnRpYWxseU51bWVyaWMoc3RyKSB7CiAgICBpZiAodHlwZW9mIHN0ciAhPT0gJ3N0cmluZycgJiYgdHlwZW9mIHN0ciAhPT0gJ251bWJlcicpIHJldHVybiBmYWxzZTsKICAgIC8vIOC5geC4l+C4meC4l+C4teC5iOC4hOC4reC4oeC4oeC5iOC4suC4lOC5ieC4p+C4ouC4iOC4uOC4lCDguYHguKXguLDguKXguJrguIrguYjguK3guIfguKfguYjguLLguIcKICAgIGNvbnN0IGNsZWFuZWRTdHIgPSBTdHJpbmcoc3RyKS5yZXBsYWNlKCcsJywgJy4nKS50cmltKCk7CiAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguYTguKHguYjguYPguIrguYjguKrguJXguKPguLTguIfguKfguYjguLLguIcg4LmB4Lil4Liw4Liq4Liy4Lih4Liy4Lij4LiW4LmB4Lib4Lil4LiH4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LiX4Li14LmI4Liq4Lih4Lia4Li54Lij4LiT4LmM4LmE4LiU4LmJCiAgICByZXR1cm4gY2xlYW5lZFN0ciAhPT0gJycgJiYgIWlzTmFOKHBhcnNlRmxvYXQoY2xlYW5lZFN0cikpICYmIGlzRmluaXRlKGNsZWFuZWRTdHIpOwp9CgoKYXN5bmMgZnVuY3Rpb24gZ3JhZGVTaG9ydEFuc3dlcih1c2VyQW5zd2VyLCBxdWVzdGlvbkRhdGEpIHsKICAgIGNvbnN0IGlkZWFsQW5zd2VyID0gcXVlc3Rpb25EYXRhLmlkZWFsQW5zd2VyOwoKICAgIC8vIOC4l+C4s+C4hOC4p+C4suC4oeC4quC4sOC4reC4suC4lOC4guC5ieC4reC4oeC4ueC4pSAo4LiV4Lix4LiUICQg4LmB4Lil4Liw4LiK4LmI4Lit4LiH4Lin4LmI4Liy4LiH4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiHKQogICAgY29uc3QgY2xlYW5Vc2VyU3RyID0gU3RyaW5nKHVzZXJBbnN3ZXIpLnJlcGxhY2UoL1wkL2csICcnKS50cmltKCk7CiAgICBjb25zdCBjbGVhbklkZWFsU3RyID0gU3RyaW5nKGlkZWFsQW5zd2VyKS5yZXBsYWNlKC9cJC9nLCAnJykudHJpbSgpOwoKICAgIC8vIC0tLSDguILguLHguYnguJnguJfguLXguYggMTog4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LmB4Lia4Lia4LiV4Lij4LiH4LiV4Lix4LinIChFeGFjdCBNYXRjaCkgLS0tCiAgICBpZiAoY2xlYW5Vc2VyU3RyLnRvTG93ZXJDYXNlKCkgPT09IGNsZWFuSWRlYWxTdHIudG9Mb3dlckNhc2UoKSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8vIC0tLSDguILguLHguYnguJnguJfguLXguYggMjog4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LmA4LiK4Li04LiH4LiV4Lix4Lin4LmA4Lil4LiCIChOdW1lcmljIENoZWNrKSAtLS0KICAgIGlmIChpc1BvdGVudGlhbGx5TnVtZXJpYyhjbGVhblVzZXJTdHIpICYmIGlzUG90ZW50aWFsbHlOdW1lcmljKGNsZWFuSWRlYWxTdHIpKSB7CiAgICAgICAgaWYgKGNvbXBhcmVOdW1lcmljYWxBbnN3ZXJzKGNsZWFuVXNlclN0ciwgY2xlYW5JZGVhbFN0cikpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSDguILguLHguYnguJnguJfguLXguYggMzogKOC4m+C4tOC4lOC4geC4suC4o+C5g+C4iuC5ieC4h+C4suC4mSBBSSkgLS0tCiAgICAvLyDguJbguYnguLLguYTguKHguYjguJXguKPguIfguIHguLHguJogMiDguILguYnguK3guJrguJkg4LmD4Lir4LmJ4LiW4Li34Lit4Lin4LmI4LiyICLguJzguLTguJQiIOC4l+C4seC4meC4l+C4tQogICAgY29uc29sZS5sb2coIkV4YWN0L051bWVyaWMgY2hlY2tzIGZhaWxlZC4gQUkgZ3JhZGluZyBpcyBESVNBQkxFRC4iKTsKICAgIHJldHVybiBmYWxzZTsgCn0KCQkKYXN5bmMgZnVuY3Rpb24gcmV2ZWFsQW5zd2VyRm9yQWRtaW4oaW5kZXgsIHRvdGFsKSAgeyAvKiBSZW1vdmVkICovIH0gCgkJCi8qKgogICAgICAgICAqIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4rSBMZWFkZXJib2FyZCA1IOC4reC4seC4meC4lOC4seC4muC5geC4o+C4gSAo4Liq4Liz4Lir4Lij4Lix4LiaIEFkbWluKSAtIOC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4reC4seC4m+C5gOC4lOC4lQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBnYW1lRGF0YSAtIOC4guC5ieC4reC4oeC4ueC4peC5gOC4geC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4iOC4suC4gSBGaXJlc3RvcmUKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBzaG93VG9wNUxlYWRlcmJvYXJkVmlldyhnYW1lRGF0YSkgewogICAgICAgICAgICBjb25zdCBwbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIocCA9PiBwLnN0YXR1cyA9PT0gJ2FjdGl2ZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgcGxheWVycy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICAgICAgICAgIGNvbnN0IHRvcDUgPSBwbGF5ZXJzLnNsaWNlKDAsIDUpOwoKICAgICAgICAgICAgY29uc3QgbGVhZGVyYm9hcmRIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgbWItNiI+4LiV4Liy4Lij4Liy4LiH4LiE4Liw4LmB4LiZ4LiZPC9oMj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgc3BhY2UteS0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHt0b3A1Lm1hcCgocGxheWVyLCBpbmRleCkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmxhY2svMjAgcC0zIHJvdW5kZWQtbGcgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHRleHQteGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke2luZGV4ICsgMX0uICR7cGxheWVyLm5hbWUgfHwgT2JqZWN0LmtleXMoZ2FtZURhdGEucGxheWVycykuZmluZChrZXkgPT4gZ2FtZURhdGEucGxheWVyc1trZXldID09PSBwbGF5ZXIpfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke3BsYXllci5zY29yZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZ290by1uZXh0LXF1ZXN0aW9uLWJ0biIgY2xhc3M9ImJnLWdyYXktODAwIGhvdmVyOmJnLWJsYWNrIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQtMnhsIG10LTgiPgogICAgICAgICAgICAgICAgICAgICAgICAke2dhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMSA9PT0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGggPyAn4Liq4Lij4Li44Lib4Lic4Lil4Liq4Li44LiU4LiX4LmJ4Liy4LiiJyA6ICfguILguYnguK3guJXguYjguK3guYTguJsnfSA8aSBjbGFzcz0iZmFzIGZhLWFycm93LXJpZ2h0Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGxlYWRlcmJvYXJkSFRNTDsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb3RvLW5leHQtcXVlc3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG5leHRJbmRleCA8IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IG5leHRJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EaXNwbGF5ZWRBdDogc2VydmVyVGltZXN0YW1wKCksCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uU3RhdHVzOiAnYW5zd2VyaW5nJwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoZ2FtZURhdGEucGxheWVycykuZm9yRWFjaChwbGF5ZXJOYW1lID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRGF0YVtgcGxheWVycy4ke3BsYXllck5hbWV9LmFuc3dlcmVkQ3VycmVudFF1ZXN0aW9uYF0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgdXBkYXRlRGF0YSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCi8vIOC5guC4hOC5ieC4lOC5g+C4q+C4oeC5iOC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAo4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUKQpmdW5jdGlvbiBzZXR1cEF1dGhMaXN0ZW5lcigpIHsKICAgIG9uQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBhc3luYyAodXNlcikgPT4gewogICAgICAgIGlmICh1c2VyKSB7CiAgICAgICAgICAgIHVzZXJJZCA9IHVzZXIudWlkOwogICAgICAgICAgICB1c2VySWREaXNwbGF5LnRleHRDb250ZW50ID0gdXNlcklkOwoKICAgICAgICAgICAgLy8gLS0tIFvguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIJdIC0tLQogICAgICAgICAgICAvLyAxLiDguK3guYjguLLguJnguITguYjguLLguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguIjguLLguIEgRmlyZXN0b3JlCiAgICAgICAgICAgIGNvbnN0IHByZWZzID0gYXdhaXQgbG9hZFVzZXJQcmVmZXJlbmNlcygpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMi4g4LiZ4Liz4LiE4LmI4Liy4LiX4Li14LmI4Lit4LmI4Liy4LiZ4LmE4LiU4LmJ4Lih4Liy4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LmD4Lir4LmJ4LiB4Lix4LiaIERyb3Bkb3duCiAgICAgICAgICAgIGlmIChwcmVmcy5wcm9qZWN0U29ydE9yZGVyKSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1zb3J0LXNlbGVjdCcpLnZhbHVlID0gcHJlZnMucHJvamVjdFNvcnRPcmRlcjsKICAgICAgICAgICAgfQoJCQkKCQkJZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFZpZXcgPSBwcmVmcy5wcm9qZWN0VmlldyB8fCAnZ3JpZCc7CgogICAgICAgICAgICAvLyAzLiDguYDguKPguLTguYjguKHguJTguLbguIfguILguYnguK3guKHguLnguKXguYLguJvguKPguYDguIjguIQgKOC4i+C4tuC5iOC4h+C4iOC4sOC5g+C4iuC5ieC4hOC5iOC4siBEcm9wZG93biDguJfguLXguYjguYDguJ7guLTguYjguIfguJXguLHguYnguIfguYTguJspCiAgICAgICAgICAgIGlmICh1bnN1YnNjcmliZVByb2plY3RzTGlzdGVuZXIpIHVuc3Vic2NyaWJlUHJvamVjdHNMaXN0ZW5lcigpOwogICAgICAgICAgICBsaXN0ZW5Gb3JQcm9qZWN0cygpOwogICAgICAgICAgICBsaXN0ZW5Gb3JTdGFycmVkUXVpenplcygpOwogICAgICAgICAgICBsaXN0ZW5Gb3JDdXN0b21NYXRoVG9waWNzKCk7CgkJCWxpc3RlbkZvckJsdWVwcmludFNob3J0Y3V0cygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGF3YWl0IGF1dGhlbnRpY2F0ZVVzZXIoKTsKICAgICAgICB9CiAgICB9KTsKfQoKLyoqCiAqIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4guC4reC4h+C4nOC4ueC5ieC5g+C4iuC5ieC4peC4h+C5g+C4mSBGaXJlc3RvcmUKICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIOC4iuC4t+C5iOC4reC4guC4reC4h+C4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4siDguYDguIrguYjguJkgJ3Byb2plY3RTb3J0T3JkZXInCiAqIEBwYXJhbSB7YW55fSB2YWx1ZSAtIOC4hOC5iOC4suC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4muC4seC4meC4l+C4tuC4gQogKi8KYXN5bmMgZnVuY3Rpb24gc2F2ZVVzZXJQcmVmZXJlbmNlKGtleSwgdmFsdWUpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8qKgogKiDguK3guYjguLLguJnguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguILguK3guIfguJzguLnguYnguYPguIrguYnguIjguLLguIEgRmlyZXN0b3JlCiAqIEByZXR1cm5zIHtQcm9taXNlPG9iamVjdD59IC0gUHJvbWlzZSDguJfguLXguYjguIjguLDguITguLfguJnguITguYjguLLguYDguJvguYfguJkgb2JqZWN0IOC4guC4reC4h+C4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4l+C4seC5ieC4h+C4q+C4oeC4lAogKi8KYXN5bmMgZnVuY3Rpb24gbG9hZFVzZXJQcmVmZXJlbmNlcygpIHsKICAgIGlmICghdXNlcklkKSByZXR1cm4ge307CiAgICB0cnkgewogICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vdXNlcnMvJHt1c2VySWR9L3ByZWZlcmVuY2VzL21haW5gKTsKICAgICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByZWZSZWYpOwogICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHJldHVybiBkb2NTbmFwLmRhdGEoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHt9OyAvLyDguITguLfguJnguITguYjguLIgb2JqZWN0IOC4p+C5iOC4suC4h+C4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC5gOC4hOC4ouC4oeC4teC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4sgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsb2FkaW5nIHVzZXIgcHJlZmVyZW5jZXM6IiwgZXJyb3IpOwogICAgICAgIHJldHVybiB7fTsKICAgIH0KfQoKLy8g4pa84pa84pa8IEFERCBUSEVTRSBORVcgRlVOQ1RJT05TIFRPIFlPVVIgU0NSSVBUIOKWvOKWvOKWvAoKLyoqCiAqIFBhcnNlcyBpbmRlbnRlZCB0ZXh0IGludG8gdGhlIGJsdWVwcmludCBKU09OIHN0cnVjdHVyZS4KICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBUaGUgaW5kZW50ZWQgdGV4dCBmcm9tIHRoZSB0ZXh0YXJlYS4KICogQHJldHVybnMge29iamVjdH0gLSBUaGUgc3RydWN0dXJlZCBjdXJyaWN1bHVtIGRhdGEuCiAqLwpmdW5jdGlvbiBwYXJzZUluZGVudGVkQmx1ZXByaW50KHRleHQpIHsKICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgnXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSAhPT0gJycpOwogICAgY29uc3QgY3VycmljdWx1bSA9IFtdOwogICAgbGV0IGN1cnJlbnRTYXJhID0gbnVsbDsKICAgIGxldCBjdXJyZW50TWFpblRvcGljID0gbnVsbDsKCiAgICBsaW5lcy5mb3JFYWNoKGxpbmUgPT4gewogICAgICAgIGNvbnN0IGluZGVudGF0aW9uID0gbGluZS5tYXRjaCgvXlxzKi8pWzBdLmxlbmd0aDsKICAgICAgICBjb25zdCBjb250ZW50ID0gbGluZS50cmltKCk7CgogICAgICAgIGlmIChpbmRlbnRhdGlvbiA9PT0gMCkgeyAvLyBUaGlzIGlzIGEgU2FyYQogICAgICAgICAgICBjdXJyZW50U2FyYSA9IHsKICAgICAgICAgICAgICAgIHNhcmE6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICBtYWluVG9waWNzOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICBjdXJyaWN1bHVtLnB1c2goY3VycmVudFNhcmEpOwogICAgICAgICAgICBjdXJyZW50TWFpblRvcGljID0gbnVsbDsgLy8gUmVzZXQgbWFpbiB0b3BpYwogICAgICAgIH0gZWxzZSBpZiAoaW5kZW50YXRpb24gPiAwICYmIGluZGVudGF0aW9uIDwgOCAmJiBjdXJyZW50U2FyYSkgeyAvLyBUaGlzIGlzIGEgTWFpbiBUb3BpYyAoZS5nLiwgNCBzcGFjZXMpCiAgICAgICAgICAgIGN1cnJlbnRNYWluVG9waWMgPSB7CiAgICAgICAgICAgICAgICB0b3BpY05hbWU6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICBzdWJUb3BpY3M6IFtdCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGN1cnJlbnRTYXJhLm1haW5Ub3BpY3MucHVzaChjdXJyZW50TWFpblRvcGljKTsKICAgICAgICB9IGVsc2UgaWYgKGluZGVudGF0aW9uID49IDggJiYgY3VycmVudE1haW5Ub3BpYykgeyAvLyBUaGlzIGlzIGEgU3ViIFRvcGljIChlLmcuLCA4IHNwYWNlcykKICAgICAgICAgICAgY3VycmVudE1haW5Ub3BpYy5zdWJUb3BpY3MucHVzaChjb250ZW50KTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4geyBjdXJyaWN1bHVtIH07Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlTWFudWFsQmx1ZXByaW50U2F2ZSDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1hbnVhbEJsdWVwcmludFNhdmUoKSB7CiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtcHJvamVjdC1uYW1lJykudmFsdWUudHJpbSgpOwogICAgY29uc3QgZ3JhZGVMZXZlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtZ3JhZGUtbGV2ZWwnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1icC1jb250ZW50JykudmFsdWU7CgogICAgaWYgKCFwcm9qZWN0TmFtZSB8fCAhZ3JhZGVMZXZlbCB8fCAhY29udGVudCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguIHguKPguK3guIHguILguYnguK3guKHguLnguKXguYPguKvguYnguITguKPguJrguJfguLjguIHguIrguYjguK3guIciKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcGFyc2VkRGF0YSA9IHBhcnNlSW5kZW50ZWRCbHVlcHJpbnQoY29udGVudCk7CgogICAgaWYgKCFwYXJzZWREYXRhLmN1cnJpY3VsdW0gfHwgcGFyc2VkRGF0YS5jdXJyaWN1bHVtLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguKfguLTguYDguITguKPguLLguLDguKvguYzguYLguITguKPguIfguKrguKPguYnguLLguIfguIjguLLguIHguILguYnguK3guITguKfguLLguKHguJfguLXguYjguJvguYnguK3guJnguYTguJTguYkiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdG9waWNzTWFwID0ge307CiAgICBsZXQgb3JkZXJJbmRleCA9IDA7IC8vIDw8PCBb4LmA4Lie4Li04LmI4LihXSDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguJnguLHguJrguKXguLPguJTguLHguJoKCiAgICAvLyDguKfguJnguKXguLnguJvguYDguJ7guLfguYjguK3guKrguKPguYnguLLguIfguILguYnguK3guKHguLnguKXguJ7guKPguYnguK3guKHguYDguJ7guLTguYjguKEgb3JkZXIKICAgIHBhcnNlZERhdGEuY3VycmljdWx1bS5mb3JFYWNoKHNhcmEgPT4gewogICAgICAgIHNhcmEubWFpblRvcGljcy5mb3JFYWNoKG1haW5Ub3BpYyA9PiB7CiAgICAgICAgICAgIG1haW5Ub3BpYy5zdWJUb3BpY3MuZm9yRWFjaChzdWJUb3BpYyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gJ3RvcGljXycgKyBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpOwogICAgICAgICAgICAgICAgdG9waWNzTWFwW3RvcGljSWRdID0gewogICAgICAgICAgICAgICAgICAgIHNhcmE6IHNhcmEuc2FyYSwKICAgICAgICAgICAgICAgICAgICBtYWluVG9waWM6IG1haW5Ub3BpYy50b3BpY05hbWUsCiAgICAgICAgICAgICAgICAgICAgc3ViVG9waWM6IHN1YlRvcGljLAogICAgICAgICAgICAgICAgICAgIHN0YXR1czogIm5vdF9nZW5lcmF0ZWQiLAogICAgICAgICAgICAgICAgICAgIGxlc3NvbkNvbnRlbnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgb3JkZXI6IG9yZGVySW5kZXgrKyAvLyA8PDwgW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4Lil4Liz4LiU4Lix4Lia4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZ4LiC4LmJ4Lit4Lih4Li54LilCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvamVjdHNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCk7CiAgICAgICAgYXdhaXQgYWRkRG9jKHByb2plY3RzUmVmLCB7CiAgICAgICAgICAgIHByb2plY3ROYW1lOiBwcm9qZWN0TmFtZSwKICAgICAgICAgICAgZ3JhZGVMZXZlbDogZ3JhZGVMZXZlbCwKICAgICAgICAgICAgdG9waWNzOiB0b3BpY3NNYXAsIC8vIOC4muC4seC4meC4l+C4tuC4geC4guC5ieC4reC4oeC4ueC4peC4l+C4teC5iOC4oeC4tSBvcmRlciDguYHguKXguYnguKcKICAgICAgICAgICAgY3JlYXRlZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKQogICAgICAgIH0pOwogICAgICAgIHNob3dNZXNzYWdlKGDguJrguLHguJnguJfguLbguIHguYLguJvguKPguYDguIjguIQgIiR7cHJvamVjdE5hbWV9IiDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1ibHVlcHJpbnQtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIG1hbnVhbCBibHVlcHJpbnQgcHJvamVjdDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC5guC4m+C4o+C5gOC4iOC4hCIpOwogICAgfQp9CgpmdW5jdGlvbiBoYW5kbGVDbGVhckFsbExpbmtzRm9yVG9waWModG9waWNJZCkgewogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAi4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4LmJ4Liy4LiH4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4LiE4Lil4Lix4LiH4LiZ4Li14LmJPyAo4LiV4Lix4Lin4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiI4Lij4Li04LiH4LiI4Liw4LmE4Lih4LmI4LiW4Li54LiB4Lil4LiaKSIsCiAgICAgICAgYXN5bmMgKCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0c2AsIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgLy8g4Liq4Lix4LmI4LiH4Lit4Lix4Lib4LmA4LiU4LiVIGZpZWxkIGxpbmtlZFF1aXpJZHMg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZIEFycmF5IOC4p+C5iOC4suC4hwogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsKICAgICAgICAgICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9LmxpbmtlZFF1aXpJZHNgXTogW10gCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKXguYnguLLguIfguIHguLLguKPguYDguIrguLfguYjguK3guKHguYLguKLguIfguJfguLHguYnguIfguKvguKHguJTguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpOyAvLyDguKPguLXguYDguJ/guKPguIrguKvguJnguYnguLLguJXguYjguLLguIfguITguKXguLHguIcKICAgICAgICAgICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiK4Lib4LmJ4Liy4Lii4Liq4LiW4Liy4LiZ4Liw4LiX4Li14LmI4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiBCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjbGVhcmluZyBhbGwgbGlua3M6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4peC5ieC4suC4h+C4geC4suC4o+C5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4hyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgKTsKfQoKZnVuY3Rpb24gc2hvd1BvZGl1bVZpZXcocGxheWVycywgZ2FtZU1vZGUgPSAnbGl2ZS1yYWNlJywgZ2FtZURhdGEgPSBudWxsKSB7CiAgICAKICAgIGNvbnN0IGlzTWFya2V0TW9kZSA9IGdhbWVEYXRhPy5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyAxLiDguYHguJvguKXguIfguILguYnguK3guKHguLnguKUgKOC5gOC4nuC4tOC5iOC4oSBjb3JyZWN0U3RyZWFrIOC5gOC4guC5ieC4suC4oeC4suC4lOC5ieC4p+C4oikKICAgIGNvbnN0IHBsYXllcnNBcnJheSA9IE9iamVjdC5lbnRyaWVzKHBsYXllcnMpLm1hcCgoW25hbWUsIGRhdGFdKSA9PiAoewogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgcmVhbFNjb3JlOiBkYXRhLnJlYWxTY29yZSB8fCBkYXRhLnNjb3JlIHx8IDAsIAogICAgICAgIHRvdGFsUG9pbnRzOiBkYXRhLnRvdGFsUG9pbnRzIHx8IDAsCiAgICAgICAgYmFkZ2VzOiBkYXRhLmJhZGdlcyB8fCBbXSwKICAgICAgICBoYXNQZXJmZWN0U2NvcmVCb251czogZGF0YS5oYXNQZXJmZWN0U2NvcmVCb251cyB8fCBmYWxzZSwKICAgICAgICBjb3JyZWN0U3RyZWFrOiBkYXRhLmNvcnJlY3RTdHJlYWsgfHwgMCAvLyBb4LmA4Lie4Li04LmI4LihXSDguJTguLbguIfguITguYjguLIgU3RyZWFrCiAgICB9KSk7CgogICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4LiE4LmI4Liy4Liq4Li54LiH4Liq4Li44LiUCiAgICBjb25zdCBtYXhQb2ludHMgPSBNYXRoLm1heCguLi5wbGF5ZXJzQXJyYXkubWFwKHAgPT4gcC50b3RhbFBvaW50cyksIC1JbmZpbml0eSk7CiAgICBjb25zdCBtYXhSYXdTY29yZSA9IE1hdGgubWF4KC4uLnBsYXllcnNBcnJheS5tYXAocCA9PiBwLnJlYWxTY29yZSksIC1JbmZpbml0eSk7CgogICAgLy8gMy4g4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiHIChTb3J0KQogICAgcGxheWVyc0FycmF5LnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0RpZmYgPSBiLnRvdGFsUG9pbnRzIC0gYS50b3RhbFBvaW50czsKICAgICAgICAgICAgaWYgKHBvaW50c0RpZmYgIT09IDApIHJldHVybiBwb2ludHNEaWZmOwogICAgICAgICAgICBjb25zdCBzY29yZURpZmYgPSBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgICAgICBpZiAoc2NvcmVEaWZmICE9PSAwKSByZXR1cm4gc2NvcmVEaWZmOwogICAgICAgICAgICByZXR1cm4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lLCAndGgnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSwgJ3RoJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gNC4g4LiE4Liz4LiZ4Lin4LiT4Lit4Lix4LiZ4LiU4Lix4Lia4LmB4Lia4LiaIDEsIDEsIDEsIDQKICAgIGxldCBjdXJyZW50UmFuayA9IDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBsYXllcnNBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICBjb25zdCBwcmV2ID0gcGxheWVyc0FycmF5W2kgLSAxXTsKICAgICAgICAgICAgY29uc3QgY3VyciA9IHBsYXllcnNBcnJheVtpXTsKICAgICAgICAgICAgY29uc3QgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICBpZiAoIWlzVGllZCkgewogICAgICAgICAgICAgICAgY3VycmVudFJhbmsgPSBpICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwbGF5ZXJzQXJyYXlbaV0uZGlzcGxheVJhbmsgPSBjdXJyZW50UmFuazsKICAgIH0KCiAgICBjb25zdCByZW5kZXJCYWRnZXMgPSAoYmFkZ2VzKSA9PiB7CiAgICAgICAgaWYgKCFiYWRnZXMgfHwgYmFkZ2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuICcnOwogICAgICAgIGNvbnN0IGJhZGdlSWNvbnMgPSB7IHF1aWNrX3RoaW5rZXI6ICfimqHvuI8nLCBvbl9maXJlOiAn8J+UpScgfTsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1jZW50ZXIgZ2FwLTIgbXktMSB0ZXh0LTJ4bCI+JHtiYWRnZXMubWFwKGIgPT4gYmFkZ2VJY29uc1tiXSB8fCAnJykuam9pbignJyl9PC9kaXY+YDsKICAgIH07CiAgICAKICAgIC8vIEhlbHBlcjog4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4Liq4Liz4Lir4Lij4Lix4Lia4LmB4Liq4LiU4LiH4LiE4Liw4LmB4LiZ4LiZICsg4LmE4Lit4LiE4Lit4LiZICsg4LmE4LifICjguKrguLPguKvguKPguLHguJrguYHguJfguYjguJkgMS0yLTMpCiAgICBjb25zdCByZW5kZXJTY29yZUhUTUwgPSAocGxheWVyKSA9PiB7CiAgICAgICAgbGV0IGJvbnVzSWNvbiA9ICcnOwogICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgaWYgKHBsYXllci50b3RhbFBvaW50cyA9PT0gbWF4UG9pbnRzICYmIG1heFBvaW50cyA+IDApIGJvbnVzSWNvbiArPSAnPHNwYW4gdGl0bGU9IuC5gOC4iOC5ieC4suC4nuC5iOC4reC4leC4peC4suC4lOC4oeC4t+C4lCI+8J+RkTwvc3Bhbj4gJzsKICAgICAgICAgICAgaWYgKHBsYXllci5yZWFsU2NvcmUgPT09IG1heFJhd1Njb3JlICYmIG1heFJhd1Njb3JlID4gMCkgYm9udXNJY29uICs9ICc8c3BhbiB0aXRsZT0i4LmA4LiX4Lie4Lin4Li04LiK4Liy4LiB4Liy4LijIj7wn46TPC9zcGFuPiAnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChwbGF5ZXIuaGFzUGVyZmVjdFNjb3JlQm9udXMpIGJvbnVzSWNvbiA9ICc8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctMzAwIG1sLTEiPisxIOKcqDwvc3Bhbj4nOwogICAgICAgIH0KCiAgICAgICAgLy8gW+C5gOC4nuC4tOC5iOC4oV0g4LmB4Liq4LiU4LiH4LmE4LifIPCflKUg4LiW4LmJ4LiyIFN0cmVhayA+PSAzCiAgICAgICAgbGV0IGZpcmVIdG1sID0gJyc7CiAgICAgICAgaWYgKHBsYXllci5jb3JyZWN0U3RyZWFrID49IDMpIHsKICAgICAgICAgICAgZmlyZUh0bWwgPSBgIDxzcGFuIGNsYXNzPSJ0ZXh0LW9yYW5nZS00MDAgZm9udC1ib2xkIGFuaW1hdGUtcHVsc2UgbWwtMSB0ZXh0LWxnIGRyb3Atc2hhZG93LXNtIj7wn5SlIHgke3BsYXllci5jb3JyZWN0U3RyZWFrfTwvc3Bhbj5gOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaXNwbGF5ID0gcGxheWVyLnRvdGFsUG9pbnRzID49IDAgCiAgICAgICAgICAgICAgICA/IGAoKyR7cGxheWVyLnRvdGFsUG9pbnRzLnRvTG9jYWxlU3RyaW5nKCl9KWAgCiAgICAgICAgICAgICAgICA6IGAoJHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0pYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteGwiPiR7cGxheWVyLnJlYWxTY29yZX0g4LiE4Liw4LmB4LiZ4LiZICR7cG9pbnRzRGlzcGxheX08L3A+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMSI+JHtib251c0ljb259JHtmaXJlSHRtbH08L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14bCI+JHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0g4LiE4Liw4LmB4LiZ4LiZPC9wPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTEiPiR7Ym9udXNJY29ufSR7ZmlyZUh0bWx9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0KICAgIH07CgogICAgLy8gSGVscGVyOiDguKrguKPguYnguLLguIcgSFRNTCDguKrguLPguKvguKPguLHguJrguYTguJ/guYPguJnguKPguLLguKLguIHguLLguKMgIuC4reC4seC4meC4lOC4seC4muC4reC4t+C5iOC4meC5hiIKICAgIGNvbnN0IHJlbmRlckZpcmVGb3JMaXN0ID0gKHN0cmVhaykgPT4gewogICAgICAgICBpZiAoc3RyZWFrID49IDMpIHJldHVybiBgPHNwYW4gY2xhc3M9InRleHQtb3JhbmdlLTQwMCBmb250LWJvbGQgbWwtMiB0ZXh0LXNtIGFuaW1hdGUtcHVsc2UiPvCflKUgeCR7c3RyZWFrfTwvc3Bhbj5gOwogICAgICAgICByZXR1cm4gJyc7CiAgICB9OwoKICAgIGNvbnN0IG90aGVyUGxheWVycyA9IHBsYXllcnNBcnJheS5zbGljZSgzKTsKICAgIGNvbnN0IG90aGVyUGxheWVyc0h0bWwgPSBvdGhlclBsYXllcnMubGVuZ3RoID4gMCA/IGAKICAgICAgICA8ZGl2IGNsYXNzPSJtdC04IHctZnVsbCBtYXgtdy1sZyBiZy1ibGFjay8yMCBwLTQgcm91bmRlZC1sZyB0ZXh0LWxlZnQiPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTMgdGV4dC1jZW50ZXIiPuC4reC4seC4meC4lOC4seC4muC4reC4t+C5iOC4meC5hjwvaDM+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktMiB0ZXh0LWxnIj4KICAgICAgICAgICAgICAgICR7b3RoZXJQbGF5ZXJzLm1hcCgocGxheWVyLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIOC5gOC4leC4o+C4teC4ouC4oeC5hOC4reC4hOC4reC4meC4o+C4suC4h+C4p+C4seC4pQogICAgICAgICAgICAgICAgICAgIGxldCBib251c0ljb24gPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIudG90YWxQb2ludHMgPT09IG1heFBvaW50cyAmJiBtYXhQb2ludHMgPiAwKSBib251c0ljb24gKz0gJ/CfkZEgJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5yZWFsU2NvcmUgPT09IG1heFJhd1Njb3JlICYmIG1heFJhd1Njb3JlID4gMCkgYm9udXNJY29uICs9ICfwn46TICc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyDguYDguJXguKPguLXguKLguKHguILguYnguK3guITguKfguLLguKHguITguLDguYHguJnguJkKICAgICAgICAgICAgICAgICAgICBsZXQgc2NvcmVUZXh0ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzY29yZVRleHQgPSBgJHtwbGF5ZXIucmVhbFNjb3JlfSDguITguLDguYHguJnguJkgKCR7cGxheWVyLnRvdGFsUG9pbnRzLnRvTG9jYWxlU3RyaW5nKCl9KWA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmVUZXh0ID0gYCR7cGxheWVyLnRvdGFsUG9pbnRzLnRvTG9jYWxlU3RyaW5nKCl9IOC4hOC4sOC5geC4meC4mWA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBiZy1ibGFjay8xMCBob3ZlcjpiZy1ibGFjay8zMCBwLTIgcm91bmRlZC1tZCB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS0zMDAgdy04IGlubGluZS1ibG9jayI+JHtwbGF5ZXIuZGlzcGxheVJhbmt9Ljwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlci1jaXJjbGUgbXItMiB0ZXh0LWdyYXktMzAwIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3BsYXllci5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVuZGVyRmlyZUZvckxpc3QocGxheWVyLmNvcnJlY3RTdHJlYWspfSA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXdoaXRlIHRleHQtYmFzZSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3Njb3JlVGV4dH0gJHtib251c0ljb259CiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGB9KS5qb2luKCcnKX0KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+YCA6ICcnOwoKICAgIGNvbnN0IHBvZGl1bUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgbWItOCI+4Liq4Lij4Li44Lib4Lic4Lil4LiB4Liy4Lij4LmB4LiC4LmI4LiH4LiC4Lix4LiZISA8aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSB0ZXh0LXllbGxvdy0zMDAiPjwvaT48L2gyPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWVuZCBqdXN0aWZ5LWNlbnRlciBnYXAtNCB3LWZ1bGwgbWF4LXctMnhsIj4KICAgICAgICAgICAgICAgICR7cGxheWVyc0FycmF5WzFdID8gYDxkaXYgY2xhc3M9InBvZGl1bS1zdGVwIHRleHQtY2VudGVyIGZsZXgtMSB0cmFuc2Zvcm0gdHJhbnNpdGlvbiBob3ZlcjpzY2FsZS0xMDUiPjxpIGNsYXNzPSJmYXMgZmEtdXNlci1jaXJjbGUgdGV4dC02eGwgbWItMiB0ZXh0LWdyYXktMzAwIj48L2k+PHAgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LTJ4bCB0cnVuY2F0ZSI+JHtwbGF5ZXJzQXJyYXlbMV0ubmFtZX08L3A+JHtyZW5kZXJTY29yZUhUTUwocGxheWVyc0FycmF5WzFdKX08ZGl2IGNsYXNzPSJiZy1ncmF5LTQwMCB0ZXh0LWdyYXktOTAwIGZvbnQtYm9sZCBwLTQgcm91bmRlZC10LWxnIG10LTIgaC0zMiBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LTV4bCBzaGFkb3ctbGcgYm9yZGVyLXQtNCBib3JkZXItZ3JheS0zMDAiPiR7cGxheWVyc0FycmF5WzFdLmRpc3BsYXlSYW5rfTwvZGl2PjwvZGl2PmAgOiAnPGRpdiBjbGFzcz0iZmxleC0xIj48L2Rpdj4nfQogICAgICAgICAgICAgICAgJHtwbGF5ZXJzQXJyYXlbMF0gPyBgPGRpdiBjbGFzcz0icG9kaXVtLXN0ZXAgdGV4dC1jZW50ZXIgZmxleC0xIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSB6LTEwIj48aSBjbGFzcz0iZmFzIGZhLWNyb3duIHRleHQtNnhsIG1iLTIgdGV4dC15ZWxsb3ctNDAwIGFuaW1hdGUtYm91bmNlIj48L2k+PHAgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LTN4bCB0cnVuY2F0ZSI+JHtwbGF5ZXJzQXJyYXlbMF0ubmFtZX08L3A+JHtyZW5kZXJTY29yZUhUTUwocGxheWVyc0FycmF5WzBdKX08ZGl2IGNsYXNzPSJiZy15ZWxsb3ctNTAwIHRleHQteWVsbG93LTkwMCBmb250LWJvbGQgcC00IHJvdW5kZWQtdC1sZyBtdC0yIGgtNDggZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC02eGwgc2hhZG93LXhsIGJvcmRlci10LTQgYm9yZGVyLXllbGxvdy0zMDAiPiR7cGxheWVyc0FycmF5WzBdLmRpc3BsYXlSYW5rfTwvZGl2PjwvZGl2PmAgOiAnPGRpdiBjbGFzcz0iZmxleC0xIj48L2Rpdj4nfQogICAgICAgICAgICAgICAgJHtwbGF5ZXJzQXJyYXlbMl0gPyBgPGRpdiBjbGFzcz0icG9kaXVtLXN0ZXAgdGV4dC1jZW50ZXIgZmxleC0xIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLWNpcmNsZSB0ZXh0LTZ4bCBtYi0yIHRleHQtYW1iZXItNzAwIj48L2k+PHAgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LTJ4bCB0cnVuY2F0ZSI+JHtwbGF5ZXJzQXJyYXlbMl0ubmFtZX08L3A+JHtyZW5kZXJTY29yZUhUTUwocGxheWVyc0FycmF5WzJdKX08ZGl2IGNsYXNzPSJiZy1hbWJlci03MDAgdGV4dC1hbWJlci0xMDAgZm9udC1ib2xkIHAtNCByb3VuZGVkLXQtbGcgbXQtMiBoLTI0IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtNHhsIHNoYWRvdy1sZyBib3JkZXItdC00IGJvcmRlci1hbWJlci02MDAiPiR7cGxheWVyc0FycmF5WzJdLmRpc3BsYXlSYW5rfTwvZGl2PjwvZGl2PmAgOiAnPGRpdiBjbGFzcz0iZmxleC0xIj48L2Rpdj4nfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgJHtvdGhlclBsYXllcnNIdG1sfSAKICAgICAgICAgICAgJHtjdXJyZW50TW9kZSA9PT0gJ2FkbWluJyA/IGA8YnV0dG9uIGlkPSJjbG9zZS1nYW1lLWZpbmFsLWJ0biIgY2xhc3M9Im10LTggYmctcmVkLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLXJlZC03MDAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTIiPjwvaT7guIjguJrguYDguIHguKHguYHguKXguLDguIHguKXguLHguJrguKvguJnguYnguLLguKvguKXguLHguIE8L2J1dHRvbj5gIDogYDxidXR0b24gaWQ9InN0dWRlbnQtYmFjay10by1ob21lLWJ0biIgY2xhc3M9Im10LTggYmctcmVkLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLXJlZC03MDAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTIiPjwvaT7guIjguJrguYDguIHguKHguYHguKXguLDguIHguKXguLHguJrguKvguJnguYnguLLguKvguKXguLHguIE8L2J1dHRvbj5gfQogICAgICAgIDwvZGl2PmA7CiAgICAKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBwb2RpdW1IVE1MOwoKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1nYW1lLWZpbmFsLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBsZXQgZ2FtZVJlZjsKICAgICAgICAgICAgaWYgKGdhbWVNb2RlID09PSAnc3luYycpIHsKICAgICAgICAgICAgICAgIGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9saXZlR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXdhaXQgZGVsZXRlRG9jKGdhbWVSZWYpOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1iYWNrLXRvLWhvbWUtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOyAKICAgICAgICB9KTsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyU3luY1N1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbiwgaXNBZG1pbikgewogICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIGNvbnN0IGlzQW5vbnltb3VzID0gKCh2YXJpYW50ID09PSAnYW5vbnltb3VzJyB8fCB2YXJpYW50ID09PSAnYW5vbnltb3VzX3JldmVhbF9lbmQnKSAmJiBnYW1lRGF0YS5pc0Fub255bW91c1JldmVhbGVkID09PSBmYWxzZSk7CiAgICBjb25zdCBpc1JldmVhbEF0RW5kTW9kZSA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CgogICAgY29uc3QgcXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uczsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAKICAgIC8vIOKWvOKWvOKWvCBb4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCXSDguYDguJ7guLTguYjguKEgbWF0Y2hpbmdfaXRlbSDguYDguILguYnguLLguYTguJvguYPguJnguYDguIfguLfguYjguK3guJnguYTguILguJnguLXguYkg4pa84pa84pa8CiAgICAvLyDguYDguJ7guLfguYjguK3guYPguKvguYnguKPguLDguJrguJrguYPguIrguYkgTG9naWMg4LmB4Liq4LiU4LiH4Lic4Lil4LmB4Lia4LiaIOC4luC4ueC4gS/guJzguLTguJQgKOC5gOC4guC4teC4ouC4py/guYHguJTguIcpIOC5geC4l+C4meC4geC4o+C4suC4n+C5geC4l+C5iOC4hwogICAgY29uc3QgaXNTaG9ydEFuc3dlclR5cGUgPSAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nKTsKICAgIC8vIOKWsuKWsuKWsgoKICAgIC8vIC0tLSBMb2dpYyDguIHguKPguLLguJ/guYHguKrguJTguIfguJzguKUgLS0tCiAgICBsZXQgY2hhcnRIVE1MID0gJyc7CiAgICAKICAgIGlmIChpc1Nob3J0QW5zd2VyVHlwZSkgewogICAgICAgIC8vID09PSDguIHguKPguJPguLXguYDguJvguYfguJnguITguLPguJbguLLguKHguYHguJrguJrguJ7guLTguKHguJ7guYzguJXguK3guJog4Lir4Lij4Li34LitIOC4iOC4seC4muC4hOC4ueC5iCAo4LmB4Liq4LiU4LiH4LiB4Lij4Liy4LifIOC4luC4ueC4gSB2cyDguJzguLTguJQpID09PQogICAgICAgIGxldCBjb3JyZWN0Q291bnQgPSAwOwogICAgICAgIGxldCBpbmNvcnJlY3RDb3VudCA9IDA7CiAgICAgICAgY29uc3QgY29ycmVjdE5hbWVzID0gW107CiAgICAgICAgY29uc3QgaW5jb3JyZWN0RGV0YWlscyA9IFtdOwoKICAgICAgICBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5mb3JFYWNoKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICAgICAgLy8g4LiE4LmJ4LiZ4Lir4Liy4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiC4LmJ4Lit4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBbnN3ZXJPYmogPSAoZGF0YS5hbnN3ZXJzIHx8IFtdKS5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgIT09ICdpbmFjdGl2ZScgJiYgY3VycmVudEFuc3dlck9iaikgewogICAgICAgICAgICAgICAgLy8g4Liq4Liz4Lir4Lij4Lix4LiaIG1hdGNoaW5nX2l0ZW0gYW5zd2VyVGV4dCDguIjguLDguYDguJvguYfguJnguITguYjguLLguJfguLXguYjguYDguKXguLfguK3guIHguKrguYjguIfguKHguLIKICAgICAgICAgICAgICAgIGNvbnN0IGFucyA9IGN1cnJlbnRBbnN3ZXJPYmouYW5zd2VyVGV4dDsgCiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IGlzQW5vbnltb3VzID8gKGdhbWVEYXRhLnBsYXllck5pY2tuYW1lc1tuYW1lXSB8fCAnPz8/JykgOiBuYW1lOwoKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyT2JqLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgIGNvcnJlY3RDb3VudCsrOwogICAgICAgICAgICAgICAgICAgIGNvcnJlY3ROYW1lcy5wdXNoKGRpc3BsYXlOYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5jb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAvLyDguYDguIHguYfguJrguKPguLLguKLguKXguLDguYDguK3guLXguKLguJTguITguLPguJXguK3guJrguJfguLXguYjguJzguLTguJTguYTguKfguYnguYHguKrguJTguIfguYPguJkgVG9vbHRpcAogICAgICAgICAgICAgICAgICAgIGluY29ycmVjdERldGFpbHMucHVzaChgPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTIwMCBmb250LWJvbGQiPiR7ZGlzcGxheU5hbWV9PC9zcGFuPjogJHthbnMgfHwgJyjguYTguKHguYjguJXguK3guJopJ31gKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjaGFydEhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy0yeGwgZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1lbmQgZ2FwLTggbXktOCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMyBmbGV4IGZsZXgtY29sIGp1c3RpZnktZW5kIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTEiPiR7Y29ycmVjdENvdW50fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWJhci1pdGVtIHctZnVsbCByb3VuZGVkLWxnIHRleHQtd2hpdGUgcC00IGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHJlbGF0aXZlIHNoYWRvdy1sZyBib3JkZXItMiBib3JkZXItZ3JlZW4tNDAwIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSIgc3R5bGU9Im1pbi1oZWlnaHQ6IDEyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjMjJjNTVlOyIgZGF0YS10b29sdGlwLXRhcmdldD0idG9vbHRpcC1oaWRkZW4tY29ycmVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtNHhsIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHBvaW50ZXItZXZlbnRzLW5vbmUiPuC4leC4reC4muC4luC4ueC4gTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idG9vbHRpcC1oaWRkZW4tY29ycmVjdCIgY2xhc3M9ImxpdmUtc3VtbWFyeS10b29sdGlwIGFic29sdXRlIGJvdHRvbS1mdWxsIG1iLTIgdy1tYXggbWF4LXcteHMgYmctZ3JheS04MDAgdGV4dC13aGl0ZSB0ZXh0LXNtIHJvdW5kZWQtbGcgc2hhZG93LXhsIHAtMyB6LTIwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmcgY2xhc3M9ImJsb2NrIG1iLTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktNjAwIHBiLTEgdGV4dC1ncmVlbi00MDAiPuC4o+C4suC4ouC4iuC4t+C5iOC4reC4hOC4meC5gOC4geC5iOC4hzo8L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1heC1oLTQwIG92ZXJmbG93LXktYXV0byI+JHtjb3JyZWN0TmFtZXMubGVuZ3RoID4gMCA/IGNvcnJlY3ROYW1lcy5qb2luKCcsICcpIDogJy0nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzMgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWVuZCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0xIj4ke2luY29ycmVjdENvdW50fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWJhci1pdGVtIHctZnVsbCByb3VuZGVkLWxnIHRleHQtd2hpdGUgcC00IGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHJlbGF0aXZlIHNoYWRvdy1sZyBib3JkZXItMiBib3JkZXItcmVkLTQwMCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUiIHN0eWxlPSJtaW4taGVpZ2h0OiAxMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2VmNDQ0NDsiIGRhdGEtdG9vbHRpcC10YXJnZXQ9InRvb2x0aXAtaGlkZGVuLWluY29ycmVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtNHhsIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHBvaW50ZXItZXZlbnRzLW5vbmUiPuC4leC4reC4muC4nOC4tOC4lDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idG9vbHRpcC1oaWRkZW4taW5jb3JyZWN0IiBjbGFzcz0ibGl2ZS1zdW1tYXJ5LXRvb2x0aXAgYWJzb2x1dGUgYm90dG9tLWZ1bGwgbWItMiB3LW1heCBtYXgtdy14cyBiZy1ncmF5LTgwMCB0ZXh0LXdoaXRlIHRleHQtc20gcm91bmRlZC1sZyBzaGFkb3cteGwgcC0zIHotMjAgdGV4dC1sZWZ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmcgY2xhc3M9ImJsb2NrIG1iLTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktNjAwIHBiLTEgdGV4dC1yZWQtNDAwIj7guKPguLLguKLguKXguLDguYDguK3guLXguKLguJTguITguJnguJXguK3guJrguJzguLTguJQ6PC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXgtaC00OCBvdmVyZmxvdy15LWF1dG8gc3BhY2UteS0xIj4ke2luY29ycmVjdERldGFpbHMubGVuZ3RoID4gMCA/IGluY29ycmVjdERldGFpbHMuam9pbignPGJyPicpIDogJy0nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gPT09IOC4geC4o+C4k+C4teC5gOC4m+C5h+C4meC4hOC4s+C4luC4suC4oeC5geC4muC4muC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4gSAo4LmB4Liq4LiU4LiH4LiB4Lij4Liy4Lif4LmB4LiX4LmI4LiH4LiV4Liy4Lih4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBKSA9PT0KICAgICAgICBsZXQgb3B0aW9ucyA9IFtdOwogICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgICAgICBvcHRpb25zID0gWyfguYPguIrguYggLyDguJbguLnguIEnLCAn4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUJ107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3B0aW9ucyA9IHF1ZXN0aW9uLm9wdGlvbnMgfHwgW107CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IGFuc3dlckNvdW50cyA9IG5ldyBBcnJheShvcHRpb25zLmxlbmd0aCkuZmlsbCgwKTsKICAgICAgICBjb25zdCBuYW1lc0J5QW5zd2VyID0ge307CiAgICAgICAgb3B0aW9ucy5mb3JFYWNoKChvcHQsIGluZGV4KSA9PiB7IG5hbWVzQnlBbnN3ZXJbaW5kZXhdID0gW107IH0pOwoKICAgICAgICBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5mb3JFYWNoKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICAgICAgY29uc3QgY3VycmVudEFuc3dlck9iaiA9IChkYXRhLmFuc3dlcnMgfHwgW10pLmZpbmQoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4KTsKICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzICE9PSAnaW5hY3RpdmUnICYmIGN1cnJlbnRBbnN3ZXJPYmogJiYgY3VycmVudEFuc3dlck9iai5hbnN3ZXIgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckluZGV4ID0gcGFyc2VJbnQoY3VycmVudEFuc3dlck9iai5hbnN3ZXIpOwogICAgICAgICAgICAgICAgaWYgKCFpc05hTihhbnN3ZXJJbmRleCkgJiYgbmFtZXNCeUFuc3dlclthbnN3ZXJJbmRleF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gaXNBbm9ueW1vdXMgPyAoZ2FtZURhdGEucGxheWVyTmlja25hbWVzW25hbWVdIHx8ICc/Pz8nKSA6IG5hbWU7CiAgICAgICAgICAgICAgICAgICAgbmFtZXNCeUFuc3dlclthbnN3ZXJJbmRleF0ucHVzaChkaXNwbGF5TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgYW5zd2VyQ291bnRzW2Fuc3dlckluZGV4XSsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGNoYXJ0SFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LTJ4bCBmbGV4IGp1c3RpZnktYXJvdW5kIGl0ZW1zLWVuZCBnYXAtNCBteS04Ij4KICAgICAgICAgICAgICAgICR7YW5zd2VyQ291bnRzLm1hcCgoY291bnQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG9vbHRpcFRleHQgPSBuYW1lc0J5QW5zd2VyW2luZGV4XS5sZW5ndGggPiAwID8gbmFtZXNCeUFuc3dlcltpbmRleF0uam9pbignLCAnKSA6ICfguYTguKHguYjguKHguLXguJzguLnguYnguJXguK3guJrguJXguLHguKfguYDguKXguLfguK3guIHguJnguLXguYknOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhckNvbG9yID0gJyM2MzY2RjEnOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzQgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWVuZCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItMSI+JHtjb3VudH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1bW1hcnktYmFyLWl0ZW0gdy1mdWxsIHJvdW5kZWQtbGcgdGV4dC13aGl0ZSBwLTIgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgZ2FwLTEgY3Vyc29yLXBvaW50ZXIgcmVsYXRpdmUiIHN0eWxlPSJtaW4taGVpZ2h0OiA2MHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAke2JhckNvbG9yfTsiIGRhdGEtdG9vbHRpcC10YXJnZXQ9InRvb2x0aXAtJHtpbmRleH0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gc206dGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtY2VudGVyIHBvaW50ZXItZXZlbnRzLW5vbmUiPiR7b3B0aW9uc1tpbmRleF19PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idG9vbHRpcC0ke2luZGV4fSIgY2xhc3M9ImxpdmUtc3VtbWFyeS10b29sdGlwIGFic29sdXRlIGJvdHRvbS1mdWxsIG1iLTIgdy1tYXggbWF4LXcteHMgYmctZ3JheS04MDAgdGV4dC13aGl0ZSB0ZXh0LXNtIHJvdW5kZWQtbGcgc2hhZG93LWxnIHAtMyB6LTEwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nIGNsYXNzPSJibG9jayBtYi0xIGJvcmRlci1iIGJvcmRlci1ncmF5LTYwMCBwYi0xIj7guJzguLnguYnguJfguLXguYjguJXguK3guJrguJXguLHguKfguYDguKXguLfguK3guIHguJnguLXguYk6PC9zdHJvbmc+JHt0b29sdGlwVGV4dH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PmA7CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4m+C4uOC5iOC4oeC4hOC4p+C4muC4hOC4uOC4oSBBZG1pbiAtLS0KICAgIGxldCBhY3Rpb25CdXR0b25zSFRNTCA9ICcnOwogICAgY29uc3QgaXNMYXN0UXVlc3Rpb24gPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMTsKCiAgICBpZiAoaXNBZG1pbikgewogICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICBpZiAoaXNMYXN0UXVlc3Rpb24pIHsKICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbnNIVE1MID0gYDxidXR0b24gaWQ9InNob3ctZmluYWwtcmVzdWx0cy1idG4iIGNsYXNzPSJiZy15ZWxsb3ctNTAwIGhvdmVyOmJnLXllbGxvdy02MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwiPjxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtYmFyIj48L2k+IOC5gOC4guC5ieC4suC4quC4ueC5iOC4iuC5iOC4p+C4h+C5gOC4ieC4peC4ouC4hOC4s+C4leC4reC4miAoUmV2aWV3KTwvYnV0dG9uPmA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b25zSFRNTCA9IGA8YnV0dG9uIGlkPSJuZXh0LXN5bmMtcXVlc3Rpb24tYnRuIiBjbGFzcz0iYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwiPuC4guC5ieC4reC4leC5iOC4reC5hOC4myA8aSBjbGFzcz0iZmFzIGZhLWFycm93LXJpZ2h0Ij48L2k+PC9idXR0b24+YDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFjdGlvbkJ1dHRvbnNIVE1MID0gYAogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ib3Blbi1zeW5jLXNjcmF0Y2hwYWQtYnRuIiBjbGFzcz0iYmctd2hpdGUvMzAgaG92ZXI6Ymctd2hpdGUvNTAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC14bCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0Ij48L2k+IOC4l+C4lOC5gOC4peC4gjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic2hvdy1yZXN1bHRzLWJ0biIgY2xhc3M9ImJnLXllbGxvdy01MDAgaG92ZXI6YmcteWVsbG93LTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCI+PGkgY2xhc3M9ImZhcyBmYS1jaGFydC1iYXIiPjwvaT4g4LmB4Liq4LiU4LiH4Lic4Lil4Lil4Lix4Lie4LiY4LmMPC9idXR0b24+CiAgICAgICAgICAgIGA7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBpZiAoaXNSZXZlYWxBdEVuZE1vZGUpIHsKICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbnNIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQtbGcgdGV4dC1pbmRpZ28tMjAwIj7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYTguJvguILguYnguK3guJXguYjguK3guYTguJsuLi48L3A+YDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgYWN0aW9uQnV0dG9uc0hUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC1sZyB0ZXh0LWluZGlnby0yMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5geC4quC4lOC4h+C4nOC4peC4peC4seC4nuC4mOC5jC4uLjwvcD5gOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBwaW5EaXNwbGF5SFRNTCA9IGlzQWRtaW4gPyBgPGRpdiBjbGFzcz0iYWJzb2x1dGUgdG9wLTQgbGVmdC00IGJnLWJsYWNrLzMwIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC1zbSI+UElOOiA8c3Ryb25nIGNsYXNzPSJmb250LWJvbGQiPiR7Z2FtZURhdGEucGlufTwvc3Ryb25nPjwvZGl2PmAgOiAnJzsKCiAgICBjb25zdCBzdW1tYXJ5SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiByZWxhdGl2ZSI+CiAgICAgICAgJHtwaW5EaXNwbGF5SFRNTH0gCiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIj4ke3F1ZXN0aW9uLnF1ZXN0aW9uVGV4dCB8fCBxdWVzdGlvbi5zdGVtIHx8ICcnfTwvaDI+CiAgICAgICAgICAgIAogICAgICAgICAgICAke2NoYXJ0SFRNTH0KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC00IG10LTQiPiR7YWN0aW9uQnV0dG9uc0hUTUx9PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgCiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gc3VtbWFyeUhUTUw7CiAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoKTsKCiAgICBpZiAoaXNBZG1pbikgewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIAogICAgICAgIC8vIEV2ZW50IExpc3RlbmVycwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LXJlc3VsdHMtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBsZWFkZXJib2FyZERhdGEgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLm1hcChwID0+ICh7CiAgICAgICAgICAgICAgICBuYW1lOiBwLm5hbWUsCiAgICAgICAgICAgICAgICBzY29yZTogcC5zY29yZSB8fCAwLAogICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IHAudG90YWxQb2ludHMgfHwgMCwKICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogcC5wb2ludHNMYXN0Um91bmQgfHwgMCwKICAgICAgICAgICAgICAgIGFuc3dlcnM6IHAuYW5zd2VycyB8fCBbXSwKICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IHAuY29ycmVjdFN0cmVhayB8fCAwIAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3Jlc3VsdHMnLCBwdWJsaWNMZWFkZXJib2FyZDogbGVhZGVyYm9hcmREYXRhIH0pOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXN5bmMtc2NyYXRjaHBhZC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBvcHRpb25zIOC4quC4s+C4q+C4o+C4seC4miBtYXRjaGluZyAoYWxsUmVzcG9uc2VzKSDguYPguKvguYkgc2NyYXRjaHBhZCDguYPguIrguYnguIfguLLguJnguYTguJTguYkKICAgICAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIHF1ZXN0aW9uLm9wdGlvbnMgfHwgcXVlc3Rpb24uYWxsUmVzcG9uc2VzIHx8IFtdKTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQtc3luYy1xdWVzdGlvbi1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdxdWVzdGlvbicsIAogICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IG5leHRJbmRleCwgCiAgICAgICAgICAgICAgICBxdWVzdGlvbkRpc3BsYXllZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICAgICAgICAgIHNjb3Jlc0NhbGN1bGF0ZWQ6IGZhbHNlIAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctZmluYWwtcmVzdWx0cy1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICBjb25zdCBsZWFkZXJib2FyZERhdGEgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLm1hcChwID0+ICh7CiAgICAgICAgICAgICAgICBuYW1lOiBwLm5hbWUsCiAgICAgICAgICAgICAgICBzY29yZTogcC5zY29yZSB8fCAwLAogICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IHAudG90YWxQb2ludHMgfHwgMCwKICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogcC5wb2ludHNMYXN0Um91bmQgfHwgMCwKICAgICAgICAgICAgICAgIGFuc3dlcnM6IHAuYW5zd2VycyB8fCBbXSwKICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IHAuY29ycmVjdFN0cmVhayB8fCAwIAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgeyAKICAgICAgICAgICAgICAgIHN0YXR1czogJ3Jlc3VsdHMnLCAKICAgICAgICAgICAgICAgIHJldmlld1F1ZXN0aW9uSW5kZXg6IDAsIAogICAgICAgICAgICAgICAgcHVibGljTGVhZGVyYm9hcmQ6IGxlYWRlcmJvYXJkRGF0YQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyQW5vbnltb3VzU3R1ZGVudFJlc3VsdHNWaWV3KGdhbWVEYXRhKSB7CiAgICBjb25zdCBpc0xhc3RRdWVzdGlvbiA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoIC0gMTsKICAgIGxldCBtZXNzYWdlID0gJyc7CiAgICAKICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4quC4luC4suC4meC4sOC4geC4suC4o+C5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4rQogICAgaWYgKGdhbWVEYXRhLmlzQW5vbnltb3VzUmV2ZWFsZWQgPT09IHRydWUpIHsKICAgICAgICAvLyAo4LiB4Lij4LiT4Li1IEFkbWluIOC4geC4lOC5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4reC5geC4peC5ieC4pyAtIOC4i+C4tuC5iOC4h+C4iOC4sOC5gOC4geC4tOC4lOC5gOC4ieC4nuC4suC4sOC4guC5ieC4reC4quC4uOC4lOC4l+C5ieC4suC4oikKICAgICAgICBjb25zdCBteVBsYXllckRhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW2xvY2FsVGVhbVBsYXllcnNbMF1dOwogICAgICAgIGNvbnN0IG15UmVhbE5hbWUgPSBteVBsYXllckRhdGEubmFtZTsKICAgICAgICBjb25zdCBteVNjb3JlID0gbXlQbGF5ZXJEYXRhLnNjb3JlOwogICAgICAgIAogICAgICAgIG1lc3NhZ2UgPSBgCiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC13aGl0ZSBtdC00Ij4ke215UmVhbE5hbWV9ICjguJnguLHguYjguJnguITguLfguK3guITguLjguJMhKTwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCB0ZXh0LXllbGxvdy0zMDAgbXQtMiI+JHtteVNjb3JlfSDguITguLDguYHguJnguJk8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC04IHRleHQteGwgZm9udC1ib2xkIHRleHQteWVsbG93LTMwMCBhbmltYXRlLXB1bHNlIj7guYDguJXguKPguLXguKLguKHguJ7guJrguIHguLHguJrguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKIhPC9wPgogICAgICAgIGA7CiAgICB9IGVsc2UgewogICAgICAgIC8vICjguIHguKPguJPguLXguKLguLHguIfguYTguKHguYjguYDguJvguLTguJTguYDguJzguKLguIrguLfguYjguK0gLSDguJnguLXguYjguITguLfguK3guKvguJnguYnguLLguIjguK3guKvguKXguLHguIHguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguIjguLDguYDguKvguYfguJkpCiAgICAgICAgbWVzc2FnZSA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIj48L2Rpdj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbXQtNCI+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LmB4Lil4LmJ4LinITwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQteGwgdGV4dC1pbmRpZ28tMjAwIj4KICAgICAgICAgICAgICAgICR7aXNMYXN0UXVlc3Rpb24gPyAn4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmB4Liq4LiU4LiH4Lic4Lil4Liq4Lij4Li44Lib4Liq4Li44LiU4LiX4LmJ4Liy4LiiLi4uJyA6ICfguKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYTguJvguILguYnguK3guJXguYjguK3guYTguJsuLi4nfQogICAgICAgICAgICA8L3A+CiAgICAgICAgYDsKICAgIH0KCiAgICAvLyAyLiDguKrguKPguYnguLLguIcgSFRNTCDguJfguLXguYjguYDguKPguLXguKLguJrguIfguYjguLLguKIKICAgIGNvbnN0IHJlc3VsdHNIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAke21lc3NhZ2V9CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IHJlc3VsdHNIVE1MOwp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNob3dTdHVkZW50UmFua2luZ3MoKSB7CiAgICAvLyBJbnNlcnQgdGFibGUgaGVhZGVycyBmb3Igc3R1ZGVudCBsZWFkZXJib2FyZCB2aWV3cwogICAgY29uc3QgcXVpelRhYmxlSGVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtY29udGVudCB0aGVhZCcpOwogICAgaWYgKHF1aXpUYWJsZUhlYWQpIHsKICAgICAgcXVpelRhYmxlSGVhZC5pbm5lckhUTUwgPSBgCiAgICAgICAgPHRyPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgdy0xNiI+4Lit4Lix4LiZ4LiU4Lix4LiaPC90aD4KICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtbGVmdCI+4LiK4Li34LmI4Lit4Lic4Li54LmJ4LiX4LizPC90aD4KICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guITguLDguYHguJnguJk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4quC4luC4suC4meC4sCAo4Lic4LmI4Liy4LiZL+C5hOC4oeC5iOC4nOC5iOC4suC4mSk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4hOC4sOC5geC4meC4mSBQb2ludHM8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij7guYTguK3guITguK3guJnguKPguLLguIfguKfguLHguKU8L3RoPgogICAgICAgIDwvdHI+CiAgICAgIGA7CiAgICB9CiAgICBjb25zdCBwcm9qZWN0VGFibGVIZWFkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N0dWRlbnQtcHJvamVjdC1sZWFkZXJib2FyZC1jb250ZW50IHRoZWFkJyk7CiAgICBpZiAocHJvamVjdFRhYmxlSGVhZCkgewogICAgICBwcm9qZWN0VGFibGVIZWFkLmlubmVySFRNTCA9IGAKICAgICAgICA8dHI+CiAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB3LTE2Ij7guK3guLHguJnguJTguLHguJo8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij7guIrguLfguYjguK3guJzguLnguYnguYDguKXguYjguJk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4hOC4sOC5geC4meC4meC4o+C4p+C4oSAoUG9pbnRzKTwvdGg+CiAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWxlZnQiPuC5hOC4reC4hOC4reC4meC4o+C4suC4h+C4p+C4seC4peC4l+C4teC5iOC5hOC4lOC5ieC4o+C4seC4mjwvdGg+CiAgICAgICAgPC90cj4KICAgICAgYDsKICAgIH0KICAgIAogICAgICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXJhbmtpbmdzLW1vZGFsJyk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgICAgICAgICAgLy8gU2V0dXAgY2xvc2UgYnV0dG9uCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1zdHVkZW50LXJhbmtpbmdzLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAgICAgICAgIC8vIFNldHVwIHRhYnMKICAgICAgICAgICAgY29uc3QgcXVpelRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtdGFiJyk7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3RUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9qZWN0LWxlYWRlcmJvYXJkLXRhYicpOwogICAgICAgICAgICBjb25zdCBxdWl6Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtY29udGVudCcpOwogICAgICAgICAgICBjb25zdCBwcm9qZWN0Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXByb2plY3QtbGVhZGVyYm9hcmQtY29udGVudCcpOwoKICAgICAgICAgICAgcXVpelRhYi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgcXVpelRhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2plY3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBxdWl6Q29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHByb2plY3RDb250ZW50LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBwcm9qZWN0VGFiLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBwcm9qZWN0VGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcXVpelRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2plY3RDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgcXVpekNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBGZXRjaCBhbmQgcmVuZGVyIGRhdGEKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIDEuIEZldGNoIGRhdGEgZm9yIFRISVMgcXVpeiBsZWFkZXJib2FyZAogICAgICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtjdXJyZW50UXVpekRhdGEuaWR9L3N1Ym1pc3Npb25zYCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uc1NuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhzdWJtaXNzaW9uc1JlZik7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IHN1Ym1pc3Npb25zU25hcHNob3QuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgICAgICAgICAgcmVuZGVyUXVpekxlYWRlcmJvYXJkKHN1Ym1pc3Npb25zLCBjdXJyZW50UXVpekRhdGEsICdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtdGFibGUtYm9keScpOwoKICAgICAgICAgICAgICAgIC8vIDIuIEZldGNoIGRhdGEgZm9yIHRoZSBPVkVSQUxMIHByb2plY3QgbGVhZGVyYm9hcmQKICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0cy8ke2N1cnJlbnRRdWl6RGF0YS5wcm9qZWN0SWR9L3N0dWRlbnRQcm9maWxlc2ApOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvZmlsZXNSZWYpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXMgPSBwcm9maWxlc1NuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuZGF0YSgpKTsKICAgICAgICAgICAgICAgIHJlbmRlckxlYWRlcmJvYXJkKHByb2ZpbGVzLCAnc3R1ZGVudC1wcm9qZWN0LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBzdHVkZW50IHJhbmtpbmdzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguYLguKvguKXguJTguILguYnguK3guKHguLnguKXguK3guLHguJnguJTguLHguJrguYTguJTguYkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2F2ZVRvQmFuayhlKSAgeyAvKiBSZW1vdmVkICovIH0gCgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNlbGVjdFByb2plY3RBbmRHZW5lcmF0ZUJsdWVwcmludFF1aXog4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBzZWxlY3RQcm9qZWN0QW5kR2VuZXJhdGVCbHVlcHJpbnRRdWl6KHRvcGljTmFtZSwgbGVzc29uVGV4dCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsLCBmb3JjZUFwcFN0eWxlID0gZmFsc2UpIHsKICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gdHJ1ZTsKCiAgICAvLyAtLS0gW1NUQVJUXSDguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICAvLyAxLiDguK3guYjguLLguJkgVVJMIOC4iOC4suC4gSBpbnB1dCBmaWVsZCDguYPguJnguKvguJnguYnguLIgQmx1ZXByaW50IE1hbmFnZXIKICAgIGNvbnN0IHJlZmVyZW5jZUZpbGVVcmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtcmVmZXJlbmNlLWZpbGUtdXJsJyk/LnZhbHVlLnRyaW0oKTsKICAgIGxldCBleHRyYVBhcnRzID0gbnVsbDsgLy8g4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZ4LmA4Lib4LmH4LiZIG51bGwKCiAgICAvLyAyLiDguJbguYnguLLguKHguLUgVVJMIOC5g+C4q+C5ieC4lOC4tuC4h+C5hOC4n+C4peC5jOC5geC4peC4sOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4oeC4ueC4peC4quC4s+C4q+C4o+C4seC4muC4quC5iOC4h+C5g+C4q+C5iSBBSQogICAgaWYgKHJlZmVyZW5jZUZpbGVVcmwpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LiU4Li24LiH4LmE4Lif4Lil4LmMIE8tTkVUIOC4reC5ieC4suC4h+C4reC4tOC4h+C4iOC4suC4geC4peC4tOC4h+C4geC5jC4uLiIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHJlZmVyZW5jZUZpbGUgPSBhd2FpdCBmZXRjaEZpbGVGcm9tVXJsKHJlZmVyZW5jZUZpbGVVcmwsICJyZWZlcmVuY2Vfb25ldC5wZGYiKTsKICAgICAgICAgICAgY29uc3QgcmVmQmFzZTY0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKHJlZmVyZW5jZUZpbGUpOwogICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdC5zcGxpdCgnLCcpWzFdKTsKICAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4oeC4ueC4peC5hOC4n+C4peC5jOC5g+C4meC4o+C4ueC4m+C5geC4muC4muC4l+C4teC5iCBBUEkg4LiV4LmJ4Lit4LiH4LiB4Liy4LijCiAgICAgICAgICAgIGV4dHJhUGFydHMgPSBbeyBpbmxpbmVEYXRhOiB7IG1pbWVUeXBlOiByZWZlcmVuY2VGaWxlLnR5cGUsIGRhdGE6IHJlZkJhc2U2NCB9IH1dOwogICAgICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBwb3B1cCDguYDguKHguLfguYjguK3guYLguKvguKXguJTguYDguKrguKPguYfguIgKICAgICAgICB9IGNhdGNoIChmaWxlRXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQ291bGQgbm90IGZldGNoIHJlZmVyZW5jZSBmaWxlOiIsIGZpbGVFcnJvcik7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguJTguLbguIfguYTguJ/guKXguYzguK3guYnguLLguIfguK3guLTguIfguYTguJTguYkg4Lij4Liw4Lia4Lia4LiI4Liw4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiV4Liy4Lih4Lib4LiB4LiV4Li0Iik7CiAgICAgICAgfQogICAgfQogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSAtLS0KCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsKICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LXByb2plY3Qtc2VsZWN0Jyk7CiAgICBjb25zdCBtb2RhbFRpdGxlID0gbW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CiAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1vdmUtcXVpei1idG4nKTsKCiAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC5geC4muC4muC4l+C4lOC4quC4reC4mic7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5geC4peC4sOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4hyc7CiAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsKCiAgICBpZiAoYWxsUHJvamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guKLguLHguIfguYTguKHguYjguKHguLXguYLguJvguKPguYDguIjguITguYPguKvguYnguYDguKXguLfguK3guIE8L29wdGlvbj4nOwogICAgfSBlbHNlIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKwogICAgICAgICAgICBhbGxQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICBjb25zdCBjb25maXJtSGFuZGxlciA9IGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3RJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgaWYgKCFzZWxlY3RlZFByb2plY3RJZCkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LiB4LmI4Lit4LiZIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGF3YWl0IGxvYWRQcm9qZWN0RGV0YWlscyhzZWxlY3RlZFByb2plY3RJZCk7CiAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CiAgICAgICAgCiAgICAgICAgLy8gMy4g4Liq4LmI4LiHIGV4dHJhUGFydHMg4LiX4Li14LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lif4Lil4LmM4LiV4LmI4Lit4LmE4Lib4Lii4Lix4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiW4Lix4LiU4LmE4LibCiAgICAgICAgaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljKHRvcGljTmFtZSwgbGVzc29uVGV4dCwgc2VsZWN0ZWRQcm9qZWN0SWQsIGJsdWVwcmludFRvcGljSWQsIGZvcmNlQXBwU3R5bGUsIGV4dHJhUGFydHMpOwogICAgICAgIAogICAgICAgIGNsZWFudXAoKTsKICAgIH07CiAgICAKICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7CiAgICAgICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguYTguJvguYLguJvguKPguYDguIjguITguK3guLfguYjguJknOwogICAgICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4LiiJzsKICAgICAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybUhhbmRsZXIpOwogICAgICAgIGNhbmNlbEJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFudXApOwogICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtTW92ZVF1aXopOwogICAgfTsKICAgIAogICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1Nb3ZlUXVpeik7CiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybUhhbmRsZXIpOwogICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYW51cCk7Cn0KCmZ1bmN0aW9uIGxpc3RlbkZvclN0YXJyZWRRdWl6emVzKCkgewogICAgaWYgKCF1c2VySWQpIHJldHVybjsKICAgIGNvbnN0IHF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgKTsKICAgIGNvbnN0IHEgPSBxdWVyeShxdWl6emVzUmVmLCB3aGVyZSgiaXNTdGFycmVkIiwgIj09IiwgdHJ1ZSkpOwoKICAgIG9uU25hcHNob3QocSwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgLy8g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiV4Li04LiU4LiU4Liy4Lin4Lil4LiH4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijIGdsb2JhbAogICAgICAgIHN0YXJyZWRRdWl6emVzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSkpOwogICAgICAgIAogICAgICAgIC8vIC0tLSBbIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4leC4reC4meC4meC4teC5ieC4nOC4ueC5ieC5g+C4iuC5ieC4reC4ouC4ueC5iOC5g+C4meC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGlmIChjdXJyZW50UHJvamVjdElkID09PSAnc3RhcnJlZCcpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmD4LiK4LmIIOC5g+C4q+C5ieC4o+C4teC5gOC4n+C4o+C4iuC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lCAocmVuZGVyUXVpenplcykKICAgICAgICAgICAgcmVuZGVyUXVpenplcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC5hOC4lOC5ieC4reC4ouC4ueC5iOC5g+C4meC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lCAo4Lit4Lii4Li54LmI4LiX4Li14LmIIERhc2hib2FyZCkg4LmD4Lir4LmJ4Lij4Li14LmA4Lif4Lij4LiK4Lir4LiZ4LmJ4LiyIERhc2hib2FyZCAocmVuZGVyUHJvamVjdHMpCiAgICAgICAgICAgIHJlbmRlclByb2plY3RzKCk7CiAgICAgICAgfQoKICAgIH0sIChlcnJvcikgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxpc3RlbmluZyBmb3Igc3RhcnJlZCBxdWl6emVzOiIsIGVycm9yKTsKICAgIH0pOwp9CQkJCgkJCi8vIOKWvOKWvOKWvCBTVEFSVDog4Lin4Liy4LiH4LmC4LiE4LmJ4LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAoKLyoqCiAqIFtGaWxlIFNob3J0Y3V0c10g4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LiI4Liy4LiBIEZpcmVzdG9yZQogKi8KZnVuY3Rpb24gbGlzdGVuRm9yRmlsZVNob3J0Y3V0cygpIHsKICAgIGNvbnN0IHNob3J0Y3V0c1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImZpbGVTaG9ydGN1dHNDb25maWciKTsKCiAgICBvblNuYXBzaG90KHNob3J0Y3V0c1JlZiwgKGRvY1NuYXApID0+IHsKICAgICAgICBsZXQgc2hvcnRjdXRzID0gW107CiAgICAgICAgbGV0IHRhYnMgPSBbXTsKICAgICAgICBsZXQgb3JkZXIgPSB7fTsKCiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBzaG9ydGN1dHMgPSBkYXRhLnNob3J0Y3V0cyB8fCBbXTsKICAgICAgICAgICAgdGFicyA9IGRhdGEuZmlsZVNob3J0Y3V0VGFicyB8fCBbXTsgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4l+C5h+C4mgogICAgICAgICAgICBvcmRlciA9IGRhdGEuZmlsZVNob3J0Y3V0T3JkZXIgfHwge307ICAgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4iOC4seC4lOC5gOC4o+C4teC4ouC4hwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWJzLmZpbmQodCA9PiB0LmlkID09PSAnYWxsJykpIHsKICAgICAgICAgICAgdGFicy51bnNoaWZ0KHsgaWQ6ICdhbGwnLCBuYW1lOiAn4LmE4Lif4Lil4LmM4LiX4Lix4LmJ4LiH4Lir4Lih4LiUJywgaXNEZWZhdWx0OiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdmaWxlLWRlZmF1bHQtMScpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdmaWxlLWRlZmF1bHQtMScsIG5hbWU6ICfguYTguJ/guKXguYzguKXguLHguJQgMScsIHVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdmaWxlLWRlZmF1bHQtMicpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdmaWxlLWRlZmF1bHQtMicsIG5hbWU6ICfguYTguJ/guKXguYzguKXguLHguJQgMicsIHVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGZpbGVTaG9ydGN1dHMgPSBzaG9ydGN1dHM7CiAgICAgICAgZmlsZVNob3J0Y3V0VGFicyA9IHRhYnM7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXSDguK3guLHguJvguYDguJTguJXguJXguLHguKfguYHguJvguKMgR2xvYmFsCiAgICAgICAgZmlsZVNob3J0Y3V0T3JkZXIgPSBvcmRlcjsgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4reC4seC4m+C5gOC4lOC4leC4leC4seC4p+C5geC4m+C4oyBHbG9iYWwKCiAgICAgICAgcmVuZGVyRmlsZVNob3J0Y3V0cygpOwoKICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkgewogICAgICAgICAgICByZW5kZXJBZGRpdGlvbmFsRmlsZVNob3J0Y3V0c01vZGFsKCk7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguKfguLLguJQgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCBb4LmD4Lir4Lih4LmIXSDguYDguJ7guLTguYjguKHguIrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKMgRmlsZSBTaG9ydGN1dCBUYWJzIOC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKCmFzeW5jIGZ1bmN0aW9uIHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKSB7CiAgICBjb25zdCBjb25maWdSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJmaWxlU2hvcnRjdXRzQ29uZmlnIik7CiAgICB0cnkgewogICAgICAgIGF3YWl0IHNldERvYyhjb25maWdSZWYsIHsgCiAgICAgICAgICAgIGZpbGVTaG9ydGN1dFRhYnM6IGZpbGVTaG9ydGN1dFRhYnMsCiAgICAgICAgICAgIGZpbGVTaG9ydGN1dE9yZGVyOiBmaWxlU2hvcnRjdXRPcmRlcgogICAgICAgIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgeyBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZmlsZSBzaG9ydGN1dCBjb25maWc6IiwgZXJyb3IpOyB9Cn0KCmZ1bmN0aW9uIHJlbmRlckFkZGl0aW9uYWxGaWxlU2hvcnRjdXRzTW9kYWwoKSB7CiAgICBjb25zdCBuYXZDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC10YWJzLW5hdicpOwogICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGlmICghbmF2Q29udGFpbmVyIHx8ICFsaXN0Q29udGFpbmVyKSByZXR1cm47CgogICAgbmF2Q29udGFpbmVyLmlubmVySFRNTCA9IGZpbGVTaG9ydGN1dFRhYnMubWFwKHRhYiA9PiB7CiAgICAgICAgY29uc3QgaXNBY3RpdmUgPSB0YWIuaWQgPT09IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkOwogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0icmVsYXRpdmUgZ3JvdXAgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS10YWItaWQ9IiR7dGFiLmlkfSIgY2xhc3M9ImZpbGUtc2hvcnRjdXQtdGFiLWJ0biB3aGl0ZXNwYWNlLW5vd3JhcCBweS0zIHB4LTIgYm9yZGVyLWItMiBmb250LW1lZGl1bSB0ZXh0LXNtICR7aXNBY3RpdmUgPyAnYm9yZGVyLWluZGlnby01MDAgdGV4dC1pbmRpZ28tNjAwJyA6ICdib3JkZXItdHJhbnNwYXJlbnQgdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWdyYXktNzAwIGhvdmVyOmJvcmRlci1ncmF5LTMwMCd9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRhYi1uYW1lLWRpc3BsYXkgcG9pbnRlci1ldmVudHMtbm9uZSI+JHt0YWIubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHt0YWIubmFtZX0iIGNsYXNzPSJ0YWItbmFtZS1pbnB1dCBoaWRkZW4gYmctdHJhbnNwYXJlbnQgYm9yZGVyLWItMiBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIHctMzIiPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICR7IXRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXRhYi1pZD0iJHt0YWIuaWR9IiBjbGFzcz0iZGVsZXRlLWZpbGUtc2hvcnRjdXQtdGFiLWJ0biBhYnNvbHV0ZSAtdG9wLTEgLXJpZ2h0LTEgdGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTcwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgY29uc3QgYWN0aXZlVGFiID0gZmlsZVNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gYWN0aXZlRmlsZVNob3J0Y3V0VGFiSWQpOwogICAgbGV0IHNob3J0Y3V0c1RvU2hvdyA9IGFjdGl2ZVRhYj8uaXNEZWZhdWx0ID8gWy4uLmZpbGVTaG9ydGN1dHNdIDogZmlsZVNob3J0Y3V0cy5maWx0ZXIocyA9PiAoYWN0aXZlVGFiPy5zaG9ydGN1dElkcyB8fCBbXSkuaW5jbHVkZXMocy5pZCkpOwogICAgCiAgICBjb25zdCBjdXJyZW50T3JkZXIgPSBmaWxlU2hvcnRjdXRPcmRlclthY3RpdmVGaWxlU2hvcnRjdXRUYWJJZF0gfHwgW107CiAgICBzaG9ydGN1dHNUb1Nob3cuc29ydCgoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGluZGV4QSA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGEuaWQpOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGIuaWQpOwogICAgICAgIHJldHVybiAoaW5kZXhBID09PSAtMSA/IEluZmluaXR5IDogaW5kZXhBKSAtIChpbmRleEIgPT09IC0xID8gSW5maW5pdHkgOiBpbmRleEIpOwogICAgfSk7CgogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzaG9ydGN1dHNUb1Nob3cubWFwKHNob3J0Y3V0ID0+IHsKICAgICAgICBjb25zdCBpY29uID0gc2hvcnRjdXQudXJsID8gJ/Cfk4QnIDogJ/CflJcnOwogICAgICAgIGNvbnN0IG90aGVyVGFicyA9IGZpbGVTaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gIXQuaXNEZWZhdWx0KTsKICAgICAgICBjb25zdCBtb3ZlRHJvcGRvd25IVE1MID0gYWN0aXZlVGFiLmlzRGVmYXVsdCAmJiBvdGhlclRhYnMubGVuZ3RoID4gMCA/IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgaW5saW5lLWJsb2NrIHRleHQtbGVmdCBncm91cC9kcm9wZG93bi1maWxlIj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1tZW51LWJ0biB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS03MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIj48aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLXYiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1kcm9wZG93biBvcmlnaW4tdG9wLXJpZ2h0IGFic29sdXRlIHJpZ2h0LTAgbXQtMiB3LTQ4IHJvdW5kZWQtbWQgc2hhZG93LWxnIGJnLXdoaXRlIHJpbmctMSByaW5nLWJsYWNrIHJpbmctb3BhY2l0eS01IGhpZGRlbiB6LTIwIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJweS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InB4LTQgcHQtMSBwYi0yIHRleHQteHMgdGV4dC1ncmF5LTQwMCI+4LmA4Lie4Li04LmI4Lih4LmE4Lib4Lii4Lix4LiH4LmB4LiX4LmH4LiaOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdGhlclRhYnMubWFwKHRhYiA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1pdGVtIGJsb2NrIHB4LTQgcHktMiB0ZXh0LXNtIHRleHQtZ3JheS03MDAgaG92ZXI6YmctZ3JheS0xMDAiIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkYXRhLXRhcmdldC10YWItaWQ9IiR7dGFiLmlkfSI+JHt0YWIubmFtZX08L2E+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YCA6ICcnOwoKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InNob3J0Y3V0LWxpc3QtaXRlbSBwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkcmFnZ2FibGU9InRydWUiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtpY29ufSAke3Nob3J0Y3V0Lm5hbWV9PC9wPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLWJsdWUtMjAwIj7guYDguKXguLfguK3guIHguYPguIrguYk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuIGJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmcteWVsbG93LTIwMCI+4LmB4LiB4LmJ4LmE4LiCPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICR7IXNob3J0Y3V0LmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLWhpZGRlbi1maWxlLXNob3J0Y3V0LWJ0biBiZy1yZWQtMTAwIHRleHQtcmVkLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXJlZC0yMDAiPuC4peC4mjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHshYWN0aXZlVGFiLmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0icmVtb3ZlLWZpbGUtc2hvcnRjdXQtZnJvbS10YWItYnRuIHRleHQtcmVkLTUwMCBtbC0yIiB0aXRsZT0i4LiZ4Liz4Lit4Lit4LiB4LiI4Liy4LiB4LmB4LiX4LmH4Lia4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHttb3ZlRHJvcGRvd25IVE1MfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpIHx8ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5g+C4meC5geC4l+C5h+C4muC4meC4teC5iTwvcD4nOwogICAgCiAgICBzZXR1cEZpbGVTaG9ydGN1dE1vZGFsRXZlbnRMaXN0ZW5lcnMoKTsKfQoKZnVuY3Rpb24gc2V0dXBGaWxlU2hvcnRjdXRNb2RhbEV2ZW50TGlzdGVuZXJzKCkgewogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtc2hvcnRjdXQtdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4ub25jbGljayA9IGUgPT4geyBhY3RpdmVGaWxlU2hvcnRjdXRUYWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOyByZW5kZXJBZGRpdGlvbmFsRmlsZVNob3J0Y3V0c01vZGFsKCk7IH07CiAgICAgICAgYnRuLm9uZGJsY2xpY2sgPSBlID0+IHsKICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcignLnRhYi1uYW1lLWlucHV0Jyk7CiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCcudGFiLW5hbWUtZGlzcGxheScpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgaW5wdXQuZm9jdXMoKTsgaW5wdXQuc2VsZWN0KCk7CiAgICAgICAgfTsKICAgIH0pOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2ZpbGUtc2hvcnRjdXQtdGFicy1uYXYgLnRhYi1uYW1lLWlucHV0JykuZm9yRWFjaChpbnB1dCA9PiB7CiAgICAgICAgY29uc3Qgc2F2ZSA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdGFiSWQgPSBpbnB1dC5jbG9zZXN0KCcuZmlsZS1zaG9ydGN1dC10YWItYnRuJykuZGF0YXNldC50YWJJZDsKICAgICAgICAgICAgY29uc3QgdGFiID0gZmlsZVNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFiSWQpOwogICAgICAgICAgICBpZih0YWIpIHsgdGFiLm5hbWUgPSBpbnB1dC52YWx1ZS50cmltKCkgfHwgdGFiLm5hbWU7IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsgfQogICAgICAgIH07CiAgICAgICAgaW5wdXQub25ibHVyID0gc2F2ZTsKICAgICAgICBpbnB1dC5vbmtleWRvd24gPSBlID0+IHsgaWYgKGUua2V5ID09PSAnRW50ZXInKSBpbnB1dC5ibHVyKCk7IH07CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxldGUtZmlsZS1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBjb25zdCB0YWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oIuC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC5geC4l+C5h+C4muC4meC4teC5iT8iLCAoKSA9PiB7CiAgICAgICAgICAgIGZpbGVTaG9ydGN1dFRhYnMgPSBmaWxlU2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+IHQuaWQgIT09IHRhYklkKTsKICAgICAgICAgICAgZGVsZXRlIGZpbGVTaG9ydGN1dE9yZGVyW3RhYklkXTsKICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID09PSB0YWJJZCkgYWN0aXZlRmlsZVNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKICAgICAgICAgICAgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOwogICAgICAgIH0pOwogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LWl0ZW0nKS5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5vbmNsaWNrID0gZSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGNvbnN0IHsgc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0OwogICAgICAgIGNvbnN0IHRhYiA9IGZpbGVTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhcmdldFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5zaG9ydGN1dElkcy5pbmNsdWRlcyhzaG9ydGN1dElkKSkgeyB0YWIuc2hvcnRjdXRJZHMucHVzaChzaG9ydGN1dElkKTsgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOyB9CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZW1vdmUtZmlsZS1zaG9ydGN1dC1mcm9tLXRhYi1idG4nKS5mb3JFYWNoKGJ0biA9PiBidG4ub25jbGljayA9IGUgPT4gewogICAgICAgIGNvbnN0IHNob3J0Y3V0SWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5zaG9ydGN1dElkOwogICAgICAgIGNvbnN0IHRhYiA9IGZpbGVTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5pc0RlZmF1bHQpIHsgdGFiLnNob3J0Y3V0SWRzID0gdGFiLnNob3J0Y3V0SWRzLmZpbHRlcihpZCA9PiBpZCAhPT0gc2hvcnRjdXRJZCk7IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsgfQogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LW1lbnUtYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZS5jdXJyZW50VGFyZ2V0Lm5leHRFbGVtZW50U2libGluZzsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LWRyb3Bkb3duJykuZm9yRWFjaChkID0+IGQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgIGRyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfSk7CiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbGlzdCcpOwogICAgbGV0IGRyYWdnZWRJdGVtID0gbnVsbDsKICAgIGxpc3RDb250YWluZXIub25kcmFnc3RhcnQgPSBlID0+IHsKICAgICAgICBkcmFnZ2VkSXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKTsKICAgICAgICBpZihkcmFnZ2VkSXRlbSkgc2V0VGltZW91dCgoKSA9PiBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LTUwJyksIDApOwogICAgfTsKICAgIGxpc3RDb250YWluZXIub25kcmFnZW5kID0gKCkgPT4geyBpZihkcmFnZ2VkSXRlbSkgeyBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7IGRyYWdnZWRJdGVtID0gbnVsbDsgfX07CiAgICBsaXN0Q29udGFpbmVyLm9uZHJhZ292ZXIgPSBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9OwogICAgbGlzdENvbnRhaW5lci5vbmRyb3AgPSBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGFmdGVyRWxlbWVudCA9IFsuLi5saXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaG9ydGN1dC1saXN0LWl0ZW06bm90KC5vcGFjaXR5LTUwKScpXS5yZWR1Y2UoKGNsb3Nlc3QsIGNoaWxkKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBjaGlsZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGUuY2xpZW50WSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjsKICAgICAgICAgICAgICAgIHJldHVybiAob2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCkgPyB7IG9mZnNldDogb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9IDogY2xvc2VzdDsKICAgICAgICAgICAgfSwgeyBvZmZzZXQ6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSB9KS5lbGVtZW50OwogICAgICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHsgbGlzdENvbnRhaW5lci5hcHBlbmRDaGlsZChkcmFnZ2VkSXRlbSk7IH0gCiAgICAgICAgICAgIGVsc2UgeyBsaXN0Q29udGFpbmVyLmluc2VydEJlZm9yZShkcmFnZ2VkSXRlbSwgYWZ0ZXJFbGVtZW50KTsgfQogICAgICAgICAgICBjb25zdCBuZXdPcmRlciA9IFsuLi5saXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKV0ubWFwKGl0ZW0gPT4gaXRlbS5kYXRhc2V0LnNob3J0Y3V0SWQpOwogICAgICAgICAgICBmaWxlU2hvcnRjdXRPcmRlclthY3RpdmVGaWxlU2hvcnRjdXRUYWJJZF0gPSBuZXdPcmRlcjsKICAgICAgICAgICAgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOwogICAgICAgIH0KICAgIH07Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFkZEZpbGVTaG9ydGN1dFRhYigpIHsKICAgIGNvbnN0IG5hbWUgPSBwcm9tcHQoIuC4geC4o+C4uOC4k+C4suC4leC4seC5ieC4h+C4iuC4t+C5iOC4reC5geC4l+C5h+C4muC5g+C4q+C4oeC5iDoiLCAi4LmB4LiX4LmH4Lia4LmD4Lir4Lih4LmIIik7CiAgICBpZiAobmFtZSAmJiBuYW1lLnRyaW0oKSkgewogICAgICAgIGZpbGVTaG9ydGN1dFRhYnMucHVzaCh7IGlkOiBgdGFiXyR7RGF0ZS5ub3coKX1gLCBuYW1lOiBuYW1lLnRyaW0oKSwgc2hvcnRjdXRJZHM6IFtdIH0pOwogICAgICAgIGF3YWl0IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gcmVuZGVyRmlsZVNob3J0Y3V0cygpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWNvbnRhaW5lcicpOwogICAgY29uc3QgYWRkaXRpb25hbExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1saXN0Jyk7CiAgICBjb25zdCBsb2FkaW5nTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtc2hvcnRjdXRzLWxvYWRpbmctbXNnJyk7CgogICAgaWYgKGxvYWRpbmdNc2cpIGxvYWRpbmdNc2cuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBpZiAoIWNvbnRhaW5lciB8fCAhYWRkaXRpb25hbExpc3QpIHJldHVybjsKCiAgICBjb25zdCB2aXNpYmxlU2hvcnRjdXRzID0gZmlsZVNob3J0Y3V0cy5zbGljZSgwLCA0KTsKICAgIGNvbnN0IGhpZGRlblNob3J0Y3V0cyA9IGZpbGVTaG9ydGN1dHMuc2xpY2UoNCk7CgogICAgY29udGFpbmVyLmlubmVySFRNTCA9IHZpc2libGVTaG9ydGN1dHMubWFwKHNob3J0Y3V0ID0+IHsKICAgICAgICBjb25zdCBoYXNVcmwgPSBzaG9ydGN1dC51cmwgJiYgc2hvcnRjdXQudXJsLnRyaW0oKSAhPT0gJyc7CiAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lib4Li44LmI4Lih4LiZ4Li14LmJ4LiE4Li34Lit4Lib4Li44LmI4Lih4LiX4Li14LmIICLguJbguLnguIHguYDguKXguLfguK3guIEiIOC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGNvbnN0IGlzQWN0aXZlID0gc2VsZWN0ZWRGaWxlICYmIHNlbGVjdGVkRmlsZS5zaG9ydGN1dElkID09PSBzaG9ydGN1dC5pZDsKCiAgICAgICAgbGV0IGJnQ29sb3JDbGFzcyA9ICdiZy1ncmF5LTIwMCBob3ZlcjpiZy1ncmF5LTMwMCB0ZXh0LWdyYXktNzAwJzsKICAgICAgICBsZXQgaWNvbiA9ICfwn5SXJzsKCiAgICAgICAgaWYgKGlzQWN0aXZlKSB7CiAgICAgICAgICAgIC8vIOC4quC4luC4suC4meC4sDog4Lie4Lij4LmJ4Lit4Lih4LmD4LiK4LmJ4LiH4Liy4LiZICjguKrguLXguYDguILguLXguKLguKcsIOC4oeC4teC5gOC4hOC4o+C4t+C5iOC4reC4h+C4q+C4oeC4suC4ouC4leC4tOC5iuC4geC4luC4ueC4gSkKICAgICAgICAgICAgYmdDb2xvckNsYXNzID0gJ2JnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHJpbmctNCByaW5nLWdyZWVuLTMwMCc7CiAgICAgICAgICAgIGljb24gPSAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiPjwvaT4nOwogICAgICAgIH0gZWxzZSBpZiAoaGFzVXJsKSB7CiAgICAgICAgICAgIC8vIOC4quC4luC4suC4meC4sDog4Lih4Li14Lil4Li04LiH4LiB4LmMIOC5geC4leC5iOC4ouC4seC4h+C5hOC4oeC5iOC4luC4ueC4geC5gOC4peC4t+C4reC4gSAo4Liq4Li14Lif4LmJ4LiyKQogICAgICAgICAgICBiZ0NvbG9yQ2xhc3MgPSAnYmctYmx1ZS01MDAgaG92ZXI6YmctYmx1ZS02MDAgdGV4dC13aGl0ZSc7CiAgICAgICAgICAgIGljb24gPSAn8J+ThCc7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZWxldGVCdG5IdG1sID0gIXNob3J0Y3V0LmlzRGVmYXVsdCA/IAogICAgICAgICAgICBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1maWxlLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSB0b3AtMSByaWdodC0xIHctNiBoLTYgYmctcmVkLTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguKXguJoiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyc7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJmaWxlLXNob3J0Y3V0LWJ0biByb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC02IGgtMjQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSAke2JnQ29sb3JDbGFzc30iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBvaW50ZXItZXZlbnRzLW5vbmUgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC0yeGwiPiR7aWNvbn08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIj4ke3Nob3J0Y3V0Lm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1maWxlLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSBib3R0b20tMSByaWdodC0xIHctNiBoLTYgYmctd2hpdGUvNTAgdGV4dC1ncmF5LTgwMCByb3VuZGVkLWZ1bGwgdGV4dC14cyBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHtkZWxldGVCdG5IdG1sfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfSkuam9pbignJyk7CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgIDxkaXYgaWQ9Im9wZW4tYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4iIGNsYXNzPSJyb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiBob3ZlcjpzY2FsZS0xMDUgaC0yNCBiZy1ncmF5LTEwMCBob3ZlcjpiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNjAwIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZWxsaXBzaXMtaCB0ZXh0LXhsIj48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXQtMiB0ZXh0LXNtIj7guJvguLjguYjguKHguKXguLHguJTguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgYWRkaXRpb25hbExpc3QuaW5uZXJIVE1MID0gaGlkZGVuU2hvcnRjdXRzLm1hcChzaG9ydGN1dCA9PiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBib3JkZXItYiBob3ZlcjpiZy1ncmF5LTEwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtzaG9ydGN1dC51cmwgPyAn8J+ThCcgOiAn8J+Ulyd9ICR7c2hvcnRjdXQubmFtZX08L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLWJsdWUtMjAwIj7guYDguKXguLfguK3guIHguYPguIrguYk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctMjAwIj7guYHguIHguYnguYTguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtMjAwIj7guKXguJo8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYCkuam9pbignJyk7CiAgICB9IGVsc2UgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvcD4nOwogICAgfQp9CgovKioKICogW0ZpbGUgU2hvcnRjdXRzXSDguYDguJvguLTguJQgTW9kYWwg4Liq4Liz4Lir4Lij4Lix4Lia4LmB4LiB4LmJ4LmE4LiC4Lir4Lij4Li34Lit4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4Lir4Lih4LmICiAqLwpmdW5jdGlvbiBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKHNob3J0Y3V0SWQgPSBudWxsKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpOwogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1tb2RhbC10aXRsZScpOwogICAgY29uc3QgaWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWlkLWlucHV0Jyk7CiAgICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1uYW1lLWlucHV0Jyk7CiAgICBjb25zdCB1cmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LXVybC1pbnB1dCcpOwoKICAgIGlmIChzaG9ydGN1dElkKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXQgPSBmaWxlU2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgICAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4LiB4LmJ4LmE4LiC4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmMJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gc2hvcnRjdXQuaWQ7CiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gc2hvcnRjdXQubmFtZTsKICAgICAgICB1cmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LnVybCB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LmD4Lir4Lih4LmIJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gJyc7IG5hbWVJbnB1dC52YWx1ZSA9ICcnOyB1cmxJbnB1dC52YWx1ZSA9ICcnOwogICAgfQogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCi8qKgogKiBbRmlsZSBTaG9ydGN1dHNdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4h+C4iOC4suC4gSBNb2RhbCDguKXguIcgRmlyZWJhc2UKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVGaWxlU2hvcnRjdXRDaGFuZ2VzKCkgewogICAgY29uc3QgaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1pZC1pbnB1dCcpLnZhbHVlOwogICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LW5hbWUtaW5wdXQnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCB1cmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC11cmwtaW5wdXQnKS52YWx1ZS50cmltKCk7CgogICAgaWYgKCFuYW1lKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguIHguKPguK3guIEgJ+C4iuC4t+C5iOC4reC4m+C4uOC5iOC4oeC4peC4seC4lCciKTsgcmV0dXJuOyB9CgogICAgY29uc3QgbmV3U2hvcnRjdXREYXRhID0gewogICAgICAgIGlkOiBpZCB8fCBgZmlsZS1zaG9ydGN1dF8ke0RhdGUubm93KCl9YCwKICAgICAgICBuYW1lOiBuYW1lLCB1cmw6IHVybCwgaXNEZWZhdWx0OiBpZC5zdGFydHNXaXRoKCdmaWxlLWRlZmF1bHQtJykKICAgIH07CgogICAgbGV0IHVwZGF0ZWRTaG9ydGN1dHM7CiAgICBpZiAoaWQpIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gZmlsZVNob3J0Y3V0cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IG5ld1Nob3J0Y3V0RGF0YSA6IHMpOwogICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gWy4uLmZpbGVTaG9ydGN1dHMsIG5ld1Nob3J0Y3V0RGF0YV07CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZmlsZVNob3J0Y3V0c0NvbmZpZyIpOwogICAgICAgIGF3YWl0IHNldERvYyhwcmVmUmVmLCB7IHNob3J0Y3V0czogdXBkYXRlZFNob3J0Y3V0cyB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZmlsZSBzaG9ydGN1dDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9CgovKioKICogW0ZpbGUgU2hvcnRjdXRzXSDguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguYDguKHguLfguYjguK3guITguKXguLTguIHguJfguLXguYjguJvguLjguYjguKHguKXguLHguJQKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUZpbGVTaG9ydGN1dENsaWNrKHNob3J0Y3V0SWQpIHsKICAgIGNvbnN0IHNob3J0Y3V0ID0gZmlsZVNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk7CiAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CgogICAgLy8g4LiW4LmJ4Liy4Lib4Li44LmI4Lih4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lil4Li04LiH4LiB4LmMIOC5g+C4q+C5ieC5gOC4m+C4tOC4lOC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5geC4geC5ieC5hOC4guC5geC4l+C4mQogICAgaWYgKCFzaG9ydGN1dC51cmwgfHwgc2hvcnRjdXQudXJsLnRyaW0oKSA9PT0gJycpIHsKICAgICAgICBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKHNob3J0Y3V0SWQpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguYLguKvguKXguJTguJrguJnguJvguLjguYjguKHguJfguLXguYjguJbguLnguIHguITguKXguLTguIEKICAgIGNvbnN0IGJ0bkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuZmlsZS1zaG9ydGN1dC1idG5bZGF0YS1pZD0iJHtzaG9ydGN1dElkfSJdYCk7CiAgICBpZiAoYnRuRWxlbWVudCkgewogICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IGJ0bkVsZW1lbnQuaW5uZXJIVE1MOwogICAgICAgIGJ0bkVsZW1lbnQuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPSJwb2ludGVyLWV2ZW50cy1ub25lIj48aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiI+PC9pPjwvc3Bhbj5gOwogICAgICAgIGJ0bkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwogICAgfQogICAgCiAgICAvLyDguJvguLTguJTguIHguLLguKPguYPguIrguYnguIfguLLguJnguJvguLjguYjguKHguK3guLfguYjguJnguIrguLHguYjguKfguITguKPguLLguKcKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWxlLXNob3J0Y3V0LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBpZihidG4uZGF0YXNldC5pZCAhPT0gc2hvcnRjdXRJZCkgYnRuLmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnLCAncG9pbnRlci1ldmVudHMtbm9uZScpOwogICAgfSk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCB1cmxQYXRoID0gbmV3IFVSTChzaG9ydGN1dC51cmwpLnBhdGhuYW1lOwogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gdXJsUGF0aC5zdWJzdHJpbmcodXJsUGF0aC5sYXN0SW5kZXhPZignLycpICsgMSkgfHwgKHNob3J0Y3V0LnVybC5pbmNsdWRlcygnLnR4dCcpID8gJ2ZpbGUudHh0JyA6ICdmaWxlLnBkZicpOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBmZXRjaEZpbGVGcm9tVXJsIOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4pwogICAgICAgIGNvbnN0IGZpbGVPYmplY3QgPSBhd2FpdCBmZXRjaEZpbGVGcm9tVXJsKHNob3J0Y3V0LnVybCwgZmlsZW5hbWUpOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBJRCDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguYDguILguYnguLLguYTguJvguYPguJkgRmlsZSBvYmplY3Qg4LmA4Lie4Li34LmI4Lit4LmD4LiK4LmJ4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Liq4LiW4Liy4LiZ4LiwICJBY3RpdmUiCiAgICAgICAgZmlsZU9iamVjdC5zaG9ydGN1dElkID0gc2hvcnRjdXRJZDsgCgogICAgICAgIC8vICoq4LiI4Li44LiU4LmA4LiK4Li34LmI4Lit4Lih4LiV4LmI4Lit4LiX4Li14LmI4Liq4Liz4LiE4Lix4LiNOioqIOC4meC4syBGaWxlIG9iamVjdCDguYTguJvguYPguKrguYjguYPguJnguJXguLHguKfguYHguJvguKMgYHNlbGVjdGVkRmlsZWAKICAgICAgICAvLyDguYDguKrguKHguLfguK3guJnguKfguYjguLLguJzguLnguYnguYPguIrguYnguYDguJ7guLTguYjguIfguK3guLHguJvguYLguKvguKXguJTguYTguJ/guKXguYzguJnguLXguYnguJTguYnguKfguKLguJXguJnguYDguK3guIcKICAgICAgICBzZWxlY3RlZEZpbGUgPSBmaWxlT2JqZWN0OwogICAgICAgIAogICAgICAgIC8vIOC4reC4seC4m+C5gOC4lOC4lSBVSSDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJTguYDguJ7guLfguYjguK3guYHguKrguJTguIfguKrguJbguLLguJnguLAgIuC4nuC4o+C5ieC4reC4oeC5g+C4iuC5ieC4h+C4suC4mSIgKOC4quC4teC5gOC4guC4teC4ouC4pykKICAgICAgICByZW5kZXJGaWxlU2hvcnRjdXRzKCk7IAogICAgICAgIAogICAgICAgIC8vICoq4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiB4Lil4Liy4LiHKiog4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4Lif4Li14LmA4LiI4Lit4Lij4LmM4LmA4Liq4Lij4Li04Lih4LmB4Lil4Liw4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiCiAgICAgICAgYWN0aXZhdGVGaWxlSW5wdXRBcmVhV2l0aExvYWRlZEZpbGUoKTsKICAgICAgICAKICAgICAgICAvLyDguYDguKXguLfguYjguK3guJnguKvguJnguYnguLLguIjguK3guYTguJvguKLguLHguIfguKrguYjguKfguJkgIuC4iOC4suC4geC5hOC4n+C4peC5jCIg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4Lic4Li54LmJ4LmD4LiK4LmJ4LmA4Lir4LmH4LiZ4Lin4LmI4Liy4Lie4Lij4LmJ4Lit4Lih4LmB4Lil4LmJ4LinCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtaW5wdXQtYXJlYScpLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2NlbnRlcicgfSk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwcm9jZXNzaW5nIGZpbGUgc2hvcnRjdXQgY2xpY2s6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGDguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguYTguJ/guKXguYzguIjguLLguIHguKXguLTguIfguIHguYw6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICByZW5kZXJGaWxlU2hvcnRjdXRzKCk7IC8vIOC4hOC4t+C4meC4hOC5iOC4siBVSSDguILguK3guIfguJvguLjguYjguKHguYDguJvguYfguJnguJvguIHguJXguLTguKvguLLguIHguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQKICAgIH0gZmluYWxseSB7CiAgICAgICAgLy8g4LmA4Lib4Li04LiU4LiB4Liy4Lij4LmD4LiK4LmJ4LiH4Liy4LiZ4Lib4Li44LmI4Lih4Lit4Li34LmI4LiZ4LiB4Lil4Lix4Lia4Lih4LiyCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtc2hvcnRjdXQtYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS01MCcsICdwb2ludGVyLWV2ZW50cy1ub25lJyk7CiAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfQp9CgpmdW5jdGlvbiBwYXJzZVBhZ2VTZWxlY3Rpb24oaW5wdXQsIG1heFBhZ2VzKSB7CiAgICBpZiAoIWlucHV0IHx8IGlucHV0LnRyaW0oKSA9PT0gJycpIHJldHVybiBudWxsOyAvLyBudWxsID0g4LmA4Lit4Liy4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAKICAgIGNvbnN0IHBhZ2VzID0gbmV3IFNldCgpOwogICAgY29uc3QgcGFydHMgPSBpbnB1dC5zcGxpdCgnLCcpOwogICAgCiAgICBwYXJ0cy5mb3JFYWNoKHBhcnQgPT4gewogICAgICAgIHBhcnQgPSBwYXJ0LnRyaW0oKTsKICAgICAgICBpZiAocGFydC5pbmNsdWRlcygnLScpKSB7CiAgICAgICAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHBhcnQuc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgaWYgKCFpc05hTihzdGFydCkgJiYgIWlzTmFOKGVuZCkpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBNYXRoLm1pbihzdGFydCwgZW5kKTsgaSA8PSBNYXRoLm1heChzdGFydCwgZW5kKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPj0gMSAmJiBpIDw9IG1heFBhZ2VzKSBwYWdlcy5hZGQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBudW0gPSBOdW1iZXIocGFydCk7CiAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPj0gMSAmJiBudW0gPD0gbWF4UGFnZXMpIHsKICAgICAgICAgICAgICAgIHBhZ2VzLmFkZChudW0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgIC8vIOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC4iOC4suC4geC4meC5ieC4reC4ouC5hOC4m+C4oeC4suC4gQogICAgcmV0dXJuIEFycmF5LmZyb20ocGFnZXMpLnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKfQoKLyoqCiAqIFvguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYhdIOC4quC4o+C5ieC4suC4h+C5hOC4n+C4peC5jCBQREYg4LmD4Lir4Lih4LmI4LiX4Li14LmI4Lih4Li14LmA4LiJ4Lie4Liy4Liw4Lir4LiZ4LmJ4Liy4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBIChSZW5kZXIgdG8gSW1hZ2UgLT4gUERGKQogKi8KYXN5bmMgZnVuY3Rpb24gY3JlYXRlUGRmRnJvbVNlbGVjdGVkUGFnZXMoZmlsZSwgc2VsZWN0ZWRQYWdlcykgewogICAgLy8g4LmD4LiK4LmJIGpzUERGIOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C5g+C4meC5guC4m+C4o+C5gOC4iOC4hAogICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgCiAgICAvLyDguK3guYjguLLguJnguYTguJ/guKXguYwgUERGIOC4leC5ieC4meC4ieC4muC4seC4mgogICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7CiAgICBjb25zdCBwZGYgPSBhd2FpdCBwZGZqc0xpYi5nZXREb2N1bWVudChhcnJheUJ1ZmZlcikucHJvbWlzZTsKICAgIAogICAgY29uc3QgbmV3UGRmID0gbmV3IGpzUERGKCk7CiAgICBjb25zdCB0b3RhbFNlbGVjdGVkID0gc2VsZWN0ZWRQYWdlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbFNlbGVjdGVkOyBpKyspIHsKICAgICAgICBjb25zdCBwYWdlTnVtID0gc2VsZWN0ZWRQYWdlc1tpXTsKICAgICAgICAKICAgICAgICAvLyDguYHguIjguYnguIfguKrguJbguLLguJnguLDguIHguLLguKPguJXguLHguJTguJXguYjguK0KICAgICAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CiAgICAgICAgaWYgKGxvYWRlclRleHQpIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4LmA4LiV4Lij4Li14Lii4Lih4Lir4LiZ4LmJ4LiyIFBERjog4Lir4LiZ4LmJ4Liy4LiX4Li14LmIICR7cGFnZU51bX0uLi5gOwoKICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmLmdldFBhZ2UocGFnZU51bSk7CiAgICAgICAgCiAgICAgICAgLy8g4LiB4Liz4Lir4LiZ4LiU4LiE4Li44LiT4Lig4Liy4LieIChTY2FsZSAxLjUgPSDguIrguLHguJTguIHguLPguKXguLHguIfguJTguLUg4LmE4Lih4LmI4LmD4Lir4LiN4LmI4LmA4LiB4Li04LiZ4LmE4Lib4Liq4Liz4Lir4Lij4Lix4LiaIEFJKQogICAgICAgIGNvbnN0IHZpZXdwb3J0ID0gcGFnZS5nZXRWaWV3cG9ydCh7IHNjYWxlOiAxLjUgfSk7CiAgICAgICAgCiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiHIENhbnZhcyDguYDguJ7guLfguYjguK3guKfguLLguJTguKvguJnguYnguLIgUERGIOC5gOC4m+C5h+C4meC4o+C4ueC4m+C4oOC4suC4ngogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0OwogICAgICAgIGNhbnZhcy53aWR0aCA9IHZpZXdwb3J0LndpZHRoOwoKICAgICAgICBhd2FpdCBwYWdlLnJlbmRlcih7IGNhbnZhc0NvbnRleHQ6IGNvbnRleHQsIHZpZXdwb3J0OiB2aWV3cG9ydCB9KS5wcm9taXNlOwogICAgICAgIAogICAgICAgIC8vIOC5geC4m+C4peC4h+C5gOC4m+C5h+C4meC4o+C4ueC4m+C4oOC4suC4niBKUEVHICjguILguJnguLLguJTguYDguKXguYfguIHguIHguKfguYjguLIgUE5HKQogICAgICAgIGNvbnN0IGltZ0RhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMC44KTsKICAgICAgICAKICAgICAgICAvLyDguYDguJ7guLTguYjguKHguKvguJnguYnguLLguYPguJkgUERGIOC5g+C4q+C4oeC5iAogICAgICAgIGlmIChpID4gMCkgbmV3UGRmLmFkZFBhZ2UoKTsKICAgICAgICAKICAgICAgICAvLyDguITguLPguJnguKfguJPguILguJnguLLguJTguYPguKvguYnguJ7guK3guJTguLXguKvguJnguYnguLIgQTQg4LmD4LiZIFBERiDguYPguKvguKHguYgKICAgICAgICBjb25zdCBwZGZQYWdlV2lkdGggPSBuZXdQZGYuaW50ZXJuYWwucGFnZVNpemUuZ2V0V2lkdGgoKTsKICAgICAgICBjb25zdCBwZGZQYWdlSGVpZ2h0ID0gbmV3UGRmLmludGVybmFsLnBhZ2VTaXplLmdldEhlaWdodCgpOwogICAgICAgIGNvbnN0IGltZ1Byb3BzID0gbmV3UGRmLmdldEltYWdlUHJvcGVydGllcyhpbWdEYXRhKTsKICAgICAgICBjb25zdCByYXRpbyA9IGltZ1Byb3BzLndpZHRoIC8gaW1nUHJvcHMuaGVpZ2h0OwogICAgICAgIGNvbnN0IHBkZlJhdGlvID0gcGRmUGFnZVdpZHRoIC8gcGRmUGFnZUhlaWdodDsKICAgICAgICAKICAgICAgICBsZXQgZmluYWxXLCBmaW5hbEg7CiAgICAgICAgaWYgKHJhdGlvID4gcGRmUmF0aW8pIHsKICAgICAgICAgICAgZmluYWxXID0gcGRmUGFnZVdpZHRoOwogICAgICAgICAgICBmaW5hbEggPSBwZGZQYWdlV2lkdGggLyByYXRpbzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaW5hbEggPSBwZGZQYWdlSGVpZ2h0OwogICAgICAgICAgICBmaW5hbFcgPSBwZGZQYWdlSGVpZ2h0ICogcmF0aW87CiAgICAgICAgfQoKICAgICAgICBuZXdQZGYuYWRkSW1hZ2UoaW1nRGF0YSwgJ0pQRUcnLCAwLCAwLCBmaW5hbFcsIGZpbmFsSCk7CiAgICB9CgogICAgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4Lib4LmH4LiZIEJhc2U2NCBzdHJpbmcgKOC4leC4seC4lCBwcmVmaXggZGF0YSB1cmkg4Lit4Lit4LiBKQogICAgY29uc3QgcGRmT3V0cHV0ID0gbmV3UGRmLm91dHB1dCgnZGF0YXVyaXN0cmluZycpOwogICAgcmV0dXJuIHBkZk91dHB1dC5zcGxpdCgnLCcpWzFdOwp9Cgphc3luYyBmdW5jdGlvbiBlbnN1cmVHbG9iYWxRdWl6emVzTG9hZGVkKCkgewogICAgaWYgKGFsbFF1aXp6ZXNHbG9iYWwubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybjsgLy8g4LiW4LmJ4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC4geC5h+C5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4owogICAgfQoKICAgIGNvbnNvbGUubG9nKCJHbG9iYWwgcXVpeiBjYWNoZSBpcyBlbXB0eS4gRmV0Y2hpbmcgbm93Li4uIik7CiAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiU4LiE4Lil4Lix4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiULi4uIik7IC8vIOC5geC4iOC5ieC4h+C5g+C4q+C5ieC4nOC4ueC5ieC5g+C4iuC5ieC4l+C4o+C4suC4mgogICAgdHJ5IHsKICAgICAgICBjb25zdCBxcyA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCkpOwogICAgICAgIGFsbFF1aXp6ZXNHbG9iYWwgPSBxcy5kb2NzLm1hcChkID0+ICh7IGlkOiBkLmlkLCAuLi5kLmRhdGEoKSB9KSk7CiAgICAgICAgY29uc29sZS5sb2coYExvYWRlZCAke2FsbFF1aXp6ZXNHbG9iYWwubGVuZ3RofSBxdWl6emVzIGludG8gZ2xvYmFsIGNhY2hlLmApOwogICAgICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4LihICLguIHguLPguKXguLHguIfguYLguKvguKXguJQuLi4iIOC5gOC4oeC4t+C5iOC4reC5gOC4quC4o+C5h+C4iAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYXRhbDogQ291bGQgbm90IGZldGNoIGdsb2JhbCBxdWl6emVzLiIsIGVycm9yKTsKICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgLy8g4LmC4Lii4LiZIGVycm9yIOC4reC4reC4geC5hOC4m+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4teC5iOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4o+C4ueC5ieC4p+C5iOC4suC4peC5ieC4oeC5gOC4q+C4peC4pwogICAgICAgIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmC4Lir4Lil4LiU4LiE4Lil4Lix4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LmE4LiU4LmJIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGV4cG9ydFF1aXpBc1dvcmtzaGVldFBERigpIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C5g+C4muC4h+C4suC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBxdWl6RGF0YSA9IGN1cnJlbnRRdWl6RGF0YTsKICAgIGNvbnN0IHdvcmtzaGVldFdpbmRvdyA9IHdpbmRvdy5vcGVuKCcnLCAnX2JsYW5rJyk7CgogICAgY29uc3QgdG9FbmdDaGFyID0gKGluZGV4KSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOyAvLyA2NSDguITguLfguK3guKPguKvguLHguKrguILguK3guIcgJ0EnCgogICAgY29uc3Qgd29ya3NoZWV0SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPuC5geC4muC4muC4l+C4lOC4quC4reC4mjogJHtxdWl6RGF0YS50b3BpY308L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICAKICAgICAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4ID0geyB0ZXg6IHsgaW5saW5lTWF0aDogW1snJCcsICckJ10sIFsnXFxcXCgnLCAnXFxcXCknXV0gfSB9OwogICAgICAgICAgICA8XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzY3JpcHQgaWQ9Ik1hdGhKYXgtc2NyaXB0IiBhc3luYyBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbWF0aGpheEAzL2VzNS90ZXgtbW1sLWNodG1sLmpzIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgICAgIGJvZHkgeyAKICAgICAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ1NhcmFidW4nLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsgLyog4Lib4Lij4Lix4Lia4LiC4LiZ4Liy4LiU4Lit4Lix4LiB4Lip4Lij4LmD4Lir4LmJ4LmA4Lil4LmH4LiB4Lil4LiH4Lit4Li14LiB4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4Lii4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4LiB4Lij4Liw4LiK4Lix4LiaICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAbWVkaWEgcHJpbnQgewogICAgICAgICAgICAgICAgICAgIGJvZHkgeyAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3Q7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5xdWVzdGlvbi1pdGVtIHsgCiAgICAgICAgICAgICAgICAgICAgYnJlYWstaW5zaWRlOiBhdm9pZDsgLyog4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LmE4Lih4LmI4LmD4Lir4LmJ4LiC4LmJ4Lit4Liq4Lit4LiaIDEg4LiC4LmJ4Lit4LiW4Li54LiB4LiV4Lix4LiU4LmB4Lia4LmI4LiH4LiE4Lit4Lil4Lix4Lih4LiZ4LmMICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuYW5zd2VyLXNwYWNlIHsKICAgICAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggZG90dGVkIGJsYWNrOwogICAgICAgICAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDIycHg7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogOHB4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4pa84pa84pa8IENTUyDguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgMiDguITguK3guKXguLHguKHguJnguYwg4pa84pa84pa8ICovCiAgICAgICAgICAgICAgICAucXVpei1jb2x1bW5zIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW4tY291bnQ6IDI7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uLWdhcDogMnJlbTsgLyog4Lij4Liw4Lii4Liw4Lir4LmI4Liy4LiH4Lij4Liw4Lir4Lin4LmI4Liy4LiH4LiE4Lit4Lil4Lix4Lih4LiZ4LmMICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTYgbWF4LXctNXhsIG14LWF1dG8iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi02Ij4KICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC14bCBmb250LWJvbGQiPuC5geC4muC4muC4l+C4lOC4quC4reC4muC5gOC4o+C4t+C5iOC4reC4hzogJHtxdWl6RGF0YS50b3BpY308L2gxPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gbWItNiB0ZXh0LWJhc2UiPgogICAgICAgICAgICAgICAgPHA+4LiK4Li34LmI4LitLeC4quC4geC4uOC4pTogLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi48L3A+CiAgICAgICAgICAgICAgICA8cD7guYDguKXguILguJfguLXguYg6IC4uLi4uLi4uLi4uLi48L3A+CiAgICAgICAgICAgICAgICA8cD7guITguLDguYHguJnguJk6IC4uLi4uLi4uLi4uLi4uLi4uPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGhyIGNsYXNzPSJtYi00Ij4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1aXotY29sdW1ucyI+CiAgICAgICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHF1ZXN0aW9uQm9keSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHF1aXpEYXRhLnF1aXpUeXBlOwoKICAgICAgICAgICAgICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5gOC4m+C5h+C4mSAxIOC4hOC4reC4peC4seC4oeC4meC5jOC4oOC4suC4ouC5g+C4meC4guC5ieC4rSDguYHguJXguYjguILguYnguK3guKrguK3guJrguYLguJTguKLguKPguKfguKHguYDguJvguYfguJkgMiDguITguK3guKXguLHguKHguJnguYwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uQm9keSA9IGA8ZGl2IGNsYXNzPSJtdC0yIHNwYWNlLXktMSB0ZXh0LWJhc2UiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHt0b0VuZ0NoYXIoaSl9LiAke29wdH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCc8YnI+Jyl9PC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0ibXQtMiBzcGFjZS15LTEgdGV4dC1iYXNlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkEuIOC4luC4ueC4gTwvc3Bhbj48YnI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+Qi4g4Lic4Li04LiUPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogLy8g4Liq4Liz4Lir4Lij4Lix4Lia4LiC4LmJ4Lit4LmA4LiC4Li14Lii4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0iYW5zd2VyLXNwYWNlIj48L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyDilrzilrzilrwg4LmA4Lie4Li04LmI4LihIG1iLTUgKG1hcmdpbi1ib3R0b20pIOC5g+C4q+C5ieC5geC4leC5iOC4peC4sOC4guC5ieC4reC5gOC4nuC4t+C5iOC4reC5gOC4p+C5ieC4meC4o+C4sOC4ouC4sOC4q+C5iOC4suC4hyDilrzilrzilrwKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJxdWVzdGlvbi1pdGVtIG1iLTUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbXItMiI+JHtpbmRleCArIDF9LjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3EuaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3F1ZXN0aW9uQm9keX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgoJCQkKCQkJPGRpdiBpZD0iY3JvcHBlci1tb2RhbCIgY2xhc3M9ImZpeGVkIGluc2V0LTAgYmctYmxhY2sgYmctb3BhY2l0eS05MCB6LVs3MF0gaGlkZGVuIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHAtNCI+CiAgICA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSB3LWZ1bGwgbWF4LXctNHhsIGgtWzcwdmhdIGJnLWJsYWNrIj4KICAgICAgICA8aW1nIGlkPSJpbWFnZS10by1jcm9wIiBzcmM9IiIgY2xhc3M9Im1heC13LWZ1bGwgbWF4LWgtZnVsbCBibG9jayI+CiAgICA8L2Rpdj4KICAgIAogICAgPGRpdiBjbGFzcz0iZmxleCBnYXAtNCBtdC00Ij4KICAgICAgICA8YnV0dG9uIGlkPSJjYW5jZWwtY3JvcC1idG4iIGNsYXNzPSJiZy1ncmF5LTUwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyYXktNjAwIGZvbnQtYm9sZCI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiBCiAgICAgICAgPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlybS1jcm9wLWJ0biIgY2xhc3M9ImJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyZWVuLTcwMCBmb250LWJvbGQgc2hhZG93LWxnIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY3JvcC1hbHQiPjwvaT4g4LiV4Lix4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJICYg4Liq4LmB4LiB4LiZCiAgICAgICAgPC9idXR0b24+CiAgICA8L2Rpdj4KPC9kaXY+CgkJCQogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwoKICAgIHdvcmtzaGVldFdpbmRvdy5kb2N1bWVudC53cml0ZSh3b3Jrc2hlZXRIdG1sKTsKICAgIHdvcmtzaGVldFdpbmRvdy5kb2N1bWVudC5jbG9zZSgpOwogICAgd29ya3NoZWV0V2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB3b3Jrc2hlZXRXaW5kb3cucHJpbnQoKTsKICAgICAgICB9LCAxNTAwKTsKICAgIH07Cn0KCi8qKgogKiDguKrguKPguYnguLLguIfguKvguJnguYnguLIgSFRNTCDguKrguLPguKvguKPguLHguJrguJ7guLTguKHguJ7guYzguYHguJrguJrguJfguJTguKrguK3guJogKOC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4leC4tOC4p+C4guC5ieC4reC4quC4reC4miDguILguYnguK3guKXguLDguKvguJnguYnguLIpCiAqLwpmdW5jdGlvbiBleHBvcnRRdWl6QXNUdXRvclBERigpIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C5g+C4muC4h+C4suC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBxdWl6RGF0YSA9IGN1cnJlbnRRdWl6RGF0YTsKICAgIGNvbnN0IHdvcmtzaGVldFdpbmRvdyA9IHdpbmRvdy5vcGVuKCcnLCAnX2JsYW5rJyk7CiAgICBjb25zdCB0b0VuZ0NoYXIgPSAoaW5kZXgpID0+IFN0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBpbmRleCk7CgogICAgY29uc3Qgd29ya3NoZWV0SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPuC5gOC4reC4geC4quC4suC4o+C4leC4tOC4pzogJHtxdWl6RGF0YS50b3BpY308L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXggPSB7IHRleDogeyBpbmxpbmVNYXRoOiBbWyckJywgJyQnXSwgWydcXFxcKCcsICdcXFxcKSddXSB9IH07CiAgICAgICAgICAgIDxcL3NjcmlwdD4KICAgICAgICAgICAgPHNjcmlwdCBpZD0iTWF0aEpheC1zY3JpcHQiIGFzeW5jIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tYXRoamF4QDMvZXM1L3RleC1tbWwtY2h0bWwuanMiPjxcL3NjcmlwdD4KICAgICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2FyYWJ1bicsIHNhbnMtc2VyaWY7IH0KICAgICAgICAgICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4pa84pa84pa8IENTUyDguKrguLPguITguLHguI06IOC4quC4seC5iOC4h+C5g+C4q+C5ieC4guC4tuC5ieC4meC4q+C4meC5ieC4suC5g+C4q+C4oeC5iOC4q+C4peC4seC4h+C4iOC4muC5geC4leC5iOC4peC4sOC4guC5ieC4rSDilrzilrzilrwgKi8KICAgICAgICAgICAgICAgIC5wYWdlLWJyZWFrIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLWJyZWFrLWFmdGVyOiBhbHdheXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAucXVlc3Rpb24tY29udGFpbmVyIHsKICAgICAgICAgICAgICAgICAgICBtaW4taGVpZ2h0OiA5MHZoOyAvKiDguJfguLPguYPguKvguYnguYHguJXguYjguKXguLDguILguYnguK3guYDguJXguYfguKHguKvguJnguYnguLLguIHguKPguLDguJTguLLguKkgKi8KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTYgbWF4LXctNHhsIG14LWF1dG8iPgogICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcXVlc3Rpb25Cb2R5ID0gJyc7CiAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25Cb2R5ID0gYDxkaXYgY2xhc3M9Im10LTQgc3BhY2UteS0zIHRleHQteGwiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3RvRW5nQ2hhcihpKX0uICR7b3B0fTwvc3Bhbj5gKS5qb2luKCc8YnI+Jyl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0ibXQtNCBzcGFjZS15LTMgdGV4dC14bCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5BLiDguJbguLnguIE8L3NwYW4+PGJyPjxzcGFuPkIuIOC4nOC4tOC4lDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25Cb2R5ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2UtYnJlYWsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1ZXN0aW9uLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNTAwIj7guYHguJrguJrguJfguJTguKrguK3guJrguYDguKPguLfguYjguK3guIc6ICR7cXVpekRhdGEudG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCBtdC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIG1yLTMiPiR7aW5kZXggKyAxfS48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCI+JHtxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3EuaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTYiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3F1ZXN0aW9uQm9keX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgPC9ib2R5PgogICAgICAgIDwvaHRtbD4KICAgIGA7CiAgICB3b3Jrc2hlZXRXaW5kb3cuZG9jdW1lbnQud3JpdGUod29ya3NoZWV0SHRtbCk7CiAgICB3b3Jrc2hlZXRXaW5kb3cuZG9jdW1lbnQuY2xvc2UoKTsKICAgIHdvcmtzaGVldFdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgd29ya3NoZWV0V2luZG93LnByaW50KCk7IH0sIDE1MDApOwogICAgfTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVG9nZ2xlU3RhclF1aXoocXVpeklkKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBkaXNwbGF5UXVlc3Rpb25CYW5rKCkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbmstaW5wdXQtYXJlYScpOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+JzsgLy8g4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiUCgogICAgdHJ5IHsKICAgICAgICBjb25zdCBiYW5rQ29sbGVjdGlvblJlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vdXNlcnMvJHt1c2VySWR9L3F1ZXN0aW9uQmFua2ApOwogICAgICAgIGNvbnN0IHEgPSBxdWVyeShiYW5rQ29sbGVjdGlvblJlZik7IC8vIOC4quC4suC4oeC4suC4o+C4luC5gOC4nuC4tOC5iOC4oSBvcmRlckJ5IOC5hOC4lOC5ieC5g+C4meC4reC4meC4suC4hOC4lQogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgaWYgKHNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC4guC4reC4h+C4hOC4uOC4k+C4ouC4seC4h+C4p+C5iOC4suC4h+C4reC4ouC4ueC5iDwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBsZXQgcXVlc3Rpb25zSFRNTCA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiB7CiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uID0gZG9jLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25JZCA9IGRvYy5pZDsKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQgZ2FwLTMgcC0yIGJvcmRlci1iIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIHZhbHVlPScke0pTT04uc3RyaW5naWZ5KHF1ZXN0aW9uKX0nIGNsYXNzPSJtdC0xIGgtNCB3LTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke3F1ZXN0aW9uLnF1ZXN0aW9uVGV4dCB8fCBxdWVzdGlvbi5zdGVtfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+4LiI4Liy4LiB4LmA4Lij4Li34LmI4Lit4LiHOiAke3F1ZXN0aW9uLm9yaWdpbmFsVG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSkuam9pbignJyk7CgogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1heC1oLTYwIG92ZXJmbG93LXktYXV0byBib3JkZXIgcm91bmRlZC1sZyBwLTIiPiR7cXVlc3Rpb25zSFRNTH08L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY3JlYXRlLWZyb20tYmFuay1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctcHVycGxlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctcHVycGxlLTcwMCI+CiAgICAgICAgICAgICAgICDguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguIjguLLguIHguILguYnguK3guJfguLXguYjguYDguKXguLfguK3guIEKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgYDsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWF0ZS1mcm9tLWJhbmstYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjcmVhdGVRdWl6RnJvbUJhbmspOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGlzcGxheWluZyBxdWVzdGlvbiBiYW5rOiIsIGVycm9yKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXJlZC01MDAiPuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC5guC4q+C4peC4lOC4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC5hOC4lOC5iTwvcD4nOwogICAgfQp9CgovKioKICog4pyFIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iDog4Liq4Lij4LmJ4Liy4LiH4Lir4LiZ4LmJ4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Lie4Li04Lih4Lie4LmM4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LmA4Lib4LmH4LiZIFBERgogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRXhwb3J0TGVzc29uVG9QREYoKSB7CiAgICBjb25zdCBsZXNzb25Db250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVzc29uLXNlY3Rpb25zLWNvbnRhaW5lciIpOwogICAgY29uc3QgbGVzc29uVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctdGl0bGUnKS50ZXh0Q29udGVudCB8fCAn4Lia4LiX4LmA4Lij4Li14Lii4LiZJzsKCiAgICBpZiAoIWxlc3NvbkNvbnRlbnRFbCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguYDguJnguLfguYnguK3guKvguLLguJrguJfguYDguKPguLXguKLguJnguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC5gOC4m+C4tOC4lOC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5g+C4q+C4oeC5iOC5gOC4nuC4t+C5iOC4reC5gOC4leC4o+C4teC4ouC4oeC4nuC4tOC4oeC4nuC5jAogICAgY29uc3QgcHJpbnRXaW5kb3cgPSB3aW5kb3cub3BlbignJywgJ19ibGFuaycpOwoKICAgIC8vIOC4quC4o+C5ieC4suC4h+C5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4hyBIVE1MIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4muC4q+C4meC5ieC4suC4l+C4teC5iOC4iOC4sOC4nuC4tOC4oeC4nuC5jAogICAgY29uc3QgcHJpbnRIdG1sID0gYAogICAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICAgIDxodG1sIGxhbmc9InRoIj4KICAgICAgICA8aGVhZD4KICAgICAgICAgICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgICAgICAgICA8dGl0bGU+JHtsZXNzb25UaXRsZX08L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2ZvbnQtYXdlc29tZS82LjUuMS9jc3MvYWxsLm1pbi5jc3MiPgoKICAgICAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4ID0gewogICAgICAgICAgICAgICAgICAgIHRleDogeyBpbmxpbmVNYXRoOiBbWyckJywgJyQnXSwgWydcXFxcKCcsICdcXFxcKSddXSB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICA8XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzY3JpcHQgaWQ9Ik1hdGhKYXgtc2NyaXB0IiBhc3luYyBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbWF0aGpheEAzL2VzNS90ZXgtbW1sLWNodG1sLmpzIj48XC9zY3JpcHQ+CgogICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdTYXJhYnVuJywgc2Fucy1zZXJpZjsgfQogICAgICAgICAgICAgICAgQG1lZGlhIHByaW50IHsKICAgICAgICAgICAgICAgICAgICBib2R5IHsgLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6IGV4YWN0OyB9CiAgICAgICAgICAgICAgICAgICAgLm5vLXByaW50IHsgZGlzcGxheTogbm9uZTsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4LiE4Lix4LiU4Lil4Lit4LiBIFN0eWxlIOC4l+C4teC5iOC4iOC4s+C5gOC4m+C5h+C4meC4oeC4suC4iOC4suC4geC4q+C4meC5ieC4suC4q+C4peC4seC4geC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBQREYg4Liq4Lin4Lii4LiH4Liy4LihICovCiAgICAgICAgICAgICAgICAuYWktY29udGVudCB7IHBhZ2UtYnJlYWstaW5zaWRlOiBhdm9pZDsgfQogICAgICAgICAgICAgICAgLmFpLWNvbnRlbnQgaDEsIC5haS1jb250ZW50IGgyLCAuYWktY29udGVudCBoMywgLmFpLWNvbnRlbnQgaDQgeyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogIzFlM2E4YTsgbWFyZ2luLXRvcDogMS41cmVtOyBtYXJnaW4tYm90dG9tOiAwLjc1cmVtOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCBibG9ja3F1b3RlIHsgYmFja2dyb3VuZC1jb2xvcjogI2VmZjZmZjsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjM2I4MmY2OyBwYWRkaW5nOiAwLjc1cmVtIDFyZW07IG1hcmdpbjogMXJlbSAwOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCB0YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCB0aCwgLmFpLWNvbnRlbnQgdGQgeyBib3JkZXI6IDFweCBzb2xpZCAjZTJlOGYwOyBwYWRkaW5nOiAwLjVyZW0gMXJlbTsgfQogICAgICAgICAgICAgICAgLmFpLWNvbnRlbnQgdGggeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmY2U4OyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCBzdmcgeyBtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgZGlzcGxheTogYmxvY2s7IG1hcmdpbjogMXJlbSBhdXRvOyB9CiAgICAgICAgICAgICAgICAuc2VjdGlvbi1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBmb250LXNpemU6IDEuNXJlbTsgZm9udC13ZWlnaHQ6IDcwMDsgbWFyZ2luLWJvdHRvbTogMXJlbTsgY29sb3I6ICMxZTNhOGE7IGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZGJlYWZlOyBwYWRkaW5nLWJvdHRvbTogMC41cmVtOyB9CiAgICAgICAgICAgICAgICAuc2VjdGlvbi1oZWFkZXIgaSB7IG1hcmdpbi1yaWdodDogMC43NXJlbTsgY29sb3I6ICMzYjgyZjY7IH0KICAgICAgICAgICAgPC9zdHlsZT4KICAgICAgICA8L2hlYWQ+CiAgICAgICAgPGJvZHkgY2xhc3M9InAtOCBtYXgtdy00eGwgbXgtYXV0byI+CiAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIG1iLTgiPiR7bGVzc29uVGl0bGV9PC9oMT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWktY29udGVudCI+CiAgICAgICAgICAgICAgICAke2xlc3NvbkNvbnRlbnRFbC5pbm5lckhUTUx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwoKICAgIC8vIOC5gOC4guC4teC4ouC4mSBIVE1MIOC4peC4h+C5g+C4meC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5g+C4q+C4oeC5iAogICAgcHJpbnRXaW5kb3cuZG9jdW1lbnQud3JpdGUocHJpbnRIdG1sKTsKICAgIHByaW50V2luZG93LmRvY3VtZW50LmNsb3NlKCk7CgogICAgLy8g4Lij4Lit4LmD4Lir4LmJ4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4LmB4Lil4LiwIE1hdGhKYXgg4LmC4Lir4Lil4LiU4LmA4Liq4Lij4LmH4LiIIOC5geC4peC5ieC4p+C4hOC5iOC4reC4ouC4quC4seC5iOC4h+C4nuC4tOC4oeC4nuC5jAogICAgcHJpbnRXaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHByaW50V2luZG93LnByaW50KCk7CiAgICAgICAgfSwgMjAwMCk7IC8vIOC4q+C4meC5iOC4p+C4h+C5gOC4p+C4peC4siAyIOC4p+C4tOC4meC4suC4l+C4teC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4quC4ueC4leC4o+C4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jOC5geC4quC4lOC4h+C4nOC4peC4quC4oeC4muC4ueC4o+C4k+C5jAogICAgfTsKfQoKZnVuY3Rpb24gc2hvd0FkbWluTGl2ZVF1ZXN0aW9uVmlldyhxdWVzdGlvbiwgaW5kZXgsIHRvdGFsKSB7CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CgogICAgaWYocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IFsn4LmD4LiK4LmIJywgJ+C5hOC4oeC5iOC5g+C4iuC5iCddIDogcXVlc3Rpb24ub3B0aW9uczsKICAgICAgICBjb25zdCBjb3JyZWN0SW5kZXggPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IChxdWVzdGlvbi5jb3JyZWN0QW5zd2VyID8gMCA6IDEpIDogcXVlc3Rpb24uY29ycmVjdEFuc3dlckluZGV4OwoKICAgICAgICBvcHRpb25zSFRNTCA9IG9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IHJvdW5kZWQtbGcgdGV4dC14bCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciBiZy13aGl0ZS8zMCIgZGF0YS1pcy1jb3JyZWN0PSIke2kgPT09IGNvcnJlY3RJbmRleH0iPgogICAgICAgICAgICAgICAgJHtvcHR9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGApLmpvaW4oJycpOwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvbi5hbGxSZXNwb25zZXMgfHwgW107CiAgICAgICAgb3B0aW9uc0hUTUwgPSBvcHRpb25zLm1hcChvcHQgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGJnLXdoaXRlLzMwIiBkYXRhLWlzLWNvcnJlY3Q9IiR7b3B0ID09PSBxdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2V9Ij4KICAgICAgICAgICAgICAgICR7b3B0fQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKICAgIH0KCiAgICBjb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcXVlc3Rpb24uc3RlbSB8fCBxdWVzdGlvbi5xdWVzdGlvblRleHQ7CiAgICAKICAgIGNvbnN0IGFkbWluUXVlc3Rpb25IVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImxpdmUtZ2FtZS1iZyB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHRleHQtbGciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuPuC4guC5ieC4reC4l+C4teC5iCAke2luZGV4ICsgMX0gLyAke3RvdGFsfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmctd2hpdGUvMjAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LWJhc2UgZm9udC1tb25vIiB0aXRsZT0i4Lij4Lir4Lix4Liq4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmA4LiB4LihIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1rZXkgbXItMiBvcGFjaXR5LTcwIj48L2k+JHtjdXJyZW50TGl2ZUdhbWVQaW59CiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4leC4reC4muC5geC4peC5ieC4pzogPHNwYW4gaWQ9ImFuc3dlci1jb3VudGVyIiBjbGFzcz0iZm9udC1ib2xkIj4wLzA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im1hbmFnZS1wbGF5ZXJzLWJ0biIgY2xhc3M9InRleHQteHMgYmctd2hpdGUvMjAgaG92ZXI6Ymctd2hpdGUvNDAgcHgtMiBweS0xIHJvdW5kZWQtbWQiPuC4iOC4seC4lOC4geC4suC4o+C4nOC4ueC5ieC5gOC4peC5iOC4mTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJlbmQtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIj7guIjguJrguYDguIHguKE8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLXBsYXllci1tYW5hZ2VtZW50IiBjbGFzcz0iaGlkZGVuIHctZnVsbCBtYXgtdy1sZyBteC1hdXRvIGJnLWJsYWNrLzIwIHAtMiByb3VuZGVkLWxnIG10LTIgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBtYi0xIj7guJzguLnguYnguYDguKXguYjguJnguJfguLXguYjguKLguLHguIfguK3guKLguLnguYjguYPguJnguYDguIHguKE8L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLXBsYXllci1saXN0IiBjbGFzcz0iZmxleCBmbGV4LXdyYXAganVzdGlmeS1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi04IHRleHQtY2VudGVyIj4ke3F1ZXN0aW9uRGlzcGxheVRleHR9PC9oMj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy00eGwgZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgJHtvcHRpb25zSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0iYWRtaW4tYWN0aW9uLWJ1dHRvbnMiIGNsYXNzPSJ0ZXh0LWNlbnRlciBtdC04Ij4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InJldmVhbC1hbnN3ZXItYnRuIiBjbGFzcz0iYmcteWVsbG93LTUwMCBob3ZlcjpiZy15ZWxsb3ctNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQtMnhsIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV5ZSI+PC9pPiDguYDguInguKXguKIKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGFkbWluUXVlc3Rpb25IVE1MOwogICAgCiAgICBpZiAod2luZG93Lk1hdGhKYXggJiYgTWF0aEpheC50eXBlc2V0UHJvbWlzZSkgeyBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtsaXZlR2FtZVZpZXddKTsgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZlYWwtYW5zd2VyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmV2ZWFsQW5zd2VyRm9yQWRtaW4oaW5kZXgsIHRvdGFsKSk7CiAgICAKICAgIC8vIC0tLSBbU1RBUlRdIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmQtZ2FtZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAvLyDguYDguJ7guLTguYjguKHguIHguLLguKPguKLguLfguJnguKLguLHguJnguIHguYjguK3guJnguIjguJrguYDguIHguKEg4LmA4Lie4Li34LmI4Lit4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LiB4LiU4Lie4Lil4Liy4LiUCiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgJ+C4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4muC5gOC4geC4oeC4meC4teC5ieC4geC5iOC4reC4meC5gOC4p+C4peC4suC4reC4seC4meC4hOC4p+C4oz8nLAogICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4iOC4suC4geC4geC4suC4o+C4peC4miDguYDguJvguYfguJnguIHguLLguKPguK3guLHguJvguYDguJTguJXguKrguJbguLLguJnguLDguYPguKvguYnguYDguJvguYfguJkgJ3BvZGl1bScKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfSk7CiAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW5hZ2UtcGxheWVycy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZS1wbGF5ZXItbWFuYWdlbWVudCcpLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpOwogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CgovKioKICogW+C5g+C4q+C4oeC5iF0g4LmB4Liq4LiU4LiHIE1vZGFsIOC5g+C4q+C5ieC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4geC5iOC4reC4meC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4iOC4suC4gSBCbHVlcHJpbnQKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljTmFtZSAtIOC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4iOC4sOC5g+C4iuC5ieC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgogKi8KZnVuY3Rpb24gcHJvbXB0Rm9yUHJvamVjdEJlZm9yZUdlbmVyYXRpbmcodG9waWNOYW1lKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsgLy8g4LmA4Lij4Liy4LiI4Liw4LmD4LiK4LmJIE1vZGFsIOC4guC4reC4h+C4geC4suC4oyAi4Lii4LmJ4Liy4LiiIiDguKHguLLguJvguKPguLDguKLguLjguIHguJXguYzguYPguIrguYkKICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LXByb2plY3Qtc2VsZWN0Jyk7CiAgICBjb25zdCBtb2RhbFRpdGxlID0gbW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CiAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1vdmUtcXVpei1idG4nKTsKCiAgICAvLyAxLiDguYDguJvguKXguLXguYjguKLguJnguILguYnguK3guITguKfguLLguKHguYPguJkgTW9kYWwg4LmD4Lir4LmJ4LmA4Lir4Lih4Liy4Liw4Liq4Lih4LiB4Lix4Lia4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4LiE4Lin4Li04LiLCiAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC5geC4muC4muC4l+C4lOC4quC4reC4mic7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5geC4peC4sOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4hyc7CiAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsgLy8g4Lib4Li04LiU4Lib4Li44LmI4Lih4LmE4Lin4LmJ4LiB4LmI4Lit4LiZ4LiI4LiZ4LiB4Lin4LmI4Liy4LiI4Liw4LmA4Lil4Li34Lit4LiBCgogICAgLy8gMi4g4LmB4Liq4LiU4LiH4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiE4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Li14LmI4Lih4Li14LmD4LiZ4Lij4Liw4Lia4LiaCiAgICBpZiAoYWxsUHJvamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guKLguLHguIfguYTguKHguYjguKHguLXguYLguJvguKPguYDguIjguITguYPguKvguYnguYDguKXguLfguK3guIE8L29wdGlvbj4nOwogICAgfSBlbHNlIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKwogICAgICAgICAgICBhbGxQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLyAzLiDguYHguKrguJTguIcgTW9kYWwKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIDQuIOC4quC4o+C5ieC4suC4hyBFdmVudCBMaXN0ZW5lciDguJfguLXguYjguIjguLDguJfguLPguIfguLLguJnguYHguITguYjguITguKPguLHguYnguIfguYDguJTguLXguKLguKfguKrguLPguKvguKPguLHguJrguJvguLjguYjguKEgIuC4ouC4t+C4meC4ouC4seC4mSIKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4miBjb25maXJtSGFuZGxlciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmNvbnN0IGNvbmZpcm1IYW5kbGVyID0gYXN5bmMgKCkgPT4geyAvLyA8LS0tIOC5gOC4nuC4tOC5iOC4oSBhc3luYyDguYDguILguYnguLLguYTguJsKICAgIGNvbnN0IHNlbGVjdGVkUHJvamVjdElkID0gcHJvamVjdFNlbGVjdC52YWx1ZTsKICAgIGlmICghc2VsZWN0ZWRQcm9qZWN0SWQpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LiB4LmI4Lit4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJkKICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIDEuICjguYDguJ7guLTguYjguKEpIOC5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC5gOC4peC4t+C4reC4gQogICAgYXdhaXQgbG9hZFByb2plY3REZXRhaWxzKHNlbGVjdGVkUHJvamVjdElkKTsKCiAgICAvLyAyLiAo4LmA4Lie4Li04LmI4LihKSDguKrguLHguYjguIfguYPguKvguYnguYDguJvguKXguLXguYjguKLguJnguYTguJvguYHguKrguJTguIfguKvguJnguYnguLIgIuC4o+C4suC4ouC4peC4sOC5gOC4reC4teC4ouC4lOC5guC4m+C4o+C5gOC4iOC4hCIKICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwoKICAgIC8vIDMuIOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miAo4LiL4Li24LmI4LiH4LiV4Lit4LiZ4LiZ4Li14LmJ4LiI4Liw4LmB4Liq4LiU4LiH4Lic4Lil4LmD4LiZ4Lir4LiZ4LmJ4Liy4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmB4Lil4LmJ4LinKQogICAgaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljKHRvcGljTmFtZSk7CgogICAgLy8gNC4g4LiE4Li34LiZ4LiE4LmI4LiyIE1vZGFsIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4m+C4geC4leC4tAogICAgY2xlYW51cCgpOwp9OwovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LmC4LiE4LmJ4LiU4Liq4Liz4Lir4Lij4Lix4Lia4Lin4Liy4LiH4LiX4Lix4LiaIOKWsuKWsuKWsgoKICAgIC8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4hOC4t+C4meC4hOC5iOC4siBNb2RhbCDguYHguKXguLDguKXguJogRXZlbnQgTGlzdGVuZXIg4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LiC4Li24LmJ4LiZ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCiAgICBjb25zdCBjbGVhbnVwID0gKCkgPT4gewogICAgICAgIG1vZGFsVGl0bGUudGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4Lii4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmE4Lib4LmC4Lib4Lij4LmA4LiI4LiE4Lit4Li34LmI4LiZJzsKICAgICAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4oic7CiAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1IYW5kbGVyKTsKICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKICAgICAgICAvLyAqKuC4quC4s+C4hOC4seC4jToqKiDguITguLfguJnguITguYjguLIgRXZlbnQgTGlzdGVuZXIg4LmA4LiU4Li04Lih4LiC4Lit4LiH4Lib4Li44LmI4LihICLguKLguLfguJnguKLguLHguJkiIOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4l+C4s+C4h+C4suC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oQogICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtTW92ZVF1aXopOwogICAgfTsKICAgIAogICAgLy8gKirguKrguLPguITguLHguI06Kiog4LmA4Lij4Liy4LiV4LmJ4Lit4LiH4Lil4LiaIExpc3RlbmVyIOC5gOC4geC5iOC4suC4guC4reC4h+C4m+C4uOC5iOC4oSAi4Lii4Li34LiZ4Lii4Lix4LiZIiAoY29uZmlybU1vdmVRdWl6KSDguK3guK3guIHguYTguJvguIHguYjguK3guJnguIrguLHguYjguKfguITguKPguLLguKcKICAgIC8vIOC5gOC4nuC4t+C5iOC4reC4m+C5ieC4reC4h+C4geC4seC4meC5hOC4oeC5iOC5g+C4q+C5ieC5guC4hOC5ieC4lOC4l+C4s+C4h+C4suC4meC4i+C5ieC4s+C4i+C5ieC4reC4meC4geC4seC4mQogICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1Nb3ZlUXVpeik7CiAgICAKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBMaXN0ZW5lciDguYPguKvguKHguYjguYDguILguYnguLLguYTguJsKICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtSGFuZGxlcik7CiAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gc2hvd1N0dWRlbnRMaXZlUXVlc3Rpb25WaWV3KHF1ZXN0aW9uLCBpbmRleCwgdG90YWwpIHsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgb3B0aW9uc0hUTUwgPSAnJzsKCiAgICAgICAgICAgIGlmKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScgfHwgcXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IFsn4LmD4LiK4LmIJywgJ+C5hOC4oeC5iOC5g+C4iuC5iCddIDogcXVlc3Rpb24ub3B0aW9uczsKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gb3B0aW9ucy5tYXAoKG9wdCwgaSkgPT4gYAogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pbmRleD0iJHtpfSIgY2xhc3M9ImxpdmUtYW5zd2VyLWJ0biBwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIHRleHQtY2VudGVyIGJnLXdoaXRlIHRleHQtZ3JheS04MDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvcHR9CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgeyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Liq4LmI4Lin4LiZ4LiZ4Li14LmJCiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gcXVlc3Rpb24uYWxsUmVzcG9uc2VzIHx8IFtdOwogICAgICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBvcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWluZGV4PSIke2l9IiBjbGFzcz0ibGl2ZS1hbnN3ZXItYnRuIHAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRyYW5zaXRpb24tYWxsIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUiPgogICAgICAgICAgICAgICAgICAgICAgICAke29wdH0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIGApLmpvaW4oJycpOwoJCQkJfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInKSB7IC8vIDwtLSDguYDguJ7guLTguYjguKHguKrguYjguKfguJnguJnguLXguYkKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJsaXZlLXNob3J0LWFuc3dlci1pbnB1dCIgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBwLTMgYm9yZGVyIHJvdW5kZWQtbGcgdGV4dC1ncmF5LTgwMCB0ZXh0LWxnIiByb3dzPSIzIiBwbGFjZWhvbGRlcj0i4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTLi4uIj48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJsaXZlLXN1Ym1pdC1zaG9ydC1hbnN3ZXItYnRuIiBjbGFzcz0iYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LXhsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUgbXItMiI+PC9pPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgIH0KCgkJCQljb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcXVlc3Rpb24uc3RlbSB8fCBxdWVzdGlvbi5xdWVzdGlvblRleHQ7IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKICAgIGNvbnN0IHN0dWRlbnRRdWVzdGlvbkhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwiPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyB0ZXh0LWNlbnRlciI+4LiC4LmJ4Lit4LiX4Li14LmIICR7aW5kZXggKyAxfSAvICR7dG90YWx9PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItOCB0ZXh0LWNlbnRlciI+JHtxdWVzdGlvbkRpc3BsYXlUZXh0fTwvaDI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLW9wdGlvbnMtY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIG1heC13LTR4bCBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAke29wdGlvbnNIVE1MfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBzdHVkZW50UXVlc3Rpb25IVE1MOwoKICAgIAogICAgLy8gVHlwZXNldCBtYXRoIGFmdGVyIGluamVjdGluZyBzdHVkZW50IGxpdmUgcXVlc3Rpb24KICAgIGlmICh3aW5kb3cuTWF0aEpheCAmJiBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKSB7IE1hdGhKYXgudHlwZXNldFByb21pc2UoW2xpdmVHYW1lVmlld10pOyB9CgkKCSAvLyAtLS0gWyDguYDguKPguLTguYjguKEgXSDguYDguJ7guLTguYjguKHguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguILguYnguLLguYTguJsgLS0tCiAgICBjb25zdCBzdWJtaXRTaG9ydEFuc3dlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLXN1Ym1pdC1zaG9ydC1hbnN3ZXItYnRuJyk7CiAgICBpZiAoc3VibWl0U2hvcnRBbnN3ZXJCdG4pIHsKICAgICAgICBzdWJtaXRTaG9ydEFuc3dlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgYW5zd2VyVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLXNob3J0LWFuc3dlci1pbnB1dCcpLnZhbHVlOwogICAgICAgICAgICBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlclRleHQsIHF1ZXN0aW9uKTsgLy8g4Liq4LmI4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4Lie4Li04Lih4Lie4LmM4LmE4Lib4LiI4Lix4LiU4LiB4Liy4Lij4LiV4LmI4LitCiAgICAgICAgfSk7CiAgICB9CiAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJQgXSDguYDguJ7guLTguYjguKHguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguILguYnguLLguYTguJsgLS0tCgkKLy8gQWRkIGV2ZW50IGxpc3RlbmVyIGZvciBzdHVkZW50IGFuc3dlcnMKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLW9wdGlvbnMtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgIGNvbnN0IGJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5saXZlLWFuc3dlci1idG4nKTsKICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckluZGV4ID0gcGFyc2VJbnQoYnRuLmRhdGFzZXQuaW5kZXgpOwogICAgICAgICAgICBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlckluZGV4LCBxdWVzdGlvbik7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJTguJnguLXguYnguYDguILguYnguLLguYTguJvguYPguJkgPHNjcmlwdD4g4pa84pa84pa8CgovKioKICogW1Nob3J0Y3V0c10g4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiBIEZpcmVzdG9yZQogKi8KZnVuY3Rpb24gbGlzdGVuRm9yQmx1ZXByaW50U2hvcnRjdXRzKCkgewogICAgY29uc3Qgc2hvcnRjdXRzUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZGFzaGJvYXJkQ29uZmlnIik7CgogICAgb25TbmFwc2hvdChzaG9ydGN1dHNSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgbGV0IHNob3J0Y3V0cyA9IFtdOwogICAgICAgIGxldCB0YWJzID0gW107CiAgICAgICAgbGV0IG9yZGVyID0ge307CgogICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgc2hvcnRjdXRzID0gZGF0YS5ibHVlcHJpbnRTaG9ydGN1dHMgfHwgW107CiAgICAgICAgICAgIHRhYnMgPSBkYXRhLnNob3J0Y3V0VGFicyB8fCBbXTsKICAgICAgICAgICAgb3JkZXIgPSBkYXRhLnNob3J0Y3V0T3JkZXIgfHwge307CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRhYnMuZmluZCh0ID0+IHQuaWQgPT09ICdhbGwnKSkgewogICAgICAgICAgICB0YWJzLnVuc2hpZnQoeyBpZDogJ2FsbCcsIG5hbWU6ICfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJQnLCBpc0RlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gJ2RlZmF1bHQtMScpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdkZWZhdWx0LTEnLCBuYW1lOiAnQmx1ZXByaW50IDEnLCBibHVlcHJpbnRVcmw6ICcnLCByZWZlcmVuY2VVcmw6ICcnLCBpc0RlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgfQogICAgICAgIGlmICghc2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSAnZGVmYXVsdC0yJykpIHsKICAgICAgICAgICAgc2hvcnRjdXRzLnVuc2hpZnQoeyBpZDogJ2RlZmF1bHQtMicsIG5hbWU6ICdCbHVlcHJpbnQgMicsIGJsdWVwcmludFVybDogJycsIHJlZmVyZW5jZVVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGJsdWVwcmludFNob3J0Y3V0cyA9IHNob3J0Y3V0czsKICAgICAgICBzaG9ydGN1dFRhYnMgPSB0YWJzOwogICAgICAgIHNob3J0Y3V0T3JkZXIgPSBvcmRlcjsKCiAgICAgICAgLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC4geC4peC4seC4muC5gOC4guC5ieC4suC5hOC4myDguYDguJ7guLfguYjguK3guKrguLHguYjguIfguYPguKvguYnguKfguLLguJTguJvguLjguYjguKHguJfguLXguYjguKvguJnguYnguLIgRGFzaGJvYXJkIOC4q+C4peC4seC4geC5gOC4quC4oeC4rSDilrzilrzilrwKICAgICAgICByZW5kZXJCbHVlcHJpbnRTaG9ydGN1dHMoKTsgCiAgICAgICAgLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSDilrLilrLilrIKCiAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7CiAgICAgICAgICAgIHJlbmRlckFkZGl0aW9uYWxTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIH0KICAgIH0pOwp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAoKLyoqCiAqIFtDT1JFXSDguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguKrguLPguKvguKPguLHguJrguKfguLLguJTguKvguJnguYnguLLguJXguYjguLLguIcgTW9kYWwg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICjguYHguJfguYfguJogKyDguKPguLLguKLguIHguLLguKPguJvguLjguYjguKHguKXguLHguJQpCiAqLwpmdW5jdGlvbiByZW5kZXJBZGRpdGlvbmFsU2hvcnRjdXRzTW9kYWwoKSB7CiAgICBjb25zdCBuYXZDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtdGFicy1uYXYnKTsKICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpOwogICAgaWYgKCFuYXZDb250YWluZXIgfHwgIWxpc3RDb250YWluZXIpIHJldHVybjsKCiAgICAvLyAtLS0gMS4g4Lin4Liy4LiU4LmB4LiW4Lia4LmB4LiX4LmH4LiaIChUYWIgTmF2aWdhdGlvbikgLS0tCiAgICBuYXZDb250YWluZXIuaW5uZXJIVE1MID0gc2hvcnRjdXRUYWJzLm1hcCh0YWIgPT4gewogICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGFiLmlkID09PSBhY3RpdmVTaG9ydGN1dFRhYklkOwogICAgICAgIGNvbnN0IGFjdGl2ZUNsYXNzZXMgPSAnYm9yZGVyLWluZGlnby01MDAgdGV4dC1pbmRpZ28tNjAwJzsKICAgICAgICBjb25zdCBpbmFjdGl2ZUNsYXNzZXMgPSAnYm9yZGVyLXRyYW5zcGFyZW50IHRleHQtZ3JheS01MDAgaG92ZXI6dGV4dC1ncmF5LTcwMCBob3Zlcjpib3JkZXItZ3JheS0zMDAnOwogICAgICAgIAogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS10YWItaWQ9IiR7dGFiLmlkfSIgY2xhc3M9InNob3J0Y3V0LXRhYi1idG4gd2hpdGVzcGFjZS1ub3dyYXAgcHktMyBweC0yIGJvcmRlci1iLTIgZm9udC1tZWRpdW0gdGV4dC1zbSAke2lzQWN0aXZlID8gYWN0aXZlQ2xhc3NlcyA6IGluYWN0aXZlQ2xhc3Nlc30iPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0YWItbmFtZS1kaXNwbGF5IHBvaW50ZXItZXZlbnRzLW5vbmUiPiR7dGFiLm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHt0YWIubmFtZX0iIGNsYXNzPSJ0YWItbmFtZS1pbnB1dCBoaWRkZW4gYmctdHJhbnNwYXJlbnQgYm9yZGVyLWItMiBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIGZvbnQtbWVkaXVtIGZvY3VzOm91dGxpbmUtbm9uZSB3LTMyIj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHshdGFiLmlzRGVmYXVsdCA/IGAKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtdGFiLWlkPSIke3RhYi5pZH0iIGNsYXNzPSJkZWxldGUtc2hvcnRjdXQtdGFiLWJ0biBhYnNvbHV0ZSAtdG9wLTEgLXJpZ2h0LTEgdGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTcwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IHJvdW5kZWQtZnVsbCBiZy13aGl0ZSB0ZXh0LWxnIHctNSBoLTUgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiIHRpdGxlPSLguKXguJrguYHguJfguYfguJrguJnguLXguYkiPgogICAgICAgICAgICAgICAgICAgICAgICAmdGltZXM7CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICBgIDogJyd9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9KS5qb2luKCcnKTsKCiAgICAvLyAtLS0gMi4g4LiB4Lij4Lit4LiH4LmB4Lil4Liw4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiV4Liy4Lih4LmB4LiX4LmH4Lia4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBIC0tLQogICAgY29uc3QgYWN0aXZlVGFiID0gc2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSBhY3RpdmVTaG9ydGN1dFRhYklkKTsKICAgIGxldCBzaG9ydGN1dHNUb1Nob3cgPSBbXTsKCiAgICBpZiAoYWN0aXZlVGFiKSB7CiAgICAgICAgaWYgKGFjdGl2ZVRhYi5pc0RlZmF1bHQpIHsgLy8g4LmB4LiX4LmH4LiaICLguJfguLHguYnguIfguKvguKHguJQiCiAgICAgICAgICAgIHNob3J0Y3V0c1RvU2hvdyA9IFsuLi5ibHVlcHJpbnRTaG9ydGN1dHNdOwogICAgICAgIH0gZWxzZSB7IC8vIOC5geC4l+C5h+C4muC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5gOC4reC4hwogICAgICAgICAgICBjb25zdCBzaG9ydGN1dElkc0luVGFiID0gYWN0aXZlVGFiLnNob3J0Y3V0SWRzIHx8IFtdOwogICAgICAgICAgICBzaG9ydGN1dHNUb1Nob3cgPSBibHVlcHJpbnRTaG9ydGN1dHMuZmlsdGVyKHMgPT4gc2hvcnRjdXRJZHNJblRhYi5pbmNsdWRlcyhzLmlkKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyDguIjguLHguJTguYDguKPguLXguKLguIfguJXguLLguKHguKXguLPguJTguLHguJrguJfguLXguYjguJzguLnguYnguYPguIrguYnguKXguLLguIHguKfguLLguIcKICAgIGNvbnN0IGN1cnJlbnRPcmRlciA9IHNob3J0Y3V0T3JkZXJbYWN0aXZlU2hvcnRjdXRUYWJJZF0gfHwgW107CiAgICBzaG9ydGN1dHNUb1Nob3cuc29ydCgoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGluZGV4QSA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGEuaWQpOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGIuaWQpOwogICAgICAgIGlmIChpbmRleEEgPT09IC0xKSByZXR1cm4gMTsKICAgICAgICBpZiAoaW5kZXhCID09PSAtMSkgcmV0dXJuIC0xOwogICAgICAgIHJldHVybiBpbmRleEEgLSBpbmRleEI7CiAgICB9KTsKCiAgICAvLyAtLS0gMy4g4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4Liq4Liz4Lir4Lij4Lix4Lia4Lij4Liy4Lii4LiB4Liy4Lij4Lib4Li44LmI4Lih4Lil4Lix4LiUIC0tLQogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzaG9ydGN1dHNUb1Nob3cubGVuZ3RoID4gMCA/IHNob3J0Y3V0c1RvU2hvdy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGxldCBpY29uID0gJ/Cfp6knOwogICAgICAgIGlmIChzaG9ydGN1dC5ibHVlcHJpbnRVcmwgJiYgc2hvcnRjdXQucmVmZXJlbmNlVXJsKSBpY29uID0gJ/Cfk5cnOwogICAgICAgIGVsc2UgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCkgaWNvbiA9ICfwn5OYJzsKCiAgICAgICAgY29uc3Qgb3RoZXJUYWJzID0gc2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+ICF0LmlzRGVmYXVsdCk7CmNvbnN0IG1vdmVEcm9wZG93bkhUTUwgPSBhY3RpdmVUYWIuaXNEZWZhdWx0ICYmIG90aGVyVGFicy5sZW5ndGggPiAwID8gYAogICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgaW5saW5lLWJsb2NrIHRleHQtbGVmdCBncm91cC9kcm9wZG93biI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibW92ZS1zaG9ydGN1dC1tZW51LWJ0biB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS03MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIj48aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLXYiPjwvaT48L2J1dHRvbj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb3ZlLXNob3J0Y3V0LWRyb3Bkb3duIG9yaWdpbi10b3AtcmlnaHQgYWJzb2x1dGUgcmlnaHQtMCBtdC0yIHctNDggcm91bmRlZC1tZCBzaGFkb3ctbGcgYmctd2hpdGUgcmluZy0xIHJpbmctYmxhY2sgcmluZy1vcGFjaXR5LTUgaGlkZGVuIHotMjAiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJweS0xIiByb2xlPSJtZW51Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InB4LTQgcHQtMSBwYi0yIHRleHQteHMgdGV4dC1ncmF5LTQwMCI+4LmA4Lie4Li04LmI4Lih4LmE4Lib4Lii4Lix4LiH4LmB4LiX4LmH4LiaOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdGhlclRhYnMubWFwKHRhYiA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ibW92ZS1zaG9ydGN1dC1pdGVtIGJsb2NrIHB4LTQgcHktMiB0ZXh0LXNtIHRleHQtZ3JheS03MDAgaG92ZXI6YmctZ3JheS0xMDAiIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkYXRhLXRhcmdldC10YWItaWQ9IiR7dGFiLmlkfSI+JHt0YWIubmFtZX08L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGAgOiAnJzsKCiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2hvcnRjdXQtbGlzdC1pdGVtIHAtMyBib3JkZXItYiBob3ZlcjpiZy1ncmF5LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiIgZGF0YS1zaG9ydGN1dC1pZD0iJHtzaG9ydGN1dC5pZH0iIGRyYWdnYWJsZT0idHJ1ZSI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtYmx1ZS03MDAiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJ1c2UtaGlkZGVuLXNob3J0Y3V0LWJ0biBiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctYmx1ZS0yMDAiPuC5g+C4iuC5ieC4h+C4suC4mTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJlZGl0LWhpZGRlbi1zaG9ydGN1dC1idG4gYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctMjAwIj7guYHguIHguYnguYTguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tc2hvcnRjdXQtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCI+4Lil4LiaPC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICR7IWFjdGl2ZVRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXNob3J0Y3V0LWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InJlbW92ZS1zaG9ydGN1dC1mcm9tLXRhYi1idG4gdGV4dC1yZWQtNTAwIG1sLTIiIHRpdGxlPSLguJnguLPguK3guK3guIHguIjguLLguIHguYHguJfguYfguJrguJnguLXguYkiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIj48L2k+PC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICR7bW92ZURyb3Bkb3duSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJykgOiAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguJvguLjguYjguKHguKXguLHguJTguYPguJnguYHguJfguYfguJrguJnguLXguYk8L3A+JzsKICAgIAogICAgLy8gNC4g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4Lie4Li34LmI4Lit4Lic4Li54LiBIEV2ZW50IExpc3RlbmVycyDguYPguKvguYnguIHguLHguJrguJvguLjguYjguKHguYHguKXguLDguKPguLLguKLguIHguLLguKPguJfguLXguYjguKrguKPguYnguLLguIfguILguLbguYnguJnguYPguKvguKHguYgKICAgIHNldHVwU2hvcnRjdXRNb2RhbEV2ZW50TGlzdGVuZXJzKCk7Cn0KCi8qKgogKiDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguJzguLnguIEgRXZlbnQgTGlzdGVuZXIg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Lig4Liy4Lii4LmD4LiZIE1vZGFsCiAqLwpmdW5jdGlvbiBzZXR1cFNob3J0Y3V0TW9kYWxFdmVudExpc3RlbmVycygpIHsKICAgIC8vIOC4quC4peC4seC4muC5geC4l+C5h+C4mgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LXRhYi1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7CiAgICAgICAgICAgIGFjdGl2ZVNob3J0Y3V0VGFiSWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC50YWJJZDsKICAgICAgICAgICAgcmVuZGVyQWRkaXRpb25hbFNob3J0Y3V0c01vZGFsKCk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1kaXNwbGF5JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1pbnB1dCcpOwogICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgaW5wdXQuc2VsZWN0KCk7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyDguJrguLHguJnguJfguLbguIHguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguIrguLfguYjguK3guYHguJfguYfguJoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWItbmFtZS1pbnB1dCcpLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgIGNvbnN0IHNhdmUgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhYklkID0gaW5wdXQuY2xvc2VzdCgnLnNob3J0Y3V0LXRhYi1idG4nKS5kYXRhc2V0LnRhYklkOwogICAgICAgICAgICBoYW5kbGVSZW5hbWVTaG9ydGN1dFRhYih0YWJJZCwgaW5wdXQudmFsdWUpOwogICAgICAgIH07CiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHNhdmUpOwogICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHsgaWYgKGUua2V5ID09PSAnRW50ZXInKSBpbnB1dC5ibHVyKCk7IH0pOwogICAgfSk7CiAgICAKICAgIC8vIOC4peC4muC5geC4l+C5h+C4mgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGV0ZS1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gaGFuZGxlRGVsZXRlU2hvcnRjdXRUYWIoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQudGFiSWQpKTsKICAgIH0pOwoKICAgIC8vIOC4ouC5ieC4suC4ouC4m+C4uOC5iOC4oeC4peC4seC4lOC5hOC4m+C5geC4l+C5h+C4muC4reC4t+C5iOC4mSAo4LmA4Lih4Li34LmI4Lit4LiE4Lil4Li04LiB4LiX4Li14LmI4LiK4Li34LmI4Lit4LmB4LiX4LmH4Lia4LmD4LiZ4LmA4Lih4LiZ4Li5IERyb3Bkb3duKQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtaXRlbScpLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IHsgc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0OwogICAgICAgICAgICBoYW5kbGVNb3ZlU2hvcnRjdXRUb1RhYihzaG9ydGN1dElkLCB0YXJnZXRUYWJJZCk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgIAogICAgLy8g4LiZ4Liz4Lib4Li44LmI4Lih4Lil4Lix4LiU4Lit4Lit4LiB4LiI4Liy4LiB4LmB4LiX4LmH4Lia4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVtb3ZlLXNob3J0Y3V0LWZyb20tdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHsKICAgICAgICAgICAgaGFuZGxlUmVtb3ZlU2hvcnRjdXRGcm9tVGFiKGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnNob3J0Y3V0SWQsIGFjdGl2ZVNob3J0Y3V0VGFiSWQpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8g4LiI4Lix4LiU4LiB4Liy4Lij4Lib4Li44LmI4LihICLguYPguIrguYnguIfguLLguJkiLCAi4LmB4LiB4LmJ4LmE4LiCIiwgIuC4peC4miIgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpOwogICAgbGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcudXNlLWhpZGRlbi1zaG9ydGN1dC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgaGFuZGxlU2hvcnRjdXRDbGljayhidG4uZGF0YXNldC5pZCk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgIC8vICjguYLguITguYnguJTguKrguLPguKvguKPguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiH4Lib4Li44LmI4LihIGVkaXQg4LmB4Lil4LiwIGRlbGV0ZSDguJfguLXguYjguYDguKvguKXguLfguK3guYPguJnguKrguYjguKfguJnguJnguLXguYnguIjguLDguJfguLPguIfguLLguJnguJXguLLguKHguJvguIHguJXguLQpCgoKICAgIC8vIOC4iOC4seC4lOC4geC4suC4oyBEcmFnLWFuZC1Ecm9wICjguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBsZXQgZHJhZ2dlZEl0ZW0gPSBudWxsOwogICAgbGlzdENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsKICAgICAgICBkcmFnZ2VkSXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKTsKICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LTUwJyksIDApOwogICAgICAgIH0KICAgIH0pOwogICAgbGlzdENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgKCkgPT4gewogICAgICAgIGlmIChkcmFnZ2VkSXRlbSkgewogICAgICAgICAgICBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7CiAgICAgICAgICAgIGRyYWdnZWRJdGVtID0gbnVsbDsKICAgICAgICB9CiAgICB9KTsKICAgIGxpc3RDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc3QgYWZ0ZXJFbGVtZW50ID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbTpub3QoLm9wYWNpdHktNTApJyldLnJlZHVjZSgoY2xvc2VzdCwgY2hpbGQpID0+IHsKICAgICAgICAgICAgY29uc3QgYm94ID0gY2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGUuY2xpZW50WSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjsKICAgICAgICAgICAgcmV0dXJuIChvZmZzZXQgPCAwICYmIG9mZnNldCA+IGNsb3Nlc3Qub2Zmc2V0KSA/IHsgb2Zmc2V0OiBvZmZzZXQsIGVsZW1lbnQ6IGNoaWxkIH0gOiBjbG9zZXN0OwogICAgICAgIH0sIHsgb2Zmc2V0OiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgfSkuZWxlbWVudDsKICAgICAgICAKICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHsKICAgICAgICAgICAgbGlzdENvbnRhaW5lci5hcHBlbmRDaGlsZChkcmFnZ2VkSXRlbSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlzdENvbnRhaW5lci5pbnNlcnRCZWZvcmUoZHJhZ2dlZEl0ZW0sIGFmdGVyRWxlbWVudCk7CiAgICAgICAgfQogICAgfSk7CiAgICBsaXN0Q29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld09yZGVyID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbScpXS5tYXAoaXRlbSA9PiBpdGVtLmRhdGFzZXQuc2hvcnRjdXRJZCk7CiAgICAgICAgICAgIGhhbmRsZVNob3J0Y3V0T3JkZXJDaGFuZ2UoYWN0aXZlU2hvcnRjdXRUYWJJZCwgbmV3T3JkZXIpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCL+C5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iF0gLS0tCiAgICAvLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYDguJ7guLfguYjguK3guYDguJvguLTguJQv4Lib4Li04LiU4LmA4Lih4LiZ4Li5ICLguKLguYnguLLguKIiCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1zaG9ydGN1dC1tZW51LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LmE4Lih4LmI4LmD4Lir4LmJIGV2ZW50IOC4geC4suC4o+C4hOC4peC4tOC4geC4geC4o+C4sOC4iOC4suC4ouC5hOC4m+C4l+C4teC5iOC4reC4t+C5iOC4mQogICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGUuY3VycmVudFRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICAgICAgICAgIGNvbnN0IGlzQ3VycmVudGx5SGlkZGVuID0gZHJvcGRvd24uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKTsKCiAgICAgICAgICAgIC8vIOC4m+C4tOC4lOC5gOC4oeC4meC4ueC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguIHguYjguK3guJkKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtZHJvcGRvd24nKS5mb3JFYWNoKGQgPT4gZC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CgogICAgICAgICAgICAvLyDguJbguYnguLLguYDguKHguJnguLnguJfguLXguYjguITguKXguLTguIHguIHguLPguKXguLHguIfguIvguYjguK3guJnguK3guKLguLnguYgg4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4LiC4Li24LmJ4LiZ4Lih4LiyCiAgICAgICAgICAgIGlmIChpc0N1cnJlbnRseUhpZGRlbikgewogICAgICAgICAgICAgICAgZHJvcGRvd24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwp9CgovLyDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4LiB4Lix4Lia4Lir4LiZ4LmJ4Liy4LmA4Lin4LmH4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOC5gOC4nuC4t+C5iOC4reC4m+C4tOC4lOC5gOC4oeC4meC4ueC5gOC4oeC4t+C5iOC4reC4hOC4peC4tOC4geC4l+C4teC5iOC4muC4o+C4tOC5gOC4p+C4k+C4reC4t+C5iOC4mQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAvLyDguJbguYnguLLguYTguKHguYjguYTguJTguYnguITguKXguLTguIHguJfguLXguYjguJrguKPguLTguYDguKfguJPguYDguKHguJnguLkg4LmD4Lir4LmJ4LiL4LmI4Lit4LiZ4LmA4Lih4LiZ4Li54LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5ncm91cFxcL2Ryb3Bkb3duJykpIHsKICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtZHJvcGRvd24nKS5mb3JFYWNoKGQgPT4gZC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICB9Cn0pOwoKLyoqCiAqIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4muC4seC4meC4l+C4tuC4geC4guC5ieC4reC4oeC4ueC4peC5geC4l+C5h+C4muC5geC4peC4sOC4peC4s+C4lOC4seC4muC4peC4hyBGaXJlc3RvcmUKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVTaG9ydGN1dENvbmZpZygpIHsKICAgIGNvbnN0IGNvbmZpZ1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImRhc2hib2FyZENvbmZpZyIpOwogICAgdHJ5IHsKICAgICAgICBhd2FpdCBzZXREb2MoY29uZmlnUmVmLCB7IAogICAgICAgICAgICBzaG9ydGN1dFRhYnM6IHNob3J0Y3V0VGFicywKICAgICAgICAgICAgc2hvcnRjdXRPcmRlcjogc2hvcnRjdXRPcmRlcgogICAgICAgIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBzaG9ydGN1dCBjb25maWc6IiwgZXJyb3IpOwogICAgfQp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguIjguLHguJTguIHguLLguKPguYHguJfguYfguJrguYHguKXguLDguJvguLjguYjguKHguKXguLHguJQKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkU2hvcnRjdXRUYWIoKSB7CiAgICBjb25zdCBuYW1lID0gcHJvbXB0KCLguIHguKPguLjguJPguLLguJXguLHguYnguIfguIrguLfguYjguK3guYHguJfguYfguJrguYPguKvguKHguYg6IiwgIuC5geC4l+C5h+C4muC5g+C4q+C4oeC5iCIpOwogICAgaWYgKCFuYW1lIHx8IG5hbWUudHJpbSgpID09PSAnJykgcmV0dXJuOwogICAgc2hvcnRjdXRUYWJzLnB1c2goeyBpZDogYHRhYl8ke0RhdGUubm93KCl9YCwgbmFtZTogbmFtZS50cmltKCksIHNob3J0Y3V0SWRzOiBbXSB9KTsKICAgIGF3YWl0IHNhdmVTaG9ydGN1dENvbmZpZygpOwp9CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlbmFtZVNob3J0Y3V0VGFiKHRhYklkLCBuZXdOYW1lKSB7CiAgICBjb25zdCB0YWIgPSBzaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhYklkKTsKICAgIGlmICh0YWIgJiYgbmV3TmFtZS50cmltKCkgIT09ICcnKSB7CiAgICAgICAgdGFiLm5hbWUgPSBuZXdOYW1lLnRyaW0oKTsKICAgICAgICBhd2FpdCBzYXZlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBoYW5kbGVEZWxldGVTaG9ydGN1dFRhYih0YWJJZCkgewogICAgY29uc3QgdGFiID0gc2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSB0YWJJZCk7CiAgICBpZiAodGFiICYmICF0YWIuaXNEZWZhdWx0KSB7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4LiX4LmH4LiaICIke3RhYi5uYW1lfSI/ICjguJvguLjguYjguKHguKXguLHguJTguIjguLDguYTguKHguYjguJbguLnguIHguKXguJopYCwgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBzaG9ydGN1dFRhYnMgPSBzaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gdC5pZCAhPT0gdGFiSWQpOwogICAgICAgICAgICBkZWxldGUgc2hvcnRjdXRPcmRlclt0YWJJZF07CiAgICAgICAgICAgIGlmIChhY3RpdmVTaG9ydGN1dFRhYklkID09PSB0YWJJZCkgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyDguIHguKXguLHguJrguYTguJvguYHguJfguYfguJrguKvguKXguLHguIEKICAgICAgICAgICAgYXdhaXQgc2F2ZVNob3J0Y3V0Q29uZmlnKCk7CiAgICAgICAgfSk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlTW92ZVNob3J0Y3V0VG9UYWIoc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQpIHsKICAgIGNvbnN0IHRhcmdldFRhYiA9IHNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFyZ2V0VGFiSWQpOwogICAgaWYgKHRhcmdldFRhYiAmJiAhdGFyZ2V0VGFiLnNob3J0Y3V0SWRzLmluY2x1ZGVzKHNob3J0Y3V0SWQpKSB7CiAgICAgICAgdGFyZ2V0VGFiLnNob3J0Y3V0SWRzLnB1c2goc2hvcnRjdXRJZCk7CiAgICAgICAgYXdhaXQgc2F2ZVNob3J0Y3V0Q29uZmlnKCk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmVtb3ZlU2hvcnRjdXRGcm9tVGFiKHNob3J0Y3V0SWQsIHNvdXJjZVRhYklkKSB7CiAgICBjb25zdCBzb3VyY2VUYWIgPSBzaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHNvdXJjZVRhYklkKTsKICAgIGlmIChzb3VyY2VUYWIgJiYgIXNvdXJjZVRhYi5pc0RlZmF1bHQpIHsKICAgICAgICBzb3VyY2VUYWIuc2hvcnRjdXRJZHMgPSBzb3VyY2VUYWIuc2hvcnRjdXRJZHMuZmlsdGVyKGlkID0+IGlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICBhd2FpdCBzYXZlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBoYW5kbGVTaG9ydGN1dE9yZGVyQ2hhbmdlKHRhYklkLCBuZXdPcmRlcikgewogICAgc2hvcnRjdXRPcmRlclt0YWJJZF0gPSBuZXdPcmRlcjsKICAgIGF3YWl0IHNhdmVTaG9ydGN1dENvbmZpZygpOwp9CgovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gcmVuZGVyQmx1ZXByaW50U2hvcnRjdXRzKCkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zaG9ydGN1dC1jb250YWluZXInKTsKICAgIGNvbnN0IGFkZGl0aW9uYWxMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGNvbnN0IGxvYWRpbmdNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXRzLWxvYWRpbmctbXNnJyk7CgogICAgaWYgKGxvYWRpbmdNc2cpIHsKICAgICAgICBsb2FkaW5nTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfQogICAgaWYgKCFjb250YWluZXIgfHwgIWFkZGl0aW9uYWxMaXN0KSByZXR1cm47CgogICAgY29uc3QgdmlzaWJsZVNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5zbGljZSgwLCA0KTsKICAgIGNvbnN0IGhpZGRlblNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5zbGljZSg0KTsKCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdmlzaWJsZVNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGxldCBiZ0NvbG9yID0gJ2JnLWdyYXktMjAwIGhvdmVyOmJnLWdyYXktMzAwIHRleHQtZ3JheS03MDAnOwogICAgICAgIGxldCBpY29uID0gJ/Cfp6knOwogICAgICAgIAogICAgICAgIGlmIChzaG9ydGN1dC5ibHVlcHJpbnRVcmwgJiYgc2hvcnRjdXQucmVmZXJlbmNlVXJsKSB7CiAgICAgICAgICAgIGJnQ29sb3IgPSAnYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlJzsKICAgICAgICAgICAgaWNvbiA9ICfwn5OXJzsKICAgICAgICB9IGVsc2UgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCkgewogICAgICAgICAgICBiZ0NvbG9yID0gJ2JnLWJsdWUtNTAwIGhvdmVyOmJnLWJsdWUtNjAwIHRleHQtd2hpdGUnOwogICAgICAgICAgICBpY29uID0gJ/Cfk5gnOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVsZXRlQnRuSHRtbCA9ICFzaG9ydGN1dC5pc0RlZmF1bHQgPyAKICAgICAgICAgICAgYDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJkZWxldGUtc2hvcnRjdXQtYnRuIGFic29sdXRlIHRvcC0xIHJpZ2h0LTEgdy02IGgtNiBiZy1yZWQtNTAwIHRleHQtd2hpdGUgcm91bmRlZC1mdWxsIHRleHQteHMgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eSIgdGl0bGU9IuC4peC4miI+JnRpbWVzOzwvYnV0dG9uPmAgOiAnJzsKCiAgICAgICAgLy8gKioqIFNUQVJUOiDguYHguIHguYnguYTguILguILguJnguLLguJTguJvguLjguYjguKHguJXguKPguIfguJnguLXguYkgKioqCiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgZ3JvdXAiPgogICAgICAgICAgICAgICAgPGRpdiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InNob3J0Y3V0LWJ0biByb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IGgtMjQgJHtiZ0NvbG9yfSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBvaW50ZXItZXZlbnRzLW5vbmUiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtc2hvcnRjdXQtYnRuIGFic29sdXRlIGJvdHRvbS0xIHJpZ2h0LTEgdy02IGgtNiBiZy13aGl0ZS81MCB0ZXh0LWdyYXktODAwIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguYHguIHguYnguYTguIIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAke2RlbGV0ZUJ0bkh0bWx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgLy8gKioqIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LiC4LiZ4Liy4LiUICoqKgogICAgfSkuam9pbignJyk7CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gKioqIFNUQVJUOiDguYHguIHguYnguYTguILguILguJnguLLguJTguJvguLjguYjguKEgIuC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oSIg4LiV4Lij4LiH4LiZ4Li14LmJICoqKgogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgKz0gYAogICAgICAgICAgICA8ZGl2IGlkPSJvcGVuLWFkZGl0aW9uYWwtc2hvcnRjdXRzLWJ0biIgY2xhc3M9InJvdW5kZWQtMnhsIHNoYWRvdy1sZyBwLTQgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgaC0yNCBiZy1ncmF5LTEwMCBob3ZlcjpiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNjAwIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZWxsaXBzaXMtaCB0ZXh0LXhsIj48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXQtMiB0ZXh0LXNtIj7guJvguLjguYjguKHguKXguLHguJTguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgLy8gKioqIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LiC4LiZ4Liy4LiUICoqKgogICAgfQoKICAgIGlmIChoaWRkZW5TaG9ydGN1dHMubGVuZ3RoID4gMCkgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9IGhpZGRlblNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgICAgICBsZXQgaWNvbiA9ICfwn6epJzsKICAgICAgICAgICAgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCAmJiBzaG9ydGN1dC5yZWZlcmVuY2VVcmwpIHsKICAgICAgICAgICAgICAgIGljb24gPSAn8J+Tlyc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvcnRjdXQuYmx1ZXByaW50VXJsKSB7CiAgICAgICAgICAgICAgICBpY29uID0gJ/Cfk5gnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtpY29ufSAke3Nob3J0Y3V0Lm5hbWV9PC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tc2hvcnRjdXQtYnRuIGJnLWJsdWUtMTAwIHRleHQtYmx1ZS03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1ibHVlLTIwMCI+4LmD4LiK4LmJ4LiH4Liy4LiZPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtaGlkZGVuLXNob3J0Y3V0LWJ0biBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXllbGxvdy0yMDAiPuC5geC4geC5ieC5hOC4gjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICR7IXNob3J0Y3V0LmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLWhpZGRlbi1zaG9ydGN1dC1idG4gYmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtMjAwIj7guKXguJo8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSkuam9pbignJyk7CiAgICB9IGVsc2UgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvcD4nOwogICAgfQp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAovKioKICogW0hlbHBlcl0g4LmB4Lib4Lil4LiH4LiK4Li34LmI4Lit4LmE4Lif4Lil4LmM4LmA4Lib4LmH4LiZIE1JTUUgVHlwZSDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICovCmZ1bmN0aW9uIGdldE1pbWVUeXBlRnJvbUZpbGVuYW1lKGZpbGVuYW1lKSB7CiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlbmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7CiAgICBzd2l0Y2ggKGV4dGVuc2lvbikgewogICAgICAgIGNhc2UgJ3BkZic6CiAgICAgICAgICAgIHJldHVybiAnYXBwbGljYXRpb24vcGRmJzsKICAgICAgICBjYXNlICd0eHQnOgogICAgICAgICAgICByZXR1cm4gJ3RleHQvcGxhaW4nOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIC8vIOC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBwZGYg4LiW4LmJ4Liy4LmE4Lih4LmI4Lij4Li54LmJ4LiI4Lix4LiBIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5guC4reC4geC4suC4quC4l+C4s+C4h+C4suC4meC5hOC4lOC5ieC4oeC4suC4geC4l+C4teC5iOC4quC4uOC4lAogICAgICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL3BkZic7CiAgICB9Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCmZ1bmN0aW9uIG9wZW5TaG9ydGN1dEVkaXRvcihzaG9ydGN1dElkID0gbnVsbCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtZWRpdG9yLW1vZGFsJyk7CiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1tb2RhbC10aXRsZScpOwogICAgY29uc3QgaWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1pZC1pbnB1dCcpOwogICAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LW5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IGJsdWVwcmludFVybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LWJsdWVwcmludC11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHJlZmVyZW5jZVVybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LXJlZmVyZW5jZS11cmwtaW5wdXQnKTsKCiAgICBpZiAoc2hvcnRjdXRJZCkgewogICAgICAgIC8vIOC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4ggogICAgICAgIGNvbnN0IHNob3J0Y3V0ID0gYmx1ZXByaW50U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgICAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4LiB4LmJ4LmE4LiC4Lib4Li44LmI4Lih4Lil4Lix4LiUJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gc2hvcnRjdXQuaWQ7CiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gc2hvcnRjdXQubmFtZTsKICAgICAgICBibHVlcHJpbnRVcmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LmJsdWVwcmludFVybCB8fCAnJzsKICAgICAgICByZWZlcmVuY2VVcmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LnJlZmVyZW5jZVVybCB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LmC4Lir4Lih4LiU4LmA4Lie4Li04LmI4Lih4LmD4Lir4Lih4LmICiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4Lir4Lih4LmIJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gJyc7IC8vIOC4m+C4peC5iOC4reC4ouC4p+C5iOC4suC4h+C5hOC4p+C5ieC5gOC4nuC4t+C5iOC4reC4quC4o+C5ieC4suC4hyBJRCDguYPguKvguKHguYgKICAgICAgICBuYW1lSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICBibHVlcHJpbnRVcmxJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIHJlZmVyZW5jZVVybElucHV0LnZhbHVlID0gJyc7CiAgICB9CiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKLyoqCiAqIFtTaG9ydGN1dHNdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4h+C4iOC4suC4gSBNb2RhbCDguKXguIcgRmlyZWJhc2UKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVTaG9ydGN1dENoYW5nZXMoKSB7CiAgICBjb25zdCBpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1pZC1pbnB1dCcpLnZhbHVlOwogICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1uYW1lLWlucHV0JykudmFsdWUudHJpbSgpOwogICAgY29uc3QgYmx1ZXByaW50VXJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LWJsdWVwcmludC11cmwtaW5wdXQnKS52YWx1ZS50cmltKCk7CgogICAgaWYgKCFuYW1lIHx8ICFibHVlcHJpbnRVcmwpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiBICfguIrguLfguYjguK3guJvguLjguYjguKHguKXguLHguJQnIOC5geC4peC4sCAn4Lil4Li04LiH4LiB4LmMIFRlc3QgQmx1ZXByaW50JyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBuZXdTaG9ydGN1dERhdGEgPSB7CiAgICAgICAgaWQ6IGlkIHx8IGBzaG9ydGN1dF8ke0RhdGUubm93KCl9YCwKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGJsdWVwcmludFVybDogYmx1ZXByaW50VXJsLAogICAgICAgIHJlZmVyZW5jZVVybDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LXJlZmVyZW5jZS11cmwtaW5wdXQnKS52YWx1ZS50cmltKCksCiAgICAgICAgaXNEZWZhdWx0OiBpZC5zdGFydHNXaXRoKCdkZWZhdWx0LScpCiAgICB9OwoKICAgIGxldCB1cGRhdGVkU2hvcnRjdXRzOwogICAgaWYgKGlkKSB7CiAgICAgICAgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IG5ld1Nob3J0Y3V0RGF0YSA6IHMpOwogICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gWy4uLmJsdWVwcmludFNob3J0Y3V0cywgbmV3U2hvcnRjdXREYXRhXTsKICAgIH0KCiAgICB0cnkgewogICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4mSBwYXRoIOC4leC4o+C4h+C4meC4teC5iQogICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBibHVlcHJpbnRTaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBzaG9ydGN1dDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVTaG9ydGN1dENsaWNrKHNob3J0Y3V0SWQpIHsKICAgIGNvbnN0IHNob3J0Y3V0ID0gYmx1ZXByaW50U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgIGlmICghc2hvcnRjdXQgfHwgIXNob3J0Y3V0LmJsdWVwcmludFVybCkgcmV0dXJuOwoKICAgIC8vIOC4i+C5iOC4reC4meC4leC4seC4p+C5gOC4peC4t+C4reC4geC5geC4peC4sOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1vcHRpb25zLWNvbnRhaW5lcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tYmx1ZXByaW50LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKCiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZ2VuZXJhdGlvbi1hcmVhJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGVkLXF1aXotY29udGFpbmVyJykuaW5uZXJIVE1MID0gJyc7CiAgICBsb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgdHJ5IHsKICAgICAgICBsb2FkZXJUZXh0LnRleHRDb250ZW50ID0gJ+C4geC4s+C4peC4seC4h+C4lOC4tuC4h+C5hOC4n+C4peC5jCBCbHVlcHJpbnQg4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMLi4uJzsKICAgICAgICBjb25zdCBibHVlcHJpbnRGaWxlID0gYXdhaXQgZmV0Y2hGaWxlRnJvbVVybChzaG9ydGN1dC5ibHVlcHJpbnRVcmwsICJibHVlcHJpbnQucGRmIik7CgogICAgICAgIGxldCByZWZlcmVuY2VGaWxlID0gbnVsbDsKICAgICAgICBpZiAoc2hvcnRjdXQucmVmZXJlbmNlVXJsKSB7CiAgICAgICAgICAgIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSAn4LiB4Liz4Lil4Lix4LiH4LiU4Li24LiH4LmE4Lif4Lil4LmM4Lit4LmJ4Liy4LiH4Lit4Li04LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMLi4uJzsKCiAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiZ4Liy4Lih4Liq4LiB4Li44Lil4LiC4Lit4LiHIFVSTCDguYDguJ7guLfguYjguK3guIHguLPguKvguJnguJTguIrguLfguYjguK3guYTguJ/guKXguYzguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlRmlsZW5hbWUgPSBzaG9ydGN1dC5yZWZlcmVuY2VVcmwudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnR4dCcpIAogICAgICAgICAgICAgICAgPyAicmVmZXJlbmNlLnR4dCIgCiAgICAgICAgICAgICAgICA6ICJyZWZlcmVuY2UucGRmIjsKICAgICAgICAgICAgcmVmZXJlbmNlRmlsZSA9IGF3YWl0IGZldGNoRmlsZUZyb21Vcmwoc2hvcnRjdXQucmVmZXJlbmNlVXJsLCByZWZlcmVuY2VGaWxlbmFtZSk7CiAgICAgICAgICAgIC8vIC0tLSBbRU5EXSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCiAgICAgICAgfQoKICAgICAgICAvLyDguKrguYjguIcgRmlsZSBvYmplY3Qg4LiX4Li14LmI4LmE4LiU4LmJ4LmE4Lib4LmD4Lir4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4LiaCiAgICAgICAgYXdhaXQgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50V2l0aEZpbGVzKGJsdWVwcmludEZpbGUsIHJlZmVyZW5jZUZpbGUpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcHJvY2Vzc2luZyBzaG9ydGN1dCBjbGljazoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgIGxvYWRlci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0KfQoKZnVuY3Rpb24gZ2V0RGlyZWN0RG93bmxvYWRVcmwoZHJpdmVVcmwpIHsKICAgIGNvbnN0IGZpbGVJZE1hdGNoID0gZHJpdmVVcmwubWF0Y2goL2ZpbGVcL2RcLyhbYS16QS1aMC05Xy1dKykvKTsKICAgIGlmIChmaWxlSWRNYXRjaCAmJiBmaWxlSWRNYXRjaFsxXSkgewogICAgICAgIHJldHVybiBgaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD0ke2ZpbGVJZE1hdGNoWzFdfWA7CiAgICB9CiAgICByZXR1cm4gZHJpdmVVcmw7IC8vIOC4hOC4t+C4meC4hOC5iOC4siBVUkwg4LmA4LiU4Li04Lih4LiW4LmJ4Liy4LmE4Lih4LmI4LmD4LiK4LmI4Lij4Li54Lib4LmB4Lia4Lia4LiX4Li14LmI4Lij4Li54LmJ4LiI4Lix4LiBCn0KCmFzeW5jIGZ1bmN0aW9uIGZldGNoRmlsZUZyb21VcmwodXJsLCBkZWZhdWx0RmlsZW5hbWUpIHsKICAgIGNvbnN0IGRpcmVjdFVybCA9IGdldERpcmVjdERvd25sb2FkVXJsKHVybCk7CiAgICBjb25zdCBwcm94eVVybCA9IGBodHRwczovL2NvcnNwcm94eS5pby8/JHtlbmNvZGVVUklDb21wb25lbnQoZGlyZWN0VXJsKX1gOwoKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocHJveHlVcmwpOwogICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgIHRocm93IG5ldyBFcnJvcihg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmC4Lir4Lil4LiU4LmE4Lif4Lil4LmM4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmM4LmE4LiU4LmJIChTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfSlgKTsKICAgIH0KCmNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7CgogICAgLy8gLS0tIFtTVEFSVF0g4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQoKICAgIC8vIDEuIOC4reC5iOC4suC4mSA0IGJ5dGUg4LmB4Lij4LiB4LiC4Lit4LiH4LmE4Lif4Lil4LmM4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaICJNYWdpYyBOdW1iZXIiCiAgICBjb25zdCBmaWxlSGVhZGVyID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4Lit4LmI4Liy4LiZ4LmA4Liq4Lij4LmH4LiIIOC5g+C4q+C5ieC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBBcnJheSDguILguK3guIcgYnl0ZQogICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiByZXNvbHZlKG5ldyBVaW50OEFycmF5KHJlYWRlci5yZXN1bHQpKTsKICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsKICAgICAgICAvLyDguKrguLHguYjguIfguYPguKvguYnguK3guYjguLLguJnguILguYnguK3guKHguLnguKXguYHguITguYggNCBieXRlIOC5geC4o+C4geC4guC4reC4h+C5hOC4n+C4peC5jOC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iLnNsaWNlKDAsIDQpKTsKICAgIH0pOwoKICAgIGxldCBkZXRlcm1pbmVkTWltZVR5cGUgPSAnJzsKICAgIC8vIDIuIOC5geC4m+C4peC4hyBieXRlIOC4l+C4teC5iOC4reC5iOC4suC4meC5hOC4lOC5ieC5gOC4m+C5h+C4meC4guC5ieC4reC4hOC4p+C4suC4oSAoVGV4dCkKICAgIGNvbnN0IGhlYWRlclRleHQgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZmlsZUhlYWRlcik7CgogICAgLy8gMy4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LmE4LiU4LmJ4LiE4Li34LitICIlUERGIiDguKvguKPguLfguK3guYTguKHguYgKICAgIGlmIChoZWFkZXJUZXh0ID09PSAnJVBERicpIHsKICAgICAgICBkZXRlcm1pbmVkTWltZVR5cGUgPSAnYXBwbGljYXRpb24vcGRmJzsKICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBjb250ZW50IGlkZW50aWZpZWQgYXMgUERGIGJ5IGl0cyBtYWdpYyBudW1iZXIuJyk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIDQuIOC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5iCBQREYg4LmD4LiZ4LiB4Lij4LiT4Li14LiZ4Li14LmJ4LmD4Lir4LmJ4LiW4Li34Lit4Lin4LmI4Liy4LmA4Lib4LmH4LiZIFRleHQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgZGV0ZXJtaW5lZE1pbWVUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIGNvbnRlbnQgaXMgbm90IGEgUERGLCBhc3N1bWluZyB0ZXh0L3BsYWluLicpOwogICAgfQogICAgCiAgICAvLyA1LiDguKrguKPguYnguLLguIcgRmlsZSBvYmplY3Qg4LiU4LmJ4Lin4LiiIE1JTUUgdHlwZSDguJfguLXguYjguJXguKPguKfguIjguKrguK3guJrguIjguLLguIHguYDguJnguLfguYnguK3guKvguLLguYTguJ/guKXguYzguYHguKXguYnguKcKICAgIHJldHVybiBuZXcgRmlsZShbYmxvYl0sIGRlZmF1bHRGaWxlbmFtZSwgeyB0eXBlOiBkZXRlcm1pbmVkTWltZVR5cGUgfSk7CiAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZUZyb21CbHVlcHJpbnRXaXRoRmlsZXMoYmx1ZXByaW50RmlsZSwgcmVmZXJlbmNlRmlsZSA9IG51bGwpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgg4pay4pay4payCgphc3luYyBmdW5jdGlvbiBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlckluZGV4LCBxdWVzdGlvbikgewogICAgLy8g4Lib4Li04LiU4Lib4Li44LmI4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Lix4LiZ4LiX4Li14Lir4Lil4Lix4LiH4LiV4Lit4LiaIOC5gOC4nuC4t+C5iOC4reC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4quC5iOC4h+C4i+C5ieC4swogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpdmUtYW5zd2VyLWJ0biwgI2xpdmUtc3VibWl0LXNob3J0LWFuc3dlci1idG4nKS5mb3JFYWNoKGIgPT4gYi5kaXNhYmxlZCA9IHRydWUpOwoKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CiAgICBsZXQgdXNlckFuc3dlckZvckRiID0gYW5zd2VySW5kZXg7IC8vIOC4hOC5iOC4suC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC4peC4hyBEQgoKICAgIC8vIOC4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4miAo4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4Lii4Lix4LiH4LiX4Liz4LiH4Liy4LiZ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicpIHsKICAgICAgICBjb25zdCB1c2VyQW5zd2VyID0gKGFuc3dlckluZGV4IHx8ICcnKS50b1N0cmluZygpOyAKICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKHVzZXJBbnN3ZXIsIHF1ZXN0aW9uKTsKICAgIH0KICAgIGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICBpc0NvcnJlY3QgPSBhbnN3ZXJJbmRleCA9PT0gcXVlc3Rpb24uY29ycmVjdEFuc3dlckluZGV4OwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgIGNvbnN0IGNvcnJlY3RBbnN3ZXJCb29sID0gcXVlc3Rpb24uY29ycmVjdEFuc3dlcjsKICAgICAgICBpc0NvcnJlY3QgPSAoYW5zd2VySW5kZXggPT09IDAgJiYgY29ycmVjdEFuc3dlckJvb2wpIHx8IChhbnN3ZXJJbmRleCA9PT0gMSAmJiAhY29ycmVjdEFuc3dlckJvb2wpOwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgIGNvbnN0IHNlbGVjdGVkUmVzcG9uc2UgPSBxdWVzdGlvbi5hbGxSZXNwb25zZXNbYW5zd2VySW5kZXhdOwogICAgICAgIGlzQ29ycmVjdCA9IHNlbGVjdGVkUmVzcG9uc2UgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICB1c2VyQW5zd2VyRm9yRGIgPSBzZWxlY3RlZFJlc3BvbnNlOyAvLyDguKrguLPguKvguKPguLHguJogbWF0Y2hpbmcg4LmD4Lir4LmJ4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBCiAgICB9CgogICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9saXZlR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAKICAgIC8vICoqKiDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguILguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJQgKioqCiAgICAvLyDguYDguKPguLLguIjguLDguYTguKHguYjguITguLPguJnguKfguJPguITguLDguYHguJnguJnguJfguLXguYjguJnguLXguYjguK3guLXguIHguJXguYjguK3guYTguJsKICAgIC8vIOC5geC4leC5iOC4iOC4sOC4quC5iOC4h+C4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4leC4reC4muC5geC4peC4sCAi4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiH4LiI4Liy4LiB4LmA4LiL4Li04Lij4LmM4Lif4LmA4Lin4Lit4Lij4LmMIiDguIHguKXguLHguJrguYTguJvguYHguJfguJkKICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7fTsKICAgIHVwZGF0ZVBheWxvYWRbYHBsYXllcnMuJHtjdXJyZW50U3R1ZGVudE5hbWV9LmFuc3dlcmVkQ3VycmVudFF1ZXN0aW9uYF0gPSB0cnVlOwogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0ubGFzdEFuc3dlckNvcnJlY3RgXSA9IGlzQ29ycmVjdDsKICAgIHVwZGF0ZVBheWxvYWRbYHBsYXllcnMuJHtjdXJyZW50U3R1ZGVudE5hbWV9Lmxhc3RBbnN3ZXJJbmRleGBdID0gKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpID8gbnVsbCA6IGFuc3dlckluZGV4OwogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0ubGFzdEFuc3dlclZhbHVlYF0gPSB1c2VyQW5zd2VyRm9yRGI7CiAgICB1cGRhdGVQYXlsb2FkW2BwbGF5ZXJzLiR7Y3VycmVudFN0dWRlbnROYW1lfS5zdWJtaXR0ZWRBdGBdID0gc2VydmVyVGltZXN0YW1wKCk7IC8vIOC4muC4seC4meC4l+C4tuC4geC5gOC4p+C4peC4suC4l+C4teC5iOC4quC5iOC4h+C4lOC5ieC4p+C4ouC5gOC4p+C4peC4suC5gOC4i+C4tOC4o+C5jOC4n+C5gOC4p+C4reC4o+C5jAogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0uaXNTY29yZWRgXSA9IGZhbHNlOyAvLyDguYDguJ7guLTguYjguKEgRmxhZyDguYDguJ7guLfguYjguK3guJrguK3guIHguKfguYjguLIgIuC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4hOC4tOC4lOC4hOC4sOC5geC4meC4mSIKCiAgICAvLyDguKrguYjguIfguILguYnguK3guKHguLnguKXguIHguKXguLHguJrguYTguJvguJfguLXguYggRmlyZXN0b3JlCiAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgdXBkYXRlUGF5bG9hZCk7CgogICAgLy8g4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4LitICLguKPguK0iIOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oQogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIj7guKrguYjguIfguITguLPguJXguK3guJrguYHguKXguYnguKchPC9oMj4KICAgICAgICA8cCBjbGFzcz0ibXQtOCI+4Lij4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiE4LiZ4Lit4Li34LmI4LiZ4Liq4Lix4LiB4LiE4Lij4Li54LmILi4uPC9wPgogICAgICAgIDxkaXYgY2xhc3M9ImxvYWRlciBtdC00Ij48L2Rpdj4KICAgIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHNob3dBZG1pblN1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbikgewogICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgY29uc3Qgb3B0aW9ucyA9IHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnID8gWyfguYPguIrguYgnLCAn4LmE4Lih4LmI4LmD4LiK4LmIJ10gOiAocXVlc3Rpb24ub3B0aW9ucyB8fCBxdWVzdGlvbi5hbGxSZXNwb25zZXMgfHwgW10pOwoKICAgIGNvbnN0IG5hbWVzQnlBbnN3ZXIgPSB7fTsKICAgIGNvbnN0IGFuc3dlckNvdW50cyA9IG5ldyBBcnJheShvcHRpb25zLmxlbmd0aCkuZmlsbCgwKTsKICAgIG9wdGlvbnMuZm9yRWFjaCgob3B0LCBpbmRleCkgPT4gewogICAgICAgIG5hbWVzQnlBbnN3ZXJbaW5kZXhdID0gW107CiAgICB9KTsKCiAgICBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5mb3JFYWNoKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdhY3RpdmUnICYmIGRhdGEubGFzdEFuc3dlckluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc3QgYW5zd2VySW5kZXggPSBkYXRhLmxhc3RBbnN3ZXJJbmRleDsKICAgICAgICAgICAgaWYgKG5hbWVzQnlBbnN3ZXJbYW5zd2VySW5kZXhdKSB7CiAgICAgICAgICAgICAgICBuYW1lc0J5QW5zd2VyW2Fuc3dlckluZGV4XS5wdXNoKG5hbWUpOwogICAgICAgICAgICAgICAgYW5zd2VyQ291bnRzW2Fuc3dlckluZGV4XSsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgIGNvbnN0IG1heENvdW50ID0gTWF0aC5tYXgoLi4uYW5zd2VyQ291bnRzLCAxKTsKICAgIAogICAgY29uc3Qgc3VtbWFyeUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIj4ke3F1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0fTwvaDI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctMnhsIGgtNjQgZmxleCBqdXN0aWZ5LWFyb3VuZCBpdGVtcy1lbmQgZ2FwLTQiPgogICAgICAgICAgICAgICAgJHthbnN3ZXJDb3VudHMubWFwKChjb3VudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IG5hbWVzQnlBbnN3ZXJbaW5kZXhdLmxlbmd0aCA+IDAgCiAgICAgICAgICAgICAgICAgICAgICAgID8gbmFtZXNCeUFuc3dlcltpbmRleF0uam9pbignLCAnKSAKICAgICAgICAgICAgICAgICAgICAgICAgOiAn4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgaXNDb3JyZWN0T3B0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKGluZGV4ID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdFZhbHVlID0gcXVlc3Rpb24uY29ycmVjdEFuc3dlcjsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKGNvcnJlY3RWYWx1ZSAmJiBpbmRleCA9PT0gMCkgfHwgKCFjb3JyZWN0VmFsdWUgJiYgaW5kZXggPT09IDEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKG9wdGlvbnNbaW5kZXhdID09PSBxdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFyQ29sb3IgPSBpc0NvcnJlY3RPcHRpb24gPyAnIzI2ODkwYycgOiAnI2UyMWIzYyc7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBb4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiC4Lit4LiH4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LiV4Liz4LmB4Lir4LiZ4LmI4LiHIFRvb2x0aXBdIC0tLQogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzQgaC1mdWxsIGZsZXggZmxleC1jb2wganVzdGlmeS1lbmQgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0xIj4ke2NvdW50fTwvc3Bhbj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1bW1hcnktYmFyLWl0ZW0gdy1mdWxsIHJvdW5kZWQtbGcgdGV4dC13aGl0ZSBwLTIgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgZ2FwLTEgY3Vyc29yLXBvaW50ZXIgcmVsYXRpdmUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogNjBweDsgYmFja2dyb3VuZC1jb2xvcjogJHtiYXJDb2xvcn07IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdG9vbHRpcC10YXJnZXQ9InRvb2x0aXAtJHtpbmRleH0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14cyBzbTp0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1jZW50ZXIgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtvcHRpb25zW2luZGV4XX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRvb2x0aXAtJHtpbmRleH0iIGNsYXNzPSJsaXZlLXN1bW1hcnktdG9vbHRpcCBhYnNvbHV0ZSBib3R0b20tZnVsbCBtYi0yIHctbWF4IG1heC13LXhzIGJnLWdyYXktODAwIHRleHQtd2hpdGUgdGV4dC1zbSByb3VuZGVkLWxnIHNoYWRvdy1sZyBwLTMgei0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0iYmxvY2sgbWItMSBib3JkZXItYiBib3JkZXItZ3JheS02MDAgcGItMSI+4Lic4Li54LmJ4LiX4Li14LmI4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJOjwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7dG9vbHRpcFRleHR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00IG10LTgiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ib3Blbi1zY3JhdGNocGFkLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzMwIGhvdmVyOmJnLXdoaXRlLzUwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCI+PC9pPiDguJfguJTguYDguKXguIIKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic2hvdy1sZWFkZXJib2FyZC1idG4iIGNsYXNzPSJiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCI+CiAgICAgICAgICAgICAgICAgICAg4LiW4Lix4LiU4LmE4LibIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICAKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBzdW1tYXJ5SFRNTDsKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZSgpOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LWxlYWRlcmJvYXJkLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvbGl2ZUdhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHF1ZXN0aW9uU3RhdHVzOiAnbGVhZGVyYm9hcmQnIH0pOwogICAgfSk7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXNjcmF0Y2hwYWQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIG9wdGlvbnMpOwogICAgfSk7Cn0KCiAgICAgICAgLyoqCi8qKgogICAgICAgICAqIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4reC4quC4o+C4uOC4m+C4nOC4peC4q+C4peC4seC4h+C4iOC4muC4guC5ieC4rSAo4Liq4Liz4Lir4Lij4Lix4LiaIFBsYXllcikgLSDguYDguKfguK3guKPguYzguIrguLHguJnguK3guLHguJvguYDguIHguKPguJQKICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gZ2FtZURhdGEgLSDguILguYnguK3guKHguLnguKXguYDguIHguKHguJfguLHguYnguIfguKvguKHguJTguIjguLLguIEgRmlyZXN0b3JlCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBsYXllck5hbWUgLSDguIrguLfguYjguK3guILguK3guIfguJzguLnguYnguYDguKXguYjguJnguJvguLHguIjguIjguLjguJrguLHguJkKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBzaG93UGxheWVyU3VtbWFyeVZpZXcoZ2FtZURhdGEsIHBsYXllck5hbWUpIHsKICAgICAgICAgICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICAgICAgICAgIGNvbnN0IG15RGF0YSA9IGdhbWVEYXRhLnBsYXllcnNbcGxheWVyTmFtZV07CgogICAgICAgICAgICAvLyDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJoKICAgICAgICAgICAgY29uc3Qgc29ydGVkUGxheWVycyA9IHBsYXllcnMuZmlsdGVyKHAgPT4gcC5zdGF0dXMgPT09ICdhY3RpdmUnKS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICAgICAgICAgIGNvbnN0IG15UmFuayA9IHNvcnRlZFBsYXllcnMuZmluZEluZGV4KHAgPT4gcCA9PT0gbXlEYXRhKSArIDE7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gbXlEYXRhLmxhc3RBbnN3ZXJDb3JyZWN0ID8gJ+C4luC4ueC4geC4leC5ieC4reC4hyEnIDogJ+C4nOC4tOC4lCc7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdEJveENsYXNzID0gbXlEYXRhLmxhc3RBbnN3ZXJDb3JyZWN0ID8gJ2JnLWdyZWVuLTUwMCcgOiAnYmctcmVkLTUwMCc7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0dhaW5lZCA9IG15RGF0YS5wb2ludHNMYXN0UXVlc3Rpb24gfHwgMDsKICAgICAgICAgICAgY29uc3QgZ3JhZGllbnRCZyA9ICJiZy1ncmFkaWVudC10by1iciBmcm9tLWluZGlnby02MDAgdG8tcHVycGxlLTcwMCI7CgogICAgICAgICAgICBjb25zdCBzdW1tYXJ5SFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciB0ZXh0LXdoaXRlICR7Z3JhZGllbnRCZ30iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InB4LTggcHktMiByb3VuZGVkLWxnICR7cmVzdWx0Qm94Q2xhc3N9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCI+JHtyZXN1bHRUZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgbXQtNCI+KyR7cG9pbnRzR2FpbmVkfSDguITguLDguYHguJnguJk8L3A+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LXNtIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTEyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteGwiPuC4leC4reC4meC4meC4teC5ieC4hOC4uOC4k+C4reC4ouC4ueC5iOC4reC4seC4meC4lOC4seC4muC4l+C4teC5iDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNnhsIGZvbnQtYm9sZCI+JHtteVJhbmsgPiAwID8gbXlSYW5rIDogJy0nfTwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTEyIHRleHQtZ3JheS0zMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gc3VtbWFyeUhUTUw7CiAgICAgICAgfQoKZnVuY3Rpb24gY3JlYXRlUXVpekZyb21CYW5rKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gc2hvd0FkbWluTG9iYnlWaWV3KGdhbWVQaW4sIHF1aXpUb3BpYykgewogICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOyAKCiAgICAvLyAtLS0gW1NUQVJUXSDguYHguIHguYnguYTguILguIHguLLguKPguYHguKrguJTguIfguJzguKXguIrguLfguYjguK3guJzguLnguYnguYDguKXguYjguJnguYPguKvguYnguKHguLXguJvguLjguYjguKHguYDguJXguLAgLS0tCiAgICBjb25zdCBsb2JieUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsIj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItMiI+4LmA4Lij4Li04LmI4Lih4LmA4LiB4LihOiAke3F1aXpUb3BpY308L2gyPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBtYi00Ij7guYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguYDguILguYnguLLguKPguYjguKfguKHguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYk6PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSB0ZXh0LWdyYXktODAwIHJvdW5kZWQtbGcgcC00IG1iLTQiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNnhsIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QiPiR7Z2FtZVBpbn08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbWQgYmctd2hpdGUvMjAgcC00IHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItMiI+4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihICg8c3BhbiBpZD0icGxheWVyLWNvdW50Ij4wPC9zcGFuPik8L2gzPgogICAgICAgICAgICAgICAgPGRpdiBpZD0icGxheWVyLWxpc3QtbG9iYnkiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIGlkPSJzdGFydC1nYW1lLWJ0biIgY2xhc3M9Im10LTYgYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgZGlzYWJsZWQ6YmctZ3JheS00MDAgZGlzYWJsZWQ6Y3Vyc29yLW5vdC1hbGxvd2VkIiBkaXNhYmxlZD4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiDguYDguKPguLTguYjguKHguIHguLLguKPguYHguILguYjguIfguILguLHguJkKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4giAtLS0KCiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gbG9iYnlIVE1MOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6IOC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4luC4suC4oeC4quC4s+C4q+C4o+C4seC4muC5gOC4geC4oeC4meC4teC5iSIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4OiAwLAogICAgICAgICAgICAgICAgcXVlc3Rpb25EaXNwbGF5ZWRBdDogc2VydmVyVGltZXN0YW1wKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBmaXJzdFF1ZXN0aW9uID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1swXTsKICAgICAgICAgICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgc2hvd0FkbWluTGl2ZVF1ZXN0aW9uVmlldyhmaXJzdFF1ZXN0aW9uLCAwLCB0b3RhbFF1ZXN0aW9ucyk7CgogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHN0YXJ0aW5nIGdhbWU6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmA4Lij4Li04LmI4Lih4LmA4LiB4Lih4LmE4LiU4LmJIik7CiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5RdWl6QmFua01vZGFsKCkgewogIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4seC5ieC4h+C4q+C4oeC4lCAo4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1KQogIGlmIChhbGxRdWl6emVzR2xvYmFsLmxlbmd0aCA9PT0gMCkgewogICAgY29uc3QgcXMgPSBhd2FpdCBnZXREb2NzKGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2ApKTsKICAgIGFsbFF1aXp6ZXNHbG9iYWwgPSBxcy5kb2NzLm1hcChkID0+ICh7IGlkOiBkLmlkLCAuLi5kLmRhdGEoKSB9KSk7CiAgfQogIC8vIOC5geC4quC4lOC4h+C4o+C4suC4ouC4geC4suC4o+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4mSBNb2RhbAogIHJlbmRlclF1aXpCYW5rTGlzdCgnJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwp9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclF1aXpCYW5rTGlzdCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkgLS0tCmZ1bmN0aW9uIHJlbmRlclF1aXpCYW5rTGlzdChmaWx0ZXJUZXh0ID0gJycsIHNlbGVjdGlvbk1vZGUgPSBmYWxzZSkgewogIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotbGlzdCcpOwogIGNvbnN0IHRlcm0gPSBmaWx0ZXJUZXh0LnRvTG93ZXJDYXNlKCkudHJpbSgpOwoKICBjb25zdCByb3dzID0gYWxsUXVpenplc0dsb2JhbAogICAgLm1hcChxID0+ICh7CiAgICAgIC4uLnEsCiAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICB9KSkKICAgIC5maWx0ZXIocSA9PgogICAgICAocS50b3BpYyB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5wcm9qZWN0TmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5pZC50b1N0cmluZygpLmluY2x1ZGVzKHRlcm0pKQogICAgKTsKCQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1jb3VudCcpLnRleHRDb250ZW50ID0gYCgke3Jvd3MubGVuZ3RofSDguIrguLjguJQpYDsKCiBsaXN0RWwuaW5uZXJIVE1MID0gcm93cy5sZW5ndGgKICA/IHJvd3MubWFwKHEgPT4gewogICAgICAvLyDguIvguYjguK3guJnguJvguLjguYjguKHguYDguITguKPguLfguYjguK3guIfguKHguLfguK3guJfguLHguYnguIfguKvguKHguJTguYDguKHguLfguYjguK3guK3guKLguLnguYjguYPguJkgc2VsZWN0aW9uTW9kZQogICAgICBjb25zdCBhY3Rpb25CdXR0b25zSFRNTCA9ICFzZWxlY3Rpb25Nb2RlID8gYAogICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC1weCBtbC00IHNocmluay0wIj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiB0aXRsZT0i4Lii4LmJ4Liy4Lii4LmE4Lib4LmC4Lib4Lij4LmA4LiI4LiE4Lit4Li34LmI4LiZIiBjbGFzcz0icXVpei1iYW5rLW1vdmUtYnRuIHRleHQtcHVycGxlLTYwMCBob3Zlcjp0ZXh0LXB1cnBsZS04MDAgdGV4dC14bCBwLTIgcm91bmRlZC1mdWxsIGhvdmVyOmJnLWdyYXktMjAwIj48aSBjbGFzcz0iZmFzIGZhLXByb2plY3QtZGlhZ3JhbSBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtxLmlkfSIgdGl0bGU9IuC4leC4seC5ieC4h+C4hOC5iOC4siIgY2xhc3M9InF1aXotYmFuay1zZXR0aW5ncy1idG4gdGV4dC1jeWFuLTYwMCBob3Zlcjp0ZXh0LWN5YW4tODAwIHRleHQteGwgcC0yIHJvdW5kZWQtZnVsbCBob3ZlcjpiZy1ncmF5LTIwMCI+PGkgY2xhc3M9ImZhcyBmYS1jb2cgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIHRpdGxlPSLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguITguLnguYjguILguJnguLLguJkiIGNsYXNzPSJxdWl6LWJhbmstcGFyYWxsZWwtYnRuIHRleHQtdGVhbC02MDAgaG92ZXI6dGV4dC10ZWFsLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtY2xvbmUgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIHRpdGxlPSLguYLguKvguKHguJTguJnguLPguYDguKrguJnguK0iIGNsYXNzPSJxdWl6LWJhbmstcHJlc2VudC1idG4gdGV4dC1pbmRpZ28tNjAwIGhvdmVyOnRleHQtaW5kaWdvLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiB0aXRsZT0i4LiX4LiU4Lil4Lit4LiH4LiX4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIiBjbGFzcz0icXVpei1iYW5rLXRyeS1idG4gdGV4dC1wdXJwbGUtNjAwIGhvdmVyOnRleHQtcHVycGxlLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtdmlhbCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtxLmlkfSIgZGF0YS10b3BpYz0iJHtxLnRvcGljfSIgdGl0bGU9IuC4peC4miIgY2xhc3M9InF1aXotYmFuay1kZWxldGUtYnRuIHRleHQtcmVkLTYwMCBob3Zlcjp0ZXh0LXJlZC04MDAgdGV4dC14bCBwLTIgcm91bmRlZC1mdWxsIGhvdmVyOmJnLWdyYXktMjAwIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIGAgOiAnJzsKCiAgICAgIHJldHVybiBgCiAgICAgIDxkaXYgY2xhc3M9InctZnVsbCB0ZXh0LWxlZnQgcC0zIGJvcmRlci1iIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgPGRpdiBkYXRhLWlkPSIke3EuaWR9IiBjbGFzcz0icXVpei1iYW5rLWl0ZW0gZmxleC1ncm93IGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTcwMCI+JHtxLnRvcGljIHx8ICco4LmE4Lih4LmI4Lih4Li14LiK4Li34LmI4LitKSd9CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtbm9ybWFsIHRleHQtZ3JheS01MDAiPigke3EucXVlc3Rpb25zPy5sZW5ndGggfHwgMH0g4LiC4LmJ4LitKTwvc3Bhbj4KICAgICAgICAgIDwvcD4KICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAiPuC5guC4m+C4o+C5gOC4iOC4hDogJHtxLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgZm9udC1tb25vIG10LTEiPlF1aXogSUQ6ICR7cS5pZH08L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgJHthY3Rpb25CdXR0b25zSFRNTH0KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpCiAgOiBgPGRpdiBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4nuC4muC5geC4muC4muC4l+C4lOC4quC4reC4mjwvZGl2PmA7CgogIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguYDguInguJ7guLLguLDguYDguKHguLfguYjguK3guYTguKHguYjguYTguJTguYnguK3guKLguLnguYjguYPguJkgc2VsZWN0aW9uTW9kZQogIGlmICghc2VsZWN0aW9uTW9kZSkgewogICAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1pdGVtJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgTW9kYWwKICAgICAgICAgIHNob3dRdWl6RGV0YWlsVmlldyhxdWl6SWQpOyAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKHguYDguJ7guLfguYjguK3guYTguJvguKvguJnguYnguLLguKfguLTguYDguITguKPguLLguLDguKvguYzguJzguKUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIAogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguJfguJTguKXguK3guIfguJfguLMiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay10cnktYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gYnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplc0dsb2JhbC5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICAgICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHN0YXJ0QWRtaW5UZXN0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7IHNob3dNZXNzYWdlKCfguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJonKTsgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguITguLnguYjguILguJnguLLguJkiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1wYXJhbGxlbC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBjb25zdCBxdWl6SWQgPSBidG4uZGF0YXNldC5pZDsKICAgICAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgICAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxGcm9tQmFuayhxdWl6RGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7IHNob3dNZXNzYWdlKCfguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJonKTsgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguJnguLPguYDguKrguJnguK0iCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1wcmVzZW50LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgc3RhcnRQcmVzZW50YXRpb24ocXVpekRhdGEpOwogICAgICAgICAgICB9IGVsc2UgeyBzaG93TWVzc2FnZSgn4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaJyk7IH0KICAgICAgICB9KTsKICAgIH0pOwoKICAgIC8vIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oSAi4Lii4LmJ4Liy4LiiIgogICAgbGlzdEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5xdWl6LWJhbmstbW92ZS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBjb25zdCBxdWl6SWQgPSBidG4uZGF0YXNldC5pZDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBoYW5kbGVNb3ZlUXVpeihxdWl6SWQpOyAKICAgICAgICB9KTsKICAgIH0pOwoJCgkvLyBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKEgIuC4leC4seC5ieC4h+C4hOC5iOC4siIKICAgIGxpc3RFbC5xdWVyeVNlbGVjdG9yQWxsKCcucXVpei1iYW5rLXNldHRpbmdzLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1iYW5rLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGhhbmRsZVF1aXpTZXR0aW5ncyhxdWl6SWQpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguKXguJoiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1kZWxldGUtYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gYnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gYnRuLmRhdGFzZXQudG9waWM7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke3RvcGljfSI/IOC4geC4suC4o+C4geC4o+C4sOC4l+C4s+C4meC4teC5ieC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4ouC5ieC4reC4meC4geC4peC4seC4muC5hOC4lOC5iWAsCiAgICAgICAgICAgICAgICAoKSA9PiBoYW5kbGVEZWxldGVRdWl6KHF1aXpJZCkKICAgICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0pOwogIH0KfQoKLy8g4LmD4LiZ4LmE4Lif4Lil4LmMIDUwLmh0bWwKLy8gLS0tIOC4meC4s+C5guC4hOC5ieC4lOC4meC4teC5ieC5hOC4m+C4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVDb21wYXJlUmVzdWx0cyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCgphc3luYyBmdW5jdGlvbiBoYW5kbGVDb21wYXJlUmVzdWx0cyhwb3N0VGVzdElkLCBwcmVUZXN0SWQpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tbW9kYWwnKTsKICAgIGNvbnN0IG92ZXJhbGxDb250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1vdmVyYWxsLWNvbnRlbnQnKTsKICAgIGNvbnN0IGluZGl2aWR1YWxDb250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1pbmRpdmlkdWFsLWNvbnRlbnQnKTsKICAgIAogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tb3ZlcmFsbC10YWInKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21wYXJpc29uLWluZGl2aWR1YWwtdGFiJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICBvdmVyYWxsQ29udGVudEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgaW5kaXZpZHVhbENvbnRlbnRFbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgb3ZlcmFsbENvbnRlbnRFbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CiAgICBpbmRpdmlkdWFsQ29udGVudEVsLmlubmVySFRNTCA9ICcnOwogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwb3N0VGVzdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcG9zdFRlc3RJZCk7CiAgICAgICAgY29uc3QgcG9zdFRlc3RTbmFwID0gYXdhaXQgZ2V0RG9jKHBvc3RUZXN0UmVmKTsKICAgICAgICBpZiAoIXBvc3RUZXN0U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguILguYnguK3guKrguK3guJrguKvguKXguLHguIfguYDguKPguLXguKLguJkiKTsKICAgICAgICBjb25zdCBwb3N0VGVzdERhdGEgPSBwb3N0VGVzdFNuYXAuZGF0YSgpOwogICAgICAgIGNvbnN0IHRvdGFsUXVlc3Rpb25zID0gcG9zdFRlc3REYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CgogICAgICAgIGNvbnN0IHByZVRlc3RTdWJtaXNzaW9uc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3ByZVRlc3RJZH0vc3VibWlzc2lvbnNgKTsKICAgICAgICBjb25zdCBwb3N0VGVzdFN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cG9zdFRlc3RJZH0vc3VibWlzc2lvbnNgKTsKICAgICAgICBjb25zdCBbcHJlVGVzdFN1Ym1pc3Npb25zU25hcCwgcG9zdFRlc3RTdWJtaXNzaW9uc1NuYXBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2dldERvY3MocHJlVGVzdFN1Ym1pc3Npb25zUmVmKSwgZ2V0RG9jcyhwb3N0VGVzdFN1Ym1pc3Npb25zUmVmKV0pOwogICAgICAgIGNvbnN0IHByZVRlc3RTdWJtaXNzaW9ucyA9IHByZVRlc3RTdWJtaXNzaW9uc1NuYXAuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgIGNvbnN0IHBvc3RUZXN0U3VibWlzc2lvbnMgPSBwb3N0VGVzdFN1Ym1pc3Npb25zU25hcC5kb2NzLm1hcChkb2MgPT4gZG9jLmRhdGEoKSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcHJlVGVzdFNjb3JlcyA9IHByZVRlc3RTdWJtaXNzaW9ucy5tYXAocyA9PiBzLmxhdGVzdFNjb3JlKTsKICAgICAgICBjb25zdCBwb3N0VGVzdFNjb3JlcyA9IHBvc3RUZXN0U3VibWlzc2lvbnMubWFwKHMgPT4gcy5sYXRlc3RTY29yZSk7CiAgICAgICAgCiAgICAgICAgLy8gLS0tIFNUQVJUOiDguKrguYjguKfguJnguIHguLLguKPguITguLPguJnguKfguJMgWi1TY29yZSDguYHguKXguLAgVC1TY29yZSAtLS0KICAgICAgICBjb25zdCBwcmVUZXN0U3RhdHMgPSBjYWxjdWxhdGVNZWFuQW5kU3RkRGV2KHByZVRlc3RTY29yZXMpOwogICAgICAgIGNvbnN0IHBvc3RUZXN0U3RhdHMgPSBjYWxjdWxhdGVNZWFuQW5kU3RkRGV2KHBvc3RUZXN0U2NvcmVzKTsKICAgICAgICAvLyAtLS0gRU5EOiDguKrguYjguKfguJnguIHguLLguKPguITguLPguJnguKfguJMgLS0tCgogICAgICAgIGNvbnN0IHByZVRlc3RBdmcgPSBwcmVUZXN0U3RhdHMubWVhbjsKICAgICAgICBjb25zdCBwb3N0VGVzdEF2ZyA9IHBvc3RUZXN0U3RhdHMubWVhbjsKICAgICAgICBjb25zdCBpbXByb3ZlbWVudCA9IHBvc3RUZXN0QXZnIC0gcHJlVGVzdEF2ZzsKCiAgICAgICAgbGV0IG92ZXJhbGxIdG1sID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0zIGdhcC00IG1iLTYiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJnLWJsdWUtMTAwIHJvdW5kZWQtbGcgdGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTgwMCI+4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiICjguIHguYjguK3guJnguYDguKPguLXguKLguJkpPC9wPjxwIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgdGV4dC1ibHVlLTkwMCI+JHtwcmVUZXN0QXZnLnRvRml4ZWQoMil9PC9wPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJnLWdyZWVuLTEwMCByb3VuZGVkLWxnIHRleHQtY2VudGVyIj48cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtZ3JlZW4tODAwIj7guITguLDguYHguJnguJnguYDguInguKXguLXguYjguKIgKOC4q+C4peC4seC4h+C5gOC4o+C4teC4ouC4mSk8L3A+PHAgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTkwMCI+JHtwb3N0VGVzdEF2Zy50b0ZpeGVkKDIpfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCAke2ltcHJvdmVtZW50ID49IDAgPyAnYmctZW1lcmFsZC0xMDAnIDogJ2JnLXJlZC0xMDAnfSByb3VuZGVkLWxnIHRleHQtY2VudGVyIj48cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkICR7aW1wcm92ZW1lbnQgPj0gMCA/ICd0ZXh0LWVtZXJhbGQtODAwJyA6ICd0ZXh0LXJlZC04MDAnfSI+4Lie4Lix4LiS4LiZ4Liy4LiB4Liy4Lij4LmA4LiJ4Lil4Li14LmI4LiiPC9wPjxwIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgJHtpbXByb3ZlbWVudCA+PSAwID8gJ3RleHQtZW1lcmFsZC05MDAnIDogJ3RleHQtcmVkLTkwMCd9Ij4ke2ltcHJvdmVtZW50ID49IDAgPyAnKycgOiAnJ30ke2ltcHJvdmVtZW50LnRvRml4ZWQoMil9PC9wPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdj48aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbWItMiB0ZXh0LWNlbnRlciI+4LiB4Lij4Liy4Lif4LmA4Lib4Lij4Li14Lii4Lia4LmA4LiX4Li14Lii4Lia4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiPC9oND48Y2FudmFzIGlkPSJjb21wYXJpc29uLWNoYXJ0Ij48L2NhbnZhcz48L2Rpdj5gOwogICAgICAgIG92ZXJhbGxDb250ZW50RWwuaW5uZXJIVE1MID0gb3ZlcmFsbEh0bWw7CiAgICAgICAgCiAgICAgICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tY2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGlmIChjaGFydEluc3RhbmNlcy5jb21wYXJpc29uKSBjaGFydEluc3RhbmNlcy5jb21wYXJpc29uLmRlc3Ryb3koKTsKICAgICAgICBjaGFydEluc3RhbmNlcy5jb21wYXJpc29uID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgICAgICB0eXBlOiAnYmFyJywKICAgICAgICAgICAgZGF0YTogeyBsYWJlbHM6IFsn4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiJ10sIGRhdGFzZXRzOiBbeyBsYWJlbDogJ+C4geC5iOC4reC4meC5gOC4o+C4teC4ouC4mScsIGRhdGE6IFtwcmVUZXN0QXZnXSwgYmFja2dyb3VuZENvbG9yOiAncmdiYSg1OSwgMTMwLCAyNDYsIDAuNyknIH0seyBsYWJlbDogJ+C4q+C4peC4seC4h+C5gOC4o+C4teC4ouC4mScsIGRhdGE6IFtwb3N0VGVzdEF2Z10sIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTYsIDE4NSwgMTI5LCAwLjcpJyB9XSB9LAogICAgICAgICAgICBvcHRpb25zOiB7IHNjYWxlczogeyB5OiB7IGJlZ2luQXRaZXJvOiB0cnVlLCBzdWdnZXN0ZWRNYXg6IHRvdGFsUXVlc3Rpb25zIH0gfSB9CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHN0dWRlbnRzID0gY3VycmVudFByb2plY3REYXRhLnN0dWRlbnRzIHx8IFtdOwogICAgICAgIGNvbnN0IGNvbXBhcmlzb25EYXRhID0gc3R1ZGVudHMubWFwKG5hbWUgPT4gewogICAgICAgICAgICBjb25zdCBwcmVTdWIgPSBwcmVUZXN0U3VibWlzc2lvbnMuZmluZChzID0+IHMuc3R1ZGVudE5hbWUgPT09IG5hbWUpOwogICAgICAgICAgICBjb25zdCBwb3N0U3ViID0gcG9zdFRlc3RTdWJtaXNzaW9ucy5maW5kKHMgPT4gcy5zdHVkZW50TmFtZSA9PT0gbmFtZSk7CiAgICAgICAgICAgIGNvbnN0IHByZVNjb3JlID0gcHJlU3ViID8gcHJlU3ViLmxhdGVzdFNjb3JlIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgcG9zdFNjb3JlID0gcG9zdFN1YiA/IHBvc3RTdWIubGF0ZXN0U2NvcmUgOiBudWxsOwogICAgICAgICAgICBjb25zdCBnYWluID0gKHByZVNjb3JlICE9PSBudWxsICYmIHBvc3RTY29yZSAhPT0gbnVsbCkgPyBwb3N0U2NvcmUgLSBwcmVTY29yZSA6IG51bGw7CgogICAgICAgICAgICAvLyAtLS0gU1RBUlQ6IOC4quC5iOC4p+C4meC4geC4suC4o+C4hOC4s+C4meC4p+C4kyBULVNjb3JlIOC4o+C4suC4ouC4muC4uOC4hOC4hOC4pSAtLS0KICAgICAgICAgICAgY29uc3QgcHJlWiA9IHByZVNjb3JlICE9PSBudWxsID8gY2FsY3VsYXRlWlNjb3JlKHByZVNjb3JlLCBwcmVUZXN0U3RhdHMubWVhbiwgcHJlVGVzdFN0YXRzLnN0ZERldikgOiBudWxsOwogICAgICAgICAgICBjb25zdCBwb3N0WiA9IHBvc3RTY29yZSAhPT0gbnVsbCA/IGNhbGN1bGF0ZVpTY29yZShwb3N0U2NvcmUsIHBvc3RUZXN0U3RhdHMubWVhbiwgcG9zdFRlc3RTdGF0cy5zdGREZXYpIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgcHJlVFNjb3JlID0gcHJlWiAhPT0gbnVsbCA/IGNhbGN1bGF0ZVRTY29yZShwcmVaKSA6IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHBvc3RUU2NvcmUgPSBwb3N0WiAhPT0gbnVsbCA/IGNhbGN1bGF0ZVRTY29yZShwb3N0WikgOiBudWxsOwogICAgICAgICAgICBjb25zdCB0R2FpbiA9IChwcmVUU2NvcmUgIT09IG51bGwgJiYgcG9zdFRTY29yZSAhPT0gbnVsbCkgPyBwb3N0VFNjb3JlIC0gcHJlVFNjb3JlIDogbnVsbDsKICAgICAgICAgICAgLy8gLS0tIEVORDog4Liq4LmI4Lin4LiZ4LiB4Liy4Lij4LiE4Liz4LiZ4Lin4LiTIFQtU2NvcmUgLS0tCgogICAgICAgICAgICByZXR1cm4geyBuYW1lLCBwcmVTY29yZSwgcG9zdFNjb3JlLCBnYWluLCBwcmVUU2NvcmUsIHBvc3RUU2NvcmUsIHRHYWluIH07CiAgICAgICAgfSk7CgogICAgICAgIHJlbmRlckluZGl2aWR1YWxDb21wYXJpc29uVGFibGUoY29tcGFyaXNvbkRhdGEsIGluZGl2aWR1YWxDb250ZW50RWwpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY29tcGFyaW5nIHJlc3VsdHM6IiwgZXJyb3IpOwogICAgICAgIG92ZXJhbGxDb250ZW50RWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAgdGV4dC1jZW50ZXIiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4mjwvcD4nOwogICAgfQp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IFvguYPguKvguKHguYhdIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4miBCbHVlcHJpbnQgUHJvamVjdCBNYW5hZ2VyID09PQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8qKgogKiBbMV0g4Lia4Lix4LiZ4LiX4Li24LiB4LiC4LmJ4Lit4Lih4Li54Lil4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiBIEJsdWVwcmludCDguKXguIcgRmlyZXN0b3JlIOC5gOC4m+C5h+C4meC5guC4m+C4o+C5gOC4iOC4hOC5g+C4q+C4oeC5iAogKi8KYXN5bmMgZnVuY3Rpb24gc2F2ZUJsdWVwcmludFByb2plY3QoKSAgeyAvKiBSZW1vdmVkICovIH0gCgovKioKICogWzJdIOC5gOC4m+C4tOC4lCBNb2RhbCDguYHguKXguLDguYHguKrguJTguIfguKPguLLguKLguIHguLLguKPguYLguJvguKPguYDguIjguITguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYkKICovCmFzeW5jIGZ1bmN0aW9uIHNob3dCbHVlcHJpbnRQcm9qZWN0cygpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0cy1tb2RhbCcpOwogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LWxpc3QnKTsKICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguLPguKXguLHguIfguYLguKvguKXguJQuLi48L3A+JzsKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKdHJ5IHsKICAgIGNvbnN0IHByb2plY3RzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0c2ApOwogICAgLy8gdnZ2IOC5geC4geC5ieC5hOC4guC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iSB2dnYKICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhwcm9qZWN0c1JlZik7IAoKICAgICAgICBpZiAoc25hcHNob3QuZW1wdHkpIHsKICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5iTwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKICAgICAgICBwcm9qZWN0cy5zb3J0KChhLCBiKSA9PiBhLnByb2plY3ROYW1lLmxvY2FsZUNvbXBhcmUoYi5wcm9qZWN0TmFtZSwgJ3RoJykpOwoKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gcHJvamVjdHMubWFwKHAgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC10ZWFsLTcwMCI+JHtwLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4ke3AuZ3JhZGVMZXZlbH0gfCAke09iamVjdC5rZXlzKHAudG9waWNzKS5sZW5ndGh9IOC4q+C4seC4p+C4guC5ieC4rTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cC5pZH0iIGNsYXNzPSJvcGVuLWJwLXByb2plY3QtYnRuIGJnLWJsdWUtMTAwIHRleHQtYmx1ZS03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1ibHVlLTIwMCI+4LmA4Lib4Li04LiUPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3AuaWR9IiBjbGFzcz0iZGVsZXRlLWJwLXByb2plY3QtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCBtbC0yIj7guKXguJo8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgYmx1ZXByaW50IHByb2plY3RzOiIsIGVycm9yKTsKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1yZWQtNTAwIj7guYTguKHguYjguKrguLLguKHguLLguKPguJbguYLguKvguKXguJTguKPguLLguKLguIHguLLguKPguYTguJTguYk8L3A+JzsKICAgIH0KfQoKLyoqCiAqIFszXSDguYHguKrguJTguIfguKvguJnguYnguLLguIjguK3guIjguLHguJTguIHguLLguKPguKvguLHguKfguILguYnguK3guILguK3guIfguYLguJvguKPguYDguIjguITguJfguLXguYjguYDguKXguLfguK3guIEKICovCmFzeW5jIGZ1bmN0aW9uIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihwcm9qZWN0SWQpIHsKICAgIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQgPSBwcm9qZWN0SWQ7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXByb2plY3RzLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbAogICAgc2hvd1ZpZXcoJ2FkbWluLWRhc2hib2FyZCcpOyAvLyDguKPguLXguYDguIvguYfguJUgdmlldyDguIHguYjguK3guJkKICAgIHByb2plY3REYXNoYm9hcmRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgZGFzaGJvYXJkIOC4q+C4peC4seC4gQoKICAgIGNvbnN0IG1hbmFnZXJWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpOwogICAgbWFuYWdlclZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtdG9waWMtbGlzdC1jb250YWluZXInKS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgcHJvamVjdElkKTsKICAgICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwoKICAgICAgICBpZiAoIWRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguYLguJvguKPguYDguIjguIQiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSB7IGlkOiBkb2NTbmFwLmlkLCAuLi5kb2NTbmFwLmRhdGEoKSB9OwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1wcm9qZWN0LXRpdGxlJykudGV4dENvbnRlbnQgPSBwcm9qZWN0RGF0YS5wcm9qZWN0TmFtZTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtcmVmZXJlbmNlLWZpbGUtdXJsJykudmFsdWUgPSBwcm9qZWN0RGF0YS5yZWZlcmVuY2VGaWxlVXJsIHx8ICcnOwogICAgICAgIHJlbmRlckJsdWVwcmludFRvcGljTWFuYWdlcihwcm9qZWN0RGF0YSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGRpc3BsYXlpbmcgYmx1ZXByaW50IHByb2plY3Q6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGVycm9yLm1lc3NhZ2UpOwogICAgICAgIHNob3dWaWV3KCdhZG1pbi1kYXNoYm9hcmQnKTsgLy8g4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiB4LiW4LmJ4LiyIEVycm9yCiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgcmVuZGVyQmx1ZXByaW50VG9waWNNYW5hZ2VyIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZnVuY3Rpb24gcmVuZGVyQmx1ZXByaW50VG9waWNNYW5hZ2VyKHByb2plY3REYXRhKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtdG9waWMtbGlzdC1jb250YWluZXInKTsKICAgIGNvbnN0IHRvcGljc01hcCA9IHByb2plY3REYXRhLnRvcGljcyB8fCB7fTsKCiAgICBpZiAoT2JqZWN0LmtleXModG9waWNzTWFwKS5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguKvguLHguKfguILguYnguK3guYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIFsgU1RBUlQ6IOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC4l+C4teC5iOC4quC4s+C4hOC4seC4jeC4l+C4teC5iOC4quC4uOC4lCBdIC0tLQogICAgLy8gMS4g4LmB4Lib4Lil4LiHIE9iamVjdCDguYDguJvguYfguJkgQXJyYXkg4LmB4Lil4Liw4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LiV4Liy4LihICdvcmRlcicg4LiX4Li14LmI4Lia4Lix4LiZ4LiX4Li24LiB4LmE4Lin4LmJCiAgICBjb25zdCBzb3J0ZWRUb3BpY3NBcnJheSA9IE9iamVjdC5lbnRyaWVzKHRvcGljc01hcCkKICAgICAgICAubWFwKChbaWQsIGRhdGFdKSA9PiAoeyBpZCwgLi4uZGF0YSB9KSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gKGEub3JkZXIgPz8gSW5maW5pdHkpIC0gKGIub3JkZXIgPz8gSW5maW5pdHkpKTsKCiAgICAvLyAyLiDguIjguLHguJTguIHguKXguLjguYjguKHguILguYnguK3guKHguLnguKXguYPguKvguKHguYjguIjguLLguIEgQXJyYXkg4LiX4Li14LmI4LmA4Lij4Li14Lii4LiH4Lil4Liz4LiU4Lix4Lia4LmB4Lil4LmJ4LinCiAgICBjb25zdCBncm91cGVkVG9waWNzID0ge307CiAgICBzb3J0ZWRUb3BpY3NBcnJheS5mb3JFYWNoKHRvcGljID0+IHsKICAgICAgICBjb25zdCB7IHNhcmEsIG1haW5Ub3BpYyB9ID0gdG9waWM7CiAgICAgICAgaWYgKCFncm91cGVkVG9waWNzW3NhcmFdKSB7CiAgICAgICAgICAgIGdyb3VwZWRUb3BpY3Nbc2FyYV0gPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKCFncm91cGVkVG9waWNzW3NhcmFdW21haW5Ub3BpY10pIHsKICAgICAgICAgICAgZ3JvdXBlZFRvcGljc1tzYXJhXVttYWluVG9waWNdID0gW107CiAgICAgICAgfQogICAgICAgIGdyb3VwZWRUb3BpY3Nbc2FyYV1bbWFpblRvcGljXS5wdXNoKHRvcGljKTsKICAgIH0pOwogICAgLy8gLS0tIFsgRU5EOiDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguYHguIHguYnguYTguIIgXSAtLS0KCiAgICBsZXQgaHRtbCA9ICcnOwogICAgLy8gMy4g4Lin4LiZ4Lil4Li54Lib4LmB4Liq4LiU4LiH4Lic4Lil4LmC4LiU4LiiICLguYTguKHguYjguYPguIrguYkgLnNvcnQoKSIg4Lit4Li14LiB4LiV4LmI4Lit4LmE4LibIOC5gOC4nuC4t+C5iOC4reC4o+C4seC4geC4qeC4peC4s+C4lOC4seC4muC5gOC4lOC4tOC4oQogICAgZm9yIChjb25zdCBzYXJhIGluIGdyb3VwZWRUb3BpY3MpIHsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCBzaGFkb3ctc20gbWItNCI+PGg0IGNsYXNzPSJmb250LWJvbGQgdGV4dC14bCB0ZXh0LWJsdWUtODAwIG1iLTMiPiR7c2FyYX08L2g0PmA7CiAgICAgICAgCiAgICAgICAgZm9yIChjb25zdCBtYWluVG9waWMgaW4gZ3JvdXBlZFRvcGljc1tzYXJhXSkgewogICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJtbC00IG1iLTMiPjxoNSBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWxnIHRleHQtZ3JheS03MDAgbWItMiI+JHttYWluVG9waWN9PC9oNT48ZGl2IGNsYXNzPSJzcGFjZS15LTEgcGwtNCBib3JkZXItbC0yIGJvcmRlci1ncmF5LTIwMCI+YDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4guC5ieC4reC4oeC4ueC4peC5g+C4meC4meC4teC5ieC4iOC4sOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC4luC4ueC4geC4leC5ieC4reC4h+C4reC4ouC4ueC5iOC5geC4peC5ieC4pwogICAgICAgICAgICBncm91cGVkVG9waWNzW3NhcmFdW21haW5Ub3BpY10uZm9yRWFjaCh0b3BpYyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpZCA9IHRvcGljLmlkOwogICAgICAgICAgICAgICAgY29uc3QgbGlua2VkUXVpenplcyA9IHRvcGljLmxpbmtlZFF1aXpJZHMgfHwgW107CiAgICAgICAgICAgICAgICBjb25zdCBpc0xpbmtlZCA9IGxpbmtlZFF1aXp6ZXMubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzTGVzc29uR2VuZXJhdGVkID0gdG9waWMuc3RhdHVzID09PSAnZ2VuZXJhdGVkJzsKCiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzQmFkZ2UgPSAnJzsKICAgICAgICAgICAgICAgIGlmIChpc0xpbmtlZCkgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0JhZGdlID0gYDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiBweS0xIHJvdW5kZWQtZnVsbCBiZy1jeWFuLTIwMCB0ZXh0LWN5YW4tODAwIj7guYDguIrguLfguYjguK3guKHguYLguKLguIfguYHguKXguYnguKcgKCR7bGlua2VkUXVpenplcy5sZW5ndGh9IOC4iuC4uOC4lCk8L3NwYW4+YDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQmFkZ2UgPSBgPHNwYW4gY2xhc3M9InRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHB5LTEgcm91bmRlZC1mdWxsICR7aXNMZXNzb25HZW5lcmF0ZWQgPyAnYmctZ3JlZW4tMjAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNzAwJ30iPiR7aXNMZXNzb25HZW5lcmF0ZWQgPyAn4Liq4Lij4LmJ4Liy4LiH4LmB4Lil4LmJ4LinJyA6ICfguKLguLHguIfguYTguKHguYjguKrguKPguYnguLLguIcnfTwvc3Bhbj5gOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvbkRlcGVuZGVudEJ0bkRpc2FibGVkID0gIWlzTGVzc29uR2VuZXJhdGVkID8gJ2Rpc2FibGVkIGJnLWdyYXktNDAwIGN1cnNvci1ub3QtYWxsb3dlZCcgOiAnJzsKICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvbkRlcGVuZGVudEJ0blRpdGxlID0gIWlzTGVzc29uR2VuZXJhdGVkID8gJ+C4geC4o+C4uOC4k+C4suC4quC4o+C5ieC4suC4h+C4muC4l+C5gOC4o+C4teC4ouC4meC4geC5iOC4reC4mScgOiAnJzsKCiAgICAgICAgICAgICAgICBsZXQgbGVzc29uQnV0dG9uc0hUTUwgPSBpc0xlc3NvbkdlbmVyYXRlZAogICAgICAgICAgICAgICAgICAgID8gYDxidXR0b24gY2xhc3M9InZpZXctYnAtbGVzc29uLWJ0biB0ZXh0LXdoaXRlIGJnLWJsdWUtNjAwIGhvdmVyOm9wYWNpdHktODAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIj7guJTguLnguJrguJfguYDguKPguLXguKLguJk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJicC1nZW5lcmF0ZS1sZXNzb24tYnRuIHRleHQtd2hpdGUgYmctcHVycGxlLTYwMCBob3ZlcjpvcGFjaXR5LTgwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCI+4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmIPC9idXR0b24+YAogICAgICAgICAgICAgICAgICAgIDogYDxidXR0b24gY2xhc3M9ImJwLWdlbmVyYXRlLWxlc3Nvbi1idG4gdGV4dC13aGl0ZSBiZy10ZWFsLTYwMCBob3ZlcjpvcGFjaXR5LTgwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCI+4Liq4Lij4LmJ4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZPC9idXR0b24+YDsKCiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTIgYm9yZGVyLWIgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIGhvdmVyOmJnLXdoaXRlIiBkYXRhLXRvcGljLWlkPSIke2lkfSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCIgZGF0YS1maWVsZD0ic3ViVG9waWMiPiR7dG9waWMuc3ViVG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNCYWRnZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLW9wZW4tdG9waWMtYmFuay1idG4gdGV4dC1wdXJwbGUtNzAwIGJnLXB1cnBsZS0xMDAgaG92ZXI6YmctcHVycGxlLTIwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMSBweC0zIHJvdW5kZWQtbWQiIHRpdGxlPSLguYDguJvguLTguJTguITguKXguLHguIfguYHguJrguJrguJfguJTguKrguK3guJrguJvguKPguLDguIjguLPguKvguLHguKfguILguYnguK0iPjxpIGNsYXNzPSJmYXMgZmEtYm9vay1vcGVuIj48L2k+IOC4hOC4peC4seC4hzwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtY3JlYXRlLXRvcGljLXF1aXotYnRuIHRleHQtaW5kaWdvLTcwMCBiZy1pbmRpZ28tMTAwIGhvdmVyOmJnLWluZGlnby0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiI4Liy4LiB4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4LitIj7guKrguKPguYnguLLguIcgKOC4q+C4seC4p+C4guC5ieC4rSk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLWNyZWF0ZS1jb250ZW50LXF1aXotYnRuIHRleHQtaW5kaWdvLTcwMCBiZy1pbmRpZ28tMTAwIGhvdmVyOmJnLWluZGlnby0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kICR7bGVzc29uRGVwZW5kZW50QnRuRGlzYWJsZWR9IiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Lix4LmI4Lin4LmE4Lib4LiI4Liy4LiB4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4Lia4LiX4LmA4Lij4Li14Lii4LiZICR7bGVzc29uRGVwZW5kZW50QnRuVGl0bGV9Ij7guKrguKPguYnguLLguIcgKOC5gOC4meC4t+C5ieC4reC4q+C4sik8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtY3JlYXRlLW9uZXQtcXVpei1idG4gdGV4dC13aGl0ZSBiZy1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby03MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lib4Lij4Liw4Lii4Li44LiB4LiV4LmMIChPLU5FVCkg4LiI4Liy4LiB4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4LitIj7guKrguKPguYnguLLguIcgKE8tTkVUKTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2xlc3NvbkJ1dHRvbnNIVE1MfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtZWRpdC10b3BpYy1idG4gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWJsdWUtNjAwIiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIj48aSBjbGFzcz0iZmFzIGZhLWVkaXQiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLWRlbGV0ZS10b3BpYy1idG4gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LXJlZC02MDAiIHRpdGxlPSLguKXguJoiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PjwvZGl2PmA7CiAgICAgICAgfQogICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICB9CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVlcERlbGV0ZUJsdWVwcmludFByb2plY3QocHJvamVjdElkKSB7CiAgICAvLyAxLiDguJTguLbguIfguILguYnguK3guKHguLnguKXguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guKvguLLguIrguLfguYjguK3guKHguLLguKLguLfguJnguKLguLHguJkKICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBwcm9qZWN0SWQpOwogICAgY29uc3QgcHJvamVjdFNuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4peC4miIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdFNuYXAuZGF0YSgpLnByb2plY3ROYW1lOwoKICAgIC8vIDIuIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4leC5iOC4suC4h+C4ouC4t+C4meC4ouC4seC4meC4l+C4teC5iOC4iuC4seC4lOC5gOC4iOC4meC5geC4peC4sOC4reC4seC4meC4leC4o+C4suC4ogogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiIIDEwMCUg4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmC4Lib4Lij4LmA4LiI4LiEICIke3Byb2plY3ROYW1lfSI/IOC4geC4suC4o+C4geC4o+C4sOC4l+C4s+C4meC4teC5ieC4iOC4sOC4peC4miAi4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIiDguYHguKXguLAgIuC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4h+C4reC4ouC4ueC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCIg4Lit4Lii4LmI4Liy4LiH4LiW4Liy4Lin4LijIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4geC4ueC5ieC4hOC4t+C4meC5hOC4lOC5iSFgLAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4s+C4peC4seC4h+C4peC4muC5guC4m+C4o+C5gOC4iOC4hOC5geC4peC4sOC4guC5ieC4reC4oeC4ueC4peC4l+C4teC5iOC5gOC4geC4teC5iOC4ouC4p+C4guC5ieC4reC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lC4uLiIpOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IHByb2plY3RTbmFwLmRhdGEoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvcGljcyA9IHByb2plY3REYXRhLnRvcGljcyB8fCB7fTsKCiAgICAgICAgICAgICAgICAvLyAzLiDguKPguKfguJrguKPguKfguKEgSUQg4LiC4Lit4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4Lie4Li34LmI4Lit4Liq4Lix4LmI4LiH4Lil4LiaCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRvcGljSWQgaW4gdG9waWNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVzc29uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzLyR7cHJvamVjdElkfS9sZXNzb25zYCwgdG9waWNJZCk7CiAgICAgICAgICAgICAgICAgICAgYmF0Y2guZGVsZXRlKGxlc3NvblJlZik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNC4g4Lij4Lin4Lia4Lij4Lin4LihIElEIOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lCAo4LmD4LiK4LmJIFNldCDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguKXguJrguIvguYnguLMpCiAgICAgICAgICAgICAgICBjb25zdCBhbGxMaW5rZWRRdWl6SWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCB0b3BpY0lkIGluIHRvcGljcykgewogICAgICAgICAgICAgICAgICAgIGlmICh0b3BpY3NbdG9waWNJZF0ubGlua2VkUXVpeklkcykgewogICAgICAgICAgICAgICAgICAgICAgICB0b3BpY3NbdG9waWNJZF0ubGlua2VkUXVpeklkcy5mb3JFYWNoKGlkID0+IGFsbExpbmtlZFF1aXpJZHMuYWRkKGlkKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDUuIOC4quC4seC5iOC4h+C4peC4muC5geC4muC4muC4l+C4lOC4quC4reC4muC5geC4leC5iOC4peC4sOC4iuC4uOC4lCAo4LiV4LmJ4Lit4LiH4LiX4Liz4LiZ4Lit4LiBIGJhdGNoIOC5gOC4nuC4o+C4suC4sCBoYW5kbGVEZWxldGVRdWl6IOC4oeC4teC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4i+C4seC4muC4i+C5ieC4reC4meC4guC4reC4h+C4leC4seC4p+C5gOC4reC4hykKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcXVpeklkIG9mIGFsbExpbmtlZFF1aXpJZHMpIHsKICAgICAgICAgICAgICAgICAgICAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguKXguJrguYHguJrguJrguJfguJTguKrguK3guJrguYDguJTguLTguKEg4LmB4LiV4LmI4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4Liq4LiU4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li44LiB4LiE4Lij4Lix4LmJ4LiHCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgaGFuZGxlRGVsZXRlUXVpeihxdWl6SWQsIGZhbHNlKTsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNi4g4Liq4Lix4LmI4LiH4Lil4Lia4LiV4Lix4Lin4LmC4Lib4Lij4LmA4LiI4LiEIEJsdWVwcmludCDguYDguK3guIcKICAgICAgICAgICAgICAgIGJhdGNoLmRlbGV0ZShwcm9qZWN0UmVmKTsKCiAgICAgICAgICAgICAgICAvLyA3LiDguKLguLfguJnguKLguLHguJnguIHguLLguKPguKXguJrguJfguLHguYnguIfguKvguKHguJTguYPguJnguITguKPguLHguYnguIfguYDguJTguLXguKLguKcKICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguKXguJrguYLguJvguKPguYDguIjguIQgIiR7cHJvamVjdE5hbWV9IiDguYHguKXguLDguILguYnguK3guKHguLnguKXguJfguLXguYjguYDguIrguLfguYjguK3guKHguYLguKLguIfguJfguLHguYnguIfguKvguKHguJTguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgICAgICAgICBzaG93Qmx1ZXByaW50UHJvamVjdHMoKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiK4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiE4LmD4LiZIE1vZGFsCgogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIGRlZXAgZGVsZXRlOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguKPguYnguLLguKLguYHguKPguIfguKPguLDguKvguKfguYjguLLguIfguIHguLLguKPguKXguJrguILguYnguK3guKHguLnguKUiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpOwogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLWJhbmstbGlzdCcpOwogICAgY29uc3QgY2xlYXJBbGxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItYWxsLWxpbmtzLWJ0bicpOyAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguJTguLbguIfguJvguLjguYjguKHguYPguKvguKHguYgKICAgIAogICAgdHJ5IHsKICAgICAgICBhd2FpdCBlbnN1cmVHbG9iYWxRdWl6emVzTG9hZGVkKCk7CgogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBjb25zdCBwcm9qZWN0U25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBwcm9qZWN0U25hcC5kYXRhKCk7CiAgICAgICAgY29uc3QgdG9waWNEYXRhID0gcHJvamVjdERhdGEudG9waWNzW3RvcGljSWRdOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9waWMtYmFuay1zdWJ0b3BpYy1uYW1lJykudGV4dENvbnRlbnQgPSB0b3BpY0RhdGEuc3ViVG9waWM7CiAgICAgICAgCiAgICAgICAgY29uc3QgbGlua2VkUXVpeklkcyA9IHRvcGljRGF0YS5saW5rZWRRdWl6SWRzIHx8IFtdOwoKICAgICAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguITguKfguJrguITguLjguKHguIHguLLguKPguYHguKrguJTguIfguJzguKXguILguK3guIfguJvguLjguYjguKEgIuC4peC5ieC4suC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lCIKICAgICAgICBjbGVhckFsbEJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBsaW5rZWRRdWl6SWRzLmxlbmd0aCA9PT0gMCk7CiAgICAgICAgY2xlYXJBbGxCdG4ub25jbGljayA9ICgpID0+IGhhbmRsZUNsZWFyQWxsTGlua3NGb3JUb3BpYyh0b3BpY0lkKTsKCiAgICAgICAgaWYgKGxpbmtlZFF1aXpJZHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAgcC04Ij7guITguKXguLHguIfguJnguLXguYnguKLguLHguIfguKfguYjguLLguIfguK3guKLguLnguYg8YnI+4LiE4Lil4Li04LiBICLguYDguKXguLfguK3guIHguIjguLLguIHguITguKXguLHguIfguKPguKfguKEiIOC5gOC4nuC4t+C5iOC4reC5gOC4nuC4tOC5iOC4oeC5geC4muC4muC4l+C4lOC4quC4reC4mjwvcD4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmtlZFF1aXp6ZXMgPSBhbGxRdWl6emVzR2xvYmFsLmZpbHRlcihxID0+IGxpbmtlZFF1aXpJZHMuaW5jbHVkZXMocS5pZCkpOwogICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gbGlua2VkUXVpenplcy5tYXAocSA9PiBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIGhvdmVyOmJnLWdyYXktNTAiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1xdWl6LWlkPSIke3EuaWR9IiBjbGFzcz0iYnAtdmlldy1hbmFseXNpcy1idG4gZmxleC1ncm93IGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtxLnRvcGljfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCBmb250LW1vbm8gcG9pbnRlci1ldmVudHMtbm9uZSI+SUQ6ICR7cS5pZH0gfCAke3EucXVlc3Rpb25zLmxlbmd0aH0g4LiC4LmJ4LitPC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC1wcmVzZW50LWJ0biB0ZXh0LXB1cnBsZS04MDAgYmctcHVycGxlLTEwMCBob3ZlcjpiZy1wdXJwbGUtMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IuC4meC4s+C5gOC4quC4meC4rSI+PGkgY2xhc3M9ImZhcyBmYS1jaGFsa2JvYXJkLXRlYWNoZXIiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC10cnktYnRuIHRleHQtdGVhbC04MDAgYmctdGVhbC0xMDAgaG92ZXI6YmctdGVhbC0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4LiX4LiU4Lil4Lit4LiHIj48aSBjbGFzcz0iZmFzIGZhLXZpYWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC1saXZlLWJ0biB0ZXh0LW9yYW5nZS04MDAgYmctb3JhbmdlLTEwMCBob3ZlcjpiZy1vcmFuZ2UtMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IuC5geC4guC5iOC4h+C4guC4seC4meC4quC4lCI+PGkgY2xhc3M9ImZhcyBmYS1mbGFnLWNoZWNrZXJlZCI+PC9pPjwvYnV0dG9uPgoKPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGRhdGEtbW9kZT0ic3luYyIgY2xhc3M9ImJwLWdhbWUtYnRuIHRleHQtd2hpdGUgYmctaW5kaWdvLTYwMCBob3ZlcjpiZy1pbmRpZ28tNzAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IlN5bmMgTW9kZSI+CiAgICA8aSBjbGFzcz0iZmFzIGZhLWJvbHQiPjwvaT4gU3luYwo8L2J1dHRvbj4KCjxidXR0b24gZGF0YS10b3BpYy1pZD0iJHt0b3BpY0lkfSIgZGF0YS1xdWl6LWlkPSIke3EuaWR9IiBjbGFzcz0iYnAtdW5saW5rLXF1aXotYnRuIHRleHQtcmVkLTgwMCBiZy1yZWQtMTAwIGhvdmVyOmJnLXJlZC0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4LiZ4Liz4Lit4Lit4LiB4LiI4Liy4LiB4LiE4Lil4Lix4LiH4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGApLmpvaW4oJycpOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1mcm9tLWdsb2JhbC1iYW5rLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgIG9wZW5RdWl6U2VsZWN0b3JGb3JCbHVlcHJpbnQodG9waWNJZCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtdG9waWMtYmFuay1idG4nKS5vbmNsaWNrID0gKCkgPT4gbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBzaG93TWVzc2FnZShlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBvcGVuUXVpelNlbGVjdG9yRm9yQmx1ZXByaW50IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSAtLS0KYXN5bmMgZnVuY3Rpb24gb3BlblF1aXpTZWxlY3RvckZvckJsdWVwcmludCh0b3BpY0lkKSB7CiAgICBjb25zdCBnbG9iYWxCYW5rTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1iYW5rLW1vZGFsJyk7CiAgICBjb25zdCB0b3BpY0JhbmtNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BpYy1xdWl6LWJhbmstbW9kYWwnKTsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0gMS4g4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHICLguITguKXguLHguIfguJvguKPguLDguIjguLPguKvguLHguKfguILguYnguK0iIOC4geC5iOC4reC4meC5gOC4quC4oeC4rQogICAgdG9waWNCYW5rTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbGluay1xdWl6LWJ0bicpPy5yZW1vdmUoKTsKCiAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBjb25maXJtQnRuLmlkID0gJ2NvbmZpcm0tbGluay1xdWl6LWJ0bic7CiAgICBjb25maXJtQnRuLmNsYXNzTmFtZSA9ICdiZy1wdXJwbGUtNjAwIHRleHQtd2hpdGUgcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1wdXJwbGUtNzAwIGRpc2FibGVkOmJnLWdyYXktNDAwJzsKICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lij4Liy4Lii4LiB4Liy4Lij4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBJzsKICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlOwoKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgZW5zdXJlR2xvYmFsUXVpenplc0xvYWRlZCgpOwoKICAgICAgICBnbG9iYWxCYW5rTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgcmVuZGVyUXVpekJhbmtMaXN0Rm9yTXVsdGlTZWxlY3QoJycpOwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWxrLXF1aXotc2V0dGluZ3MtYnRuJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBnbG9iYWxCYW5rTW9kYWwucXVlcnlTZWxlY3RvcignLmZsZXguanVzdGlmeS1iZXR3ZWVuLml0ZW1zLWNlbnRlcicpLmFwcGVuZENoaWxkKGNvbmZpcm1CdG4pOwoKICAgICAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSAyLiDguKrguKPguYnguLLguIfguJ/guLHguIfguIHguYzguIrguLHguJkgY2xlYW51cCDguYPguKvguKHguYjguYPguKvguYnguIHguKXguLHguJrguKHguLLguYDguJvguLTguJTguKvguJnguYnguLLguJXguYjguLLguIfguYDguJTguLTguKEKICAgICAgICBjb25zdCBjbGVhbnVwID0gKHNob3VsZFJlb3BlblRvcGljQmFuayA9IGZhbHNlKSA9PiB7CiAgICAgICAgICAgIGdsb2JhbEJhbmtNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1idG4nKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBjb25maXJtQnRuLnJlbW92ZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiIICjguYDguIrguYjguJkg4LiB4LiU4Lii4LiB4LmA4Lil4Li04LiBKSDguYPguKvguYnguIHguKXguLHguJrguKHguLLguYDguJvguLTguJTguKvguJnguYnguLIgIuC4hOC4peC4seC4h+C4m+C4o+C4sOC4iOC4s+C4q+C4seC4p+C4guC5ieC4rSIg4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiHCiAgICAgICAgICAgIGlmIChzaG91bGRSZW9wZW5Ub3BpY0JhbmspIHsKICAgICAgICAgICAgICAgIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY29uZmlybUJ0bi5vbmNsaWNrID0gYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWxlY3RlZElkcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1jaGVja2JveDpjaGVja2VkJykpLm1hcChjYiA9PiBjYi52YWx1ZSk7CiAgICAgICAgICAgIGlmIChzZWxlY3RlZElkcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gKGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKSkuZGF0YSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudExpbmtlZElkcyA9IHByb2plY3REYXRhLnRvcGljc1t0b3BpY0lkXS5saW5rZWRRdWl6SWRzIHx8IFtdOwogICAgICAgICAgICAgICAgY29uc3QgbmV3SWRzID0gWy4uLm5ldyBTZXQoWy4uLmN1cnJlbnRMaW5rZWRJZHMsIC4uLnNlbGVjdGVkSWRzXSldOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICAgICAgICAgIFtgdG9waWNzLiR7dG9waWNJZH0ubGlua2VkUXVpeklkc2BdOiBuZXdJZHMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4nuC4tOC5iOC4oSAke3NlbGVjdGVkSWRzLmxlbmd0aH0g4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lil4LiH4LmD4LiZ4LiE4Lil4Lix4LiH4Liq4Liz4LmA4Lij4LmH4LiIIWApOwogICAgICAgICAgICAgICAgY2xlYW51cCh0cnVlKTsgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJIGNsZWFudXAg4LmB4Lil4Liw4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04LihCiAgICAgICAgICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGxpbmtpbmcgcXVpenplczoiLCBlcnJvcik7IH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1iYW5rLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBjbGVhbnVwKHRydWUpOyAvLyDguIHguJTguKLguIHguYDguKXguLTguIEg4LmD4Lir4LmJIGNsZWFudXAg4LmB4Lil4Liw4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04LihCgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBzaG93TWVzc2FnZShlcnJvci5tZXNzYWdlKTsKICAgICAgICAvLyDguKvguLLguIHguYDguIHguLTguJQgRXJyb3Ig4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04Lih4LiU4LmJ4Lin4LiiCiAgICAgICAgdG9waWNCYW5rTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICB9Cn0KCgpmdW5jdGlvbiBoYW5kbGVDbGVhckxpbmtlZFF1aXoodG9waWNJZCkgewogICAgc2hvd0NvbmZpcm1hdGlvbigi4LiE4Li44LiT4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJ4LmD4LiK4LmI4Lir4Lij4Li34Lit4LmE4Lih4LmIPyIsIGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7CiAgICAgICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9LmxpbmtlZFF1aXpJZGBdOiBkZWxldGVGaWVsZCgpIC8vIOC5g+C4iuC5iSBkZWxldGVGaWVsZCgpIOC5gOC4nuC4t+C5iOC4reC4peC4miBrZXkg4Lit4Lit4LiBCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiK4Lir4LiZ4LmJ4Liy4LiI4LitCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY2xlYXJpbmcgbGlua2VkIHF1aXo6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUIik7CiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGFkZFRvcGljVG9Qcm9qZWN0KCkgewogICAgY29uc3QgbmV3VG9waWNOYW1lID0gcHJvbXB0KCLguIHguKPguLjguJPguLLguJvguYnguK3guJnguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guKLguYjguK3guKLguYPguKvguKHguYg6Iik7CiAgICBpZiAoIW5ld1RvcGljTmFtZSB8fCBuZXdUb3BpY05hbWUudHJpbSgpID09PSAnJykgcmV0dXJuOwoKICAgIGNvbnN0IG5ld1NhcmEgPSBwcm9tcHQoIuC4reC4ouC4ueC5iOC5g+C4meC4quC4suC4o+C4sOC4geC4suC4o+C5gOC4o+C4teC4ouC4meC4o+C4ueC5ieC5g+C4lDoiLCAi4Liq4Liy4Lij4Liw4LiX4Li14LmIIDEiKTsKICAgIGNvbnN0IG5ld01haW5Ub3BpYyA9IHByb21wdCgi4Lit4Lii4Li54LmI4LmD4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lir4Lil4Lix4LiB4LmD4LiUOiIsICLguKvguLHguKfguILguYnguK3guKvguKXguLHguIHguYPguKvguKHguYgiKTsKCiAgICBjb25zdCBuZXdUb3BpY0lkID0gJ3RvcGljXycgKyBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpOwogICAgY29uc3QgbmV3VG9waWNEYXRhID0gewogICAgICAgIHNhcmE6IG5ld1NhcmEsCiAgICAgICAgbWFpblRvcGljOiBuZXdNYWluVG9waWMsCiAgICAgICAgc3ViVG9waWM6IG5ld1RvcGljTmFtZS50cmltKCksCiAgICAgICAgc3RhdHVzOiAibm90X2dlbmVyYXRlZCIsCiAgICAgICAgbGVzc29uQ29udGVudDogbnVsbAogICAgfTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke25ld1RvcGljSWR9YF06IG5ld1RvcGljRGF0YQogICAgICAgIH0pOwogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsgLy8gUmVmcmVzaAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBhZGRpbmcgdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguJ7guLTguYjguKHguKvguLHguKfguILguYnguK0iKTsKICAgIH0KfQoKLyoqCiAqIFs2XSBDUlVEOiDguYHguIHguYnguYTguILguIrguLfguYjguK3guKvguLHguKfguILguYnguK0KICovCmFzeW5jIGZ1bmN0aW9uIGVkaXRUb3BpY0luUHJvamVjdCh0b3BpY0lkKSB7CiAgICBjb25zdCB0b3BpY0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRvcGljLWlkPSIke3RvcGljSWR9Il1gKTsKICAgIGNvbnN0IHN1YlRvcGljUCA9IHRvcGljRGl2LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWZpZWxkPSJzdWJUb3BpYyJdJyk7CiAgICBjb25zdCBjdXJyZW50TmFtZSA9IHN1YlRvcGljUC50ZXh0Q29udGVudDsKCiAgICBjb25zdCBuZXdOYW1lID0gcHJvbXB0KCLguYHguIHguYnguYTguILguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guKLguYjguK3guKI6IiwgY3VycmVudE5hbWUpOwogICAgaWYgKCFuZXdOYW1lIHx8IG5ld05hbWUudHJpbSgpID09PSAnJyB8fCBuZXdOYW1lLnRyaW0oKSA9PT0gY3VycmVudE5hbWUpIHJldHVybjsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9LnN1YlRvcGljYF06IG5ld05hbWUudHJpbSgpCiAgICAgICAgfSk7CiAgICAgICAgc3ViVG9waWNQLnRleHRDb250ZW50ID0gbmV3TmFtZS50cmltKCk7IC8vIOC4reC4seC4m+C5gOC4lOC4lSBVSSDguJfguLHguJnguJfguLUKICAgICAgICBzaG93TWVzc2FnZSgi4LmB4LiB4LmJ4LmE4LiC4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGVkaXRpbmcgdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYHguIHguYnguYTguIIiKTsKICAgIH0KfQoKLyoqCiAqIFs3XSBDUlVEOiDguKXguJrguKvguLHguKfguILguYnguK3guK3guK3guIHguIjguLLguIHguYLguJvguKPguYDguIjguIQKICovCmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRvcGljRnJvbVByb2plY3QodG9waWNJZCkgewogICAgaWYgKCFjb25maXJtKCLguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguKvguLHguKfguILguYnguK3guJnguLXguYk/IikpIHJldHVybjsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9YF06IGRlbGV0ZUZpZWxkKCkgLy8g4LmD4LiK4LmJIGRlbGV0ZUZpZWxkKCkg4LmA4Lie4Li34LmI4Lit4Lil4LiaIGtleSDguK3guK3guIHguIjguLLguIEgbWFwCiAgICAgICAgfSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdG9waWMtaWQ9IiR7dG9waWNJZH0iXWApLnJlbW92ZSgpOyAvLyDguKXguJrguK3guK3guIHguIjguLLguIEgVUkKICAgICAgICBzaG93TWVzc2FnZSgi4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGRlbGV0aW5nIHRvcGljOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4LiaIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVBbmRTYXZlTGVzc29uRm9yQmx1ZXByaW50IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVBbmRTYXZlTGVzc29uRm9yQmx1ZXByaW50KHRvcGljSWQsIHRvcGljTmFtZSwgZ3JhZGVMZXZlbCkgewogICAgaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uKHRvcGljTmFtZSwgZ3JhZGVMZXZlbCk7CgogICAgY29uc3QgY2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBsZXNzb25Nb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpOwogICAgICAgIGNvbnN0IGlzTW9kYWxIaWRkZW4gPSBsZXNzb25Nb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpOwoKICAgICAgICBpZiAoaXNNb2RhbEhpZGRlbikgewogICAgICAgICAgICBjbGVhckludGVydmFsKGNoZWNrSW50ZXJ2YWwpOwoKaWYgKGN1cnJlbnRBcHBsaWNhdGlvbkRhdGEgJiYgY3VycmVudEFwcGxpY2F0aW9uRGF0YS5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBsZXNzb25Db250ZW50ID0gewogICAgICAgIHBvaW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9pbnRDb250ZW50JykuaW5uZXJIVE1MLAogICAgICAgIG1lbW9yeTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbW9yeUNvbnRlbnQnKS5pbm5lckhUTUwsCiAgICAgICAgYXBwbGljYXRpb25IVE1MOiBnZXRDbGVhbkFwcGxpY2F0aW9uSFRNTCgpLAogICAgICAgIGFwcGxpY2F0aW9uRGF0YTogY3VycmVudEFwcGxpY2F0aW9uRGF0YSwKICAgICAgICBzdW1tYXJ5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNvbnRlbnQnKS5pbm5lckhUTUwsCiAgICB9OwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4Liq4Lij4LmJ4Liy4LiHIFJlZmVyZW5jZSDguYTguJvguKLguLHguIcgMiDguJfguLXguYjguJfguLXguYjguYDguKPguLLguIjguLDguJrguLHguJnguJfguLbguIEKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgY29uc3QgbGVzc29uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzLyR7Y3VycmVudEJsdWVwcmludFByb2plY3RJZH0vbGVzc29uc2AsIHRvcGljSWQpOwoKICAgICAgICAvLyAyLiDguYPguIrguYkgImJhdGNoIiDguYDguJ7guLfguYjguK3guKrguLHguYjguIfguJrguLHguJnguJfguLbguIEgMiDguJfguLXguYjguJ7guKPguYnguK3guKHguIHguLHguJkKICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwoKICAgICAgICAvLyAgICAtIOC4hOC4s+C4quC4seC5iOC4hyBBOiDguJrguLHguJnguJfguLbguIHguILguYnguK3guKHguLnguKXguYPguKvguI3guYggKGxlc3NvbkNvbnRlbnQpIOC5hOC4m+C4l+C4teC5iOC5hOC4n+C4peC5jOC5g+C4q+C4oeC5iOC5g+C4mSBzdWJjb2xsZWN0aW9uICdsZXNzb25zJwogICAgICAgIGJhdGNoLnNldChsZXNzb25SZWYsIHsgY29udGVudDogbGVzc29uQ29udGVudCB9KTsKCiAgICAgICAgLy8gICAgLSDguITguLPguKrguLHguYjguIcgQjog4Lit4Lix4Lib4LmA4LiU4LiV4LmB4LiE4LmI4Liq4LiW4Liy4LiZ4LiwIChzdGF0dXMpIOC5g+C4meC5hOC4n+C4peC5jOC4q+C4peC4seC4geC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4geC4leC5jAogICAgICAgIGJhdGNoLnVwZGF0ZShwcm9qZWN0UmVmLCB7CiAgICAgICAgICAgIFtgdG9waWNzLiR7dG9waWNJZH0uc3RhdHVzYF06ICdnZW5lcmF0ZWQnCiAgICAgICAgfSk7CgogICAgICAgIC8vIDMuIOC4ouC4t+C4meC4ouC4seC4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4l+C4seC5ieC4h+C4q+C4oeC4lAogICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICBjb25zb2xlLmxvZyhg4Lia4Lix4LiZ4LiX4Li24LiB4Lia4LiX4LmA4Lij4Li14Lii4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Lir4Lix4Lin4LiC4LmJ4LitIElEOiAke3RvcGljSWR9IOC4quC4s+C5gOC4o+C5h+C4iGApOwogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIGxlc3NvbiB0byBwcm9qZWN0OiIsIGVycm9yKTsKICAgIH0KfQogICAgICAgIH0KICAgIH0sIDEwMDApOwp9CgpmdW5jdGlvbiBkaXNwbGF5SGFsZk1hcmtSZXN1bHQoc2NvcmUsIHRvdGFsUXVlc3Rpb25zKSB7CiAgICBjb25zdCBpc0Fib3ZlSGFsZiA9IHNjb3JlID49IHRvdGFsUXVlc3Rpb25zIC8gMjsKICAgIGNvbnN0IGJnQ29sb3IgPSBpc0Fib3ZlSGFsZiA/ICdiZy1ncmVlbi0xMDAnIDogJ2JnLXJlZC0xMDAnOwogICAgY29uc3QgaWNvbiA9IGlzQWJvdmVIYWxmID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtNXhsIHRleHQtZ3JlZW4tNTAwIG1iLTQiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtNXhsIHRleHQtcmVkLTUwMCBtYi00Ij48L2k+JzsKICAgIGNvbnN0IHRpdGxlQ29sb3IgPSBpc0Fib3ZlSGFsZiA/ICd0ZXh0LWdyZWVuLTgwMCcgOiAndGV4dC1yZWQtODAwJzsKICAgIGNvbnN0IHRpdGxlVGV4dCA9IGlzQWJvdmVIYWxmID8gJ+C4l+C4s+C4hOC4sOC5geC4meC4meC5hOC4lOC5ieC5gOC4geC4tOC4meC4hOC4o+C4tuC5iOC4hycgOiAn4LiE4Liw4LmB4LiZ4LiZ4Lii4Lix4LiH4LmE4Lih4LmI4LiW4Li24LiH4LiE4Lij4Li24LmI4LiHJzsKICAgIGNvbnN0IG1lc3NhZ2UgPSBpc0Fib3ZlSGFsZiA/ICfguKLguK3guJTguYDguKLguLXguYjguKLguKEhJyA6ICfguKrguLnguYnguYYg4Lil4Lit4LiH4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiH4LiZ4LiwJzsKCiAgICBsZXQgcmVzdWx0SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggJHtiZ0NvbG9yfSByb3VuZGVkLWxnIj4KICAgICAgICAgICAgJHtpY29ufQogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCAke3RpdGxlQ29sb3J9IG1iLTIiPiR7dGl0bGVUZXh0fTwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIj4ke21lc3NhZ2V9PC9wPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IHJlc3VsdEhUTUw7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgc2hvd1JhbmtpbmdzOiBmYWxzZSwgc2hvd0ltcHJvdmVCdXR0b246ICFpc0Fib3ZlSGFsZiB9KTsKfQoJCQpmdW5jdGlvbiBkaXNwbGF5UGVyZmVjdFNjb3JlUmVzdWx0KHNjb3JlLCB0b3RhbFF1ZXN0aW9ucykgewogICAgY29uc3QgaXNQZXJmZWN0ID0gc2NvcmUgPT09IHRvdGFsUXVlc3Rpb25zOwogICAgY29uc3QgYmdDb2xvciA9IGlzUGVyZmVjdCA/ICdiZy15ZWxsb3ctMTAwJyA6ICdiZy1ibHVlLTEwMCc7CiAgICBjb25zdCBpY29uID0gaXNQZXJmZWN0ID8gJzxpIGNsYXNzPSJmYXMgZmEtY3Jvd24gdGV4dC01eGwgdGV4dC15ZWxsb3ctNTAwIG1iLTQiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtYXdhcmQgdGV4dC01eGwgdGV4dC1ibHVlLTUwMCBtYi00Ij48L2k+JzsKICAgIGNvbnN0IHRpdGxlQ29sb3IgPSBpc1BlcmZlY3QgPyAndGV4dC15ZWxsb3ctODAwJyA6ICd0ZXh0LWJsdWUtODAwJzsKICAgIGNvbnN0IHRpdGxlVGV4dCA9IGlzUGVyZmVjdCA/ICfguITguLDguYHguJnguJnguYDguJXguYfguKEhJyA6ICfguKLguLHguIfguYTguKHguYjguYDguJXguYfguKHguJnguLAnOwogICAgY29uc3QgbWVzc2FnZSA9IGlzUGVyZmVjdCA/IGDguKrguLjguJTguKLguK3guJQhIOC4leC4reC4muC4luC4ueC4geC4l+C4uOC4geC4guC5ieC4rWAgOiBg4LmA4LiB4LmI4LiH4Lih4Liy4LiBISDguJ7guKLguLLguKLguLLguKHguK3guLXguIHguJnguLTguJTguYDguJ7guLfguYjguK3guITguLDguYHguJnguJnguYDguJXguYfguKFgOwoKICAgIGxldCByZXN1bHRIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCAke2JnQ29sb3J9IHJvdW5kZWQtbGciPgogICAgICAgICAgICAke2ljb259CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC00eGwgZm9udC1ib2xkICR7dGl0bGVDb2xvcn0gbWItMiI+JHt0aXRsZVRleHR9PC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS03MDAiPiR7bWVzc2FnZX08L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gcmVzdWx0SFRNTDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgCiAgICBzZXR1cFJlc3VsdFNjcmVlbkJhY2tCdXR0b24oeyBzaG93UmFua2luZ3M6IGZhbHNlLCBzY29yZSwgdG90YWxRdWVzdGlvbnMgfSk7Cn0KCmZ1bmN0aW9uIHJlbmRlckluZGl2aWR1YWxDb21wYXJpc29uVGFibGUoZGF0YSwgY29udGFpbmVyKSB7CiAgICAvLyDguYDguKPguLXguKLguIfguKXguLPguJTguLHguJrguJXguLLguKEg4Lie4Lix4LiS4LiZ4Liy4LiB4Liy4LijIFQtU2NvcmUgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIGRhdGEuc29ydCgoYSwgYikgPT4gKGIudEdhaW4gPz8gLUluZmluaXR5KSAtIChhLnRHYWluID8/IC1JbmZpbml0eSkpOwoKICAgIGxldCB0YWJsZUh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ib3ZlcmZsb3cteC1hdXRvIj4KICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJnLXdoaXRlIHRleHQtc20iPgogICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzPSJiZy1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB3LTEyIj7guK3guLHguJnguJTguLHguJo8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWxlZnQiPuC4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4mTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guITguLDguYHguJnguJnguIHguYjguK3guJk8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciI+4LiE4Liw4LmB4LiZ4LiZ4Lir4Lil4Lix4LiHPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4nOC4peC4leC5iOC4suC4hyAo4LiU4Li04LiaKTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guJ7guLHguJLguJnguLLguIHguLLguKM8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciI+VC1TY29yZSAo4LiB4LmI4Lit4LiZKTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj5ULVNjb3JlICjguKvguKXguLHguIcpPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4nuC4seC4kuC4meC4suC4geC4suC4oyAoVCk8L3RoPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgPHRib2R5PgogICAgYDsKCiAgICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICB0YWJsZUh0bWwgKz0gJzx0cj48dGQgY29sc3Bhbj0iOSIgY2xhc3M9InRleHQtY2VudGVyIHAtNCB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguJnguLHguIHguYDguKPguLXguKLguJk8L3RkPjwvdHI+JzsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5mb3JFYWNoKChzdHVkZW50LCBpbmRleCkgPT4gewogICAgICAgICAgICBsZXQgZ2Fpbkh0bWwgPSAnLSc7CiAgICAgICAgICAgIGxldCBnYWluSWNvbkh0bWwgPSAnJzsKCiAgICAgICAgICAgIGlmIChzdHVkZW50LmdhaW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3R1ZGVudC5nYWluID4gMCA/ICd0ZXh0LWdyZWVuLTYwMCcgOiAoc3R1ZGVudC5nYWluIDwgMCA/ICd0ZXh0LXJlZC02MDAnIDogJ3RleHQtZ3JheS01MDAnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSBzdHVkZW50LmdhaW4gPiAwID8gJysnIDogJyc7CiAgICAgICAgICAgICAgICBnYWluSHRtbCA9IGA8c3BhbiBjbGFzcz0iZm9udC1ib2xkICR7Y29sb3J9Ij4ke3NpZ259JHtzdHVkZW50LmdhaW59PC9zcGFuPmA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIC0tLSDguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLI6IOC5hOC4reC4hOC4reC4meC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC4nuC4seC4kuC4meC4suC4geC4suC4oyAtLS0KICAgICAgICAgICAgICAgIGlmIChzdHVkZW50LmdhaW4gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZ2Fpbkljb25IdG1sID0gJzxzcGFuIGNsYXNzPSJ0ZXh0LWdyZWVuLTUwMCIgdGl0bGU9IuC4nuC4seC4kuC4meC4suC4guC4tuC5ieC4mSI+4qyG77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0dWRlbnQuZ2FpbiA8IDApIHsKICAgICAgICAgICAgICAgICAgICBnYWluSWNvbkh0bWwgPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTUwMCIgdGl0bGU9IuC4peC4lOC4peC4hyI+4qyH77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdhaW5JY29uSHRtbCA9ICc8c3BhbiBjbGFzcz0idGV4dC1ncmF5LTUwMCIgdGl0bGU9IuC4hOC4h+C4l+C4teC5iCI+4oaU77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCB0R2Fpbkh0bWwgPSAnLSc7CiAgICAgICAgICAgIGlmIChzdHVkZW50LnRHYWluICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IHN0dWRlbnQudEdhaW4gPiAwID8gJ3RleHQtZ3JlZW4tNjAwJyA6IChzdHVkZW50LnRHYWluIDwgMCA/ICd0ZXh0LXJlZC02MDAnIDogJ3RleHQtZ3JheS01MDAnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSBzdHVkZW50LnRHYWluID4gMCA/ICcrJyA6ICcnOwogICAgICAgICAgICAgICAgdEdhaW5IdG1sID0gYDxzcGFuIGNsYXNzPSJmb250LWJvbGQgJHtjb2xvcn0iPiR7c2lnbn0ke3N0dWRlbnQudEdhaW4udG9GaXhlZCgyKX08L3NwYW4+YDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGFibGVIdG1sICs9IGAKICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQiPiR7aW5kZXggKyAxfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij4ke3N0dWRlbnQubmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj4ke3N0dWRlbnQucHJlU2NvcmUgPz8gJy0nfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgZm9udC1ib2xkIj4ke3N0dWRlbnQucG9zdFNjb3JlID8/ICctJ308L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj4ke2dhaW5IdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgdGV4dC14bCI+JHtnYWluSWNvbkh0bWx9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB0ZXh0LWJsdWUtNjAwIj4ke3N0dWRlbnQucHJlVFNjb3JlPy50b0ZpeGVkKDIpID8/ICctJ308L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIHRleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCI+JHtzdHVkZW50LnBvc3RUU2NvcmU/LnRvRml4ZWQoMikgPz8gJy0nfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPiR7dEdhaW5IdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICBgOwogICAgICAgIH0pOwogICAgfQoKICAgIHRhYmxlSHRtbCArPSAnPC90Ym9keT48L3RhYmxlPjwvZGl2Pic7CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdGFibGVIdG1sOwp9CgovKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHIE1vZGFsIOC4quC4s+C4q+C4o+C4seC4muC5geC4geC5ieC5hOC4guC4iuC4t+C5iOC4reC5geC4muC4muC4l+C4lOC4quC4reC4mgogKiBAcGFyYW0ge3N0cmluZ30gcXVpeklkIC0gSUQg4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiI4Liw4LmB4LiB4LmJ4LmE4LiCCiAqIEBwYXJhbSB7c3RyaW5nfSB0b3BpYyAtIOC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgogKi8KZnVuY3Rpb24gaGFuZGxlUmVuYW1lUXVpeihxdWl6SWQsIHRvcGljKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiBzZXR1cENvbXBhcmlzb25Nb2RhbFRhYnMoKSB7CiAgICBjb25zdCBvdmVyYWxsVGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tb3ZlcmFsbC10YWInKTsKICAgIGNvbnN0IGluZGl2aWR1YWxUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1pbmRpdmlkdWFsLXRhYicpOwogICAgY29uc3Qgb3ZlcmFsbENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1vdmVyYWxsLWNvbnRlbnQnKTsKICAgIGNvbnN0IGluZGl2aWR1YWxDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24taW5kaXZpZHVhbC1jb250ZW50Jyk7CgogICAgb3ZlcmFsbFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBvdmVyYWxsVGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIGluZGl2aWR1YWxUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgb3ZlcmFsbENvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgaW5kaXZpZHVhbENvbnRlbnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKCiAgICBpbmRpdmlkdWFsVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGluZGl2aWR1YWxUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgb3ZlcmFsbFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICBpbmRpdmlkdWFsQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBvdmVyYWxsQ29udGVudC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pOwp9CgovLyDguYPguJnguJ/guLHguIfguIHguYzguIrguLHguJkgc2V0dXBFdmVudExpc3RlbmVycygpCi8vIOC5g+C4q+C5ieC5gOC4nuC4tOC5iOC4oeC4geC4suC4o+C5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4myAxIOC4muC4o+C4o+C4l+C4seC4lAovLyAo4Lin4Liy4LiH4LmE4Lin4LmJ4LiV4Lij4LiH4LmE4Lir4LiZ4LiB4LmH4LmE4LiU4LmJ4Lig4Liy4Lii4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMpCnNldHVwQ29tcGFyaXNvbk1vZGFsVGFicygpOwoKCmZ1bmN0aW9uIGxpc3RlbkZvckxpdmVHYW1lVXBkYXRlcygpIHsKICAgIGlmICh1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIpIHVuc3Vic2NyaWJlTGl2ZUdhbWVMaXN0ZW5lcigpOwoKICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvbGl2ZUdhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgdW5zdWJzY3JpYmVMaXZlR2FtZUxpc3RlbmVyID0gb25TbmFwc2hvdChnYW1lUmVmLCAoZG9jU25hcCkgPT4gewogICAgICAgIGlmICghZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAvLyAtLS0gW1NUQVJUXSDguJnguLXguYjguITguLfguK3guKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguILguJfguLHguYnguIfguKvguKHguJQgLS0tCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguKHguKrguLTguYnguJnguKrguLjguJTguKXguIfguYHguKXguYnguKciKTsKCiAgICAgICAgICAgIGlmIChjYW1lRnJvbUJsdWVwcmludCAmJiBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKSB7CiAgICAgICAgICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4nKSB7CiAgICAgICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBkb2NTbmFwLmRhdGEoKTsKCiAgICAgICAgaWYgKGdhbWVEYXRhLnNodWZmbGVkUXVpeikgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXo7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSAmJiBnYW1lRGF0YS5xdWl6SWQpIHsKICAgICAgICAgICAgKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVpekRvY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZ2FtZURhdGEucXVpeklkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWl6RG9jU25hcCA9IGF3YWl0IGdldERvYyhxdWl6RG9jUmVmKTsKICAgICAgICAgICAgICAgICAgICBpZiAocXVpekRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFF1aXpEYXRhID0geyBpZDogcXVpekRvY1NuYXAuaWQsIC4uLnF1aXpEb2NTbmFwLmRhdGEoKSB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIHF1aXogZm9yIGFkbWluOicsIGUpOyB9CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKGdhbWVEYXRhLnN0YXR1cykgewogICAgICAgICAgICBjYXNlICdsb2JieSc6CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJzID0gZ2FtZURhdGEucGxheWVycyA/IE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMpIDogW107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlUGxheWVycyA9IHBsYXllcnMuZmlsdGVyKChbbmFtZSwgZGF0YV0pID0+IGRhdGEuc3RhdHVzID09PSAnYWN0aXZlJyk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckNvdW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWNvdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGxheWVyQ291bnRFbCkgcGxheWVyQ291bnRFbC50ZXh0Q29udGVudCA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJMaXN0TG9iYnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWxpc3QtbG9iYnknKTsKICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXJMaXN0TG9iYnkpewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJMaXN0TG9iYnkuaW5uZXJIVE1MID0gYWN0aXZlUGxheWVycy5tYXAoKFtuYW1lLCBkYXRhXSkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUvMzAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0biB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQiIHRpdGxlPSLguYDguJXguLDguJzguLnguYnguYDguKXguYjguJnguJnguLXguYnguK3guK3guIEiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0R2FtZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1nYW1lLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGFydEdhbWVCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRHYW1lQnRuLmRpc2FibGVkID0gYWN0aXZlUGxheWVycy5sZW5ndGggPT09IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzaG93VmlldygnbGl2ZS1nYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCI+4LiE4Li44LiT4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmB4Lil4LmJ4LinITwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIG10LTIiPuC4iuC4t+C5iOC4reC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4rTogPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtjdXJyZW50U3R1ZGVudE5hbWV9PC9zcGFuPjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTgiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5gOC4o+C4tOC5iOC4oeC5gOC4geC4oeC4quC4seC4geC4hOC4o+C4ueC5iC4uLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG10LTQiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3F1ZXN0aW9uJzoKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UXVpekRhdGEgJiYgY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1txdWVzdGlvbkluZGV4XSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uRGF0YSA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25TdGF0dXMgPSBnYW1lRGF0YS5xdWVzdGlvblN0YXR1cyB8fCAnYW5zd2VyaW5nJzsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvblN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzdW1tYXJ5X2NoYXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZG1pblN1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbkRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93UGxheWVyU3VtbWFyeVZpZXcoZ2FtZURhdGEsIGN1cnJlbnRTdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlYWRlcmJvYXJkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUb3A1TGVhZGVyYm9hcmRWaWV3KGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYW5zd2VyaW5nJzoKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwZGF0ZXNNYWRlID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMpLmZvckVhY2goKFtwbGF5ZXJOYW1lLCBwbGF5ZXJEYXRhXSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyRGF0YS5zdGF0dXMgPT09ICdhY3RpdmUnICYmIHBsYXllckRhdGEuc3VibWl0dGVkQXQgJiYgIXBsYXllckRhdGEuaXNTY29yZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZXNNYWRlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSBwbGF5ZXJEYXRhLnN1Ym1pdHRlZEF0LnRvRGF0ZSgpIC0gZ2FtZURhdGEucXVlc3Rpb25EaXNwbGF5ZWRBdC50b0RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjYWxjdWxhdGVkUG9pbnRzID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyRGF0YS5sYXN0QW5zd2VyQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFBvaW50cyA9IDEwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9udXNQb2ludHMgPSA1MDA7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVMaW1pdCA9IDIwMDAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGltZVJhdGlvID0gdGltZVRha2VuIC8gdGltZUxpbWl0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lUmF0aW8gPiAxKSB0aW1lUmF0aW8gPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb2ludHNMb3N0ID0gTWF0aC5yb3VuZCh0aW1lUmF0aW8gKiBib251c1BvaW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlZFBvaW50cyA9IG1heFBvaW50cyAtIHBvaW50c0xvc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShwbGF5ZXJSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYHBsYXllcnMuJHtwbGF5ZXJOYW1lfS5zY29yZWBdOiBpbmNyZW1lbnQoY2FsY3VsYXRlZFBvaW50cyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2BwbGF5ZXJzLiR7cGxheWVyTmFtZX0ucG9pbnRzTGFzdFF1ZXN0aW9uYF06IGNhbGN1bGF0ZWRQb2ludHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2BwbGF5ZXJzLiR7cGxheWVyTmFtZX0uaXNTY29yZWRgXTogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZXNNYWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLmNvbW1pdCgpLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKCJFcnJvciBjb21taXR0aW5nIHNjb3JlIHVwZGF0ZXM6IiwgZXJyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFJlbmRlcmVkQWRtaW5RdWVzdGlvbkluZGV4ICE9PSBxdWVzdGlvbkluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZG1pbkxpdmVRdWVzdGlvblZpZXcocXVlc3Rpb25EYXRhLCBxdWVzdGlvbkluZGV4LCBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RSZW5kZXJlZEFkbWluUXVlc3Rpb25JbmRleCA9IHF1ZXN0aW9uSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxQbGF5ZXJzID0gZ2FtZURhdGEucGxheWVycyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVQbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhhbGxQbGF5ZXJzKS5maWx0ZXIocCA9PiBwLnN0YXR1cyA9PT0gJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsQWN0aXZlUGxheWVycyA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlcmVkQWN0aXZlUGxheWVycyA9IGFjdGl2ZVBsYXllcnMuZmlsdGVyKHAgPT4gcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSkubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbnN3ZXJDb3VudGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5zd2VyLWNvdW50ZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyQ291bnRlckVsKSBhbnN3ZXJDb3VudGVyRWwudGV4dENvbnRlbnQgPSBgJHthbnN3ZXJlZEFjdGl2ZVBsYXllcnN9LyR7dG90YWxBY3RpdmVQbGF5ZXJzfWA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtcGxheWVyLWxpc3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXJMaXN0Q29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJMaXN0SHRtbCA9IE9iamVjdC5lbnRyaWVzKGFsbFBsYXllcnMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChbbmFtZSwgZGF0YV0pID0+IGRhdGEuc3RhdHVzID09PSAnYWN0aXZlJykgLy8g4LiB4Lij4Lit4LiH4LmA4LiJ4Lie4Liy4Liw4LiE4LiZ4LiX4Li14LmI4Lii4Lix4LiH4Lit4Lii4Li54LmI4LmD4LiZ4LmA4LiB4LihCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNBbnN3ZXJlZCA9IGRhdGEuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24gPT09IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmdDb2xvciA9IGhhc0Fuc3dlcmVkID8gJ2JnLWdyZWVuLTUwMCcgOiAnYmctZ3JheS01MDAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC13aGl0ZSB0ZXh0LXNtICR7YmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpY29ufQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtuYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0biB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQiIHRpdGxlPSLguJnguLPguJzguLnguYnguYDguKXguYjguJnguJnguLXguYnguK3guK3guIEiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyTGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBwbGF5ZXJMaXN0SHRtbCB8fCAnPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTMwMCI+4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmD4LiK4LmJ4LiH4Liy4LiZ4Lit4Lii4Li54LmIPC9wPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBbRU5EXSDguKrguLTguYnguJnguKrguLjguJTguYLguITguYnguJTguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbEFjdGl2ZVBsYXllcnMgPiAwICYmIGFuc3dlcmVkQWN0aXZlUGxheWVycyA9PT0gdG90YWxBY3RpdmVQbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmVhbEFuc3dlckZvckFkbWluKHF1ZXN0aW9uSW5kZXgsIGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckRhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW2N1cnJlbnRTdHVkZW50TmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllckRhdGEgJiYgIXBsYXllckRhdGEuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1N0dWRlbnRMaXZlUXVlc3Rpb25WaWV3KHF1ZXN0aW9uRGF0YSwgcXVlc3Rpb25JbmRleCwgY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAncG9kaXVtJzoKICAgICAgICAgICAgICAgIHNob3dQb2RpdW1WaWV3KGdhbWVEYXRhLnBsYXllcnMsICdsaXZlLXJhY2UnKTsKICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAKICAgICAgICB9CiAgICB9KTsKfQoJCQovLyDinIUg4LmC4LiE4LmJ4LiU4LmD4Lir4Lih4LmI4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCgovLyAxLiDguYDguJvguKXguLXguYjguKLguJnguIrguLfguYjguK3guJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguYnguKrguLfguYjguK3guITguKfguLLguKHguKvguKHguLLguKLguKHguLLguIHguILguLbguYnguJkKYXN5bmMgZnVuY3Rpb24gb3Blbkdsb2JhbEFjdGl2aXR5TW9kYWwoKSB7CiAgaWYgKGFsbFF1aXp6ZXNHbG9iYWwubGVuZ3RoID09PSAwKSB7CiAgICBjb25zdCBxcyA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCkpOwogICAgYWxsUXVpenplc0dsb2JhbCA9IHFzLmRvY3MubWFwKGQgPT4gKHsgaWQ6IGQuaWQsIC4uLmQuZGF0YSgpIH0pKTsKICB9CiAgcmVuZGVyR2xvYmFsQWN0aXZpdHlMaXN0KCcnKTsgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlciDguYPguKvguKHguYgKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2xvYmFsLWFjdGl2aXR5LW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCmZ1bmN0aW9uIHJlbmRlckdsb2JhbEFjdGl2aXR5TGlzdChmaWx0ZXJUZXh0ID0gJycpIHsKICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2xvYmFsLWFjdGl2aXR5LXF1aXotbGlzdCcpOwogIGNvbnN0IHRlcm0gPSBmaWx0ZXJUZXh0LnRvTG93ZXJDYXNlKCkudHJpbSgpOwoKICBjb25zdCByb3dzID0gYWxsUXVpenplc0dsb2JhbAogICAgLm1hcChxID0+ICh7CiAgICAgIC4uLnEsCiAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICB9KSkKICAgIC5maWx0ZXIocSA9PgogICAgICAocS50b3BpYyB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5wcm9qZWN0TmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKQogICAgKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1xdWl6LWNvdW50JykudGV4dENvbnRlbnQgPSBgKCR7cm93cy5sZW5ndGh9IOC4iuC4uOC4lClgOwoKICBsaXN0RWwuaW5uZXJIVE1MID0gcm93cy5sZW5ndGgKICAgID8gcm93cy5tYXAocSA9PiBgCiAgICAgICAgPGRpdiBjbGFzcz0icC0zIGJvcmRlci1iIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnYXAtNCBob3ZlcjpiZy1ncmF5LTUwIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTcwMCI+JHtxLnRvcGljIHx8ICco4LmE4Lih4LmI4Lih4Li14LiK4Li34LmI4LitKSd9CiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gZm9udC1ub3JtYWwgdGV4dC1ncmF5LTUwMCI+KCR7cS5xdWVzdGlvbnM/Lmxlbmd0aCB8fCAwfSDguILguYnguK0pPC9zcGFuPgogICAgICAgICAgICA8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAiPuC5guC4m+C4o+C5gOC4iOC4hDogJHtxLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIGRhdGEtbW9kZT0ibGl2ZS1yYWNlIiBjbGFzcz0iZ2FtZS1zdGFydC1idG4gYmctb3JhbmdlLTEwMCB0ZXh0LW9yYW5nZS04MDAgaG92ZXI6Ymctb3JhbmdlLTIwMCBmb250LXNlbWlib2xkIHB5LTIgcHgtMyByb3VuZGVkLWxnIHRleHQtc20iIHRpdGxlPSLguYHguILguYjguIfguILguLHguJnguKrguJQgKExpdmUgUmFjZSkiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mbGFnLWNoZWNrZXJlZCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAKICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiBkYXRhLW1vZGU9InN5bmMiIGNsYXNzPSJnYW1lLXN0YXJ0LWJ0biBiZy1pbmRpZ28tNjAwIHRleHQtd2hpdGUgaG92ZXI6YmctaW5kaWdvLTcwMCBmb250LXNlbWlib2xkIHB5LTIgcHgtMyByb3VuZGVkLWxnIHRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1ib2x0IHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4gU3luYyBNb2RlCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgYCkuam9pbignJykKICAgIDogYDxkaXYgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguJ7guJrguYHguJrguJrguJfguJTguKrguK3guJo8L2Rpdj5gOwp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUtpY2tQbGF5ZXIocGxheWVyTmFtZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICBhc3luYyBmdW5jdGlvbiBhdXRoZW50aWNhdGVVc2VyKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfX2luaXRpYWxfYXV0aF90b2tlbiAhPT0gJ3VuZGVmaW5lZCcgJiYgX19pbml0aWFsX2F1dGhfdG9rZW4pIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaWduSW5XaXRoQ3VzdG9tVG9rZW4oYXV0aCwgX19pbml0aWFsX2F1dGhfdG9rZW4pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaWduSW5Bbm9ueW1vdXNseShhdXRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkF1dGhlbnRpY2F0aW9uIGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Liy4Lij4Lii4Li34LiZ4Lii4Lix4LiZ4LiV4Lix4Lin4LiV4LiZ4Lil4LmJ4Lih4LmA4Lir4Lil4LinIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNob3dWaWV3IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSAtLS0KZnVuY3Rpb24gc2hvd1ZpZXcodmlldykgewogICAgLy8gLS0tIDEuIOC4i+C5iOC4reC4mSBWaWV3IOC4q+C4peC4seC4geC4l+C4seC5ieC4h+C4q+C4oeC4lOC4geC5iOC4reC4mSAtLS0KICAgIGFkbWluVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgcHJvamVjdERhc2hib2FyZFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBwcm9qZWN0RGV0YWlsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHF1aXpSZXN1bHRzVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIGxpdmVHYW1lVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4Lie4Li34LmI4Lit4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCBNYW5hZ2VyIOC5gOC4quC4oeC4rQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIC0tLSAyLiDguIvguYjguK3guJkgVmlldyDguKLguYjguK3guKLguILguK3guIfguJ3guLHguYjguIcgU3R1ZGVudCAtLS0KICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRKb2luR2FtZVZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50TmFtZVNlbGVjdGlvblZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50UXVpekFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRSZWFkaW5nQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgLy8gLS0tIDMuIOC4i+C5iOC4reC4mSBWaWV3IOC4ouC5iOC4reC4ouC4reC4t+C5iOC4meC5hiDguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICBjb25zdCB0ZWFtU2VsZWN0aW9uVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXRlYW0tc2VsZWN0aW9uLXZpZXcnKTsKICAgIGNvbnN0IHN0dWRlbnRQcm9ncmVzc1ZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9ncmVzcy12aWV3Jyk7CgogICAgaWYgKHRlYW1TZWxlY3Rpb25WaWV3KSB0ZWFtU2VsZWN0aW9uVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIGlmIChzdHVkZW50UHJvZ3Jlc3NWaWV3KSBzdHVkZW50UHJvZ3Jlc3NWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIC0tLSA0LiDguYHguKrguJTguIcgVmlldyDguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguJXguLLguKHguIrguLfguYjguK3guJfguLXguYjguKrguYjguIfguKHguLIgLS0tCiAgICBzd2l0Y2ggKHZpZXcpIHsKICAgICAgICBjYXNlICdhZG1pbi1kYXNoYm9hcmQnOgogICAgICAgICAgICBhZG1pblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHByb2plY3REYXNoYm9hcmRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwcm9qZWN0LWRldGFpbCc6CiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgcHJvamVjdERldGFpbFZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3F1aXotcmVzdWx0cyc6CiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgcXVpelJlc3VsdHNWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50JzoKICAgICAgICAgICAgc3R1ZGVudFZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbGl2ZS1nYW1lJzoKICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50LXRlYW0tam9pbic6CiAgICAgICAgICAgICBzdHVkZW50Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgIGlmICh0ZWFtU2VsZWN0aW9uVmlldykgdGVhbVNlbGVjdGlvblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50LXByb2dyZXNzJzoKICAgICAgICAgICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgaWYgKHN0dWRlbnRQcm9ncmVzc1ZpZXcpIHN0dWRlbnRQcm9ncmVzc1ZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBzdHVkZW50Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudEluaXRpYWxWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgIH0KfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNob3dKb2luR2FtZVZpZXcoKSB7CiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudEpvaW5HYW1lVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CgkJCgkJLy8gLS0tIFsg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIF0gLS0tCgovLyAtLS0gWyDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2F2ZVZpc2liaWxpdHlTZXR0aW5ncygpIHsKICAgIGlmICghY3VycmVudFByb2plY3RJZCkgcmV0dXJuOwoKICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBjdXJyZW50UHJvamVjdElkKTsKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsKICAgICAgICAgICAgJ3NldHRpbmdzLnNob3dJblN0dWRlbnREYXNoYm9hcmQnOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvdy1pbi1zdHVkZW50LWRhc2hib2FyZC1jaGVja2JveCcpLmNoZWNrZWQsCiAgICAgICAgICAgICdzZXR0aW5ncy5pc1Bhc3Njb2RlRW5hYmxlZCc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmFibGUtcGFzc2NvZGUtY2hlY2tib3gnKS5jaGVja2VkLAogICAgICAgICAgICAnc2V0dGluZ3MucGFzc2NvZGUnOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1wYXNzY29kZS1pbnB1dCcpLnZhbHVlLnRyaW0oKQogICAgICAgIH0pOwogICAgICAgIHNob3dNZXNzYWdlKCLguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguIHguLLguKPguYHguKrguJTguIfguJzguKXguKrguLPguYDguKPguYfguIgiKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHZpc2liaWxpdHkgc2V0dGluZ3M6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIEiKTsKICAgIH0KfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNldHVwRXZlbnRMaXN0ZW5lcnMoKSB7CgkJCgkJY29uc3Qgc2NhbkltZ0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW4tdGV4dC1pbWFnZS1pbnB1dCcpOwogICAgY29uc3Qgc2NhbkltZ0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuLXRleHQtaW1hZ2UtYnRuJyk7CgogICAgaWYgKHNjYW5JbWdJbnB1dCAmJiBzY2FuSW1nQnRuKSB7CiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LiB4LiU4Lib4Li44LmI4LihIC0+IOC5g+C4q+C5ieC4hOC4peC4tOC4gSBpbnB1dCBmaWxlCiAgICAgICAgc2NhbkltZ0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNjYW5JbWdJbnB1dC5jbGljaygpKTsKCiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LmA4Lil4Li34Lit4LiB4LmE4Lif4Lil4LmM4LmA4Liq4Lij4LmH4LiIIC0+IOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC5geC4geC4mQogICAgICAgIHNjYW5JbWdJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaGFuZGxlU2NhbkltYWdlRm9yVGV4dChlLnRhcmdldC5maWxlc1swXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCQkKCQljb25zdCBhbGxJbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1hbGwtaW4tYnRuJyk7CiAgICBpZiAoYWxsSW5CdG4pIHsKICAgICAgICBhbGxJbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLXNsaWRlcicpOwogICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLWFtb3VudC1kaXNwbGF5Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoc2xpZGVyKSB7CiAgICAgICAgICAgICAgICAvLyAxLiDguJXguLHguYnguIfguITguYjguLIgU2xpZGVyIOC5g+C4q+C5ieC4quC4uOC4lOC5geC4oeC5h+C4geC4i+C5jAogICAgICAgICAgICAgICAgc2xpZGVyLnZhbHVlID0gc2xpZGVyLm1heDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMi4g4Lit4Lix4Lib4LmA4LiU4LiV4LiV4Lix4Lin4LmA4Lil4LiC4LiX4Li14LmI4LmB4Liq4LiU4LiHCiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheSkgewogICAgICAgICAgICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBzbGlkZXIudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lit4Lif4LmA4Lif4LiB4LiV4LmM4LiV4Lix4Lin4LmA4Lil4LiC4LmA4LiU4LmJ4LiH4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4LiiCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheS5jbGFzc0xpc3QucmVtb3ZlKCdzY2FsZS0xMjUnKTsgLy8g4Lij4Li14LmA4LiL4LmH4LiVIGNsYXNzCiAgICAgICAgICAgICAgICAgICAgdm9pZCBkaXNwbGF5Lm9mZnNldFdpZHRoOyAvLyB0cmlnZ2VyIHJlZmxvdwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXkuY2xhc3NMaXN0LmFkZCgndHJhbnNmb3JtJywgJ3RyYW5zaXRpb24tdHJhbnNmb3JtJywgJ3NjYWxlLTEyNScsICd0ZXh0LXJlZC02MDAnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGRpc3BsYXkuY2xhc3NMaXN0LnJlbW92ZSgnc2NhbGUtMTI1JywgJ3RleHQtcmVkLTYwMCcpLCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC13YWdlci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXdhZ2VyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgY29uc3Qgd2FnZXJNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1tb2RhbCcpOwogICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbi13YWdlcicpOwogICAgY29uc3Qgd2FnZXJBbW91bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FnZXItc2xpZGVyJykudmFsdWU7CgogICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4LmA4LiB4LmH4Lia4LmE4Lin4LmJCiAgICBjb25zdCBhbnN3ZXJWYWx1ZSA9IGhpZGRlbklucHV0LmRhdGFzZXQuYW5zd2VyVmFsdWU7CiAgICBjb25zdCBxdWVzdGlvbiA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5xdWVzdGlvbik7CiAgICBjb25zdCBnYW1lRGF0YSA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5nYW1lRGF0YSk7CiAgICBjb25zdCBwbGF5ZXJOYW1lID0gaGlkZGVuSW5wdXQuZGF0YXNldC5wbGF5ZXJOYW1lOwoKICAgIHdhZ2VyTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbAoKICAgIC8vIOC4quC5iOC4h+C4hOC4s+C4leC4reC4miArIOC4iOC4s+C4meC4p+C4meC5gOC4h+C4tOC4meC4l+C4teC5iOC5gOC4lOC4tOC4oeC4nuC4seC4mQogICAgaGFuZGxlU3luY0Fuc3dlclN1Ym1pdChhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJOYW1lLCBmYWxzZSwgd2FnZXJBbW91bnQpOwp9KTsKCQkKCQlkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJzeW5jVmFyaWFudCJdJykuZm9yRWFjaChyYWRpbyA9PiB7CiAgICByYWRpby5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgIGNvbnN0IGFub25TZXR0aW5ncyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbm9uLXNldHRpbmdzLWNvbnRhaW5lcicpOwogICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ2Fub255bW91cycpIHsKICAgICAgICAgICAgYW5vblNldHRpbmdzLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFub25TZXR0aW5ncy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9KTsKfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdGltZXItZW5hYmxlLWNoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXRpbWVyLWR1cmF0aW9uLWNvbnRhaW5lcicpLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFlLnRhcmdldC5jaGVja2VkKTsKfSk7CgkJCgkJY29uc3QgY2FuY2VsQ29uZmlkZW5jZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtY29uZmlkZW5jZS1idG4nKTsKY29uc3QgY29uZmlkZW5jZU1vZGFsRm9yQ2FuY2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKTsKaWYgKGNhbmNlbENvbmZpZGVuY2VCdG4gJiYgY29uZmlkZW5jZU1vZGFsRm9yQ2FuY2VsKSB7CiAgICBjYW5jZWxDb25maWRlbmNlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbmZpZGVuY2VNb2RhbEZvckNhbmNlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBjb25maWRlbmNlTW9kYWxGb3JDYW5jZWwuZGF0YXNldC5jdXJyZW50TW9kZSA9ICcnOyAvLyDguYDguITguKXguLXguKLguKPguYzguKrguJbguLLguJnguLAKICAgIH0pOwp9CgkJCgkJY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaW0tb3ZlcmxheScpOwogICAgaWYgKG92ZXJsYXkpIHsKICAgICAgICAvLyDguYPguIrguYkgbW91c2Vkb3duIOC5geC4peC4sCB0b3VjaHN0YXJ0IOC5gOC4nuC4t+C5iOC4reC4iOC4seC4miBFdmVudCDguYPguKvguYnguYDguKPguYfguKfguJfguLXguYjguKrguLjguJTguIHguYjguK3guJnguJfguLXguYjguKHguLHguJnguIjguLDguJfguLDguKXguLgKICAgICAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHdha2VVcFNjcmVlbik7CiAgICAgICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgd2FrZVVwU2NyZWVuKTsKICAgIH0KCQkKLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1icC1yZWZlcmVuY2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHJldHVybjsKICAgIGNvbnN0IHVybCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1yZWZlcmVuY2UtZmlsZS11cmwnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICB0cnkgewogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7IHJlZmVyZW5jZUZpbGVVcmw6IHVybCB9KTsKICAgICAgICBzaG93TWVzc2FnZSgi4Lia4Lix4LiZ4LiX4Li24LiB4Lil4Li04LiH4LiB4LmM4LmE4Lif4Lil4LmM4Lit4LmJ4Liy4LiH4Lit4Li04LiH4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyByZWZlcmVuY2UgVVJMOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBIik7CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1wYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBZGRQYXJhbGxlbFNob3J0Y3V0VGFiKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LWlucHV0LWFyZWEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI29wZW4tYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtYnRuJykpIHsKICAgICAgICBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKICAgICAgICByZW5kZXJBZGRpdGlvbmFsUGFyYWxsZWxTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLmdyb3VwXFwvZHJvcGRvd24tcGFyYWxsZWwnKSkgewogICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1kcm9wZG93bicpLmZvckVhY2goZCA9PiBkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJLy8g4pa84pa84pa8IOC5g+C4meC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzZXR1cEV2ZW50TGlzdGVuZXJzKCkg4LmD4Lir4LmJ4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibIOKWvOKWvOKWvAoKLy8gLS0tIFtGaWxlIFNob3J0Y3V0IFRhYiBTeXN0ZW1dIC0tLQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLWZpbGUtc2hvcnRjdXQtdGFiLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQWRkRmlsZVNob3J0Y3V0VGFiKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLWlucHV0LWFyZWEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI29wZW4tYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4nKSkgewogICAgICAgIGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID0gJ2FsbCc7CiAgICAgICAgcmVuZGVyQWRkaXRpb25hbEZpbGVTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWFkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLmdyb3VwXFwvZHJvcGRvd24tZmlsZScpKSB7IC8vIOC5g+C4iuC5iSBTZWxlY3RvciDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtZmlsZS1zaG9ydGN1dC1kcm9wZG93bicpLmZvckVhY2goZCA9PiBkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1zaG9ydGN1dC10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBZGRTaG9ydGN1dFRhYik7CgkJCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1jb250YWluZXInKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBzaG9ydGN1dEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZWRpdC1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcGFyYWxsZWwtc2hvcnRjdXQtYnRuJyk7CgogICAgaWYgKGVkaXRCdG4pIHsKICAgICAgICBvcGVuUGFyYWxsZWxUZXN0U2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4m+C4uOC5iOC4oeC4peC4seC4lOC4meC4teC5iT9gLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBwYXJhbGxlbFRlc3RTaG9ydGN1dHMuZmlsdGVyKHMgPT4gcy5pZCAhPT0gc2hvcnRjdXRJZCk7CiAgICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHByZWZSZWYsIHsgc2hvcnRjdXRzOiB1cGRhdGVkU2hvcnRjdXRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHNob3J0Y3V0QnRuKSB7CiAgICAgICAgaGFuZGxlUGFyYWxsZWxUZXN0U2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gb3BlblBhcmFsbGVsVGVzdFNob3J0Y3V0RWRpdG9yKG51bGwpKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcGFyYWxsZWwtc2hvcnRjdXQtZWRpdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1lZGl0b3ItbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNhdmVQYXJhbGxlbFRlc3RTaG9ydGN1dENoYW5nZXMpOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXRlc3QtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjb3Blbi1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKSkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1saXN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtbW9kYWwnKTsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpOwoKICAgIGlmICh1c2VCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBoYW5kbGVQYXJhbGxlbFRlc3RTaG9ydGN1dENsaWNrKHVzZUJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIG9wZW5QYXJhbGxlbFRlc3RTaG9ydGN1dEVkaXRvcihlZGl0QnRuLmRhdGFzZXQuaWQpOwogICAgfSBlbHNlIGlmIChkZWxldGVCdG4pIHsKICAgICAgICBjb25zdCBzaG9ydGN1dElkID0gZGVsZXRlQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiZ4Li14LmJP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICBjb25zdCB1cGRhdGVkU2hvcnRjdXRzID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBzaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgIH0pOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWNvbnRhaW5lcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IHNob3J0Y3V0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtZmlsZS1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtZmlsZS1zaG9ydGN1dC1idG4nKTsKCiAgICBpZiAoZWRpdEJ0bikgewogICAgICAgIG9wZW5GaWxlU2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4m+C4uOC5iOC4oeC4peC4seC4lOC4meC4teC5iT9gLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBmaWxlU2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZmlsZVNob3J0Y3V0c0NvbmZpZyIpOwogICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBzaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAoc2hvcnRjdXRCdG4pIHsKICAgICAgICBoYW5kbGVGaWxlU2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLWZpbGUtc2hvcnRjdXQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKG51bGwpKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZmlsZS1zaG9ydGN1dC1lZGl0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtc2hvcnRjdXQtZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1maWxlLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZUZpbGVTaG9ydGN1dENoYW5nZXMpOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjb3Blbi1hZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLWJ0bicpKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbGlzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbW9kYWwnKTsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBkZWxldGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZGVsZXRlLWhpZGRlbi1maWxlLXNob3J0Y3V0LWJ0bicpOwoKICAgIGlmICh1c2VCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBoYW5kbGVGaWxlU2hvcnRjdXRDbGljayh1c2VCdG4uZGF0YXNldC5pZCk7CiAgICB9IGVsc2UgaWYgKGVkaXRCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKGVkaXRCdG4uZGF0YXNldC5pZCk7CiAgICB9IGVsc2UgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgIGNvbnN0IHNob3J0Y3V0SWQgPSBkZWxldGVCdG4uZGF0YXNldC5pZDsKICAgICAgICBzaG93Q29uZmlybWF0aW9uKGDguITguLjguJPguYHguJnguYjguYPguIjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguJvguLjguYjguKHguKXguLHguJTguJnguLXguYk/YCwgYXN5bmMgKCkgPT4gewogICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBmaWxlU2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJmaWxlU2hvcnRjdXRzQ29uZmlnIik7CiAgICAgICAgICAgYXdhaXQgc2V0RG9jKHByZWZSZWYsIHsgc2hvcnRjdXRzOiB1cGRhdGVkU2hvcnRjdXRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICB9KTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4mSBFdmVudCBMaXN0ZW5lcnMg4pay4pay4payCgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKEgIuC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oSIg4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiUIE1vZGFsCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIC8vIOC4m+C4uOC5iOC4oSAi4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmA4Lie4Li04LmI4Lih4LmA4LiV4Li04LihIgogICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJyNvcGVuLWFkZGl0aW9uYWwtc2hvcnRjdXRzLWJ0bicpKSB7CiAgICAgICAgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyDguKPguLXguYDguIvguYfguJXguYPguKvguYnguYDguJvguLTguJTguJfguLXguYjguYHguJfguYfguJogIuC4l+C4seC5ieC4h+C4q+C4oeC4lCIg4LmA4Liq4Lih4LitCiAgICAgICAgcmVuZGVyQWRkaXRpb25hbFNob3J0Y3V0c01vZGFsKCk7IC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4p+C4suC4lCBNb2RhbCDguYPguKvguKHguYjguILguK3guIfguYDguKPguLIKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0KfSk7CgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJvguLTguJQgKFgpIOC5g+C4mSBNb2RhbApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtYWRkaXRpb25hbC1zaG9ydGN1dHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJXguYjguLLguIfguYYgKOC5g+C4iuC5ieC4h+C4suC4mSwg4LmB4LiB4LmJ4LmE4LiCLCDguKXguJopIOC4l+C4teC5iOC4reC4ouC4ueC5iOC5g+C4mSBNb2RhbApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LWhpZGRlbi1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtaGlkZGVuLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKTsKCiAgICBpZiAodXNlQnRuKSB7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJkKICAgICAgICBoYW5kbGVTaG9ydGN1dENsaWNrKHVzZUJ0bi5kYXRhc2V0LmlkKTsgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4LiU4Li04LihCiAgICB9IGVsc2UgaWYgKGVkaXRCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsIOC4geC5iOC4reC4mQogICAgICAgIG9wZW5TaG9ydGN1dEVkaXRvcihlZGl0QnRuLmRhdGFzZXQuaWQpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKEKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIGNvbnN0IHNob3J0Y3V0TmFtZSA9IGJsdWVwcmludFNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk/Lm5hbWU7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiUICIke3Nob3J0Y3V0TmFtZX0iP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5maWx0ZXIocyA9PiBzLmlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICAgICAgICAgIGF3YWl0IHNldERvYyhwcmVmUmVmLCB7IGJsdWVwcmludFNob3J0Y3V0czogdXBkYXRlZFNob3J0Y3V0cyB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgeyBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBzaG9ydGN1dDoiLCBlcnJvcik7IH0KICAgICAgICB9KTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJQgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKLy8g4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LiE4Lil4Li04LiB4Lia4LiZIENvbnRhaW5lciDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zaG9ydGN1dC1jb250YWluZXInKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBzaG9ydGN1dEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZWRpdC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc2hvcnRjdXQtYnRuJyk7CgogICAgaWYgKGVkaXRCdG4pIHsKICAgICAgICBvcGVuU2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIGNvbnN0IHNob3J0Y3V0TmFtZSA9IGJsdWVwcmludFNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk/Lm5hbWU7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiUICIke3Nob3J0Y3V0TmFtZX0iP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5maWx0ZXIocyA9PiBzLmlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vICoqKiDguYHguIHguYnguYTguIIgcGF0aCDguYPguKvguYnguYDguJvguYfguJnguJXguLPguYHguKvguJnguYjguIfguKrguLLguJjguLLguKPguJPguLDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKioqCiAgICAgICAgICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZGFzaGJvYXJkQ29uZmlnIik7CiAgICAgICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBibHVlcHJpbnRTaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgc2hvcnRjdXQ6IiwgZXJyb3IpOyB9CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHNob3J0Y3V0QnRuKSB7CiAgICAgICAgaGFuZGxlU2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7CgovLyDguJvguLjguYjguKHguYDguJ7guLTguYjguKHguJfguLLguIfguKXguLHguJTguYPguKvguKHguYgKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1zaG9ydGN1dC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG9wZW5TaG9ydGN1dEVkaXRvcihudWxsKSk7CgovLyDguJvguLjguYjguKHguYPguJkgTW9kYWwg4LmB4LiB4LmJ4LmE4LiCCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtc2hvcnRjdXQtZWRpdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1lZGl0b3ItbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZVNob3J0Y3V0Q2hhbmdlcyk7CgovLyDguYHguIHguYnguYTguIIgRXZlbnQg4LiC4Lit4LiH4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguJXguLLguKEgQmx1ZXByaW50IiDguYPguKvguYnguKPguK3guIfguKPguLHguJrguYTguJ/guKXguYzguJfguLXguYjguK3guLHguJvguYLguKvguKXguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tYmx1ZXByaW50LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgY29uc3QgYmx1ZXByaW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXVwbG9hZC1pbnB1dCcpOwogICAgY29uc3QgcmVmZXJlbmNlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmZXJlbmNlLXBkZi11cGxvYWQnKTsKICAgIGlmIChibHVlcHJpbnRJbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgYXdhaXQgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50V2l0aEZpbGVzKGJsdWVwcmludElucHV0LmZpbGVzWzBdLCByZWZlcmVuY2VJbnB1dC5maWxlc1swXSB8fCBudWxsKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4reC4seC4m+C5guC4q+C4peC4lOC5hOC4n+C4peC5jCBCbHVlcHJpbnQg4Lir4Lij4Li34Lit4LmD4LiK4LmJ4Lib4Li44LmI4Lih4Lil4Lix4LiUIik7CiAgICB9Cn0pOwoKLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSDilrLilrLilrIKCQkKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWMtcXVpei1iYW5rLW1vZGFsIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWMtcXVpei1iYW5rLW1vZGFsIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpOwoKICAgIC8vIOC4lOC4tuC4h+C4leC4seC4p+C5geC4m+C4o+C4m+C4uOC5iOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4l+C4teC5iOC4reC4ouC4ueC5iOC5g+C4mSBNb2RhbCDguJnguLXguYkKICAgIGNvbnN0IHZpZXdBbmFseXNpc0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC12aWV3LWFuYWx5c2lzLWJ0bicpOwogICAgY29uc3QgdW5saW5rQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLXVubGluay1xdWl6LWJ0bicpOwogICAgY29uc3QgcHJlc2VudEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC1wcmVzZW50LWJ0bicpOwogICAgY29uc3QgdHJ5QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLXRyeS1idG4nKTsKICAgIGNvbnN0IGxpdmVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtbGl2ZS1idG4nKTsKICAgIGNvbnN0IGdhbWVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtZ2FtZS1idG4nKTsKCiAgICAvLyAtLS0gTG9naWMg4LiB4Liy4Lij4LiX4Liz4LiH4Liy4LiZ4LiC4Lit4LiH4Lib4Li44LmI4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQoKICAgIGlmICh2aWV3QW5hbHlzaXNCdG4pIHsKICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIg4LiB4LmI4Lit4LiZ4LmE4Lib4Lir4LiZ4LmJ4Liy4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lic4LilCiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAKICAgICAgICAKICAgICAgICBjb25zdCBxdWl6SWQgPSB2aWV3QW5hbHlzaXNCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgc2hvd1F1aXpEZXRhaWxWaWV3KHF1aXpJZCk7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgfQogICAgZWxzZSBpZiAodW5saW5rQnRuKSB7CiAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4Lii4Li34LiZ4Lii4Lix4LiZ4LiB4LmI4Lit4LiZ4Lil4LiaCiAgICAgICAgY29uc3QgdG9waWNJZCA9IHVubGlua0J0bi5kYXRhc2V0LnRvcGljSWQ7CiAgICAgICAgY29uc3QgcXVpeklkVG9SZW1vdmUgPSB1bmxpbmtCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWRUb1JlbW92ZSk7CiAgICAgICAgY29uc3QgcXVpelRvcGljID0gcXVpekRhdGEgPyBxdWl6RGF0YS50b3BpYyA6ICfguKPguLLguKLguIHguLLguKPguJnguLXguYknOwoKICAgICAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiZ4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke3F1aXpUb3BpY30iIOC4reC4reC4geC4iOC4suC4geC4hOC4peC4seC4h+C4meC4teC5iT9gLAogICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgICAgICAvLyDguYPguIrguYkgYXJyYXlSZW1vdmUg4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4Lib4Lil4Lit4LiU4Lig4Lix4Lii4LmB4Lil4Liw4LmB4Lih4LmI4LiZ4Lii4LizCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgW2B0b3BpY3MuJHt0b3BpY0lkfS5saW5rZWRRdWl6SWRzYF06IGFycmF5UmVtb3ZlKHF1aXpJZFRvUmVtb3ZlKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguJnguLPguYHguJrguJrguJfguJTguKrguK3guJrguK3guK3guIHguIjguLLguIHguITguKXguLHguIfguJnguLXguYnguYHguKXguYnguKciKTsKICAgICAgICAgICAgICAgICAgICBvcGVuVG9waWNRdWl6QmFuayh0b3BpY0lkKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiKIE1vZGFsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOyAvLyDguKPguLXguYDguJ/guKPguIrguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVubGlua2luZyBxdWl6OiIsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiZ4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lit4Lit4LiBIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfSAKICAgIGVsc2UgaWYgKHByZXNlbnRCdG4pIHsKICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IHRydWU7IC8vIOC4leC4seC5ieC4h+C4hOC5iOC4siAi4LiE4Lin4Liy4Lih4LiI4LizIgogICAgICAgIGNvbnN0IHF1aXpJZCA9IHByZXNlbnRCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJXguYjguLLguIcKICAgICAgICB9CiAgICB9IAogICAgZWxzZSBpZiAodHJ5QnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBjb25zdCBxdWl6SWQgPSB0cnlCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsKICAgICAgICAgICAgc3RhcnRBZG1pblRlc3QoKTsKICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgICAgIH0KICAgIH0gCiAgICBlbHNlIGlmIChsaXZlQnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBoYW5kbGVTdGFydExpdmVSYWNlKGxpdmVCdG4uZGF0YXNldC5xdWl6SWQpOwogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJXguYjguLLguIcKICAgIH0gCiAgICBlbHNlIGlmIChnYW1lQnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBjb25zdCBxdWl6SWQgPSBnYW1lQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IG1vZGUgPSBnYW1lQnRuLmRhdGFzZXQubW9kZTsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgICAgIHNob3dHYW1lU3RhcnRDb25maXJtYXRpb25Nb2RhbChxdWl6SWQsIG1vZGUsIHF1aXpEYXRhLnRvcGljKTsKICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgICAgIH0KICAgIH0KfSk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWNyZWF0ZS1ibHVlcHJpbnQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWJsdWVwcmludC1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgLy8gQ2xlYXIgcHJldmlvdXMgaW5wdXQKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtcHJvamVjdC1uYW1lJykudmFsdWUgPSAnJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtZ3JhZGUtbGV2ZWwnKS52YWx1ZSA9ICcnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1icC1jb250ZW50JykudmFsdWUgPSAnJzsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1hbnVhbC1icC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYmx1ZXByaW50LW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbWFudWFsLWJwLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlTWFudWFsQmx1ZXByaW50U2F2ZSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1icC1zZXR0aW5ncy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtc2V0dGluZ3MtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtYnAtc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTYXZlQmx1ZXByaW50UGFnZVNldHRpbmdzKTsKCQkKCQkvLyDguYPguJnguJ/guLHguIfguIHguYzguIrguLHguJkgc2V0dXBFdmVudExpc3RlbmVycygpCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlbkJsdWVwcmludFF1aXpTZXR0aW5ncyk7CgkJCgkJLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQoKLy8gLi4uICjguYLguITguYnguJQgRXZlbnQgTGlzdGVuZXIg4LmA4LiU4Li04LihKSAuLi4KCi8vID09PSBb4LmD4Lir4Lih4LmIXSBCbHVlcHJpbnQgUHJvamVjdCBNYW5hZ2VyIExpc3RlbmVycyA9PT0KCi8vIDEuIOC4m+C4uOC5iOC4oSAi4Lia4Lix4LiZ4LiX4Li24LiBIiDguKvguKXguLHguIfguIjguLLguIHguKfguLTguYDguITguKPguLLguLDguKvguYwgQmx1ZXByaW50CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLWJsdWVwcmludC1hcy1wcm9qZWN0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZUJsdWVwcmludFByb2plY3QpOwoKLy8gMi4g4Lib4Li44LmI4Lih4LmA4Lib4Li04LiUIE1vZGFsIOC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C5gOC4iOC4hApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1ibHVlcHJpbnQtcHJvamVjdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93Qmx1ZXByaW50UHJvamVjdHMpOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLWJsdWVwcmludC1wcm9qZWN0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtcHJvamVjdHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgovLyAzLiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYPguJkgTW9kYWwg4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiEIChPcGVuL0RlbGV0ZSkKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LWxpc3QnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBvcGVuQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLm9wZW4tYnAtcHJvamVjdC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtYnAtcHJvamVjdC1idG4nKTsKICAgIAogICAgaWYgKG9wZW5CdG4pIHsKICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIob3BlbkJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgLy8gLS0tIFsg4LiI4Li44LiU4LmB4LiB4LmJ4LmE4LiC4LiX4Li14LmI4Liq4Liz4LiE4Lix4LiNIF0gLS0tCiAgICAgICAgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiI4Liy4LiB4LiB4Liy4Lij4Lil4Lia4LiY4Lij4Lij4Lih4LiU4LiyIOC4oeC4suC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4peC4muC5geC4muC4muC4peC5ieC4suC4h+C4muC4suC4h+C4l+C4teC5iOC5gOC4o+C4suC4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4mQogICAgICAgIGhhbmRsZURlZXBEZWxldGVCbHVlcHJpbnRQcm9qZWN0KGRlbGV0ZUJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7CgovLyA0LiDguJvguLjguYjguKEgIuC4geC4peC4seC4miIg4LiI4Liy4LiB4Lir4LiZ4LmJ4LiyIE1hbmFnZXIKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stdG8tZGFzaGJvYXJkLWZyb20tYnAtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkID0gbnVsbDsKICAgIGN1cnJlbnRQcm9qZWN0SWQgPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXByb2plY3QtbWFuYWdlci12aWV3JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7Cn0pOwoKLy8gNS4g4Lib4Li44LmI4LihICLguYDguJ7guLTguYjguKHguKvguLHguKfguILguYnguK0iIOC5g+C4meC4q+C4meC5ieC4siBNYW5hZ2VyCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1hZGQtdG9waWMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhZGRUb3BpY1RvUHJvamVjdCk7CgovLyA2LiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYPguJnguKPguLLguKLguIHguLLguKPguKvguLHguKfguILguYnguK0gKEdlbmVyYXRlL0VkaXQvRGVsZXRlKQovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4LiaIGV2ZW50IGxpc3RlbmVyIOC4guC4reC4hyBicC10b3BpYy1saXN0LWNvbnRhaW5lciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4LiaIEV2ZW50IExpc3RlbmVyIOC4guC4reC4hyBicC10b3BpYy1saXN0LWNvbnRhaW5lciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJogZXZlbnQgbGlzdGVuZXIg4LiC4Lit4LiHIGJwLXRvcGljLWxpc3QtY29udGFpbmVyIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLXRvcGljLWxpc3QtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4gewogICAgY29uc3QgdG9waWNSb3cgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS10b3BpYy1pZF0nKTsKICAgIGlmICghdG9waWNSb3cpIHJldHVybjsKICAgIGNvbnN0IHRvcGljSWQgPSB0b3BpY1Jvdy5kYXRhc2V0LnRvcGljSWQ7CgogICAgY29uc3Qgb25ldFF1aXpCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtY3JlYXRlLW9uZXQtcXVpei1idG4nKTsKICAgIGNvbnN0IGNvbnRlbnRRdWl6QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLWNyZWF0ZS1jb250ZW50LXF1aXotYnRuJyk7CiAgICBjb25zdCB0b3BpY1F1aXpCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtY3JlYXRlLXRvcGljLXF1aXotYnRuJyk7CiAgICBjb25zdCBvcGVuVG9waWNCYW5rQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLW9wZW4tdG9waWMtYmFuay1idG4nKTsKICAgIGNvbnN0IHZpZXdCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcudmlldy1icC1sZXNzb24tYnRuJyk7CiAgICBjb25zdCBnZW5lcmF0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC1nZW5lcmF0ZS1sZXNzb24tYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLWVkaXQtdG9waWMtYnRuJyk7CiAgICBjb25zdCBkZWxldGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtZGVsZXRlLXRvcGljLWJ0bicpOwoKICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4gjog4Liq4Lij4LmJ4Liy4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiU4Li24LiH4Lir4Lix4Lin4LiC4LmJ4Lit4LmB4Lia4Lia4LmA4LiV4LmH4LihIC0tLQogICAgY29uc3QgZ2V0RnVsbFRvcGljTmFtZSA9IChyb3dFbGVtZW50KSA9PiB7CiAgICAgICAgY29uc3Qgc3ViVG9waWNUZXh0ID0gcm93RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1maWVsZD0ic3ViVG9waWMiXScpLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAvLyDguYTguJXguYjguKPguLDguJTguLHguJogRE9NIOC4guC4tuC5ieC4meC5hOC4m+C4q+C4siBoNSDguJfguLXguYjguYDguJvguYfguJnguKvguLHguKfguILguYnguK3guKvguKXguLHguIEKICAgICAgICBjb25zdCBtYWluVG9waWNFbGVtZW50ID0gcm93RWxlbWVudC5jbG9zZXN0KCcuc3BhY2UteS0xLnBsLTQnKS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgIGNvbnN0IG1haW5Ub3BpY1RleHQgPSBtYWluVG9waWNFbGVtZW50ID8gbWFpblRvcGljRWxlbWVudC50ZXh0Q29udGVudC50cmltKCkgOiAnJzsKICAgICAgICAKICAgICAgICAvLyDguKPguKfguKHguKvguLHguKfguILguYnguK3guKvguKXguLHguIHguYHguKXguLDguKvguLHguKfguILguYnguK3guKLguYjguK3guKLguYDguILguYnguLLguJTguYnguKfguKLguIHguLHguJkKICAgICAgICByZXR1cm4gYCR7bWFpblRvcGljVGV4dH06ICR7c3ViVG9waWNUZXh0fWA7CiAgICB9OwogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4giAtLS0KCiAgICBpZiAob3BlblRvcGljQmFua0J0bikgewogICAgICAgIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpOwogICAgfQogICAgZWxzZSBpZiAob25ldFF1aXpCdG4pIHsKICAgICAgICBjb25zdCBmdWxsVG9waWNOYW1lID0gZ2V0RnVsbFRvcGljTmFtZSh0b3BpY1Jvdyk7CiAgICAgICAgc2VsZWN0UHJvamVjdEFuZEdlbmVyYXRlQmx1ZXByaW50UXVpeihmdWxsVG9waWNOYW1lLCBudWxsLCB0b3BpY0lkLCB0cnVlKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbnRlbnRRdWl6QnRuKSB7CiAgICAgICAgY29uc3QgZnVsbFRvcGljTmFtZSA9IGdldEZ1bGxUb3BpY05hbWUodG9waWNSb3cpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGxlc3NvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0cy8ke2N1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWR9L2xlc3NvbnNgLCB0b3BpY0lkKTsKICAgICAgICAgICAgY29uc3QgbGVzc29uU25hcCA9IGF3YWl0IGdldERvYyhsZXNzb25SZWYpOwogICAgICAgICAgICBpZiAobGVzc29uU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgbGVzc29uID0gbGVzc29uU25hcC5kYXRhKCkuY29udGVudDsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV4dHJhY3RUZXh0ID0gKGh0bWwpID0+IHsgaWYgKCFodG1sKSByZXR1cm4gJyc7IHRlbXBEaXYuaW5uZXJIVE1MID0gaHRtbDsgcmV0dXJuIHRlbXBEaXYudGV4dENvbnRlbnQgfHwgdGVtcERpdi5pbm5lclRleHQgfHwgJyc7IH07CiAgICAgICAgICAgICAgICBjb25zdCBsZXNzb25UZXh0ID0gYCR7ZXh0cmFjdFRleHQobGVzc29uLnBvaW50KX0gJHtleHRyYWN0VGV4dChsZXNzb24ubWVtb3J5KX0gJHtleHRyYWN0VGV4dChsZXNzb24uc3VtbWFyeSl9YC50cmltKCk7CiAgICAgICAgICAgICAgICBzZWxlY3RQcm9qZWN0QW5kR2VuZXJhdGVCbHVlcHJpbnRRdWl6KGZ1bGxUb3BpY05hbWUsIGxlc3NvblRleHQsIHRvcGljSWQsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYDguJnguLfguYnguK3guKvguLLguJrguJfguYDguKPguLXguKLguJnguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IAogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwcmVwYXJpbmcgY29udGVudCBxdWl6OiIsIGVycm9yKTsgCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0b3BpY1F1aXpCdG4pIHsKICAgICAgICBjb25zdCBmdWxsVG9waWNOYW1lID0gZ2V0RnVsbFRvcGljTmFtZSh0b3BpY1Jvdyk7CiAgICAgICAgc2VsZWN0UHJvamVjdEFuZEdlbmVyYXRlQmx1ZXByaW50UXVpeihmdWxsVG9waWNOYW1lLCBudWxsLCB0b3BpY0lkLCBmYWxzZSk7CiAgICB9CiAgICBlbHNlIGlmICh2aWV3QnRuKSB7CiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0c2AsIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgdG9waWNEYXRhID0gcHJvamVjdERhdGEudG9waWNzW3RvcGljSWRdOwogICAgICAgICAgICBpZiAodG9waWNEYXRhICYmIHRvcGljRGF0YS5zdGF0dXMgPT09ICdnZW5lcmF0ZWQnKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0cy8ke2N1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWR9L2xlc3NvbnNgLCB0b3BpY0lkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsZXNzb25TbmFwID0gYXdhaXQgZ2V0RG9jKGxlc3NvblJlZik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxlc3NvblNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVzc29uQ29udGVudCA9IGxlc3NvblNuYXAuZGF0YSgpLmNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy10aXRsZScpLnRleHRDb250ZW50ID0gYOC4muC4l+C5gOC4o+C4teC4ouC4meC5gOC4o+C4t+C5iOC4reC4hzogJHtnZXRGdWxsVG9waWNOYW1lKHRvcGljUm93KX1gOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9pbnRDb250ZW50JykuaW5uZXJIVE1MID0gbGVzc29uQ29udGVudC5wb2ludDsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbW9yeUNvbnRlbnQnKS5pbm5lckhUTUwgPSBsZXNzb25Db250ZW50Lm1lbW9yeTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlDb250ZW50JykuaW5uZXJIVE1MID0gbGVzc29uQ29udGVudC5zdW1tYXJ5OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcHBsaWNhdGlvbkNvbnRlbnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBsaWNhdGlvbkNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlc3NvbkNvbnRlbnQuYXBwbGljYXRpb25EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXBwbGljYXRpb25EYXRhID0gbGVzc29uQ29udGVudC5hcHBsaWNhdGlvbkRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbkNvbnRlbnRFbC5pbm5lckhUTUwgPSBjdXJyZW50QXBwbGljYXRpb25EYXRhLm1hcCgocSwgaW5kZXgpID0+IGA8ZGl2IGNsYXNzPSJhcHBsaWNhdGlvbi1xdWVzdGlvbiBtYi00Ij48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtpbmRleCArIDF9LiAke21hcmtlZC5wYXJzZUlubGluZShxLnF1ZXN0aW9uKX08L3A+PGRpdiBjbGFzcz0iYXBwbGljYXRpb24tb3B0aW9ucyBtdC0yIiBpZD0icSR7aW5kZXh9LW9wdGlvbnMiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBvcHRJbmRleCkgPT4gYDxidXR0b24gY2xhc3M9InctZnVsbCB0ZXh0LWxlZnQgcC0yIGJvcmRlciByb3VuZGVkLW1kIG10LTEgaG92ZXI6YmctZ3JheS0xMDAiIG9uY2xpY2s9ImNoZWNrQW5zd2VyKCR7aW5kZXh9LCAke29wdEluZGV4fSkiPiR7U3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIG9wdEluZGV4KX0uICR7bWFya2VkLnBhcnNlSW5saW5lKG9wdCl9PC9idXR0b24+YCkuam9pbignJyl9PC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXBwbGljYXRpb25EYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbkNvbnRlbnRFbC5pbm5lckhUTUwgPSBsZXNzb25Db250ZW50LmFwcGxpY2F0aW9uSFRNTCB8fCBsZXNzb25Db250ZW50LmFwcGxpY2F0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tbG9hZGVyJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tc2VjdGlvbnMtY29udGFpbmVyJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lk1hdGhKYXgpIHsgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi12aWV3LWNvbnRlbnQnKV0pOyB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC4muC4l+C5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5iSAo4Lit4Liy4LiI4LiW4Li54LiB4Lil4Lia4LmE4Lib4LmB4Lil4LmJ4LinKSIpOyB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChmZXRjaEVycm9yKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIGxlc3NvbiBjb250ZW50OiIsIGZldGNoRXJyb3IpOyBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lia4LiX4LmA4Lij4Li14Lii4LiZIik7IH0KICAgICAgICAgICAgfSBlbHNlIHsgc2hvd01lc3NhZ2UoIuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4muC4l+C5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5hOC4p+C5iSwg4LiB4Lij4Li44LiT4Liy4LiB4LiUICfguKrguKPguYnguLLguIfguYPguKvguKHguYgnIik7IH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChnZW5lcmF0ZUJ0bikgewogICAgICAgIGNvbnN0IGZ1bGxUb3BpY05hbWUgPSBnZXRGdWxsVG9waWNOYW1lKHRvcGljUm93KTsKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBnZW5lcmF0ZUFuZFNhdmVMZXNzb25Gb3JCbHVlcHJpbnQodG9waWNJZCwgZnVsbFRvcGljTmFtZSwgcHJvamVjdERhdGEuZ3JhZGVMZXZlbCk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgIGVkaXRUb3BpY0luUHJvamVjdCh0b3BpY0lkKTsKICAgIH0KICAgIGVsc2UgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgIGRlbGV0ZVRvcGljRnJvbVByb2plY3QodG9waWNJZCk7CiAgICB9Cn0pOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaXgtbGVzc29uLWxhdGV4LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRml4TGVzc29uTGF0ZXgpOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVzc29uLXRvLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUV4cG9ydExlc3NvblRvUERGKTsKCQkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtbGVzc29uLXZpZXctYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgkJCmNvbnN0IGJ1bGtDb25maWRlbmNlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVsay1jb25maWRlbmNlLXNjb3JpbmctY2hlY2tib3gnKTsKY29uc3QgYnVsa0NvbmZpZGVuY2VNb2RlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstY29uZmlkZW5jZS1tb2RlLWNvbnRhaW5lcicpOwpidWxrQ29uZmlkZW5jZUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgIGJ1bGtDb25maWRlbmNlTW9kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhYnVsa0NvbmZpZGVuY2VDaGVja2JveC5jaGVja2VkKTsKfSk7CgovLyBMb2dpYyDguKrguLPguKvguKPguLHguJrguKvguJnguYnguLLguJXguLHguYnguIfguITguYjguLLguKvguKXguLHguIEKY29uc3QgY29uZmlkZW5jZUNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2Utc2NvcmluZy1jaGVja2JveCcpOwpjb25zdCBjb25maWRlbmNlTW9kZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWRlbmNlLW1vZGUtY29udGFpbmVyJyk7CmNvbmZpZGVuY2VDaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICBjb25maWRlbmNlTW9kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhY29uZmlkZW5jZUNoZWNrYm94LmNoZWNrZWQpOwp9KTsKCi8vIExvZ2ljIOC4quC4s+C4q+C4o+C4seC4miBNb2RhbApjb25zdCBtb2RhbENvbmZpZGVuY2VDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jb25maWRlbmNlLXNjb3JpbmctY2hlY2tib3gnKTsKY29uc3QgbW9kYWxDb25maWRlbmNlTW9kZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jb25maWRlbmNlLW1vZGUtY29udGFpbmVyJyk7Cm1vZGFsQ29uZmlkZW5jZUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgIG1vZGFsQ29uZmlkZW5jZU1vZGVDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgIW1vZGFsQ29uZmlkZW5jZUNoZWNrYm94LmNoZWNrZWQpOwp9KTsKCi8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJLy8g4pa84pa84pa8IFtTVEFSVF0g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVycyDguKrguLPguKvguKPguLHguJogQ29uZmlkZW5jZSBNb2RhbCDilrzilrzilrwKY29uc3QgY29uZmlkZW5jZU1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKTsKY29uc3QgaGFuZGxlQ29uZmlkZW5jZUNob2ljZSA9IGFzeW5jIChpc0NvbmZpZGVudCkgPT4gewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1tb2RhbCcpOwogICAgY29uc3QgbW9kZSA9IG1vZGFsLmRhdGFzZXQuY3VycmVudE1vZGU7IC8vIOC4reC5iOC4suC4meC5guC4q+C4oeC4lOC4m+C4seC4iOC4iOC4uOC4muC4seC4mQogICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbicpOwogICAgCiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsIOC4geC5iOC4reC4mQoKICAgIGlmIChtb2RlID09PSAndGltZWQnKSB7CiAgICAgICAgLy8gPT09IExvZ2ljIOC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC4iOC4seC4muC5gOC4p+C4peC4suC4o+C4suC4ouC4guC5ieC4rSA9PT0KICAgICAgICBjb25zdCBhbnN3ZXJWYWx1ZSA9IGhpZGRlbklucHV0LnZhbHVlOwogICAgICAgIGNvbnN0IGFuc3dlckRhdGEgPSB7CiAgICAgICAgICAgIGFuc3dlcjogYW5zd2VyVmFsdWUsCiAgICAgICAgICAgIHdhc0NvbmZpZGVudDogaXNDb25maWRlbnQKICAgICAgICB9OwogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4mwogICAgICAgIHByb2NlZWRUb05leHRRdWVzdGlvbihhbnN3ZXJEYXRhKTsKCiAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdzeW5jJykgewogICAgICAgIC8vID09PSBMb2dpYyDguKrguLPguKvguKPguLHguJogU3luYyBNb2RlICjguYLguITguYnguJTguYDguJTguLTguKHguJfguLXguYjguYHguIHguYnguYTguILguYTguJvguITguKPguLHguYnguIfguIHguYjguK3guJkpID09PQogICAgICAgIGNvbnN0IGFuc3dlclZhbHVlID0gaGlkZGVuSW5wdXQuZGF0YXNldC5hbnN3ZXJWYWx1ZTsKICAgICAgICBjb25zdCBxdWVzdGlvbiA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5xdWVzdGlvbik7CiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBKU09OLnBhcnNlKGhpZGRlbklucHV0LmRhdGFzZXQuZ2FtZURhdGEpOwogICAgICAgIGNvbnN0IHBsYXllck5hbWUgPSBoaWRkZW5JbnB1dC5kYXRhc2V0LnBsYXllck5hbWU7CgogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5g+C4mSBTeW5jIE1vZGUKICAgICAgICBoYW5kbGVTeW5jQW5zd2VyU3VibWl0KGFuc3dlclZhbHVlLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllck5hbWUsIGlzQ29uZmlkZW50KTsKICAgIH0KICAgIAogICAgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4Liy4LmC4Lir4Lih4LiU4Lir4Lil4Lix4LiH4LiI4Liy4LiB4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiICiAgICBtb2RhbC5kYXRhc2V0LmN1cnJlbnRNb2RlID0gJyc7IAp9OwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tY29uZmlkZW50JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVDb25maWRlbmNlQ2hvaWNlKHRydWUpKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbm90LWNvbmZpZGVudCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gaGFuZGxlQ29uZmlkZW5jZUNob2ljZShmYWxzZSkpOwovLyDilrLilrLilrIgW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiUIEV2ZW50IExpc3RlbmVycyDguKrguLPguKvguKPguLHguJogQ29uZmlkZW5jZSBNb2RhbCDilrLilrLilrIKCQkKCQlsaXZlR2FtZVZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LmA4Lib4LmH4LiZ4Lib4Li44LmI4Lih4Lil4Lia4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiC4Lit4LiHIFN5bmMgTW9kZSDguKvguKPguLfguK3guYTguKHguYgKICAgIGNvbnN0IGtpY2tCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcua2ljay1wbGF5ZXItYnRuLXN5bmMnKTsKICAgIGlmIChraWNrQnRuKSB7CiAgICAgICAgY29uc3QgcGxheWVyTmFtZSA9IGtpY2tCdG4uZGF0YXNldC5wbGF5ZXJOYW1lOwogICAgICAgIGlmIChwbGF5ZXJOYW1lKSB7CiAgICAgICAgICAgIGhhbmRsZUtpY2tQbGF5ZXJTeW5jKHBsYXllck5hbWUpOwogICAgICAgIH0KICAgIH0KfSk7CgkJCgkJLy8g4pa84pa84pa8IOC4p+C4suC4h+C5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5hOC4p+C5ieC4muC4meC4quC4uOC4lOC4guC4reC4h+C4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzZXR1cEV2ZW50TGlzdGVuZXJzIOKWvOKWvOKWvApjb25zdCBjb25maXJtR2FtZVN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tZ2FtZS1zdGFydC1idG4nKTsKY29uc3QgY2FuY2VsR2FtZVN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1nYW1lLXN0YXJ0LWJ0bicpOwoKY2FuY2VsR2FtZVN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tZ2FtZS1zdGFydC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmNvbmZpcm1HYW1lU3RhcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb25zdCBxdWl6SWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1zdGFydC1xdWl6LWlkJykudmFsdWU7CiAgICBjb25zdCBnYW1lTW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLXN0YXJ0LW1vZGUnKS52YWx1ZTsKICAgIGNvbnN0IHNob3VsZFNhdmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1nYW1lLXJlc3VsdHMtY2hlY2tib3gnKS5jaGVja2VkOwoKICAgIC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJnguYDguKPguLTguYjguKHguYDguIHguKEKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWdhbWUtc3RhcnQtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYDguKPguLTguYjguKHguYDguIHguKHguJXguLLguKEgbW9kZSDguJfguLXguYjguYDguIHguYfguJrguYTguKfguYkKICAgIHN3aXRjaChnYW1lTW9kZSkgewogICAgICAgIGNhc2UgJ2xpdmUtcmFjZSc6CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkLCBzaG91bGRTYXZlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndGVhbSc6CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0VGVhbVF1aXoocXVpeklkLCBzaG91bGRTYXZlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZ3JvdXAnOgogICAgICAgICAgICBoYW5kbGVTdGFydEdyb3VwTW9kZShxdWl6SWQsIHNob3VsZFNhdmUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzeW5jJzoKICAgICAgICAgICAgLy8gLS0tIFsg4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCiAgICAgICAgICAgIC8vIDEuIOC4reC5iOC4suC4meC4hOC5iOC4suC4iOC4suC4gSBSYWRpbyBCdXR0b24KICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRWYXJpYW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ic3luY1ZhcmlhbnQiXTpjaGVja2VkJykudmFsdWUgfHwgJ2NsYXNzaWMnOwogICAgICAgICAgICAvLyAyLiDguKrguYjguIfguITguYjguLIgdmFyaWFudCDguYTguJvguJTguYnguKfguKIKICAgICAgICAgICAgaGFuZGxlU3RhcnRTeW5jTW9kZShxdWl6SWQsIHNob3VsZFNhdmUsIHNlbGVjdGVkVmFyaWFudCk7IAogICAgICAgICAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0pOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqb2luLWdyb3VwLWFjdGl2aXR5LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlSm9pbkdyb3VwQWN0aXZpdHkpOwoKbGl2ZUdhbWVWaWV3LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IGJhckl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcuc3VtbWFyeS1iYXItaXRlbScpOwoKICAgIC8vIOC4i+C5iOC4reC4mSBUb29sdGlwIOC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguIHguYjguK3guJkKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5saXZlLXN1bW1hcnktdG9vbHRpcC52aXNpYmxlJykuZm9yRWFjaCh2aXNpYmxlVG9vbHRpcCA9PiB7CiAgICAgICAgLy8g4LiW4LmJ4LiyIHRvb2x0aXAg4LiX4Li14LmI4LmB4Liq4LiU4LiH4Lit4Lii4Li54LmI4LmE4Lih4LmI4LmD4LiK4LmI4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4Lii4LiC4Lit4LiHIGJhciDguJfguLXguYjguYDguJ7guLTguYjguIfguITguKXguLTguIEg4LmD4Lir4LmJ4LiL4LmI4Lit4LiZ4Lih4Lix4LiZ4LmE4LibCiAgICAgICAgaWYgKCFiYXJJdGVtIHx8IHZpc2libGVUb29sdGlwLmlkICE9PSBiYXJJdGVtLmRhdGFzZXQudG9vbHRpcFRhcmdldCkgewogICAgICAgICAgICB2aXNpYmxlVG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiE4Lil4Li04LiB4LiX4Li14LmI4LmB4LiX4LmI4LiH4LiB4Lij4Liy4LifIOC4geC5h+C5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4o+C4leC5iOC4rQogICAgaWYgKCFiYXJJdGVtKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4q+C4siBJRCDguILguK3guIcgdG9vbHRpcCDguYDguJvguYnguLLguKvguKHguLLguKLguIjguLLguIEgZGF0YSBhdHRyaWJ1dGUKICAgIGNvbnN0IHRvb2x0aXBJZCA9IGJhckl0ZW0uZGF0YXNldC50b29sdGlwVGFyZ2V0OwogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRvb2x0aXBJZCk7CgogICAgaWYgKHRvb2x0aXApIHsKICAgICAgICAvLyDguKrguKXguLHguJrguIHguLLguKPguYHguKrguJTguIfguJzguKXguILguK3guIcgdG9vbHRpcCDguJfguLXguYjguJbguLnguIHguITguKXguLTguIEKICAgICAgICB0b29sdGlwLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKTsKICAgIH0KfSk7CgkJCgkJICAgICAgICBsaXZlR2FtZVZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJvguLjguYjguKHguJfguLXguYjguJbguLnguIHguITguKXguLTguIHguITguLfguK3guJvguLjguYjguKEgIuC5gOC4leC4sCIg4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2tpY2stcGxheWVyLWJ0bicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJOYW1lID0gZS50YXJnZXQuZGF0YXNldC5wbGF5ZXJOYW1lOwogICAgICAgICAgICAgICAgaWYgKHBsYXllck5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVLaWNrUGxheWVyKHBsYXllck5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtdGl0bGUnKS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXByb2plY3QtbmFtZS1idG4nKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXByb2plY3QtbmFtZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNhdmVQcm9qZWN0TmFtZSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXRpdGxlJykuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7IGlmIChlLmtleSA9PT0gJ0VudGVyJykgeyBlLnByZXZlbnREZWZhdWx0KCk7IGUudGFyZ2V0LmJsdXIoKTsgaGFuZGxlU2F2ZVByb2plY3ROYW1lKCk7IH0gfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWxrLXF1aXotc2V0dGluZ3MtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtYnVsay1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tYnVsay1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQnVsa1VwZGF0ZVF1aXpTZXR0aW5ncyk7CgkJCiAgICAgICAgICAgIC8vIE5ldyB1bmlmaWVkIG1vZGUgc3dpdGNoZXIKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGUtc3dpdGNoZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVNb2RlU3dpdGNoKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGRhdGUtb2xkLXF1aXp6ZXMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVVcGRhdGVPbGRRdWl6emVzKTsJCQkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LXByb2plY3Qtb3JkZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVSZXNldFByb2plY3RPcmRlcik7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXZpc2liaWxpdHktc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTYXZlVmlzaWJpbGl0eVNldHRpbmdzKTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1jdXN0b20tbWF0aC10b3BpYy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUFkZEN1c3RvbU1hdGhUb3BpYyk7CgkJCQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWFsbC10b3BpY3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWxlY3RBbGxUb3BpY3MpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzZWxlY3QtYWxsLXRvcGljcy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZURlc2VsZWN0QWxsVG9waWNzKTsKCi8vIC0tLSDguKfguLLguIfguJfguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiHIGJhY2stdG8tZGFzaGJvYXJkLWJ0biDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWRhc2hib2FyZC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4nuC4tOC5iOC4oeC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5gOC4nuC4t+C5iOC4reC4leC4o+C4p+C4iOC4quC4reC4miAi4LiE4Lin4Liy4Lih4LiI4LizIgogICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICAvLyDguJbguYnguLLguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4siBCbHVlcHJpbnQgTWFuYWdlcgogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOyAvLyDguKXguYnguLLguIfguITguKfguLLguKHguIjguLPguJfguLTguYnguIcKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4Lih4Liy4LiI4Liy4LiBIEJsdWVwcmludCDguYPguKvguYnguJfguLPguIfguLLguJnguJXguLLguKHguJvguIHguJXguLQKICAgICAgICBjdXJyZW50UHJvamVjdElkID0gbnVsbDsKICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSBudWxsOwogICAgICAgIGlmICh1bnN1YnNjcmliZVN0dWRlbnRzTGlzdGVuZXIpIHVuc3Vic2NyaWJlU3R1ZGVudHNMaXN0ZW5lcigpOwogICAgICAgIGlmICh1bnN1YnNjcmliZVF1aXp6ZXNMaXN0ZW5lcikgdW5zdWJzY3JpYmVRdWl6emVzTGlzdGVuZXIoKTsKICAgICAgICBpZiAodW5zdWJzY3JpYmVTdHVkZW50UHJvZmlsZXNMaXN0ZW5lcikgdW5zdWJzY3JpYmVTdHVkZW50UHJvZmlsZXNMaXN0ZW5lcigpOwogICAgICAgIHNob3dWaWV3KCdhZG1pbi1kYXNoYm9hcmQnKTsKICAgIH0KfSk7Ci8vIC0tLSDguKfguLLguIfguJfguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiHIGJhY2stdG8tcHJvamVjdC1idG4g4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by1wcm9qZWN0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiC4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaICLguITguKfguLLguKHguIjguLMiCiAgICBpZiAoY2FtZUZyb21CbHVlcHJpbnQgJiYgY3VycmVudEJsdWVwcmludFByb2plY3RJZCkgewogICAgICAgIC8vIOC4luC5ieC4suC4oeC4suC4iOC4suC4gSBCbHVlcHJpbnQg4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCBNYW5hZ2VyCiAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gZmFsc2U7IC8vIOC4peC5ieC4suC4h+C4hOC4p+C4suC4oeC4iOC4s+C4l+C4tOC5ieC4hwogICAgfSBlbHNlIHsKICAgICAgICAvLyDguJbguYnguLLguYTguKHguYjguYTguJTguYnguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4l+C4s+C4h+C4suC4meC4leC4suC4oeC4m+C4geC4leC4tAogICAgICAgIGlmICh1bnN1YnNjcmliZVN1Ym1pc3Npb25zTGlzdGVuZXIpIHVuc3Vic2NyaWJlU3VibWlzc2lvbnNMaXN0ZW5lcigpOwogICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgfQp9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWRhc2hib2FyZC1mcm9tLXJlc3VsdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTW9kYWxzCiAgICAgICAgICAgIC8vIC0tLSDguKfguLLguIfguJfguLHguJrguJrguKPguKPguJfguLHguJTguYDguJTguLTguKEgLS0tCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jbG9zZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIC8vIDEuIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hyBQb3AtdXAgKOC4l+C4s+C4h+C4suC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAvLyAyLiDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguKHguLUgIuC4hOC4s+C4quC4seC5iOC4h+C4nuC4tOC5gOC4qOC4qSIg4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiX4Liz4LiV4LmI4Lit4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICBpZiAodHlwZW9mIG1vZGFsQ29uZmlybUFjdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIG1vZGFsQ29uZmlybUFjdGlvbigpOyAvLyAzLiDguJbguYnguLLguKHguLUg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4LiE4Liz4Liq4Lix4LmI4LiH4LiZ4Lix4LmJ4LiZIQogICAgICAgIG1vZGFsQ29uZmlybUFjdGlvbiA9IG51bGw7IC8vIDQuIOC4peC5ieC4suC4h+C4hOC4s+C4quC4seC5iOC4h+C4l+C4tOC5ieC4hyDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguJfguLPguIfguLLguJnguIvguYnguLPguYPguJnguITguKPguLHguYnguIfguJXguYjguK3guYTguJsKICAgIH0KfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcmVhdGUtcHJvamVjdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGNyZWF0ZVByb2plY3RNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtY3JlYXRlLXByb2plY3QtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBjcmVhdGVQcm9qZWN0TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRtaW4gUGFzc3dvcmQgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1hZG1pbi1sb2dpbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGFkbWluUGFzc3dvcmRNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWFkbWluLWxvZ2luLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQWRtaW5Mb2dpbik7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1wYXNzd29yZC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykgaGFuZGxlQWRtaW5Mb2dpbigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENvbmZpcm1hdGlvbiBNb2RhbAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLWRlbGV0ZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYW5jZWxBY3Rpb24gPT09ICdmdW5jdGlvbicpIHsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oSAyIOC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgICAgICAgICAgICAgIGNhbmNlbEFjdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICBjYW5jZWxBY3Rpb24gPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1kZWxldGUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY29uZmlybUFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1BY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICBjYW5jZWxBY3Rpb24gPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gTW9kYWwgTGlzdGVuZXJzCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcmVuYW1lLXF1aXotYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZW5hbWVRdWl6TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1yZW5hbWUtcXVpei1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1SZW5hbWVRdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1tb3ZlLXF1aXotYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBtb3ZlUXVpek1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbW92ZS1xdWl6LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybU1vdmVRdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcXVpelNldHRpbmdzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybVF1aXpTZXR0aW5ncyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1zdGF0dXMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBxdWl6U3RhdHVzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1xdWl6LXN0YXR1cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1RdWl6U3RhdHVzKTsKCQkJCgkJCS8vIOKWvOKWvOKWvCDguJnguLPguYLguITguYnguJTguJfguLXguYjguJbguLLguKHguKHguLLguKfguLLguIfguJXguYjguK3guJfguYnguLLguKLguJXguKPguIfguJnguLXguYnguYTguJTguYnguYDguKXguKLguITguKPguLHguJog4pa84pa84pa8CmNvbnN0IGV4cG9ydFBkZk1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1wZGYtbW9kYWwnKTsKLy8g4Lib4Li44LmI4Lih4Lii4LiB4LmA4Lil4Li04LiBCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZXhwb3J0LXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGV4cG9ydFBkZk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKLy8g4Lib4Li44LmI4LihIEV4cG9ydCDguYHguJrguJrguIHguKPguLDguIrguLHguJogKDIg4LiE4Lit4Lil4Lix4Lih4LiZ4LmMKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LWNvbXBhY3QtcGRmLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBhY3Rpb25UYXJnZXRJZCk7CiAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsgLy8g4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIHF1aXog4LiX4Li14LmI4LiI4LiwIGV4cG9ydAogICAgICAgIGV4cG9ydFF1aXpBc1dvcmtzaGVldFBERigpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKEKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgfQogICAgZXhwb3J0UGRmTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwovLyDguJvguLjguYjguKEgRXhwb3J0IOC5geC4muC4muC4leC4tOC4pyAo4LiC4LmJ4Lit4Lil4Liw4Lir4LiZ4LmJ4LiyKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LXR1dG9yLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gYWN0aW9uVGFyZ2V0SWQpOwogICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgY3VycmVudFF1aXpEYXRhID0gcXVpekRhdGE7IC8vIOC4leC4seC5ieC4h+C4hOC5iOC4siBxdWl6IOC4l+C4teC5iOC4iOC4sCBleHBvcnQKICAgICAgICBleHBvcnRRdWl6QXNUdXRvclBERigpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgfQogICAgZXhwb3J0UGRmTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoJCQkKLy8g4pyFIOC5guC4hOC5ieC4lOC5g+C4q+C4oeC5iOC4l+C4teC5iOC5geC4geC5ieC5hOC4guC5geC4peC5ieC4pwoKLy8gMS4g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Lib4Li44LmI4Lih4Lir4LiZ4LmJ4LiyIERhc2hib2FyZCDguKvguKXguLHguIHguYPguKvguYnguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKY29uc3Qgb3Blbkdsb2JhbEFjdGl2aXR5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW4tZ2xvYmFsLWxpdmUtYnRuJyk7Cm9wZW5HbG9iYWxBY3Rpdml0eUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1wbGF5LWNpcmNsZSBtci0yIj48L2k+4LmA4Lij4Li04LmI4Lih4LiB4Li04LiI4LiB4Lij4Lij4LihJzsgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiK4Li34LmI4Lit4Lib4Li44LmI4LihCm9wZW5HbG9iYWxBY3Rpdml0eUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5HbG9iYWxBY3Rpdml0eU1vZGFsKTsgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmICgovLyAyLiBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKHguJvguLTguJTguYHguKXguLDguIrguYjguK3guIfguITguYnguJnguKvguLLguYPguJkgTW9kYWwg4LmD4Lir4Lih4LmICmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZ2xvYmFsLWFjdGl2aXR5LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1hY3Rpdml0eS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1xdWl6LXNlYXJjaC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgIHJlbmRlckdsb2JhbEFjdGl2aXR5TGlzdChlLnRhcmdldC52YWx1ZSk7Cn0pOwoKLy8g4pyFIOC5guC4hOC5ieC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4guC5geC4peC5ieC4pwovLyAzLiBFdmVudCBMaXN0ZW5lciDguKvguKXguLHguIHguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguYLguKvguKHguJTguYDguIHguKHguJfguLHguYnguIfguKvguKHguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1hY3Rpdml0eS1xdWl6LWxpc3QnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBnYW1lQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmdhbWUtc3RhcnQtYnRuJyk7CiAgICBpZiAoIWdhbWVCdG4pIHJldHVybjsgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiE4Lil4Li04LiB4LiX4Li14LmI4Lib4Li44LmI4LihIOC5g+C4q+C5ieC4q+C4ouC4uOC4lOC4l+C4s+C4h+C4suC4mQoKICAgIGNvbnN0IHF1aXpJZCA9IGdhbWVCdG4uZGF0YXNldC5pZDsKICAgIGNvbnN0IGdhbWVNb2RlID0gZ2FtZUJ0bi5kYXRhc2V0Lm1vZGU7CiAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CgogICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHICLguYDguKPguLTguYjguKHguIHguLTguIjguIHguKPguKPguKEiIOC4geC5iOC4reC4meC5gOC4quC4oeC4rQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnbG9iYWwtYWN0aXZpdHktbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAgICAgLy8gLS0tIFsg4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCiAgICAgICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lib4Li44LmI4Lih4LiX4Li14LmI4LiB4LiU4LiE4Li34LitICdsaXZlLXJhY2UnIOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ2xpdmUtcmFjZScpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmD4LiK4LmIOiDguYPguKvguYnguYDguKPguLTguYjguKHguYDguIHguKHguKrguJTguJfguLHguJnguJfguLUg4LmC4LiU4Lii4LmE4Lih4LmI4LiW4Liy4Lih4LmA4Lij4Li34LmI4Lit4LiH4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liw4LmB4LiZ4LiZCiAgICAgICAgICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguJbguYnguLLguYDguJvguYfguJnguYLguKvguKHguJTguK3guLfguYjguJkgKFRlYW0sIEdyb3VwLCBTeW5jKTog4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4Lii4Li34LiZ4Lii4Lix4LiZ4LiV4Liy4Lih4Lib4LiB4LiV4Li0CiAgICAgICAgICAgIHNob3dHYW1lU3RhcnRDb25maXJtYXRpb25Nb2RhbChxdWl6SWQsIGdhbWVNb2RlLCBxdWl6RGF0YS50b3BpYyk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgfQp9KTsKICAgICAgICAgICAgLy8gU2VhcmNoIGFuZCBTb3J0IExpc3RlbmVycwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1zZWFyY2gtaW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHJlbmRlclByb2plY3RzKTsKICAgICAgICAgICAgLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQovLyDguYLguITguYnguJTguYPguKvguKHguYgKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3Qtc29ydC1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBuZXdTb3J0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1zb3J0LXNlbGVjdCcpLnZhbHVlOwogICAgY29uc3Qgc2V0dGluZ3NSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgIHRyeSB7CiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiE4LmI4Liy4LmD4LiZIEZpcmVzdG9yZQogICAgICAgIGF3YWl0IHNldERvYyhzZXR0aW5nc1JlZiwgeyBwcm9qZWN0U29ydDogbmV3U29ydFZhbHVlIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgLy8g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmA4Lij4Li14Lii4LiBIHJlbmRlclByb2plY3RzKCkg4LiX4Li14LmI4LiZ4Li14LmI4LmB4Lil4LmJ4LinIOC5gOC4nuC4o+C4suC4sCBvblNuYXBzaG90IOC4iOC4sOC4l+C4s+C4h+C4suC4meC5g+C4q+C5ieC5gOC4reC4hwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBzb3J0IHByZWZlcmVuY2U6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIHguIHguLLguKPguIjguLHguJTguYDguKPguLXguKLguIciKTsKICAgIH0KfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXNlYXJjaC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgcmVuZGVyUXVpenplcyk7CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZC12aWV3LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFZpZXcgPSAnZ3JpZCc7CiAgICBzYXZlVXNlclByZWZlcmVuY2UoJ3Byb2plY3RWaWV3JywgJ2dyaWQnKTsgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICByZW5kZXJQcm9qZWN0cygpOyAvLyDguKfguLLguJTguKvguJnguYnguLLguIjguK3guYPguKvguKHguYgKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdC12aWV3LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFZpZXcgPSAnbGlzdCc7CiAgICBzYXZlVXNlclByZWZlcmVuY2UoJ3Byb2plY3RWaWV3JywgJ2xpc3QnKTsgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICByZW5kZXJQcm9qZWN0cygpOyAvLyDguKfguLLguJTguKvguJnguYnguLLguIjguK3guYPguKvguKHguYgKfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgogICAgICAgICAgICAvLyBQcm9qZWN0IERldGFpbCBUYWJzCiAgICAgICAgICAgIG1hbmFnZVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFByb2plY3RUYWIoJ21hbmFnZScpKTsKICAgICAgICAgICAgcmVzdWx0c1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFByb2plY3RUYWIoJ3Jlc3VsdHMnKSk7CiAgICAgICAgICAgIGxlYWRlcmJvYXJkVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc3dpdGNoUHJvamVjdFRhYignbGVhZGVyYm9hcmQnKSk7CgogICAgICAgICAgICAvLyBRdWl6IFJlc3VsdHMgVGFicwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2FuYWx5dGljcycpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3Jlcy10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzd2l0Y2hRdWl6RGV0YWlsVGFiKCdzY29yZXMnKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkZXJib2FyZC1xdWl6LXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2xlYWRlcmJvYXJkLXF1aXonKSk7CgkJCQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmVoYXZpb3ItbG9nLXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2JlaGF2aW9yLWxvZycpKTsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQoJCQkKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emUtc3RyZW5ndGhzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQW5hbHl6ZUNsYXNzKTsKICAgICAgICAgICAgZ2VuZXJhdGVXb3Jrc2hlZXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBnZW5lcmF0ZVdvcmtzaGVldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gU1RBUlQ6IOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC4n+C4teC5gOC4iOC4reC4o+C5jCAi4Liq4Lij4LmJ4Liy4LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMIiAtLS0KICAgICAgICAgICAgY29uc3QgbGlua1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5rLXRhYicpOwogICAgICAgICAgICBjb25zdCBsaW5rSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbmstaW5wdXQtYXJlYScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIOKWvOKWvOKWvCBb4Lib4Lij4Liw4LiB4Liy4Lio4LiV4Lix4Lin4LmB4Lib4LijIFVJIOC5g+C4q+C4oeC5iF0g4pa84pa84pa8IC0tLQogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXRhYicpOwogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LWlucHV0LWFyZWEnKTsKICAgICAgICAgICAgLy8gLS0tIOKWsuKWsuKWsiBb4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4Lib4Lij4Liw4LiB4Liy4Lio4LiV4Lix4Lin4LmB4Lib4LijXSDilrLilrLilrIgLS0tCgkJCQogICAgICAgICAgICAvLyAtLS0g4pa84pa84pa8IFtTVEFSVCBPRiBGSVhdIOC4m+C4o+C4sOC4geC4suC4qOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4miAi4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZIiAtLS0KCQkJY29uc3QgcGFyYWxsZWxUZXN0VGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXRlc3QtdGFiJyk7CiAgICAgICAgICAgIGNvbnN0IHBhcmFsbGVsVGVzdElucHV0QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LWlucHV0LWFyZWEnKTsKICAgICAgICAgICAgLy8gLS0tIFtFTkQgT0YgRklYXSAtLS0KCiAgICAgICAgICAgIC8vIEdlbmVyYXRpb24gVGFicwogICAgICAgICAgICB0b3BpY1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIC8vIERlYWN0aXZhdGUgb3RoZXJzCiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGV4dFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAvLyBIaWRlIG90aGVycwogICAgICAgICAgICAgICAgdG9waWNJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZmlsZVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICBmaWxlVGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGV4dFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIHBhbmVsCiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgdGV4dElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtJbnB1dEFyZWEpIGxpbmtJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdElucHV0QXJlYSkgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDilrzilrzilrwgW0ZJWF0gSGlkZSBwYXJhbGxlbCBwYW5lbAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHdvcmtzaGVldFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB3b3Jrc2hlZXRUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVycwogICAgICAgICAgICAgICAgdG9waWNUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXJzCiAgICAgICAgICAgICAgICB0b3BpY0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgYmFua1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXRhYicpOwogICAgICAgICAgICBjb25zdCBiYW5rSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbmstaW5wdXQtYXJlYScpOwoKICAgICAgICAgICAgaWYoYmFua1RhYikgewogICAgICAgICAgICAgICAgYmFua1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVyIHRhYnMKICAgICAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGZpbGVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50VGFiKSBibHVlcHJpbnRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBEZWFjdGl2YXRlIHBhcmFsbGVsIHRhYgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICAgICAgYmFua1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlciBpbnB1dCBhcmVhcwogICAgICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RJbnB1dEFyZWEpIHBhcmFsbGVsVGVzdElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4pa84pa84pa8IFtGSVhdIEhpZGUgcGFyYWxsZWwgcGFuZWwKCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIGlucHV0IGFyZWEgYW5kIGxvYWQgdGhlIHF1ZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIGJhbmtJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheVF1ZXN0aW9uQmFuaygpOyAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihsaW5rVGFiKSB7CiAgICAgICAgICAgICAgICBsaW5rVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICAgICAgbGlua1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVycwogICAgICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHRleHRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50VGFiKSBibHVlcHJpbnRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBEZWFjdGl2YXRlIHBhcmFsbGVsIHRhYgoKICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgICAgICBsaW5rSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXJzCiAgICAgICAgICAgICAgICAgICAgdG9waWNJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RJbnB1dEFyZWEpIHBhcmFsbGVsVGVzdElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4pa84pa84pa8IFtGSVhdIEhpZGUgcGFyYWxsZWwgcGFuZWwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tbGluay1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUdlbmVyYXRlRnJvbUxpbmspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBFTkQ6IOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC4n+C4teC5gOC4iOC4reC4o+C5jCAi4Liq4Lij4LmJ4Liy4LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMIiAtLS0KCiAgICAgICAgICAgIC8vIC0tLSDilrzilrzilrwgW+C5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguYHguJfguYfguJogQmx1ZXByaW50IOC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lF0g4pa84pa84pa8IC0tLQogICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIHsKICAgICAgICAgICAgICAgIGJsdWVwcmludFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBBY3RpdmF0ZSB0aGlzIHRhYgogICAgICAgICAgICAgICAgICAgIGJsdWVwcmludFRhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVyIHRhYnMKICAgICAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGZpbGVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmFua1RhYikgYmFua1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RUYWIpIHBhcmFsbGVsVGVzdFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsgLy8g4pa84pa84pa8IFtGSVhdIERlYWN0aXZhdGUgcGFyYWxsZWwgdGFiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIGlucHV0IGFyZWEKICAgICAgICAgICAgICAgICAgICBibHVlcHJpbnRJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlciBpbnB1dCBhcmVhcwogICAgICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihiYW5rSW5wdXRBcmVhKSBiYW5rSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdElucHV0QXJlYSkgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDilrzilrzilrwgW0ZJWF0gSGlkZSBwYXJhbGxlbCBwYW5lbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCQkJCgkJCS8vIC0tLSDilrzilrzilrwgW1NUQVJUIE9GIEZJWF0g4LmB4LiB4LmJ4LmE4LiCIEV2ZW50IExpc3RlbmVyIOC4guC4reC4hyAi4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZIiAtLS0KICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSB7CiAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RUYWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gQWN0aXZhdGUgdGhpcyB0YWIKICAgICAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlciB0YWJzCiAgICAgICAgICAgICAgICAgICAgdG9waWNUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBmaWxlVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBpZihsaW5rVGFiKSBsaW5rVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludFRhYikgYmx1ZXByaW50VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGJhbmtUYWIpIGJhbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CgogICAgICAgICAgICAgICAgICAgIC8vIFNob3cgdGhpcyBpbnB1dCBhcmVhCiAgICAgICAgICAgICAgICAgICAgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXIgaW5wdXQgYXJlYXMKICAgICAgICAgICAgICAgICAgICB0b3BpY0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGZpbGVJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtJbnB1dEFyZWEpIGxpbmtJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50SW5wdXRBcmVhKSBibHVlcHJpbnRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmFua0lucHV0QXJlYSkgYmFua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBbRU5EIE9GIEZJWF0gLS0tCgogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdXBsb2FkLWlucHV0Jyk7CiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWJsdWVwcmludC1idG4nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChibHVlcHJpbnRVcGxvYWRJbnB1dCkgewovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgYmx1ZXByaW50VXBsb2FkSW5wdXQg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApjb25zdCBibHVlcHJpbnRVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdXBsb2FkLWlucHV0Jyk7CmNvbnN0IGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWJsdWVwcmludC1idG4nKTsKY29uc3QgYmx1ZXByaW50T3B0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtb3B0aW9ucy1jb250YWluZXInKTsKY29uc3Qgc2VwYXJhdGVDb250ZW50Q2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1jaGVja2JveCcpOwpjb25zdCB0b3BpY3NMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC10b3BpY3MtbGlzdC1jb250YWluZXInKTsKY29uc3QgdG9waWNzTGlzdERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdG9waWNzLWxpc3QnKTsKCmlmIChibHVlcHJpbnRVcGxvYWRJbnB1dCkgewogICAgYmx1ZXByaW50VXBsb2FkSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGV2ZW50KSA9PiB7CiAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmA4LiB4LmI4Liy4LmA4Lih4Li34LmI4Lit4Lih4Li14LiB4Liy4Lij4Lit4Lix4Lib4LmC4Lir4Lil4LiU4LmE4Lif4Lil4LmM4LmD4Lir4Lih4LmICiAgICAgICAgYmx1ZXByaW50T3B0aW9uc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHNlcGFyYXRlQ29udGVudENoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSB0cnVlOwoKICAgICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgIGlmIChmaWxlKSB7CiAgICAgICAgICAgIC8vIOC5gOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIOC5gOC4o+C4tOC5iOC4oeC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4q+C4seC4p+C4guC5ieC4reC4iOC4suC4geC5hOC4n+C4peC5jCBQREYKICAgICAgICAgICAgICAgIGNvbnN0IHBkZlRleHQgPSBhd2FpdCBleHRyYWN0VGV4dEZyb21QZGYoZmlsZSk7CiAgICAgICAgICAgICAgICBhd2FpdCBhbmFseXplQmx1ZXByaW50Rm9yVG9waWNzKHBkZlRleHQpOyAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoJ+C5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4reC5iOC4suC4meC5hOC4n+C4peC5jCBQREYg4LmA4Lie4Li34LmI4Lit4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4LmE4LiU4LmJJyk7CiAgICAgICAgICAgICAgICBibHVlcHJpbnRPcHRpb25zQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4miBDaGVja2JveCAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lii4LiB4LiV4Liy4Lih4LmA4LiZ4Li34LmJ4Lit4Lir4LiyIgppZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3gpIHsKICAgIHNlcGFyYXRlQ29udGVudENoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGV2ZW50LnRhcmdldC5jaGVja2VkOwogICAgICAgIC8vIOC5geC4quC4lOC4hy/guIvguYjguK3guJnguKPguLLguKLguIHguLLguKPguKvguLHguKfguILguYnguK0KICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFpc0NoZWNrZWQpOwogICAgICAgIC8vIOC4m+C4tOC4lC/guYDguJvguLTguJTguJvguLjguYjguKHguKrguKPguYnguLLguIfguKvguKXguLHguIEKICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSBpc0NoZWNrZWQ7CiAgICB9KTsKfQoKLy8gRXZlbnQgTGlzdGVuZXIgKERlbGVnYXRpb24pIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC5gOC4peC4t+C4reC4geC4q+C4seC4p+C4guC5ieC4rQppZiAodG9waWNzTGlzdERpdikgewovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWNzTGlzdERpdiDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmlmICh0b3BpY3NMaXN0RGl2KSB7CiAgICB0b3BpY3NMaXN0RGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgY29uc3QgcXVpekJ0biA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcudG9waWMtc2VsZWN0aW9uLWJ0bicpOwogICAgICAgIGNvbnN0IGNvbnRlbnRCdG4gPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmdlbmVyYXRlLWNvbnRlbnQtYnRuJyk7CgogICAgICAgIGlmIChxdWl6QnRuKSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4m+C4uOC5iOC4oSAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIgogICAgICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKHF1aXpCdG4uZGF0YXNldC50b3BpYyk7CiAgICAgICAgICAgIGdlbmVyYXRlUXVpekZvclNpbmdsZVRvcGljKHRvcGljKTsKICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnRCdG4pIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LiE4Lil4Li04LiB4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYDguJnguLfguYnguK3guKvguLLguKrguLPguKvguKPguLHguJrguKrguK3guJkiCiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gdW5lc2NhcGUoY29udGVudEJ0bi5kYXRhc2V0LnRvcGljKTsKICAgICAgICAgICAgaGFuZGxlR2VuZXJhdGVUZWFjaGluZ0NvbnRlbnQodG9waWMpOwogICAgICAgIH0KICAgIH0pOwp9Ci8vIOKWsuKWsuKWsiBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C4p+C4suC4h+C4l+C4seC4miDilrLilrLilrIKfQovLyDilrLilrLilrIgRU5EOiDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguKfguLLguIfguJfguLHguJog4pay4pay4payCiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgaWYgKGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0bikgewogICAgICAgICAgICAgICAgZ2VuZXJhdGVGcm9tQmx1ZXByaW50QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAtLS0g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguILguK3guIcgQmx1ZXByaW50XSDilrLilrLilrIgLS0tCgkJCQoJCQkvLyA9PT0g4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUID09PQogICAgICAgICAgICBjb25zdCBwYXJhbGxlbFRlc3RVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LXVwbG9hZC1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBnZW5lcmF0ZUZyb21QYXJhbGxlbFRlc3RCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1wYXJhbGxlbC10ZXN0LWJ0bicpOwoKICAgICAgICAgICAgaWYgKHBhcmFsbGVsVGVzdFVwbG9hZElucHV0KSB7CiAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RVcGxvYWRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyDguYDguJvguLTguJQv4Lib4Li04LiU4Lib4Li44LmI4Lih4LiV4Liy4Lih4LiB4Liy4Lij4LmA4Lil4Li34Lit4LiB4LmE4Lif4Lil4LmMCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVGcm9tUGFyYWxsZWxUZXN0QnRuLmRpc2FibGVkID0gZXZlbnQudGFyZ2V0LmZpbGVzLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2VuZXJhdGVGcm9tUGFyYWxsZWxUZXN0QnRuKSB7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZUZyb21QYXJhbGxlbFRlc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmC4LiU4Lii4LmE4Lih4LmI4Liq4LmI4LiH4LiE4LmI4Liy4LmD4LiU4LmGIOC5gOC4guC5ieC4suC5hOC4mwogICAgICAgICAgICAgICAgICAgIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxUZXN0KCk7IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFN0dWRlbnQgZmxvdyBidXR0b25zCiAgICAgICAgICAgIGxvYWRRdWl6QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlTG9hZFF1aXopOwovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4LiaIGV2ZW50IGxpc3RlbmVyIOC4guC4reC4h+C4m+C4uOC5iOC4oSBzdGFydFF1aXpCdG4g4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApzdGFydFF1aXpCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBzdHVkZW50TmFtZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LW5hbWUtc2VsZWN0Jyk7CiAgICBjdXJyZW50U3R1ZGVudE5hbWUgPSBzdHVkZW50TmFtZVNlbGVjdC52YWx1ZTsKICAgIGlmICghY3VycmVudFN0dWRlbnROYW1lKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4iuC4t+C5iOC4reC4guC4reC4h+C4hOC4uOC4kyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IHF1aXpJZCA9IGN1cnJlbnRRdWl6RGF0YS5pZDsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgY3VycmVudFN0dWRlbnROYW1lKTsKICAgICAgICAKICAgICAgICAvLyAtLS0g4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4geC5iOC4reC4meC4p+C5iOC4suC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C5gOC4geC5iOC4suC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25TbmFwID0gYXdhaXQgZ2V0RG9jKHN1Ym1pc3Npb25SZWYpOwoKICAgICAgICBpZiAoIXN1Ym1pc3Npb25TbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIC8vIDIuIOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC5gOC4hOC4ouC4quC5iOC4h+C5gOC4peC4oiDguYPguKvguYnguKrguKPguYnguLLguIfguYDguK3guIHguKrguLLguKPguYPguKvguKHguYjguJ7guKPguYnguK3guKEgYXR0ZW1wdHM6IFtdCiAgICAgICAgICAgIGF3YWl0IHNldERvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgICAgICBzdHVkZW50TmFtZTogY3VycmVudFN0dWRlbnROYW1lLAogICAgICAgICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgICBiZWhhdmlvckxvZzogW10sCiAgICAgICAgICAgICAgICBhdHRlbXB0czogW10KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gMy4g4LiW4LmJ4Liy4LmA4LiE4Lii4Liq4LmI4LiH4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC4reC4seC4m+C5gOC4lOC4leC5geC4hOC5iOC5gOC4p+C4peC4suC4l+C4teC5iOC5gOC4o+C4tOC5iOC4oeC4peC5iOC4suC4quC4uOC4lCDguYLguJTguKLguYTguKHguYjguYTguJvguKLguLjguYjguIfguIHguLHguJogYXJyYXkgJ2F0dGVtcHRzJwogICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2Moc3VibWlzc2lvblJlZiwgewogICAgICAgICAgICAgICAgc3RhcnRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gY3JlYXRlL3VwZGF0ZSBzdWJtaXNzaW9uIHJlY29yZDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4o+C4tOC5iOC4oeC4l+C4s+C4guC5ieC4reC4quC4reC4miDguIHguKPguLjguJPguLLguKXguK3guIfguYPguKvguKHguYjguK3guLXguIHguITguKPguLHguYnguIciKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgc3R1ZGVudE5hbWVTZWxlY3Rpb25WaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICBkaXNwbGF5UXVpekZvclN0dWRlbnQoY3VycmVudFF1aXpEYXRhKTsKfSk7CiAgICAgICAgICAgIC8vIE5FVzogTGl2ZSBHYW1lIExpc3RlbmVycwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam9pbi1saXZlLWdhbWUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93Sm9pbkdhbWVWaWV3KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tam9pbi1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlSm9pbkxpdmVHYW1lKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stdG8tc3R1ZGVudC1pbml0aWFsLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2hvd1ZpZXcoJ3N0dWRlbnQnKSk7CgoKICAgICAgICAgICAgLy8gPT09IFNUQVJUOiDguK3guLHguJvguYDguJTguJXguKrguYjguKfguJkgRXZlbnQgTGlzdGVuZXJzIOC4guC4reC4h+C4m+C4uOC5iOC4oSBFeHBvcnQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUID09PQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIGZvciBTY29yZXMgVGFibGUgZmlsZW5hbWUKICAgICAgICAgICAgY29uc3QgZ2V0UmVzdWx0c0ZpbGVuYW1lID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcXVpelRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtcXVpei10aXRsZScpLnRleHRDb250ZW50LnJlcGxhY2UoL1teYS16MC05XS9naSwgJ18nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGByZXN1bHRzXyR7cXVpelRpdGxlIHx8ICdxdWl6J31gOwogICAgICAgICAgICB9OwoJCQkKCQkJLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4iuC5iOC4reC4h+C4hOC5ieC4meC4q+C4suC4q+C4seC4p+C4guC5ieC4reC4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jAogICAgICAgICAgICAvLyDilrzilrzilrwg4LiZ4Liz4LmC4LiE4LmJ4LiU4Lia4Lil4LmH4Lit4LiB4LiZ4Li14LmJ4LmE4Lib4LmB4LiX4LiZ4LiX4Li14LmI4LiC4Lit4LiH4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApjb25zdCB0b3BpY1NlYXJjaElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdGgtdG9waWMtc2VhcmNoLWlucHV0Jyk7CmlmICh0b3BpY1NlYXJjaElucHV0KSB7CiAgICB0b3BpY1NlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICBjb25zdCBzZWFyY2hUZXJtID0gZS50YXJnZXQudmFsdWUudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgY29uc3QgY2hlY2tib3hDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CiAgICAgICAgCiAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiI4Lix4LiU4LiB4Liy4Lij4LmB4LiV4LmI4Lil4Liw4Lir4Lih4Lin4LiU4Lir4Lih4Li54LmICiAgICAgICAgY29uc3QgY2F0ZWdvcmllcyA9IGNoZWNrYm94Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy50b3BpYy1jYXRlZ29yeScpOwogICAgICAgIGNhdGVnb3JpZXMuZm9yRWFjaChjYXRlZ29yeSA9PiB7CiAgICAgICAgICAgIGxldCBjYXRlZ29yeUhhc1Zpc2libGVUb3BpYyA9IGZhbHNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiI4Lix4LiU4LiB4Liy4Lij4LmB4LiV4LmI4Lil4LiwICLguJrguKPguKPguJfguLHguJQiIOC4guC4reC4h+C4q+C4seC4p+C4guC5ieC4rQogICAgICAgICAgICBjb25zdCB0b3BpY1Jvd3MgPSBjYXRlZ29yeS5xdWVyeVNlbGVjdG9yQWxsKCcudG9waWMtcm93Jyk7CiAgICAgICAgICAgIHRvcGljUm93cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3BpY05hbWUgPSByb3cucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtZGlzcGxheScpLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0b3BpY05hbWUuaW5jbHVkZXMoc2VhcmNoVGVybSkpIHsKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgLy8g4LmB4Liq4LiU4LiH4LiX4Lix4LmJ4LiH4Lia4Lij4Lij4LiX4Lix4LiUCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlIYXNWaXNpYmxlVG9waWMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgLy8g4LiL4LmI4Lit4LiZ4LiX4Lix4LmJ4LiH4Lia4Lij4Lij4LiX4Lix4LiUCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8g4LiL4LmI4Lit4LiZL+C5geC4quC4lOC4h+C4iuC4t+C5iOC4reC4q+C4oeC4p+C4lOC4q+C4oeC4ueC5iAogICAgICAgICAgICBpZiAoY2F0ZWdvcnlIYXNWaXNpYmxlVG9waWMpIHsKICAgICAgICAgICAgICAgIGNhdGVnb3J5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2F0ZWdvcnkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4l+C4meC4l+C4teC5iCDilrLilrLilrIKCiAgICAgICAgICAgIC8vIEV4cG9ydCBidXR0b25zIGZvciBTY29yZXMgVGFibGUgKENIQU5HRUQpCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtaW1hZ2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzSW1hZ2UoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1wZGYtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzUERGKCdyZXN1bHRzLXRhYmxlJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC13b3JkLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZXhwb3J0VGFibGVBc1dvcmQoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1leGNlbC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGV4cG9ydFRhYmxlQXNFeGNlbCgncmVzdWx0cy10YWJsZScsIGdldFJlc3VsdHNGaWxlbmFtZSgpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXIgZnVuY3Rpb24gZm9yIExlYWRlcmJvYXJkIFRhYmxlIGZpbGVuYW1lCiAgICAgICAgICAgIGNvbnN0IGdldExlYWRlcmJvYXJkRmlsZW5hbWUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBxdWl6VGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy1xdWl6LXRpdGxlJykudGV4dENvbnRlbnQucmVwbGFjZSgvW15hLXowLTldL2dpLCAnXycpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYGxlYWRlcmJvYXJkXyR7cXVpelRpdGxlIHx8ICdxdWl6J31gOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRXhwb3J0IGJ1dHRvbnMgZm9yIExlYWRlcmJvYXJkIFRhYmxlIChORVcpCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVhZGVyYm9hcmQtaW1hZ2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzSW1hZ2UoJ3F1aXotbGVhZGVyYm9hcmQtdGFibGUtY29udGFpbmVyJywgZ2V0TGVhZGVyYm9hcmRGaWxlbmFtZSgpKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVhZGVyYm9hcmQtcGRmLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZXhwb3J0VGFibGVBc1BERigncXVpei1sZWFkZXJib2FyZC10YWJsZScsIGdldExlYWRlcmJvYXJkRmlsZW5hbWUoKSkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LWxlYWRlcmJvYXJkLXdvcmQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzV29yZCgncXVpei1sZWFkZXJib2FyZC10YWJsZS1jb250YWluZXInLCBnZXRMZWFkZXJib2FyZEZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1sZWFkZXJib2FyZC1leGNlbC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGV4cG9ydFRhYmxlQXNFeGNlbCgncXVpei1sZWFkZXJib2FyZC10YWJsZScsIGdldExlYWRlcmJvYXJkRmlsZW5hbWUoKSkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gPT09IEVORDog4Lit4Lix4Lib4LmA4LiU4LiV4Liq4LmI4Lin4LiZIEV2ZW50IExpc3RlbmVycyDguILguK3guIfguJvguLjguYjguKEgRXhwb3J0IOC4l+C4seC5ieC4h+C4q+C4oeC4lCA9PT0KCgoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4miBldmVudCBsaXN0ZW5lciDguILguK3guIcgcHJvamVjdFF1aXp6ZXNMaXN0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKcHJvamVjdFF1aXp6ZXNMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgIC8vIDEuIOC4m+C4o+C4sOC4geC4suC4qOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lAogICAgY29uc3QgbWFpbkNhcmQgPSBlLnRhcmdldC5jbG9zZXN0KCcucXVpei1yZXN1bHQtY2FyZCcpOwogICAgY29uc3QgcG9zdFRlc3RCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtcG9zdC10ZXN0LWJ0bicpOwogICAgY29uc3QgY29tcGFyZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5jb21wYXJlLXJlc3VsdHMtYnRuJyk7CiAgICBjb25zdCBsZXNzb25CdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtbGVzc29uLWJ0bicpOwogICAgY29uc3Qgc3RhckJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zdGFyLXF1aXotYnRuJyk7CiAgICBjb25zdCBjb3B5QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmNvcHktcXVpei1pZC1saXN0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LXF1aXotYnRuJyk7CiAgICBjb25zdCBzZXR0aW5nc0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5xdWl6LXNldHRpbmdzLWJ0bicpOwogICAgY29uc3QgZHVwbGljYXRlQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmR1cGxpY2F0ZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcmVuYW1lQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnJlbmFtZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcGFyYWxsZWxCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcucGFyYWxsZWwtcXVpei1idG4nKTsKICAgIGNvbnN0IG1vdmVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcubW92ZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcGFpckJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wYWlyLXF1aXotYnRuJyk7CiAgICBjb25zdCB1bnBhaXJCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcudW5wYWlyLXF1aXotYnRuJyk7CiAgICBjb25zdCBwcmVzZW50QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnN0YXJ0LXByZXNlbnRhdGlvbi1saXN0LWJ0bicpOwogICAgY29uc3QgdHJ5UXVpekJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5hZG1pbi10cnktcXVpei1saXN0LWJ0bicpOwogICAgY29uc3QgZXhwb3J0UGRmQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmV4cG9ydC1wZGYtbGlzdC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcXVpei1idG4nKTsKICAgIGNvbnN0IHN0YXR1c0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5xdWl6LXN0YXR1cy1idG4nKTsKICAgIGNvbnN0IHRvZ2dsZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy50b2dnbGUtYWN0aW9ucy1idG4nKTsKICAgIGNvbnN0IGVhc3lCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtZWFzeS12ZXJzaW9uLWJ0bicpOwoJY29uc3QgZWFzeVBhcmFsbGVsQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmdlbmVyYXRlLWVhc3ktcGFyYWxsZWwtYnRuJyk7CiAgICAKICAgIC8vIOC4m+C4uOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC5gOC4geC4oQogICAgY29uc3QgZ2FtZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zdGFydC1nYW1lLWJ0bicpOwogICAgY29uc3QgbGl2ZVJhY2VCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuc3RhcnQtbGl2ZS1yYWNlLWJ0bicpOwoKICAgIC8vIDIuIOC4leC4o+C4o+C4geC4sOC4geC4suC4o+C4l+C4s+C4h+C4suC4meC4guC4reC4h+C4m+C4uOC5iOC4oQogICAgaWYgKGdhbWVCdG4pIHsKICAgICAgICAvLyAtLS0gW1NUQVJUXSDguIjguLjguJTguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCiAgICAgICAgY29uc3QgcXVpeklkID0gZ2FtZUJ0bi5kYXRhc2V0LnF1aXpJZDsgLy8g4LmB4LiB4LmJ4LiI4Liy4LiBIC5pZCDguYDguJvguYfguJkgLnF1aXpJZAogICAgICAgIGNvbnN0IG1vZGUgPSBnYW1lQnRuLmRhdGFzZXQubW9kZTsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICAgICAgc2hvd0dhbWVTdGFydENvbmZpcm1hdGlvbk1vZGFsKHF1aXpJZCwgbW9kZSwgcXVpekRhdGEudG9waWMpOwogICAgICAgIH0KICAgIH0gCmVsc2UgaWYgKGxpdmVSYWNlQnRuKSB7CiAgICBjb25zdCBxdWl6SWQgPSBsaXZlUmFjZUJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgIC8vIOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4o+C4tOC5iOC4oeC5gOC4geC4oeC4quC4lOC5guC4lOC4ouC4leC4o+C4hyDguYTguKHguYjguJXguYnguK3guIfguYHguKrguJTguIfguJvguYrguK3guJvguK3guLHguJsKICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkKTsKfQogICAgZWxzZSBpZiAodG9nZ2xlQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gdG9nZ2xlQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBhY3Rpb25zLWNvbnRhaW5lci0ke3F1aXpJZH1gKTsKICAgICAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChwb3N0VGVzdEJ0bikgewogICAgICAgIGNvbnN0IHF1aXpJZCA9IHBvc3RUZXN0QnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICBpZiAocXVpekRhdGEpIHsgaGFuZGxlR2VuZXJhdGVQYXJhbGxlbFBvc3RUZXN0KHF1aXpEYXRhKTsgfQogICAgfQogICAgZWxzZSBpZiAoY29tcGFyZUJ0bikgewogICAgICAgIGhhbmRsZUNvbXBhcmVSZXN1bHRzKGNvbXBhcmVCdG4uZGF0YXNldC5xdWl6SWQsIGNvbXBhcmVCdG4uZGF0YXNldC5wcmVUZXN0SWQpOwogICAgfQogICAgZWxzZSBpZiAobGVzc29uQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gbGVzc29uQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICBpZiAocXVpekRhdGEgJiYgcXVpekRhdGEubGVzc29uUGxhbikgewogICAgICAgICAgICBkaXNwbGF5TGVzc29uUGxhbihxdWl6RGF0YS5sZXNzb25QbGFuLCBxdWl6RGF0YSk7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oJ+C5geC4quC4lOC4h+C5geC4nOC4meC4geC4suC4o+C4quC4reC4meC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5ieC5geC4peC5ieC4pyDguKvguLLguIHguJXguYnguK3guIfguIHguLLguKPguKrguKPguYnguLLguIfguYPguKvguKHguYjguYDguJnguLfguYjguK3guIfguIjguLLguIHguKHguLXguJzguLnguYnguKrguK3guJrguYDguJ7guLTguYjguKEg4LiB4Lij4Li44LiT4Liy4LiB4LiUICLguKrguKPguYnguLLguIfguYPguKvguKHguYgiJywgKCkgPT4gaGFuZGxlR2VuZXJhdGVMZXNzb25QbGFuKHF1aXpJZCkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWF0aW9uLW1vZGFsJykucXVlcnlTZWxlY3RvcignaDMnKS50ZXh0Q29udGVudCA9ICfguYHguJzguJnguIHguLLguKPguKrguK3guJknOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1kZWxldGUtYnRuJykudGV4dENvbnRlbnQgPSAn4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmIJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoYW5kbGVHZW5lcmF0ZUxlc3NvblBsYW4ocXVpeklkKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChzdGFyQnRuKSB7IGhhbmRsZVRvZ2dsZVN0YXJRdWl6KHN0YXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChjb3B5QnRuKSB7IGNvcHlUZXh0VG9DbGlwYm9hcmQoY29weUJ0bi5kYXRhc2V0LnF1aXpJZCwgIuC4hOC4seC4lOC4peC4reC4geC4o+C4q+C4seC4quC5geC4peC5ieC4pyEiKTsgfQogICAgZWxzZSBpZiAoZWRpdEJ0bikgeyBoYW5kbGVPcGVuUXVpekVkaXRvcihlZGl0QnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAoc2V0dGluZ3NCdG4pIHsgaGFuZGxlUXVpelNldHRpbmdzKHNldHRpbmdzQnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAoZHVwbGljYXRlQnRuKSB7IGhhbmRsZUR1cGxpY2F0ZVF1aXooZHVwbGljYXRlQnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAocmVuYW1lQnRuKSB7IGhhbmRsZVJlbmFtZVF1aXoocmVuYW1lQnRuLmRhdGFzZXQucXVpeklkLCByZW5hbWVCdG4uZGF0YXNldC50b3BpYyk7IH0KICAgIGVsc2UgaWYgKHBhcmFsbGVsQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gcGFyYWxsZWxCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgeyBoYW5kbGVHZW5lcmF0ZVBhcmFsbGVsRnJvbUJhbmsocXVpekRhdGEpOyB9CiAgICB9CiAgICBlbHNlIGlmIChtb3ZlQnRuKSB7IGhhbmRsZU1vdmVRdWl6KG1vdmVCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChwYWlyQnRuKSB7IGhhbmRsZU1hbnVhbFF1aXpQYWlyaW5nKHBhaXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmICh1bnBhaXJCdG4pIHsgaGFuZGxlVW5wYWlyUXVpeih1bnBhaXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChwcmVzZW50QnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gcHJlc2VudEJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSk7CiAgICB9CiAgICBlbHNlIGlmICh0cnlRdWl6QnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gdHJ5UXVpekJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSB7IGN1cnJlbnRRdWl6RGF0YSA9IHF1aXpEYXRhOyBzdGFydEFkbWluVGVzdCgpOyB9CiAgICB9CiAgICBlbHNlIGlmIChleHBvcnRQZGZCdG4pIHsKICAgICAgICBhY3Rpb25UYXJnZXRJZCA9IGV4cG9ydFBkZkJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LXBkZi1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQogICAgZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke2RlbGV0ZUJ0bi5kYXRhc2V0LnRvcGljfSI/IOC4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lOC4iOC4sOC4luC4ueC4geC4peC4muC4reC4ouC5iOC4suC4h+C4luC4suC4p+C4o2AsICgpID0+IGhhbmRsZURlbGV0ZVF1aXooZGVsZXRlQnRuLmRhdGFzZXQucXVpeklkKSk7CiAgICB9CiAgICBlbHNlIGlmIChzdGF0dXNCdG4pIHsgaGFuZGxlUXVpelN0YXR1cyhzdGF0dXNCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChlYXN5QnRuKSB7CiAgICAgICAgaGFuZGxlR2VuZXJhdGVFYXN5VmVyc2lvblF1aXooZWFzeUJ0bi5kYXRhc2V0LnF1aXpJZCk7CiAgICB9CgkKCWVsc2UgaWYgKGVhc3lQYXJhbGxlbEJ0bikgewogICAgaGFuZGxlR2VuZXJhdGVFYXN5UGFyYWxsZWxRdWl6KGVhc3lQYXJhbGxlbEJ0bi5kYXRhc2V0LnF1aXpJZCk7Cn0KCQogICAgZWxzZSBpZiAobWFpbkNhcmQpIHsgc2hvd1F1aXpEZXRhaWxWaWV3KG1haW5DYXJkLmRhdGFzZXQucXVpeklkKTsgfQp9KTsKCiAgICAvLyBTdHVkZW50OiDguJvguLjguYjguKHguYPguJnguKvguJnguYnguLLguYDguKXguLfguK3guIHguJzguLnguYnguYDguKXguYjguJkKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtdGVhbS1zZWxlY3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzaG93Vmlldygnc3R1ZGVudCcpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXRlYW0tcGxheWVycy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1BbmRTdGFydFRlYW1RdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotbGVhZGVyYm9hcmQtdGFibGUnKS5xdWVyeVNlbGVjdG9yKCd0aGVhZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zb3J0YWJsZS1oZWFkZXInKTsKICAgICAgICAgICAgICAgIGlmICghaGVhZGVyIHx8ICFoZWFkZXIuZGF0YXNldC5zb3J0KSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgbmV3U29ydEJ5ID0gaGVhZGVyLmRhdGFzZXQuc29ydDsKICAgICAgICAgICAgICAgIGlmIChxdWl6TGVhZGVyYm9hcmRTb3J0QnkgPT09IG5ld1NvcnRCeSkgewogICAgICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4q+C4seC4p+C4guC5ieC4reC5gOC4lOC4tOC4oSDguYPguKvguYnguKrguKXguLHguJrguJfguLTguKjguJfguLLguIcKICAgICAgICAgICAgICAgICAgICBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPSBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4q+C4seC4p+C4guC5ieC4reC5g+C4q+C4oeC5iAogICAgICAgICAgICAgICAgICAgIHF1aXpMZWFkZXJib2FyZFNvcnRCeSA9IG5ld1NvcnRCeTsKICAgICAgICAgICAgICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLLguJfguLTguKjguJfguLLguIfguYDguKPguLTguYjguKHguJXguYnguJnguKrguLPguKvguKPguLHguJrguYHguJXguYjguKXguLDguJvguKPguLDguYDguKDguJfguILguYnguK3guKHguLnguKUKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QmFzZWRTb3J0ID0gWydzdHVkZW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgIHF1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9IHRleHRCYXNlZFNvcnQuaW5jbHVkZXMobmV3U29ydEJ5KSA/ICdhc2MnIDogJ2Rlc2MnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4Lin4Liy4LiU4LiV4Liy4Lij4Liy4LiH4LmD4Lir4Lih4LmI4LiU4LmJ4Lin4Lii4LiC4LmJ4Lit4Lih4Li54Lil4Lil4LmI4Liy4Liq4Li44LiU4LmB4Lil4Liw4LiB4Liy4Lij4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LmD4Lir4Lih4LmICiAgICAgICAgICAgICAgICByZW5kZXJRdWl6TGVhZGVyYm9hcmQoY3VycmVudFN1Ym1pc3Npb25zLCBjdXJyZW50UXVpekRhdGEsICdxdWl6LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBQcmVzZW50YXRpb24gTW9kZSBMaXN0ZW5lcnMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXByZXNlbnRhdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlUHJlc2VudGF0aW9uKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXYtcXVlc3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByZXNlbnRhdGlvblNsaWRlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZS0tOwogICAgICAgICAgICAgICAgICAgIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dC1xdWVzdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zICYmIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSA8IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSsrOwogICAgICAgICAgICAgICAgICAgIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBIYW5kbGUgZXhpdGluZyBmdWxsc2NyZWVuIHdpdGggRVNDIGtleQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIHByZXNlbnRhdGlvbk1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3R1ZGVudCBEZWxldGlvbiBMaXN0ZW5lcnMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1hbGwtc3R1ZGVudHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVEZWxldGVBbGxTdHVkZW50cyk7CiAgICAgICAgICAgIHN0dWRlbnRMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc3R1ZGVudC1idG4nKTsKICAgICAgICAgICAgICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGRlbGV0ZUJ0bi5kYXRhc2V0LnN0dWRlbnROYW1lOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZURlbGV0ZVN0dWRlbnQoc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSDguYLguITguYnguJTguYPguKvguKHguYjguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguYDguKXguLfguK3guIHguYTguJ/guKXguYzguYHguKXguLDguITguKXguLTguIHguJvguLjguYjguKEgLS0tCgogICAgICAgICAgICAvLyAxLiDguYDguJ7guLTguYjguKEgTGlzdGVuZXIg4LmD4Lir4LmJ4LiB4Lix4Lia4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiIOC5g+C4q+C4oeC5iOC4guC4reC4h+C5gOC4o+C4sgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlR2VuZXJhdGVGcm9tRmlsZUNsaWNrKTsKCiAgICAgICAgICAgIC8vIDIuIOC5gOC4m+C4peC4teC5iOC4ouC4mSBMaXN0ZW5lciDguILguK3guIfguIrguYjguK3guIfguYDguKXguLfguK3guIHguYTguJ/guKXguYwg4LmD4Lir4LmJ4LiX4Liz4LiH4Liy4LiZ4LmB4LiE4LmI4LmA4LiB4LmH4Lia4LmE4Lif4Lil4LmM4LmB4Lil4Liw4LmA4Lib4Li04LiUL+C4m+C4tOC4lOC4m+C4uOC5iOC4oQovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgZmlsZVVwbG9hZElucHV0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZmlsZVVwbG9hZElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgY29uc3QgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgIGNvbnN0IGdlbmVyYXRlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tZmlsZS1idG4nKTsKICAgIGNvbnN0IHRvcGljc0xpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10b3BpY3MtbGlzdC1jb250YWluZXInKTsKICAgIGNvbnN0IHNlcGFyYXRlQ29udGVudENoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcGFyYXRlLWJ5LWNvbnRlbnQtZnJvbS1maWxlLWNoZWNrYm94Jyk7CiAgICAKICAgIC8vIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4leC4seC4p+C5geC4m+C4o+C4iuC5iOC4reC4h+C5gOC4peC4t+C4reC4geC4q+C4meC5ieC4sgogICAgY29uc3QgcGFnZVNlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BkZi1wYWdlLXNlbGVjdG9yJyk7CgogICAgaWYgKGZpbGUpIHsKICAgICAgICBzZWxlY3RlZEZpbGUgPSBmaWxlOwogICAgICAgIAogICAgICAgIC8vIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4luC5ieC4suC5gOC4m+C5h+C4mSBQREYg4LmD4Lir4LmJ4LmC4LiK4Lin4LmM4LiK4LmI4Lit4LiH4LmA4Lil4Li34Lit4LiB4Lir4LiZ4LmJ4LiyCiAgICAgICAgaWYgKGZpbGUudHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHsKICAgICAgICAgICAgcGFnZVNlbGVjdG9yLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhZ2VTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BkZi1wYWdlLXJhbmdlJykudmFsdWUgPSAnJzsgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4LiyCiAgICAgICAgfQoKICAgICAgICBpZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3guY2hlY2tlZCkgewogICAgICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGFuYWx5emVGaWxlRm9yVG9waWNzKGZpbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRvcGljc0xpc3RDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3RlZEZpbGUgPSBudWxsOwogICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHBhZ2VTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiL4LmI4Lit4LiZ4LmA4Lih4Li34LmI4Lit4LmE4Lih4LmI4Lih4Li14LmE4Lif4Lil4LmMCiAgICB9Cn0pOwoKLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5g+C4q+C5ieC4geC4seC4miBDaGVja2JveApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1mcm9tLWZpbGUtY2hlY2tib3gnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXZlbnQpID0+IHsKICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGV2ZW50LnRhcmdldC5jaGVja2VkOwogICAgY29uc3QgZ2VuZXJhdGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpOwogICAgY29uc3QgdG9waWNzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXRvcGljcy1saXN0LWNvbnRhaW5lcicpOwoKICAgIGlmIChpc0NoZWNrZWQpIHsKICAgICAgICAvLyDguJbguYnguLLguJzguLnguYnguYPguIrguYnguJXguLTguYrguIEgY2hlY2tib3gKICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7IC8vIOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgICAgIGlmIChzZWxlY3RlZEZpbGUpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4Lih4Li14LmE4Lif4Lil4LmM4Lit4Lix4Lib4LmC4Lir4Lil4LiU4Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC5gOC4o+C4tOC5iOC4oeC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4l+C4seC4meC4l+C4tQogICAgICAgICAgICBhbmFseXplRmlsZUZvclRvcGljcyhzZWxlY3RlZEZpbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC5hOC4n+C4peC5jCDguYPguKvguYnguYHguKrguJTguIfguILguYnguK3guITguKfguLLguKHguKPguK0KICAgICAgICAgICAgdG9waWNzTGlzdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdG9waWNzLWxpc3QnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtZ3JheS00MDAgdGV4dC1jZW50ZXIiPuC4geC4o+C4uOC4k+C4suC4reC4seC4m+C5guC4q+C4peC4lOC5hOC4n+C4peC5jOC5gOC4nuC4t+C5iOC4reC5gOC4o+C4tOC5iOC4oeC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jC4uLjwvcD4nOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4Lic4Li54LmJ4LmD4LiK4LmJ4LmA4Lit4Liy4LiV4Li04LmK4LiB4Lit4Lit4LiBCiAgICAgICAgdG9waWNzTGlzdENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZ4Lij4Liy4Lii4LiB4Liy4Lij4Lir4Lix4Lin4LiC4LmJ4LitCiAgICAgICAgZ2VuZXJhdGVCdG4uZGlzYWJsZWQgPSAhc2VsZWN0ZWRGaWxlOyAvLyDguYDguJvguLTguJTguJvguLjguYjguKHguKrguKPguYnguLLguIfguKvguKXguLHguIEgKOC4luC5ieC4suC4oeC4teC5hOC4n+C4peC5jCkKICAgIH0KfSk7CgovLyDguYLguITguYnguJTguJfguLXguYjguYHguIHguYnguYTguILguYHguKXguYnguKcKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdG9waWNzLWxpc3QtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgIGNvbnN0IHF1aXpCdG4gPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmZpbGUtdG9waWMtc2VsZWN0aW9uLWJ0bicpOwogICAgY29uc3QgY29udGVudEJ0biA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtY29udGVudC1idG4nKTsKCiAgICBpZiAocXVpekJ0bikgewogICAgICAgIGNvbnN0IHRvcGljID0gdW5lc2NhcGUocXVpekJ0bi5kYXRhc2V0LnRvcGljKTsKICAgICAgICBnZW5lcmF0ZUh5YnJpZFF1aXpGb3JUb3BpYyh0b3BpYyk7CgogICAgfSBlbHNlIGlmIChjb250ZW50QnRuKSB7CiAgICAgICAgLy8gLS0tIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKGNvbnRlbnRCdG4uZGF0YXNldC50b3BpYyk7CiAgICAgICAgLy8g4LiU4Li24LiH4LiE4LmI4Liy4Lij4Liw4LiU4Lix4Lia4LiK4Lix4LmJ4LiZL+C4hOC4p+C4suC4oeC4ouC4suC4geC4iOC4suC4gSBkcm9wZG93biDguJfguLXguYjguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcKICAgICAgICBjb25zdCBncmFkZUxldmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykudmFsdWU7CiAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LmA4LiV4LmH4Lih4Lij4Li54Lib4LmB4Lia4LiaIDQg4Liq4LmI4Lin4LiZCiAgICAgICAgaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uKHRvcGljLCBncmFkZUxldmVsKTsKICAgIH0KfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItbW9kZS1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZHVyYXRpb24tY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbkxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLWR1cmF0aW9uLWxhYmVsJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLWR1cmF0aW9uLWlucHV0Jyk7CiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgPT09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgPT09ICd3aG9sZV9xdWl6JykgewogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkxhYmVsLnRleHRDb250ZW50ID0gJ+C4o+C4sOC4ouC4sOC5gOC4p+C4peC4siAo4LiZ4Liy4LiX4Li1KTonOwogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbklucHV0LnZhbHVlID0gJzEwJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwZXJfcXVlc3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25MYWJlbC50ZXh0Q29udGVudCA9ICfguKPguLDguKLguLDguYDguKfguKXguLIgKOC4p+C4tOC4meC4suC4l+C4tSk6JzsKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25JbnB1dC52YWx1ZSA9ICczMCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFF1aXogVHlwZSBTZWxlY3RvciBMaXN0ZW5lcgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei10eXBlLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBudW1DaG9pY2VzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1jaG9pY2VzLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGUudGFyZ2V0LnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgbnVtUXVlc3Rpb25zTGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsYWJlbFtmb3I9Im51bS1xdWVzdGlvbnMiXScpOwogICAgICAgICAgICAgICAgY29uc3QgcGFzc2luZ1Njb3JlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc2luZy1zY29yZS1pbnB1dCcpOwogICAgICAgICAgICAgICAgY29uc3QgbnVtUXVlc3Rpb25zSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbWF0Y2hpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgbnVtUXVlc3Rpb25zTGFiZWwudGV4dENvbnRlbnQgPSAn4LiI4Liz4LiZ4Lin4LiZ4LiE4Li54LmIOic7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG51bVF1ZXN0aW9uc0xhYmVsLnRleHRDb250ZW50ID0gJ+C4iOC4s+C4meC4p+C4meC4guC5ieC4rTonOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCB0eXBlID09PSAnZmlsbF9pbl93aXRoX2Nob2ljZXMnIHx8IHR5cGUgPT09ICdtaXhlZCcpIHsKICAgICAgICAgICAgICAgICAgICBudW1DaG9pY2VzQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBudW1DaG9pY2VzQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbWF4IGZvciBwYXNzaW5nIHNjb3JlCiAgICAgICAgICAgICAgICBwYXNzaW5nU2NvcmVJbnB1dC5tYXggPSBudW1RdWVzdGlvbnNJbnB1dC52YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzaW5nLXNjb3JlLWlucHV0JykubWF4ID0gZS50YXJnZXQudmFsdWU7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIC8vIE1vZGFsIFRpbWVyIFNldHRpbmdzIExpc3RlbmVyCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1tb2RlLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1kdXJhdGlvbi1jb250YWluZXInKTsKICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24tbGFiZWwnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24taW5wdXQnKTsKICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25Db250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ3dob2xlX3F1aXonKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uTGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguJnguLLguJfguLUpOic7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gcGVyX3F1ZXN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uTGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguKfguLTguJnguLLguJfguLUpOic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCQkJCgkJCS8vIEV2ZW50IExpc3RlbmVycyBmb3IgUXVpeiBFZGl0b3IgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1xdWl6LWVkaXRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLXF1aXotZWRpdHMtYnRuLWZvb3RlcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwoJCQkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmeS1hbnN3ZXJzLWVkaXRvci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVZlcmlmeUFuc3dlcnNJbkVkaXRvcik7CgkJCQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1xdWl6LWVkaXRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJOiDguKrguLHguYjguIfguYPguKvguYnguKvguJnguYnguLLguJXguYjguLLguIfguYHguIHguYnguYTguILguKvguLLguKLguYTguJvguIHguYjguK3guJkKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWVkaXRvci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgICAgICAgICAgICAgIC8vIOC4iOC4suC4geC4meC4seC5ieC4meC4hOC5iOC4reC4ouC5gOC4o+C4teC4ouC4geC4q+C4meC5ieC4suC4leC5iOC4suC4h+C4ouC4t+C4meC4ouC4seC4meC4leC4suC4oeC4m+C4geC4leC4tAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgICAgICAgICAn4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiI4Liw4LiX4Liz4LmD4Lir4LmJ4Lic4Lil4LiB4Liy4Lij4Liq4Lit4Lia4LmA4LiB4LmI4Liy4LmE4Lih4LmI4Liq4Lit4LiU4LiE4Lil4LmJ4Lit4LiH4LiB4Lix4Lia4LiE4Liz4LiW4Liy4Lih4LmB4Lil4Liw4LmA4LiJ4Lil4Lii4LiK4Li44LiU4LmD4Lir4Lih4LmIIOC4i+C4tuC5iOC4h+C4reC4suC4iOC4l+C4s+C5g+C4q+C5ieC4geC4suC4o+C5geC4quC4lOC4h+C4nOC4peC4hOC4sOC5geC4meC4meC5gOC4geC5iOC4suC5gOC4geC4tOC4lOC4hOC4p+C4suC4oeC4quC4seC4muC4quC4meC5hOC4lOC5iSDguITguLjguJPguJXguYnguK3guIfguIHguLLguKPguJrguLHguJnguJfguLbguIHguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIfguKvguKPguLfguK3guYTguKHguYg/JywKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTYXZlQ2hhbmdlcwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KTsKCQkJCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLWZpeC1sYXRleC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUF1dG9GaXhMYXRleCk7CgkJCQoJCQkvLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmE4LiU4LmJ4LmA4Lil4LiiIOKWvOKWvOKWvAogICAgICAgICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1lZGl0b3ItcXVlc3Rpb25zLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoZWRpdG9yQ29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICBlZGl0b3JDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4m+C4uOC5iOC4oSAi4Liq4Lij4LmJ4Liy4LiH4LmC4LiI4LiX4Lii4LmM4LmD4Lir4Lih4LmIIgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2VuZXJhdGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcucmVnZW5lcmF0ZS1xdWVzdGlvbi1lZGl0b3ItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2VuZXJhdGVCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25JdGVtID0gcmVnZW5lcmF0ZUJ0bi5jbG9zZXN0KCcucXVlc3Rpb24tZWRpdG9yLWl0ZW0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludChxdWVzdGlvbkl0ZW0uZGF0YXNldC5xSW5kZXgsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUmVnZW5lcmF0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lib4Li44LmI4LihICLguKXguJrguITguLPguJbguLLguKEiCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmRlbGV0ZS1xdWVzdGlvbi1lZGl0b3ItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvbkl0ZW0gPSBkZWxldGVCdG4uY2xvc2VzdCgnLnF1ZXN0aW9uLWVkaXRvci1pdGVtJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQocXVlc3Rpb25JdGVtLmRhdGFzZXQucUluZGV4LCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZURlbGV0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4leC4o+C4p+C4iOC4quC4reC4muC4m+C4uOC5iOC4oSAi4LmA4Lie4Li04LmI4Lih4LiE4Liz4LiW4Liy4LihIgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJyNhZGQtcXVlc3Rpb24tZWRpdG9yLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGlmIChhZGRCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQWRkUXVlc3Rpb25JbkVkaXRvcigpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vICjguKrguYjguKfguJnguJvguLjguYjguKEgJ2FpLWZpeC1xdWVzdGlvbi1idG4nIOC4luC4ueC4geC4iOC4seC4lOC4geC4suC4o+C5guC4lOC4oiAuZm9yRWFjaCDguJTguYnguLLguJnguKXguYjguLLguIfguK3guKLguLnguYjguYHguKXguYnguKcg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Lii4Li44LmI4LiHKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMS4gRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4Lib4Li44LmI4LihICLguITguKXguLHguIfguYHguJrguJrguJfguJTguKrguK3guJoiIOC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1xdWl6LWJhbmstYnRuJykKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlblF1aXpCYW5rTW9kYWwpOwoKICAgICAgICAgICAgLy8gMi4gRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4Lib4Li44LmI4Lih4Lib4Li04LiUIChYKSDguILguK3guIcgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1iYW5rLWJ0bicpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAzLiBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguIrguYjguK3guIfguITguYnguJnguKvguLLguILguK3guIcgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotc2VhcmNoLWlucHV0JykKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHJlbmRlclF1aXpCYW5rTGlzdChlLnRhcmdldC52YWx1ZSkpOwkKCi8vIOKWvOKWvOKWvCDguJnguLPguYLguITguYnguJTguJrguKXguYfguK3guIHguJnguLXguYnguYTguJvguYHguJfguJnguJfguLXguYjguILguK3guIfguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmNvbnN0IG1hdGhUb3BpY3NDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CmlmIChtYXRoVG9waWNzQ29udGFpbmVyKSB7CiAgICBsZXQgY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4iuC5h+C4hOC4p+C5iOC4suC4oeC4teC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4geC4s+C4peC4seC4h+C5geC4geC5ieC5hOC4guC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAoKICAgIG1hdGhUb3BpY3NDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0OwogICAgICAgIAogICAgICAgIC8vIC0tLSDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJXguYjguLLguIfguYYgLS0tCiAgICAgICAgY29uc3QgZWRpdEJ0biA9IHRhcmdldC5jbG9zZXN0KCcuZWRpdC1jdXN0b20tdG9waWMtYnRuJyk7CiAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gdGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtY3VzdG9tLXRvcGljLWJ0bicpOwogICAgICAgIGNvbnN0IHNhdmVCdG4gPSB0YXJnZXQuY2xvc2VzdCgnLnNhdmUtY3VzdG9tLXRvcGljLWJ0bicpOwogICAgICAgIGNvbnN0IGNhbmNlbEJ0biA9IHRhcmdldC5jbG9zZXN0KCcuY2FuY2VsLWVkaXQtdG9waWMtYnRuJyk7CgogICAgICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gZGVsZXRlQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHRvcGljTmFtZSA9IGRlbGV0ZUJ0bi5jbG9zZXN0KCcuZ3JvdXAnKS5xdWVyeVNlbGVjdG9yKCcudG9waWMtbmFtZS1kaXNwbGF5JykudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4LitICIke3RvcGljTmFtZX0iP2AsCiAgICAgICAgICAgICAgICAoKSA9PiBoYW5kbGVEZWxldGVDdXN0b21Ub3BpYyh0b3BpY0lkKQogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4teC4reC4seC4meC4reC4t+C5iOC4meC4l+C4teC5iOC4geC4s+C4peC4seC4h+C5geC4geC5iSDguYPguKvguYnguKLguIHguYDguKXguLTguIHguIHguYjguK3guJkKICAgICAgICAgICAgaWYgKGN1cnJlbnRseUVkaXRpbmdDb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUoY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4guC4reC4seC4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4h+C4hOC4peC4tOC4gQogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IGVkaXRCdG4uY2xvc2VzdCgnW2RhdGEtdG9waWMtY29udGFpbmVyLWlkXScpOwogICAgICAgICAgICBjdXJyZW50bHlFZGl0aW5nQ29udGFpbmVyID0gdG9waWNDb250YWluZXI7CiAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUodG9waWNDb250YWluZXIsIHRydWUpOwoKICAgICAgICB9IGVsc2UgaWYgKHNhdmVCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gc2F2ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IHNhdmVCdG4uY2xvc2VzdCgnW2RhdGEtdG9waWMtY29udGFpbmVyLWlkXScpOwogICAgICAgICAgICBjb25zdCBuZXdOYW1lID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtaW5wdXQnKS52YWx1ZTsKICAgICAgICAgICAgaGFuZGxlVXBkYXRlQ3VzdG9tVG9waWModG9waWNJZCwgbmV3TmFtZSk7CiAgICAgICAgICAgIGN1cnJlbnRseUVkaXRpbmdDb250YWluZXIgPSBudWxsOyAvLyDguK3guK3guIHguIjguLLguIHguYLguKvguKHguJTguYHguIHguYnguYTguIIKCiAgICAgICAgfSBlbHNlIGlmIChjYW5jZWxCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IGNhbmNlbEJ0bi5jbG9zZXN0KCdbZGF0YS10b3BpYy1jb250YWluZXItaWRdJyk7CiAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUodG9waWNDb250YWluZXIsIGZhbHNlKTsKICAgICAgICAgICAgY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciA9IG51bGw7IC8vIOC4reC4reC4geC4iOC4suC4geC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4ggogICAgICAgIH0KICAgIH0pOwoJCgkvLyBFdmVudCBMaXN0ZW5lcnMg4Liq4Liz4Lir4Lij4Lix4LiaIE1vZGFsIOC5geC4nOC4meC4geC4suC4o+C4quC4reC4mQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtbGVzc29uLXBsYW4tbW9kYWwtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1sZXNzb24tcGxhbi1tb2RhbC1mb290ZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVzc29uLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUV4cG9ydExlc3NvblBERik7fQoKICAvLyBFdmVudCBMaXN0ZW5lcnMg4Liq4Liz4Lir4Lij4Lix4LiaIE1vZGFsIOC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4muC4nOC4pQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWNvbXBhcmlzb24tbW9kYWwtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWNvbXBhcmlzb24tbW9kYWwtZm9vdGVyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21wYXJpc29uLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKCnNldHVwQ29tcGFyaXNvbk1vZGFsVGFicygpOwoKZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncHJhY3RpY2UtdG9waWMtYnRuJykpIHsKICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKGV2ZW50LnRhcmdldC5kYXRhc2V0LnRvcGljKTsKICAgICAgICBzdGFydFNraWxsUHJhY3RpY2UodG9waWMpOyAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguJfguLXguYjguIjguLDguKrguKPguYnguLLguIfguYPguJnguILguLHguYnguJnguJXguK3guJnguJfguLXguYggMgogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZXMtdGFiLWNvbnRlbnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAvLyAxLiDguJvguLjguYjguKHguKXguJogKERlbGV0ZSkKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc3VibWlzc2lvbi1idG4nKTsKICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGRlbGV0ZUJ0bi5kYXRhc2V0LnN0dWRlbnROYW1lOwogICAgICAgIGhhbmRsZURlbGV0ZVN1Ym1pc3Npb24oc3R1ZGVudE5hbWUpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAyLiDguJvguLjguYjguKHguYHguIHguYnguYTguILguITguLDguYHguJnguJkgKEVkaXQgUG9pbnRzKSAtIFvguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguKHguYhdCiAgICBjb25zdCBlZGl0UG9pbnRzQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtcG9pbnRzLWJ0bicpOwogICAgaWYgKGVkaXRQb2ludHNCdG4pIHsKICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGVkaXRQb2ludHNCdG4uZGF0YXNldC5zdHVkZW50TmFtZTsKICAgICAgICBjb25zdCBjdXJyZW50UG9pbnRzID0gZWRpdFBvaW50c0J0bi5kYXRhc2V0LmN1cnJlbnRQb2ludHM7CiAgICAgICAgCiAgICAgICAgLy8g4LmB4Liq4LiU4LiHIFBvcHVwIOC5g+C4q+C5ieC4geC4o+C4reC4geC4hOC4sOC5geC4meC4meC5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IG5ld1BvaW50c1N0ciA9IHByb21wdChg4LmB4LiB4LmJ4LmE4LiC4LiE4Liw4LmB4LiZ4LiZIFBvaW50cyDguILguK3guIcgIiR7c3R1ZGVudE5hbWV9IlxuKOC5g+C4quC5iOC4hOC5iOC4suC5gOC4lOC4tOC4oeC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C4peC4h+C5hOC4mylgLCBjdXJyZW50UG9pbnRzKTsKICAgICAgICAKICAgICAgICBpZiAobmV3UG9pbnRzU3RyICE9PSBudWxsICYmIG5ld1BvaW50c1N0ci50cmltKCkgIT09ICcnKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld1BvaW50cyA9IHBhcnNlSW50KG5ld1BvaW50c1N0ciwgMTApOwogICAgICAgICAgICBpZiAoIWlzTmFOKG5ld1BvaW50cykpIHsKICAgICAgICAgICAgICAgIGhhbmRsZU1hbnVhbEVkaXRQb2ludHMoc3R1ZGVudE5hbWUsIG5ld1BvaW50cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydCgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiB4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXBpbi1tb2RhbC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpbi1lbnRyeS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSk7CgogICAgLy8g4Lib4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lil4LiCIDAtOQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBpbi1rZXknKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBoYW5kbGVQaW5LZXlQcmVzcyhidG4uZGF0YXNldC52YWwpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8g4Lib4Li44LmI4Lih4Lil4LiaIChCYWNrc3BhY2UpCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGluLWJhY2tzcGFjZS1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaGFuZGxlUGluS2V5UHJlc3MoJ2JhY2tzcGFjZScpOwogICAgfSk7CgkKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3RhcnRHcm91cE1vZGUocXVpeklkLCBzaG91bGRTYXZlID0gZmFsc2UpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIC0tLSBbIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQphc3luYyBmdW5jdGlvbiBzaG93U3R1ZGVudFByb2dyZXNzVmlldygpIHsKICAgICAgICAgICAgc3R1ZGVudEluaXRpYWxWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9ncmVzcy12aWV3JykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgICAgICAgICBjb25zdCBwcm9qZWN0U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzLXByb2plY3Qtc2VsZWN0Jyk7CiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3Mtc3R1ZGVudC1zZWxlY3QnKTsKICAgICAgICAgICAgY29uc3QgY29udGVudERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXByb2dyZXNzLWNvbnRlbnQnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guJTguLnguILguYnguK3guKHguLnguKU8L3A+JzsKICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLSDguYDguKXguLfguK3guIHguIrguLfguYjguK0gLS08L29wdGlvbj4nOwogICAgICAgICAgICBzdHVkZW50U2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIHByb2plY3RTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiULi4uPC9vcHRpb24+JzsKICAgICAgICAgICAgaWYgKGFsbFByb2plY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdHNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCk7CiAgICAgICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvamVjdHNSZWYpOwogICAgICAgICAgICAgICAgYWxsUHJvamVjdHMgPSBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEoKSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHZpc2libGVQcm9qZWN0cyA9IGFsbFByb2plY3RzLmZpbHRlcihwID0+IHAuc2V0dGluZ3M/LnNob3dJblN0dWRlbnREYXNoYm9hcmQgIT09IGZhbHNlKTsKICAgICAgICAgICAgdmlzaWJsZVByb2plY3RzLnNvcnQoKGEsIGIpID0+IGEucHJvamVjdE5hbWUubG9jYWxlQ29tcGFyZShiLnByb2plY3ROYW1lLCAndGgnKSk7CgogICAgICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKyAKICAgICAgICAgICAgICAgIHZpc2libGVQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwoKICAgICAgICAgICAgcHJvamVjdFNlbGVjdC5vbmNoYW5nZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzU3R1ZGVudCA9IHN0dWRlbnRTZWxlY3QudmFsdWU7IC8vIDEuIOC4iOC4s+C4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC5gOC4peC4t+C4reC4geC5hOC4p+C5ieC4geC5iOC4reC4meC4q+C4meC5ieC4sgogICAgICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3RJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgICAgICAgICBzdHVkZW50U2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4LitIC0tPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguIrguLfguYjguK3guILguK3guIfguITguLjguJM8L3A+JzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFzZWxlY3RlZFByb2plY3RJZCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSBhbGxQcm9qZWN0cy5maW5kKHAgPT4gcC5pZCA9PT0gc2VsZWN0ZWRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgaWYgKCFwcm9qZWN0IHx8ICFwcm9qZWN0LnN0dWRlbnRzKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHBvcHVsYXRlU3R1ZGVudERyb3Bkb3duID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4LitIC0tPC9vcHRpb24+JyArIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdC5zdHVkZW50cy5tYXAobmFtZSA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtuYW1lfSI+JHtuYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gW1NUQVJUXSDguKrguYjguKfguJnguYHguIHguYnguYTguILguYPguKvguKHguYggLS0tCiAgICAgICAgICAgICAgICAgICAgLy8gMi4g4Lie4Lii4Liy4Lii4Liy4Lih4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4Lit4LmA4LiU4Li04Lih4LmD4LiZ4LmC4Lib4Lij4LmA4LiI4LiE4LmD4Lir4Lih4LmI4LmD4Lir4LmJ4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3T3B0aW9ucyA9IEFycmF5LmZyb20oc3R1ZGVudFNlbGVjdC5vcHRpb25zKS5tYXAob3B0ID0+IG9wdC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzU3R1ZGVudCAmJiBuZXdPcHRpb25zLmluY2x1ZGVzKHByZXZpb3VzU3R1ZGVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC52YWx1ZSA9IHByZXZpb3VzU3R1ZGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvamVjdC5zdHVkZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC52YWx1ZSA9IHByb2plY3Quc3R1ZGVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gKOC4quC5iOC4p+C4mSBwYXNzY29kZSDguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4LiB4LmJ4LmE4LiCKQogICAgICAgICAgICAgICAgaWYgKHByb2plY3Quc2V0dGluZ3M/LmlzUGFzc2NvZGVFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2F1dGhlZF9wcm9qZWN0XycgKyBzZWxlY3RlZFByb2plY3RJZCkgPT09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVN0dWRlbnREcm9wZG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3Njb2RlTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1wYXNzY29kZS1tb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1wYXNzY29kZS1idG4nKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLXBhc3Njb2RlLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3Njb2RlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wYXNzY29kZS1pbnB1dCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3Njb2RlLWVycm9yLW1zZycpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzY29kZS1wcm9tcHQtbWVzc2FnZScpLnRleHRDb250ZW50ID0gYOC4quC4s+C4q+C4o+C4seC4muC5guC4m+C4o+C5gOC4iOC4hDogJHtwcm9qZWN0LnByb2plY3ROYW1lfWA7CiAgICAgICAgICAgICAgICAgICAgcGFzc2NvZGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGVycm9yTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlQ29uZmlybSA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50ZXJlZFBhc3Njb2RlID0gcGFzc2NvZGVJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRlcmVkUGFzc2NvZGUgPT09IHByb2plY3Quc2V0dGluZ3MucGFzc2NvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2F1dGhlZF9wcm9qZWN0XycgKyBzZWxlY3RlZFByb2plY3RJZCwgJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVN0dWRlbnREcm9wZG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNvbmZpcm0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdG4ub25jbGljayA9IGhhbmRsZUNvbmZpcm07CiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RTZWxlY3QudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNvbmZpcm0pOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlU3R1ZGVudERyb3Bkb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBzdHVkZW50U2VsZWN0Lm9uY2hhbmdlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0SWQgPSBwcm9qZWN0U2VsZWN0LnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRTdHVkZW50TmFtZSA9IHN0dWRlbnRTZWxlY3QudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRQcm9qZWN0SWQgJiYgc2VsZWN0ZWRTdHVkZW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRQcm9ncmVzc0Rhc2hib2FyZChzZWxlY3RlZFByb2plY3RJZCwgc2VsZWN0ZWRTdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQoJCQoKLy8gW0FVVE8tSU5KRUNURUQgSEVMUEVSUyAtIFNBRkVUWSBORVRdCndpbmRvdy5pc1F1aXpBY3RpdmUgPSBmYWxzZTsKd2luZG93LmNoZWF0QXR0ZW1wdHMgPSAwOwoKaWYgKHR5cGVvZiB3aW5kb3cucmVxdWVzdFdha2VMb2NrICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cucmVxdWVzdFdha2VMb2NrID0gYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsgaWYgKCd3YWtlTG9jaycgaW4gbmF2aWdhdG9yKSB7IGF3YWl0IG5hdmlnYXRvci53YWtlTG9jay5yZXF1ZXN0KCdzY3JlZW4nKTsgfSB9IGNhdGNoKGUpe30KICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgZG9jRWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgaWYgKGRvY0VsLnJlcXVlc3RGdWxsc2NyZWVuKSBkb2NFbC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgIGVsc2UgaWYgKGRvY0VsLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKSBkb2NFbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgIGVsc2UgaWYgKGRvY0VsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIGRvY0VsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuaGFuZGxlRnVsbHNjcmVlbkNoYW5nZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgd2luZG93LmhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAod2luZG93LmlzUXVpekFjdGl2ZSAmJiAhZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsgCiAgICAgICAgICAgIGFsZXJ0KCLimqDvuI8g4LiE4Liz4LmA4LiV4Li34Lit4LiZOiDguIHguKPguLjguJPguLLguIHguKXguLHguJrguYDguILguYnguLLguKrguLnguYjguYLguKvguKHguJTguYDguJXguYfguKHguIjguK0hIik7IAogICAgICAgICAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuKCk7IAogICAgICAgICAgICB3aW5kb3cuY2hlYXRBdHRlbXB0cysrOwogICAgICAgIH0KICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgd2luZG93LmhhbmRsZVZpc2liaWxpdHlDaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAod2luZG93LmlzUXVpekFjdGl2ZSAmJiBkb2N1bWVudC5oaWRkZW4pIHsgCiAgICAgICAgICAgIGFsZXJ0KCLimqDvuI8g4LiE4Liz4LmA4LiV4Li34Lit4LiZOiDguKvguYnguLLguKHguKrguKXguLHguJrguKvguJnguYnguLLguIjguK3guKPguLDguKvguKfguYjguLLguIfguKrguK3guJohIik7CiAgICAgICAgICAgIHdpbmRvdy5jaGVhdEF0dGVtcHRzKys7CiAgICAgICAgfQogICAgfTsKfQppZiAodHlwZW9mIHdpbmRvdy5yZXNldERpbVRpbWVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cucmVzZXREaW1UaW1lciA9IGZ1bmN0aW9uKCkgeyAKICAgICAgICAvLyBQbGFjZWhvbGRlciBmb3IgZGltIHRpbWVyIGxvZ2ljCiAgICB9Owp9CiAgICAgICAgICAgIAphc3luYyBmdW5jdGlvbiBjb25maXJtQW5kSm9pblN5bmNHYW1lKCkgewoKICAgICAgICAvLyBbRk9SQ0UgSU5KRUNURUQgQU5USS1DSEVBVF0KICAgICAgICBjb25zb2xlLmxvZygiQW50aS1DaGVhdCBNb2R1bGUgTG9hZGVkIGZvciBTeW5jIEdhbWUiKTsKICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRNb2RlID09PSAndW5kZWZpbmVkJyB8fCBjdXJyZW50TW9kZSAhPT0gJ2FkbWluLXRlc3RpbmcnKSB7CiAgICAgICAgICAgIHdpbmRvdy5pc1F1aXpBY3RpdmUgPSB0cnVlOyAKICAgICAgICAgICAgd2luZG93LmNoZWF0QXR0ZW1wdHMgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0V2FrZUxvY2soKTsgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiI4Lit4LiU4Lix4LiaCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCB3aW5kb3cuaGFuZGxlRnVsbHNjcmVlbkNoYW5nZSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgd2luZG93LmhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuKCk7IC8vIOC4quC4seC5iOC4h+C5g+C4q+C5ieC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5gOC4leC5h+C4oeC4iOC4reC4l+C4seC4meC4l+C4tQogICAgICAgIAogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHdpbmRvdy5yZXNldERpbVRpbWVyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB3aW5kb3cucmVzZXREaW1UaW1lcik7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHdpbmRvdy5yZXNldERpbVRpbWVyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgd2luZG93LnJlc2V0RGltVGltZXIpOwogICAgICAgICAgICAgICAgd2luZG93LnJlc2V0RGltVGltZXIoKTsgCiAgICAgICAgICAgIH0gY2F0Y2goZSkgeyBjb25zb2xlLndhcm4oIkFudGktY2hlYXQgYWN0aXZhdGlvbiB3YXJuaW5nOiIsIGUpOyB9CiAgICAgICAgfQogICAgICAgICAgICAKCgogICAgLy8g4Lil4LmJ4Liy4LiH4LiE4LmI4Liy4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiHIChTZXNzaW9uKSDguYDguJ7guLfguYjguK3guITguKfguLLguKHguKrguLDguK3guLLguJQKICAgIGxhc3RTZWVuUXVlc3Rpb25JbmRleCA9IC0xOwogICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgncG9sbFVzZWRUaGlzVHVybicpOwogICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnb25TZWNvbmRDaGFuY2UnKTsKICAgIE9iamVjdC5rZXlzKHNlc3Npb25TdG9yYWdlKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCdmcmVlTWFya2V0RW50cnlVc2VkX3EnKSB8fCBrZXkuc3RhcnRzV2l0aCgncG93ZXJ1cFVzZWRfcScpIHx8IGtleS5zdGFydHNXaXRoKCdoaWRkZW5PcHRpb25zX3EnKSkgeyAKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIOC5g+C4iuC5ieC4o+C4suC4ouC4iuC4t+C5iOC4reC4iOC4suC4geC4leC4seC4p+C5geC4m+C4o+C4l+C4teC5iOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC5hOC4p+C5ieC5geC4peC5ieC4pwogICAgY29uc3Qgc2VsZWN0ZWRQbGF5ZXJzID0gWy4uLm9yZGVyZWRQbGF5ZXJTZWxlY3Rpb25dOwoKICAgIGlmIChzZWxlY3RlZFBsYXllcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4nOC4ueC5ieC5gOC4peC5iOC4meC4reC4ouC5iOC4suC4h+C4meC5ieC4reC4oiAxIOC4hOC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsb2NhbFRlYW1QbGF5ZXJzID0gc2VsZWN0ZWRQbGF5ZXJzOyAvLyDguKXguLPguJTguLHguJrguIHguLLguKPguYDguKXguYjguJnguIjguLDguJXguLLguKHguJnguLXguYnguYDguKXguKIKICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gMDsKICAgIGNhY2hlZFBsYXllckRhdGEgPSB7fTsgCgogICAgdHJ5IHsKICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwogICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IHNlcnZlclRpbWVzdGFtcCgpOwoKICAgICAgICAvLyDguKfguJnguKXguLnguJvguYDguIrguYfguITguJzguLnguYnguYDguKXguYjguJnguJfguLXguKXguLDguITguJkgKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkKICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygc2VsZWN0ZWRQbGF5ZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIG5hbWUpOwogICAgICAgICAgICBjb25zdCBwbGF5ZXJTbmFwID0gYXdhaXQgZ2V0RG9jKHBsYXllclJlZik7CgogICAgICAgICAgICBpZiAocGxheWVyU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHBsYXllclJlZiwgeyBzdGF0dXM6ICdhY3RpdmUnIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbmV3UGxheWVyRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICAgIHNjb3JlOiAwLAogICAgICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzOiAwLAogICAgICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogMCwKICAgICAgICAgICAgICAgICAgICBwb3dlcnVwczogewogICAgICAgICAgICAgICAgICAgICAgICBmaWZ0eUZpZnR5OiAwLCBzZWNvbmRDaGFuY2U6IDAsIGJ1eVRpbWU6IDAsIHBvbGw6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHdhZ2VyTXVsdGlwbGllcjogMCwgZm9yY2VDb25maWRlbnQ6IDAsIGN1dE9uZTogMCwgaW5zdXJhbmNlOiAwLCBzdHJhdGVneVNjYW46IDAsIGppbng6IDAsIHJldmVhbE9wdGlvbnM6IDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuc3dlcmVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLAogICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IFtdLAogICAgICAgICAgICAgICAgICAgIGpvaW5lZEF0OiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgaXNKaW54ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGlzRm9yY2VkQ29uZmlkZW50OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lQm9udXNUaGlzUXVlc3Rpb246IDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBiYXRjaC5zZXQocGxheWVyUmVmLCBuZXdQbGF5ZXJEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CgogICAgICAgIHNob3dWaWV3KCdsaXZlLWdhbWUnKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC10ZWFtLXNlbGVjdGlvbi12aWV3JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgY3VycmVudFN0dWRlbnROYW1lID0gc2VsZWN0ZWRQbGF5ZXJzWzBdOyAvLyDguITguJnguYHguKPguIHguJfguLXguYjguYDguKXguLfguK3guIHguITguLfguK3guITguJnguYDguKXguYjguJnguITguJnguYHguKPguIEKICAgICAgICAKICAgICAgICBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKTsgCgogICAgICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHsKICAgICAgICAgICAgZ2FtZUlkOiBjdXJyZW50TGl2ZUdhbWVJZCwKICAgICAgICAgICAgbW9kZTogJ3N5bmMnLAogICAgICAgICAgICBwbGF5ZXJzOiBsb2NhbFRlYW1QbGF5ZXJzLAogICAgICAgICAgICB0dXJuSW5kZXg6IDAKICAgICAgICB9OwogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJywgSlNPTi5zdHJpbmdpZnkoZ2FtZVN0YXRlKSk7CgkJCgkJLy9hYWFhCgoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyBzeW5jIGdhbWU6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguILguYnguLLguKPguYjguKfguKE6ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmVzdW1lQWN0aXZlR2FtZVNlc3Npb24oKSB7CiAgICBjb25zdCBzYXZlZFNlc3Npb24gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicpOwogICAgaWYgKCFzYXZlZFNlc3Npb24pIHsKICAgICAgICByZXR1cm47IC8vIOC5hOC4oeC5iOC4oeC4teC5gOC4geC4oeC4l+C4teC5iOC4hOC5ieC4suC4h+C4reC4ouC4ueC5iAogICAgfQoKICAgIGNvbnN0IGdhbWVTdGF0ZSA9IEpTT04ucGFyc2Uoc2F2ZWRTZXNzaW9uKTsKICAgIAogICAgLy8g4LiU4Li24LiH4LiE4LmI4Liy4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LmE4Lib4LmE4LiU4LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Lit4Lit4LiB4Lih4LiyCiAgICBjb25zdCB7IGdhbWVJZCwgbW9kZSwgcm9sZSwgcGxheWVycywgdHVybkluZGV4IH0gPSBnYW1lU3RhdGU7CgogICAgdHJ5IHsKICAgICAgICAvLyAtLS0gWyDwn5qAIFNUQVJUOiBMb2dpYyDguYPguKvguKHguYjguKrguLPguKvguKPguLHguJogQWRtaW4gXSAtLS0KICAgICAgICBpZiAocm9sZSA9PT0gJ2FkbWluJyAmJiBtb2RlID09PSAnc3luYycpIHsKICAgICAgICAgICAgLy8g4LiZ4Li14LmI4LiE4Li34LitIEFkbWluIOC4l+C4teC5iOC4geC4lOC4o+C4teC5gOC4n+C4o+C4iuC5g+C4meC5guC4q+C4oeC4lCBTeW5jCiAgICAgICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgZ2FtZUlkKTsKICAgICAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZ2FtZVJlZik7CiAgICAgICAgICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ3BvZGl1bScgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYOC4geC4s+C4peC4seC4h+C4geC4peC4seC4muC5gOC4guC5ieC4suC4quC4ueC5iOC5gOC4geC4oSAoQWRtaW4pIChJRDogJHtnYW1lSWR9KWApOwoKICAgICAgICAgICAgY3VycmVudE1vZGUgPSAnYWRtaW4nOyAvLyA8LS0g4Lia4Lij4Lij4LiX4Lix4LiU4Liq4Liz4LiE4Lix4LiN4LiX4Li14LmI4LiC4Liy4LiU4LmE4LibIQoKICAgICAgICAgICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lSWQ7CiAgICAgICAgICAgIGN1cnJlbnRRdWl6RGF0YSA9IGdhbWVTbmFwLmRhdGEoKS5zaHVmZmxlZFF1aXo7IAogICAgICAgICAgICBzaG93VmlldygnbGl2ZS1nYW1lJyk7CiAgICAgICAgICAgIGxpc3RlbkZvclN5bmNHYW1lVXBkYXRlcygpOyAvLyDguJXguK3guJnguJnguLXguYnguIjguLDguYDguKPguLXguKLguIEgdXBkYXRlQWRtaW5TeW5jVmlldyDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQKCiAgICAgICAgfSAKICAgICAgICAvLyAtLS0gWyDwn5qAIEVORDogTG9naWMg4LmD4Lir4Lih4LmI4Liq4Liz4Lir4Lij4Lix4LiaIEFkbWluIF0gLS0tCiAgICAgICAgCiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gJ3N5bmMnICYmIHBsYXllcnMpIHsKICAgICAgICAgICAgLy8gKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkg4LiZ4Li14LmI4LiE4Li34LitIFBsYXllciDguJfguLXguYjguIHguJTguKPguLXguYDguJ/guKPguIrguYPguJnguYLguKvguKHguJQgU3luYwogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGdhbWVJZCk7CiAgICAgICAgICAgIGNvbnN0IGdhbWVTbmFwID0gYXdhaXQgZ2V0RG9jKGdhbWVSZWYpOwogICAgICAgICAgICBpZiAoIWdhbWVTbmFwLmV4aXN0cygpIHx8IGdhbWVTbmFwLmRhdGEoKS5zdGF0dXMgPT09ICdwb2RpdW0nIHx8IGdhbWVTbmFwLmRhdGEoKS5zdGF0dXMgPT09ICdmaW5pc2hlZCcpIHsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJyk7IHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYOC4geC4s+C4peC4seC4h+C4geC4peC4seC4muC5gOC4guC5ieC4suC4quC4ueC5iOC5gOC4geC4oSAoUGxheWVyKSAoSUQ6ICR7Z2FtZUlkfSlgKTsKICAgICAgICAgICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lSWQ7CiAgICAgICAgICAgIGN1cnJlbnRTdHVkZW50TmFtZSA9IHBsYXllcnNbMF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDilrzilrzilrwgWyBTVEFSVDog4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0g4pa84pa84pa8CiAgICAgICAgICAgIGxvY2FsVGVhbVBsYXllcnMgPSBwbGF5ZXJzOyAvLyA8LS0g4Lia4Lij4Lij4LiX4Lix4LiU4Liq4Liz4LiE4Lix4LiN4LiX4Li14LmI4LiC4Liy4LiU4LmE4LibIQogICAgICAgICAgICAvLyDilrLilrLilrIgWyBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIOKWsuKWsuKWsgogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOwogICAgICAgICAgICBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKTsKCiAgICAgICAgfSBlbHNlIGlmICgobW9kZSA9PT0gJ3RlYW0nIHx8IG1vZGUgPT09ICdncm91cCcpICYmIHBsYXllcnMpIHsKICAgICAgICAgICAgLy8gKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkg4LiZ4Li14LmI4LiE4Li34LitIFBsYXllciDguJfguLXguYjguIHguJTguKPguLXguYDguJ/guKPguIrguYPguJnguYLguKvguKHguJQgVGVhbS9Hcm91cAogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgZ2FtZUlkKTsKICAgICAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZ2FtZVJlZik7CiAgICAgICAgICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ3BvZGl1bScgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZyhg4LiB4Liz4Lil4Lix4LiH4LiB4Lil4Lix4Lia4LmA4LiC4LmJ4Liy4Liq4Li54LmI4LmA4LiB4LihICR7bW9kZX0gKFBsYXllcikgKElEOiAke2dhbWVJZH0pYCk7CiAgICAgICAgICAgIGN1cnJlbnRUZWFtUXVpeklkID0gZ2FtZUlkOwogICAgICAgICAgICBsb2NhbFRlYW1QbGF5ZXJzID0gcGxheWVyczsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsUXVlc3Rpb25JbmRleCA9IGdhbWVTdGF0ZS5xdWVzdGlvbkluZGV4IHx8IDA7CiAgICAgICAgICAgIGxvY2FsUGxheWVySW5kZXggPSBnYW1lU3RhdGUucGxheWVySW5kZXggfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdhbWVEYXRhID0gZ2FtZVNuYXAuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgICAgICAgICBjb25zdCBxdWl6U25hcCA9IGF3YWl0IGdldERvYyhxdWl6UmVmKTsKICAgICAgICAgICAgaWYocXVpelNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXooeyBpZDogcXVpelNuYXAuaWQsIC4uLnF1aXpTbmFwLmRhdGEoKSB9KTsKICAgICAgICAgICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2dyb3VwJykgewogICAgICAgICAgICAgICAgICAgIHJlbmRlckdyb3VwTW9kZVF1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJUZWFtUXVpelF1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIGxpc3RlbkZvclRlYW1RdWl6VXBkYXRlcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcmVzdW1lIGdhbWUgc2Vzc2lvbjoiLCBlcnJvcik7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXNlUG93ZXJ1cChwbGF5ZXJOYW1lLCBpdGVtSWQsIHF1ZXN0aW9uLCBnYW1lRGF0YSwgcGxheWVyRGF0YSkgewogICAgY29uc3QgcUluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICBjb25zdCBmbGFnTmFtZSA9IGBwb3dlcnVwVXNlZF9xJHtxSW5kZXh9X3Ake3BsYXllck5hbWV9YDsKICAgIGNvbnN0IHBvd2VydXBVc2VkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZSk7CgogICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4Liy4Lij4LiB4LiU4LiL4LmJ4LizCiAgICBpZiAocG93ZXJ1cFVzZWQgJiYgaXRlbUlkICE9PSAnYnV5VGltZScgJiYgaXRlbUlkICE9PSAnc3RyYXRlZ3lTY2FuJykgeyAKICAgICAgICBzaG93TWVzc2FnZSgi4LiE4Li44LiT4Liq4Liy4Lih4Liy4Lij4LiW4LmD4LiK4LmJ4LiV4Lix4Lin4LiK4LmI4Lin4Lii4LmE4LiU4LmJ4LmA4Lie4Li14Lii4LiHIDEg4LiE4Lij4Lix4LmJ4LiH4LiV4LmI4LitIDEg4LiC4LmJ4Lit4LiE4Lij4Lix4LiaIik7CiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHVzZS1wb3dlcnVwLSR7aXRlbUlkfWApOwogICAgICAgIGlmKGJ0bikgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4geC4o+C4k+C4teC4nuC4tOC5gOC4qOC4qTog4LiE4Li54LiT4LmA4LiU4Li04Lih4Lie4Lix4LiZICjguJfguLPguIfguLLguJnguYPguJnguYDguITguKPguLfguYjguK3guIcpCiAgICBpZiAoaXRlbUlkID09PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oZmxhZ05hbWUsIGl0ZW1JZCk7CiAgICAgICAgcGxheVN5c3RlbVNvdW5kKCdwb3dlcnVwJyk7IC8vIFvguYDguJ7guLTguYjguKFdIOC5gOC4quC4teC4ouC4h+C5g+C4iuC5ieC5hOC4reC5gOC4l+C4oQogICAgICAgIHJlbmRlclN0dWRlbnRTeW5jUXVlc3Rpb25WaWV3KGdhbWVEYXRhKTsKICAgICAgICByZXR1cm47IAogICAgfQoKICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIHBsYXllck5hbWUpOwogICAgCiAgICB0cnkgewogICAgICAgIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHsKICAgICAgICAgICAgY29uc3QgcGxheWVyRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHBsYXllclJlZik7CiAgICAgICAgICAgIGlmICghcGxheWVyRG9jLmV4aXN0cygpKSB0aHJvdyAi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZIjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXJEYXRhID0gcGxheWVyRG9jLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcGxheWVyUG93ZXJ1cHMgPSBjdXJyZW50UGxheWVyRGF0YS5wb3dlcnVwcyB8fCB7fTsKICAgICAgICAgICAgY29uc3QgY3VycmVudEl0ZW1Db3VudCA9IHBsYXllclBvd2VydXBzW2l0ZW1JZF0gfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyZW50SXRlbUNvdW50IDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93ICLguITguLjguJPguYTguKHguYjguKHguLXguYTguK3guYDguJfguKHguJnguLXguYnguYPguJnguITguKXguLHguIcgKOC4geC4o+C4uOC4k+C4suC4peC4reC4h+C4o+C4teC5gOC4n+C4o+C4iuC4q+C4meC5ieC4suC4iOC4rSkiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB1cGRhdGVQYXlsb2FkID0ge307CiAgICAgICAgICAgIHVwZGF0ZVBheWxvYWRbYHBvd2VydXBzLiR7aXRlbUlkfWBdID0gaW5jcmVtZW50KC0xKTsgCgogICAgICAgICAgICAvLyDguKPguLXguYDguIvguYfguJUgU3RyZWFrIOC5gOC4oeC4t+C5iOC4reC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSAo4Lii4LiB4LmA4Lin4LmJ4LiZ4LmA4LiU4Li04Lih4Lie4Lix4LiZKQogICAgICAgICAgICBpZiAoaXRlbUlkICE9PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgICAgICAgICAgdXBkYXRlUGF5bG9hZFsnY29ycmVjdFN0cmVhayddID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGl0ZW1JZCA9PT0gJ2J1eVRpbWUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiYXNlRHVyYXRpb25NcyA9IChnYW1lRGF0YS50aW1lckR1cmF0aW9uIHx8IDI0MCkgKiAxMDAwOwogICAgICAgICAgICAgICAgY29uc3QgdGltZUJvbnVzTXMgPSBiYXNlRHVyYXRpb25NcyAqIDAuMjU7CiAgICAgICAgICAgICAgICB1cGRhdGVQYXlsb2FkW2B0aW1lQm9udXNUaGlzUXVlc3Rpb25gXSA9IGluY3JlbWVudCh0aW1lQm9udXNNcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyYW5zYWN0aW9uLnVwZGF0ZShwbGF5ZXJSZWYsIHVwZGF0ZVBheWxvYWQpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoaXRlbUlkID09PSAncG9sbCcpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgncG9sbFVzZWRUaGlzVHVybicsICd0cnVlJyk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtSWQgIT09ICdidXlUaW1lJyAmJiBpdGVtSWQgIT09ICdzdHJhdGVneVNjYW4nKSB7IAogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGZsYWdOYW1lLCBpdGVtSWQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguYDguKXguYjguJnguYDguKrguLXguKLguIfguYDguKHguLfguYjguK3guYPguIrguYnguKrguLPguYDguKPguYfguIgKICAgICAgICBwbGF5U3lzdGVtU291bmQoJ3Bvd2VydXAnKTsKCiAgICAgICAgYXBwbHlQb3dlcnVwRWZmZWN0KHBsYXllck5hbWUsIGl0ZW1JZCwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsKICAgICAgICAKICAgICAgICBpZiAoaXRlbUlkID09PSAnY3V0T25lJyB8fCBpdGVtSWQgPT09ICdmaWZ0eUZpZnR5JyB8fCBpdGVtSWQgPT09ICdpbnN1cmFuY2UnIHx8IGl0ZW1JZCA9PT0gJ3JldmVhbE9wdGlvbnMnKSB7CiAgICAgICAgICAgICByZW5kZXJTdHVkZW50U3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbUlkICE9PSAnd2FnZXJNdWx0aXBsaWVyJyAmJiBwbGF5ZXJEYXRhLmNvcnJlY3RTdHJlYWsgPiAwKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguITguLjguJPguYPguIrguYnguJXguLHguKfguIrguYjguKfguKIgIiR7aXRlbUlkfSIhIENvbWJvIOC4luC4ueC4geC4o+C4teC5gOC4i+C5h+C4leC5gOC4m+C5h+C4mSAwYCk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiUG93ZXJ1cCB1c2UgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSh0eXBlb2YgZXJyb3IgPT09ICdzdHJpbmcnID8gZXJyb3IgOiAi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmD4LiK4LmJ4LiV4Lix4Lin4LiK4LmI4Lin4LiiIik7CiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHVzZS1wb3dlcnVwLSR7aXRlbUlkfWApOwogICAgICAgIGlmKGJ0bikgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGdldENhY2hlZE90aGVyUGxheWVycyhnYW1lRGF0YSwgbXlOYW1lKSB7CiAgICBjb25zdCBjdXJyZW50USA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgCiAgICAvLyAxLiDguYDguIrguYfguITguKfguYjguLLguYDguKPguLLguKHguLXguILguYnguK3guKHguLnguKXguILguK3guIcgIuC4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4mSIg4Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4Lir4Lij4Li34Lit4Lii4Lix4LiHPwogICAgaWYgKGNhY2hlZE90aGVyUGxheWVyc0ZvclF1ZXN0aW9uICYmIGNhY2hlZFF1ZXN0aW9uSW5kZXhGb3JQbGF5ZXJzID09PSBjdXJyZW50USkgewogICAgICAgIGNvbnNvbGUubG9nKCLguYPguIrguYnguILguYnguK3guKHguLnguKXguYDguJ7guLfguYjguK3guJnguIjguLLguIEgQ2FjaGUgKOC4m+C4o+C4sOC4q+C4ouC4seC4lOC5gOC4meC5h+C4lSkiKTsKICAgICAgICByZXR1cm4gY2FjaGVkT3RoZXJQbGF5ZXJzRm9yUXVlc3Rpb247CiAgICB9CgogICAgLy8gMi4g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li1ICjguKvguKPguLfguK3guYDguJvguYfguJnguILguYnguK3guYPguKvguKHguYgpIOC5g+C4q+C5ieC5hOC4m+C5guC4q+C4peC4lOC4iOC4suC4gSBGaXJlYmFzZQogICAgY29uc29sZS5sb2coIuC5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC5gOC4nuC4t+C5iOC4reC4meC5g+C4q+C4oeC5iOC4iOC4suC4gSBTZXJ2ZXIuLi4iKTsKICAgIGNvbnN0IHBsYXllcnNDb2xSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCk7CiAgICAvLyDguJTguLbguIfguYDguInguJ7guLLguLDguITguJnguJfguLXguYjguKrguJbguLLguJnguLAgYWN0aXZlCiAgICBjb25zdCBxUXVlcnkgPSBxdWVyeShwbGF5ZXJzQ29sUmVmLCB3aGVyZSgic3RhdHVzIiwgIj09IiwgImFjdGl2ZSIpKTsKICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxUXVlcnkpOwogICAgCiAgICBjb25zdCBwbGF5ZXJzID0gW107CiAgICBzbmFwc2hvdC5mb3JFYWNoKGRvYyA9PiB7CiAgICAgICAgY29uc3QgcCA9IGRvYy5kYXRhKCk7CiAgICAgICAgLy8g4LmA4LiB4LmH4Lia4LiX4Li44LiB4LiE4LiZICjguKPguKfguKHguJXguLHguKfguYDguK3guIfguJTguYnguKfguKLguIHguYfguYTguJTguYkg4LmA4LiU4Li14LmL4Lii4Lin4LmE4Lib4LiB4Lij4Lit4LiH4Lit4Lit4LiB4LiX4Li14Lir4Lil4Lix4LiHKQogICAgICAgIHBsYXllcnMucHVzaChwKTsKICAgIH0pOwoKICAgIC8vIDMuIOC4muC4seC4meC4l+C4tuC4geC4peC4hyBDYWNoZSDguYTguKfguYnguYPguIrguYnguITguKPguLHguYnguIfguKvguJnguYnguLIKICAgIGNhY2hlZE90aGVyUGxheWVyc0ZvclF1ZXN0aW9uID0gcGxheWVyczsKICAgIGNhY2hlZFF1ZXN0aW9uSW5kZXhGb3JQbGF5ZXJzID0gY3VycmVudFE7CiAgICAKICAgIHJldHVybiBwbGF5ZXJzOwp9Cgphc3luYyBmdW5jdGlvbiBhcHBseVBvd2VydXBFZmZlY3QocGxheWVyTmFtZSwgaXRlbUlkLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllckRhdGEpIHsKICAgIGNvbnN0IHEgPSBxdWVzdGlvbjsKICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgCiAgICAvLyDguYDguKPguLLguJXguLHguJTguKrguYjguKfguJkgZ2V0Q2FjaGVkT3RoZXJQbGF5ZXJzIOC4l+C4tOC5ieC4h+C5hOC4m+C5gOC4peC4oiDguYDguJ7guKPguLLguLDguYTguK3guYDguJfguKHguJfguLXguYjguYDguKvguKXguLfguK3guK3guKLguLnguYjguYTguKHguYjguIjguLPguYDguJvguYfguJnguJXguYnguK3guIfguYPguIrguYnguILguYnguK3guKHguLnguKXguYDguJ7guLfguYjguK3guJkKICAgIC8vICjguIrguYjguKfguKLguJvguKPguLDguKvguKLguLHguJQgUmVhZHMg4LmE4LiU4LmJIDEwMCUpCgogICAgc3dpdGNoKGl0ZW1JZCkgewogICAgICAgIC8vIC0tLSAxLiDguJvguLjguYjguKHguJfguLXguYjguKHguLXguYPguKvguYnguIHguJTguJ/guKPguLXguKvguJnguYnguLLguIjguK0gKOC4leC5ieC4reC4h+C5gOC4geC5h+C4muC5hOC4p+C5iSkgLS0tCiAgICAgICAgY2FzZSAnd2FnZXJNdWx0aXBsaWVyJzogCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLwn5KwIOC5guC4q+C4oeC4lOC5gOC4lOC4tOC4oeC4nuC4seC4meC4l+C4s+C4h+C4suC4mSEg4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4Lia4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04Lih4Lie4Lix4LiZIik7IAogICAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gLS0tIDIuIOC5hOC4reC5gOC4l+C4oeC4l+C4teC5iOC4i+C4t+C5ieC4reC4iOC4suC4geC4leC4peC4suC4lOC4oeC4t+C4lCAtLS0KICAgICAgICBjYXNlICdzZWNvbmRDaGFuY2UnOiAKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIvCflIEg4LmC4Lit4LiB4Liy4Liq4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4Liq4Lit4LiH4LiX4Liz4LiH4Liy4LiZISDguKvguLLguIHguJXguK3guJrguJzguLTguJQg4LiE4Li44LiT4LiI4Liw4LmE4LiU4LmJ4LmA4Lil4Li34Lit4LiB4LmD4Lir4Lih4LmI4LiX4Lix4LiZ4LiX4Li1IDEg4LiE4Lij4Lix4LmJ4LiHIik7IAogICAgICAgICAgICBicmVhazsgCgogICAgICAgIGNhc2UgJ2J1eVRpbWUnOgogICAgICAgICAgICAvLyDguITguLPguJnguKfguJPguYDguKfguKXguLLguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguYnguJTguLkgKOC5geC4leC5iCBMb2dpYyDguYDguJ7guLTguYjguKHguIjguKPguLTguIfguK3guKLguLnguYjguJfguLXguYggaGFuZGxlVXNlUG93ZXJ1cCDguYHguKXguYnguKcpCiAgICAgICAgICAgIGNvbnN0IHRpbWVCb251cyA9IChnYW1lRGF0YS50aW1lckR1cmF0aW9uIHx8IDI0MCkgKiAwLjI1OwogICAgICAgICAgICBzaG93TWVzc2FnZShg4o+zIOC4i+C4t+C5ieC4reC5gOC4p+C4peC4suC4quC4s+C5gOC4o+C5h+C4iCEg4LmE4LiU4LmJ4LmA4Lie4Li04LmI4LihICR7dGltZUJvbnVzfSDguKfguLTguJnguLLguJfguLVgKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2N1dE9uZSc6CiAgICAgICAgY2FzZSAnZmlmdHlGaWZ0eSc6CiAgICAgICAgICAgICAvLyBMb2dpYyDguKrguLPguKvguKPguLHguJrguIHguLLguKPguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIEKICAgICAgICAgICAgIGNvbnN0IGFsbEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubGl2ZS1hbnN3ZXItYnRuJyk7CiAgICAgICAgICAgICBpZiAoYWxsQnV0dG9ucy5sZW5ndGggPT09IDApIHsgc2hvd01lc3NhZ2UoIuKdjCDguYTguK3guYDguJfguKHguJnguLXguYnguYPguIrguYnguYTguJTguYnguYDguInguJ7guLLguLDguIHguLHguJrguILguYnguK3guKrguK3guJrguYHguJrguJrguJXguLHguKfguYDguKXguLfguK3guIHguYDguJfguYjguLLguJnguLHguYnguJnguITguKPguLHguJoiKTsgcmV0dXJuOyB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZsYWcgPSBgaGlkZGVuT3B0aW9uc19xJHtxSW5kZXh9X3Ake3BsYXllck5hbWV9YDsKICAgICAgICAgICAgIGNvbnN0IHByZXZIaWRkZW4gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaGlkZGVuRmxhZykgfHwgJ1tdJyk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGxldCBjb3JySWR4OwogICAgICAgICAgICAgLy8g4LmA4LiK4LmH4LiE4Lib4Lij4Liw4LmA4Lig4LiX4LiE4Liz4LiW4Liy4Lih4LmA4Lie4Li34LmI4Lit4Lir4Liy4LiC4LmJ4Lit4LiW4Li54LiBCiAgICAgICAgICAgICBjb25zdCBxVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgICAgICAgICAgIGlmIChxVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7IAogICAgICAgICAgICAgICAgIGNvcnJJZHggPSAoU3RyaW5nKHEuY29ycmVjdEFuc3dlcikudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKSA/IDAgOiAxOyAKICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgIGNvcnJJZHggPSBxLmNvcnJlY3RBbnN3ZXJJbmRleDsgCiAgICAgICAgICAgICB9CgogICAgICAgICAgICAgLy8g4Lir4Liy4Lib4Li44LmI4Lih4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LiC4LmJ4Lit4Lic4Li04LiUIOC5geC4peC4sOC4ouC4seC4h+C5hOC4oeC5iOC4luC4ueC4geC4i+C5iOC4reC4mQogICAgICAgICAgICAgY29uc3QgYmFkQnRucyA9IEFycmF5LmZyb20oYWxsQnV0dG9ucykuZmlsdGVyKGJ0biA9PiBwYXJzZUludChidG4uZGF0YXNldC52YWx1ZSkgIT09IGNvcnJJZHggJiYgIXByZXZIaWRkZW4uaW5jbHVkZXMoYnRuLmRhdGFzZXQudmFsdWUpKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKGJhZEJ0bnMubGVuZ3RoID09PSAwKSB7IHNob3dNZXNzYWdlKCLguYTguKHguYjguYDguKvguKXguLfguK3guJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguYPguKvguYnguJXguLHguJTguYHguKXguYnguKfguITguKPguLHguJohIik7IHJldHVybjsgfQogICAgICAgICAgICAgCiAgICAgICAgICAgICBzaHVmZmxlQXJyYXkoYmFkQnRucyk7IC8vIOC4quC4uOC5iOC4oeC4guC5ieC4reC4nOC4tOC4lOC4l+C4teC5iOC4iOC4sOC4leC4seC4lAogICAgICAgICAgICAgCiAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGl0ZW1JZCA9PT0gJ2N1dE9uZScgPyAxIDogMjsKICAgICAgICAgICAgIGNvbnN0IGl0ZW1zVG9IaWRlID0gW107CgogICAgICAgICAgICAgLy8g4Lil4Li54Lib4LiL4LmI4Lit4LiZ4Lib4Li44LmI4Lih4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZCiAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgaWYoYmFkQnRuc1tpXSkgewogICAgICAgICAgICAgICAgICAgICBiYWRCdG5zW2ldLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguJvguLjguYjguKHguJfguLHguJnguJfguLUKICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb0hpZGUucHVzaChiYWRCdG5zW2ldLmRhdGFzZXQudmFsdWUpOyAKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIC8vIOC4muC4seC4meC4l+C4tuC4geC4peC4hyBzZXNzaW9uU3RvcmFnZSDguYDguJ7guLfguYjguK3guYPguKvguYnguITguIfguKrguJbguLLguJnguLDguYTguKfguYnguJbguYnguLLguKPguLXguYDguJ/guKPguIoKICAgICAgICAgICAgIGNvbnN0IG5ld0hpZGRlbiA9IFsuLi5wcmV2SGlkZGVuLCAuLi5pdGVtc1RvSGlkZV07CiAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGhpZGRlbkZsYWcsIEpTT04uc3RyaW5naWZ5KG5ld0hpZGRlbikpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICBzaG93TWVzc2FnZShpdGVtSWQgPT09ICdjdXRPbmUnID8gIuKaoe+4jyDguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguK3guK3guIHguYTguJsgMSDguILguYnguK3guYHguKXguYnguKchIiA6ICLimqHvuI8gNTA6NTAg4LiX4Liz4LiH4Liy4LiZISDguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguK3guK3guIHguYTguJvguYHguKXguYnguKchIik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIAogICAgICAgIGRlZmF1bHQ6IAogICAgICAgICAgICAvLyDguIHguKPguJPguLXguYDguJzguLfguYjguK3guYTguKfguYnguKrguLPguKvguKPguLHguJrguYTguK3guYDguJfguKHguK3guLfguYjguJnguYYg4LmD4LiZ4Lit4LiZ4Liy4LiE4LiVCiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguYPguIrguYnguYTguK3guYDguJfguKEgJHtpdGVtSWR9IOC5geC4peC5ieC4pyFgKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRm9yY2VDb25maWRlbnQodGFyZ2V0TmFtZSwgZGlzcGxheU5hbWUpIHsKICAgIGlmICghY3VycmVudExpdmVHYW1lSWQgfHwgIXRhcmdldE5hbWUpIHJldHVybjsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgdGFyZ2V0TmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHBsYXllclJlZiwgeyBpc0ZvcmNlZENvbmZpZGVudDogdHJ1ZSB9KTsKICAgICAgICBzaG93TWVzc2FnZShg4LmD4LiK4LmJICLguJrguLHguIfguITguLHguJrguKHguLHguYjguJnguYPguIgiIOC4geC4seC4miAke2Rpc3BsYXlOYW1lfSDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBhcHBseSBmb3JjZUNvbmZpZGVudDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSIpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVSZWZ1bmRQb3dlcnVwKHBsYXllck5hbWUsIGl0ZW1JZCkgewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgcGxheWVyTmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHt9OwogICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4leC4seC4lCBwcmVmaXgg4Lit4Lit4LiBCiAgICAgICAgdXBkYXRlUGF5bG9hZFtgcG93ZXJ1cHMuJHtpdGVtSWR9YF0gPSBpbmNyZW1lbnQoMSk7IAogICAgICAgIAogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwbGF5ZXJSZWYsIHVwZGF0ZVBheWxvYWQpOwogICAgICAgIGNvbnNvbGUubG9nKGBSZWZ1bmRlZCAke2l0ZW1JZH0gdG8gJHtwbGF5ZXJOYW1lfWApOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcmVmdW5kIHBvd2VydXA6IiwgZXJyb3IpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVBcHBseUppbngodGFyZ2V0TmFtZSwgZGlzcGxheU5hbWUpIHsKICAgIGlmICghY3VycmVudExpdmVHYW1lSWQgfHwgIXRhcmdldE5hbWUpIHJldHVybjsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiV4LmJ4Lit4LiH4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgdGFyZ2V0TmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Lih4Li1IHByZWZpeCBwbGF5ZXJzLnRhcmdldE5hbWUg4LmB4Lil4LmJ4LinCiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHBsYXllclJlZiwgeyBpc0ppbnhlZDogdHJ1ZSB9KTsKICAgICAgICAKICAgICAgICBzaG93TWVzc2FnZShg4LmD4LiK4LmJICLguITguLPguKrguLLguJsiIOC4geC4seC4miAke2Rpc3BsYXlOYW1lfSDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBhcHBseSBqaW54OiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmD4LiK4LmJ4LmE4Lit4LmA4LiX4LihIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGFjdGl2YXRlRmlsZUlucHV0QXJlYVdpdGhMb2FkZWRGaWxlKCkgewogICAgY29uc3QgZ2VuZXJhdGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpOwogICAgY29uc3QgdG9waWNzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXRvcGljcy1saXN0LWNvbnRhaW5lcicpOwogICAgY29uc3Qgc2VwYXJhdGVDb250ZW50Q2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1mcm9tLWZpbGUtY2hlY2tib3gnKTsKCiAgICAvLyDguJXguKPguKPguIHguLDguJnguLXguYnguIjguLDguJfguLPguIfguLLguJnguYDguKvguKHguLfguK3guJnguIHguLHguJrguIHguLLguKPguK3guLHguJvguYLguKvguKXguJTguYTguJ/guKXguYzguJvguIHguJXguLTguJfguLjguIHguJvguKPguLDguIHguLLguKMKICAgIGlmIChzZWxlY3RlZEZpbGUpIHsKICAgICAgICBpZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3guY2hlY2tlZCkgewogICAgICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7IC8vIOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gSDguYDguJ7guLfguYjguK3guYPguKvguYnguJzguLnguYnguYPguIrguYnguYDguKXguLfguK3guIHguKvguLHguKfguILguYnguK3guIHguYjguK3guJkKICAgICAgICAgICAgYW5hbHl6ZUZpbGVGb3JUb3BpY3Moc2VsZWN0ZWRGaWxlKTsgLy8g4LmA4Lij4Li04LmI4Lih4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LiX4Li14LmI4LmC4Lir4Lil4LiU4Lih4LiyCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2VuZXJhdGVCdG4uZGlzYWJsZWQgPSBmYWxzZTsgLy8g4LmA4Lib4Li04LiU4Lib4Li44LmI4Lih4Liq4Lij4LmJ4Liy4LiH4Lir4Lil4Lix4LiB4LmD4Lir4LmJ4Lie4Lij4LmJ4Lit4Lih4LmD4LiK4LmJ4LiH4Liy4LiZCiAgICAgICAgICAgIHRvcGljc0xpc3RDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4quC5iOC4p+C4meC5gOC4peC4t+C4reC4geC4q+C4seC4p+C4guC5ieC4rQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LmE4Lif4Lil4LmMIOC5g+C4q+C5ieC4m+C4tOC4lOC4m+C4uOC5iOC4oeC5geC4peC4sOC4i+C5iOC4reC4meC4l+C4uOC4geC4reC4ouC5iOC4suC4hwogICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVLaWNrUGxheWVyU3luYyhwbGF5ZXJOYW1lKSB7CiAgICBpZiAoIWN1cnJlbnRMaXZlR2FtZUlkIHx8ICFwbGF5ZXJOYW1lKSByZXR1cm47CgogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4Lii4LmA4Lib4LmH4LiZIFBsYXllciBTdWJjb2xsZWN0aW9uCiAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgIAogICAgdHJ5IHsKICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJnguKrguJbguLLguJnguLDguYPguJnguYTguJ/guKXguYzguKLguYjguK3guKIKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocGxheWVyUmVmLCB7IHN0YXR1czogJ2luYWN0aXZlJyB9KTsKICAgICAgICAvLyDguYTguKHguYjguJXguYnguK3guIfguJfguLPguK3guLDguYTguKPguJXguYjguK0gb25TbmFwc2hvdCDguILguK3guIcgQWRtaW4g4LiI4Liw4LiV4Lij4Lin4LiI4LiI4Lix4Lia4LmB4Lil4Liw4Lil4Lia4LiK4Li34LmI4Lit4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4Lit4LiHCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBraWNrIHBsYXllciAke3BsYXllck5hbWV9OmAsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiZ4Liz4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4Lit4Lit4LiBIik7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIHJlbmRlclN0dWRlbnRQcm9ncmVzc0Rhc2hib2FyZChwcm9qZWN0SWQsIHN0dWRlbnROYW1lKSB7CiAgICBjb25zdCBjb250ZW50RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcHJvZ3Jlc3MtY29udGVudCcpOwogICAgY29udGVudERpdi5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CgogICAgdHJ5IHsKICAgICAgICAvLyDguJTguLbguIfguYHguJrguJrguJfguJTguKrguK3guJrguJfguLHguYnguIfguKvguKHguJTguYPguJnguYLguJvguKPguYDguIjguIQKICAgICAgICBjb25zdCBxdWl6emVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHF1aXp6ZXNSZWYsIHdoZXJlKCJwcm9qZWN0SWQiLCAiPT0iLCBwcm9qZWN0SWQpKTsKICAgICAgICBjb25zdCBxdWl6emVzU25hcCA9IGF3YWl0IGdldERvY3MocSk7CiAgICAgICAgY29uc3QgcXVpenplc0luUHJvamVjdCA9IHF1aXp6ZXNTbmFwLmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKCiAgICAgICAgLy8g4LiU4Li24LiH4Lic4Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJCiAgICAgICAgY29uc3Qgc3VibWlzc2lvblByb21pc2VzID0gcXVpenplc0luUHJvamVjdC5tYXAocXVpeiA9PiAKICAgICAgICAgICAgZ2V0RG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpei5pZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSkpCiAgICAgICAgKTsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uU25hcHMgPSBhd2FpdCBQcm9taXNlLmFsbChzdWJtaXNzaW9uUHJvbWlzZXMpOwogICAgICAgIAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25zID0gc3VibWlzc2lvblNuYXBzCiAgICAgICAgICAgIC5maWx0ZXIoc25hcCA9PiBzbmFwLmV4aXN0cygpKQogICAgICAgICAgICAubWFwKHNuYXAgPT4gKHsgcXVpeklkOiBzbmFwLnJlZi5wYXJlbnQucGFyZW50LmlkLCAuLi5zbmFwLmRhdGEoKSB9KSk7CiAgICAgICAgICAgIAogICAgICAgIGlmIChzdWJtaXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC5g+C4meC5guC4m+C4o+C5gOC4iOC4hOC4meC4teC5iTwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDguKrguKPguYnguLLguIcgSFRNTCDguYHguKrguJTguIfguJzguKUKICAgICAgICBsZXQgaHRtbCA9ICc8ZGl2IGNsYXNzPSJzcGFjZS15LTQiPic7CiAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4gewogICAgICAgICAgICBjb25zdCBxdWl6ID0gcXVpenplc0luUHJvamVjdC5maW5kKHF6ID0+IHF6LmlkID09PSBzdWIucXVpeklkKTsKICAgICAgICAgICAgY29uc3QgZGlzcGxheVNldHRpbmcgPSBxdWl6LnNldHRpbmdzPy5yZXN1bHRzRGlzcGxheSB8fCAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJzsKICAgICAgICAgICAgY29uc3QgcGFzc2luZ1Njb3JlID0gcXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IDA7CiAgICAgICAgICAgIGNvbnN0IGlzUGFzcyA9IHN1Yi5iZXN0U2NvcmUgPj0gcGFzc2luZ1Njb3JlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIFsgU1RBUlQ6IOC4meC4teC5iOC4hOC4t+C4reC4leC4o+C4o+C4geC4sOC5g+C4q+C4oeC5iOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4siBdIC0tLQogICAgICAgICAgICBsZXQgc2NvcmVIdG1sID0gJyc7CiAgICAgICAgICAgIGxldCBjYXJkQmdDb2xvciA9ICdiZy1ncmF5LTUwJzsgLy8g4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCgogICAgICAgICAgICBzd2l0Y2goZGlzcGxheVNldHRpbmcpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3dfcmVzdWx0c19hbmRfYW5zd2Vycyc6CiAgICAgICAgICAgICAgICBjYXNlICdzaG93X3Jlc3VsdHNfb25seSc6CiAgICAgICAgICAgICAgICAgICAgY2FyZEJnQ29sb3IgPSBpc1Bhc3MgPyAnYmctZ3JlZW4tNTAnIDogJ2JnLXJlZC01MCc7CiAgICAgICAgICAgICAgICAgICAgc2NvcmVIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgJHtpc1Bhc3MgPyAndGV4dC1ncmVlbi03MDAnIDogJ3RleHQtcmVkLTcwMCd9Ij4ke3N1Yi5iZXN0U2NvcmV9IC8gJHtzdWIudG90YWxRdWVzdGlvbnN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCAke2lzUGFzcyA/ICdiZy1ncmVlbi0yMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0yMDAgdGV4dC1yZWQtODAwJ30iPiR7aXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJ308L3A+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3dfcGFzc19mYWlsX29ubHknOgogICAgICAgICAgICAgICAgICAgIGNhcmRCZ0NvbG9yID0gaXNQYXNzID8gJ2JnLWdyZWVuLTUwJyA6ICdiZy1yZWQtNTAnOwogICAgICAgICAgICAgICAgICAgIHNjb3JlSHRtbCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteGwgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1mdWxsICR7aXNQYXNzID8gJ2JnLWdyZWVuLTIwMCB0ZXh0LWdyZWVuLTgwMCcgOiAnYmctcmVkLTIwMCB0ZXh0LXJlZC04MDAnfSI+JHtpc1Bhc3MgPyAn4Lic4LmI4Liy4LiZJyA6ICfguYTguKHguYjguJzguYjguLLguJknfTwvcD4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnbWFudWFsX3JlbGVhc2UnOgogICAgICAgICAgICAgICAgICAgIGNhcmRCZ0NvbG9yID0gJ2JnLXllbGxvdy01MCc7CiAgICAgICAgICAgICAgICAgICAgc2NvcmVIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgYmcteWVsbG93LTIwMCB0ZXh0LXllbGxvdy04MDAiPuC4o+C4reC4m+C4o+C4sOC4geC4suC4qOC4nOC4pTwvcD4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBbIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiV4Lij4Lij4LiB4Liw4LmD4Lir4Lih4LmIIF0gLS0tCgogICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCBib3JkZXIgcm91bmRlZC1sZyBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgJHtjYXJkQmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke3F1aXoudG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNjAwIj7guJfguLPguYTguJsgJHtzdWIuYXR0ZW1wdHMubGVuZ3RofSDguITguKPguLHguYnguIcgfCDguKrguYjguIfguKXguYjguLLguKrguLjguJQ6ICR7bmV3IERhdGUoc3ViLmxhdGVzdFN1Ym1pdHRlZEF0KS50b0xvY2FsZURhdGVTdHJpbmcoJ3RoLVRIJyl9PC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAke3Njb3JlSHRtbH0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0pOwogICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7CiAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSBodG1sOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcmVuZGVyaW5nIHN0dWRlbnQgcHJvZ3Jlc3M6IiwgZXJyb3IpOwogICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXJlZC01MDAiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4pTwvcD4nOwogICAgfQp9CgpmdW5jdGlvbiByZW5kZXJRdWl6QmFua0xpc3RGb3JNdWx0aVNlbGVjdChmaWx0ZXJUZXh0ID0gJycpIHsKICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotbGlzdCcpOwogICAgY29uc3QgdGVybSA9IGZpbHRlclRleHQudG9Mb3dlckNhc2UoKS50cmltKCk7CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4hOC4ouC4ouC5iOC4reC5hOC4p+C5iTog4LiB4Liy4Lij4LmA4LiV4Lij4Li14Lii4Lih4LiC4LmJ4Lit4Lih4Li54LilIC0tLQogICAgLy8gMS4g4Lin4LiZ4Lil4Li54Lib4LmD4LiZIGFsbFF1aXp6ZXNHbG9iYWwg4LmA4Lie4Li34LmI4Lit4LmA4Lie4Li04LmI4Lih4LiC4LmJ4Lit4Lih4Li54LilICLguIrguLfguYjguK3guYLguJvguKPguYDguIjguIQiIOC5gOC4guC5ieC4suC5hOC4m+C5g+C4meC5geC4leC5iOC4peC4sCBvYmplY3QKICAgIGNvbnN0IHJvd3MgPSBhbGxRdWl6emVzR2xvYmFsCiAgICAgICAgLm1hcChxID0+ICh7CiAgICAgICAgICAgIC4uLnEsCiAgICAgICAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICAgICAgfSkpCiAgICAgICAgLy8gMi4g4LiB4Lij4Lit4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiV4Liy4Lih4LiE4Liz4LiE4LmJ4LiZ4Lir4LiyICjguITguYnguJnguIjguLLguIEg4LiK4Li34LmI4Lit4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaLCDguIrguLfguYjguK3guYLguJvguKPguYDguIjguIQsIOC4q+C4o+C4t+C4reC4o+C4q+C4seC4qiBJRCkKICAgICAgICAuZmlsdGVyKHEgPT4KICAgICAgICAgICAgKHEudG9waWMgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHwKICAgICAgICAgICAgKHEucHJvamVjdE5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHwKICAgICAgICAgICAgKHEuaWQudG9TdHJpbmcoKS5pbmNsdWRlcyh0ZXJtKSkKICAgICAgICApOwogICAgLy8gLS0tIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4hOC4ouC4ouC5iOC4reC5hOC4p+C5iSAtLS0KCiAgICAvLyAzLiDguKrguKPguYnguLLguIcgSFRNTCDguYLguJTguKLguYPguIrguYnguILguYnguK3guKHguLnguKXguJfguLXguYjguIHguKPguK3guIfguYHguKXguYnguKcKICAgIGxpc3RFbC5pbm5lckhUTUwgPSByb3dzLmxlbmd0aCA/IHJvd3MubWFwKHEgPT4gYAogICAgICAgIDxsYWJlbCBjbGFzcz0idy1mdWxsIHRleHQtbGVmdCBwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQgY3Vyc29yLXBvaW50ZXIiPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIHZhbHVlPSIke3EuaWR9IiBjbGFzcz0icXVpei1iYW5rLWNoZWNrYm94IGgtNSB3LTUgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1wdXJwbGUtNjAwIGZvY3VzOnJpbmctcHVycGxlLTUwMCI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tNzAwIj4ke3EudG9waWMgfHwgJyjguYTguKHguYjguKHguLXguIrguLfguYjguK0pJ308L3A+CiAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+4LmC4Lib4Lij4LmA4LiI4LiEOiAke3EucHJvamVjdE5hbWV9IHwgSUQ6ICR7cS5pZH08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvbGFiZWw+CiAgICBgKS5qb2luKCcnKSA6IGA8ZGl2IGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lie4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaPC9kaXY+YDsKICAgIAogICAgLy8gNC4g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5gOC4nuC4t+C5iOC4reC5gOC4m+C4tOC4lC/guJvguLTguJTguJvguLjguYjguKEgIuC4ouC4t+C4meC4ouC4seC4mSIg4LmA4Lih4Li34LmI4Lit4Lih4Li14LiB4Liy4Lij4LmA4Lil4Li34Lit4LiBCiAgICBsaXN0RWwub25jaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgY29uc3QgaGFzU2VsZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnF1aXotYmFuay1jaGVja2JveDpjaGVja2VkJyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbGluay1xdWl6LWJ0bicpLmRpc2FibGVkID0gIWhhc1NlbGVjdGlvbjsKICAgIH07Cn0KCmZ1bmN0aW9uIHNldHVwU3R1ZGVudFByb2dyZXNzTGlzdGVuZXJzKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXctbXktcHJvZ3Jlc3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93U3R1ZGVudFByb2dyZXNzVmlldyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by1zdHVkZW50LWhvbWUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcHJvZ3Jlc3MtdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWluaXRpYWwtdmlldycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfSk7Cn0KCi8qKgogKiBb4LiJ4Lia4Lix4Lia4LmA4LiV4LmH4LihXSDguYDguKPguLTguYjguKHguIHguKPguLDguJrguKfguJnguIHguLLguKPguJ3guLbguIHguJ3guJnguJfguLHguIHguKnguLAg4LmC4LiU4Lii4LmB4Lib4Lil4LiH4LiE4Liz4LiW4Liy4Lih4LiU4Li04Lia4LmA4Lib4LmH4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lih4Liy4LiV4Lij4LiQ4Liy4LiZ4LiB4LmI4Lit4LiZCiAqIEBwYXJhbSB7c3RyaW5nfSByYXdRdWVzdGlvblRleHQgLSDguJvguKPguLDguYLguKLguITguITguLPguJbguLLguKHguYDguJXguYfguKHguYYg4LiX4Li14LmI4Lih4Liy4LiI4Liy4LiB4Lib4Li44LmI4LihICLguJ3guLbguIHguJ3guJnguYDguKPguLfguYjguK3guIfguJnguLXguYnguYDguJ7guLTguYjguKHguYDguJXguLTguKEiCiAqLwphc3luYyBmdW5jdGlvbiBzdGFydFNraWxsUHJhY3RpY2UocmF3UXVlc3Rpb25UZXh0KSB7CiAgICAvLyAxLiDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguYLguKvguKXguJTguYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguYDguKvguYfguJkKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJzguKXguKrguK3guJrguYDguJTguLTguKEKICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2PgogICAgICAgICAgICA8cCBjbGFzcz0ibXQtNCB0ZXh0LWdyYXktNjAwIj7guIHguLPguKXguLHguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguKvguLHguKfguILguYnguK3guYHguKXguLDguYDguJXguKPguLXguKLguKHguIrguLjguJTguYHguJrguJrguJ3guLbguIHguJ7guLTguYDguKjguKkuLi48L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMi4gKirguILguLHguYnguJnguJXguK3guJnguYPguKvguKHguYjguJfguLXguYjguKrguLPguITguLHguI3guJfguLXguYjguKrguLjguJQqKjog4LmA4Lij4Li14Lii4LiBIEFJIOC5gOC4nuC4t+C5iOC4reC5geC4m+C4peC4h+C4hOC4s+C4luC4suC4oeC4lOC4tOC4muC5g+C4q+C5ieC5gOC4m+C5h+C4meC4q+C4seC4p+C4guC5ieC4reC4oeC4suC4leC4o+C4kOC4suC4mQogICAgICAgIGNvbnN0IHN0YW5kYXJkVG9waWMgPSBhd2FpdCBnZXRTdGFuZGFyZGl6ZWRUb3BpYyhyYXdRdWVzdGlvblRleHQpOwogICAgICAgIGNvbnNvbGUubG9nKGDguITguLPguJbguLLguKHguJTguLTguJo6ICIke3Jhd1F1ZXN0aW9uVGV4dH0iIC0+IOC4q+C4seC4p+C4guC5ieC4reC4oeC4suC4leC4o+C4kOC4suC4mTogIiR7c3RhbmRhcmRUb3BpY30iYCk7CiAgICAgICAgCiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiVIFVJIOC5g+C4q+C5ieC5geC4quC4lOC4h+C4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C5geC4geC5iOC4meC4seC4geC5gOC4o+C4teC4ouC4mQogICAgICAgIHN0dWRlbnRRdWl6QXJlYS5xdWVyeVNlbGVjdG9yKCdwJykudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4LmA4LiV4Lij4Li14Lii4Lih4LiK4Li44LiU4LmB4Lia4Lia4Lid4Li24LiB4Lie4Li04LmA4Lio4Lip4Liq4Liz4Lir4Lij4Lix4Lia4Lir4Lix4Lin4LiC4LmJ4LitOiAiJHtzdGFuZGFyZFRvcGljfSIuLi5gOwoKICAgICAgICAvLyAzLiDguITguYnguJnguKvguLLguITguLPguJbguLLguKHguYPguJkgIuC4hOC4peC4seC4h+C5geC4muC4muC4neC4tuC4geC4neC4mSIg4LiU4LmJ4Lin4LiiICLguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkiIOC4l+C4teC5iOC5hOC4lOC5ieC4oeC4sgogICAgICAgIGNvbnN0IHByYWN0aWNlQmFua1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJhY3RpY2VCYW5rYCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHByYWN0aWNlQmFua1JlZiwgd2hlcmUoInRvcGljIiwgIj09Iiwgc3RhbmRhcmRUb3BpYykpOwogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgLy8gNC4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiE4Liz4LiW4Liy4Lih4LmD4LiZ4LiE4Lil4Lix4LiH4LmA4Lie4Li14Lii4LiH4Lie4Lit4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgaWYgKHNuYXBzaG90LmRvY3MubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgLy8gNC4xIC0tPiDguIHguKPguJPguLXguYDguIjguK0gKENhY2hlIEhpdCk6IOC5g+C4iuC5ieC4hOC4s+C4luC4suC4oeC4iOC4suC4geC4hOC4peC4seC4hwogICAgICAgICAgICBjb25zb2xlLmxvZyhg4Lie4Lia4LiC4LmJ4Lit4Liq4Lit4LiaICR7c25hcHNob3QuZG9jcy5sZW5ndGh9IOC4guC5ieC4reC5g+C4meC4hOC4peC4seC4h+C4quC4s+C4q+C4o+C4seC4muC4q+C4seC4p+C4guC5ieC4rSAiJHtzdGFuZGFyZFRvcGljfSIuIOC4geC4s+C4peC4seC4h+C4quC4uOC5iOC4oeC5gOC4peC4t+C4reC4geC4oeC4suC5g+C4iuC5ieC4h+C4suC4mS4uLmApOwogICAgICAgICAgICAKICAgICAgICAgICAgbGV0IHF1ZXN0aW9uc0Zyb21CYW5rID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2h1ZmZsZUFycmF5KHF1ZXN0aW9uc0Zyb21CYW5rKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRyaWxsRGF0YSA9IHsKICAgICAgICAgICAgICAgIHRvcGljOiBzdGFuZGFyZFRvcGljLAogICAgICAgICAgICAgICAgcXVlc3Rpb25zOiBxdWVzdGlvbnNGcm9tQmFuay5zbGljZSgwLCAzKSAvLyDguYDguKXguLfguK3guIHguKHguLIgMyDguILguYnguK0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGRpc3BsYXlTa2lsbFByYWN0aWNlRHJpbGwoZHJpbGxEYXRhKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gNC4yIC0tPiDguIHguKPguJPguLXguYTguKHguYjguYDguIjguK0gKENhY2hlIE1pc3MpOiDguYDguKPguLXguKLguIEgQUkg4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDguYTguKHguYjguJ7guJrguILguYnguK3guKrguK3guJrguYPguJnguITguKXguLHguIfguKrguLPguKvguKPguLHguJrguKvguLHguKfguILguYnguK0gIiR7c3RhbmRhcmRUb3BpY30iLiDguIHguLPguKXguLHguIfguYDguKPguLXguKLguIEgQUkg4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmILi4uYCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkcmlsbERhdGEgPSBhd2FpdCBnZW5lcmF0ZVByYWN0aWNlUXVlc3Rpb25zKHN0YW5kYXJkVG9waWMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gKirguILguLHguYnguJnguJXguK3guJnguKrguLPguITguLHguI06Kiog4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmI4Lil4LiH4LiE4Lil4Lix4LiH4LiU4LmJ4Lin4LiiICLguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkiCiAgICAgICAgICAgIGF3YWl0IHNhdmVEcmlsbFRvUHJhY3RpY2VCYW5rKGRyaWxsRGF0YSwgc3RhbmRhcmRUb3BpYyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBkaXNwbGF5U2tpbGxQcmFjdGljZURyaWxsKGRyaWxsRGF0YSk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi4Lil4LmJ4Lih4LmA4Lir4Lil4Lin4LmD4LiZ4LiB4Liy4Lij4LmA4Lij4Li04LmI4Lih4LmC4Lir4Lih4LiU4Lid4Li24LiB4Lid4LiZ4LiX4Lix4LiB4Lip4LiwOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LiC4Lit4Lit4Lig4Lix4LiiLCDguYTguKHguYjguKrguLLguKHguLLguKPguJbguKrguKPguYnguLLguIfguIrguLjguJTguYHguJrguJrguJ3guLbguIHguYTguJTguYnguYPguJnguILguJPguLDguJnguLXguYkg4LiB4Lij4Li44LiT4Liy4Lil4Lit4LiH4LmD4Lir4Lih4LmI4Lig4Liy4Lii4Lir4Lil4Lix4LiHIik7CiAgICAgICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9CgovKioKICog4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiW4Liy4Lih4LiI4Liy4LiB4LiK4Li44LiU4LmB4Lia4Lia4Lid4Li24LiB4LiX4Li14LmIIEFJIOC4quC4o+C5ieC4suC4h+C4peC4h+C5g+C4mSBQcmFjdGljZSBCYW5rCiAqIEBwYXJhbSB7b2JqZWN0fSBkcmlsbERhdGEgLSDguILguYnguK3guKHguLnguKXguIrguLjguJTguYHguJrguJrguJ3guLbguIHguJfguLXguYjguYTguJTguYnguIjguLLguIEgQUkKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVEcmlsbFRvUHJhY3RpY2VCYW5rKGRyaWxsRGF0YSwgc3RhbmRhcmRUb3BpYykgeyAvLyA8LS0tIOC5gOC4nuC4tOC5iOC4oSBzdGFuZGFyZFRvcGljIOC4leC4o+C4h+C4meC4teC5iQogICAgY29uc3QgcHJhY3RpY2VCYW5rUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcmFjdGljZUJhbmtgKTsKICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CgogICAgZHJpbGxEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgIGNvbnN0IG5ld1F1ZXN0aW9uRG9jID0gZG9jKHByYWN0aWNlQmFua1JlZik7CiAgICAgICAgYmF0Y2guc2V0KG5ld1F1ZXN0aW9uRG9jLCB7CiAgICAgICAgICAgIHRvcGljOiBzdGFuZGFyZFRvcGljLCAvLyA8LS0tIOC4leC4reC4meC4meC4teC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4o+C4ueC5ieC4iOC4seC4geC5geC4peC5ieC4pwogICAgICAgICAgICBxdWVzdGlvblRleHQ6IHEucXVlc3Rpb25UZXh0LAogICAgICAgICAgICBvcHRpb25zOiBxLm9wdGlvbnMsCiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJJbmRleDogcS5jb3JyZWN0QW5zd2VySW5kZXgsCiAgICAgICAgICAgIGV4cGxhbmF0aW9uOiBxLmV4cGxhbmF0aW9uLAogICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpCiAgICAgICAgfSk7CiAgICB9KTsKCiAgICB0cnkgewogICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgIGNvbnNvbGUubG9nKGDguJrguLHguJnguJfguLbguIHguITguLPguJbguLLguKHguYPguKvguKHguYggJHtkcmlsbERhdGEucXVlc3Rpb25zLmxlbmd0aH0g4LiC4LmJ4Lit4Lil4LiHIFByYWN0aWNlIEJhbmsg4Liq4Liz4LmA4Lij4LmH4LiIYCk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBxdWVzdGlvbnMgdG8gcHJhY3RpY2UgYmFuazoiLCBlcnJvcik7CiAgICB9Cn0KCi8qKgogKiDguYDguKPguLXguKLguIEgQUkg4LmA4Lie4Li34LmI4Lit4LmB4Lib4Lil4LiH4Lib4Lij4Liw4LmC4Lii4LiE4LiE4Liz4LiW4Liy4Lih4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lih4Liy4LiV4Lij4LiQ4Liy4LiZIChTdGFuZGFyZGl6ZWQgVG9waWMpCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVzdGlvblRleHQgLSDguJvguKPguLDguYLguKLguITguITguLPguJbguLLguKHguYDguJXguYfguKHguYYKICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0g4Lir4Lix4Lin4LiC4LmJ4Lit4Lih4Liy4LiV4Lij4LiQ4Liy4LiZIOC5gOC4iuC5iOC4mSAi4LiB4Liy4Lij4Lir4Liy4Lij4LiX4Lio4LiZ4Li04Lii4LihIgogKi8KYXN5bmMgZnVuY3Rpb24gZ2V0U3RhbmRhcmRpemVkVG9waWMocXVlc3Rpb25UZXh0KSB7CiAgICBjb25zdCBwcm9tcHQgPSBgCiAgICAgICAg4LiE4Li44LiT4LiE4Li34Lit4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiN4LiU4LmJ4Liy4LiZ4Lir4Lil4Lix4LiB4Liq4Li54LiV4Lij4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmMCiAgICAgICAg4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiE4Liz4LiW4Liy4Lih4LiV4LmI4Lit4LmE4Lib4LiZ4Li14LmJIOC5geC4peC4sOC4quC4o+C4uOC4m+C5g+C4q+C5ieC5gOC4m+C5h+C4mSAi4Lir4Lix4Lin4LiC4LmJ4LitIiDguJfguLLguIfguITguJPguLTguJXguKjguLLguKrguJXguKPguYzguJfguLXguYjguKrguLHguYnguJnguYHguKXguLDguYDguJvguYfguJnguKHguLLguJXguKPguJDguLLguJnguJfguLXguYjguKrguLjguJQKCiAgICAgICAg4LiV4Lix4Lin4Lit4Lii4LmI4Liy4LiHOgogICAgICAgIC0g4LiE4Liz4LiW4Liy4LihOiAi4Lic4Lil4Lil4Lix4Lie4LiY4LmM4LiC4Lit4LiHICQxMi41IFxcZGl2IDAuNSQg4LiE4Li34Lit4LmA4LiX4LmI4Liy4LmD4LiUIiAtPiDguKvguLHguKfguILguYnguK06ICLguIHguLLguKPguKvguLLguKPguJfguKjguJnguLTguKLguKEiCiAgICAgICAgLSDguITguLPguJbguLLguKE6ICLguIjguIfguKvguLIg4LiELuC4oy7guJkuIOC4guC4reC4hyAxMiDguYHguKXguLAgMTgiIC0+IOC4q+C4seC4p+C4guC5ieC4rTogIuC4geC4suC4o+C4q+C4siDguIQu4LijLuC4mS4iCiAgICAgICAgLSDguITguLPguJbguLLguKE6ICIkXFxmcmFjezF9ezJ9ICsgXFxmcmFjezF9ezR9JCDguKHguLXguITguYjguLLguYDguJfguYjguLLguYPguJQiIC0+IOC4q+C4seC4p+C4guC5ieC4rTogIuC4geC4suC4o+C4muC4p+C4geC5gOC4qOC4qeC4quC5iOC4p+C4mSIKCiAgICAgICAg4LiE4Liz4LiW4Liy4Lih4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMOiAiJHtxdWVzdGlvblRleHR9IgoKICAgICAgICDguYPguKvguYnguJXguK3guJrguIHguKXguLHguJrguKHguLLguYDguJvguYfguJkgSlNPTiBvYmplY3Qg4LiX4Li14LmI4Lih4Li1IGtleSAic3RhbmRhcmRUb3BpYyIg4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICBgOwogICAgY29uc3Qgc2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBzdGFuZGFyZFRvcGljOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsic3RhbmRhcmRUb3BpYyJdIH07CgogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpOwogICAgICAgIHJldHVybiByZXN1bHQuc3RhbmRhcmRUb3BpYzsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGdldCBzdGFuZGFyZGl6ZWQgdG9waWM6IiwgZXJyb3IpOwogICAgICAgIC8vIOC4q+C4suC4geC4peC5ieC4oeC5gOC4q+C4peC4pyDguYPguKvguYnguYPguIrguYnguITguLPguJbguLLguKHguYDguJTguLTguKHguYDguJvguYfguJnguKvguLHguKfguILguYnguK3guYTguJvguIHguYjguK3guJkgKEZhbGxiYWNrKQogICAgICAgIHJldHVybiBxdWVzdGlvblRleHQ7CiAgICB9Cn0KCi8qKgogKiBb4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4LmB4LiB4LmJ4LmE4LiC4Lil4LmI4Liy4Liq4Li44LiUIC0g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Lii4Li34LiZ4Lii4Lix4LiZXQogKiDguIjguLHguJTguIHguLLguKPguIHguKPguLDguJrguKfguJnguIHguLLguKPguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguInguJrguLHguJrguIfguYjguLLguKIg4LmC4LiU4Lii4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LmD4LiZ4Lir4LiZ4LmJ4LiyICLguJzguKXguKXguLHguJ7guJjguYwiIOC4l+C4seC4meC4l+C4tQogKiBAcGFyYW0ge3N0cmluZ30gb3JpZ2luYWxRdWl6SWQgLSBJRCDguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJrguJXguYnguJnguInguJrguLHguJoKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlRWFzeVZlcnNpb25RdWl6KG9yaWdpbmFsUXVpeklkKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZUVhc3lQYXJhbGxlbFF1aXoob3JpZ2luYWxRdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8qKgogKiDguYDguKPguLXguKLguIHguYPguIrguYkgQUkg4LmA4Lie4Li34LmI4Lit4Liq4Lij4LmJ4Liy4LiH4LiK4Li44LiU4LiE4Liz4LiW4Liy4Lih4Liq4Liz4Lir4Lij4Lix4Lia4Lid4Li24LiB4Lid4LiZIChEcmlsbCBTZXQpCiAqIEBwYXJhbSB7c3RyaW5nfSB0b3BpYyAtIOC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4owogKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSDguILguYnguK3guKHguLnguKXguIrguLjguJTguYHguJrguJrguJ3guLbguIHguJfguLXguYggQUkg4Liq4Lij4LmJ4Liy4LiHCiAqLwphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVByYWN0aWNlUXVlc3Rpb25zKHRvcGljKSAgeyAvKiBSZW1vdmVkICovIH0gCgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAovKioKICog4LmB4Liq4LiU4LiHIE1vZGFsIOC5geC4nOC4meC4geC4suC4o+C4quC4reC4meC4iOC4suC4geC4guC5ieC4reC4oeC4ueC4peC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4pwogKiBAcGFyYW0ge29iamVjdH0gbGVzc29uUGxhbiDguILguYnguK3guKHguLnguKXguYHguJzguJnguIHguLLguKPguKrguK3guJkKICogQHBhcmFtIHtvYmplY3R9IHF1aXpEYXRhIOC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgogKi8KZnVuY3Rpb24gZGlzcGxheUxlc3NvblBsYW4obGVzc29uUGxhbiwgcXVpekRhdGEpIHsKICAgIGNvbnN0IGxlc3Nvbkh0bWwgPSBgCiAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi00IHRleHQtZ3JheS04MDAiPuC5geC4nOC4meC4geC4suC4o+C4quC4reC4meC5geC4meC4sOC4meC4s+C4quC4s+C4q+C4o+C4seC4muC5gOC4o+C4t+C5iOC4reC4hzogJHtxdWl6RGF0YS50b3BpY308L2gzPgogICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiB0ZXh0LWxlZnQgdGV4dC1iYXNlIj4KICAgICAgICAgICAgPGRpdj48aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1yZWQtODAwIGJvcmRlci1iIHBiLTEgbWItMiI+4LiI4Li44LiU4LiX4Li14LmI4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lii4Lix4LiH4LmE4Lih4LmI4LmA4LiC4LmJ4Liy4LmD4LiIIChMZWFybmluZyBHYXBzKTwvaDQ+PHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgdGV4dC1yZWQtOTAwIj4ke2xlc3NvblBsYW4ubGVhcm5pbmdHYXBzLm1hcChnYXAgPT4gYDxsaT4ke2dhcH08L2xpPmApLmpvaW4oJycpfTwvdWw+PC9kaXY+CiAgICAgICAgICAgIDxkaXY+PGg0IGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtYmx1ZS04MDAgYm9yZGVyLWIgcGItMSBtYi0yIj7guYHguJnguKfguJfguLLguIfguIHguLLguKPguKrguK3guJnguYHguKXguLDguYDguJnguLfguYnguK3guKvguLLguJfguJrguJfguKfguJk8L2g0PjxwIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIHdoaXRlc3BhY2UtcHJlLXdyYXAiPiR7bGVzc29uUGxhbi50ZWFjaGluZ0NvbnRlbnR9PC9wPjwvZGl2PgogICAgICAgICAgICA8ZGl2PjxoNCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWdyZWVuLTgwMCBib3JkZXItYiBwYi0xIG1iLTIiPuC5guC4iOC4l+C4ouC5jOC4leC4seC4p+C4reC4ouC5iOC4suC4h+C4quC4s+C4q+C4o+C4seC4muC4neC4tuC4geC4neC4mTwvaDQ+PGRpdiBjbGFzcz0ic3BhY2UteS0zIj4ke2xlc3NvblBsYW4ucHJhY3RpY2VQcm9ibGVtcy5tYXAocCA9PiBgPGRpdiBjbGFzcz0iYm9yZGVyLWwtNCBib3JkZXItZ3JlZW4tMjAwIHBsLTMiPjxwPjxzdHJvbmc+4LmC4LiI4LiX4Lii4LmMOjwvc3Ryb25nPiAke3AucXVlc3Rpb259PC9wPjxwPjxzdHJvbmc+4LmA4LiJ4Lil4LiiOjwvc3Ryb25nPiAke3Auc29sdXRpb259PC9wPjwvZGl2PmApLmpvaW4oJycpfTwvZGl2PjwvZGl2PgogICAgICAgIDwvZGl2PmA7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tcGxhbi10aXRsZScpLnRleHRDb250ZW50ID0gYOC5geC4nOC4meC4geC4suC4o+C4quC4reC4mTogJHtxdWl6RGF0YS50b3BpY31gOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1wbGFuLWNvbnRlbnQnKS5pbm5lckhUTUwgPSBsZXNzb25IdG1sOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1wbGFuLW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CQogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKCk7Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCi8qKgogKiDguYHguKrguJTguIfguJzguKXguKvguJnguYnguLLguIjguK3guYLguKvguKHguJTguJ3guLbguIHguJ3guJnguJfguLHguIHguKnguLDguJfguLXguKXguLDguILguYnguK0KICogQHBhcmFtIHtvYmplY3R9IGRyaWxsRGF0YSAtIOC4guC5ieC4reC4oeC4ueC4peC4iuC4uOC4lOC5geC4muC4muC4neC4tuC4geC4iOC4suC4gSBBSQogKi8KZnVuY3Rpb24gZGlzcGxheVNraWxsUHJhY3RpY2VEcmlsbChkcmlsbERhdGEpIHsKICAgIGxldCBjdXJyZW50RHJpbGxJbmRleCA9IDA7CiAgICBjb25zdCBxdWVzdGlvbnMgPSBkcmlsbERhdGEucXVlc3Rpb25zOwoKICAgIGNvbnN0IHJlbmRlckRyaWxsUXVlc3Rpb24gPSAoKSA9PiB7CiAgICAgICAgY29uc3QgcSA9IHF1ZXN0aW9uc1tjdXJyZW50RHJpbGxJbmRleF07CiAgICAgICAgY29uc3QgaHRtbCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIiPuC4neC4tuC4geC4neC4meC4guC5ieC4reC4l+C4teC5iCAke2N1cnJlbnREcmlsbEluZGV4ICsgMX0gLyAke3F1ZXN0aW9ucy5sZW5ndGh9PC9wPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXktNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbWItMyI+JHtxLnF1ZXN0aW9uVGV4dH08L3A+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZHJpbGwtb3B0aW9ucyIgY2xhc3M9InNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9ImRyaWxsX29wdF8ke2l9IiBuYW1lPSJkcmlsbF9hbnN3ZXIiIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0iZHJpbGxfb3B0XyR7aX0iPiR7b3B0fTwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImRyaWxsLWZlZWRiYWNrIiBjbGFzcz0iaGlkZGVuIG15LTQgcC0zIHJvdW5kZWQtbGciPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG10LTQiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImhpbnQtYnRuIiBjbGFzcz0iYmctZ3JheS0yMDAgdGV4dC1ncmF5LTcwMCBweS0yIHB4LTQgcm91bmRlZC1sZyBob3ZlcjpiZy1ncmF5LTMwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbGlnaHRidWxiIj48L2k+IOC4guC4reC4hOC4s+C5g+C4muC5iQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNoZWNrLWFuc3dlci1idG4iIGNsYXNzPSJiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctYmx1ZS03MDAiPgogICAgICAgICAgICAgICAgICAgICAgICDguJXguKPguKfguIjguITguLPguJXguK3guJoKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJuZXh0LWRyaWxsLWJ0biIgY2xhc3M9ImhpZGRlbiBiZy1ncmVlbi02MDAgdGV4dC13aGl0ZSBweS0yIHB4LTUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLWdyZWVuLTcwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4guC5ieC4reC4leC5iOC4reC5hOC4myA8aSBjbGFzcz0iZmFzIGZhLWFycm93LXJpZ2h0Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgICAgICBzdHVkZW50UXVpekFyZWEuaW5uZXJIVE1MID0gaHRtbDsKICAgICAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW3N0dWRlbnRRdWl6QXJlYV0pOwoKICAgICAgICAvLyAtLS0g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVycyDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKHguYPguJnguYLguKvguKHguJTguJ3guLbguIHguJ3guJkgLS0tCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpbnQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICBjb25zdCBoaW50ID0gYXdhaXQgZ2V0SGludEZvclF1ZXN0aW9uKHEucXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgIHNob3dNZXNzYWdlKGhpbnQpOyAvLyDguYPguIrguYkgbW9kYWwg4LmA4LiU4Li04Lih4LmB4Liq4LiU4LiH4LiE4Liz4LmD4Lia4LmJCiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1hbnN3ZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJBbnN3ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJkcmlsbF9hbnN3ZXIiXTpjaGVja2VkJyk7CiAgICAgICAgICAgIGlmICghdXNlckFuc3dlcikgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4geC5iOC4reC4meC4hOC4o+C4seC4miIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBmZWVkYmFja0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RyaWxsLWZlZWRiYWNrJyk7CiAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IHBhcnNlSW50KHVzZXJBbnN3ZXIudmFsdWUpID09PSBxLmNvcnJlY3RBbnN3ZXJJbmRleDsKCiAgICAgICAgICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIGZlZWRiYWNrRWwuY2xhc3NOYW1lID0gJ215LTQgcC0zIHJvdW5kZWQtbGcgYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJzsKICAgICAgICAgICAgICAgIGZlZWRiYWNrRWwuaW5uZXJIVE1MID0gYDxzdHJvbmc+PGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiPjwvaT4g4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LiE4Lij4Lix4LiaITwvc3Ryb25nPjxicj4ke3EuZXhwbGFuYXRpb259YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZlZWRiYWNrRWwuY2xhc3NOYW1lID0gJ215LTQgcC0zIHJvdW5kZWQtbGcgYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAnOwogICAgICAgICAgICAgICAgZmVlZGJhY2tFbC5pbm5lckhUTUwgPSBgPHN0cm9uZz48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPiDguKLguLHguIfguYTguKHguYjguJbguLnguIHguJnguLAg4Lil4Lit4LiH4LiU4Li54LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiOjwvc3Ryb25nPjxicj4ke3EuZXhwbGFuYXRpb259YDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmZWVkYmFja0VsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoJCQlpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW2ZlZWRiYWNrRWxdKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4i+C5iOC4reC4mS/guYHguKrguJTguIfguJvguLjguYjguKEKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoZWNrLWFuc3dlci1idG4nKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpbnQtYnRuJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LWRyaWxsLWJ0bicpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dC1kcmlsbC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY3VycmVudERyaWxsSW5kZXgrKzsKICAgICAgICAgICAgaWYgKGN1cnJlbnREcmlsbEluZGV4IDwgcXVlc3Rpb25zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmVuZGVyRHJpbGxRdWVzdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g4LiI4Lia4LiB4Liy4Lij4Lid4Li24LiB4Lid4LiZCiAgICAgICAgICAgICAgICBzdHVkZW50UXVpekFyZWEuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy1pbmRpZ28tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWF3YXJkIHRleHQtNXhsIHRleHQtaW5kaWdvLTUwMCBtYi00Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIj7guJ3guLbguIHguJ3guJnguKrguLPguYDguKPguYfguIghPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTIiPuC4ouC4reC4lOC5gOC4ouC4teC5iOC4ouC4oeC4oeC4suC4gSEg4Lir4LiZ4Li54LmE4LiU4LmJ4LiX4Lia4LiX4Lin4LiZ4LmB4Lil4Liw4Lid4Li24LiB4Lid4LiZ4LmA4Lie4Li04LmI4Lih4LmA4LiV4Li04Lih4LmB4Lil4LmJ4LinPGJyPuC4geC4peC4seC4muC5hOC4m+C4l+C4teC5iOC4q+C4meC5ieC4suC4nOC4peC4quC4reC4muC5gOC4nuC4t+C5iOC4reC4neC4tuC4geC4neC4meC4q+C4seC4p+C4guC5ieC4reC4reC4t+C5iOC4meC4leC5iOC4reC5hOC4lOC5ieC5gOC4peC4ojwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iYmFjay10by1yZXN1bHRzLWJ0biIgY2xhc3M9Im10LTQgYmctYmx1ZS02MDAgdGV4dC13aGl0ZSBweS0yIHB4LTUgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIj7guIHguKXguLHguJrguYTguJvguKvguJnguYnguLLguJzguKXguKrguK3guJo8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by1yZXN1bHRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJlbmRlckRyaWxsUXVlc3Rpb24oKTsgLy8g4LmA4Lij4Li04LmI4Lih4LmB4Liq4LiU4LiH4Lic4Lil4LiC4LmJ4Lit4LmB4Lij4LiBCn0KCi8qKgogKiDguYDguKPguLXguKLguIEgQUkg4LmA4Lie4Li34LmI4Lit4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LmD4Lia4LmJ4Liq4Liz4Lir4Lij4Lix4Lia4LmC4LiI4LiX4Lii4LmMCiAqIEBwYXJhbSB7c3RyaW5nfSBxdWVzdGlvblRleHQgLSDguYLguIjguJfguKLguYzguITguLPguJbguLLguKHguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguITguLPguYPguJrguYkKICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPn0g4LiE4Liz4LmD4Lia4LmJ4LiI4Liy4LiBIEFJCiAqLwphc3luYyBmdW5jdGlvbiBnZXRIaW50Rm9yUXVlc3Rpb24ocXVlc3Rpb25UZXh0KSB7CiAgICBjb25zdCBwcm9tcHQgPSBg4Liq4Liz4Lir4Lij4Lix4Lia4LmC4LiI4LiX4Lii4LmM4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmM4LiX4Li14LmI4Lin4LmI4LiyICIke3F1ZXN0aW9uVGV4dH0iLCDguIrguYjguKfguKLguYPguKvguYnguITguLPguYPguJrguYnguKrguLHguYnguJnguYYgMS0yIOC4m+C4o+C4sOC5guC4ouC4hOC5gOC4nuC4t+C5iOC4reC5geC4meC4sOC5geC4meC4p+C4l+C4suC4h+C4geC4suC4o+C4hOC4tOC4lCDguYLguJTguKLguKvguYnguLLguKHguYDguInguKXguKLguITguLPguJXguK3guJrguYLguJTguKLguJXguKPguIfguYDguJTguYfguJTguILguLLguJRgOwogICAgY29uc3Qgc2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBoaW50OiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsiaGludCJdIH07CiAgICAKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2FsbEFuYWx5c2lzQXBpKHByb21wdCwgc2NoZW1hKTsKICAgICAgICByZXR1cm4gcmVzdWx0LmhpbnQ7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBnZXQgaGludDoiLCBlcnJvcik7CiAgICAgICAgcmV0dXJuICLguILguK3guK3guKDguLHguKIsIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4quC4o+C5ieC4suC4h+C4hOC4s+C5g+C4muC5ieC5hOC4lOC5ieC5g+C4meC4guC4k+C4sOC4meC4teC5iSI7CiAgICB9Cn0KCQkKCQkvKioKICog4LiU4Li24LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmMIFBERgogKiBAcGFyYW0ge0ZpbGV9IGZpbGUgLSDguYTguJ/guKXguYwgUERGIOC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC4reC4seC4m+C5guC4q+C4peC4lAogKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSAtIFByb21pc2Ug4LiX4Li14LmI4LiI4LiwIHJlc29sdmUg4LmA4Lib4LmH4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4LmE4Lif4Lil4LmMCiAqLwphc3luYyBmdW5jdGlvbiBleHRyYWN0VGV4dEZyb21QZGYoZmlsZSkgewogICAgLy8g4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIHdvcmtlciBzb3VyY2Ug4Liq4Liz4Lir4Lij4Lix4LiaIHBkZi5qcwogICAgcGRmanNMaWIuR2xvYmFsV29ya2VyT3B0aW9ucy53b3JrZXJTcmMgPSBgaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcGRmLmpzLzIuMTEuMzM4L3BkZi53b3JrZXIubWluLmpzYDsKCiAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKTsKICAgIGNvbnN0IHBkZiA9IGF3YWl0IHBkZmpzTGliLmdldERvY3VtZW50KGFycmF5QnVmZmVyKS5wcm9taXNlOwogICAgY29uc3QgbnVtUGFnZXMgPSBwZGYubnVtUGFnZXM7CiAgICBsZXQgZnVsbFRleHQgPSAnJzsKCiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBudW1QYWdlczsgaSsrKSB7CiAgICAgICAgY29uc3QgcGFnZSA9IGF3YWl0IHBkZi5nZXRQYWdlKGkpOwogICAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gYXdhaXQgcGFnZS5nZXRUZXh0Q29udGVudCgpOwogICAgICAgIGNvbnN0IHBhZ2VUZXh0ID0gdGV4dENvbnRlbnQuaXRlbXMubWFwKGl0ZW0gPT4gaXRlbS5zdHIpLmpvaW4oJyAnKTsKICAgICAgICBmdWxsVGV4dCArPSBwYWdlVGV4dCArICdcblxuJzsgLy8g4LmA4Lie4Li04LmI4Lih4LiB4Liy4Lij4LmA4Lin4LmJ4LiZ4Lia4Lij4Lij4LiX4Lix4LiU4Lij4Liw4Lir4Lin4LmI4Liy4LiH4Lir4LiZ4LmJ4LiyCiAgICB9CgogICAgcmV0dXJuIGZ1bGxUZXh0Owp9CgovLyDilrzilrzilrwgU1RBUlQ6IOC5guC4hOC5ieC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4miAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lii4LiB4LiV4Liy4Lih4LmA4LiZ4Li34LmJ4Lit4Lir4LiyIiDilrzilrzilrwKCi8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4muC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4lOC4tuC4h+C4oeC4suC4iOC4suC4gSBCbHVlcHJpbnQKbGV0IGV4dHJhY3RlZEJsdWVwcmludFRvcGljcyA9IFtdOwoKLy8g4pa84pa84pa8IOC4hOC4seC4lOC4peC4reC4geC5guC4hOC5ieC4lOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4meC4teC5ieC5hOC4m+C4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBhbmFseXplQmx1ZXByaW50Rm9yVG9waWNzIOC5gOC4lOC4tOC4oSDilrzilrzilrwKCmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVCbHVlcHJpbnRGb3JUb3BpY3MocGRmVGV4dCkgewogICAgY29uc3Qgb3B0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtb3B0aW9ucy1jb250YWluZXInKTsKICAgIGNvbnN0IHRvcGljc0xpc3REaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXRvcGljcy1saXN0Jyk7CiAgICBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtYmx1ZXByaW50LWFzLXByb2plY3QtYnRuJyk7CiAgICAKICAgIG9wdGlvbnNDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICB0b3BpY3NMaXN0RGl2LmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1ncmF5LTUwMCBpdGFsaWMiPkFJIOC4geC4s+C4peC4seC4h+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4q+C4seC4p+C4guC5ieC4reC4iOC4suC4gSBCbHVlcHJpbnQuLi48L3A+JzsKICAgIHNhdmVCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9tcHQgPSBg4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiC4LmJ4Lit4LiE4Lin4Liy4LihIFRlc3QgQmx1ZXByaW50IOC4p+C4tOC4iuC4suC4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jOC4meC4teC5iTogIiR7cGRmVGV4dH0iLiDguKDguLLguKPguIHguLTguIjguITguLfguK06IDEu4Lij4Liw4Lia4Li44Lij4Liw4LiU4Lix4Lia4LiK4Lix4LmJ4LiZIDIu4Liq4LiB4Lix4LiU4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Lit4Lit4LiB4Lih4Liy4LmD4LiZ4Lij4Li54Lib4LmB4Lia4LiaIG5lc3RlZCBKU09OIOC4l+C4teC5iOC4iuC4seC4lOC5gOC4iOC4mSAzLuC5geC4geC5ieC5hOC4guC4hOC4s+C4oOC4suC4qeC4suC5hOC4l+C4ouC4l+C4teC5iOC4nOC4tOC4lOC5gOC4nuC4teC5ieC4ouC4mSA0LuC4quC4o+C4uOC4m+C4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4ouC5iOC4reC4ouC5g+C4q+C5ieC4quC4seC5ieC4meC4geC4o+C4sOC4iuC4seC4mi4gSlNPTiBvdXRwdXQg4LiV4LmJ4Lit4LiH4Lih4Li14LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiHOiB7IGdyYWRlTGV2ZWw6IHN0cmluZywgY3VycmljdWx1bTogWyB7IHNhcmE6IHN0cmluZywgbWFpblRvcGljczogWyB7IHRvcGljTmFtZTogc3RyaW5nLCBzdWJUb3BpY3M6IFtzdHJpbmddIH0gXSB9IF0gfS4g4LiV4Lix4Lin4Lit4Lii4LmI4Liy4LiHOiAn4Liq4Liy4Lij4Liw4LiX4Li14LmIIDE6IOC4iOC4s+C4meC4p+C4meC5geC4peC4sOC4nuC4teC4iuC4hOC4k+C4tOC4lScg4LiE4Li34LitICdzYXJhJy4gJ+C5gOC4p+C4peC4sicg4LiE4Li34LitICd0b3BpY05hbWUnLiAn4LiB4Liy4Lij4Lit4LmI4Liy4LiZ4LiV4Liy4Lij4Liy4LiH4LmA4Lin4Lil4LiyJyDguITguLfguK0gJ3N1YlRvcGljJ2A7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc2NoZW1hID0gewogICAgICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgImdyYWRlTGV2ZWwiOiB7ICJ0eXBlIjogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICJjdXJyaWN1bHVtIjogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJBUlJBWSIsCiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzYXJhIjogeyAidHlwZSI6ICJTVFJJTkciIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAibWFpblRvcGljcyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiQVJSQVkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJPQkpFQ1QiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidG9waWNOYW1lIjogeyAidHlwZSI6ICJTVFJJTkciIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAic3ViVG9waWNzIjogeyAidHlwZSI6ICJBUlJBWSIsICJpdGVtcyI6IHsgInR5cGUiOiAiU1RSSU5HIiB9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsidG9waWNOYW1lIiwgInN1YlRvcGljcyJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJzYXJhIiwgIm1haW5Ub3BpY3MiXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcmVxdWlyZWQ6IFsiZ3JhZGVMZXZlbCIsICJjdXJyaWN1bHVtIl0KICAgICAgICB9OwoKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpOwogICAgICAgIAogICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmN1cnJpY3VsdW0pIHsKICAgICAgICAgICAgZXh0cmFjdGVkQmx1ZXByaW50RGF0YSA9IHJlc3VsdDsgLy8g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmE4LiU4LmJCiAgICAgICAgICAgIHJlbmRlckJsdWVwcmludFRvcGljcyhyZXN1bHQpOyAKICAgICAgICAgICAgc2F2ZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgLy8g4LmB4Liq4LiU4LiH4Lib4Li44LmI4Lih4Lia4Lix4LiZ4LiX4Li24LiBCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBSSDguYTguKHguYjguKrguLLguKHguLLguKPguJbguYHguKLguIHguYLguITguKPguIfguKrguKPguYnguLLguIfguKvguLHguKfguILguYnguK3guYTguJTguYkiKTsKICAgICAgICB9CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBhbmFseXppbmcgYmx1ZXByaW50IHRvcGljczoiLCBlcnJvcik7CiAgICAgICAgdG9waWNzTGlzdERpdi5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtcmVkLTUwMCI+4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4LitPC9wPic7CiAgICB9Cn0gLy8gPC0tIOC4m+C4teC4geC4geC4suC4leC4seC4p+C4meC4teC5ieC4hOC4t+C4reC4leC4seC4p+C4l+C4teC5iOC4meC5iOC4suC4iOC4sOC4q+C4suC4ouC5hOC4m+C4hOC4o+C4seC4miDguJfguLPguYPguKvguYnguYDguIHguLTguJQgRXJyb3IKCmZ1bmN0aW9uIHJlbmRlckJsdWVwcmludFRvcGljcyhibHVlcHJpbnREYXRhKSB7CiAgICBjb25zdCB0b3BpY3NMaXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC10b3BpY3MtbGlzdCcpOwogICAgY29uc3QgZ3JhZGVMZXZlbCA9IGJsdWVwcmludERhdGEuZ3JhZGVMZXZlbDsKCiAgICAvLyDguYDguJ7guLTguYjguKHguIHguLLguKPguYHguKrguJTguIfguKPguLDguJTguLHguJrguIrguLHguYnguJnguJfguLXguYjguKfguLTguYDguITguKPguLLguLDguKvguYzguYTguJTguYkKICAgIGNvbnN0IGdyYWRlTGV2ZWxIZWFkZXIgPSBgPGgzIGNsYXNzPSJ0ZXh0LWNlbnRlciBmb250LXNlbWlib2xkIHRleHQtbGcgdGV4dC1ncmF5LTcwMCBtYi00Ij7guKPguLDguJTguLHguJrguIrguLHguYnguJnguJfguLXguYjguKfguLTguYDguITguKPguLLguLDguKvguYzguYTguJTguYk6ICR7Z3JhZGVMZXZlbH08L2gzPmA7CiAgICBsZXQgY29udGVudEh0bWwgPSAnJzsKCiAgICBibHVlcHJpbnREYXRhLmN1cnJpY3VsdW0uZm9yRWFjaChzYXJhID0+IHsKICAgICAgICBjb250ZW50SHRtbCArPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIHNoYWRvdy1zbSBtYi00Ij4KICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0iZm9udC1ib2xkIHRleHQteGwgdGV4dC1ibHVlLTgwMCBtYi0zIj4ke3NhcmEuc2FyYX08L2g0PmA7CgogICAgICAgIHNhcmEubWFpblRvcGljcy5mb3JFYWNoKG1haW5Ub3BpYyA9PiB7CiAgICAgICAgICAgIGNvbnRlbnRIdG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1sLTQgbWItMyI+CiAgICAgICAgICAgICAgICAgICAgPGg1IGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtbGcgdGV4dC1ncmF5LTcwMCBtYi0yIj4ke21haW5Ub3BpYy50b3BpY05hbWV9PC9oNT4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTEgcGwtNCBib3JkZXItbC0yIGJvcmRlci1ncmF5LTIwMCI+YDsKCiAgICAgICAgICAgIG1haW5Ub3BpYy5zdWJUb3BpY3MuZm9yRWFjaChzdWJUb3BpYyA9PiB7CiAgICAgICAgICAgICAgICAvLyAqKiog4LiI4Li44LiU4Liq4Liz4LiE4Lix4LiNICoqKgogICAgICAgICAgICAgICAgLy8g4LmA4Lij4Liy4LiI4Liw4LmD4Liq4LmIIG9uY2xpY2sg4LmA4Lie4Li34LmI4Lit4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZICLguJXguLHguKfguIHguKXguLLguIciIOC4l+C4teC5iOC4iOC4sOC4quC4o+C5ieC4suC4h+C5g+C4mSBTdGVwIDUKICAgICAgICAgICAgICAgIC8vIOC4nuC4o+C5ieC4reC4oeC4quC5iOC4hyAi4Lir4Lix4Lin4LiC4LmJ4Lit4Lii4LmI4Lit4LiiIiDguYHguKXguLAgIuC4o+C4sOC4lOC4seC4muC4iuC4seC5ieC4mSIg4LmE4Lib4LiU4LmJ4Lin4LiiCmNvbnRlbnRIdG1sICs9IGAKICAgIDxkaXYgY2xhc3M9InAtMiByb3VuZGVkLW1kIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgaXRlbXMtc3RhcnQgc206aXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnYXAtMiI+CgogICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAgZmxleC1ncm93IGN1cnNvci1wb2ludGVyIiBvbmNsaWNrPSJoYW5kbGVHZW5lcmF0ZUFuZFNob3dMZXNzb24oJyR7c3ViVG9waWMucmVwbGFjZSgvJy9nLCAiXFwnIil9JywgJyR7Z3JhZGVMZXZlbC5yZXBsYWNlKC8nL2csICJcXCciKX0nKSI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYm9vay1vcGVuIHRleHQtYmx1ZS01MDAgbXItMiI+PC9pPiAke3N1YlRvcGljfQogICAgICAgIDwvcD4KCiAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgZmxleC1zaHJpbmstMCI+CjxidXR0b24gY2xhc3M9InRleHQtaW5kaWdvLTgwMCBiZy1pbmRpZ28tMTAwIGhvdmVyOmJnLWluZGlnby0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEuNSBweC0zIHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEuNSIKICAgICAgICBvbmNsaWNrPSJoYW5kbGVHZW5lcmF0ZVF1aXpGcm9tQmx1ZXByaW50VG9waWMoJyR7c3ViVG9waWMucmVwbGFjZSgvJy9nLCAiXFwnIil9JykiPgogICAgPGkgY2xhc3M9ImZhcyBmYS1maWxlLWFsdCI+PC9pPuC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgo8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KYDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb250ZW50SHRtbCArPSBgPC9kaXY+PC9kaXY+YDsKICAgICAgICB9KTsKICAgICAgICBjb250ZW50SHRtbCArPSBgPC9kaXY+YDsKICAgIH0pOwogICAgCiAgICB0b3BpY3NMaXN0RGl2LmlubmVySFRNTCA9IGdyYWRlTGV2ZWxIZWFkZXIgKyBjb250ZW50SHRtbDsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVUZWFjaGluZ0NvbnRlbnQoc2VsZWN0ZWRUb3BpYykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLyoqCiAqIOC5geC4quC4lOC4h+C4nOC4peC5gOC4meC4t+C5ieC4reC4q+C4suC4quC4s+C4q+C4o+C4seC4muC4quC4reC4meC4l+C4teC5iCBBSSDguKrguKPguYnguLLguIfguILguLbguYnguJnguYPguJkgTW9kYWwKICogQHBhcmFtIHtvYmplY3R9IGNvbnRlbnQgLSDguILguYnguK3guKHguLnguKXguYDguJnguLfguYnguK3guKvguLLguJfguLXguYjguYTguJTguYnguIjguLLguIEgQUkKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljIC0g4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4LitCiAqLwpmdW5jdGlvbiBkaXNwbGF5VGVhY2hpbmdDb250ZW50KGNvbnRlbnQsIHRvcGljKSB7CiAgICBjb25zdCBjb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1wbGFuLWNvbnRlbnQnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tcGxhbi10aXRsZScpLnRleHRDb250ZW50ID0gYOC5gOC4meC4t+C5ieC4reC4q+C4suC4quC4s+C4q+C4o+C4seC4muC4quC4reC4mTogJHt0b3BpY31gOwoKICAgIGNvbnN0IGh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS04IHRleHQtbGVmdCB0ZXh0LWJhc2UiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24iPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWluZGlnby04MDAgbWItMiBib3JkZXItYi0yIGJvcmRlci1pbmRpZ28tMjAwIHBiLTIiPvCfjq8g4Liq4Lij4Li44Lib4LmB4LiZ4Lin4LiE4Li04LiU4Lir4Lil4Lix4LiBIChLZXkgQ29uY2VwdHMpPC9oMj4KICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHRleHQtZ3JheS04MDAgc3BhY2UteS0xIHBsLTIiPiR7Y29udGVudC5rZXlDb25jZXB0cy5tYXAoaXRlbSA9PiBgPGxpPiR7aXRlbX08L2xpPmApLmpvaW4oJycpfTwvdWw+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIj4KICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1yZWQtODAwIG1iLTIgYm9yZGVyLWItMiBib3JkZXItcmVkLTIwMCBwYi0yIj7imqDvuI8g4LiI4Li44LiU4LiX4Li14LmI4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lih4Lix4LiB4Lic4Li04LiU4Lie4Lil4Liy4LiUPC9oMj4KICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHRleHQtZ3JheS04MDAgc3BhY2UteS0xIHBsLTIiPiR7Y29udGVudC5jb21tb25NaXN0YWtlcy5tYXAoaXRlbSA9PiBgPGxpPiR7aXRlbX08L2xpPmApLmpvaW4oJycpfTwvdWw+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIj4KICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1ncmVlbi04MDAgbWItMiBib3JkZXItYi0yIGJvcmRlci1ncmVlbi0yMDAgcGItMiI+4pyN77iPIOC5guC4iOC4l+C4ouC5jOC4leC4seC4p+C4reC4ouC5iOC4suC4h+C4nuC4o+C5ieC4reC4oeC4p+C4tOC4mOC4teC4l+C4szwvaDI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTYiPiR7Y29udGVudC5zdGVwQnlTdGVwRXhhbXBsZXMubWFwKHAgPT4gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBiZy1ncmVlbi01MCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItZ3JlZW4tMjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guYLguIjguJfguKLguYw6PC9zdHJvbmc+ICR7cC5xdWVzdGlvbn08L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0ibXktMiBib3JkZXItZGFzaGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guKfguLTguJjguLXguJfguLM6PC9zdHJvbmc+PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3aGl0ZXNwYWNlLXByZS13cmFwIHBsLTIiPiR7cC5zb2x1dGlvbn08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtc2VjdGlvbiI+CiAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtYmx1ZS04MDAgbWItMiBib3JkZXItYi0yIGJvcmRlci1ibHVlLTIwMCBwYi0yIj7wn5Gp4oCN8J+PqyDguITguLPguYHguJnguLDguJnguLPguKrguLPguKvguKPguLHguJrguITguKPguLk8L2gyPgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgdGV4dC1ncmF5LTgwMCBzcGFjZS15LTEgcGwtMiI+JHtjb250ZW50LnRlYWNoZXJUaXBzLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9PC91bD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGNvbnRlbnRDb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbY29udGVudENvbnRhaW5lcl0pOwp9Cgphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVF1aXpGb3JTaW5nbGVUb3BpYyhzZWxlY3RlZFRvcGljKSB7CiAgICBjb25zb2xlLmxvZyhg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Liq4Liz4Lir4Lij4Lix4Lia4LiV4Li04Lin4LmA4LiJ4Lie4Liy4Liw4LmA4Lij4Li34LmI4Lit4LiHOiAiJHtzZWxlY3RlZFRvcGljfSJgKTsKCiAgICBjb25zdCByZWZlcmVuY2VJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWZlcmVuY2UtcGRmLXVwbG9hZCcpOwogICAgY29uc3QgcmVmZXJlbmNlRmlsZSA9IHJlZmVyZW5jZUlucHV0LmZpbGVzLmxlbmd0aCA+IDAgPyByZWZlcmVuY2VJbnB1dC5maWxlc1swXSA6IG51bGw7CiAgICBsZXQgcmVmZXJlbmNlUGFydHMgPSBudWxsOwoKICAgIGlmIChyZWZlcmVuY2VGaWxlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVmUmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgcmVmUmVhZGVyLnJlYWRBc0RhdGFVUkwocmVmZXJlbmNlRmlsZSk7CiAgICAgICAgICAgIGNvbnN0IHJlZkJhc2U2NCA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgICAgIHJlZlJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlZlJlYWRlci5yZXN1bHQuc3BsaXQoJywnKVsxXSk7CiAgICAgICAgICAgICAgICByZWZSZWFkZXIub25lcnJvciA9IChlcnJvcikgPT4gcmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlZmVyZW5jZVBhcnRzID0gWwogICAgICAgICAgICAgICAgeyBpbmxpbmVEYXRhOiB7IG1pbWVUeXBlOiByZWZlcmVuY2VGaWxlLnR5cGUsIGRhdGE6IHJlZkJhc2U2NCB9IH0KICAgICAgICAgICAgXTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciByZWFkaW5nIHJlZmVyZW5jZSBmaWxlIGZvciBzaW5nbGUgdG9waWM6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lit4LmI4Liy4LiZ4LmE4Lif4Lil4LmM4Lit4LmJ4Liy4LiH4Lit4Li04LiHIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4LihIHRydWUg4LmA4Lib4LmH4LiZIHBhcmFtZXRlciDguKrguLjguJTguJfguYnguLLguKLguYDguJ7guLfguYjguK3guJrguLHguIfguITguLHguJrguYPguIrguYnguKrguYTguJXguKXguYzguYLguIjguJfguKLguYzguJvguKPguLDguKLguLjguIHguJXguYwKICAgIGdlbmVyYXRlUXVpeihzZWxlY3RlZFRvcGljLCBudWxsLCBudWxsLCByZWZlcmVuY2VQYXJ0cywgdHJ1ZSwgbnVsbCwgbnVsbCwgdHJ1ZSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlRnJvbUJsdWVwcmludChwcmVidWlsdFBhcnRzID0gbnVsbCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5g+C4meC4quC5iOC4p+C4mSA8c2NyaXB0PiDilrzilrzilrwKCmZ1bmN0aW9uIHByb2NlZWRUb05leHRRdWVzdGlvbihhbnN3ZXJEYXRhKSB7CiAgICAvLyAxLiDguYDguIHguYfguJrguITguLPguJXguK3guJrguJfguLXguYjguKrguKHguJrguLnguKPguJPguYzguYHguKXguYnguKcKICAgIHN0dWRlbnRBbnN3ZXJzUGVyUXVlc3Rpb24ucHVzaChhbnN3ZXJEYXRhKTsKICAgIAogICAgLy8gMi4g4LmA4Lil4Li34LmI4Lit4LiZ4LmE4Lib4Lii4Lix4LiH4LiE4Liz4LiW4Liy4Lih4LiC4LmJ4Lit4LiW4Lix4LiU4LmE4LibCiAgICBjdXJyZW50UXVlc3Rpb25JbmRleCsrOwoKICAgIC8vIDMuIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4l+C4s+C4hOC4o+C4muC4l+C4uOC4geC4guC5ieC4reC4q+C4o+C4t+C4reC4ouC4seC4hwogICAgaWYgKGN1cnJlbnRRdWVzdGlvbkluZGV4ID49IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAvLyDguJbguYnguLLguITguKPguJrguYHguKXguYnguKcg4LmD4Lir4LmJ4Liq4Lij4Li44Lib4Lic4LilCiAgICAgICAgZmluYWxpemVQZXJRdWVzdGlvblF1aXooKTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4LiE4Lij4LiaIOC5g+C4q+C5ieC5geC4quC4lOC4h+C4guC5ieC4reC4luC4seC4lOC5hOC4mwogICAgICAgIHJlbmRlclBlclF1ZXN0aW9uVmlldygpOwogICAgfQp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguKPguYnguLLguIcgSFRNTCDguYHguKrguJTguIfguYDguIfguLTguJnguIHguK3guIfguIHguKXguLLguIcKZnVuY3Rpb24gZ2V0Q2VudHJhbFBvdEhUTUwoZ2FtZURhdGEpIHsKICAgIGNvbnN0IHBvdFZhbHVlID0gZ2FtZURhdGEuY2VudHJhbFBvdCB8fCAwOwogICAgY29uc3QgaXNNYXJrZXRNb2RlID0gZ2FtZURhdGEuaXNCbGFja01hcmtldEVuYWJsZWQgPT09IHRydWU7CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LmA4Lib4Li04LiU4LmC4Lir4Lih4LiU4LiV4Lil4Liy4LiU4Lih4Li34LiUIOC5hOC4oeC5iOC4leC5ieC4reC4h+C5geC4quC4lOC4hwogICAgaWYgKCFpc01hcmtldE1vZGUpIHJldHVybiAnJzsKCiAgICAvLyDguJbguYnguLLguIHguK3guIfguIHguKXguLLguIfguYDguJvguYfguJkgMCDguYHguKrguJTguIfguYHguJrguJrguYDguKPguLXguKLguJrguYYKICAgIGlmIChwb3RWYWx1ZSA9PT0gMCkgewogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLWJsYWNrLzIwIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci13aGl0ZS8xMCB0ZXh0LWdyYXktMzAwIHRleHQtc20iPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYWNrLWRvbGxhciI+PC9pPgogICAgICAgICAgICAgICAgPHNwYW4+4LiB4Lit4LiH4LiB4Lil4Liy4LiHOiAwPC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfQoKICAgIC8vIOC4luC5ieC4suC4oeC4teC5gOC4h+C4tOC4meC5g+C4meC4geC4reC4h+C4geC4peC4suC4hyDguYPguKvguYnguYHguKrguJTguIfguYHguJrguJrguKrguLXguJfguK3guIfguYHguKXguLDguKHguLUgQW5pbWF0aW9uCiAgICByZXR1cm4gYAogICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLWdyYWRpZW50LXRvLXIgZnJvbS15ZWxsb3ctNTAwIHRvLWFtYmVyLTYwMCB0ZXh0LXdoaXRlIHB4LTQgcHktMSByb3VuZGVkLWZ1bGwgYm9yZGVyLTIgYm9yZGVyLXllbGxvdy0yMDAgc2hhZG93LWxnIHNoYWRvdy15ZWxsb3ctNTAwLzUwIGFuaW1hdGUtcHVsc2UgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSB0cmFuc2l0aW9uLXRyYW5zZm9ybSBjdXJzb3ItaGVscCIgdGl0bGU9IuC5gOC4h+C4tOC4meC4o+C4suC4h+C4p+C4seC4peC4quC5iOC4p+C4meC5gOC4geC4tOC4meC4iOC4suC4geC4o+C4reC4muC4l+C4teC5iOC5geC4peC5ieC4pyDguIjguLDguJbguLnguIHguJnguLPguKHguLLguKvguLLguKPguYDguJ7guLTguYjguKHguYPguKvguYnguJzguLnguYnguIrguJnguLDguYPguJnguKPguK3guJrguJnguLXguYkhIj4KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zYWNrLWRvbGxhciB0ZXh0LXhsIGFuaW1hdGUtYm91bmNlIj48L2k+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC1sZyBkcm9wLXNoYWRvdy1tZCI+4LiB4Lit4LiH4LiB4Lil4Liy4LiHOiAke3BvdFZhbHVlLnRvTG9jYWxlU3RyaW5nKCl9PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgYDsKfQoKZnVuY3Rpb24gcmVuZGVyQWRtaW5TeW5jRGFzaGJvYXJkKGdhbWVEYXRhLCBpc0FkbWluLCBxdWVzdGlvbkluZGV4VG9TaG93KSB7CiAgICBjb25zdCBwbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KTsKICAgIGNvbnN0IHRvdGFsUGxheWVycyA9IHBsYXllcnMubGVuZ3RoOwogICAgY29uc3QgY3VycmVudFF1ZXN0aW9uSW5kZXggPSBxdWVzdGlvbkluZGV4VG9TaG93OyAKCiAgICBjb25zdCB2YXJpYW50ID0gZ2FtZURhdGEuZ2FtZVZhcmlhbnQgfHwgJ2NsYXNzaWMnOwogICAgCiAgICBjb25zdCBpc0Fub255bW91c01vZGUgPSAodmFyaWFudCA9PT0gJ2Fub255bW91cycgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBpc1JldmVhbEF0RW5kTW9kZSA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBpc1JldmVhbGVkID0gKGdhbWVEYXRhLmlzQW5vbnltb3VzUmV2ZWFsZWQgPT09IHRydWUpOwogICAgY29uc3QgaXNDb21wZXRpdGlvbk1vZGUgPSAodmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJyk7CgogICAgY29uc3QgcXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uczsKICAgIGNvbnN0IGN1cnJlbnRRdWVzdGlvbiA9IHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF07IAogICAgY29uc3QgdG9DaGFyID0gKGluZGV4KSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOwogICAgCiAgICAvLyAxLiDguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJkg4LmB4Lil4Liw4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmD4Lir4Lih4LmICiAgICBjb25zdCBwbGF5ZXJzV2l0aFNjb3JlcyA9IHBsYXllcnMubWFwKHAgPT4gewogICAgICAgIGNvbnN0IGFuc3dlcnNUb0NvbnNpZGVyID0gKHAuYW5zd2VycyB8fCBbXSkuZmlsdGVyKGFucyA9PiB7CiAgICAgICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFucy5xdWVzdGlvbkluZGV4IDw9IGN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOyAKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBsZXQgcmVhbFNjb3JlID0gMDsKICAgICAgICBsZXQgcG9pbnRzID0gMDsKCiAgICAgICAgaWYgKGlzUmV2ZWFsQXRFbmRNb2RlKSB7CiAgICAgICAgICAgIHJlYWxTY29yZSA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbHRlcihhID0+IGEuaXNDb3JyZWN0KS5sZW5ndGg7CiAgICAgICAgICAgIHBvaW50cyA9IGFuc3dlcnNUb0NvbnNpZGVyLnJlZHVjZSgoc3VtLCBhKSA9PiBzdW0gKyAoYS5wb2ludHNBd2FyZGVkIHx8IDApLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWFsU2NvcmUgPSBwLnNjb3JlIHx8IDA7CiAgICAgICAgICAgIHBvaW50cyA9IHAudG90YWxQb2ludHMgfHwgMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIFNUQVJUXSDguIHguLLguKPguITguLPguJnguKfguJMgU3RyZWFrIOC5geC4muC4muC5gOC4guC5ieC4oeC4h+C4p+C4lCAtLS0KICAgICAgICBsZXQgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgCiAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiV4Lix4LmJ4LiH4LmB4LiV4LmI4LiC4LmJ4LitIDAg4LiI4LiZ4LiW4Li24LiH4LiC4LmJ4Lit4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY3VycmVudFF1ZXN0aW9uSW5kZXg7IGkrKykgewogICAgICAgICAgICAvLyDguKvguLLguITguLPguJXguK3guJrguILguK3guIfguILguYnguK3guJfguLXguYggaQogICAgICAgICAgICBjb25zdCBhbnMgPSBhbnN3ZXJzVG9Db25zaWRlci5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbnMpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4teC4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgY29uc3QgaXNDb21ib0JyZWFrZXIgPSAoYW5zLnBvd2VydXBVc2VkICYmIGFucy5wb3dlcnVwVXNlZCAhPT0gJ3dhZ2VyTXVsdGlwbGllcicpIHx8IGFucy51c2VkQnV5VGltZTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbWJvQnJlYWtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBkeW5hbWljU3RyZWFrID0gMDsgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhaysrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7IC8vIOC4leC4reC4muC4nOC4tOC4lCA9IOC4o+C4teC5gOC4i+C5h+C4lQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiE4Liz4LiV4Lit4Lia4LmD4LiZ4LiC4LmJ4Lit4LiX4Li14LmIIGkgKOC4q+C4oeC4lOC5gOC4p+C4peC4si/guYTguKHguYjguYTguJTguYnguJXguK3guJopCiAgICAgICAgICAgICAgICAvLyDguYPguKvguYnguJbguLfguK3guKfguYjguLLguJzguLTguJQg4LmB4Lil4Liw4Lij4Li14LmA4LiL4LmH4LiVIFN0cmVhayDguJfguLHguJnguJfguLUKICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIEVORF0gLS0tCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgLi4ucCwgCiAgICAgICAgICAgIHJlYWxTY29yZTogcmVhbFNjb3JlLAogICAgICAgICAgICB0b3RhbFBvaW50czogcG9pbnRzLAogICAgICAgICAgICBhbnN3ZXJzOiBhbnN3ZXJzVG9Db25zaWRlciwKICAgICAgICAgICAgY29ycmVjdFN0cmVhazogZHluYW1pY1N0cmVhayAvLyDguYPguIrguYnguITguYjguLLguJfguLXguYjguITguLPguJnguKfguJPguYPguKvguKHguYjguJnguLXguYkKICAgICAgICB9OwogICAgfSk7CgogICAgY29uc3QgbWF4UG9pbnRzID0gTWF0aC5tYXgoLi4ucGxheWVyc1dpdGhTY29yZXMubWFwKHAgPT4gcC50b3RhbFBvaW50cyksIC1JbmZpbml0eSk7CiAgICBjb25zdCBtYXhSYXdTY29yZSA9IE1hdGgubWF4KC4uLnBsYXllcnNXaXRoU2NvcmVzLm1hcChwID0+IHAucmVhbFNjb3JlKSwgLUluZmluaXR5KTsKCiAgICBjb25zdCBpc01hcmtldE1vZGUgPSBnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyAyLiDguIjguLHguJTguYDguKPguLXguKLguIcgKFNvcnRpbmcpCiAgICBjb25zdCBzb3J0ZWRQbGF5ZXJzID0gWy4uLnBsYXllcnNXaXRoU2NvcmVzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJoKICAgIGxldCBjdXJyZW50UmFuayA9IDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZFBsYXllcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgY29uc3QgcHJldiA9IHNvcnRlZFBsYXllcnNbaSAtIDFdOwogICAgICAgICAgICBjb25zdCBjdXJyID0gc29ydGVkUGxheWVyc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBpc1RpZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICAgICAgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWlzVGllZCkgewogICAgICAgICAgICAgICAgY3VycmVudFJhbmsgPSBpICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzb3J0ZWRQbGF5ZXJzW2ldLmRpc3BsYXlSYW5rID0gY3VycmVudFJhbms7CiAgICB9CiAgICAKICAgIC8vIOC4quC5iOC4p+C4meC5geC4quC4lOC4h+C5gOC4ieC4peC4ogogICAgbGV0IGN1cnJlbnRBbnN3ZXJEaXNwbGF5SFRNTCA9ICcnOwogICAgY29uc3Qgc2hvdWxkU2hvd0Fuc3dlciA9ICFpc0NvbXBldGl0aW9uTW9kZSAmJiAhKGlzQW5vbnltb3VzTW9kZSAmJiBnYW1lRGF0YS5zaG93QW5zd2VySW5Bbm9ueW1vdXMgPT09IGZhbHNlKTsKCiAgICBpZiAoY3VycmVudFF1ZXN0aW9uICYmIHNob3VsZFNob3dBbnN3ZXIpIHsKICAgICAgICBsZXQgY29ycmVjdEFuc3dlclRleHQgPSAnJzsKICAgICAgICBsZXQgY29ycmVjdEFuc3dlckxhYmVsID0gJyc7CiAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gY3VycmVudFF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAgICAgCiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScgJiYgY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMpIHsKICAgICAgICAgICAgY29uc3QgaWR4ID0gY3VycmVudFF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXJJbmRleDsKICAgICAgICAgICAgY29ycmVjdEFuc3dlclRleHQgPSBjdXJyZW50UXVlc3Rpb24ub3B0aW9uc1tpZHhdOwogICAgICAgICAgICBjb3JyZWN0QW5zd2VyTGFiZWwgPSB0b0NoYXIoaWR4KSArICcuJzsKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgIGNvbnN0IGlzVHJ1ZSA9IChTdHJpbmcoY3VycmVudFF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIpLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJyk7CiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJUZXh0ID0gaXNUcnVlID8gJ+C5g+C4iuC5iCAvIOC4luC4ueC4gScgOiAn4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUJzsKICAgICAgICAgICAgY29ycmVjdEFuc3dlckxhYmVsID0gaXNUcnVlID8gJ+C4gS4nIDogJ+C4gi4nOwogICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgY29ycmVjdEFuc3dlclRleHQgPSBjdXJyZW50UXVlc3Rpb24uY29ycmVjdFJlc3BvbnNlIHx8ICctJzsKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgICAgICBjb3JyZWN0QW5zd2VyVGV4dCA9IGN1cnJlbnRRdWVzdGlvbi5pZGVhbEFuc3dlciB8fCAnLSc7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29ycmVjdEFuc3dlclRleHQpIHsKICAgICBjdXJyZW50QW5zd2VyRGlzcGxheUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbXktNCBweS00IGJnLWJsYWNrLzIwIHJvdW5kZWQtbGcgc2hhZG93LWlubmVyIHJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xMS8xMiBteC1hdXRvIiBzdHlsZT0iYm9yZGVyLXRvcDogMnB4IGRhc2hlZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMyk7Ij48L2Rpdj4KCiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIHRleHQteWVsbG93LTMwMCBtdC0zIGZvbnQtc2VtaWJvbGQiPgogICAgICAgICAgICAgICAg4LmA4LiJ4Lil4Lii4LiE4Liz4LiV4Lit4Lia4LiC4LmJ4Lit4LiX4Li14LmIICR7Y3VycmVudFF1ZXN0aW9uSW5kZXggKyAxfToKICAgICAgICAgICAgPC9wPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgZ2FwLTMgbXQtMSI+CiAgICAgICAgICAgICAgICA8cCBpZD0ibWFpbi1jb3JyZWN0LWFuc3dlci1kaXNwbGF5IiBjbGFzcz0idGV4dC00eGwgZm9udC1ib2xkIHRleHQtd2hpdGUiPgogICAgICAgICAgICAgICAgICAgICR7Y29ycmVjdEFuc3dlckxhYmVsfSAke2NvcnJlY3RBbnN3ZXJUZXh0fQogICAgICAgICAgICAgICAgPC9wPgoKICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImVkaXQtYW5zd2VyLWRhc2hib2FyZC1idG4iIGNsYXNzPSJiZy1ncmF5LTcwMCBob3ZlcjpiZy15ZWxsb3ctNTAwIGhvdmVyOnRleHQtYmxhY2sgdGV4dC1ncmF5LTMwMCBwLTIgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsIHNoYWRvdy1sZyBib3JkZXIgYm9yZGVyLWdyYXktNTAwIiB0aXRsZT0i4LmA4LiJ4Lil4Lii4Lic4Li04LiUPyDguYHguIHguYnguYTguILguJfguLHguJnguJfguLUiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtd3JlbmNoIj48L2k+CiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTExLzEyIG14LWF1dG8gbXQtMyIgc3R5bGU9ImJvcmRlci10b3A6IDJweCBkYXNoZWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwp9CiAgICB9CgogICAgY29uc3Qgc2NvcmVzSHRtbCA9IHNvcnRlZFBsYXllcnMubWFwKChwLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IHJlYWxTY29yZVNvRmFyID0gcC5yZWFsU2NvcmU7CiAgICAgICAgY29uc3QgcG9pbnRzVmFsdWUgPSBwLnRvdGFsUG9pbnRzOwogICAgICAgIGNvbnN0IGN1cnJlbnRUdXJuQW5zd2VyID0gKHAuYW5zd2VycyB8fCBbXSkuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IHF1ZXN0aW9uSW5kZXhUb1Nob3cpOwogICAgICAgIGNvbnN0IHRvdGFsQW5zd2Vyc1NvRmFyID0gcC5hbnN3ZXJzLmxlbmd0aDsKCiAgICAgICAgLy8gLS0tIDEuIOC4m+C5ieC4suC4oiBQb3QgQm9udXMgKOC4m+C4o+C4seC4muC5g+C4q+C5ieC5gOC4lOC5iOC4meC4guC4tuC5ieC4mSkgLS0tCiAgICAgICAgbGV0IHBvdEJvbnVzSFRNTCA9ICcnOwogICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlciAmJiBjdXJyZW50VHVybkFuc3dlci5wb3RCb251cyA+IDApIHsKICAgICAgICAgICAgcG90Qm9udXNIVE1MID0gYDxkaXYgY2xhc3M9InRleHQtWzEwcHhdIGJnLXllbGxvdy0zMDAgdGV4dC1ibGFjayBweC0xLjUgcm91bmRlZC1mdWxsIGZvbnQtYm9sZCBpbmxpbmUtYmxvY2sgYm9yZGVyIGJvcmRlci15ZWxsb3ctNTAwIHNoYWRvdy1zbSBtdC0wLjUiIHRpdGxlPSLguKrguYjguKfguJnguYHguJrguYjguIfguIjguLLguIHguIHguK3guIfguIHguKXguLLguIciPiske2N1cnJlbnRUdXJuQW5zd2VyLnBvdEJvbnVzfSBQb3Q8L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIDIuIOC5hOC4reC4hOC4reC4meC4quC4luC4suC4meC4sCAtLS0KICAgICAgICBsZXQgdHVyblN0YXR1c0ljb25zSFRNTCA9ICcnOwogICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlcikgewogICAgICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIud2FzRm9yY2VkKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmC4LiU4LiZ4Lia4Lix4LiH4LiE4Lix4Lia4Lih4Lix4LmI4LiZ4LmD4LiIIj7wn5G7PC9zcGFuPic7CiAgICAgICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlci53YXNKaW54ZWQpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYLguJTguJnguITguLPguKrguLLguJsiPvCfmIg8L3NwYW4+JzsKICAgICAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyLnVzZWRCdXlUaW1lKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmD4LiK4LmJ4LmA4Lin4Lil4LiyIj7ij7M8L3NwYW4+JzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJyZW50VHVybkFuc3dlci5wb3dlcnVwVXNlZDsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGljb25zID0geyAncG9sbCc6ICfwn5OKJywgJ2N1dE9uZSc6ICfinILvuI8nLCAnaW5zdXJhbmNlJzogJ/Cfm6HvuI8nLCAnZmlmdHlGaWZ0eSc6ICfwn4yXJywgJ3dhZ2VyTXVsdGlwbGllcic6ICfwn5KwJywgJ3NlY29uZENoYW5jZSc6ICfwn5SBJywgJ3JldmVhbE9wdGlvbnMnOiAn8J+Rge+4jycgfTsKICAgICAgICAgICAgICAgIGlmIChpY29uc1tpdGVtXSkgdHVyblN0YXR1c0ljb25zSFRNTCArPSBgPHNwYW4gdGl0bGU9IuC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSI+JHtpY29uc1tpdGVtXX08L3NwYW4+YDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV0IHN0YXR1c0ljb25IVE1MID0gJyc7IAogICAgICAgIGNvbnN0IGN1cnJlbnRTdHJlYWsgPSBwLmNvcnJlY3RTdHJlYWsgfHwgMDsgCiAgICAgICAgY29uc3QgdHVyblVzZWRCdXlUaW1lID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIudXNlZEJ1eVRpbWU7CiAgICAgICAgY29uc3QgdHVyblVzZWRJdGVtID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgIT09ICd3YWdlck11bHRpcGxpZXInOwoKICAgICAgICAvLyDguYTguK3guITguK3guJnguYTguJ8gKEZpcmUpCiAgICAgICAgbGV0IGZpcmVJY29uSFRNTCA9ICcnOwogICAgICAgIGlmICghaXNDb21wZXRpdGlvbk1vZGUgJiYgY3VycmVudFN0cmVhayA+PSAzICYmICF0dXJuVXNlZEJ1eVRpbWUgJiYgIXR1cm5Vc2VkSXRlbSkgewogICAgICAgICAgICBmaXJlSWNvbkhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtb3JhbmdlLTUwMCBhbmltYXRlLXB1bHNlIGZvbnQtYm9sZCB0ZXh0LXhzIG1sLTEgd2hpdGVzcGFjZS1ub3dyYXAgZHJvcC1zaGFkb3ctc20gZmlsdGVyIj7wn5SleCR7Y3VycmVudFN0cmVha308L3NwYW4+YDsKICAgICAgICB9CgogICAgICAgIC8vIOC5hOC4reC4hOC4reC4meC4oeC4h+C4geC4uOC4ji/guJTguLLguKcKICAgICAgICBpZiAoIWlzQ29tcGV0aXRpb25Nb2RlICYmIHRvdGFsQW5zd2Vyc1NvRmFyID4gMCkgewogICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAocG9pbnRzVmFsdWUgPT09IG1heFBvaW50cyAmJiBtYXhQb2ludHMgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTQwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiIHRpdGxlPSLguYDguIjguYnguLLguJ7guYjguK3guJXguKXguLLguJTguKHguLfguJQiPvCfkZE8L3NwYW4+JzsKICAgICAgICAgICAgICAgIGlmIChyZWFsU2NvcmVTb0ZhciA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtYmx1ZS0zMDAgbWwtMSB0ZXh0LWxnIGRyb3Atc2hhZG93LW1kIiB0aXRsZT0i4LmA4LiX4Lie4Lin4Li04LiK4Liy4LiB4Liy4LijIj7wn46TPC9zcGFuPic7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIGNvbnN0IGlzUGVyZmVjdFNvRmFyID0gKHAucmVhbFNjb3JlID09PSAocXVlc3Rpb25JbmRleFRvU2hvdyArIDEpKTsKICAgICAgICAgICAgICAgaWYgKGlzUGVyZmVjdFNvRmFyKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTQwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiPuKtkDwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0dXNJY29uSFRNTCA9PT0gJycgJiYgcG9pbnRzVmFsdWUgPCAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTUwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiPuKaoO+4jzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAtLS0gMy4g4LiB4Liz4Lir4LiZ4LiU4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmB4Lia4Lia4LmA4LiC4LmJ4LihIChWaXZpZCBDb2xvcnMpIC0tLQogICAgICAgIGxldCBoaWdobGlnaHRDbGFzcyA9ICdiZy13aGl0ZSBib3JkZXItbC00IGJvcmRlci1ncmF5LTMwMCB0ZXh0LWdyYXktODAwJzsgLy8g4Liq4Li14LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZICjguILguLLguKcpCiAgICAgICAgbGV0IHN1YlRleHRDb2xvciA9ICd0ZXh0LWdyYXktNTAwJzsgLy8g4Liq4Li14LiC4Lit4LiH4LiK4Li34LmI4Lit4Lij4Lit4LiHIChOaWNrbmFtZSkKICAgICAgICBsZXQgaXNXYWdlckZhaWwgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFpc0NvbXBldGl0aW9uTW9kZSkgeyAKICAgICAgICAgICAgY29uc3QgbGF0ZXN0QW5zd2VyID0gKHAuYW5zd2VycyB8fCBbXSkuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IGN1cnJlbnRRdWVzdGlvbkluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChsYXRlc3RBbnN3ZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IGxhdGVzdEFuc3dlci5pc0NvcnJlY3Q7CiAgICAgICAgICAgICAgICBjb25zdCBpc0NvbmZpZGVudCA9IChsYXRlc3RBbnN3ZXIud2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IGxhdGVzdEFuc3dlci53YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gbGF0ZXN0QW5zd2VyLnBvd2VydXBVc2VkOwoKICAgICAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7IAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguJTguLTguKHguJ7guLHguJnguJbguLnguIE6IOC4quC4teC5gOC4q+C4peC4t+C4reC4h+C4l+C4reC4h+C5gOC4guC5ieC4oSAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LiU4LizKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy15ZWxsb3ctNDAwIGJvcmRlci1sLTQgYm9yZGVyLXllbGxvdy02MDAgdGV4dC1ibGFjayBmb250LWJvbGQgc2hhZG93LW1kJzsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LXllbGxvdy05MDAvNzAnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguJTguLTguKHguJ7guLHguJnguJzguLTguJQ6IOC4quC4teC5geC4lOC4h+C4quC4lCAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LiC4Liy4LinKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy1yZWQtNjAwIGJvcmRlci1sLTQgYm9yZGVyLXJlZC04MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgc2hhZG93LW1kJzsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LXJlZC0yMDAnOwogICAgICAgICAgICAgICAgICAgICAgICBpc1dhZ2VyRmFpbCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25maWRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiW4Li54LiBK+C4oeC4seC5iOC4meC5g+C4iDog4Liq4Li14LmA4LiC4Li14Lii4Lin4LmA4LiC4LmJ4LihICjguJXguLHguKfguKvguJnguLHguIfguKrguLfguK3guILguLLguKcpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLWdyZWVuLTYwMCBib3JkZXItbC00IGJvcmRlci1ncmVlbi04MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgc2hhZG93LW1kJzsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViVGV4dENvbG9yID0gJ3RleHQtZ3JlZW4tMjAwJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyDguJbguLnguIHguYDguInguKLguYY6IOC4quC4teC5gOC4guC4teC4ouC4p+C4reC5iOC4reC4mSAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LmA4LiC4Li14Lii4Lin4LmA4LiC4LmJ4LihKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy1ncmVlbi0yMDAgYm9yZGVyLWwtNCBib3JkZXItZ3JlZW4tNTAwIHRleHQtZ3JlZW4tOTAwJzsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViVGV4dENvbG9yID0gJ3RleHQtZ3JlZW4tNzAwJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbmZpZGVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyDguJzguLTguJQr4Lih4Lix4LmI4LiZ4LmD4LiIOiDguKrguLXguKrguYnguKHguYHguJTguIfguYDguILguYnguKEgKOC4leC4seC4p+C4q+C4meC4seC4h+C4quC4t+C4reC4guC4suC4pykKICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q2xhc3MgPSAnYmctb3JhbmdlLTYwMCBib3JkZXItbC00IGJvcmRlci1vcmFuZ2UtODAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHNoYWRvdy1tZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LW9yYW5nZS0yMDAnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4nOC4tOC4lOC5gOC4ieC4ouC5hjog4Liq4Li14LmB4LiU4LiH4Lit4LmI4Lit4LiZICjguJXguLHguKfguKvguJnguLHguIfguKrguLfguK3guYHguJTguIfguYDguILguYnguKEpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLXJlZC0xMDAgYm9yZGVyLWwtNCBib3JkZXItcmVkLTQwMCB0ZXh0LXJlZC05MDAnOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJUZXh0Q29sb3IgPSAndGV4dC1yZWQtNzAwJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguYTguKHguYjguJXguK3guJov4Lir4Lih4LiU4LmA4Lin4Lil4LiyOiDguKrguLXguYDguJfguLIgKOC4leC4seC4p+C4q+C4meC4seC4h+C4quC4t+C4reC5gOC4l+C4suC5gOC4guC5ieC4oSkKICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLWdyYXktMTAwIGJvcmRlci1sLTQgYm9yZGVyLWdyYXktNDAwIHRleHQtZ3JheS01MDAnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIC0tLSA0LiDguIjguLHguJTguIHguLLguKPguIrguLfguYjguK0gKE5hbWUgRGlzcGxheSkgLS0tCiAgICAgICAgY29uc3QgcmVhbE5hbWUgPSBwLm5hbWU7CiAgICAgICAgY29uc3Qgbmlja25hbWUgPSBnYW1lRGF0YS5wbGF5ZXJOaWNrbmFtZXNbcC5uYW1lXSB8fCAnPz8/JzsKICAgICAgICBsZXQgbmFtZVRvU2hvdyA9IHJlYWxOYW1lOwogICAgICAgIGxldCBzdWJOYW1lVG9TaG93ID0gJyc7CgogICAgICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgICAgIGlmIChpc0Fub255bW91c01vZGUgJiYgIWlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgIG5hbWVUb1Nob3cgPSBuaWNrbmFtZTsKICAgICAgICAgICAgICAgIHN1Yk5hbWVUb1Nob3cgPSBgKCR7bmlja25hbWV9KWA7IAogICAgICAgICAgICAgICAgaWYoaXNXYWdlckZhaWwpIHN1Yk5hbWVUb1Nob3cgKz0gYCBbJHtyZWFsTmFtZX1dYDsgCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBbm9ueW1vdXNNb2RlICYmIGlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgIHN1Yk5hbWVUb1Nob3cgPSBgKCR7bmlja25hbWV9KWA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLS0tIDUuIOC4iOC4seC4lOC4geC4suC4o+C4hOC4sOC5geC4meC4mSAoU2NvcmUgRGlzcGxheSkgLS0tCiAgICAgICAgY29uc3QgcG9pbnRzRGlzcGxheSA9IHBvaW50c1ZhbHVlID49IDAgPyBgKyR7KHBvaW50c1ZhbHVlKS50b0xvY2FsZVN0cmluZygpfWAgOiBgJHsocG9pbnRzVmFsdWUpLnRvTG9jYWxlU3RyaW5nKCl9YDsKICAgICAgICAKICAgICAgICBjb25zdCBzY29yZUJsb2NrSFRNTCA9ICFpc0NvbXBldGl0aW9uTW9kZSA/IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1yaWdodCBmbGV4LXNocmluay0wIG1sLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1ib2xkIHRleHQtbGcgbGVhZGluZy1ub25lIj4ke3JlYWxTY29yZVNvRmFyfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyBvcGFjaXR5LTkwIGZvbnQtbWVkaXVtIG10LTAuNSI+KCR7cG9pbnRzRGlzcGxheX0gUCk8L2Rpdj4KICAgICAgICAgICAgICAgICR7cG90Qm9udXNIVE1MfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgIDogJyc7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBwLTIuNSBtYi0yIHJvdW5kZWQtbGcgc2hhZG93LXNtIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCAke2hpZ2hsaWdodENsYXNzfSI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1zaHJpbmstMCB3LTcgaC03IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtZnVsbCBiZy1ibGFjay8yMCBmb250LWJvbGQgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cC5kaXNwbGF5UmFua30KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBtaW4tdy0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXNtIHNtOnRleHQtYmFzZSB0cnVuY2F0ZSBibG9jayIgdGl0bGU9IiR7bmFtZVRvU2hvd30iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7bmFtZVRvU2hvd30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7c3RhdHVzSWNvbkhUTUx9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2ZpcmVJY29uSFRNTH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSB0ZXh0LXhzICR7c3ViVGV4dENvbG9yfSB0cnVuY2F0ZSBmb250LW5vcm1hbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3N1Yk5hbWVUb1Nob3cgPyBgPHNwYW4gY2xhc3M9Im1yLTEiPiR7c3ViTmFtZVRvU2hvd308L3NwYW4+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0dXJuU3RhdHVzSWNvbnNIVE1MfQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICR7c2NvcmVCbG9ja0hUTUx9CgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgY29uc3QgcGVyUXVlc3Rpb25IdG1sID0gcXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoKGlzUmV2ZWFsQXRFbmRNb2RlICYmIGluZGV4ID4gY3VycmVudFF1ZXN0aW9uSW5kZXgpIHx8IGlzQ29tcGV0aXRpb25Nb2RlKSB7IHJldHVybiAnJzsgfQogICAgICAgIGNvbnN0IGNvcnJlY3RDb3VudCA9IHBsYXllcnNXaXRoU2NvcmVzLmZpbHRlcihwID0+IHAuYW5zd2VycyAmJiBwLmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IGluZGV4ICYmIGFucy5pc0NvcnJlY3QpKS5sZW5ndGg7CiAgICAgICAgY29uc3QgaXNDdXJyZW50UXVlc3Rpb24gPSAoaW5kZXggPT09IGN1cnJlbnRRdWVzdGlvbkluZGV4KTsgCiAgICAgICAgY29uc3QgY2FyZENsYXNzZXMgPSBpc0N1cnJlbnRRdWVzdGlvbiAKICAgICAgICAgICAgPyAncC0yIHJvdW5kZWQtbWQgYmcteWVsbG93LTQwMCB0ZXh0LWJsYWNrIHJpbmctMiByaW5nLXllbGxvdy0yMDAgc2hhZG93LWxnJyAKICAgICAgICAgICAgOiAncC0yIGJnLWJsYWNrLzEwIHJvdW5kZWQtbWQnOwogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9IiR7Y2FyZENsYXNzZXN9Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtc20iPuC4guC5ieC4rSAke2luZGV4ICsgMX06PC9wPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMiPiR7Y29ycmVjdENvdW50fSAvICR7dG90YWxQbGF5ZXJzfSDguITguJkg4LiV4Lit4Lia4LiW4Li54LiBPC9wPgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgbGV0IGNvbnRyb2xCdXR0b25IdG1sID0gJyc7CiAgICBsZXQgYWRtaW5IZWFkZXJDb250cm9scyA9ICcnOwogICAgCiAgICBpZiAoaXNBZG1pbikgewogICAgICAgIGNvbnN0IGlzQ2xhc3NpY0xhc3QgPSAodmFyaWFudCA9PT0gJ2NsYXNzaWMnICYmIGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKTsKICAgICAgICBjb25zdCBpc1JldmVhbExhc3QgPSAoaXNSZXZlYWxBdEVuZE1vZGUgJiYgZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSk7CiAgICAgICAgY29uc3QgaXNDb21wZXRpdGlvbkxhc3QgPSAodmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJyAmJiBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSk7CiAgICAgICAgY29uc3QgaXNBbm9ueW1vdXNMYXN0ID0gKGlzQW5vbnltb3VzTW9kZSAmJiAhaXNSZXZlYWxBdEVuZE1vZGUgJiYgZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpOwogICAgICAgIAogICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICBpZiAoaXNSZXZlYWxMYXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNBbm9ueW1vdXNNb2RlICYmICFpc1JldmVhbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGRpdiBjbGFzcz0iZmxleCBnYXAtNCI+PGJ1dHRvbiBpZD0icmV2ZWFsLW5hbWVzLWJ0biIgY2xhc3M9InctMS8yIGJnLXllbGxvdy01MDAgaG92ZXI6YmcteWVsbG93LTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj48aSBjbGFzcz0iZmFzIGZhLWV5ZSI+PC9pPiDguYDguJvguLTguJTguYDguJzguKLguIrguLfguYjguK3guIjguKPguLTguIc8L2J1dHRvbj48YnV0dG9uIGlkPSJuZXh0LXN5bmMtcXVlc3Rpb24tYnRuIiBjbGFzcz0idy0xLzIgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LiU4Li5IFBvZGl1bSA8aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSI+PC9pPjwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xCdXR0b25IdG1sID0gYDxidXR0b24gaWQ9Im5leHQtc3luYy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LiU4Li5IFBvZGl1bSA8aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSI+PC9pPjwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250cm9sQnV0dG9uSHRtbCA9IGA8YnV0dG9uIGlkPSJuZXh0LXJldmlldy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LmA4LiJ4Lil4Lii4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT48L2J1dHRvbj5gOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc0NsYXNzaWNMYXN0IHx8IGlzQ29tcGV0aXRpb25MYXN0IHx8IGlzQW5vbnltb3VzTGFzdCkgeyAKICAgICAgICAgICAgIGlmIChpc0Fub255bW91c01vZGUgJiYgIWlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgICBjb250cm9sQnV0dG9uSHRtbCA9IGA8ZGl2IGNsYXNzPSJmbGV4IGdhcC00Ij48YnV0dG9uIGlkPSJyZXZlYWwtbmFtZXMtYnRuIiBjbGFzcz0idy0xLzIgYmcteWVsbG93LTUwMCBob3ZlcjpiZy15ZWxsb3ctNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtNiByb3VuZGVkLWxnIHRleHQteGwiPjxpIGNsYXNzPSJmYXMgZmEtZXllIj48L2k+IOC5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4reC4iOC4o+C4tOC4hzwvYnV0dG9uPjxidXR0b24gaWQ9Im5leHQtc3luYy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LTEvMiBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guJTguLkgUG9kaXVtIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5Ij48L2k+PC9idXR0b24+PC9kaXY+YDsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGJ1dHRvbiBpZD0ibmV4dC1zeW5jLXF1ZXN0aW9uLWJ0biIgY2xhc3M9InctZnVsbCBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guJTguLkgUG9kaXVtIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5Ij48L2k+PC9idXR0b24+YDsKICAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGJ1dHRvbiBpZD0ibmV4dC1zeW5jLXF1ZXN0aW9uLWJ0biIgY2xhc3M9InctZnVsbCBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guILguYnguK3guJXguYjguK3guYTguJsgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCI+PC9pPjwvYnV0dG9uPmA7CiAgICAgICAgfQogICAgICAgIGFkbWluSGVhZGVyQ29udHJvbHMgPSBgPGJ1dHRvbiBpZD0iZW5kLXN5bmMtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIHNocmluay0wIj7guIjguJrguYDguIHguKE8L2J1dHRvbj5gOwogICAgfQoKICAgIGNvbnN0IHN1bW1hcnlDb2x1bW5IVE1MID0gKGlzQ29tcGV0aXRpb25Nb2RlIHx8IChpc0Fub255bW91c01vZGUgJiYgIWdhbWVEYXRhLnNob3dBbnN3ZXJJbkFub255bW91cykpID8gJycgOiBgPGRpdiBjbGFzcz0ibWQ6Y29sLXNwYW4tMiI+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4Lij4Liy4Lii4LiC4LmJ4LitPC9oND48ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0yIHNtOmdyaWQtY29scy0zIGxnOmdyaWQtY29scy00IGdhcC0yIj4ke3BlclF1ZXN0aW9uSHRtbH08L2Rpdj48L2Rpdj5gOwogICAgY29uc3Qgc2NvcmVDb2x1bW5DbGFzcyA9IChpc0NvbXBldGl0aW9uTW9kZSB8fCAoaXNBbm9ueW1vdXNNb2RlICYmICFnYW1lRGF0YS5zaG93QW5zd2VySW5Bbm9ueW1vdXMpKSA/ICdtZDpjb2wtc3Bhbi0zJyA6ICdtZDpjb2wtc3Bhbi0xJzsKICAgIAogICAgY29uc3QgcG90SFRNTCA9IGdldENlbnRyYWxQb3RIVE1MKGdhbWVEYXRhKTsgCgogICAgY29uc3QgZGFzaGJvYXJkSHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTYgZmxleCBmbGV4LWNvbCBoLWZ1bGwiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgbWItMiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQiPkRhc2hib2FyZDogJHtnYW1lRGF0YS5zaHVmZmxlZFF1aXoudG9waWN9PC9oMj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmctd2hpdGUvMjAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LWJhc2UgZm9udC1tb25vIiB0aXRsZT0i4Lij4Lir4Lix4Liq4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmA4LiB4LihIj4KICAgICAgICAgICAgICAgICAgICAgICAgUElOOiA8c3Ryb25nIGNsYXNzPSJmb250LWJvbGQiPiR7Z2FtZURhdGEucGlufTwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAke3BvdEhUTUx9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICR7YWRtaW5IZWFkZXJDb250cm9sc30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICR7Y3VycmVudEFuc3dlckRpc3BsYXlIVE1MfQogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMyBnYXAtNiBmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIHByLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iJHtzY29yZUNvbHVtbkNsYXNzfSI+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4LiE4Liw4LmB4LiZ4LiZICjguKPguLLguKLguJrguLjguITguITguKUpPC9oND48ZGl2IGNsYXNzPSJzcGFjZS15LTEgdGV4dC1sZyI+JHtzY29yZXNIdG1sIHx8ICc8cCBjbGFzcz0idGV4dC1zbSI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZPC9wPid9PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICAke3N1bW1hcnlDb2x1bW5IVE1MfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICR7aXNBZG1pbiA/IGA8ZGl2IGNsYXNzPSJtdC00IHB0LTQgYm9yZGVyLXQgYm9yZGVyLXdoaXRlLzIwIj4ke2NvbnRyb2xCdXR0b25IdG1sfTwvZGl2PmAgOiAnJ30KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGRhc2hib2FyZEh0bWw7CiAgICAKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgewogICAgICAgIGNvbnN0IGFuc3dlckRpc3BsYXlFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tY29ycmVjdC1hbnN3ZXItZGlzcGxheScpOwogICAgICAgIGlmIChhbnN3ZXJEaXNwbGF5RWxlbWVudCkgeyBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFthbnN3ZXJEaXNwbGF5RWxlbWVudF0pOyB9CiAgICB9CgogICAgaWYgKGlzQWRtaW4pIHsKICAgICAgICBjb25zdCBuZXh0U3luY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXN5bmMtcXVlc3Rpb24tYnRuJyk7CiAgICAgICAgaWYgKG5leHRTeW5jQnRuKSB7CiAgICAgICAgICAgIG5leHRTeW5jQnRuLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsUSA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIGlmICghaXNSZXZlYWxBdEVuZE1vZGUgJiYgbmV4dEluZGV4IDwgdG90YWxRKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4OiBuZXh0SW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGlzcGxheWVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgICAgICAgICAgICAgICAgICAgICBzY29yZXNDYWxjdWxhdGVkOiBmYWxzZSAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgY29uc3QgbmV4dFJldmlld0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXJldmlldy1xdWVzdGlvbi1idG4nKTsKICAgICAgICBpZiAobmV4dFJldmlld0J0bikgewogICAgICAgICAgICBuZXh0UmV2aWV3QnRuLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IAogICAgICAgICAgICAgICAgICAgIHJldmlld1F1ZXN0aW9uSW5kZXg6IGluY3JlbWVudCgxKSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldmVhbC1uYW1lcy1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpLCB7IGlzQW5vbnltb3VzUmV2ZWFsZWQ6IHRydWUgfSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgZW5kQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1zeW5jLWdhbWUtYnRuJyk7CiAgICAgICAgaWYgKGVuZEJ0bikgewogICAgICAgICAgICBlbmRCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oICfguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguIjguJrguYDguIHguKHguJnguLXguYnguIHguYjguK3guJnguYDguKfguKXguLLguK3guLHguJnguITguKfguKM/JywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgkKCWNvbnN0IGVkaXRBbnNEYXNoQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtYW5zd2VyLWRhc2hib2FyZC1idG4nKTsKICAgICAgICBpZiAoZWRpdEFuc0Rhc2hCdG4pIHsKICAgICAgICAgICAgZWRpdEFuc0Rhc2hCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRRID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1tnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICBjb25zdCBxVHlwZSA9IGN1cnJlbnRRLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAgICAgICAgICAgICBjb25zdCBpc1Nob3J0QW5zd2VyID0gKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpOwoKICAgICAgICAgICAgICAgIGlmIChpc1Nob3J0QW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LiB4Lij4LiT4Li14LmA4LiV4Li04Lih4LiE4LizOiAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvcnJlY3RUZXh0ID0gcHJvbXB0KGDguYDguInguKXguKLguJvguLHguIjguIjguLjguJrguLHguJnguITguLfguK0gIiR7Y3VycmVudFEuaWRlYWxBbnN3ZXJ9IlxuXG7guIHguKPguLjguJPguLLguIHguKPguK3guIEgIuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyIg4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4LijOmApOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXdDb3JyZWN0VGV4dCAhPT0gbnVsbCAmJiBuZXdDb3JyZWN0VGV4dC50cmltKCkgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVtZXJnZW5jeUFuc3dlckZpeChuZXdDb3JyZWN0VGV4dC50cmltKCksIGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC4iuC5ieC4reC4ouC4quC5jDogKOC5geC4geC5ieC5hOC4guC4guC5ieC4reC4hOC4p+C4suC4oSArIOC4quC4ueC4leC4o+C4hOC4s+C4meC4p+C4kykKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb3JyZWN0U3RyID0gcHJvbXB0KCLguYDguInguKXguKLguJzguLTguJTguYPguIrguYjguYTguKvguKE/IOC4geC4o+C4uOC4k+C4suC4o+C4sOC4muC4uOC4leC4seC4p+C5gOC4peC4giBJbmRleCDguILguK3guIfguILguYnguK3guJfguLXguYjguJbguLnguIHguIjguKPguLTguIcgKDE94LiBLCAyPeC4giwgMz3guIQsIDQ94LiHKToiKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAobmV3Q29ycmVjdFN0ciAhPT0gbnVsbCAmJiBuZXdDb3JyZWN0U3RyLnRyaW0oKSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXRWYWwgPSBwYXJzZUludChuZXdDb3JyZWN0U3RyLnRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGlucHV0VmFsKSAmJiBpbnB1dFZhbCA+PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguYHguJvguKXguIfguIjguLLguIEgMS1iYXNlZCAo4Lih4LiZ4Li44Lip4Lii4LmMKSDguYDguJvguYfguJkgMC1iYXNlZCAo4LiE4Lit4Lih4Lie4Li04Lin4LmA4LiV4Lit4Lij4LmMKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LmA4LiK4LmI4LiZIOC4geC4o+C4reC4gSAxICjguIEpIC0+IOC4quC5iOC4h+C5hOC4myAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguIHguKPguK3guIEgMiAo4LiCKSAtPiDguKrguYjguIfguYTguJsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxJbmRleCA9IGlucHV0VmFsIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVtZXJnZW5jeUFuc3dlckZpeChmaW5hbEluZGV4LCBnYW1lRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiB4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHICjguYDguIrguYjguJkgMSwgMiwgMywgNCkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CgkKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVQYXJhbGxlbEZyb21CYW5rKG9yaWdpbmFsUXVpekRhdGEpIHsKICAgIGNvbnN0IHJlc3VsdHNDb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtdGFiLWNvbnRlbnQnKTsKICAgIGNvbnN0IHF1aXp6ZXNMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtcXVpenplcy1saXN0Jyk7CiAgICAKICAgIHF1aXp6ZXNMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIGNvbnN0IGxvYWRlckh0bWwgPSBgCiAgICAgICAgPGRpdiBpZD0idGVtcC1sb2FkZXItcmVzdWx0cyIgY2xhc3M9InRleHQtY2VudGVyIHB5LTE2Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2PgogICAgICAgICAgICA8cCBpZD0idGVtcC1sb2FkZXItdGV4dC1yZXN1bHRzIiBjbGFzcz0ibXQtNCB0ZXh0LWdyYXktNjAwIj7guIHguLPguKXguLHguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguILguYnguK3guKrguK3guJogIiR7b3JpZ2luYWxRdWl6RGF0YS50b3BpY30iLi4uPC9wPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHJlc3VsdHNDb250ZW50Q29udGFpbmVyLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgbG9hZGVySHRtbCk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbXAtbG9hZGVyLXRleHQtcmVzdWx0cycpOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxUZXN0VGV4dCA9IG9yaWdpbmFsUXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgbGV0IHF1ZXN0aW9uU3RyaW5nID0gYCR7aW5kZXggKyAxfS4gJHtxLnF1ZXN0aW9uVGV4dCB8fCBxLnN0ZW19XG5gOwogICAgICAgICAgICBpZiAocS5vcHRpb25zKSB7CiAgICAgICAgICAgICAgICBxdWVzdGlvblN0cmluZyArPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAgICAtICR7aSA9PT0gcS5jb3JyZWN0QW5zd2VySW5kZXggPyAnWypdJyA6ICcnfSAke29wdH1gKS5qb2luKCdcbicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHEuaWRlYWxBbnN3ZXIpIHsKICAgICAgICAgICAgICAgIHF1ZXN0aW9uU3RyaW5nICs9IGAgICAtIOC4hOC4s+C4leC4reC4mjogJHtxLmlkZWFsQW5zd2VyfWA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uU3RyaW5nOwogICAgICAgIH0pLmpvaW4oJ1xuXG4nKTsKCiAgICAgICAgbG9hZGVyVGV4dC50ZXh0Q29udGVudCA9ICfguKfguLTguYDguITguKPguLLguLDguKvguYzguKrguLPguYDguKPguYfguIghIOC4geC4s+C4peC4seC4h+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4hOC4ueC5iOC4guC4meC4suC4mS4uLic7CgogICAgICAgIGNvbnN0IHByb21wdCA9IGAKICAgICAgICAgICAg4LiE4Li44LiT4LiE4Li34Lit4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiN4LiU4LmJ4Liy4LiZ4LiB4Liy4Lij4Lin4Lix4LiU4Lic4Lil4LmB4Lil4Liw4Lib4Lij4Liw4LmA4Lih4Li04LiZ4Lic4Lil4LiX4Liy4LiH4LiB4Liy4Lij4Lio4Li24LiB4Lip4LiyCiAgICAgICAgICAgIOC4meC4teC5iOC4hOC4t+C4reC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4leC5ieC4meC4ieC4muC4seC4muC4iuC4uOC4lOC4q+C4meC4tuC5iOC4h+C5g+C4meC4q+C4seC4p+C4guC5ieC4rSAiJHtvcmlnaW5hbFF1aXpEYXRhLnRvcGljfSI6CiAgICAgICAgICAgIC0tLQogICAgICAgICAgICAke29yaWdpbmFsVGVzdFRleHR9CiAgICAgICAgICAgIC0tLQogICAgICAgICAgICDguKDguLLguKPguIHguLTguIjguILguK3guIfguITguLjguJPguITguLfguK06CiAgICAgICAgICAgIDEuICDguKfguLTguYDguITguKPguLLguLDguKvguYzguILguYnguK3guKrguK3guJrguJXguYnguJnguInguJrguLHguJrguJnguLXguYnguYDguJ7guLfguYjguK3guJfguLPguITguKfguLLguKHguYDguILguYnguLLguYPguIjguILguK3guJrguYDguILguJXguYDguJnguLfguYnguK3guKvguLIsIOC4o+C4ueC4m+C5geC4muC4muC4hOC4s+C4luC4suC4oSwg4LmB4Lil4Liw4Lij4Liw4LiU4Lix4Lia4LiE4Lin4Liy4Lih4Lii4Liy4LiBCiAgICAgICAgICAgIDIuICDguKrguKPguYnguLLguIcgIuC5geC4muC4muC4l+C4lOC4quC4reC4muC4hOC4ueC5iOC4guC4meC4suC4mSIgKFBhcmFsbGVsIFRlc3QpIOC4guC4tuC5ieC4meC4oeC4siAxIOC4iuC4uOC4lCDguIvguLbguYjguIfguJXguYnguK3guIfguKfguLHguJTguITguKfguLLguKHguKPguLnguYnguYPguJnguYDguKPguLfguYjguK3guIfguYDguJTguLXguKLguKfguIHguLHguJnguYHguKXguLDguKHguLXguKPguLDguJTguLHguJrguITguKfguLLguKHguKLguLLguIHguYDguJfguYjguLLguIHguLHguJkKICAgICAgICAgICAgMy4gICoq4Lir4LmJ4Liy4Lih4LiE4Lix4LiU4Lil4Lit4LiB4LmC4LiI4LiX4Lii4LmMLCDguJXguLHguKfguYDguKXguIIsIOC4q+C4o+C4t+C4reC4quC4luC4suC4meC4geC4suC4o+C4k+C5jOC5gOC4lOC4tOC4oeC4oeC4suC5guC4lOC4ouC5gOC4lOC5h+C4lOC4guC4suC4lCoqIOC4leC5ieC4reC4h+C4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4meC4oeC4suC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4q+C5ieC4oeC4teC4hOC4p+C4suC4oSAi4Liq4Lih4Lih4Li54LilIiDguIHguLHguJkKICAgICAgICAgICAgNC4gIOC4iOC4s+C4meC4p+C4meC4guC5ieC4reC5geC4peC4sOC4m+C4o+C4sOC5gOC4oOC4l+C4guC4reC4h+C4hOC4s+C4luC4suC4oeC4leC5ieC4reC4h+C4leC4o+C4h+C4geC4seC4muC4leC5ieC4meC4ieC4muC4seC4muC4l+C4uOC4geC4m+C4o+C4sOC4geC4suC4owogICAgICAgICAgICA1LiAg4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LmA4Lib4LmH4LiZ4Lig4Liy4Lip4Liy4LmE4LiX4Lii4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgICAgICR7c2ltcGxlTWF0aFByb21wdH0KICAgICAgICBgOwogICAgICAgIGNvbnN0IG1peGVkUXVlc3Rpb25TY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHF1ZXN0aW9uVGV4dDogeyAidHlwZSI6ICJTVFJJTkciIH0sIHF1ZXN0aW9uVHlwZTogeyAidHlwZSI6ICJTVFJJTkciLCAiZW51bSI6IFsibXVsdGlwbGVfY2hvaWNlIiwgInNob3J0X2Fuc3dlciIsICJ0cnVlX2ZhbHNlIiwgIm1hdGNoaW5nX2l0ZW0iXSB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0sIGNvcnJlY3RBbnN3ZXI6IHsgdHlwZTogIkJPT0xFQU4iIH0sIHN0ZW06IHsgdHlwZTogIlNUUklORyIgfSwgY29ycmVjdFJlc3BvbnNlOiB7IHR5cGU6ICJTVFJJTkciIH0sIGFsbFJlc3BvbnNlczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0sIGltYWdlQ29kZTogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVHlwZSIsICJleHBsYW5hdGlvbiJdIH07CiAgICAgICAgY29uc3QgZmluYWxTY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHRvcGljOiB7IHR5cGU6ICJTVFJJTkciIH0sIHF1ZXN0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogbWl4ZWRRdWVzdGlvblNjaGVtYSB9IH0sIHJlcXVpcmVkOiBbInRvcGljIiwgInF1ZXN0aW9ucyJdIH07CgogICAgICAgIGNvbnN0IG5ld1F1aXpEYXRhRnJvbUFJID0gYXdhaXQgY2FsbEFuYWx5c2lzQXBpKHByb21wdCwgZmluYWxTY2hlbWEpOwoKICAgICAgICAvLyB2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2CiAgICAgICAgLy8gLS0tIOC4iOC4uOC4lOC5geC4geC5ieC5hOC4gjog4LmA4Lie4Li04LmI4LihIElEIOC5g+C4q+C5ieC4geC4seC4muC4l+C4uOC4geC4hOC4s+C4luC4suC4oeC4geC5iOC4reC4meC4muC4seC4meC4l+C4tuC4gSAtLS0KICAgICAgICBjb25zdCBxdWVzdGlvbnNXaXRoSWRzID0gbmV3UXVpekRhdGFGcm9tQUkucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+ICh7CiAgICAgICAgICAgIC4uLnEsIC8vIOC4hOC4seC4lOC4peC4reC4geC4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4luC4suC4oeC5gOC4lOC4tOC4oeC4iOC4suC4gSBBSSDguJfguLHguYnguIfguKvguKHguJQKICAgICAgICAgICAgaWQ6IGBxXyR7RGF0ZS5ub3coKX1fJHtpbmRleH1gIC8vIOC5gOC4nuC4tOC5iOC4oSBwcm9wZXJ0eSAnaWQnIOC4l+C4teC5iOC5hOC4oeC5iOC4i+C5ieC4s+C4geC4seC4meC5gOC4guC5ieC4suC5hOC4mwogICAgICAgIH0pKTsKICAgICAgICAvLyBeXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eCgogICAgICAgIGNvbnN0IG5ld1RvcGljID0gYCjguITguLnguYjguILguJnguLLguJkpICR7b3JpZ2luYWxRdWl6RGF0YS50b3BpY31gOwoKICAgICAgICBjb25zdCBkYXRhVG9TYXZlID0gewogICAgICAgICAgICB0b3BpYzogbmV3VG9waWMsIAogICAgICAgICAgICBxdWVzdGlvbnM6IHF1ZXN0aW9uc1dpdGhJZHMsIC8vIDwtLSDguYPguIrguYnguJXguLHguKfguYHguJvguKPguYPguKvguKHguYjguJfguLXguYjguKHguLUgSUQg4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIHF1aXpUeXBlOiBvcmlnaW5hbFF1aXpEYXRhLnF1aXpUeXBlLAogICAgICAgICAgICBwcm9qZWN0SWQ6IGN1cnJlbnRQcm9qZWN0SWQsCiAgICAgICAgICAgIGNyZWF0ZWRCeTogdXNlcklkLAogICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJywKICAgICAgICAgICAgc2V0dGluZ3M6IG9yaWdpbmFsUXVpekRhdGEuc2V0dGluZ3MsIAogICAgICAgICAgICBxdWl6TW9kZTogJ3N0YW5kYXJkJywKICAgICAgICAgICAgcGFpcmVkUXVpeklkOiBudWxsLAogICAgICAgICAgICBsZXNzb25QbGFuOiBudWxsCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyDguKrguKPguYnguLLguIcgSUQg4LmD4Lir4Lih4LmI4LmB4Lia4Lia4Liq4Li44LmI4LihIDQg4Lir4Lil4Lix4LiBIOC5geC4peC4sOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5hOC4oeC5iOC4i+C5ieC4s+C4geC4seC4muC4guC4reC4h+C5gOC4lOC4tOC4oQpsZXQgbmV3UXVpeklkOwp3aGlsZSAodHJ1ZSkgewogICAgbmV3UXVpeklkID0gTWF0aC5mbG9vcigxMDAwICsgTWF0aC5yYW5kb20oKSAqIDkwMDApLnRvU3RyaW5nKCk7CiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGdldERvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIG5ld1F1aXpJZCkpOwogICAgaWYgKCFleGlzdGluZy5leGlzdHMoKSkgYnJlYWs7Cn0KLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiU4LmJ4Lin4LiiIElEIDQg4Lir4Lil4Lix4LiB4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LiC4Li24LmJ4LiZCmF3YWl0IHNldERvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIG5ld1F1aXpJZCksIGRhdGFUb1NhdmUpOwogICAgICAgIHNob3dNZXNzYWdlKCLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguITguLnguYjguILguJnguLLguJnguKrguLPguYDguKPguYfguIjguYHguKXguYnguKchIik7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBnZW5lcmF0aW5nIHBhcmFsbGVsIHRlc3QgZnJvbSBiYW5rOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZShg4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUOiAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICB9IGZpbmFsbHkgewogICAgICAgIGNvbnN0IHRlbXBMb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGVtcC1sb2FkZXItcmVzdWx0cycpOwogICAgICAgIGlmICh0ZW1wTG9hZGVyKSB7CiAgICAgICAgICAgIHRlbXBMb2FkZXIucmVtb3ZlKCk7CiAgICAgICAgfQogICAgICAgIHF1aXp6ZXNMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9CgovLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVQYXJhbGxlbFBvc3RUZXN0KG9yaWdpbmFsUHJlVGVzdFF1aXpEYXRhKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZVBhcmFsbGVsVGVzdChzaG9ydGN1dEZpbGUgPSBudWxsKSAgeyAvKiBSZW1vdmVkICovIH0gCgkJCgkJYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmVnZW5lcmF0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpIHsKICAgIGlmIChjdXJyZW50RWRpdGluZ1F1aXpEYXRhID09PSBudWxsKSByZXR1cm47CgogICAgLy8g4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiU4LmD4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiB4Liz4Lil4Lix4LiH4LiI4Liw4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmICiAgICBjb25zdCBxdWVzdGlvbkl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAucXVlc3Rpb24tZWRpdG9yLWl0ZW1bZGF0YS1xLWluZGV4PSIke2luZGV4fSJdYCk7CiAgICBpZiAocXVlc3Rpb25JdGVtKSB7CiAgICAgICAgcXVlc3Rpb25JdGVtLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciBoLTMyIj48ZGl2IGNsYXNzPSJsb2FkZXIiPjwvZGl2PjwvZGl2Pic7CiAgICB9CgogICAgY29uc3Qgb3JpZ2luYWxRdWVzdGlvbiA9IGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zW2luZGV4XTsKICAgIGNvbnN0IHF1aXpUb3BpYyA9IGN1cnJlbnRFZGl0aW5nUXVpekRhdGEudG9waWM7CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBvcmlnaW5hbFF1ZXN0aW9uLnF1ZXN0aW9uVHlwZTsKCiAgICAvLyDguYDguJXguKPguLXguKLguKEgUHJvbXB0IOC5geC4peC4sCBTY2hlbWEg4Liq4Liz4Lir4Lij4Lix4Lia4LmA4Lij4Li14Lii4LiBIEFJCiAgICBjb25zdCBtY3FTY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsicXVlc3Rpb25UZXh0IiwgIm9wdGlvbnMiLCAiY29ycmVjdEFuc3dlckluZGV4IiwgImV4cGxhbmF0aW9uIl0gfTsKICAgIGNvbnN0IHNob3J0QW5zd2VyU2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBxdWVzdGlvblRleHQ6IHsgdHlwZTogIlNUUklORyIgfSwgaWRlYWxBbnN3ZXI6IHsgdHlwZTogIlNUUklORyIgfSwgZXhwbGFuYXRpb246IHsgdHlwZTogIlNUUklORyIgfSB9LCByZXF1aXJlZDogWyJxdWVzdGlvblRleHQiLCAiaWRlYWxBbnN3ZXIiLCAiZXhwbGFuYXRpb24iXSB9OwogICAgCiAgICBsZXQgc2NoZW1hOwogICAgbGV0IHR5cGVEZXNjcmlwdGlvbiA9ICIiOwogICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICBzY2hlbWEgPSBtY3FTY2hlbWE7CiAgICAgICAgdHlwZURlc2NyaXB0aW9uID0gIuC5geC4muC4muC4m+C4o+C4meC4seC4oiA0IOC4leC4seC4p+C5gOC4peC4t+C4reC4gSI7CiAgICB9IGVsc2UgewogICAgICAgIHNjaGVtYSA9IHNob3J0QW5zd2VyU2NoZW1hOwogICAgICAgIHR5cGVEZXNjcmlwdGlvbiA9ICLguYHguJrguJrguYDguJXguLTguKHguITguLPguJXguK3guJoiOwogICAgfQoKICAgIGNvbnN0IHByb21wdCA9IGDguKrguKPguYnguLLguIfguITguLPguJbguLLguKHguYPguKvguKHguYggMSDguILguYnguK0g4LmD4LiZ4Lir4Lix4Lin4LiC4LmJ4LitICIke3F1aXpUb3BpY30iIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4hOC4s+C4luC4suC4oeC4m+C4o+C4sOC5gOC4oOC4lyAiJHt0eXBlRGVzY3JpcHRpb259IiDguYLguJTguKLguYPguKvguYnguKHguLXguYDguJnguLfguYnguK3guKvguLLguYPguIHguKXguYnguYDguITguLXguKLguIfguYHguJXguYjguYTguKHguYjguIvguYnguLPguIHguLHguJrguITguLPguJbguLLguKHguYDguJTguLTguKHguJnguLXguYk6ICIke29yaWdpbmFsUXVlc3Rpb24ucXVlc3Rpb25UZXh0IHx8IG9yaWdpbmFsUXVlc3Rpb24uc3RlbX0iLiAke3NpbXBsZU1hdGhQcm9tcHR9YDsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IG5ld1F1ZXN0aW9uRGF0YSA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShwcm9tcHQsIHNjaGVtYSk7CiAgICAgICAgCiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LmE4LiU4LmJ4LmC4LiI4LiX4Lii4LmM4LmD4Lir4Lih4LmI4Lih4Liy4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC4reC4seC4m+C5gOC4lOC4leC4guC5ieC4reC4oeC4ueC4peC5g+C4mSBTdGF0ZQogICAgICAgIGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zW2luZGV4XSA9IHsgLi4ub3JpZ2luYWxRdWVzdGlvbiwgLi4ubmV3UXVlc3Rpb25EYXRhIH07CgogICAgICAgIC8vIOC4p+C4suC4lOC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4nuC4o+C5ieC4reC4oeC5guC4iOC4l+C4ouC5jOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4h+C4quC4o+C5ieC4suC4hwogICAgICAgIHJlbmRlclF1aXpFZGl0b3IoY3VycmVudEVkaXRpbmdRdWl6RGF0YSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHJlZ2VuZXJhdGluZyBxdWVzdGlvbiBpbiBlZGl0b3I6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKrguKPguYnguLLguIfguYLguIjguJfguKLguYzguYPguKvguKHguYgiKTsKICAgICAgICAKICAgICAgICAvLyDguKvguLLguIHguKXguYnguKHguYDguKvguKXguKcg4LmD4Lir4LmJ4Lin4Liy4LiU4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4LiU4Li04Lih4LiB4Lil4Lix4Lia4Lih4LiyCiAgICAgICAgcmVuZGVyUXVpekVkaXRvcihjdXJyZW50RWRpdGluZ1F1aXpEYXRhKTsKICAgIH0KfQogICAgICAgIAogICAgICAgZnVuY3Rpb24gaGFuZGxlTW9kZVN3aXRjaCgpIHsKICAgICAgICAgICAgY29uc3Qgc3dpdGNoZXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kZS1zd2l0Y2hlci1idG4nKTsKICAgICAgICAgICAgaWYgKGN1cnJlbnRNb2RlID09PSAnc3R1ZGVudCcpIHsKICAgICAgICAgICAgICAgIC8vIC0tLSDguYLguITguYnguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCiAgICAgICAgICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJnguIjguLLguIHguYHguKrguJTguIfguKvguJnguYnguLLguJXguYjguLLguIcgbG9naW4g4LmA4Lib4LmH4LiZ4Liq4Lil4Lix4Lia4LmC4Lir4Lih4LiU4LiX4Lix4LiZ4LiX4Li1CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDEuIOC5gOC4m+C4peC4teC5iOC4ouC4meC4quC4luC4suC4meC4sOC5gOC4m+C5h+C4mSBhZG1pbgogICAgICAgICAgICAgICAgY3VycmVudE1vZGUgPSAnYWRtaW4nOwoKICAgICAgICAgICAgICAgIC8vIDIuIOC4reC4seC4m+C5gOC4lOC4leC5hOC4reC4hOC4reC4meC5geC4peC4sOC4guC5ieC4reC4hOC4p+C4suC4oeC4guC4reC4h+C4m+C4uOC5iOC4oQogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4uaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtdXNlci1ncmFkdWF0ZSBmYS1sZyI+PC9pPmA7CiAgICAgICAgICAgICAgICBzd2l0Y2hlckJ0bi50aXRsZSA9ICLguKrguKXguLHguJrguYTguJvguYLguKvguKHguJTguJnguLHguIHguYDguKPguLXguKLguJkiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAzLiDguYHguKrguJTguIfguKvguJnguYnguLIgZGFzaGJvYXJkIOC4guC4reC4hyBhZG1pbgogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ2FkbWluLWRhc2hib2FyZCcpOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIElmIGluIGFkbWluIG1vZGUsIHN3aXRjaCBiYWNrIHRvIHN0dWRlbnQKICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlID0gJ3N0dWRlbnQnOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4uaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtdXNlci1zaGllbGQgZmEtbGciPjwvaT5gOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4udGl0bGUgPSAi4Liq4Lil4Lix4Lia4LmE4Lib4LmC4Lir4Lih4LiU4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44LihIjsKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFkbWluTG9naW4oKSB7CiAgICAgICAgICAgIGNvbnN0IHBhc3NJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1wYXNzd29yZC1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBlcnJvck1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzd29yZC1lcnJvci1tc2cnKTsKICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsZSwgbm9uLXNlY3VyZSBwYXNzd29yZC4gSW4gYSByZWFsIGFwcCwgdXNlIGEgcHJvcGVyIGF1dGggc3lzdGVtLgogICAgICAgICAgICBpZiAocGFzc0lucHV0LnZhbHVlID09PSAnMjc0MTE0NzInKSB7CiAgICAgICAgICAgICAgICBhZG1pblBhc3N3b3JkTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBwYXNzSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIGVycm9yTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbW9kZSBhbmQgYnV0dG9uCiAgICAgICAgICAgICAgICBjdXJyZW50TW9kZSA9ICdhZG1pbic7CiAgICAgICAgICAgICAgICBjb25zdCBzd2l0Y2hlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlLXN3aXRjaGVyLWJ0bicpOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4uaW5uZXJIVE1MID0gYDxpIGNsYXNzPSJmYXMgZmEtdXNlci1ncmFkdWF0ZSBmYS1sZyI+PC9pPmA7CiAgICAgICAgICAgICAgICBzd2l0Y2hlckJ0bi50aXRsZSA9ICLguKrguKXguLHguJrguYTguJvguYLguKvguKHguJTguJnguLHguIHguYDguKPguLXguKLguJkiOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlcnJvck1zZy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHBhc3NJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzd2l0Y2hQcm9qZWN0VGFiKHRhYk5hbWUpIHsKICAgICAgICAgICAgWydtYW5hZ2UnLCAncmVzdWx0cycsICdsZWFkZXJib2FyZCddLmZvckVhY2gobmFtZSA9PiB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtuYW1lfS10YWJgKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke25hbWV9LXRhYi1jb250ZW50YCkuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHt0YWJOYW1lfS10YWJgKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dGFiTmFtZX0tdGFiLWNvbnRlbnRgKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSDguYHguIHguYnguYTguILguJ/guLHguIfguIHguYzguIrguLHguJkgc3dpdGNoUXVpekRldGFpbFRhYiAtLS0KZnVuY3Rpb24gc3dpdGNoUXVpekRldGFpbFRhYih0YWJOYW1lKSB7CiAgICBjb25zdCB0YWJzID0gewogICAgICAgICdhbmFseXRpY3MnOiB7IGJ0bjogJ2FuYWx5dGljcy10YWItYnRuJywgY29udGVudDogJ2FuYWx5dGljcy10YWItY29udGVudCcgfSwKICAgICAgICAnc2NvcmVzJzogeyBidG46ICdzY29yZXMtdGFiLWJ0bicsIGNvbnRlbnQ6ICdzY29yZXMtdGFiLWNvbnRlbnQnIH0sCiAgICAgICAgJ2xlYWRlcmJvYXJkLXF1aXonOiB7IGJ0bjogJ2xlYWRlcmJvYXJkLXF1aXotdGFiLWJ0bicsIGNvbnRlbnQ6ICdsZWFkZXJib2FyZC1xdWl6LXRhYi1jb250ZW50JyB9LAogICAgICAgICdiZWhhdmlvci1sb2cnOiB7IGJ0bjogJ2JlaGF2aW9yLWxvZy10YWItYnRuJywgY29udGVudDogJ2JlaGF2aW9yLWxvZy10YWItY29udGVudCcgfSAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICB9OwoKICAgIGZvciAoY29uc3Qga2V5IGluIHRhYnMpIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJzW2tleV0uYnRuKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJzW2tleV0uY29udGVudCkuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFic1t0YWJOYW1lXS5idG4pLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFic1t0YWJOYW1lXS5jb250ZW50KS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKZnVuY3Rpb24gc2hvd01lc3NhZ2UobWVzc2FnZSwgb25Db25maXJtID0gbnVsbCkgewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiI4Liy4LiBIC50ZXh0Q29udGVudCDguYDguJvguYfguJkgLmlubmVySFRNTCAKICAgIC8vIOC5geC4peC4sCAucmVwbGFjZSgvXG4vZywgJzxicj4nKSDguYDguJ7guLfguYjguK3guYPguKvguYnguKPguK3guIfguKPguLHguJrguIHguLLguKPguILguLbguYnguJnguJrguKPguKPguJfguLHguJTguYPguKvguKHguYgKICAgIG1vZGFsTWVzc2FnZS5pbm5lckhUTUwgPSBtZXNzYWdlLnJlcGxhY2UoL1xuL2csICc8YnI+Jyk7CiAgICAKICAgIG1vZGFsQ29uZmlybUFjdGlvbiA9IG9uQ29uZmlybTsgCiAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCiAgICAgICAgZnVuY3Rpb24gc2hvd0NvbmZpcm1hdGlvbihtZXNzYWdlLCBvbkNvbmZpcm0sIG9uQ2FuY2VsID0gbnVsbCkgeyAvLyA8LS0g4LmB4LiB4LmJ4LmE4LiC4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtYXRpb24tbWVzc2FnZScpLnRleHRDb250ZW50ID0gbWVzc2FnZTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm1hdGlvbi1tb2RhbCcpLnF1ZXJ5U2VsZWN0b3IoJ2gzJykudGV4dENvbnRlbnQgPSAn4Lii4Li34LiZ4Lii4Lix4LiZ4LiB4Liy4Lij4LiB4Lij4Liw4LiX4LizJzsKICAgICAgICAgICAgY29uZmlybUFjdGlvbiA9IG9uQ29uZmlybTsKICAgICAgICAgICAgY2FuY2VsQWN0aW9uID0gb25DYW5jZWw7IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKICAgICAgICAgICAgY29uZmlybWF0aW9uTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfQogICAgICAgIApmdW5jdGlvbiBsaXN0ZW5Gb3JQcm9qZWN0cygpIHsKICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3NSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICAgICAgb25TbmFwc2hvdChzZXR0aW5nc1JlZiwgKGRvY1NuYXApID0+IHsKICAgICAgICAgICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3NEYXRhID0gZG9jU25hcC5kYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFNvcnQgPSBzZXR0aW5nc0RhdGEucHJvamVjdFNvcnQgfHwgJ2RhdGVfZGVzYyc7CiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucGlubmVkUHJvamVjdHMgPSBzZXR0aW5nc0RhdGEucGlubmVkUHJvamVjdHMgfHwgW107CiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdE9yZGVyID0gc2V0dGluZ3NEYXRhLnByb2plY3RPcmRlciB8fCBbXTsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFsbFByb2plY3RzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJQcm9qZWN0cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnN0IHByb2plY3RzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2ApOwogICAgICAgICAgICB1bnN1YnNjcmliZVByb2plY3RzTGlzdGVuZXIgPSBvblNuYXBzaG90KHByb2plY3RzUmVmLCAoc25hcHNob3QpID0+IHsKICAgICAgICAgICAgICAgIGFsbFByb2plY3RzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSkpOwogICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdHMoKTsKICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsaXN0ZW5pbmcgZm9yIHByb2plY3RzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguYLguJvguKPguYDguIjguIQiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKZnVuY3Rpb24gc2hvd0NvbG9yUGFsZXR0ZShidXR0b24sIHByb2plY3RJZCkgewogICAgICAgICAgICAvLyDguKXguJogUGFsZXR0ZSDguYDguIHguYjguLIgKOC4luC5ieC4suC4oeC4tSkKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbG9yLXBhbGV0dGUtcG9wdXAnKS5mb3JFYWNoKHAgPT4gcC5yZW1vdmUoKSk7CgogICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBbJyNGRkZGRkYnLCAnI0ZFRTJFMicsICcjRkVGM0M3JywgJyNEMUZBRTUnLCAnI0RCRUFGRScsICcjRTBFN0ZGJywgJyNGM0U4RkYnLCAnI0ZDRTdGMycsICcjRTVFN0VCJ107CiAgICAgICAgICAgIGNvbnN0IHBhbGV0dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgcGFsZXR0ZS5jbGFzc05hbWUgPSAnY29sb3ItcGFsZXR0ZS1wb3B1cCBhYnNvbHV0ZSB6LTEwIGJnLXdoaXRlIHAtMiByb3VuZGVkLWxnIHNoYWRvdy1sZyBmbGV4IGdhcC0yJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbG9ycy5mb3JFYWNoKGNvbG9yID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN3YXRjaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICAgICAgc3dhdGNoLmNsYXNzTmFtZSA9ICd3LTYgaC02IHJvdW5kZWQtZnVsbCBjdXJzb3ItcG9pbnRlciBib3JkZXItMiBob3Zlcjpib3JkZXItYmx1ZS01MDAnOwogICAgICAgICAgICAgICAgc3dhdGNoLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yOwogICAgICAgICAgICAgICAgc3dhdGNoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGhhbmRsZVByb2plY3RDb2xvckNoYW5nZShwcm9qZWN0SWQsIGNvbG9yKTsKICAgICAgICAgICAgICAgICAgICBwYWxldHRlLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBwYWxldHRlLmFwcGVuZENoaWxkKHN3YXRjaCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwYWxldHRlKTsKICAgICAgICAgICAgY29uc3QgcmVjdCA9IGJ1dHRvbi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgcGFsZXR0ZS5zdHlsZS50b3AgPSBgJHtyZWN0LmJvdHRvbSArIHdpbmRvdy5zY3JvbGxZfXB4YDsKICAgICAgICAgICAgcGFsZXR0ZS5zdHlsZS5sZWZ0ID0gYCR7cmVjdC5sZWZ0ICsgd2luZG93LnNjcm9sbFggLSAocGFsZXR0ZS5vZmZzZXRXaWR0aCAvIDIpfXB4YDsKICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVByb2plY3RDb2xvckNoYW5nZShwcm9qZWN0SWQsIGNvbG9yKSB7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBwcm9qZWN0SWQpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsgY29sb3I6IGNvbG9yIH0pOwogICAgICAgICAgICAgICAgLy8gb25TbmFwc2hvdCDguIjguLAgcmUtcmVuZGVyIOC5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tAogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdXBkYXRpbmcgcHJvamVjdCBjb2xvcjoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Liq4Li1Iik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCmFzeW5jIGZ1bmN0aW9uIHJlbmRlclByb2plY3RzKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWNyZWF0ZS1wcm9qZWN0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBwcm9qZWN0TmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtbmFtZS1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3ROYW1lSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICBpZiAoIXByb2plY3ROYW1lKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmD4Liq4LmI4LiK4Li34LmI4Lit4LmC4Lib4Lij4LmA4LiI4LiEIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IG5ld1Byb2plY3RSZWYgPSBkb2MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2ApKTsKICAgICAgICAgICAgICAgIGF3YWl0IHNldERvYyhuZXdQcm9qZWN0UmVmLCB7CiAgICAgICAgICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLAogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiBbXSwKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczogewogICAgcmVzdWx0c0Rpc3BsYXk6ICdzaG93X3Jlc3VsdHNfYW5kX2Fuc3dlcnMnLAogICAgc2h1ZmZsZVNldHRpbmc6ICdub25lJywKICAgIGRlZmF1bHROdW1RdWVzdGlvbnM6IDUsCiAgICBkZWZhdWx0TnVtQ2hvaWNlczogNCwKICAgIGRlZmF1bHRQYXNzaW5nU2NvcmU6IDMsCiAgICB0aW1lck1vZGU6ICdub25lJywKICAgIHRpbWVyRHVyYXRpb246IDEwLAogICAgc2hvd0luU3R1ZGVudERhc2hib2FyZDogZmFsc2UgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQp9LAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRCeTogdXNlcklkLCAvLyBLZWVwIHRyYWNrIG9mIHdobyBjcmVhdGVkIGl0CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcHJvamVjdE5hbWVJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgY3JlYXRlUHJvamVjdE1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4quC4o+C5ieC4suC4h+C5guC4m+C4o+C5gOC4iOC4hOC4quC4s+C5gOC4o+C5h+C4iCEiKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNyZWF0aW5nIHByb2plY3Q6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4quC4o+C5ieC4suC4h+C5guC4m+C4o+C5gOC4iOC4hOC5hOC4lOC5iSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIOC5guC4hOC5ieC4lOC5g+C4q+C4oeC5iOC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAo4Lin4Liy4LiH4LiX4Lix4Lia4LiC4Lit4LiH4LmA4LiU4Li04LihKQovLyDguYLguITguYnguJTguYPguKvguKHguYggKOC4p+C4suC4h+C4l+C4seC4miBldmVudCBsaXN0ZW5lciDguILguK3guIcgcHJvamVjdExpc3Qg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUKQpwcm9qZWN0TGlzdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7CiAgICBjb25zdCBjYXJkQ29udGVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0LWNhcmQtY29udGVudCcpOwogICAgY29uc3QgZGVsZXRlQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmRlbGV0ZS1wcm9qZWN0LWJ0bicpOwogICAgY29uc3QgcGluQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnBpbi1wcm9qZWN0LWJ0bicpOwoJY29uc3QgY29sb3JCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuY29sb3ItcGFsZXR0ZS1idG4nKTsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQoKICAgIGlmIChwaW5CdG4pIHsKICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBwaW5CdG4uZGF0YXNldC5pZDsKICAgICAgICBjb25zdCBzZXR0aW5nc1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImRhc2hib2FyZENvbmZpZyIpOwogICAgICAgIGNvbnN0IGN1cnJlbnRQaW5uZWQgPSBnbG9iYWxEYXNoYm9hcmRTZXR0aW5ncy5waW5uZWRQcm9qZWN0czsKICAgICAgICBsZXQgbmV3UGlubmVkSWRzOwogICAgICAgIAogICAgICAgIGlmIChjdXJyZW50UGlubmVkLmluY2x1ZGVzKHByb2plY3RJZCkpIHsKICAgICAgICAgICAgbmV3UGlubmVkSWRzID0gY3VycmVudFBpbm5lZC5maWx0ZXIoaWQgPT4gaWQgIT09IHByb2plY3RJZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3UGlubmVkSWRzID0gWy4uLmN1cnJlbnRQaW5uZWQsIHByb2plY3RJZF07CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGF3YWl0IHNldERvYyhzZXR0aW5nc1JlZiwgeyBwaW5uZWRQcm9qZWN0czogbmV3UGlubmVkSWRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdXBkYXRpbmcgcGluIHN0YXR1czoiLCBlcnJvcik7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJvguLHguIHguKvguKHguLjguJQiKTsKICAgICAgICB9CgkJCgkJfSBlbHNlIGlmIChjb2xvckJ0bikgeyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lil4LmH4Lit4LiB4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgY29uc3QgcHJvamVjdElkID0gY29sb3JCdG4uZGF0YXNldC5pZDsKICAgICAgICBzaG93Q29sb3JQYWxldHRlKGNvbG9yQnRuLCBwcm9qZWN0SWQpOwogICAgICAgICAgICAKICAgIH0gZWxzZSBpZiAoY2FyZENvbnRlbnQpIHsKICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBjYXJkQ29udGVudC5kYXRhc2V0LmlkOwogICAgICAgIGlmIChwcm9qZWN0SWQgPT09ICdzdGFycmVkLXByb2plY3QnKSB7CiAgICAgICAgICAgIHNob3dTdGFycmVkUHJvamVjdFZpZXcoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdXJyZW50UHJvamVjdElkID0gcHJvamVjdElkOwogICAgICAgICAgICBhd2FpdCBsb2FkUHJvamVjdERldGFpbHMoY3VycmVudFByb2plY3RJZCk7CiAgICAgICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgICAgIH0KICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZGVsZXRlQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBkZWxldGVCdG4uZGF0YXNldC5uYW1lOwogICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgIGDguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguYLguJvguKPguYDguIjguIQgIiR7cHJvamVjdE5hbWV9Ij8g4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiI4Liw4LiW4Li54LiB4Lil4Lia4Lit4Lii4LmI4Liy4LiH4LiW4Liy4Lin4LijYCwKICAgICAgICAgICAgKCkgPT4gaGFuZGxlRGVsZXRlUHJvamVjdChwcm9qZWN0SWQpCiAgICAgICAgKTsKICAgIH0KfSk7Cgpwcm9qZWN0TGlzdC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQuY2xvc2VzdCgnLnByb2plY3QtY2FyZC1jb250YWluZXInKTsKICAgICAgICAgICAgaWYgKHRhcmdldCkgewogICAgICAgICAgICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBwcm9qZWN0TGlzdC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0LWNhcmQtY29udGFpbmVyJyk7CiAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcHJvamVjdExpc3QuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBlID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBkcmFnZ2luZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWNhcmQtY29udGFpbmVyLm9wYWNpdHktNTAnKTsKICAgICAgICAgICAgaWYgKCFkcmFnZ2luZykgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBhZnRlckVsZW1lbnQgPSBnZXREcmFnQWZ0ZXJFbGVtZW50KHByb2plY3RMaXN0LCBlLmNsaWVudFkpOwogICAgICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHByb2plY3RMaXN0LmFwcGVuZENoaWxkKGRyYWdnaW5nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByb2plY3RMaXN0Lmluc2VydEJlZm9yZShkcmFnZ2luZywgYWZ0ZXJFbGVtZW50KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIHByb2plY3RMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlID0+IHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCBuZXdPcmRlciA9IFsuLi5wcm9qZWN0TGlzdC5xdWVyeVNlbGVjdG9yQWxsKCcucHJvamVjdC1jYXJkLWNvbnRhaW5lcltkYXRhLWlkXScpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoY2FyZCA9PiBjYXJkLmRhdGFzZXQuaWQpOwogICAgICAgICAgICBzYXZlUHJvamVjdE9yZGVyKG5ld09yZGVyKTsKICAgICAgICB9KTsKCQkKCQkvLyAtLS0gWyDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KLyoqCiAqIOC5geC4quC4lOC4h+C4nOC4peC4m+C4o+C4sOC4p+C4seC4leC4tOC4nuC4pOC4leC4tOC4geC4o+C4o+C4oeC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC5g+C4meC5geC4l+C5h+C4mgogKiBAcGFyYW0ge0FycmF5fSBzdWJtaXNzaW9ucyDguILguYnguK3guKHguLnguKXguIHguLLguKPguKrguYjguIfguIfguLLguJnguJfguLHguYnguIfguKvguKHguJTguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYkKICovCmZ1bmN0aW9uIHJlbmRlckJlaGF2aW9yTG9nKHN1Ym1pc3Npb25zKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmVoYXZpb3ItbG9nLWNvbnRhaW5lcicpOwogICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKCiAgICAvLyDguIHguKPguK3guIfguYDguInguJ7guLLguLDguJnguLHguIHguYDguKPguLXguKLguJnguJfguLXguYjguKHguLXguJvguKPguLDguKfguLHguJXguLTguJ7guKTguJXguLTguIHguKPguKPguKEKICAgIGNvbnN0IHN1Ym1pc3Npb25zV2l0aExvZ3MgPSBzdWJtaXNzaW9ucy5maWx0ZXIoc3ViID0+IHN1Yi5iZWhhdmlvckxvZyAmJiBzdWIuYmVoYXZpb3JMb2cubGVuZ3RoID4gMCk7CgogICAgaWYgKHN1Ym1pc3Npb25zV2l0aExvZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lie4Lia4Lib4Lij4Liw4Lin4Lix4LiV4Li04LiB4Liy4Lij4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZPC9wPic7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGxldCBodG1sID0gJyc7CiAgICBzdWJtaXNzaW9uc1dpdGhMb2dzLmZvckVhY2goc3ViID0+IHsKICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJvcmRlciByb3VuZGVkLWxnIGJnLXdoaXRlIj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTgwMCI+JHtzdWIuc3R1ZGVudE5hbWV9PC9wPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMiBwbC00IGJvcmRlci1sLTIgYm9yZGVyLWdyYXktMjAwIHNwYWNlLXktMiI+CiAgICAgICAgYDsKICAgICAgICAvLyDguYDguKPguLXguKLguIfguKXguLPguJTguLHguJrguYDguKvguJXguLjguIHguLLguKPguJPguYzguIjguLLguIHguKXguYjguLLguKrguLjguJTguYTguJvguYDguIHguYjguLLguKrguLjguJQKICAgICAgICBzdWIuYmVoYXZpb3JMb2cuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi50aW1lc3RhbXApIC0gbmV3IERhdGUoYS50aW1lc3RhbXApKS5mb3JFYWNoKGxvZyA9PiB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50VGltZSA9IG5ldyBEYXRlKGxvZy50aW1lc3RhbXApLnRvTG9jYWxlU3RyaW5nKCd0aC1USCcsIHsKICAgICAgICAgICAgICAgIGRhdGVTdHlsZTogJ3Nob3J0JywKICAgICAgICAgICAgICAgIHRpbWVTdHlsZTogJ21lZGl1bScKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNzAwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIHRleHQteWVsbG93LTUwMCBtci0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz7guK3guK3guIHguIjguLLguIHguKvguJnguYnguLLguIjguK0gKOC4hOC4o+C4seC5ieC4h+C4l+C4teC5iCAke2xvZy5hdHRlbXB0TnVtYmVyfSk8L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIG1sLTIiPiR7ZXZlbnRUaW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0pOwoKICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfSk7CgogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7Cn0KCQkKZnVuY3Rpb24gZ2V0RHJhZ0FmdGVyRWxlbWVudChjb250YWluZXIsIHkpIHsKICAgICAgICAgICAgY29uc3QgZHJhZ2dhYmxlRWxlbWVudHMgPSBbLi4uY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wcm9qZWN0LWNhcmQtY29udGFpbmVyOm5vdCgub3BhY2l0eS01MCknKV07CiAgICAgICAgICAgIHJldHVybiBkcmFnZ2FibGVFbGVtZW50cy5yZWR1Y2UoKGNsb3Nlc3QsIGNoaWxkKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBjaGlsZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IHkgLSBib3gudG9wIC0gYm94LmhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICBpZiAob2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB7IG9mZnNldDogb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgeyBvZmZzZXQ6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSB9KS5lbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gc2F2ZVByb2plY3RPcmRlcihuZXdPcmRlcikgewogICAgICAgICAgICBjb25zdCBzZXR0aW5nc1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImRhc2hib2FyZENvbmZpZyIpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHNldHRpbmdzUmVmLCB7IHByb2plY3RPcmRlcjogbmV3T3JkZXIgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIC8vIOC5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4o+C4leC5iOC4rSBVSSDguIjguLDguK3guLHguJvguYDguJTguJXguYDguK3guIfguYPguJnguITguKPguLHguYnguIfguJbguLHguJTguYTguJvguJfguLXguYggcmUtcmVuZGVyCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgcHJvamVjdCBvcmRlcjoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4Lil4Liz4LiU4Lix4LiaIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgkJCmFzeW5jIGZ1bmN0aW9uIGxvZ0JlaGF2aW9yRXZlbnQoZXZlbnRUeXBlLCBkZXRhaWxzID0ge30pIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEuaWQgfHwgIWN1cnJlbnRTdHVkZW50TmFtZSkgewogICAgICAgIGNvbnNvbGUud2Fybigi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lia4Lix4LiZ4LiX4Li24LiB4Lie4Lik4LiV4Li04LiB4Lij4Lij4Lih4LmE4LiU4LmJOiDguILguYnguK3guKHguLnguKXguYTguKHguYjguITguKPguJrguJbguYnguKfguJkiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7Y3VycmVudFF1aXpEYXRhLmlkfS9zdWJtaXNzaW9uc2AsIGN1cnJlbnRTdHVkZW50TmFtZSk7CgogICAgY29uc3QgbG9nRW50cnkgPSB7CiAgICAgICAgZXZlbnQ6IGV2ZW50VHlwZSwKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAuLi5kZXRhaWxzCiAgICB9OwoKICAgIHRyeSB7CiAgICAgICAgLy8g4Lie4Lii4Liy4Lii4Liy4Lih4Lit4Lix4Lib4LmA4LiU4LiV4LmA4Lit4LiB4Liq4Liy4Lij4LiX4Li14LmI4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHN1Ym1pc3Npb25SZWYsIHsKICAgICAgICAgICAgYmVoYXZpb3JMb2c6IGFycmF5VW5pb24obG9nRW50cnkpCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coYOC4reC4seC4m+C5gOC4lOC4leC4nuC4pOC4leC4tOC4geC4o+C4o+C4oeC4quC4s+C4q+C4o+C4seC4miAke2N1cnJlbnRTdHVkZW50TmFtZX0g4Liq4Liz4LmA4Lij4LmH4LiIYCk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAvLyDguKvguLLguIHguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQgKOC5gOC4iuC5iOC4mSDguKvguLLguYDguK3guIHguKrguLLguKPguYTguKHguYjguYDguIjguK0pIOC5g+C4q+C5ieC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5ieC5g+C4mSBjb25zb2xlIOC5geC4leC5iOC5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4o+C4geC4seC4miBVSQogICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnbm90LWZvdW5kJykgewogICAgICAgICAgICAvLyDguJnguLXguYjguITguLfguK3guIjguLjguJTguJfguLXguYjguJbguLnguIHguJXguYnguK3guIc6IOC5gOC4oeC4t+C5iOC4reC4q+C4suC5gOC4reC4geC4quC4suC4o+C5hOC4oeC5iOC5gOC4iOC4rSDguIHguYfguYTguKHguYjguJXguYnguK3guIfguJfguLPguK3guLDguYTguKPguYDguKXguKIKICAgICAgICAgICAgLy8g4LmA4Lie4Lij4Liy4Liw4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LmD4Lir4LmJ4Lia4Lix4LiZ4LiX4Li24LiB4Lie4Lik4LiV4Li04LiB4Lij4Lij4Lih4LmE4LiU4LmJCiAgICAgICAgICAgIGNvbnNvbGUud2Fybihg4LmE4Lih4LmI4Lie4Lia4LmA4Lit4LiB4Liq4Liy4Lij4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiC4Lit4LiHICR7Y3VycmVudFN0dWRlbnROYW1lfSDguIjguLbguIfguYTguKHguYjguKrguLLguKHguLLguKPguJbguJrguLHguJnguJfguLbguIEgYmVoYXZpb3IgbG9nIOC5hOC4lOC5iSAo4LiZ4Li14LmI4LiE4Li34Lit4LmA4Lir4LiV4Li44LiB4Liy4Lij4LiT4LmM4Lib4LiB4LiV4Li0KWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4q+C4suC4geC5gOC4m+C5h+C4meC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC4reC4t+C5iOC4meC5hgogICAgICAgICAgICBjb25zb2xlLmVycm9yKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIHguJ7guKTguJXguLTguIHguKPguKPguKE6IiwgZXJyb3IpOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gZ2V0U2NvcmVUaWVyKHNjb3JlLCBtYXhTY29yZSkgewogICAgaWYgKG1heFNjb3JlID09PSAwKSB7CiAgICAgICAgaWYgKHNjb3JlID09PSAwKSByZXR1cm4geyB0ZXh0OiAnKOC4o+C4reC4hOC4sOC5geC4meC4mSknLCBpY29uOiAn4o+zJyB9OwogICAgICAgIHJldHVybiB7IHRleHQ6ICco4Lie4Lii4Liy4Lii4Liy4Lih4Lit4Lii4Li54LmIKScsIGljb246ICfwn5ilJyB9OyAvLyDguIHguKPguJPguLXguJXguLTguJTguKXguJoKICAgIH0KICAgIC8vICjguJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguKvguLLguKPguJTguYnguKfguKLguKjguLnguJnguKLguYzguJbguYnguLIgbWF4U2NvcmUg4LmA4Lib4LmH4LiZIDApCiAgICBjb25zdCBzY29yZVJhdGlvID0gc2NvcmUgLyAobWF4U2NvcmUgPT09IDAgPyAxIDogbWF4U2NvcmUpOwoKICAgIGlmIChzY29yZVJhdGlvID09PSAxKSB7CiAgICAgICAgcmV0dXJuIHsgdGV4dDogJyjguJnguLPguYLguJTguYjguIcpJywgaWNvbjogJ/CfkZEnIH07CiAgICB9CiAgICBpZiAoc2NvcmVSYXRpbyA+PSAwLjcpIHsKICAgICAgICByZXR1cm4geyB0ZXh0OiAnKOC4leC4suC4oeC4oeC4suC4leC4tOC4lOC5hiknLCBpY29uOiAn8J+UpScgfTsKICAgIH0KICAgIGlmIChzY29yZVJhdGlvID49IDAuNCkgewogICAgICAgIHJldHVybiB7IHRleHQ6ICco4LiB4Liz4Lil4Lix4LiH4LmE4Lil4LmI4LiV4Liy4LihKScsIGljb246ICfwn4+DJyB9OwogICAgfQogICAgcmV0dXJuIHsgdGV4dDogJyjguJ7guKLguLLguKLguLLguKHguK3guKLguLnguYgpJywgaWNvbjogJ/CfmKUnIH07Cn0KCmZ1bmN0aW9uIGNhbGN1bGF0ZU1lYW5BbmRTdGREZXYoc2NvcmVzKSB7CiAgICBpZiAoc2NvcmVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIHsgbWVhbjogMCwgc3RkRGV2OiAwIH07CiAgICBjb25zdCBtZWFuID0gc2NvcmVzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gc2NvcmVzLmxlbmd0aDsKICAgIGlmIChzY29yZXMubGVuZ3RoID09PSAxKSByZXR1cm4geyBtZWFuOiBtZWFuLCBzdGREZXY6IDAgfTsgLy8gUy5ELiDguILguK3guIfguILguYnguK3guKHguLnguKUgMSDguJXguLHguKfguYDguJvguYfguJkgMAogICAgY29uc3Qgc3RkRGV2ID0gTWF0aC5zcXJ0KHNjb3Jlcy5tYXAoeCA9PiBNYXRoLnBvdyh4IC0gbWVhbiwgMikpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gKHNjb3Jlcy5sZW5ndGggLSAxKSk7CiAgICByZXR1cm4geyBtZWFuLCBzdGREZXYgfTsKfQoKLyoqCiAqIOC4hOC4s+C4meC4p+C4kyBaLVNjb3JlCiAqIEBwYXJhbSB7bnVtYmVyfSBzY29yZSAtIOC4hOC4sOC5geC4meC4meC4lOC4tOC4muC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4mQogKiBAcGFyYW0ge251bWJlcn0gbWVhbiAtIOC4hOC5iOC4suC5gOC4ieC4peC4teC5iOC4ouC4guC4reC4h+C4geC4peC4uOC5iOC4oQogKiBAcGFyYW0ge251bWJlcn0gc3RkRGV2IC0g4Liq4LmI4Lin4LiZ4LmA4Lia4Li14LmI4Lii4LiH4LmA4Lia4LiZ4Lih4Liy4LiV4Lij4LiQ4Liy4LiZ4LiC4Lit4LiH4LiB4Lil4Li44LmI4LihCiAqIEByZXR1cm5zIHtudW1iZXJ8bnVsbH0g4LiE4LmI4LiyIFotU2NvcmUg4Lir4Lij4Li34LitIG51bGwg4LiW4LmJ4Liy4LiE4Liz4LiZ4Lin4LiT4LmE4Lih4LmI4LmE4LiU4LmJCiAqLwpmdW5jdGlvbiBjYWxjdWxhdGVaU2NvcmUoc2NvcmUsIG1lYW4sIHN0ZERldikgewogICAgaWYgKHN0ZERldiA9PT0gMCkgcmV0dXJuIDA7IC8vIOC4luC5ieC4suC4l+C4uOC4geC4hOC4meC5hOC4lOC5ieC4hOC4sOC5geC4meC4meC5gOC4l+C5iOC4suC4geC4seC4mSBaLXNjb3JlIOC4hOC4t+C4rSAwCiAgICByZXR1cm4gKHNjb3JlIC0gbWVhbikgLyBzdGREZXY7Cn0KCi8qKgogKiDguITguLPguJnguKfguJMgVC1TY29yZQogKiBAcGFyYW0ge251bWJlcn0gelNjb3JlIC0g4LiE4LmI4LiyIFotU2NvcmUKICogQHJldHVybnMge251bWJlcn0g4LiE4LmI4LiyIFQtU2NvcmUKICovCmZ1bmN0aW9uIGNhbGN1bGF0ZVRTY29yZSh6U2NvcmUpIHsKICAgIHJldHVybiAoMTAgKiB6U2NvcmUpICsgNTA7Cn0KCmZ1bmN0aW9uIHNob3dTdGFycmVkUHJvamVjdFZpZXcoKSB7CiAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0SWQgPSAnc3RhcnJlZCc7IC8vIOC4leC4seC5ieC4hyBJRCDguJ7guLTguYDguKjguKkKICAgICAgICAgICAgY3VycmVudFByb2plY3REYXRhID0gbnVsbDsgLy8g4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmC4Lib4Lij4LmA4LiI4LiE4LiI4Lij4Li04LiH4LmGCgogICAgICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLLguKvguLHguKfguILguYnguK3guYHguKXguLDguYHguKrguJTguIcgdmlldwogICAgICAgICAgICBwcm9qZWN0VGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiV4Li04LiU4LiU4Liy4LinJzsKICAgICAgICAgICAgcHJvamVjdElkRGlzcGxheS50ZXh0Q29udGVudCA9ICdwaW5uZWQtaXRlbXMnOwogICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKCiAgICAgICAgICAgIC8vIOC4i+C5iOC4reC4meC5geC4l+C5h+C4muC4l+C4teC5iOC5hOC4oeC5iOC5gOC4geC4teC5iOC4ouC4p+C4guC5ieC4reC4hwogICAgICAgICAgICBtYW5hZ2VUYWIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGxlYWRlcmJvYXJkVGFiLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4Lia4Lix4LiH4LiE4Lix4Lia4LmD4Lir4LmJ4LmE4Lib4LiX4Li14LmI4LmB4LiX4LmH4LiaICLguJzguKXguKXguLHguJ7guJjguYwiICjguIvguLbguYjguIfguIHguYfguITguLfguK3guKPguLLguKLguIHguLLguKPguYHguJrguJrguJfguJTguKrguK3guJopCiAgICAgICAgICAgIHN3aXRjaFByb2plY3RUYWIoJ3Jlc3VsdHMnKTsKCQkJcmVuZGVyUXVpenplcygpOyAvLyDguKrguLHguYjguIfguYPguKvguYnguKfguLLguJTguKPguLLguKLguIHguLLguKPguYHguJrguJrguJfguJTguKrguK3guJrguYPguKvguKHguYjguJTguYnguKfguKLguILguYnguK3guKHguLnguKXguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBbIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQphc3luYyBmdW5jdGlvbiBsb2FkUHJvamVjdERldGFpbHMocHJvamVjdElkKSB7CiAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgcHJvamVjdElkKTsKICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgIG1hbmFnZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBsZWFkZXJib2FyZFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICBwcm9qZWN0VGl0bGUudGV4dENvbnRlbnQgPSBjdXJyZW50UHJvamVjdERhdGEucHJvamVjdE5hbWU7CiAgICAgICAgcHJvamVjdElkRGlzcGxheS50ZXh0Q29udGVudCA9IHByb2plY3RJZDsKICAgICAgICAKICAgICAgICBjb25zdCBzZXR0aW5ncyA9IGN1cnJlbnRQcm9qZWN0RGF0YS5zZXR0aW5ncyB8fCB7fTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2h1ZmZsZS1zZXR0aW5nLXNlbGVjdCcpLnZhbHVlID0gc2V0dGluZ3Muc2h1ZmZsZVNldHRpbmcgfHwgJ25vbmUnOwogICAgICAgIAogICAgICAgIGNvbnN0IHNob3dJbkRhc2hib2FyZENoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctaW4tc3R1ZGVudC1kYXNoYm9hcmQtY2hlY2tib3gnKTsKICAgICAgICBzaG93SW5EYXNoYm9hcmRDaGVja2JveC5jaGVja2VkID0gc2V0dGluZ3Muc2hvd0luU3R1ZGVudERhc2hib2FyZCAhPT0gZmFsc2U7CgogICAgICAgIGNvbnN0IGVuYWJsZVBhc3Njb2RlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW5hYmxlLXBhc3Njb2RlLWNoZWNrYm94Jyk7CiAgICAgICAgY29uc3QgcGFzc2NvZGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc2NvZGUtaW5wdXQtY29udGFpbmVyJyk7CiAgICAgICAgY29uc3QgcGFzc2NvZGVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXBhc3Njb2RlLWlucHV0Jyk7CgogICAgICAgIGNvbnN0IGlzUGFzc2NvZGVFbmFibGVkID0gc2V0dGluZ3MuaXNQYXNzY29kZUVuYWJsZWQgfHwgZmFsc2U7CiAgICAgICAgZW5hYmxlUGFzc2NvZGVDaGVja2JveC5jaGVja2VkID0gaXNQYXNzY29kZUVuYWJsZWQ7CiAgICAgICAgcGFzc2NvZGVJbnB1dC52YWx1ZSA9IHNldHRpbmdzLnBhc3Njb2RlIHx8ICcnOwogICAgICAgIHBhc3Njb2RlQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFpc1Bhc3Njb2RlRW5hYmxlZCk7CgogICAgICAgIGVuYWJsZVBhc3Njb2RlQ2hlY2tib3gub25jaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgICAgIHBhc3Njb2RlQ29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFlbmFibGVQYXNzY29kZUNoZWNrYm94LmNoZWNrZWQpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5gOC4nuC4t+C5iOC4reC5guC4q+C4peC4lOC4hOC5iOC4suC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5iSDilrzilrzilrwKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLWNoZWNrYm94JykuY2hlY2tlZCA9IHNldHRpbmdzLmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkIHx8IGZhbHNlOwoKICAgICAgICBpZiAodW5zdWJzY3JpYmVTdHVkZW50c0xpc3RlbmVyKSB1bnN1YnNjcmliZVN0dWRlbnRzTGlzdGVuZXIoKTsKICAgICAgICBpZiAodW5zdWJzY3JpYmVRdWl6emVzTGlzdGVuZXIpIHVuc3Vic2NyaWJlUXVpenplc0xpc3RlbmVyKCk7CiAgICAgICAgaWYgKHVuc3Vic2NyaWJlU3R1ZGVudFByb2ZpbGVzTGlzdGVuZXIpIHVuc3Vic2NyaWJlU3R1ZGVudFByb2ZpbGVzTGlzdGVuZXIoKTsKICAgICAgICBsaXN0ZW5Gb3JTdHVkZW50cyhwcm9qZWN0SWQpOwogICAgICAgIGxpc3RlbkZvclByb2plY3RRdWl6emVzKHByb2plY3RJZCk7CiAgICAgICAgbGlzdGVuRm9yU3R1ZGVudFByb2ZpbGVzKHByb2plY3RJZCk7CiAgICB9IGVsc2UgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguYLguJvguKPguYDguIjguIQiKTsKICAgICAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlc2V0UHJvamVjdE9yZGVyKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVG9nZ2xlUGluUHJvamVjdChwcm9qZWN0SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVsZXRlUHJvamVjdChwcm9qZWN0SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKICAgICAgICAKICAgICAgICAvLyAtLS0gU2V0dGluZ3MgJiBTdHVkZW50IE1hbmFnZW1lbnQgaW4gUHJvamVjdCAtLS0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWN1cnJlbnRQcm9qZWN0SWQpIHJldHVybjsKICAgIGNvbnN0IHNldHRpbmdzID0gewogICAgICAgIGRlZmF1bHROdW1RdWVzdGlvbnM6IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW0tcXVlc3Rpb25zJykudmFsdWUpLAogICAgICAgIGRlZmF1bHROdW1DaG9pY2VzOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLWNob2ljZXMnKS52YWx1ZSksCiAgICAgICAgZGVmYXVsdFBhc3NpbmdTY29yZTogcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3Npbmctc2NvcmUtaW5wdXQnKS52YWx1ZSksCiAgICAgICAgcmVzdWx0c0Rpc3BsYXk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLWRpc3BsYXktc2VsZWN0JykudmFsdWUsCiAgICAgICAgc2h1ZmZsZVNldHRpbmc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaHVmZmxlLXNldHRpbmctc2VsZWN0JykudmFsdWUsCiAgICAgICAgdGltZXJNb2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItbW9kZS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICB0aW1lckR1cmF0aW9uOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZHVyYXRpb24taW5wdXQnKS52YWx1ZSksCiAgICAgICAgLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oSBwcm9wZXJ0eSDguJnguLXguYnguYDguILguYnguLLguYTguJsg4pa84pa84pa8CiAgICAgICAgaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWRlbmNlLXNjb3JpbmctY2hlY2tib3gnKS5jaGVja2VkLAoJCWNvbmZpZGVuY2VNb2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1tb2RlLXNlbGVjdCcpLnZhbHVlCiAgICB9OwogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgY3VycmVudFByb2plY3RJZCk7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsgc2V0dGluZ3MgfSk7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC5geC4peC5ieC4pyIpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgc2V0dGluZ3M6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguYTguJTguYkiKTsKICAgIH0KfSk7CgogICAgICAgIGZ1bmN0aW9uIGxpc3RlbkZvclN0dWRlbnRzKHByb2plY3RJZCkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgcHJvamVjdElkKTsKICAgICAgICAgICAgdW5zdWJzY3JpYmVTdHVkZW50c0xpc3RlbmVyID0gb25TbmFwc2hvdChwcm9qZWN0UmVmLCAoZG9jKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZG9jLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBkb2MuZGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0RGF0YSA9IHByb2plY3REYXRhOyAKICAgICAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50TGlzdChwcm9qZWN0RGF0YS5zdHVkZW50cyB8fCBbXSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlclN0dWRlbnRMaXN0KHN0dWRlbnRzKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtc3R1ZGVudC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvamVjdElkKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnROYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1uYW1lLWlucHV0Jyk7CiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnROYW1lc1RleHQgPSBzdHVkZW50TmFtZUlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFzdHVkZW50TmFtZXNUZXh0KSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmD4Liq4LmI4LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG5ld1N0dWRlbnRzID0gc3R1ZGVudE5hbWVzVGV4dC5zcGxpdCgnXG4nKS5tYXAobmFtZSA9PiBuYW1lLnRyaW0oKSkuZmlsdGVyKG5hbWUgPT4gbmFtZSk7CiAgICAgICAgICAgIGlmIChuZXdTdHVkZW50cy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgY3VycmVudFByb2plY3RJZCk7CiAgICAgICAgICAgICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwogICAgICAgICAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U3R1ZGVudHMgPSBkb2NTbmFwLmRhdGEoKS5zdHVkZW50cyB8fCBbXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU3R1ZGVudHMgPSBbLi4ubmV3IFNldChbLi4uY3VycmVudFN0dWRlbnRzLCAuLi5uZXdTdHVkZW50c10pXTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgeyBzdHVkZW50czogdXBkYXRlZFN0dWRlbnRzIH0pOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnROYW1lSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGFkZGluZyBzdHVkZW50czoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmA4Lie4Li04LmI4Lih4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmE4LiU4LmJIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCQkKCQkvLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAovKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmI4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiU4LmJ4Lin4Lii4LiV4LiZ4LmA4Lit4LiHCiAqIEBwYXJhbSB7c3RyaW5nfSBmaXJzdFF1aXpJZCAtIElEIOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC5geC4o+C4geC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC4geC4lOC4m+C4uOC5iOC4oQogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWFudWFsUXVpelBhaXJpbmcoZmlyc3RRdWl6SWQpIHsKICAgIGNvbnN0IHBhaXJpbmdNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsgLy8g4LmA4Lij4Liy4LiI4Liw4LmD4LiK4LmJIE1vZGFsIOC5gOC4lOC4tOC4oQogICAgY29uc3QgcHJvamVjdFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotcHJvamVjdC1zZWxlY3QnKTsKICAgIGNvbnN0IG1vZGFsVGl0bGUgPSBwYWlyaW5nTW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CiAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1vdmUtcXVpei1idG4nKTsKCiAgICAvLyAxLiDguYDguJvguKXguLXguYjguKLguJnguILguYnguK3guITguKfguLLguKHguYPguJkgTW9kYWwg4LmD4Lir4LmJ4LmA4Lir4Lih4Liy4Liw4Liq4Lih4LiB4Lix4Lia4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmICiAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C4iOC4seC4muC4hOC4ueC5iOC5gOC4nuC4t+C5iOC4reC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4muC4nOC4pSc7CiAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPuC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lOC4o+C4suC4ouC4geC4suC4oy4uLjwvb3B0aW9uPic7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4ouC4t+C4meC4ouC4seC4meC4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iCc7CiAgICBwYWlyaW5nTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8gMi4g4LmB4Liq4LiU4LiH4Lij4Liy4Lii4LiB4Liy4Lij4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lit4Li34LmI4LiZ4LmGIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4meC5guC4m+C4o+C5gOC4iOC4hOC4meC4teC5iSAo4Lii4LiB4LmA4Lin4LmJ4LiZ4LiV4Lix4Lin4LmA4Lit4LiHKQogICAgY29uc3QgcG90ZW50aWFsUGFpcnMgPSBhbGxRdWl6emVzLmZpbHRlcihxID0+IHEuaWQgIT09IGZpcnN0UXVpeklkKTsKCiAgICBpZiAocG90ZW50aWFsUGFpcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guYTguKHguYjguKHguLXguYHguJrguJrguJfguJTguKrguK3guJrguK3guLfguYjguJnguYPguKvguYnguIjguLHguJrguITguLnguYg8L29wdGlvbj4nOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgfSBlbHNlIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC4iOC4sOC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4miAtLTwvb3B0aW9uPicgKwogICAgICAgICAgICBwb3RlbnRpYWxQYWlycy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnRvcGljfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLyAzLiDguKrguKPguYnguLLguIcgRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4LiB4Liy4Lij4Lii4Li34LiZ4Lii4Lix4LiZICjguJfguLPguIfguLLguJnguYHguITguYjguITguKPguLHguYnguIfguYDguJTguLXguKLguKcpCiAgICBjb25zdCBjb25maXJtUGFpcmluZ0hhbmRsZXIgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgY29uc3Qgc2Vjb25kUXVpeklkID0gcHJvamVjdFNlbGVjdC52YWx1ZTsKICAgICAgICBpZiAoIXNlY29uZFF1aXpJZCkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmIIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4LiB4Liz4Lil4Lix4LiH4LiI4Lix4Lia4LiE4Li54LmILi4uJzsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgZmlyc3RRdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBmaXJzdFF1aXpJZCk7CiAgICAgICAgICAgIGNvbnN0IHNlY29uZFF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIHNlY29uZFF1aXpJZCk7CgogICAgICAgICAgICAvLyDguJrguLHguJnguJfguLbguIHguIHguLLguKPguIjguLHguJrguITguLnguYjguYHguJrguJrguKrguK3guIfguJfguLLguIcgKFR3by13YXkgYmluZGluZykKICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgICAgICAgICAgYmF0Y2gudXBkYXRlKGZpcnN0UXVpelJlZiwgeyBwYWlyZWRRdWl6SWQ6IHNlY29uZFF1aXpJZCB9KTsKICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHNlY29uZFF1aXpSZWYsIHsgcGFpcmVkUXVpeklkOiBmaXJzdFF1aXpJZCB9KTsKICAgICAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiI4Lix4Lia4LiE4Li54LmI4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Liq4Liz4LmA4Lij4LmH4LiIISIpOwogICAgICAgICAgICBwYWlyaW5nTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CgogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHBhaXJpbmcgcXVpenplczoiLCBlcnJvcik7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguIjguLHguJrguITguLnguYgiKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyDguITguLfguJnguITguYjguLIgTW9kYWwg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4Lib4LiB4LiV4Li04Liq4Liz4Lir4Lij4Lix4Lia4LiB4Liy4Lij4LmD4LiK4LmJ4LiH4Liy4LiZICLguKLguYnguLLguKIiIOC5g+C4meC4hOC4o+C4seC5ieC4h+C4leC5iOC4reC5hOC4mwogICAgICAgICAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4ouC5geC4muC4muC4l+C4lOC4quC4reC4muC5hOC4m+C5guC4m+C4o+C5gOC4iOC4hOC4reC4t+C5iOC4mSc7CiAgICAgICAgICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4LiiJzsKICAgICAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAvLyDguKXguJogTGlzdGVuZXIg4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LiC4Li24LmJ4LiZ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4Lin4Lit4Lit4LiBCiAgICAgICAgICAgIGNvbmZpcm1CdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtUGFpcmluZ0hhbmRsZXIpOwogICAgICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKICAgICAgICB9CiAgICB9OwogICAgCiAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguITguLfguJnguITguYjguLIgTW9kYWwg4LmA4Lih4Li34LmI4Lit4LiB4LiU4Lii4LiB4LmA4Lil4Li04LiBCiAgICBjb25zdCBjbGVhbnVwID0gKCkgPT4gewogICAgICAgIHBhaXJpbmdNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4ouC5geC4muC4muC4l+C4lOC4quC4reC4muC5hOC4m+C5guC4m+C4o+C5gOC4iOC4hOC4reC4t+C5iOC4mSc7CiAgICAgICAgY29uZmlybUJ0bi50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKInOwogICAgICAgIGNvbmZpcm1CdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtUGFpcmluZ0hhbmRsZXIpOwogICAgICAgIGNhbmNlbEJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFudXApOwogICAgfTsKCiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybVBhaXJpbmdIYW5kbGVyKTsKICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFudXApOwp9Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgg4pay4pay4payCgogICAgICAgIGZ1bmN0aW9uIGhhbmRsZURlbGV0ZVN0dWRlbnQoc3R1ZGVudE5hbWUpIHsKICAgICAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgICAgIGDguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguJnguLHguIHguYDguKPguLXguKLguJnguIrguLfguYjguK0gIiR7c3R1ZGVudE5hbWV9Ij8g4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liw4LmB4LiZ4LiZ4LmB4Lil4Liw4Lib4LmJ4Liy4Lii4Lij4Liy4LiH4Lin4Lix4Lil4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJ4LiI4Liw4LiW4Li54LiB4Lil4Lia4LmE4Lib4LiU4LmJ4Lin4LiiYCwKICAgICAgICAgICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRQcm9qZWN0SWQgfHwgIWN1cnJlbnRQcm9qZWN0RGF0YSkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTdHVkZW50cyA9IGN1cnJlbnRQcm9qZWN0RGF0YS5zdHVkZW50cy5maWx0ZXIocyA9PiBzICE9PSBzdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50UHJvZmlsZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0cy8ke2N1cnJlbnRQcm9qZWN0SWR9L3N0dWRlbnRQcm9maWxlc2AsIHN0dWRlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShwcm9qZWN0UmVmLCB7IHN0dWRlbnRzOiB1cGRhdGVkU3R1ZGVudHMgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLmRlbGV0ZShzdHVkZW50UHJvZmlsZVJlZik7IC8vIEFsc28gZGVsZXRlIHRoZWlyIHByb2ZpbGUgZm9yIHRoZSBsZWFkZXJib2FyZAogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBiYXRjaC5jb21taXQoKTsKCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgc3R1ZGVudDoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKXguJrguJnguLHguIHguYDguKPguLXguKLguJkiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVEZWxldGVBbGxTdHVkZW50cygpIHsKICAgICAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgICAgIGDguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguJnguLHguIHguYDguKPguLXguKLguJnguJfguLHguYnguIfguKvguKHguJTguYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYk/IOC4geC4suC4o+C4geC4o+C4sOC4l+C4s+C4meC4teC5ieC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4ouC5ieC4reC4meC4geC4peC4seC4muC5hOC4lOC5iWAsCiAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvamVjdElkKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9maWxlc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHMvJHtjdXJyZW50UHJvamVjdElkfS9zdHVkZW50UHJvZmlsZXNgKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvZmlsZXNSZWYpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHByb2plY3RSZWYsIHsgc3R1ZGVudHM6IFtdIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlc1NuYXBzaG90LmZvckVhY2goZG9jID0+IGJhdGNoLmRlbGV0ZShkb2MucmVmKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBhbGwgc3R1ZGVudHM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4Lia4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCi8vIOKWvOKWvOKWvCBTVEFSVDog4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Liq4Liz4Lir4Lij4Lix4Lia4Lif4Li14LmA4LiI4Lit4Lij4LmMICLguKrguKPguYnguLLguIfguYHguKLguIHguYDguJnguLfguYnguK3guKvguLLguIjguLLguIHguYTguJ/guKXguYwiIOKWvOKWvOKWvAoKLy8gMS4g4Liq4Lij4LmJ4Liy4LiH4LiV4Lix4Lin4LmB4Lib4Lij4Liq4LmI4Lin4LiZ4LiB4Lil4Liy4LiH4LmA4Lie4Li34LmI4Lit4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lif4Lil4LmM4LmE4Lin4LmJ4LmD4LiK4LmJ4LiL4LmJ4LizCmxldCBleHRyYWN0ZWRGaWxlVG9waWNzID0gW107CmxldCBmaWxlRGF0YUJhc2U2NCA9IG51bGw7CmxldCBmaWxlTWltZVR5cGUgPSBudWxsOwoKCi8vIOKWvOKWvOKWvCBTVEFSVDog4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGFuYWx5emVGaWxlRm9yVG9waWNzIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKLyoqCiAqIOC4guC4seC5ieC4meC4leC4reC4meC4l+C4teC5iCAxOiDguKfguLTguYDguITguKPguLLguLDguKvguYzguYTguJ/guKXguYwgKOC4o+C4p+C4oeC4luC4tuC4h+C5hOC4n+C4peC5jOC4quC5geC4geC4mSkg4LmA4Lie4Li34LmI4Lit4LiU4Li24LiH4Lir4Lix4Lin4LiC4LmJ4Lit4Lit4Lit4LiB4Lih4LiyCiAqIEBwYXJhbSB7RmlsZX0gZmlsZSAtIOC5hOC4n+C4peC5jOC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC4reC4seC4m+C5guC4q+C4peC4lAogKi8KYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZUZpbGVGb3JUb3BpY3MoZmlsZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gcmVuZGVyRmlsZVRvcGljcygpIHsKICAgIGNvbnN0IHRvcGljc0xpc3REaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10b3BpY3MtbGlzdCcpOwogICAgaWYgKGV4dHJhY3RlZEZpbGVUb3BpY3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdG9waWNzTGlzdERpdi5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIiPuC5hOC4oeC5iOC4nuC4muC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4iuC4seC4lOC5gOC4iOC4meC5g+C4meC5hOC4n+C4peC5jOC4meC4teC5iTwvcD4nOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDguKrguKPguYnguLLguIcgSFRNTCDguJfguLXguYjguKHguLXguJfguLHguYnguIfguJvguLjguYjguKEgIuC4quC4o+C5ieC4suC4h+C5gOC4meC4t+C5ieC4reC4q+C4siIg4LmB4Lil4LiwICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiCiAgICB0b3BpY3NMaXN0RGl2LmlubmVySFRNTCA9IGV4dHJhY3RlZEZpbGVUb3BpY3MubWFwKHRvcGljID0+IGAKICAgICAgICA8ZGl2IGNsYXNzPSJwLTIgcm91bmRlZC1tZCBiZy1ncmF5LTUwIGJvcmRlciBib3JkZXItZ3JheS0yMDAgZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIj4KICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCBmbGV4LWdyb3cgdGV4dC1sZWZ0Ij4ke3RvcGljfTwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgZmxleC1zaHJpbmstMCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJnZW5lcmF0ZS1jb250ZW50LWJ0biB0ZXh0LWJsdWUtODAwIGJnLWJsdWUtMTAwIGhvdmVyOmJnLWJsdWUtMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xLjUgcHgtMyByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xLjUiIGRhdGEtdG9waWM9IiR7ZXNjYXBlKHRvcGljKX0iPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIj48L2k+4Liq4Lij4LmJ4Liy4LiH4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lit4LiZCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImZpbGUtdG9waWMtc2VsZWN0aW9uLWJ0biB0ZXh0LWluZGlnby04MDAgYmctaW5kaWdvLTEwMCBob3ZlcjpiZy1pbmRpZ28tMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xLjUgcHgtMyByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xLjUiIGRhdGEtdG9waWM9IiR7ZXNjYXBlKHRvcGljKX0iPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZmlsZS1hbHQiPjwvaT7guKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGApLmpvaW4oJycpOwp9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGdlbmVyYXRlSHlicmlkUXVpekZvclRvcGljIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVIeWJyaWRRdWl6Rm9yVG9waWMoc2VsZWN0ZWRUb3BpYykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVGcm9tRmlsZUNsaWNrKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gYXV0b0Zvcm1hdE1hdGgodGV4dCkgewogICAgaWYgKHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJyB8fCAhdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIC8vIFJlZ2V4IOC4meC4teC5ieC4iOC4sOC4oeC4reC4h+C4q+C4suC4meC4tOC4nuC4iOC4meC5jOC4l+C4teC5iOC4nuC4muC4muC5iOC4reC4ouC5hiDguYDguIrguYjguJkgIuC4leC4seC4p+C5gOC4peC4giBcdGltZXMg4LiV4Lix4Lin4LmA4Lil4LiCIiwgIuC4leC4seC4p+C5gOC4peC4gl7guJXguLHguKfguYDguKXguIIiLCDguKvguKPguLfguK3guITguLPguKrguLHguYjguIcgTGFUZVggCiAgICAvLyDguYLguJTguKLguIjguLDguJfguLPguIfguLLguJnguYDguInguJ7guLLguLDguIHguLHguJrguKrguYjguKfguJnguJfguLXguYjguKLguLHguIfguYTguKHguYjguYTguJTguYnguJbguLnguIHguITguKPguK3guJrguJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKIgJCDguK3guKLguLnguYjguYHguKXguYnguKcKICAgIGNvbnN0IG1hdGhQYXR0ZXJuID0gLygoPzwhXCQpXGIoXGQrKFwuXGQrKT9ccyooXFx0aW1lc3xcXGRpdilccypcZCsoXC5cZCspP3woXGQrXHMqXF5ccypcez9cZCtcfT8pfChcXGZyYWN8XFxzcXJ0fFxccG18XFxnZXF8XFxsZXF8XFxuZXEpKVxiKD8hXCQpKS9nOwoKICAgIGxldCBmb3JtYXR0ZWRUZXh0ID0gdGV4dC5yZXBsYWNlKG1hdGhQYXR0ZXJuLCAobWF0Y2gpID0+IHsKICAgICAgICAvLyDguITguKPguK3guJrguJnguLTguJ7guIjguJnguYzguJfguLXguYjguKvguLLguYDguIjguK3guJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKIgJAogICAgICAgIHJldHVybiBgJCR7bWF0Y2gudHJpbSgpfSRgOwogICAgfSk7CgogICAgcmV0dXJuIGZvcm1hdHRlZFRleHQ7Cn0KCiAgICAgICAgZnVuY3Rpb24gc2FuaXRpemVRdWl6RGF0YShxdWl6RGF0YSkgewogICAgaWYgKCFxdWl6RGF0YSB8fCAhcXVpekRhdGEucXVlc3Rpb25zKSByZXR1cm4gcXVpekRhdGE7CgogICAgY29uc3Qgc2FuaXRpemVUZXh0ID0gKHRleHQpID0+IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJykgcmV0dXJuIHRleHQ7CiAgICAgICAgICAgIGxldCBzID0gdGV4dDsKCiAgICAgICAgICAgIC8vIDEuIOC5geC4m+C4peC4h+C4p+C4h+C5gOC4peC5h+C4miBcKCAuLi4gXCkg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZICQgLi4uICQgKOC4guC4reC4h+C5gOC4lOC4tOC4oSkKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFxcKC9nLCAnJCcpLnJlcGxhY2UoL1xcXCkvZywgJyQnKTsKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFxcWy9nLCAnJCQnKS5yZXBsYWNlKC9cXFxdL2csICckJCcpOwoKICAgICAgICAgICAgLy8gMi4g4LmB4LiB4LmJ4LmE4LiCIGltZXMg4LmA4Lib4LmH4LiZIHRpbWVzICjguILguK3guIfguYDguJTguLTguKHguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcg4LmB4LiV4LmI4Lit4Liy4LiI4LmE4Lih4LmI4LiE4Lij4Lit4Lia4LiE4Lil4Li44LihKQogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9pbWVzXGIvZywgJ1xcdGltZXMnKTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDilrzilrzilrwgW+C5gOC4nuC4tOC5iOC4oeC4iuC4uOC4lOC4hOC4s+C4quC4seC5iOC4h+C4i+C5iOC4reC4oeC5geC4i+C4oeC4hOC4s+C4quC4seC5iOC4hyBMYVRlWCDguJfguLXguYggQmFja3NsYXNoIOC4q+C4suC4ouC5hOC4m10g4pa84pa84pa8CiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UoL1xcP3RleHRcYi9nLCAnXFx0ZXh0Jyk7ICAgLy8g4LmB4LiB4LmJIGV4dCAtPiBcdGV4dAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9zcXJ0XGIvZywgJ1xcc3FydCcpOyAgIC8vIOC5geC4geC5iSBzcXJ0IC0+IFxzcXJ0CiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UoL1xcP2ZyYWNcYi9nLCAnXFxmcmFjJyk7ICAgLy8g4LmB4LiB4LmJIGZyYWMgLT4gXGZyYWMKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/Y2RvdFxiL2csICdcXGNkb3QnKTsgICAvLyDguYHguIHguYkgY2RvdCAtPiBcY2RvdAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9waVxiL2csICdcXHBpJyk7ICAgICAgIC8vIOC5geC4geC5iSBwaSAtPiBccGkKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/ZGl2XGIvZywgJ1xcZGl2Jyk7ICAgICAvLyDguYHguIHguYkgZGl2IC0+IFxkaXYKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/bGVxXGIvZywgJ1xcbGVxJyk7ICAgICAvLyDguYHguIHguYkgbGVxIC0+IFxsZXEKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/Z2VxXGIvZywgJ1xcZ2VxJyk7ICAgICAvLyDguYHguIHguYkgZ2VxIC0+IFxnZXEKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/YXBwcm94XGIvZywgJ1xcYXBwcm94Jyk7IC8vIOC5geC4geC5iSBhcHByb3ggLT4gXGFwcHJveAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9uZVxiL2csICdcXG5lJyk7ICAgICAgIC8vIOC5geC4geC5iSBuZSAtPiBcbmUKICAgICAgICAgICAgLy8g4pay4pay4payCgogICAgICAgICAgICAvLyAzLiBBdXRvIEZvcm1hdCAo4LiI4Lix4Lia4LiV4Lix4Lin4LmA4Lil4LiCL+C4quC4ueC4leC4o+C4l+C4teC5iOC4peC4reC4ouC5hiDguKHguLLguYPguKrguYggJCDguYPguKvguYkpCiAgICAgICAgICAgIGNvbnN0IG1hdGhQYXR0ZXJuID0gLygoPzwhXCQpXGIoXGQrKFwuXGQrKT9ccyooXFx0aW1lc3xcXGRpdnxcXGNkb3QpXHMqXGQrKFwuXGQrKT98KFxcZnJhY1x7Lis/XH1cey4rP1x9KXwoXFxzcXJ0XHsuKz9cfSl8KFxcdGV4dFx7Lis/XH0pfChcXHBtfFxcZ2VxfFxcbGVxfFxcbmVxKSlcYig/IVwkKSkvZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UobWF0aFBhdHRlcm4sIChtYXRjaCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGAkJHttYXRjaC50cmltKCl9JGA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfTsKCiAgICBpZiAocXVpekRhdGEudG9waWMpIHsKICAgICAgICBxdWl6RGF0YS50b3BpYyA9IHNhbml0aXplVGV4dChxdWl6RGF0YS50b3BpYyk7CiAgICB9CgogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgcS5xdWVzdGlvblRleHQgPSBzYW5pdGl6ZVRleHQocS5xdWVzdGlvblRleHQpOwogICAgICAgIHEuc3RlbSA9IHNhbml0aXplVGV4dChxLnN0ZW0pOwogICAgICAgIAogICAgICAgIGlmIChxLm9wdGlvbnMpIHsKICAgICAgICAgICAgcS5vcHRpb25zID0gcS5vcHRpb25zLm1hcChvcHQgPT4gc2FuaXRpemVUZXh0KG9wdCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocS5leHBsYW5hdGlvbikgewogICAgICAgICAgICBxLmV4cGxhbmF0aW9uID0gc2FuaXRpemVUZXh0KHEuZXhwbGFuYXRpb24pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocS5jb3JyZWN0UmVzcG9uc2UpIHsKICAgICAgICAgICAgcS5jb3JyZWN0UmVzcG9uc2UgPSBzYW5pdGl6ZVRleHQocS5jb3JyZWN0UmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICBpZiAocS5hbGxSZXNwb25zZXMpIHsKICAgICAgICAgICAgcS5hbGxSZXNwb25zZXMgPSBxLmFsbFJlc3BvbnNlcy5tYXAocmVzcCA9PiBzYW5pdGl6ZVRleHQocmVzcCkpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAocS5pZGVhbEFuc3dlcikgewogICAgICAgICAgICAgcS5pZGVhbEFuc3dlciA9IHNhbml0aXplVGV4dChxLmlkZWFsQW5zd2VyKTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gcXVpekRhdGE7Cn0KCiAgICAgICAgLy8gLS0tIFF1aXogR2VuZXJhdGlvbiAoQWRtaW4pIC0tLQogICAgICAgIGNvbnN0IHNpbXBsZU1hdGhQcm9tcHQgPSAi4LiB4LiO4LmA4Lir4Lil4LmH4LiBOiDguJnguLTguJ7guIjguJnguYzguJfguLLguIfguITguJPguLTguJXguKjguLLguKrguJXguKPguYzguJfguLHguYnguIfguKvguKHguJTguJXguYnguK3guIfguK3guKLguLnguYjguYPguJnguKPguLnguJvguYHguJrguJogTGFUZVgg4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHIOC5geC4peC4sOC4leC5ieC4reC4h+C4luC4ueC4geC4q+C5iOC4reC4q+C4uOC5ieC4oeC4lOC5ieC4p+C4ouC5gOC4hOC4o+C4t+C5iOC4reC4h+C4q+C4oeC4suC4ouC4lOC4reC4peC4peC4suC4o+C5jCAoJCkg4LmA4Lie4Li14Lii4LiH4LiE4Li54LmI4LmA4LiU4Li14Lii4LinIjsKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlRnJvbUxpbmsoKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiBleHRyYWN0VGV4dEZyb21IdG1sKGh0bWxTdHJpbmcpIHsKICAgIGNvbnN0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoaHRtbFN0cmluZywgJ3RleHQvaHRtbCcpOwogICAgCiAgICAvLyDguKXguJrguYHguJfguYfguIHguJfguLXguYjguYTguKHguYjguJXguYnguK3guIfguIHguLLguKPguK3guK3guIHguYTguJvguIHguYjguK3guJkg4LmA4LiK4LmI4LiZIHNjcmlwdCwgc3R5bGUsIG5hdiwgZm9vdGVyCiAgICBkb2MucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0LCBzdHlsZSwgbmF2LCBmb290ZXIsIGhlYWRlciwgYXNpZGUnKS5mb3JFYWNoKGVsID0+IGVsLnJlbW92ZSgpKTsKICAgIAogICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiI4Liy4LiBIGJvZHkKICAgIHJldHVybiBkb2MuYm9keS50ZXh0Q29udGVudCB8fCAiIjsKfQoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tdG9waWMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAvLyDguJTguLbguIfguITguYjguLLguIjguLLguIHguIrguYjguK3guIfguKvguLHguKfguILguYnguK3guKvguKXguLHguIHguYDguJ7guLXguKLguIfguK3guKLguYjguLLguIfguYDguJTguLXguKLguKcKICAgIGNvbnN0IHRvcGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLWlucHV0JykudmFsdWUudHJpbSgpOwoKICAgIC8vIOC5hOC4oeC5iOC4leC5ieC4reC4h+C4oeC4teC4geC4suC4o+C4leC4o+C4p+C4iOC4quC4reC4muC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5g+C4lOC5hiDguJfguLXguYjguJnguLXguYgKICAgIC8vIOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBnZW5lcmF0ZVF1aXog4LmC4LiU4Lii4LiV4Lij4LiHCiAgICAvLyDguKvguLLguIEgJ3RvcGljJyDguYDguJvguYfguJnguITguYjguLLguKfguYjguLLguIcgKCcnKSDguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVRdWl6IOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4pwogICAgLy8g4LiI4Liw4LiI4Lix4LiU4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICLguITguKfguLLguKHguKPguLnguYnguJfguLHguYjguKfguYTguJsiIOC5g+C4q+C5ieC5gOC4reC4hwogICAgZ2VuZXJhdGVRdWl6KHRvcGljLCBudWxsKTsKfSk7CgogICAgLy8g4pa84pa84pa8LS0tIOC4p+C4suC4h+C5guC4hOC5ieC4lOC5g+C4q+C4oeC5iOC4leC5iOC4reC4l+C5ieC4suC4ouC4leC4o+C4h+C4meC4teC5ieC5hOC4lOC5ieC5gOC4peC4oiAtLS3ilrzilrzilrwKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXRleHQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgY29uc3QgdGV4dENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGV4dC1jb250ZW50LWlucHV0JykudmFsdWUudHJpbSgpOwogICAgICAgIGlmICghdGV4dENvbnRlbnQpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4p+C4suC4h+C5gOC4meC4t+C5ieC4reC4q+C4suC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRvcGljID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLWlucHV0JykudmFsdWUudHJpbSgpOwogICAgICAgIGdlbmVyYXRlUXVpeih0b3BpYywgdGV4dENvbnRlbnQpOwogICAgfSk7CgkKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBnZW5lcmF0ZVF1aXog4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVF1aXoodG9waWMsIHRleHRDb250ZW50LCBzaW5nbGVRdWVzdGlvbkluZGV4ID0gbnVsbCwgZXh0cmFQYXJ0cyA9IG51bGwsIGZyb21CbHVlcHJpbnRQYWdlID0gZmFsc2UsIGZvcmNlZFByb2plY3RJZCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsLCBmb3JjZUFwcGxpY2F0aW9uU3R5bGUgPSBmYWxzZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVRdWl6RnJvbUZpbGUobWltZVR5cGUsIGJhc2U2NERhdGEpIHsKICAgIC8vIOC4lOC4tuC4h+C4hOC5iOC4suC4q+C4seC4p+C4guC5ieC4reC4iOC4suC4gSBpbnB1dCBmaWVsZAogICAgY29uc3QgdG9waWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10b3BpYy1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKCiAgICBjb25zdCBxdWl6VHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXR5cGUtc2VsZWN0JykudmFsdWU7CiAgICBjb25zdCBudW1RdWVzdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpLnZhbHVlOwogICAgY29uc3QgbnVtQ2hvaWNlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW0tY2hvaWNlcycpLnZhbHVlOwogICAgY29uc3QgaW5jbHVkZUltYWdlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmNsdWRlLWltYWdlcy1jaGVja2JveCcpLmNoZWNrZWQ7CgogICAgY29uc3QgaXNOb3JtYWxUb3BpYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JjZS1tYXRoLWNoZWNrYm94JykuY2hlY2tlZDsKICAgIGNvbnN0IHN1YmplY3RQcmVmaXggPSBpc05vcm1hbFRvcGljID8gIiIgOiAi4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmMIjsKCiAgICBjb25zdCBpc09yaWdpbmFsTW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmlnaW5hbC1tb2RlLWNoZWNrYm94JykuY2hlY2tlZDsKCiAgICBsZXQgcHJvbXB0ID0gIiI7CiAgICBsZXQgc2NoZW1hOwoKICAgIGNvbnN0IGltYWdlSW5zdHJ1Y3Rpb24gPSBpbmNsdWRlSW1hZ2VzID8gYOC4quC4s+C4q+C4o+C4seC4muC5geC4leC5iOC4peC4sOC4hOC4s+C4luC4suC4oSDguKvguLLguIHguIjguLPguYDguJvguYfguJnguJXguYnguK3guIfguKHguLXguKPguLnguJvguKDguLLguJ7guJvguKPguLDguIHguK3guJogKOC5gOC4iuC5iOC4mSDguKPguLnguJvguYDguKPguILguLLguITguJPguLTguJUsIOC4geC4o+C4suC4nykg4LmD4Lir4LmJ4Liq4Lij4LmJ4Liy4LiH4LmC4LiE4LmJ4LiUIFNWRyDguJfguLXguYjguKrguKHguJrguLnguKPguJPguYzguKrguLPguKvguKPguLHguJrguKPguLnguJvguJnguLHguYnguJnguYYg4LmB4Lil4LmJ4Lin4LmD4Liq4LmI4LmE4Lin4LmJ4LmD4LiZIHByb3BlcnR5IOC4iuC4t+C5iOC4rSAiaW1hZ2VDb2RlIi4g4LiW4LmJ4Liy4LmE4Lih4LmI4LiI4Liz4LmA4Lib4LmH4LiZIOC5hOC4oeC5iOC4leC5ieC4reC4h+C5g+C4quC5iCBwcm9wZXJ0eSDguJnguLXguYkuYCA6ICcnOwoKICAgIGlmIChpc09yaWdpbmFsTW9kZSkgewogICAgICAgIC8vIC0tLSDwn5qAIOC5guC4q+C4oeC4lOC4quC4o+C5ieC4suC4h+C4leC5ieC4meC4ieC4muC4seC4miAoT3JpZ2luYWwgTW9kZSkgLS0tCiAgICAgICAgCiAgICAgICAgLy8gLS0tIOKtkO+4jyDguJnguLXguYjguITguLfguK3guIjguLjguJTguYDguJTguLXguKLguKfguJfguLXguYjguITguLjguJPguJXguYnguK3guIfguYHguIHguYnguYTguIIg4q2Q77iPIC0tLQogICAgICAgIHByb21wdCA9IGAK4Lia4LiX4Lia4Liy4LiXOiDguITguLjguJPguITguLfguK3guJzguLnguYnguYDguIrguLXguYjguKLguKfguIrguLLguI3guJTguYnguLLguJnguIHguLLguKPguKrguKPguYnguLLguIfguYDguInguKXguKLguYHguJrguJrguJfguJTguKrguK3guJoK4Lig4Liy4Lij4LiB4Li04LiIOiDguIjguLLguIHguYTguJ/guKXguYzguJfguLXguYjguYHguJnguJrguKHguLLguIvguLbguYjguIfguKHguLUgIuC5gOC4ieC4nuC4suC4sOC4hOC4s+C4luC4suC4oSIg4LiI4LiH4Liq4Lij4LmJ4Liy4LiHICLguYDguInguKXguKIiIOC5geC4peC4sOC4guC5ieC4reC4oeC4ueC4peC4l+C4teC5iOC4iOC4s+C5gOC4m+C5h+C4meC4quC4s+C4q+C4o+C4seC4muC5geC4leC5iOC4peC4sOC4guC5ieC4rQoK4LiE4Liz4Liq4Lix4LmI4LiHOgoxLiAg4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lib4Lij4Liw4LmA4Lig4LiX4LiC4Lit4LiH4LiE4Liz4LiW4Liy4Lih4LmB4LiV4LmI4Lil4Liw4LiC4LmJ4Lit4LmD4LiZ4LmE4Lif4Lil4LmMIOC4p+C5iOC4suC5gOC4m+C5h+C4meC4m+C4o+C4meC4seC4oiAobXVsdGlwbGVfY2hvaWNlKSwg4LmA4LiV4Li04Lih4LiE4LizIChzaG9ydF9hbnN3ZXIpLCDguYPguIrguYgv4LmE4Lih4LmI4LmD4LiK4LmIICh0cnVlX2ZhbHNlKSwg4Lir4Lij4Li34Lit4LiI4Lix4Lia4LiE4Li54LmIIChtYXRjaGluZ19pdGVtKQoyLiAg4LmD4LiK4LmJICLguILguYnguK3guITguKfguLLguKHguITguLPguJbguLLguKEiIOC5geC4peC4sCAi4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIiAo4LiW4LmJ4Liy4Lih4Li1KSDguIjguLLguIHguYTguJ/guKXguYzguJXguYnguJnguInguJrguLHguJrguYHguJrguJrguJXguKPguIfguJXguLHguKcg4Lir4LmJ4Liy4Lih4LiU4Lix4LiU4LmB4Lib4Lil4LiHCjMuICDguKrguLPguKvguKPguLHguJrguITguLPguJbguLLguKHguYHguJXguYjguKXguLDguILguYnguK0g4LmD4Lir4LmJ4LiE4Li44LiTICLguKrguKPguYnguLLguIfguYDguInguKXguKLguJfguLXguYjguJbguLnguIHguJXguYnguK3guIciIOC4guC4tuC5ieC4meC4oeC4suC5gOC4reC4hyDguJ7guKPguYnguK3guKHguJfguLHguYnguIcgIuC4hOC4s+C4reC4mOC4tOC4muC4suC4oiIg4LmA4Lir4LiV4Li44Lic4Lil4Lib4Lij4Liw4LiB4Lit4LiaCjQuICAqKuC4geC4juC4quC4s+C4hOC4seC4jTog4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Liz4LiW4Liy4Lih4Lib4Lij4Liw4LmA4Lig4LiXICfguYDguJXguLTguKHguITguLMnIChzaG9ydF9hbnN3ZXIpIOC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAoaWRlYWxBbnN3ZXIpIOC4l+C4teC5iOC4hOC4uOC4k+C4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4meC4leC5ieC4reC4h+C5gOC4m+C5h+C4meC4leC4seC4p+C5gOC4peC4guC4o+C4sOC4q+C4p+C5iOC4suC4hyAwLTk5OSDguYDguJfguYjguLLguJnguLHguYnguJkqKgo1LiAg4Liq4Lij4LmJ4Liy4LiH4Lic4Lil4Lil4Lix4Lie4LiY4LmM4LmA4Lib4LmH4LiZIEpTT04gb2JqZWN0IOC4l+C4teC5iOC4quC4oeC4muC4ueC4o+C4k+C5jCDguYLguJTguKLguYPguIrguYkgU2NoZW1hIOC4quC4s+C4q+C4o+C4seC4muC4hOC4s+C4luC4suC4oSAi4LmB4Lia4Lia4Lic4Liq4LihIChtaXhlZCkiCgoke2ltYWdlSW5zdHJ1Y3Rpb259CiR7c2ltcGxlTWF0aFByb21wdH0KYDsKICAgICAgICAvLyAtLS0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiI4Li44LiU4LmB4LiB4LmJ4LmE4LiCIC0tLQoKICAgICAgICAvLyDguYPguJnguYLguKvguKHguJTguJnguLXguYkg4LmA4Lij4Liy4LiI4Liw4LmD4LiK4LmJIFNjaGVtYSDguYHguJrguJrguJzguKrguKHguYDguKrguKHguK0g4LmA4Lie4Li34LmI4Lit4Lij4Lit4LiH4Lij4Lix4Lia4LiE4Liz4LiW4Liy4Lih4LiX4Li44LiB4Lib4Lij4Liw4LmA4Lig4LiXCiAgICAgICAgc2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBxdWVzdGlvblRleHQ6IHsgdHlwZTogIlNUUklORyIgfSwgcXVlc3Rpb25UeXBlOiB7IHR5cGU6ICJTVFJJTkciLCAiZW51bSI6IFsibXVsdGlwbGVfY2hvaWNlIiwgInNob3J0X2Fuc3dlciIsICJ0cnVlX2ZhbHNlIiwgIm1hdGNoaW5nX2l0ZW0iXSB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0sIGNvcnJlY3RBbnN3ZXI6IHsgdHlwZTogIkJPT0xFQU4iIH0sIHN0ZW06IHsgdHlwZTogIlNUUklORyIgfSwgY29ycmVjdFJlc3BvbnNlOiB7IHR5cGU6ICJTVFJJTkciIH0sIGFsbFJlc3BvbnNlczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0sIGltYWdlQ29kZTogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVHlwZSIsICJleHBsYW5hdGlvbiJdIH07CgogICAgfSBlbHNlIHsKICAgICAgICAvLyAtLS0g4pqZ77iPIOC5guC4q+C4oeC4lOC4m+C4geC4leC4tCAo4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4LiB4LmJ4LmE4LiCKSAtLS0KICAgICAgICBsZXQgdG9waWNJbnN0cnVjdGlvbiA9IGDguYDguIHguLXguYjguKLguKfguIHguLHguJrguKvguLHguKfguILguYnguK0gIiR7dG9waWN9ImA7CiAgICAgICAgaWYgKCF0b3BpYykgeyAKICAgICAgICAgICAgdG9waWNJbnN0cnVjdGlvbiA9ICLguYLguJTguKLguYPguKvguYkgQUkg4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Liy4Lir4Lix4Lin4LiC4LmJ4Lit4Lir4Lil4Lix4LiB4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LmC4LiU4Lii4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0IjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc3dpdGNoIChxdWl6VHlwZSkgewogICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgLy8g4LmA4Lie4Li04LmI4Lih4LiE4Liz4Liq4Lix4LmI4LiH4Lie4Li04LmA4Lio4LipOiDguKrguKPguYnguLLguIfguJXguLHguKfguKXguKfguIfguYPguKvguYnguITguKEgKFNoYXJwIERpc3RyYWN0b3JzKQogICAgY29uc3QgZGlzdHJhY3Rvckluc3RydWN0aW9uID0gYAogICAgKirguIHguI7guYDguKvguKXguYfguIHguIHguLLguKPguKrguKPguYnguLLguIfguJXguLHguKfguYDguKXguLfguK3guIEgKERpc3RyYWN0b3IgUnVsZXMpOioqCiAgICAxLiDguKvguYnguLLguKHguKrguLjguYjguKHguJXguLHguKfguYDguKXguILguKHguLHguYjguKfguYYg4Lih4Liy4LmD4Liq4LmI4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4Lir4Lil4Lit4LiBCiAgICAyLiDguJXguLHguKfguYDguKXguLfguK3guIHguJfguLXguYjguJzguLTguJQgKERpc3RyYWN0b3JzKSDguJXguYnguK3guIfguYDguIHguLTguJTguIjguLLguIEgIuC4hOC4p+C4suC4oeC5gOC4guC5ieC4suC5g+C4iOC4nOC4tOC4lOC4l+C4teC5iOC4nuC4muC4muC5iOC4reC4oiIgKENvbW1vbiBNaXNjb25jZXB0aW9ucykg4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmD4LiZ4LmA4Lij4Li34LmI4Lit4LiH4LiZ4Lix4LmJ4LiZ4LmGCiAgICAzLiDguJXguLHguKfguYDguKXguLfguK3guIHguJXguYnguK3guIfguJTguLnguKrguKHguYDguKvguJXguLjguKrguKHguJzguKUg4LmE4Lih4LmI4LmD4LiK4LmI4Lic4Li04LiU4LmB4Lia4Lia4LmA4Lir4LmH4LiZ4LmE4LiU4LmJ4LiK4Lix4LiUCiAgICA0LiDguJbguYnguLLguYDguJvguYfguJnguYLguIjguJfguKLguYzguITguLPguJnguKfguJMg4LmD4Lir4LmJ4LiU4Lix4LiB4LiX4Liy4LiH4LiE4LiZ4LiX4Li14LmI4Lil4Li34Lih4LiX4LiU4LmA4Lil4LiCLCDguKXguLfguKHguYDguJvguKXguLXguYjguKLguJnguKvguJnguYjguKfguKIsIOC4q+C4o+C4t+C4reC4iOC4s+C4quC4ueC4leC4o+C4nOC4tOC4lGA7CgogICAgcHJvbXB0ID0gYOC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4m+C4o+C4meC4seC4oiR7c3ViamVjdFByZWZpeH0gJHtudW1RdWVzdGlvbnN9IOC4guC5ieC4rSAke3RvcGljSW5zdHJ1Y3Rpb259LiAKICAgIOC5geC4leC5iOC4peC4sOC4guC5ieC4reC4oeC4tSAke251bUNob2ljZXN9IOC4leC4seC4p+C5gOC4peC4t+C4reC4gS4gCiAgICAke2Rpc3RyYWN0b3JJbnN0cnVjdGlvbn0gCiAgICDguKPguLDguJrguLjguITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcsIOC5geC4peC4sOC5gOC4nuC4tOC5iOC4oeC4hOC4s+C4reC4mOC4tOC4muC4suC4ouC4quC4seC5ieC4meC5hi4gCiAgICAke2ltYWdlSW5zdHJ1Y3Rpb259ICR7c2ltcGxlTWF0aFByb21wdH1gOwoKICAgIHNjaGVtYSA9IHsgdHlwZTogIk9CSkVDVCIsIHByb3BlcnRpZXM6IHsgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciIH0sIG9wdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LCBjb3JyZWN0QW5zd2VySW5kZXg6IHsgdHlwZTogIk5VTUJFUiIgfSwgZXhwbGFuYXRpb246IHsgdHlwZTogIlNUUklORyIgfSwgaW1hZ2VDb2RlOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsicXVlc3Rpb25UZXh0IiwgIm9wdGlvbnMiLCAiY29ycmVjdEFuc3dlckluZGV4IiwgImV4cGxhbmF0aW9uIl0gfTsKICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdmaWxsX2luX3dpdGhfY2hvaWNlcyc6CiAgICAgICAgICAgICAgICBwcm9tcHQgPSBg4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LmB4Lia4Lia4LmA4LiV4Li04Lih4LiE4Liz4LmD4LiZ4LiK4LmI4Lit4LiH4Lin4LmI4Liy4LiHJHtzdWJqZWN0UHJlZml4fSAke251bVF1ZXN0aW9uc30g4LiC4LmJ4LitICR7dG9waWNJbnN0cnVjdGlvbn0uIOC5geC4leC5iOC4peC4sOC4guC5ieC4reC4leC5ieC4reC4h+C4oeC4teC4m+C4o+C4sOC5guC4ouC4hOC4hOC4s+C4luC4suC4oeC4l+C4teC5iOC4oeC4teC4iuC5iOC4reC4h+C4p+C5iOC4suC4hyAocXVlc3Rpb25UZXh0IGNvbnRhaW5pbmcgJy4uLi4uJyksIOC4leC4seC4p+C5gOC4peC4t+C4reC4gSAke251bUNob2ljZXN9IOC4leC4seC4pyAob3B0aW9ucyksIOC4lOC4seC4iuC4meC4teC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAoY29ycmVjdEFuc3dlckluZGV4KSwg4LmB4Lil4Liw4LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiIChleHBsYW5hdGlvbikuICR7aW1hZ2VJbnN0cnVjdGlvbn0gJHtzaW1wbGVNYXRoUHJvbXB0fWA7CiAgICAgICAgICAgICAgICBzY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0sIGltYWdlQ29kZTogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJvcHRpb25zIiwgImNvcnJlY3RBbnN3ZXJJbmRleCIsICJleHBsYW5hdGlvbiJdIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgICAgIHByb21wdCA9IGDguKrguKPguYnguLLguIfguITguLPguJbguLLguKHguYHguJrguJrguYDguJXguLTguKHguITguLPguYPguJnguIrguYjguK3guIfguKfguYjguLLguIcke3N1YmplY3RQcmVmaXh9ICR7bnVtUXVlc3Rpb25zfSDguILguYnguK0gJHt0b3BpY0luc3RydWN0aW9ufS4g4LmB4LiV4LmI4Lil4Liw4LiC4LmJ4Lit4LiV4LmJ4Lit4LiH4Lih4Li14LiE4Liz4LiW4Liy4LihIChxdWVzdGlvblRleHQgY29udGFpbmluZyAnLi4uLi4nKSwg4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmA4Lir4Lih4Liy4Liw4Liq4LihIChpZGVhbEFuc3dlciksIOC5geC4peC4sOC4hOC4s+C4reC4mOC4tOC4muC4suC4oiAoZXhwbGFuYXRpb24pLiAqKuC4geC4juC4quC4s+C4hOC4seC4jTog4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmA4Lir4Lih4Liy4Liw4Liq4LihIChpZGVhbEFuc3dlcikg4LiV4LmJ4Lit4LiH4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LiI4Liz4LiZ4Lin4LiZ4LmA4LiV4LmH4Lih4LiX4Li14LmI4Lih4Li14LiE4LmI4Liy4LiV4Lix4LmJ4LiH4LmB4LiV4LmIIDAg4LiW4Li24LiHIDk5OSDguYDguJfguYjguLLguJnguLHguYnguJkqKi4gJHtpbWFnZUluc3RydWN0aW9ufSAke3NpbXBsZU1hdGhQcm9tcHR9YDsKICAgICAgICAgICAgICAgIHNjaGVtYSA9IHsgdHlwZTogIk9CSkVDVCIsIHByb3BlcnRpZXM6IHsgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0sIGltYWdlQ29kZTogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJpZGVhbEFuc3dlciIsICJleHBsYW5hdGlvbiJdIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWl4ZWQnOgogICAgICAgICAgICAgICAgcHJvbXB0ID0gYOC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miR7c3ViamVjdFByZWZpeH0gJHtudW1RdWVzdGlvbnN9IOC4guC5ieC4rSAke3RvcGljSW5zdHJ1Y3Rpb259LCDguYLguJTguKLguYPguKvguYnguKHguLXguJfguLHguYnguIfguITguLPguJbguLLguKHguYHguJrguJrguJvguKPguJnguLHguKIgKHF1ZXN0aW9uVHlwZTogJ211bHRpcGxlX2Nob2ljZScpIOC5geC4peC4sOC5geC4muC4muC5gOC4leC4tOC4oeC4hOC4s+C4l+C4teC5iOC5g+C4q+C5ieC4nuC4tOC4oeC4nuC5jOC4leC4reC4muC5gOC4reC4hyAocXVlc3Rpb25UeXBlOiAnc2hvcnRfYW5zd2VyJykg4LiE4Lil4Liw4LiB4Lix4LiZ4LmE4LibLiDguKrguLPguKvguKPguLHguJrguJvguKPguJnguLHguKIg4LmD4Lir4LmJ4Lih4Li1ICR7bnVtQ2hvaWNlc30g4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBLiAqKuC4geC4juC4quC4s+C4hOC4seC4jTog4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Liz4LiW4Liy4Lih4Lib4Lij4Liw4LmA4Lig4LiXICdzaG9ydF9hbnN3ZXInLCAnaWRlYWxBbnN3ZXInIOC4leC5ieC4reC4h+C5gOC4m+C5h+C4meC4leC4seC4p+C5gOC4peC4guC4iOC4s+C4meC4p+C4meC5gOC4leC5h+C4oeC4o+C4sOC4q+C4p+C5iOC4suC4hyAwLTk5OSDguYDguJfguYjguLLguJnguLHguYnguJkqKi4gJHtpbWFnZUluc3RydWN0aW9ufSAke3NpbXBsZU1hdGhQcm9tcHR9LiBGb3IgZWFjaCBxdWVzdGlvbiwgc3BlY2lmeSBpdHMgJ3F1ZXN0aW9uVHlwZScuIElmICdxdWVzdGlvblR5cGUnIGlzICdtdWx0aXBsZV9jaG9pY2UnLCBwcm92aWRlICdvcHRpb25zJyBhbmQgJ2NvcnJlY3RBbnN3ZXJJbmRleCcuIElmICdxdWVzdGlvblR5cGUnIGlzICdzaG9ydF9hbnN3ZXInLCBwcm92aWRlICdpZGVhbEFuc3dlcicuYDsKICAgICAgICAgICAgICAgIHNjaGVtYSA9IHsgdHlwZTogIk9CSkVDVCIsIHByb3BlcnRpZXM6IHsgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciIH0sIHF1ZXN0aW9uVHlwZTogeyB0eXBlOiAiU1RSSU5HIiwgImVudW0iOiBbIm11bHRpcGxlX2Nob2ljZSIsICJzaG9ydF9hbnN3ZXIiXSB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0sIGV4cGxhbmF0aW9uOiB7IHR5cGU6ICJTVFJJTkciIH0sIGltYWdlQ29kZTogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJxdWVzdGlvblR5cGUiLCAiZXhwbGFuYXRpb24iXSB9OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgcHJvbXB0ID0gYOC4quC4o+C5ieC4suC4h+C4hOC4s+C4luC4suC4oeC5geC4muC4muC5g+C4iuC5iC/guYTguKHguYjguYPguIrguYgke3N1YmplY3RQcmVmaXh9ICR7bnVtUXVlc3Rpb25zfSDguILguYnguK0gJHt0b3BpY0luc3RydWN0aW9ufS4g4LmB4LiV4LmI4Lil4Liw4LiC4LmJ4Lit4LiV4LmJ4Lit4LiH4Lih4Li14LiE4Liz4LiW4Liy4LihIChxdWVzdGlvblRleHQpLCDguITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKGNvcnJlY3RBbnN3ZXIg4LmA4Lib4LmH4LiZIHRydWUg4Lir4Lij4Li34LitIGZhbHNlKSwg4LmB4Lil4Liw4LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiIChleHBsYW5hdGlvbikuICR7aW1hZ2VJbnN0cnVjdGlvbn0gJHtzaW1wbGVNYXRoUHJvbXB0fWA7CiAgICAgICAgICAgICAgICBzY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LCBjb3JyZWN0QW5zd2VyOiB7IHR5cGU6ICJCT09MRUFOIiB9LCBleHBsYW5hdGlvbjogeyB0eXBlOiAiU1RSSU5HIiB9LCBpbWFnZUNvZGU6IHsgdHlwZTogIlNUUklORyIgfSB9LCByZXF1aXJlZDogWyJxdWVzdGlvblRleHQiLCAiY29ycmVjdEFuc3dlciIsICJleHBsYW5hdGlvbiJdIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmcnOgogICAgICAgICAgICAgICAgcHJvbXB0ID0gYOC4quC4o+C5ieC4suC4h+C4iuC4uOC4lOC4hOC4s+C4luC4suC4oeC4iOC4seC4muC4hOC4ueC5iCR7c3ViamVjdFByZWZpeH0gJHtudW1RdWVzdGlvbnN9IOC4hOC4ueC5iCAke3RvcGljSW5zdHJ1Y3Rpb259LiDguKrguLPguKvguKPguLHguJrguYHguJXguYjguKXguLDguITguLnguYgg4LmD4Lir4LmJ4Liq4Lij4LmJ4Liy4LiH4LmA4Lib4LmH4LiZIEpTT04gb2JqZWN0IOC5geC4ouC4geC4geC4seC4mSDguYLguJTguKLguYHguJXguYjguKXguLAgb2JqZWN0IOC4leC5ieC4reC4h+C4oeC4tTogJ3F1ZXN0aW9uVHlwZScgKOC4leC4seC5ieC4h+C4hOC5iOC4suC5gOC4m+C5h+C4mSAnbWF0Y2hpbmdfaXRlbScpLCAnc3RlbScgKOC4hOC4s+C4luC4suC4oeC4neC4seC5iOC4h+C4i+C5ieC4suC4oiksICdjb3JyZWN0UmVzcG9uc2UnICjguITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIfguJ3guLHguYjguIfguILguKfguLIpLCDguYHguKXguLAgJ2V4cGxhbmF0aW9uJy4g4LiZ4Lit4LiB4LiI4Liy4LiB4LiZ4Li14LmJIOC5g+C4q+C5ieC4quC4o+C5ieC4suC4hyBrZXkg4LiK4Li34LmI4LitICdhbGxSZXNwb25zZXMnIOC4i+C4tuC5iOC4h+C5gOC4m+C5h+C4mSBhcnJheSDguJfguLXguYjguKPguKfguJrguKPguKfguKEgJ2NvcnJlY3RSZXNwb25zZScg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICR7bnVtUXVlc3Rpb25zfSDguKPguLLguKLguIHguLLguKMg4LmA4Lie4Li34LmI4Lit4LmD4LiK4LmJ4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4LiZIGRyb3Bkb3duLiAke2ltYWdlSW5zdHJ1Y3Rpb259ICR7c2ltcGxlTWF0aFByb21wdH1gOwogICAgICAgICAgICAgICAgc2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBxdWVzdGlvblR5cGU6IHsgdHlwZTogIlNUUklORyIsICJlbnVtIjogWyJtYXRjaGluZ19pdGVtIl0gfSwgc3RlbTogeyB0eXBlOiAiU1RSSU5HIiB9LCBjb3JyZWN0UmVzcG9uc2U6IHsgdHlwZTogIlNUUklORyIgfSwgYWxsUmVzcG9uc2VzOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgZXhwbGFuYXRpb246IHsgdHlwZTogIlNUUklORyIgfSwgaW1hZ2VDb2RlOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsicXVlc3Rpb25UeXBlIiwgInN0ZW0iLCAiY29ycmVjdFJlc3BvbnNlIiwgImFsbFJlc3BvbnNlcyIsICJleHBsYW5hdGlvbiJdIH07CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgZmluYWxTY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHRvcGljOiB7IHR5cGU6ICJTVFJJTkciIH0sIHF1ZXN0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogc2NoZW1hIH0gfSwgcmVxdWlyZWQ6IFsidG9waWMiLCAicXVlc3Rpb25zIl0gfTsKCiAgICAvLyDguKrguKPguYnguLLguIcgUHJvbXB0IOC4quC4uOC4lOC4l+C5ieC4suC4ouC5guC4lOC4ouC4muC4reC4geC5g+C4q+C5iSBBSSDguKfguLTguYDguITguKPguLLguLDguKvguYzguIjguLLguIHguYTguJ/guKXguYwKICAgIGNvbnN0IGZpbmFsUHJvbXB0ID0gYOC4iOC4suC4geC5hOC4n+C4peC5jOC4l+C4teC5iOC5geC4meC4muC4oeC4suC4meC4teC5iSwgJHtwcm9tcHR9YDsKCiAgICAvLyDguKrguKPguYnguLLguIcgUGF5bG9hZCDguKrguLPguKvguKPguLHguJogQVBJIOC5g+C4meC4o+C4ueC4m+C5geC4muC4miBNdWx0aW1vZGFsCiAgICBjb25zdCBwYXlsb2FkID0gewogICAgICAgIGNvbnRlbnRzOiBbewogICAgICAgICAgICBwYXJ0czogWwogICAgICAgICAgICAgICAgeyB0ZXh0OiBmaW5hbFByb21wdCB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIGlubGluZURhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IG1pbWVUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBiYXNlNjREYXRhCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgfV0sCiAgICAgICAgZ2VuZXJhdGlvbkNvbmZpZzogewogICAgICAgICAgICByZXNwb25zZU1pbWVUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgIHJlc3BvbnNlU2NoZW1hOiBmaW5hbFNjaGVtYQogICAgICAgIH0KICAgIH07CgogICAgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJIGhhbmRsZUFwaUNhbGwg4LiB4Lix4LiaIFBheWxvYWQg4LmD4Lir4Lih4LmICiAgICByZXR1cm4gaGFuZGxlQXBpQ2FsbChwYXlsb2FkLmNvbnRlbnRzWzBdLnBhcnRzLCAnQUkg4LiB4Liz4Lil4Lix4LiH4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmE4Lif4Lil4LmM4LmB4Lil4Liw4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaLi4uJywgZmluYWxTY2hlbWEpOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVBcGlDYWxsKHByb21wdE9yUGFydHMsIGxvYWRpbmdNZXNzYWdlLCBzY2hlbWEsIHNpbmdsZVF1ZXN0aW9uSW5kZXggPSBudWxsLCBzaG91bGREaXNwbGF5UXVpeiA9IHRydWUsIGZvcmNlZFByb2plY3RJZCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsKSB7CiAgICBjb25zdCBxdWl6R2VuQXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWdlbmVyYXRpb24tYXJlYScpOwogICAgY29uc3QgbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlcicpOwogICAgY29uc3QgbG9hZGVyVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkZXItdGV4dCcpOwogICAgY29uc3QgZ2VuUXVpekNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZWQtcXVpei1jb250YWluZXInKTsKCiAgICBxdWl6R2VuQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGlmIChzaW5nbGVRdWVzdGlvbkluZGV4ID09PSBudWxsICYmIHNob3VsZERpc3BsYXlRdWl6KSB7CiAgICAgICAgZ2VuUXVpekNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKICAgIH0KICAgIGxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSBsb2FkaW5nTWVzc2FnZTsKCiAgICAvLyDguJvguLTguJTguJvguLjguYjguKHguJXguYjguLLguIfguYYg4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS10b3BpYy1idG4nKS5kaXNhYmxlZCA9IHRydWU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS10ZXh0LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWxpbmstYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogICAgY29uc3QgZmlsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWZpbGUtYnRuJyk7CiAgICBpZiAoZmlsZUJ0bikgZmlsZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBjb25zdCBibHVlcHJpbnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1ibHVlcHJpbnQtYnRuJyk7CiAgICBpZiAoYmx1ZXByaW50QnRuKSBibHVlcHJpbnRCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgY29uc3QgcGFyYWxsZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1wYXJhbGxlbC10ZXN0LWJ0bicpOwogICAgaWYgKHBhcmFsbGVsQnRuKSBwYXJhbGxlbEJ0bi5kaXNhYmxlZCA9IHRydWU7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXJ0cyA9IEFycmF5LmlzQXJyYXkocHJvbXB0T3JQYXJ0cykgPyBwcm9tcHRPclBhcnRzIDogW3sgdGV4dDogcHJvbXB0T3JQYXJ0cyB9XTsKICAgICAgICBjb25zdCBwYXlsb2FkID0geyBjb250ZW50czogW3sgcm9sZTogInVzZXIiLCBwYXJ0czogcGFydHMgfV0gfTsKCiAgICAgICAgaWYgKHNjaGVtYSkgewogICAgICAgICAgICBwYXlsb2FkLmdlbmVyYXRpb25Db25maWcgPSB7CiAgICAgICAgICAgICAgICByZXNwb25zZU1pbWVUeXBlOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICAgICByZXNwb25zZVNjaGVtYTogc2NoZW1hCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBjb25zdCBhcGlLZXkgPSAiQUl6YVN5RDRQOWdLcHJMUGZKMVE5QmZDcHJXLVBSUkw5U01YeW9VIjsgCiAgICAgICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA5LTIwMjU6Z2VuZXJhdGVDb250ZW50P2tleT0ke2FwaUtleX1gOwogICAgICAgIAogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYXBpVXJsLCB7IG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSwgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkgfSk7CiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgICBjb25zdCBlcnJvckJvZHkgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkFQSSBFcnJvciBSZXNwb25zZToiLCBlcnJvckJvZHkpOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBjYWxsIGZhaWxlZCB3aXRoIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAKICAgICAgICBpZiAoIXJlc3VsdC5jYW5kaWRhdGVzIHx8IHJlc3VsdC5jYW5kaWRhdGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBsZXQgZGV0YWlsZWRFcnJvciA9ICJBSSBkaWQgbm90IHJldHVybiBhbnkgY29udGVudC4iOwogICAgICAgICAgICBpZiAocmVzdWx0LnByb21wdEZlZWRiYWNrPy5ibG9ja1JlYXNvbikgewogICAgICAgICAgICAgICAgZGV0YWlsZWRFcnJvciA9IGBDb250ZW50IHdhcyBibG9ja2VkIGJ5IHNhZmV0eSBmaWx0ZXJzLiBSZWFzb246ICR7cmVzdWx0LnByb21wdEZlZWRiYWNrLmJsb2NrUmVhc29ufS5gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZGV0YWlsZWRFcnJvciwgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOyAKICAgICAgICB9CgogICAgICAgIGNvbnN0IHJhd1RleHQgPSByZXN1bHQuY2FuZGlkYXRlc1swXS5jb250ZW50LnBhcnRzWzBdLnRleHQ7CgogICAgICAgIGlmIChzY2hlbWEpIHsKICAgICAgICAgICAgbGV0IGpzb25UZXh0ID0gcmF3VGV4dDsKICAgICAgICAgICAgaWYgKGpzb25UZXh0LnN0YXJ0c1dpdGgoImBgYGpzb24iKSkgewogICAgICAgICAgICAgICAganNvblRleHQgPSBqc29uVGV4dC5zdWJzdHJpbmcoNywganNvblRleHQubGVuZ3RoIC0gMykudHJpbSgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGpzb25UZXh0LnN0YXJ0c1dpdGgoImBgYCIpKSB7CiAgICAgICAgICAgICAgICBqc29uVGV4dCA9IGpzb25UZXh0LnN1YnN0cmluZygzLCBqc29uVGV4dC5sZW5ndGggLSAzKS50cmltKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IHBhcnNlZERhdGEgPSBKU09OLnBhcnNlKGpzb25UZXh0KTsKCiAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBb4LiI4Li44LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCXSDguIjguLHguJTguIHguLLguKPguITguLPguJbguLLguKHguYHguJrguJrguIjguLHguJrguITguLnguYggKE1hdGNoaW5nKSDguYPguKvguYnguYPguIrguYnguJXguLHguKfguYDguKXguLfguK3guIHguKPguYjguKfguKHguIHguLHguJkg4pa84pa84pa8CiAgICAgICAgICAgIGlmIChwYXJzZWREYXRhLnF1ZXN0aW9ucyAmJiBBcnJheS5pc0FycmF5KHBhcnNlZERhdGEucXVlc3Rpb25zKSkgewogICAgICAgICAgICAgICAgLy8gMS4g4Lir4Liy4LiC4LmJ4Lit4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LmB4Lia4Lia4LiI4Lix4Lia4LiE4Li54LmICiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaGluZ1FzID0gcGFyc2VkRGF0YS5xdWVzdGlvbnMuZmlsdGVyKHEgPT4gcS5xdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChtYXRjaGluZ1FzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyAyLiDguKPguKfguJrguKPguKfguKEgIuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyIgKGNvcnJlY3RSZXNwb25zZSkg4LiI4Liy4LiB4LiX4Li44LiB4LiC4LmJ4Lit4Lih4Liy4LmE4Lin4LmJ4LmD4LiZ4LiB4Lit4LiH4LiB4Lil4Liy4LiHCiAgICAgICAgICAgICAgICAgICAgLy8gKOC4geC4o+C4reC4h+C4hOC5iOC4suC4p+C5iOC4suC4h+C4l+C4tOC5ieC4h+C5hOC4myDguYDguJ7guLfguYjguK3guITguKfguLLguKHguIrguLHguKfguKPguYwpCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hhcmVkUG9vbCA9IG1hdGNoaW5nUXMubWFwKHEgPT4gcS5jb3JyZWN0UmVzcG9uc2UpLmZpbHRlcihhbnMgPT4gYW5zICYmIGFucy50cmltKCkgIT09ICIiKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAzLiDguKrguLjguYjguKHguKXguLPguJTguLHguJrguJXguLHguKfguYDguKXguLfguK3guIHguYPguJnguIHguK3guIfguIHguKXguLLguIcg4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LiC4LmJ4LitICgxLT5BLCAyLT5CKQogICAgICAgICAgICAgICAgICAgIC8vICjguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJkgc2h1ZmZsZUFycmF5IOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4pykKICAgICAgICAgICAgICAgICAgICBzaHVmZmxlQXJyYXkoc2hhcmVkUG9vbCk7CgogICAgICAgICAgICAgICAgICAgIC8vIDQuIOC4ouC4seC4lOC4geC4reC4h+C4geC4peC4suC4h+C4geC4peC4seC4muC5gOC4guC5ieC4suC5hOC4m+C5g+C4mSAnYWxsUmVzcG9uc2VzJyDguILguK3guIfguJfguLjguIHguILguYnguK0KICAgICAgICAgICAgICAgICAgICBtYXRjaGluZ1FzLmZvckVhY2gocSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHEuYWxsUmVzcG9uc2VzID0gWy4uLnNoYXJlZFBvb2xdOyAvLyBDb3B5IGFycmF5IOC5hOC4m+C5g+C4quC5iAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJNYXRjaGluZyBvcHRpb25zIHN5bmNlZDoiLCBzaGFyZWRQb29sKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDilrLilrLilrIgW+C4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4gl0g4pay4pay4payCgogICAgICAgICAgICBpZiAoc2hvdWxkRGlzcGxheVF1aXopIHsKICAgICAgICAgICAgICAgIGlmIChzaW5nbGVRdWVzdGlvbkluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LiB4Lij4LiT4Li14Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmI4Lij4Liy4Lii4LiC4LmJ4LitIChSZWdlbmVyYXRlIHNpbmdsZSBxdWVzdGlvbikKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEVkaXRpbmdRdWl6RGF0YSAmJiBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LiC4LmJ4Lit4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmI4LmA4Lib4LmH4LiZIG1hdGNoaW5nIOC5gOC4o+C4suC4leC5ieC4reC4h+C4o+C4sOC4p+C4seC4h+C5hOC4oeC5iOC5g+C4q+C5ieC4oeC4seC4meC4q+C4peC4uOC4lOC4geC4peC4uOC5iOC4oQogICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LmB4LiV4LmI4LmD4LiZIGVkaXRvciDguKHguLHguIHguYHguIHguYnguJfguLXguKXguLDguILguYnguK0g4LiB4Liy4Lij4LiU4Li24LiHIHBvb2wg4LmA4LiU4Li04Lih4Lih4Liy4LmD4LiK4LmJ4Lit4Liy4LiI4LiL4Lix4Lia4LiL4LmJ4Lit4LiZIAogICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZ4LmD4Lir4LmJ4LmD4LiK4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LmD4Lir4Lih4LmI4LmE4Lib4LiB4LmI4Lit4LiZIOC4q+C4o+C4t+C4reC4luC5ieC4suC5gOC4m+C5h+C4meC5hOC4m+C5hOC4lOC5ieC4hOC4p+C4o+C4reC5iOC4suC4mSBwb29sIOC4iOC4suC4geC4guC5ieC4reC4reC4t+C5iOC4mQogICAgICAgICAgICAgICAgICAgICAgICAgLy8gKOC5g+C4meC4l+C4teC5iOC4meC4teC5ieC4m+C4peC5iOC4reC4ouC5g+C4q+C5ieC5gOC4m+C5h+C4meC4q+C4meC5ieC4suC4l+C4teC5iOC4guC4reC4hyBFZGl0b3IgbG9naWMpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBwYXJzZWREYXRhOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlHZW5lcmF0ZWRRdWl6KGN1cnJlbnRRdWl6RGF0YSwgZm9yY2VkUHJvamVjdElkLCBibHVlcHJpbnRUb3BpY0lkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcGFyc2VkRGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gcmF3VGV4dDsKICAgICAgICB9CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBpbiBoYW5kbGVBcGlDYWxsOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZShg4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiHOiAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICAgICAgaWYgKHNob3VsZERpc3BsYXlRdWl6KSB7CiAgICAgICAgICAgIGdlblF1aXpDb250YWluZXIuaW5uZXJIVE1MID0gYDxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAgdGV4dC1jZW50ZXIiPuC4guC4reC4reC4oOC4seC4oiwg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Liq4Lij4LmJ4Liy4LiH4LmE4LiU4LmJPC9wPmA7CiAgICAgICAgfQogICAgICAgIHRocm93IGVycm9yOwogICAgfSBmaW5hbGx5IHsKICAgICAgICBsb2FkZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tdG9waWMtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS10ZXh0LWJ0bicpLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tbGluay1idG4nKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIGlmIChmaWxlQnRuKSBmaWxlQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGJsdWVwcmludEJ0bikgYmx1ZXByaW50QnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgaWYgKHBhcmFsbGVsQnRuKSBwYXJhbGxlbEJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgfQp9CgogICAgICAgIGZ1bmN0aW9uIGV4aXRGdWxsc2NyZWVuKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCkuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHsgLyogU2FmYXJpICovCiAgICAgICAgICAgICAgICBkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHsgLyogSUUxMSAqLwogICAgICAgICAgICAgICAgZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKZnVuY3Rpb24gZW50ZXJGdWxsc2NyZWVuKCkgewogICAgY29uc3QgZWxlbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsgLy8g4LiV4Lix4Lin4LmB4LiX4LiZ4LiC4Lit4LiH4LiX4Lix4LmJ4LiH4Lir4LiZ4LmJ4Liy4LmA4Lin4LmH4LiaCiAgICBpZiAoZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICAgIGVsZW0ucmVxdWVzdEZ1bGxzY3JlZW4oKS5jYXRjaChlcnIgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBhdHRlbXB0aW5nIHRvIGVuYWJsZSBmdWxsLXNjcmVlbiBtb2RlOiAke2Vyci5tZXNzYWdlfSAoJHtlcnIubmFtZX0pYCk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGVsZW0ud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIHsgLyogU2FmYXJpICovCiAgICAgICAgZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgfSBlbHNlIGlmIChlbGVtLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHsgLyogSUUxMSAqLwogICAgICAgIGVsZW0ubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgfQp9CgovKioKICog4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiB4Lil4Liy4LiH4Liq4Liz4Lir4Lij4Lix4Lia4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4Lit4Lit4LiB4LiI4Liy4LiB4LiI4LitICjguJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguJnguLHguJrguIvguYnguLPguIvguYnguK3guJkpCiAqLwpmdW5jdGlvbiBoYW5kbGVDaGVhdGluZ0V2ZW50KCkgewogICAgLy8g4LiW4LmJ4Liy4LiB4Liz4Lil4Lix4LiH4Lit4Lii4Li54LmI4LmD4LiZ4LiK4LmI4Lin4LiHIENvb2xkb3duIOC5g+C4q+C5ieC5gOC4oeC4tOC4meC4reC4teC5gOC4p+C4meC4leC5jOC4meC4teC5ieC5hOC4m+C5gOC4peC4ogogICAgaWYgKGNoZWF0RGV0ZWN0aW9uVGltZW91dCkgcmV0dXJuOwoKICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5iOC4iuC5iOC4p+C4hyBDb29sZG93biDguYPguKvguYnguYDguKPguLTguYjguKHguJfguLPguIfguLLguJkKICAgIGNoZWF0QXR0ZW1wdHMrKzsKICAgIGxvZ0JlaGF2aW9yRXZlbnQoJ3NjcmVlbl9leGl0JywgeyBhdHRlbXB0TnVtYmVyOiBjaGVhdEF0dGVtcHRzIH0pOwoKICAgIGlmIChjaGVhdEF0dGVtcHRzID49IG1heENoZWF0QXR0ZW1wdHMpIHsKICAgICAgICBpc1F1aXpBY3RpdmUgPSBmYWxzZTsKICAgICAgICBzaG93TWVzc2FnZShg4LiV4Lij4Lin4LiI4Lie4Lia4LiB4Liy4Lij4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LiE4Lij4LiaICR7bWF4Q2hlYXRBdHRlbXB0c30g4LiE4Lij4Lix4LmJ4LiHIOC4o+C4sOC4muC4muC5hOC4lOC5ieC4l+C4s+C4geC4suC4o+C4quC5iOC4h+C4hOC4s+C4leC4reC4muC4guC4reC4h+C4hOC4uOC4k+C4reC4seC4leC5guC4meC4oeC4seC4leC4tGApOwoKICAgICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZm9ybScpKSB7CiAgICAgICAgICAgIGhhbmRsZVN1Ym1pdFF1aXoobnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmluYWxpemVQZXJRdWVzdGlvblF1aXooKTsKICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoCiAgICAgICAgICAgIGDguITguLPguYDguJXguLfguK3guJkgKCR7Y2hlYXRBdHRlbXB0c30vJHttYXhDaGVhdEF0dGVtcHRzfSk6IOC4geC4o+C4uOC4k+C4suC4reC4ouC5iOC4suC4reC4reC4geC4iOC4suC4geC4q+C4meC5ieC4suC4iOC4reC4o+C4sOC4q+C4p+C5iOC4suC4h+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4mmAsCiAgICAgICAgICAgIGVudGVyRnVsbHNjcmVlbiAKICAgICAgICApOwogICAgfQoKICAgIC8vIOC5gOC4o+C4tOC5iOC4oSBDb29sZG93bjog4LiV4Lix4LmJ4LiH4LmA4Lin4Lil4LiyIDUwMCDguKHguLTguKXguKXguLTguKfguLTguJnguLLguJfguLUgKDAuNSDguKfguLTguJnguLLguJfguLUpCiAgICAvLyDguYPguJnguIrguYjguKfguIfguYDguKfguKXguLLguJnguLXguYkg4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LiI4Liw4LmE4Lih4LmI4LiX4Liz4LiH4Liy4LiZ4Lit4Li14LiBCiAgICBjaGVhdERldGVjdGlvblRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBjaGVhdERldGVjdGlvblRpbWVvdXQgPSBudWxsOyAvLyDguYDguKHguLfguYjguK3guITguKPguJrguYDguKfguKXguLIg4LmD4Lir4LmJ4LmA4LiE4Lil4Li14Lii4Lij4LmMIENvb2xkb3duCiAgICB9LCA1MDApOwp9CgpmdW5jdGlvbiBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKCkgewogICAgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4tdGVzdGluZycgfHwgIWlzUXVpekFjdGl2ZSkgcmV0dXJuOwogICAgaWYgKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gJ2hpZGRlbicpIHsKICAgICAgICBoYW5kbGVDaGVhdGluZ0V2ZW50KCk7CiAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gJ3Zpc2libGUnKSB7CiAgICAgICAgY29uc29sZS5sb2coIuC4geC4peC4seC4muC5gOC4guC5ieC4suC4quC4ueC5iOC4q+C4meC5ieC4suC4iOC4reC5geC4muC4muC4l+C4lOC4quC4reC4muC5geC4peC5ieC4pywg4LiB4Liz4Lil4Lix4LiH4Lij4Li14LmA4LiL4LmH4LiV4Lij4Liw4Lia4Lia4Lib4LmJ4Lit4LiH4LiB4Lix4LiZLi4uIik7CiAgICAgICAgcmVxdWVzdFdha2VMb2NrKCk7CiAgICAgICAgcmVzZXREaW1UaW1lcigpOwogICAgfQp9CgpmdW5jdGlvbiBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKCkgewogICAgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4tdGVzdGluZycgfHwgIWlzUXVpekFjdGl2ZSkgcmV0dXJuOwogICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgewogICAgICAgIGhhbmRsZUNoZWF0aW5nRXZlbnQoKTsKICAgIH0KfQoKZnVuY3Rpb24gZGlzcGxheUdlbmVyYXRlZFF1aXoocXVpekRhdGEsIGZvcmNlZFByb2plY3RJZCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGVkLXF1aXotY29udGFpbmVyJyk7CiAgICBsZXQgaHRtbCA9IGA8aDMgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTMiIGNvbnRlbnRlZGl0YWJsZT0idHJ1ZSIgaWQ9ImVkaXRhYmxlLXF1aXotdG9waWMiPiR7cXVpekRhdGEudG9waWN9PC9oMz5gOwogICAgCiAgICBxdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaCgocSwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoIXEuaWQpIHsgcS5pZCA9IGBxXyR7RGF0ZS5ub3coKX1fJHtpbmRleH1gOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgcXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgCiAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1iLTQgcC00IGJvcmRlciByb3VuZGVkLWxnIHJlbGF0aXZlIGdyb3VwIiBkYXRhLXF1ZXN0aW9uLWluZGV4PSIke2luZGV4fSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSB0b3AtMiByaWdodC0yIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkgZmxleCBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pbmRleD0iJHtpbmRleH0iIGNsYXNzPSJlZGl0LXF1ZXN0aW9uLWJ0biB0ZXh0LWJsdWUtNjAwIGhvdmVyOnRleHQtYmx1ZS04MDAgcC0xIiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiC4LiC4LmJ4Lit4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaW5kZXg9IiR7aW5kZXh9IiBjbGFzcz0icmVnZW5lcmF0ZS1xdWVzdGlvbi1idG4gdGV4dC1ncmVlbi02MDAgaG92ZXI6dGV4dC1ncmVlbi04MDAgcC0xIiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4LiZ4Li14LmJ4LmD4Lir4Lih4LmIIj48aSBjbGFzcz0iZmFzIGZhLXN5bmMtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwoKICAgICAgICAvLyDguKrguYjguKfguJnguYHguKrguJTguIfguYLguIjguJfguKLguYwKICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgaHRtbCArPSBgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQiIGlkPSJxLXRleHQtJHtpbmRleH0iPiR7aW5kZXggKyAxfS4gJHtxLnN0ZW19PC9wPmA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaHRtbCArPSBgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQiIGlkPSJxLXRleHQtJHtpbmRleH0iPiR7aW5kZXggKyAxfS4gJHtxLnF1ZXN0aW9uVGV4dH08L3A+YDsKICAgICAgICB9CgogICAgICAgIGlmIChxLmltYWdlQ29kZSkgewogICAgICAgICAgICBodG1sICs9IGA8ZGl2IGlkPSJxLWltYWdlLWNvbnRhaW5lci0ke2luZGV4fSIgY2xhc3M9Im15LTQgZmxleCBqdXN0aWZ5LWNlbnRlciI+JHtxLmltYWdlQ29kZX08L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFtMb2dpYyDguYPguKvguKHguYg6IOC4leC4o+C4p+C4iOC4quC4reC4muC4guC5ieC4reC4oeC4ueC4peC5gOC4nuC4t+C5iOC4reC5gOC4peC4t+C4reC4geC4p+C4tOC4mOC4teC5geC4quC4lOC4h+C4nOC4peC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h10gLS0tCiAgICAgICAgCiAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmIIDE6IOC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4gSAoT3B0aW9ucykgLT4g4LmB4Liq4LiU4LiH4LmB4Lia4Lia4Lib4Lij4LiZ4Lix4LiiCiAgICAgICAgaWYgKHEub3B0aW9ucyAmJiBBcnJheS5pc0FycmF5KHEub3B0aW9ucykgJiYgcS5vcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaHRtbCArPSBgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgbXQtMiBzcGFjZS15LTEgdGV4dC1zbSIgaWQ9InEtb3B0aW9ucy0ke2luZGV4fSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAke3Eub3B0aW9ucy5tYXAoKG9wdCwgaSkgPT4gYDxsaSBjbGFzcz0iJHtpID09PSBxLmNvcnJlY3RBbnN3ZXJJbmRleCA/ICd0ZXh0LWdyZWVuLTYwMCBmb250LWJvbGQnIDogJyd9Ij4ke29wdH08L2xpPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgICA8L3VsPmA7CiAgICAgICAgCiAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmIIDI6IOC5gOC4m+C5h+C4meC4iOC4seC4muC4hOC4ueC5iCAtPiDguYHguKrguJTguIfguITguLPguJXguK3guJrguITguLnguYjguIHguLHguJkKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nIHx8IHEuY29ycmVjdFJlc3BvbnNlKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im10LTIgcC0yIGJnLWdyZWVuLTEwMCB0ZXh0LXNtIj48c3Ryb25nIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIj7guITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIc6PC9zdHJvbmc+IDxzcGFuIGlkPSJxLWNvcnJlY3QtJHtpbmRleH0iPiR7cS5jb3JyZWN0UmVzcG9uc2V9PC9zcGFuPjwvZGl2PmA7CiAgICAgICAgCiAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmIIDM6IOC5gOC4m+C5h+C4mSBUcnVlL0ZhbHNlCiAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyB8fCB0eXBlb2YgcS5jb3JyZWN0QW5zd2VyID09PSAnYm9vbGVhbicpIHsKICAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im10LTIgc3BhY2UteS0xIHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9IiR7cS5jb3JyZWN0QW5zd2VyID09PSB0cnVlID8gJ3RleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCcgOiAnJ30iPuC5g+C4iuC5iDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSIke3EuY29ycmVjdEFuc3dlciA9PT0gZmFsc2UgPyAndGV4dC1ncmVlbi02MDAgZm9udC1ib2xkJyA6ICcnfSI+4LmE4Lih4LmI4LmD4LiK4LmIPC9wPgogICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIAogICAgICAgIC8vIOC4geC4o+C4k+C4teC4l+C4teC5iCA0OiAoRmFsbGJhY2spIOC4luC5ieC4suC5hOC4oeC5iOC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4gSDguYHguJXguYjguKHguLUgaWRlYWxBbnN3ZXIgLT4g4LmB4Liq4LiU4LiH4LmB4Lia4Lia4LmA4LiV4Li04Lih4LiE4LizCiAgICAgICAgfSBlbHNlIGlmIChxLmlkZWFsQW5zd2VyKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im10LTIgcC0yIGJnLWdyYXktMTAwIHRleHQtc20iPjxzdHJvbmcgY2xhc3M9InRleHQtZ3JheS03MDAiPuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4hOC4suC4lOC4q+C4p+C4seC4hzo8L3N0cm9uZz4gPHNwYW4gaWQ9InEtaWRlYWwtJHtpbmRleH0iPiR7cS5pZGVhbEFuc3dlcn08L3NwYW4+PC9kaXY+YDsKICAgICAgICAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguIHguKPguJPguLXguYTguKHguYjguYDguILguYnguLLguJ7guKfguIHguIjguKPguLTguIfguYYgKOC4guC5ieC4reC4oeC4ueC4peC5hOC4oeC5iOC4hOC4o+C4mikKICAgICAgICAgICAgIGh0bWwgKz0gYDxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAgdGV4dC1zbSI+4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUOiDguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYDguInguKXguKLguKvguKPguLfguK3guJXguLHguKfguYDguKXguLfguK3guIE8L3A+YDsKICAgICAgICB9CgogICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im10LTIgcC0yIGJnLWJsdWUtNTAgdGV4dC14cyI+PHN0cm9uZyBjbGFzcz0idGV4dC1ibHVlLTcwMCI+4LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiOjwvc3Ryb25nPiA8c3BhbiBpZD0icS1leHBsYW5hdGlvbi0ke2luZGV4fSI+JHtxLmV4cGxhbmF0aW9ufTwvc3Bhbj48L2Rpdj5gOwogICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICB9KTsKCiAgICBodG1sICs9IGA8ZGl2IGlkPSJnZW5lcmF0ZWQtcXVpei1hY3Rpb25zIiBjbGFzcz0ibXQtNCI+CiAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbXktMyI+CiAgICAgICAgICAgIDxpbnB1dCBpZD0icHJlLXRlc3QtY2hlY2tib3giIHR5cGU9ImNoZWNrYm94IiBjbGFzcz0iaC00IHctNCB0ZXh0LWluZGlnby02MDAgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQgZm9jdXM6cmluZy1pbmRpZ28tNTAwIj4KICAgICAgICAgICAgPGxhYmVsIGZvcj0icHJlLXRlc3QtY2hlY2tib3giIGNsYXNzPSJtbC0yIGJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0gdGV4dC1ncmF5LTkwMCI+4Lia4Lix4LiZ4LiX4Li24LiB4LmA4Lib4LmH4LiZ4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4LmA4Lij4Li14Lii4LiZIChQcmUtdGVzdCk8L2xhYmVsPgogICAgICAgIDwvZGl2PgogICAgICAgIDxidXR0b24gaWQ9InZlcmlmeS1hbnN3ZXJzLWJ0biIgY2xhc3M9InctZnVsbCBiZy15ZWxsb3ctNTAwIHRleHQtd2hpdGUgcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy15ZWxsb3ctNjAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2stZG91YmxlIG1yLTIiPjwvaT7guJXguKPguKfguIjguJfguLLguJnguITguKfguLLguKHguJbguLnguIHguJXguYnguK3guIfguILguK3guIfguYDguInguKXguKIgKEFJKTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9ImV4cG9ydC13b3Jrc2hlZXQtcGRmLWJ0biIgY2xhc3M9InctZnVsbCBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1yZWQtNzAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtZmlsZS1wZGYgbXItMiI+PC9pPkV4cG9ydCDguYDguJvguYfguJnguYPguJrguIfguLLguJkgKFBERik8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJzYXZlLXF1aXotYnRuIiBjbGFzcz0idy1mdWxsIGJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctZ3JlZW4tNzAwIj48aSBjbGFzcz0iZmFzIGZhLXNhdmUgbXItMiI+PC9pPuC4muC4seC4meC4l+C4tuC4geC5geC4peC4sOC4quC4o+C5ieC4suC4h+C4o+C4q+C4seC4qjwvYnV0dG9uPgogICAgPC9kaXY+YDsKICAgIAogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7CiAgICAKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5lZGl0LXF1ZXN0aW9uLWJ0bicpLmZvckVhY2goYnRuID0+IGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUVkaXRRdWVzdGlvbikpOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJlZ2VuZXJhdGUtcXVlc3Rpb24tYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlUmVnZW5lcmF0ZVF1ZXN0aW9uKSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LXdvcmtzaGVldC1wZGYtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBleHBvcnRRdWl6QXNXb3Jrc2hlZXRQREYpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmeS1hbnN3ZXJzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlVmVyaWZ5QW5zd2Vycyk7CgogICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXF1aXotYnRuJyk7CiAgICBpZiAoc2F2ZUJ1dHRvbikgewogICAgICAgIGNvbnN0IHByb2plY3RJZEZvclNhdmUgPSBmb3JjZWRQcm9qZWN0SWQgfHwgY3VycmVudFByb2plY3RJZDsgCiAgICAgICAgc2F2ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNhdmVRdWl6KHByb2plY3RJZEZvclNhdmUsIGJsdWVwcmludFRvcGljSWQpKTsKICAgIH0KCiAgICBpZiAod2luZG93Lk1hdGhKYXgpIHdpbmRvdy5NYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtjb250YWluZXJdKTsKfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGhhbmRsZVJlZ2VuZXJhdGVRdWVzdGlvbihlKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7CiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gY3VycmVudFF1aXpEYXRhLnRvcGljOwogICAgICAgICAgICBzaG93TWVzc2FnZShg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LiC4LmJ4LitICR7cGFyc2VJbnQoaW5kZXgpICsgMX0g4LmD4Lir4Lih4LmILi4uYCk7CiAgICAgICAgICAgIGdlbmVyYXRlUXVpeih0b3BpYywgbnVsbCwgcGFyc2VJbnQoaW5kZXgpKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBTVkcgRHJhZyBhbmQgRHJvcCBGdW5jdGlvbnMgKE1vdXNlICYgVG91Y2gpIC0tLQogICAgICAgIGZ1bmN0aW9uIGdldFBvaW50ZXJQb3NpdGlvbihzdmcsIGV2dCkgewogICAgICAgICAgICBjb25zdCBDVE0gPSBzdmcuZ2V0U2NyZWVuQ1RNKCk7CiAgICAgICAgICAgIGxldCBjbGllbnRYLCBjbGllbnRZOwoKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIHRvdWNoIGV2ZW50CiAgICAgICAgICAgIGlmIChldnQudG91Y2hlcyAmJiBldnQudG91Y2hlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjbGllbnRYID0gZXZ0LnRvdWNoZXNbMF0uY2xpZW50WDsKICAgICAgICAgICAgICAgIGNsaWVudFkgPSBldnQudG91Y2hlc1swXS5jbGllbnRZOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gbW91c2UgZXZlbnQKICAgICAgICAgICAgICAgIGNsaWVudFggPSBldnQuY2xpZW50WDsKICAgICAgICAgICAgICAgIGNsaWVudFkgPSBldnQuY2xpZW50WTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHg6IChjbGllbnRYIC0gQ1RNLmUpIC8gQ1RNLmEsCiAgICAgICAgICAgICAgICB5OiAoY2xpZW50WSAtIENUTS5mKSAvIENUTS5kCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdGFydERyYWcoZXZ0KSB7CiAgICAgICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCB0b3VjaCBhY3Rpb25zIGxpa2Ugc2Nyb2xsaW5nCiAgICAgICAgICAgIGlmIChldnQudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7CiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB0YXJnZXQgPSBldnQudGFyZ2V0LmNsb3Nlc3QoJy5kcmFnZ2FibGUtdGV4dCcpOwogICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBkcmFnZ2VkU3ZnRWxlbWVudCA9IHRhcmdldDsKICAgICAgICAgICAgICAgIGNvbnN0IHN2ZyA9IGRyYWdnZWRTdmdFbGVtZW50Lm93bmVyU1ZHRWxlbWVudDsKICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJQb3MgPSBnZXRQb2ludGVyUG9zaXRpb24oc3ZnLCBldnQpOwoKICAgICAgICAgICAgICAgIHN2Z09mZnNldC54ID0gcG9pbnRlclBvcy54IC0gcGFyc2VGbG9hdChkcmFnZ2VkU3ZnRWxlbWVudC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAieCIpKTsKICAgICAgICAgICAgICAgIHN2Z09mZnNldC55ID0gcG9pbnRlclBvcy55IC0gcGFyc2VGbG9hdChkcmFnZ2VkU3ZnRWxlbWVudC5nZXRBdHRyaWJ1dGVOUyhudWxsLCAieSIpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCQkKLyoqCiAqIOC4hOC4s+C4meC4p+C4k+C4hOC5iOC4suC4hOC4p+C4suC4oeC4ouC4suC4gSAocCksIOC4hOC5iOC4suC4reC4s+C4meC4suC4iOC4iOC4s+C5geC4meC4gSAociksIOC5geC4peC4sOC4o+C4suC4ouC4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4meC5g+C4meC4geC4peC4uOC5iOC4oeC4leC5iOC4suC4h+C5hgogKiBAcGFyYW0ge29iamVjdH0gcXVpekRhdGEg4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCiAqIEBwYXJhbSB7QXJyYXl9IHN1Ym1pc3Npb25zIOC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4uOC4geC4hOC4mQogKiBAcmV0dXJucyB7b2JqZWN0fSDguK3guYfguK3guJrguYDguIjguIHguJXguYzguJfguLXguYjguYDguIHguYfguJrguJfguLHguYnguIfguKrguJbguLTguJXguLTguKPguLLguKLguILguYnguK0gKHBlclF1ZXN0aW9uU3RhdHMpIOC5geC4peC4sOC4guC5ieC4reC4oeC4ueC4peC4geC4peC4uOC5iOC4oeC4oOC4suC4nuC4o+C4p+C4oSAob3ZlcmFsbEdyb3VwcykKICovCmZ1bmN0aW9uIGNhbGN1bGF0ZUl0ZW1BbmFseXNpcyhxdWl6RGF0YSwgc3VibWlzc2lvbnMpIHsKICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0cyA9IHt9OwogICAgaWYgKHN1Ym1pc3Npb25zLmxlbmd0aCA8IDIpIHJldHVybiB7IHBlclF1ZXN0aW9uU3RhdHM6IHt9LCBvdmVyYWxsR3JvdXBzOiBudWxsIH07IC8vIOC5geC4geC5ieC5hOC4giByZXR1cm4g4LiE4LmI4Liy4Lin4LmI4Liy4LiHCgogICAgY29uc3Qgc29ydGVkU3VibWlzc2lvbnMgPSBbLi4uc3VibWlzc2lvbnNdLnNvcnQoKGEsIGIpID0+IHsKICAgIC8vIDEuIOC5gOC4o+C4teC4ouC4h+C4leC4suC4oeC4hOC4sOC5geC4meC4meC4peC5iOC4suC4quC4uOC4lCAo4Lih4Liy4LiB4LmE4Lib4LiZ4LmJ4Lit4LiiKQogICAgY29uc3Qgc2NvcmVEaWZmID0gYi5sYXRlc3RTY29yZSAtIGEubGF0ZXN0U2NvcmU7CiAgICBpZiAoc2NvcmVEaWZmICE9PSAwKSByZXR1cm4gc2NvcmVEaWZmOwoKICAgIC8vIDIuIOC4luC5ieC4suC4hOC4sOC5geC4meC4meC5gOC4l+C5iOC4suC4geC4seC4mSDguYPguKvguYnguYDguKPguLXguKLguIfguJXguLLguKHguIjguLPguJnguKfguJnguITguKPguLHguYnguIfguJfguLXguYjguJfguLMgKOC4meC5ieC4reC4ouC5hOC4m+C4oeC4suC4gSkKICAgIGNvbnN0IGF0dGVtcHRzQSA9IGEuYXR0ZW1wdHM/Lmxlbmd0aCB8fCAxOwogICAgY29uc3QgYXR0ZW1wdHNCID0gYi5hdHRlbXB0cz8ubGVuZ3RoIHx8IDE7CiAgICBjb25zdCBhdHRlbXB0RGlmZiA9IGF0dGVtcHRzQSAtIGF0dGVtcHRzQjsKICAgIGlmIChhdHRlbXB0RGlmZiAhPT0gMCkgcmV0dXJuIGF0dGVtcHREaWZmOwoKICAgIC8vIDMuIOC4luC5ieC4suC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4h+C5gOC4l+C5iOC4suC4geC4seC4mSDguYPguKvguYnguYDguKPguLXguKLguIfguJXguLLguKHguYDguKfguKXguLLguJfguLXguYjguKrguYjguIcgKOC4geC5iOC4reC4meC5hOC4m+C4q+C4peC4seC4hykKICAgIGNvbnN0IHRpbWVBID0gbmV3IERhdGUoYS5sYXRlc3RTdWJtaXR0ZWRBdCk7CiAgICBjb25zdCB0aW1lQiA9IG5ldyBEYXRlKGIubGF0ZXN0U3VibWl0dGVkQXQpOwogICAgY29uc3QgdGltZURpZmYgPSB0aW1lQSAtIHRpbWVCOwogICAgaWYgKHRpbWVEaWZmICE9PSAwKSByZXR1cm4gdGltZURpZmY7CgogICAgLy8gNC4g4LiW4LmJ4Liy4LmA4Lin4Lil4Liy4Liq4LmI4LiH4LmA4LiX4LmI4Liy4LiB4Lix4LiZIOC5g+C4q+C5ieC5gOC4o+C4teC4ouC4h+C4leC4suC4oeC4iuC4t+C5iOC4rSAo4LiBLeC4rikKICAgIHJldHVybiBhLnN0dWRlbnROYW1lLmxvY2FsZUNvbXBhcmUoYi5zdHVkZW50TmFtZSwgJ3RoJyk7Cn0pOwogICAgY29uc3QgdG90YWxTdHVkZW50cyA9IHNvcnRlZFN1Ym1pc3Npb25zLmxlbmd0aDsKCiAgICBjb25zdCBncm91cFNpemUgPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKHRvdGFsU3R1ZGVudHMgKiAwLjMzKSk7CiAgICBpZiAoZ3JvdXBTaXplID09PSAwKSByZXR1cm4geyBwZXJRdWVzdGlvblN0YXRzOiB7fSwgb3ZlcmFsbEdyb3VwczogbnVsbCB9OyAvLyDguYHguIHguYnguYTguIIgcmV0dXJuIOC4hOC5iOC4suC4p+C5iOC4suC4hwoKICAgIGNvbnN0IHVwcGVyR3JvdXAgPSBzb3J0ZWRTdWJtaXNzaW9ucy5zbGljZSgwLCBncm91cFNpemUpOwogICAgY29uc3QgbG93ZXJHcm91cCA9IHNvcnRlZFN1Ym1pc3Npb25zLnNsaWNlKC1ncm91cFNpemUpOwoKICAgIC8vIFvguYDguJ7guLTguYjguKHguKrguYjguKfguJnguJnguLXguYldIOC4quC4o+C5ieC4suC4h+C4o+C4suC4ouC4iuC4t+C5iOC4reC4geC4peC4uOC5iOC4oeC4oOC4suC4nuC4o+C4p+C4oQogICAgY29uc3Qgb3ZlcmFsbFVwcGVyR3JvdXBOYW1lcyA9IHVwcGVyR3JvdXAubWFwKHN1YiA9PiBzdWIuc3R1ZGVudE5hbWUpOwogICAgY29uc3Qgb3ZlcmFsbExvd2VyR3JvdXBOYW1lcyA9IGxvd2VyR3JvdXAubWFwKHN1YiA9PiBzdWIuc3R1ZGVudE5hbWUpOwoKICAgIHF1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKChxdWVzdGlvbiwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCBxdWVzdGlvblRleHQgPSBxdWVzdGlvbi5zdGVtIHx8IHF1ZXN0aW9uLnF1ZXN0aW9uVGV4dDsKICAgICAgICBsZXQgdG90YWxDb3JyZWN0ID0gMDsKICAgICAgICBsZXQgdXBwZXJDb3JyZWN0ID0gMDsKICAgICAgICBsZXQgbG93ZXJDb3JyZWN0ID0gMDsKCiAgICAgICAgY29uc3QgdXBwZXJHcm91cFJlc3BvbmRlcnMgPSBbXTsKICAgICAgICBjb25zdCBsb3dlckdyb3VwUmVzcG9uZGVycyA9IFtdOwoKICAgICAgICB1cHBlckdyb3VwLmZvckVhY2goc3ViID0+IHsKICAgICAgICAgICAgY29uc3QgbGF0ZXN0QXR0ZW1wdCA9IHN1Yi5hdHRlbXB0c1tzdWIuYXR0ZW1wdHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckl0ZW0gPSBsYXRlc3RBdHRlbXB0LmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0ID09PSBxdWVzdGlvblRleHQpOwogICAgICAgICAgICB1cHBlckdyb3VwUmVzcG9uZGVycy5wdXNoKHsgbmFtZTogc3ViLnN0dWRlbnROYW1lLCBpc0NvcnJlY3Q6IGFuc3dlckl0ZW0gPyBhbnN3ZXJJdGVtLmlzQ29ycmVjdCA6IGZhbHNlIH0pOwogICAgICAgICAgICBpZiAoYW5zd2VySXRlbSAmJiBhbnN3ZXJJdGVtLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgdXBwZXJDb3JyZWN0Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgbG93ZXJHcm91cC5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBjb25zdCBhbnN3ZXJJdGVtID0gbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZpbmQoYW5zID0+IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCA9PT0gcXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgbG93ZXJHcm91cFJlc3BvbmRlcnMucHVzaCh7IG5hbWU6IHN1Yi5zdHVkZW50TmFtZSwgaXNDb3JyZWN0OiBhbnN3ZXJJdGVtID8gYW5zd2VySXRlbS5pc0NvcnJlY3QgOiBmYWxzZSB9KTsKICAgICAgICAgICAgaWYgKGFuc3dlckl0ZW0gJiYgYW5zd2VySXRlbS5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIGxvd2VyQ29ycmVjdCsrOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4gewogICAgICAgICAgICBjb25zdCBsYXRlc3RBdHRlbXB0ID0gc3ViLmF0dGVtcHRzW3N1Yi5hdHRlbXB0cy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgY29uc3QgYW5zd2VySXRlbSA9IGxhdGVzdEF0dGVtcHQuYW5zd2Vycy5maW5kKGFucyA9PiBhbnMub3JpZ2luYWxRdWVzdGlvblRleHQgPT09IHF1ZXN0aW9uVGV4dCk7CiAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtICYmIGFuc3dlckl0ZW0uaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICB0b3RhbENvcnJlY3QrKzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBwX3ZhbHVlID0gdG90YWxTdHVkZW50cyA+IDAgPyAodG90YWxDb3JyZWN0IC8gdG90YWxTdHVkZW50cykgOiAwOwogICAgICAgIGNvbnN0IHJfdmFsdWUgPSBncm91cFNpemUgPiAwID8gKHVwcGVyQ29ycmVjdCAvIGdyb3VwU2l6ZSkgLSAobG93ZXJDb3JyZWN0IC8gZ3JvdXBTaXplKSA6IDA7CiAgICAgICAgCiAgICAgICAgYW5hbHlzaXNSZXN1bHRzW2luZGV4XSA9IHsgCiAgICAgICAgICAgIHA6IHBfdmFsdWUsIAogICAgICAgICAgICByOiByX3ZhbHVlLAogICAgICAgICAgICB1cHBlckdyb3VwUmVzcG9uZGVyczogdXBwZXJHcm91cFJlc3BvbmRlcnMsCiAgICAgICAgICAgIGxvd2VyR3JvdXBSZXNwb25kZXJzOiBsb3dlckdyb3VwUmVzcG9uZGVycwogICAgICAgIH07CiAgICB9KTsKCiAgICAvLyBb4LmB4LiB4LmJ4LmE4LiC4Liq4LmI4Lin4LiZ4LiZ4Li14LmJXSDguYDguJvguKXguLXguYjguKLguJnguKPguLnguJvguYHguJrguJrguIHguLLguKMgcmV0dXJuIOC4guC5ieC4reC4oeC4ueC4pQogICAgcmV0dXJuIHsKICAgICAgICBwZXJRdWVzdGlvblN0YXRzOiBhbmFseXNpc1Jlc3VsdHMsCiAgICAgICAgb3ZlcmFsbEdyb3VwczogewogICAgICAgICAgICB1cHBlckdyb3VwTmFtZXM6IG92ZXJhbGxVcHBlckdyb3VwTmFtZXMsCiAgICAgICAgICAgIGxvd2VyR3JvdXBOYW1lczogb3ZlcmFsbExvd2VyR3JvdXBOYW1lcwogICAgICAgIH0KICAgIH07Cn0KCiAgICAgICAgZnVuY3Rpb24gZHJhZyhldnQpIHsKICAgICAgICAgICAgaWYgKGRyYWdnZWRTdmdFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN2ZyA9IGRyYWdnZWRTdmdFbGVtZW50Lm93bmVyU1ZHRWxlbWVudDsKICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50ZXJQb3MgPSBnZXRQb2ludGVyUG9zaXRpb24oc3ZnLCBldnQpOwogICAgICAgICAgICAgICAgY29uc3Qgdmlld0JveCA9IHN2Zy52aWV3Qm94LmJhc2VWYWw7CgogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHByb3Bvc2VkIG5ldyBjb29yZGluYXRlcwogICAgICAgICAgICAgICAgbGV0IG5ld1ggPSBwb2ludGVyUG9zLnggLSBzdmdPZmZzZXQueDsKICAgICAgICAgICAgICAgIGxldCBuZXdZID0gcG9pbnRlclBvcy55IC0gc3ZnT2Zmc2V0Lnk7CgogICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBib3VuZGluZyBib3ggb2YgdGhlIHRleHQgZWxlbWVudCBpdHNlbGYgdG8gcHJldmVudCBpdCBmcm9tIGdvaW5nIHBhcnRpYWxseSBvZmYtc2NyZWVuCiAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QkJveCA9IGRyYWdnZWRTdmdFbGVtZW50LmdldEJCb3goKTsKCiAgICAgICAgICAgICAgICAvLyBDbGFtcCBjb29yZGluYXRlcyB3aXRoaW4gdGhlIFNWRyB2aWV3Ym94CiAgICAgICAgICAgICAgICBuZXdYID0gTWF0aC5tYXgodmlld0JveC54LCBNYXRoLm1pbihuZXdYLCB2aWV3Qm94LnggKyB2aWV3Qm94LndpZHRoIC0gdGV4dEJCb3gud2lkdGgpKTsKICAgICAgICAgICAgICAgIG5ld1kgPSBNYXRoLm1heCh2aWV3Qm94LnksIE1hdGgubWluKG5ld1ksIHZpZXdCb3gueSArIHZpZXdCb3guaGVpZ2h0IC0gdGV4dEJCb3guaGVpZ2h0KSk7CgogICAgICAgICAgICAgICAgZHJhZ2dlZFN2Z0VsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgIngiLCBuZXdYKTsKICAgICAgICAgICAgICAgIGRyYWdnZWRTdmdFbGVtZW50LnNldEF0dHJpYnV0ZU5TKG51bGwsICJ5IiwgbmV3WSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGVuZERyYWcoZXZ0KSB7CiAgICAgICAgICAgIGRyYWdnZWRTdmdFbGVtZW50ID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBTVkcgRWRpdCBDbGljayBIYW5kbGVyIC0tLQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN2Z0VkaXRDbGljayhlKSB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2RlbGV0ZS1zdmctYnRuJykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldElkID0gZS50YXJnZXQuZGF0YXNldC50YXJnZXRJZDsKICAgICAgICAgICAgICAgIGNvbnN0IHN2ZyA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHRFbGVtZW50VG9EZWxldGUgPSBzdmcucXVlcnlTZWxlY3RvcihgIyR7dGFyZ2V0SWR9YCk7CiAgICAgICAgICAgICAgICBpZiAodGV4dEVsZW1lbnRUb0RlbGV0ZSkgewogICAgICAgICAgICAgICAgICAgIHRleHRFbGVtZW50VG9EZWxldGUucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlLnRhcmdldC5yZW1vdmUoKTsgLy8gUmVtb3ZlIHRoZSBkZWxldGUgYnV0dG9uIGl0c2VsZgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUVkaXRRdWVzdGlvbihlKSAgeyAvKiBSZW1vdmVkICovIH0gCgpsZXQgY3VycmVudEVkaXRpbmdRdWl6RGF0YSA9IG51bGw7IC8vIOC5gOC4nuC4tOC5iOC4oeC4leC4seC4p+C5geC4m+C4oyBnbG9iYWwg4LiZ4Li14LmJ4LmE4Lin4LmJ4LiU4LmJ4Liy4LiZ4Lia4LiZ4LiC4Lit4LiHIHNjcmlwdAoKICAgICAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguJfguLXguYggMTog4LmA4Lib4Li04LiUIEVkaXRvciDguYHguKXguLDguJTguLbguIfguILguYnguK3guKHguLnguKUKICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVPcGVuUXVpekVkaXRvcihxdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIHJlbmRlclF1aXpFZGl0b3IocXVpekRhdGEpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIGhhbmRsZVRvZ2dsZUhpZGRlbk9wdGlvbnMoaW5kZXgpIHsKICAgIGlmICghY3VycmVudEVkaXRpbmdRdWl6RGF0YSB8fCAhY3VycmVudEVkaXRpbmdRdWl6RGF0YS5xdWVzdGlvbnNbaW5kZXhdKSByZXR1cm47CiAgICAKICAgIGNvbnN0IHEgPSBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF07CiAgICBjb25zdCBjdXJyZW50VHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8ICdtdWx0aXBsZV9jaG9pY2UnOwoKICAgIC8vIDEuIOC5gOC4geC5h+C4muC4guC5ieC4reC4oeC4ueC4peC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4iOC4suC4gSBET00g4Lil4LiH4LiV4Lix4Lin4LmB4Lib4LijIHEg4LiB4LmI4Lit4LiZICjguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguKrguLTguYjguIfguJfguLXguYjguJ7guLTguKHguJ7guYzguKXguYjguLLguKrguLjguJTguKvguLLguKLguYTguJspCiAgICBjb25zdCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5xdWVzdGlvbi1lZGl0b3ItaXRlbVtkYXRhLXEtaW5kZXg9IiR7aW5kZXh9Il1gKTsKICAgIGlmIChlbCkgewogICAgICAgIHEucXVlc3Rpb25UZXh0ID0gZWwucXVlcnlTZWxlY3RvcigndGV4dGFyZWEnKS52YWx1ZTsKICAgICAgICAKICAgICAgICBpZiAoY3VycmVudFR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnKSB7CiAgICAgICAgICAgIGNvbnN0IG9wdGlvbklucHV0cyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5vcHRpb24taW5wdXQnKTsKICAgICAgICAgICAgcS5vcHRpb25zID0gQXJyYXkuZnJvbShvcHRpb25JbnB1dHMpLm1hcChpbnB1dCA9PiBpbnB1dC52YWx1ZSk7CiAgICAgICAgICAgIGNvbnN0IGNoZWNrZWRSYWRpbyA9IGVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9InJhZGlvIl06Y2hlY2tlZCcpOwogICAgICAgICAgICBpZiAoY2hlY2tlZFJhZGlvKSBxLmNvcnJlY3RBbnN3ZXJJbmRleCA9IHBhcnNlSW50KGNoZWNrZWRSYWRpby52YWx1ZSk7CiAgICAgICAgfSAKICAgICAgICBlbHNlIGlmIChjdXJyZW50VHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgY3VycmVudFR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgICAgIGNvbnN0IGlkZWFsSW5wdXQgPSBlbC5xdWVyeVNlbGVjdG9yKCcuaWRlYWwtYW5zd2VyLWlucHV0Jyk7CiAgICAgICAgICAgIGlmIChpZGVhbElucHV0KSBxLmlkZWFsQW5zd2VyID0gaWRlYWxJbnB1dC52YWx1ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGhpZGRlbklucHV0cyA9IGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5oaWRkZW4tb3B0aW9uLWlucHV0Jyk7CiAgICAgICAgICAgIGlmIChoaWRkZW5JbnB1dHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcS5vcHRpb25zID0gQXJyYXkuZnJvbShoaWRkZW5JbnB1dHMpLm1hcChpbnB1dCA9PiBpbnB1dC52YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gMi4g4Liq4Lil4Lix4Lia4Liq4LiW4Liy4LiZ4LiwCiAgICBpZiAoY3VycmVudFR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnKSB7CiAgICAgICAgLy8g4LmB4Lib4Lil4LiH4LmA4Lib4LmH4LiZIFNob3J0IEFuc3dlciAoSGlkZGVuIE9wdGlvbnMpCiAgICAgICAgcS5xdWVzdGlvblR5cGUgPSAnc2hvcnRfYW5zd2VyJzsKICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLLguYDguInguKXguKLguK3guLHguJXguYLguJnguKHguLHguJXguLQg4LmC4LiU4Lii4LmA4Lit4LiyIHRleHQg4LiC4Lit4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Li14LmI4LiW4Li54LiBIOC4oeC4suC5g+C4quC5iOC5g+C4mSBpZGVhbEFuc3dlcgogICAgICAgIGlmIChxLm9wdGlvbnMgJiYgcS5jb3JyZWN0QW5zd2VySW5kZXggIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBxLmlkZWFsQW5zd2VyID0gcS5vcHRpb25zW3EuY29ycmVjdEFuc3dlckluZGV4XSB8fCAnJzsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIC8vIOC5geC4m+C4peC4h+C4geC4peC4seC4muC5gOC4m+C5h+C4mSBNdWx0aXBsZSBDaG9pY2UKICAgICAgICBxLnF1ZXN0aW9uVHlwZSA9ICdtdWx0aXBsZV9jaG9pY2UnOwogICAgICAgIC8vICjguILguYnguK3guKHguLnguKUgb3B0aW9ucyDguYHguKXguLAgY29ycmVjdEFuc3dlckluZGV4IOC4ouC4seC4h+C4hOC4h+C4reC4ouC4ueC5iOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIH0KCiAgICAvLyAzLiDguKfguLLguJTguKvguJnguYnguLLguIjguK3guYPguKvguKHguYgKICAgIHJlbmRlclF1aXpFZGl0b3IoY3VycmVudEVkaXRpbmdRdWl6RGF0YSk7Cn0KCQkKCQlmdW5jdGlvbiBoYW5kbGVEZWxldGVRdWVzdGlvbkluRWRpdG9yKGluZGV4KSB7CiAgICBpZiAoIWN1cnJlbnRFZGl0aW5nUXVpekRhdGEgfHwgIWN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zW2luZGV4XSkgcmV0dXJuOwoKICAgIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4hOC4p+C4suC4oeC4hOC4s+C4luC4suC4oeC4oeC4suC5geC4quC4lOC4h+C5gOC4nuC4t+C5iOC4reC4ouC4t+C4meC4ouC4seC4mQogICAgY29uc3QgcXVlc3Rpb25UZXh0ID0gY3VycmVudEVkaXRpbmdRdWl6RGF0YS5xdWVzdGlvbnNbaW5kZXhdLnF1ZXN0aW9uVGV4dCB8fCBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF0uc3RlbTsKICAgIAogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LiE4Liz4LiW4Liy4Lih4LiC4LmJ4LitICR7aW5kZXggKyAxfSAoIiR7cXVlc3Rpb25UZXh0LnN1YnN0cmluZygwLCAyMCl9Li4uIik/YCwKICAgICAgICAoKSA9PiB7CiAgICAgICAgICAgIC8vIDEuIOC4peC4muC4hOC4s+C4luC4suC4oeC4reC4reC4geC4iOC4suC4gSBhcnJheSDguYPguJkgc3RhdGUg4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCiAgICAgICAgICAgIGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiDguKfguLLguJTguKvguJnguYnguLLguIjguK0gRWRpdG9yIOC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCAo4LiE4Liz4LiW4Liy4Lih4LiI4Liw4Lir4Liy4Lii4LmE4LibIOC5geC4peC4sOC4peC4s+C4lOC4seC4muC4guC5ieC4reC4iOC4sOC4luC4ueC4geC4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C5g+C4q+C4oeC5iCkKICAgICAgICAgICAgcmVuZGVyUXVpekVkaXRvcihjdXJyZW50RWRpdGluZ1F1aXpEYXRhKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKXguJrguITguLPguJbguLLguKHguYHguKXguYnguKcgKOC4reC4ouC5iOC4suC4peC4t+C4oeC4geC4lCAn4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiCJyDguYDguJ7guLfguYjguK3guKLguLfguJnguKLguLHguJkpIik7CiAgICAgICAgfQogICAgKTsKfQoKZnVuY3Rpb24gaGFuZGxlQWRkUXVlc3Rpb25JbkVkaXRvcigpIHsKICAgIGlmICghY3VycmVudEVkaXRpbmdRdWl6RGF0YSkgcmV0dXJuOwoKICAgIC8vIDEuIOC4reC5iOC4suC4meC4hOC5iOC4suC4m+C4o+C4sOC5gOC4oOC4l+C4hOC4s+C4luC4suC4oeC4iOC4suC4gSBEcm9wZG93bgogICAgY29uc3QgdHlwZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXctcXVlc3Rpb24tdHlwZS1zZWxlY3QnKTsKICAgIGNvbnN0IHNlbGVjdGVkVHlwZSA9IHR5cGVTZWxlY3QgPyB0eXBlU2VsZWN0LnZhbHVlIDogJ211bHRpcGxlX2Nob2ljZSc7CgogICAgLy8gMi4g4Liq4Lij4LmJ4Liy4LiH4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZ4LiV4Liy4Lih4Lib4Lij4Liw4LmA4Lig4LiX4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBCiAgICBsZXQgbmV3UXVlc3Rpb24gPSB7CiAgICAgICAgaWQ6IGBxXyR7RGF0ZS5ub3coKX1fbmV3YCwKICAgICAgICBxdWVzdGlvblR5cGU6IHNlbGVjdGVkVHlwZSwKICAgICAgICBxdWVzdGlvblRleHQ6ICctLS0gW+C4hOC4s+C4luC4suC4oeC5g+C4q+C4oeC5iF0gLS0tJywKICAgICAgICBleHBsYW5hdGlvbjogJ+C4hOC4s+C4reC4mOC4tOC4muC4suC4oi4uLicKICAgIH07CgogICAgc3dpdGNoIChzZWxlY3RlZFR5cGUpIHsKICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICBuZXdRdWVzdGlvbi5vcHRpb25zID0gWyfguJXguLHguKfguYDguKXguLfguK3guIEg4LiBJywgJ+C4leC4seC4p+C5gOC4peC4t+C4reC4gSDguIInLCAn4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIOC4hCcsICfguJXguLHguKfguYDguKXguLfguK3guIEg4LiHJ107CiAgICAgICAgICAgIG5ld1F1ZXN0aW9uLmNvcnJlY3RBbnN3ZXJJbmRleCA9IDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgbmV3UXVlc3Rpb24uaWRlYWxBbnN3ZXIgPSAn4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHJzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIG5ld1F1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgbmV3UXVlc3Rpb24uc3RlbSA9ICfguITguLPguJbguLLguKEuLi4nOwogICAgICAgICAgICBuZXdRdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2UgPSAn4LiE4Li54LmI4LiE4Liz4LiV4Lit4LiaLi4uJzsKICAgICAgICAgICAgLy8g4Liq4Liz4Lir4Lij4Lix4LiaIG1hdGNoaW5nIOC5gOC4o+C4suC4reC4suC4iOC4leC5ieC4reC4h+C5g+C4quC5iCBzdGVtIOC5g+C4mSBxdWVzdGlvblRleHQg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJIHJlbmRlclF1aXpFZGl0b3Ig4LiX4Liz4LiH4Liy4LiZ4LiW4Li54LiB4LmD4LiZ4Lia4Liy4LiH4LiI4Li44LiUCiAgICAgICAgICAgIG5ld1F1ZXN0aW9uLnF1ZXN0aW9uVGV4dCA9ICfguITguLPguJbguLLguKEuLi4nOyAKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgLy8gMy4g4LmA4Lie4Li04LmI4Lih4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmI4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIHN0YXRlCiAgICBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9ucy5wdXNoKG5ld1F1ZXN0aW9uKTsKICAgIAogICAgLy8gNC4g4Lin4Liy4LiU4Lir4LiZ4LmJ4Liy4LiI4LitIEVkaXRvciDguYPguKvguKHguYgKICAgIHJlbmRlclF1aXpFZGl0b3IoY3VycmVudEVkaXRpbmdRdWl6RGF0YSk7CiAgICAKICAgIC8vIDUuIOC5gOC4peC4t+C5iOC4reC4meC4iOC4reC5hOC4m+C4l+C4teC5iOC4hOC4s+C4luC4suC4oeC5g+C4q+C4oeC5iOC5geC4peC4sOC5guC4n+C4geC4seC4qgogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgY29uc3QgbGFzdFF1ZXN0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5xdWVzdGlvbi1lZGl0b3ItaXRlbTpsYXN0LW9mLXR5cGUnKTsKICAgICAgICBpZiAobGFzdFF1ZXN0aW9uRWxlbWVudCkgewogICAgICAgICAgICBsYXN0UXVlc3Rpb25FbGVtZW50LnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2NlbnRlcicgfSk7CiAgICAgICAgICAgIGNvbnN0IHRleHRhcmVhID0gbGFzdFF1ZXN0aW9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpOwogICAgICAgICAgICBpZiAodGV4dGFyZWEpIHRleHRhcmVhLmZvY3VzKCk7CiAgICAgICAgfQogICAgfSwgMTAwKTsKfQoJCQphc3luYyBmdW5jdGlvbiBoYW5kbGVBaUZpeFF1ZXN0aW9uKGUpICB7IC8qIFJlbW92ZWQgKi8gfSAKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2F2ZUNoYW5nZXMoKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBpbml0aWF0ZVJlR3JhZGVQcm9jZXNzKHF1aXpJZCkgewogICAgc2hvd01lc3NhZ2UoIuC4geC4s+C4peC4seC4h+C5gOC4o+C4tOC5iOC4oeC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4leC4o+C4p+C4iOC4hOC4sOC5geC4meC4meC5g+C4q+C4oeC5iC4uLiDguIHguKPguLjguJPguLLguKPguK3guKrguLHguIHguITguKPguLnguYgiKTsKCiAgICB0cnkgewogICAgICAgIC8vIDEuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4guC5ieC4reC4quC4reC4muC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4peC5iOC4suC4quC4uOC4lCAo4LiX4Li14LmI4Lih4Li14LmA4LiJ4Lil4Lii4LmD4Lir4Lih4LmIKQogICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIHF1aXpJZCk7CiAgICAgICAgY29uc3QgcXVpelNuYXAgPSBhd2FpdCBnZXREb2MocXVpelJlZik7CiAgICAgICAgaWYgKCFxdWl6U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICBjb25zdCBuZXdRdWl6RGF0YSA9IHsgaWQ6IHF1aXpJZCwgLi4ucXVpelNuYXAuZGF0YSgpIH07CgogICAgICAgIC8vIDIuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4mSAoc3VibWlzc2lvbikg4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li44LiB4LiE4LiZ4LmD4LiZ4LiC4LmJ4Lit4Liq4Lit4Lia4LiZ4Li14LmJCiAgICAgICAgY29uc3Qgc3VibWlzc2lvbnNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWQsICJzdWJtaXNzaW9ucyIpOwogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25zU25hcCA9IGF3YWl0IGdldERvY3Moc3VibWlzc2lvbnNSZWYpOwogICAgICAgIGlmIChzdWJtaXNzaW9uc1NuYXAuZW1wdHkpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC5gOC4geC5iOC4suC5g+C4q+C5ieC4leC4o+C4p+C4iOC5g+C4q+C4oeC5iCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyAzLiDguKrguKPguYnguLLguIcgUHJvbWlzZSDguKrguLPguKvguKPguLHguJrguIHguLLguKPguJXguKPguKfguIjguITguLDguYHguJnguJnguYPguKvguKHguYjguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguYHguJXguYjguKXguLDguITguJkKICAgICAgICBjb25zdCByZUdyYWRlUHJvbWlzZXMgPSBzdWJtaXNzaW9uc1NuYXAuZG9jcy5tYXAoc3VibWlzc2lvbkRvYyA9PiAKICAgICAgICAgICAgcmVHcmFkZVNpbmdsZVN1Ym1pc3Npb24oc3VibWlzc2lvbkRvYywgbmV3UXVpekRhdGEpCiAgICAgICAgKTsKCiAgICAgICAgLy8gNC4g4Lij4Lit4LmD4Lir4LmJ4LiB4Lij4Liw4Lia4Lin4LiZ4LiB4Liy4Lij4LiV4Lij4Lin4LiI4LmD4Lir4Lih4LmI4LiC4Lit4LiH4LiX4Li44LiB4LiE4LiZ4LmA4Liq4Lij4LmH4LiI4Liq4Li04LmJ4LiZCiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocmVHcmFkZVByb21pc2VzKTsKCiAgICAgICAgLy8gNS4g4Lir4Lil4Lix4LiH4LiI4Liy4LiB4LiV4Lij4Lin4LiI4LmD4Lir4Lih4LmI4LiE4Lij4Lia4LiX4Li44LiB4LiE4LiZ4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC4reC4seC4m+C5gOC4lOC4leC4leC4suC4o+C4suC4h+C4nOC4ueC5ieC4meC4s+C4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4hAogICAgICAgIC8vICjguIjguLPguYDguJvguYfguJnguJXguYnguK3guIfguKHguLUgcHJvamVjdElkIOC5g+C4meC4guC5ieC4reC4oeC4ueC4peC4guC5ieC4reC4quC4reC4mikKICAgICAgICBpZiAobmV3UXVpekRhdGEucHJvamVjdElkKSB7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBuZXdRdWl6RGF0YS5wcm9qZWN0SWQpOwogICAgICAgICAgICBjb25zdCBwcm9qZWN0U25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICAgICAgaWYgKHByb2plY3RTbmFwLmV4aXN0cygpICYmIHByb2plY3RTbmFwLmRhdGEoKS5zdHVkZW50cykgewogICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudFVwZGF0ZVByb21pc2VzID0gcHJvamVjdFNuYXAuZGF0YSgpLnN0dWRlbnRzLm1hcChzdHVkZW50TmFtZSA9PiAKICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdHVkZW50UHJvZmlsZShuZXdRdWl6RGF0YS5wcm9qZWN0SWQsIHN0dWRlbnROYW1lKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHN0dWRlbnRVcGRhdGVQcm9taXNlcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2hvd01lc3NhZ2UoYOC4leC4o+C4p+C4iOC4hOC4sOC5geC4meC4meC5g+C4q+C4oeC5iCAke3N1Ym1pc3Npb25zU25hcC5zaXplfSDguKPguLLguKLguIHguLLguKPguKrguLPguYDguKPguYfguIghIOC4hOC4sOC5geC4meC4meC5geC4peC4sOC4quC4luC4tOC4leC4tOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5hOC4lOC5ieC4o+C4seC4muC4geC4suC4o+C4reC4seC4m+C5gOC4lOC4leC5geC4peC5ieC4p2ApOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiUmUtZ3JhZGUgcHJvY2VzcyBmYWlsZWQ6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGDguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJXguKPguKfguIjguITguLDguYHguJnguJnguYPguKvguKHguYg6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmVHcmFkZVNpbmdsZVN1Ym1pc3Npb24oc3VibWlzc2lvbkRvYywgbmV3UXVpekRhdGEpIHsKICAgIGNvbnN0IHN1Ym1pc3Npb25EYXRhID0gc3VibWlzc2lvbkRvYy5kYXRhKCk7CiAgICBjb25zdCBzdHVkZW50TmFtZSA9IHN1Ym1pc3Npb25EYXRhLnN0dWRlbnROYW1lOwogICAgY29uc3Qgb2xkQXR0ZW1wdHMgPSBzdWJtaXNzaW9uRGF0YS5hdHRlbXB0cyB8fCBbXTsKICAgIGNvbnN0IG5ld0F0dGVtcHRzID0gW107CgogICAgLy8g4LiU4Li24LiHIFR5cGUgU2NvcmluZyDguIjguLLguIEgUXVpeiBEYXRhCiAgICBjb25zdCB0eXBlU2NvcmluZyA9IG5ld1F1aXpEYXRhLnNldHRpbmdzPy50eXBlU2NvcmluZyB8fCB7IG1jcTogMSwgc2E6IDEsIHRmOiAxIH07CgogICAgZm9yIChjb25zdCBhdHRlbXB0IG9mIG9sZEF0dGVtcHRzKSB7CiAgICAgICAgbGV0IG5ld1Jhd1Njb3JlID0gMDsKICAgICAgICBsZXQgbmV3RWFybmVkQmFkZ2VzID0gW107IAogICAgICAgIGxldCBjb3JyZWN0U3RyZWFrID0gMDsKICAgICAgICBjb25zdCBuZXdEZXRhaWxlZEFuc3dlcnMgPSBbXTsKICAgICAgICAKICAgICAgICAvLyDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguYDguJXguYfguKHguILguK3guIfguKPguK3guJrguJnguLXguYkgKFN1bSBvZiBXZWlnaHRzKQogICAgICAgIGxldCBhdHRlbXB0TWF4U2NvcmUgPSAwOwoKICAgICAgICBmb3IgKGNvbnN0IGFucyBvZiBhdHRlbXB0LmFuc3dlcnMpIHsKICAgICAgICAgICAgbGV0IG5ld1F1ZXN0aW9uOwogICAgICAgICAgICBpZiAoYW5zLnF1ZXN0aW9uSWQpIHsKICAgICAgICAgICAgICAgIG5ld1F1ZXN0aW9uID0gbmV3UXVpekRhdGEucXVlc3Rpb25zLmZpbmQocSA9PiBxLmlkID09PSBhbnMucXVlc3Rpb25JZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFuZXdRdWVzdGlvbiAmJiBhbnMub3JpZ2luYWxRdWVzdGlvblRleHQpIHsKICAgICAgICAgICAgICAgIG5ld1F1ZXN0aW9uID0gbmV3UXVpekRhdGEucXVlc3Rpb25zLmZpbmQocSA9PiAocS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0KSA9PT0gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOwogICAgICAgICAgICBsZXQgd2VpZ2h0ID0gMTsKCiAgICAgICAgICAgIGlmIChuZXdRdWVzdGlvbikgewogICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gbmV3UXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IG5ld1F1aXpEYXRhLnF1aXpUeXBlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyDguKvguLLguJnguYnguLPguKvguJnguLHguIEKICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3Jpbmcuc2EpIHx8IDE7CiAgICAgICAgICAgICAgICBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy50ZikgfHwgMTsKICAgICAgICAgICAgICAgIGVsc2Ugd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy5tY3EpIHx8IDE7CgogICAgICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3UXVlc3Rpb24ub3B0aW9ucyAmJiBuZXdRdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXggPCBuZXdRdWVzdGlvbi5vcHRpb25zLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdEFuc3dlclRleHQgPSBuZXdRdWVzdGlvbi5vcHRpb25zW25ld1F1ZXN0aW9uLmNvcnJlY3RBbnN3ZXJJbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3QgPSAoYW5zLmFuc3dlclRleHQgPT09IGNvcnJlY3RBbnN3ZXJUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudEFuc3dlckJvb2wgPSAoYW5zLmFuc3dlciA9PT0gdHJ1ZSB8fCBhbnMuYW5zd2VyID09PSAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3QgPSAoc3R1ZGVudEFuc3dlckJvb2wgPT09IG5ld1F1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gKGFucy5hbnN3ZXIgPT09IG5ld1F1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IGF3YWl0IGdyYWRlU2hvcnRBbnN3ZXIoYW5zLmFuc3dlciwgbmV3UXVlc3Rpb24pOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3QgPSBhbnMuaXNDb3JyZWN0OwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXR0ZW1wdE1heFNjb3JlICs9IHdlaWdodDsKCiAgICAgICAgICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIG5ld1Jhd1Njb3JlICs9IHdlaWdodDsgLy8g4Lia4Lin4LiB4LiE4Liw4LmB4LiZ4LiZ4LiV4Liy4Lih4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBCiAgICAgICAgICAgICAgICBjb3JyZWN0U3RyZWFrKys7CiAgICAgICAgICAgICAgICBpZiAoY29ycmVjdFN0cmVhayA9PT0gMykgbmV3RWFybmVkQmFkZ2VzLnB1c2goQkFER0VTLk9OX0ZJUkUuaWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29ycmVjdFN0cmVhayA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV3RGV0YWlsZWRBbnN3ZXJzLnB1c2goeyAuLi5hbnMsIGlzQ29ycmVjdDogaXNDb3JyZWN0IH0pOyAKICAgICAgICB9CgogICAgICAgIGxldCBuZXdQb2ludHMgPSAwOwogICAgICAgIGNvbnN0IGlzUHJlc2VydmVkU2NvcmUgPSBhdHRlbXB0LmlzU3luY0dhbWUgPT09IHRydWUgfHwgKGF0dGVtcHQucG9pbnRzID4gKG5ld1F1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGggKiAyMCkpOwoKICAgICAgICBpZiAoaXNQcmVzZXJ2ZWRTY29yZSkgewogICAgICAgICAgICBuZXdQb2ludHMgPSBhdHRlbXB0LnBvaW50czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguITguLPguJnguKfguJMgUG9pbnQg4LmD4Lir4Lih4LmI4LmB4Lia4Lia4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZICjguKLguLHguIfguYTguKHguYjguKPguKfguKEgQ29uZmlkZW5jZSDguYDguJ7guKPguLLguLDguILguYnguK3guKHguLnguKXguYDguIHguYjguLLguK3guLLguIjguYTguKHguYjguKHguLUpCiAgICAgICAgICAgIC8vIOC4quC4oeC4oeC4leC4tOC4p+C5iOC4suC4guC5ieC4reC4oeC4ueC4peC5gOC4geC5iOC4suC5gOC4m+C5h+C4meC5geC4muC4miBOb3JtYWwgTW9kZTog4LiW4Li54LiB4LmE4LiU4LmJIFdlaWdodCBQb2ludAogICAgICAgICAgICBuZXdQb2ludHMgPSBuZXdSYXdTY29yZTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCYWRnZSDguITguLDguYHguJnguJnguYDguJXguYfguKEgKOC5gOC4iuC5h+C4hOC4iOC4suC4geC4hOC4sOC5geC4meC4meC4lOC4tOC4miB2cyDguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEpCiAgICAgICAgICAgIGlmIChuZXdSYXdTY29yZSA9PT0gYXR0ZW1wdE1heFNjb3JlICYmIGF0dGVtcHRNYXhTY29yZSA+IDApIHsKICAgICAgICAgICAgICAgIC8vIG5ld1BvaW50cyArPSA1MDsgLy8g4LiV4Lix4LiU4LmC4Lia4LiZ4Lix4LiqICs1MCDguK3guK3guIHguJXguLLguKEgUmVxdWlyZW1lbnQg4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LmD4Lir4LmJIFBvaW50IOC4quC4sOC4l+C5ieC4reC4meC4hOC4sOC5geC4meC4meC4iOC4o+C4tOC4hwogICAgICAgICAgICAgICAgbmV3RWFybmVkQmFkZ2VzLnB1c2goQkFER0VTLlBFUkZFQ1RfU0NPUkUuaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIG5ld0F0dGVtcHRzLnB1c2goeyAKICAgICAgICAgICAgLi4uYXR0ZW1wdCwgCiAgICAgICAgICAgIHNjb3JlOiBuZXdSYXdTY29yZSwgCiAgICAgICAgICAgIHBvaW50czogbmV3UG9pbnRzLCAKICAgICAgICAgICAgYmFkZ2VzOiBBcnJheS5mcm9tKG5ldyBTZXQobmV3RWFybmVkQmFkZ2VzKSksCiAgICAgICAgICAgIGFuc3dlcnM6IG5ld0RldGFpbGVkQW5zd2VycyAKICAgICAgICB9KTsKICAgIH0KCiAgICBjb25zdCBuZXdGaXJzdFNjb3JlID0gbmV3QXR0ZW1wdHMubGVuZ3RoID4gMCA/IG5ld0F0dGVtcHRzWzBdLnNjb3JlIDogMDsKICAgIGNvbnN0IG5ld0Jlc3RTY29yZSA9IE1hdGgubWF4KC4uLm5ld0F0dGVtcHRzLm1hcChhID0+IGEuc2NvcmUpKTsKICAgIGNvbnN0IG5ld0xhdGVzdFNjb3JlID0gbmV3QXR0ZW1wdHMubGVuZ3RoID4gMCA/IG5ld0F0dGVtcHRzW25ld0F0dGVtcHRzLmxlbmd0aCAtIDFdLnNjb3JlIDogMDsKICAgIGNvbnN0IG5ld0xhdGVzdFBvaW50cyA9IG5ld0F0dGVtcHRzLmxlbmd0aCA+IDAgPyBuZXdBdHRlbXB0c1tuZXdBdHRlbXB0cy5sZW5ndGggLSAxXS5wb2ludHMgOiAwOwogICAgCiAgICAvLyDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKHguILguK3guIfguILguYnguK3guKrguK3guJrguIrguLjguJTguJvguLHguIjguIjguLjguJrguLHguJkgKOC5gOC4nuC4t+C5iOC4reC4reC4seC4m+C5gOC4lOC4lSB0b3RhbFF1ZXN0aW9ucykKICAgIGxldCBjdXJyZW50UXVpek1heFNjb3JlID0gMDsKICAgIG5ld1F1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgIGNvbnN0IHF0ID0gcS5xdWVzdGlvblR5cGUgfHwgbmV3UXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgaWYgKHF0ID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdCA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIGN1cnJlbnRRdWl6TWF4U2NvcmUgKz0gKHBhcnNlRmxvYXQodHlwZVNjb3Jpbmcuc2EpIHx8IDEpOwogICAgICAgIGVsc2UgaWYgKHF0ID09PSAndHJ1ZV9mYWxzZScpIGN1cnJlbnRRdWl6TWF4U2NvcmUgKz0gKHBhcnNlRmxvYXQodHlwZVNjb3JpbmcudGYpIHx8IDEpOwogICAgICAgIGVsc2UgY3VycmVudFF1aXpNYXhTY29yZSArPSAocGFyc2VGbG9hdCh0eXBlU2NvcmluZy5tY3EpIHx8IDEpOwogICAgfSk7CgogICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7bmV3UXVpekRhdGEuaWR9L3N1Ym1pc3Npb25zYCwgc3R1ZGVudE5hbWUpOwogICAgYXdhaXQgdXBkYXRlRG9jKHN1Ym1pc3Npb25SZWYsIHsKICAgICAgICBhdHRlbXB0czogbmV3QXR0ZW1wdHMsCiAgICAgICAgZmlyc3RTY29yZTogbmV3Rmlyc3RTY29yZSwKICAgICAgICBiZXN0U2NvcmU6IG5ld0Jlc3RTY29yZSwKICAgICAgICBsYXRlc3RTY29yZTogbmV3TGF0ZXN0U2NvcmUsCiAgICAgICAgcG9pbnRzOiBuZXdMYXRlc3RQb2ludHMsCiAgICAgICAgdG90YWxRdWVzdGlvbnM6IGN1cnJlbnRRdWl6TWF4U2NvcmUgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiV4Lix4Lin4Lir4Liy4Lij4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihCiAgICB9KTsKfQoKICAgICAgICBmdW5jdGlvbiBjbGVhbnVwUXVpek9wdGlvbnMocXVpekRhdGEpIHsKICAgICAgICAgICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Lir4LiyIOC4qy7guKMu4LihLiAoR0NEKSDguYDguJ7guLfguYjguK3guYPguIrguYnguKXguJTguJfguK3guJnguYDguKjguKnguKrguYjguKfguJkKICAgICAgICAgICAgY29uc3QgZ2NkID0gKGEsIGIpID0+IGIgPT09IDAgPyBhIDogZ2NkKGIsIGEgJSBiKTsKCiAgICAgICAgICAgIC8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC5geC4m+C4peC4h+C4quC4leC4o+C4tOC4h+C5gOC4qOC4qeC4quC5iOC4p+C4mSAo4LmA4LiK4LmI4LiZICIzIDEvMiIpIOC5gOC4m+C5h+C4meC4hOC5iOC4suC4leC4seC4p+C5gOC4peC4giAoMy41KQogICAgICAgICAgICBjb25zdCBwYXJzZUZyYWN0aW9uID0gKHN0cikgPT4gewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIHN0ciA9IHN0ci50cmltKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IHN0ci5zcGxpdCgvWyAvXS8pLmZpbHRlcihwID0+IHAgIT09ICcnKTsgLy8g4Lij4Lit4LiH4Lij4Lix4Lia4LiX4Lix4LmJ4LiHICIzIDEvMiIg4LmB4Lil4LiwICIzLzIiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHsgLy8g4LiI4Liz4LiZ4Lin4LiZ4LiE4Lil4LiwICIzIDEvMiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQocGFydHNbMF0pICsgKHBhcnNlSW50KHBhcnRzWzFdKSAvIHBhcnNlSW50KHBhcnRzWzJdKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikgeyAvLyDguYDguKjguKnguYDguIHguLTguJkgIjcvMiIKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQocGFydHNbMF0pIC8gcGFyc2VJbnQocGFydHNbMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDEgJiYgIWlzTmFOKHBhcnRzWzBdKSkgeyAvLyDguIjguLPguJnguKfguJnguYDguJXguYfguKEKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChwYXJ0c1swXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgLy8g4Lij4Li54Lib4LmB4Lia4Lia4LiX4Li14LmI4LmE4Lih4LmI4Lij4Li54LmJ4LiI4Lix4LiBCiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKXguJTguJfguK3guJnguYHguKXguLDguIjguLHguJTguKPguLnguJvguYHguJrguJrguYDguKjguKnguKrguYjguKfguJnguYPguKvguKHguYgKICAgICAgICAgICAgY29uc3Qgc2ltcGxpZnlBbmRGb3JtYXQgPSAoc3RyKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHN0ciAhPT0gJ3N0cmluZycpIHJldHVybiBzdHI7CiAgICAgICAgICAgICAgICBjb25zdCBtYXRjaCA9IHN0ci5tYXRjaCgvKFxkKylccysoXGQrKVwvKFxkKykvKTsgLy8g4LiV4Lij4Lin4LiI4LiI4Lix4Lia4Lij4Li54Lib4LmB4Lia4Lia4LiI4Liz4LiZ4Lin4LiZ4LiE4Lil4LiwICIzIDEvMiIKICAgICAgICAgICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdob2xlID0gcGFyc2VJbnQobWF0Y2hbMV0pOwogICAgICAgICAgICAgICAgICAgIGxldCBudW0gPSBwYXJzZUludChtYXRjaFsyXSk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRlbiA9IHBhcnNlSW50KG1hdGNoWzNdKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tb24gPSBnY2QobnVtLCBkZW4pOwogICAgICAgICAgICAgICAgICAgIG51bSAvPSBjb21tb247CiAgICAgICAgICAgICAgICAgICAgZGVuIC89IGNvbW1vbjsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVuID09PSAxKSByZXR1cm4gKHdob2xlICsgbnVtKS50b1N0cmluZygpOyAvLyDguJbguYnguLLguYDguJvguYfguJkgMyAyLzIg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZIDQKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7d2hvbGV9ICR7bnVtfS8ke2Rlbn1gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cjsgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4LiU4Li04Lih4LiW4LmJ4Liy4LmE4Lih4LmI4LmD4LiK4LmI4LiI4Liz4LiZ4Lin4LiZ4LiE4Lil4LiwCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAocXVpekRhdGEgJiYgcXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICBxdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaChxID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyDguJfguLPguIfguLLguJnguYDguInguJ7guLLguLDguIHguLHguJrguITguLPguJbguLLguKHguYHguJrguJrguJvguKPguJnguLHguKIgKG11bHRpcGxlX2Nob2ljZSkKICAgICAgICAgICAgICAgICAgICBpZiAocS5xdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnICYmIHEub3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVPcHRpb25zID0gbmV3IE1hcCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbENvcnJlY3RPcHRpb25UZXh0ID0gcS5vcHRpb25zW3EuY29ycmVjdEFuc3dlckluZGV4XTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHEub3B0aW9ucy5mb3JFYWNoKG9wdCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzaW1wbGlmaWVkT3B0ID0gc2ltcGxpZnlBbmRGb3JtYXQob3B0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG51bWVyaWNWYWx1ZSA9IHBhcnNlRnJhY3Rpb24oc2ltcGxpZmllZE9wdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC5g+C4iuC5ieC4hOC5iOC4suC4leC4seC4p+C5gOC4peC4guC5gOC4m+C5h+C4mSBrZXkg4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4Lin4Liy4Lih4LiL4LmJ4Liz4LiL4LmJ4Lit4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguKLguLHguIfguYTguKHguYjguKHguLUga2V5IOC4meC4teC5iSDguYPguKvguYnguYDguJ7guLTguYjguKHguYDguILguYnguLLguYTguJvguYPguJkgTWFwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtZXJpY1ZhbHVlICE9PSBudWxsICYmICF1bmlxdWVPcHRpb25zLmhhcyhudW1lcmljVmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlT3B0aW9ucy5zZXQobnVtZXJpY1ZhbHVlLCBzaW1wbGlmaWVkT3B0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyDguKrguKPguYnguLLguIcgQXJyYXkg4LiC4Lit4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4Lir4Lih4LmI4LiI4Liy4LiB4LiE4LmI4Liy4LiX4Li14LmI4LmE4Lih4LmI4LiL4LmJ4Liz4LiB4Lix4LiZCiAgICAgICAgICAgICAgICAgICAgICAgIHEub3B0aW9ucyA9IEFycmF5LmZyb20odW5pcXVlT3B0aW9ucy52YWx1ZXMoKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyDguITguYnguJnguKvguLIgSW5kZXgg4LmD4Lir4Lih4LmI4LiC4Lit4LiH4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvcnJlY3RJbmRleCA9IHEub3B0aW9ucy5maW5kSW5kZXgob3B0ID0+IG9wdCA9PT0gc2ltcGxpZnlBbmRGb3JtYXQob3JpZ2luYWxDb3JyZWN0T3B0aW9uVGV4dCkpOwogICAgICAgICAgICAgICAgICAgICAgICBxLmNvcnJlY3RBbnN3ZXJJbmRleCA9IG5ld0NvcnJlY3RJbmRleCAhPT0gLTEgPyBuZXdDb3JyZWN0SW5kZXggOiAwOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBxdWl6RGF0YTsKICAgICAgICB9CgpmdW5jdGlvbiBzaG93R2FtZVN0YXJ0Q29uZmlybWF0aW9uTW9kYWwocXVpeklkLCBtb2RlLCB0b3BpYykgewogICAgY29uc3QgcXVpeiA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCkgfHwgYWxsUXVpenplc0dsb2JhbC5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgIGNvbnN0IHRvcGljVGV4dCA9IHF1aXogPyBxdWl6LnRvcGljIDogKHRvcGljIHx8ICfguYHguJrguJrguJfguJTguKrguK3guJonKTsKCiAgICBhY3Rpb25UYXJnZXRJZCA9IHF1aXpJZDsKICAgIAogICAgY29uc3QgY29uZmlybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWdhbWUtc3RhcnQtYnRuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1zdGFydC1xdWl6LWlkJykudmFsdWUgPSBxdWl6SWQ7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1zdGFydC1tb2RlJykudmFsdWUgPSBtb2RlOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLXN0YXJ0LW1vZGFsLXRpdGxlJykuaW5uZXJUZXh0ID0gYOC5gOC4o+C4tOC5iOC4oeC4geC4tOC4iOC4geC4o+C4o+C4oTogJHt0b3BpY1RleHR9YDsKCiAgICAvLyAtLS0g4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LmB4Liq4LiU4LiH4Lic4LilIFVJIOC4leC4suC4oeC5guC4q+C4oeC4lCAtLS0KICAgIGNvbnN0IHN5bmNWYXJpYW50U2VsZWN0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy12YXJpYW50LXNlbGVjdG9yJyk7CiAgICBjb25zdCBzeW5jQmxhY2tNYXJrZXRTZXR0aW5ncyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibGFjay1tYXJrZXQtc2V0dGluZ3MtY29udGFpbmVyJyk7IAogICAgCiAgICAvLyAo4Lil4Lia4LiV4Lix4Lin4LmB4Lib4LijIG9uZXRNb2RlQ29udGFpbmVyIOC4reC4reC4gSkKICAgIAogICAgY29uc3QgdGltZXJDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXRpbWVyLWVuYWJsZS1jaGVja2JveCcpOwogICAgY29uc3Qgc3luY1RpbWVyU2V0dGluZ3MgPSB0aW1lckNoZWNrYm94ID8gdGltZXJDaGVja2JveC5jbG9zZXN0KCdkaXYuYm9yZGVyLXQnKSA6IG51bGw7CgogICAgaWYgKG1vZGUgPT09ICdzeW5jJykgewogICAgICAgIC8vIOC5guC4q+C4oeC4lCBTeW5jOiDguYHguKrguJTguIfguJXguLHguKfguYDguKXguLfguK3guIHguYLguKvguKHguJTguYDguIHguKEsIOC5gOC4p+C4peC4siwg4LiV4Lil4Liy4LiU4Lih4Li34LiUCiAgICAgICAgaWYgKHN5bmNWYXJpYW50U2VsZWN0b3IpIHN5bmNWYXJpYW50U2VsZWN0b3IuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgaWYgKHN5bmNUaW1lclNldHRpbmdzKSBzeW5jVGltZXJTZXR0aW5ncy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBpZiAoc3luY0JsYWNrTWFya2V0U2V0dGluZ3MpIHN5bmNCbGFja01hcmtldFNldHRpbmdzLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIAogICAgICAgIC8vICjguKXguJrguJrguKPguKPguJfguLHguJTguJfguLXguYjguKrguLHguYjguIcgb25ldE1vZGVDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJykg4Lit4Lit4LiBKQoKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LmC4Lir4Lih4LiU4Lit4Li34LmI4LiZ4LmGOiDguIvguYjguK3guJnguJXguLHguKfguYDguKXguLfguK3guIHguILguK3guIcgU3luYyDguYPguKvguYnguKvguKHguJQKICAgICAgICBpZiAoc3luY1ZhcmlhbnRTZWxlY3Rvcikgc3luY1ZhcmlhbnRTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBpZiAoc3luY1RpbWVyU2V0dGluZ3MpIHN5bmNUaW1lclNldHRpbmdzLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGlmIChzeW5jQmxhY2tNYXJrZXRTZXR0aW5ncykgc3luY0JsYWNrTWFya2V0U2V0dGluZ3MuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgCiAgICAgICAgLy8gKOC4peC4muC4muC4o+C4o+C4l+C4seC4lOC4l+C4teC5iOC4quC4seC5iOC4hyBvbmV0TW9kZUNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSDguK3guK3guIEpCiAgICB9CgogICAgLy8gKOC4peC4muC4quC5iOC4p+C4meC4o+C4teC5gOC4i+C5h+C4leC4hOC5iOC4siBvbmV0Q2hlY2tib3gg4Lit4Lit4LiBKQoKICAgIC8vIOC5geC4quC4lOC4hyBNb2RhbAogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tZ2FtZS1zdGFydC1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwp9Cgphc3luYyBmdW5jdGlvbiBzYXZlR2FtZVJlc3VsdHNBc1N1Ym1pc3Npb25zKGZpbmFsR2FtZURhdGEpIHsKICAgIGlmIChmaW5hbEdhbWVEYXRhLnJlc3VsdHNTYXZlZCkgewogICAgICAgIGNvbnNvbGUubG9nKCJHYW1lIHJlc3VsdHMgYWxyZWFkeSBzYXZlZC4gU2tpcHBpbmcuIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnNvbGUubG9nKCJTYXZpbmcgZ2FtZSByZXN1bHRzIChXZWlnaHRlZCBTY29yZSkuLi4iLCBmaW5hbEdhbWVEYXRhKTsKICAgIGNvbnN0IHF1aXpJZCA9IGZpbmFsR2FtZURhdGEucXVpeklkOwogICAgbGV0IHBsYXllcnNEYXRhID0gW107CgogICAgaWYgKGZpbmFsR2FtZURhdGEucGxheWVycykgeyAKICAgICAgICBwbGF5ZXJzRGF0YSA9IE9iamVjdC5lbnRyaWVzKGZpbmFsR2FtZURhdGEucGxheWVycykubWFwKChbbmFtZSwgZGF0YV0pID0+ICh7IG5hbWUsIC4uLmRhdGEgfSkpOwogICAgfSBlbHNlIGlmIChmaW5hbEdhbWVEYXRhLmdyb3VwcykgeyAKICAgICAgICBPYmplY3QudmFsdWVzKGZpbmFsR2FtZURhdGEuZ3JvdXBzKS5mb3JFYWNoKGdyb3VwID0+IHsKICAgICAgICAgICAgZ3JvdXAubWVtYmVycy5mb3JFYWNoKG1lbWJlck5hbWUgPT4gewogICAgICAgICAgICAgICAgcGxheWVyc0RhdGEucHVzaCh7IG5hbWU6IG1lbWJlck5hbWUsIHNjb3JlOiBncm91cC5zY29yZSwgYW5zd2VyczogZ3JvdXAuYW5zd2VycyB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKHBsYXllcnNEYXRhLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgIGNvbnN0IHF1aXpEYXRhID0gZmluYWxHYW1lRGF0YS5zaHVmZmxlZFF1aXogfHwgY3VycmVudFF1aXpEYXRhOwogICAgCiAgICAvLyAxLiDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEgKFRvdGFsIFdlaWdodGVkIFNjb3JlKQogICAgbGV0IHRvdGFsTWF4U2NvcmUgPSAwOwogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgY29uc3QgdyA9IGdldFF1ZXN0aW9uV2VpZ2h0KHF1aXpEYXRhLCBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZSk7CiAgICAgICAgdG90YWxNYXhTY29yZSArPSB3OwogICAgfSk7CgogICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgIGNvbnN0IHByb2plY3RJZCA9IHF1aXpEYXRhLnByb2plY3RJZCB8fCBjdXJyZW50UHJvamVjdElkOwogICAgY29uc3QgcHJvZmlsZVVwZGF0ZXMgPSB7fTsKCiAgICBmb3IgKGNvbnN0IHBsYXllciBvZiBwbGF5ZXJzRGF0YSkgewogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgLCBwbGF5ZXIubmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4LiV4Liy4Lih4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBIChXZWlnaHRlZCBSYXcgU2NvcmUpCiAgICAgICAgbGV0IHJhd1Njb3JlV2VpZ2h0ZWQgPSAwOwogICAgICAgIGNvbnN0IGFuc3dlcnNMaXN0ID0gcGxheWVyLmFuc3dlcnMgfHwgW107CiAgICAgICAgCiAgICAgICAgYW5zd2Vyc0xpc3QuZm9yRWFjaChhbnMgPT4gewogICAgICAgICAgICBpZiAoYW5zLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgLy8g4Lir4Liy4LiE4Liz4LiW4Liy4Lih4LmA4Lie4Li34LmI4Lit4LiU4Li54LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBCiAgICAgICAgICAgICAgICBjb25zdCBxID0gcXVpekRhdGEucXVlc3Rpb25zW2Fucy5xdWVzdGlvbkluZGV4XTsKICAgICAgICAgICAgICAgIGlmIChxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdyA9IGdldFF1ZXN0aW9uV2VpZ2h0KHF1aXpEYXRhLCBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZSk7CiAgICAgICAgICAgICAgICAgICAgcmF3U2NvcmVXZWlnaHRlZCArPSB3OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByYXdTY29yZVdlaWdodGVkICs9IDE7IC8vIEZhbGxiYWNrCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gMy4g4LmD4LiK4LmJIFBvaW50cyDguJfguLXguYjguYDguKXguYjguJnguYTguJTguYnguIjguKPguLTguIfguYPguJnguYDguIHguKEgKOC4o+C4p+C4oSBXYWdlciDguYHguKXguYnguKcpCiAgICAgICAgbGV0IGZpbmFsUG9pbnRzID0gKHBsYXllci50b3RhbFBvaW50cyAhPT0gdW5kZWZpbmVkKSA/IHBsYXllci50b3RhbFBvaW50cyA6IHJhd1Njb3JlV2VpZ2h0ZWQ7CgogICAgICAgIGxldCBlYXJuZWRCYWRnZXMgPSBwbGF5ZXIuYmFkZ2VzIHx8IFtdOwogICAgICAgIC8vIOC5gOC4iuC5h+C4hOC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC4iOC4suC4geC4hOC4sOC5geC4meC4meC4lOC4tOC4muC4l+C4teC5iOC4oeC4teC4meC5ieC4s+C4q+C4meC4seC4geC5geC4peC5ieC4pyDguYDguJfguLXguKLguJrguIHguLHguJrguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEKICAgICAgICBpZiAocmF3U2NvcmVXZWlnaHRlZCA9PT0gdG90YWxNYXhTY29yZSAmJiB0b3RhbE1heFNjb3JlID4gMCkgewogICAgICAgICAgICBpZiAoIWVhcm5lZEJhZGdlcy5pbmNsdWRlcygncGVyZmVjdF9zY29yZScpKSBlYXJuZWRCYWRnZXMucHVzaCgncGVyZmVjdF9zY29yZScpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZ2FtZUF0dGVtcHQgPSB7CiAgICAgICAgICAgIHNjb3JlOiByYXdTY29yZVdlaWdodGVkLCAvLyDguJrguLHguJnguJfguLbguIHguYDguJvguYfguJnguITguLDguYHguJnguJnguJfguLXguYjguKHguLXguJnguYnguLPguKvguJnguLHguIHguYHguKXguYnguKcKICAgICAgICAgICAgcG9pbnRzOiBmaW5hbFBvaW50cywgICAgIC8vIOC4muC4seC4meC4l+C4tuC4gSBQb2ludHMg4LiX4Li14LmI4LmA4Lil4LmI4LiZ4LmE4LiU4LmJ4LiI4Lij4Li04LiH4LmD4LiZ4LmA4LiB4LihCiAgICAgICAgICAgIGJhZGdlczogZWFybmVkQmFkZ2VzLAogICAgICAgICAgICBzdWJtaXR0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICBpc1N5bmNHYW1lOiB0cnVlLAogICAgICAgICAgICBhbnN3ZXJzOiBhbnN3ZXJzTGlzdC5tYXAoYW5zID0+ICh7CiAgICAgICAgICAgICAgICBxdWVzdGlvbklkOiBhbnMucXVlc3Rpb25JZCwKICAgICAgICAgICAgICAgIGFuc3dlcjogYW5zLmFuc3dlciwKICAgICAgICAgICAgICAgIGFuc3dlclRleHQ6IGFucy5hbnN3ZXJUZXh0LAogICAgICAgICAgICAgICAgaXNDb3JyZWN0OiBhbnMuaXNDb3JyZWN0LAogICAgICAgICAgICAgICAgb3JpZ2luYWxRdWVzdGlvblRleHQ6IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCwKICAgICAgICAgICAgICAgIHdhc0NvbmZpZGVudDogYW5zLndhc0NvbmZpZGVudCwKICAgICAgICAgICAgICAgIHBvd2VydXBVc2VkOiBhbnMucG93ZXJ1cFVzZWQgfHwgbnVsbCAKICAgICAgICAgICAgfSkpCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBjb25zdCBzdWJtaXNzaW9uRG9jID0gYXdhaXQgZ2V0RG9jKHN1Ym1pc3Npb25SZWYpOwogICAgICAgIGNvbnN0IGV4aXN0aW5nRGF0YSA9IHN1Ym1pc3Npb25Eb2MuZXhpc3RzKCkgPyBzdWJtaXNzaW9uRG9jLmRhdGEoKSA6IHt9OwogICAgICAgIAogICAgICAgIGNvbnN0IG9sZEJlc3RQb2ludHMgPSBleGlzdGluZ0RhdGEucG9pbnRzIHx8IDA7CiAgICAgICAgbGV0IHBvaW50c1RvQWRkID0gMDsKICAgICAgICBpZiAoZmluYWxQb2ludHMgPiBvbGRCZXN0UG9pbnRzKSB7CiAgICAgICAgICAgIHBvaW50c1RvQWRkID0gZmluYWxQb2ludHMgLSBvbGRCZXN0UG9pbnRzOwogICAgICAgIH0KCiAgICAgICAgY29uc3Qgc3VibWlzc2lvbkRhdGEgPSB7CiAgICAgICAgICAgIHN0dWRlbnROYW1lOiBwbGF5ZXIubmFtZSwKICAgICAgICAgICAgdG90YWxRdWVzdGlvbnM6IHRvdGFsTWF4U2NvcmUsIC8vIOC5g+C4iuC5ieC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC4o+C4p+C4oeC5gOC4m+C5h+C4meC4leC4seC4p+C4q+C4suC4owogICAgICAgICAgICBhdHRlbXB0czogYXJyYXlVbmlvbihnYW1lQXR0ZW1wdCksCiAgICAgICAgICAgIGxhdGVzdFNjb3JlOiByYXdTY29yZVdlaWdodGVkLAogICAgICAgICAgICBwb2ludHM6IE1hdGgubWF4KG9sZEJlc3RQb2ludHMsIGZpbmFsUG9pbnRzKSwKICAgICAgICAgICAgbGF0ZXN0U3VibWl0dGVkQXQ6IGdhbWVBdHRlbXB0LnN1Ym1pdHRlZEF0LAogICAgICAgICAgICBiZXN0U2NvcmU6IE1hdGgubWF4KChleGlzdGluZ0RhdGEuYmVzdFNjb3JlIHx8IDApLCByYXdTY29yZVdlaWdodGVkKSwKICAgICAgICAgICAgZmlyc3RTY29yZTogZXhpc3RpbmdEYXRhLmZpcnN0U2NvcmUgIT09IHVuZGVmaW5lZCA/IGV4aXN0aW5nRGF0YS5maXJzdFNjb3JlIDogcmF3U2NvcmVXZWlnaHRlZAogICAgICAgIH07CgogICAgICAgIGJhdGNoLnNldChzdWJtaXNzaW9uUmVmLCBzdWJtaXNzaW9uRGF0YSwgeyBtZXJnZTogdHJ1ZSB9KTsKCiAgICAgICAgaWYgKHByb2plY3RJZCkgewogICAgICAgICAgICBpZiAoIXByb2ZpbGVVcGRhdGVzW3BsYXllci5uYW1lXSkgewogICAgICAgICAgICAgICAgcHJvZmlsZVVwZGF0ZXNbcGxheWVyLm5hbWVdID0geyBwb2ludHNUb0FkZDogMCwgYmFkZ2VzVG9BZGQ6IFtdIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJvZmlsZVVwZGF0ZXNbcGxheWVyLm5hbWVdLnBvaW50c1RvQWRkICs9IHBvaW50c1RvQWRkOwogICAgICAgICAgICBlYXJuZWRCYWRnZXMuZm9yRWFjaChiID0+IHsKICAgICAgICAgICAgICAgIHByb2ZpbGVVcGRhdGVzW3BsYXllci5uYW1lXS5iYWRnZXNUb0FkZC5wdXNoKGIpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHByb2plY3RJZCkgewogICAgICAgIGZvciAoY29uc3QgW3N0dWRlbnROYW1lLCB1cGRhdGVEYXRhXSBvZiBPYmplY3QuZW50cmllcyhwcm9maWxlVXBkYXRlcykpIHsKICAgICAgICAgICAgaWYgKHVwZGF0ZURhdGEucG9pbnRzVG9BZGQgPiAwIHx8IHVwZGF0ZURhdGEuYmFkZ2VzVG9BZGQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0cy8ke3Byb2plY3RJZH0vc3R1ZGVudFByb2ZpbGVzYCwgc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICAgICBzdHVkZW50TmFtZTogc3R1ZGVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IGluY3JlbWVudCh1cGRhdGVEYXRhLnBvaW50c1RvQWRkKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHVwZGF0ZURhdGEuYmFkZ2VzVG9BZGQuZm9yRWFjaChiYWRnZUlkID0+IHsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVQYXlsb2FkW2BiYWRnZXNDb3VudC4ke2JhZGdlSWR9YF0gPSBpbmNyZW1lbnQoMSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJhdGNoLnNldChwcm9maWxlUmVmLCB1cGRhdGVQYXlsb2FkLCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHRyeSB7CiAgICAgICAgaWYgKGN1cnJlbnRMaXZlR2FtZUlkKSB7CiAgICAgICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgICAgICBiYXRjaC51cGRhdGUoZ2FtZVJlZiwgeyByZXN1bHRzU2F2ZWQ6IHRydWUgfSk7CiAgICAgICAgfQoKICAgICAgICBhd2FpdCBiYXRjaC5jb21taXQoKTsKICAgICAgICBjb25zb2xlLmxvZygiU2F2ZSBjb21wbGV0ZSAoV2VpZ2h0ZWQgU2NvcmVzKSIpOwogICAgICAgIHNob3dNZXNzYWdlKGDguJrguLHguJnguJfguLbguIHguJzguKXguIHguLLguKPguYDguKPguLXguKLguJnguYDguKPguLXguKLguJrguKPguYnguK3guKLguYHguKXguYnguKchYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBnYW1lIHJlc3VsdHM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIHguJzguKXguITguLDguYHguJnguJkiKTsKICAgIH0KfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzYXZlUXVpeiDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIHNhdmVRdWl6KGZvcmNlZFByb2plY3RJZCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiBwcm9tcHRGb3JQcm9qZWN0QW5kU2F2ZSgpIHsKICAgIGNvbnN0IG1vdmVRdWl6TW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LW1vZGFsJyk7CiAgICBjb25zdCBwcm9qZWN0U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdmUtcXVpei1wcm9qZWN0LXNlbGVjdCcpOwogICAgY29uc3QgbW9kYWxUaXRsZSA9IG1vdmVRdWl6TW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CgogICAgLy8gMS4g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmD4LiZIE1vZGFsIOC5g+C4q+C5ieC5gOC4q+C4oeC4suC4sOC4quC4oQogICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguYDguKXguLfguK3guIHguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guJrguLHguJnguJfguLbguIEnOwogICAgY29uZmlybUJ0bi50ZXh0Q29udGVudCA9ICfguYDguKXguLfguK3guIHguYHguKXguLDguJrguLHguJnguJfguLbguIEnOwoKICAgIC8vIDIuIOC5geC4quC4lOC4h+C4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C5gOC4iOC4hOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4l+C4teC5iOC4oeC4tQogICAgaWYgKGFsbFByb2plY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHByb2plY3RTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+4LiE4Li44LiT4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LmC4Lib4Lij4LmA4LiI4LiEPC9vcHRpb24+JzsKICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSBhbGxQcm9qZWN0cwogICAgICAgICAgICAubWFwKHAgPT4gYDxvcHRpb24gdmFsdWU9IiR7cC5pZH0iPiR7cC5wcm9qZWN0TmFtZX08L29wdGlvbj5gKQogICAgICAgICAgICAuam9pbignJyk7CiAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgfQogICAgCiAgICAvLyAzLiDguYHguKrguJTguIcgTW9kYWwKICAgIG1vdmVRdWl6TW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8gNC4g4LiI4Lix4LiU4LiB4Liy4Lij4LmA4Lih4Li34LmI4Lit4Lic4Li54LmJ4LmD4LiK4LmJ4LiB4LiU4Lib4Li44LmI4LihICLguYDguKXguLfguK3guIHguYHguKXguLDguJrguLHguJnguJfguLbguIEiCiAgICBjb25zdCBuZXdDb25maXJtSGFuZGxlciA9ICgpID0+IHsKICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3RJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgaWYgKHNlbGVjdGVkUHJvamVjdElkKSB7CiAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0SWQgPSBzZWxlY3RlZFByb2plY3RJZDsgLy8gKirguJXguLHguYnguIfguITguYjguLLguYLguJvguKPguYDguIjguITguJfguLXguYjguYDguKXguLfguK3guIEqKgogICAgICAgICAgICBtb3ZlUXVpek1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgTW9kYWwKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzYXZlUXVpeiDguK3guLXguIHguITguKPguLHguYnguIcg4LiL4Li24LmI4LiH4LiE4Lij4Lix4LmJ4LiH4LiZ4Li14LmJIGN1cnJlbnRQcm9qZWN0SWQg4LiI4Liw4LmE4Lih4LmI4LmA4Lib4LmH4LiZ4LiE4LmI4Liy4Lin4LmI4Liy4LiH4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIHNhdmVRdWl6KCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmB4Lil4LiwIEV2ZW50IExpc3RlbmVyIOC4guC4reC4hyBNb2RhbCDguYPguKvguYnguYDguJvguYfguJnguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEKICAgICAgICAgICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguYTguJvguYLguJvguKPguYDguIjguITguK3guLfguYjguJknOwogICAgICAgICAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4oic7CiAgICAgICAgICAgIGNvbmZpcm1CdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBuZXdDb25maXJtSGFuZGxlcik7CiAgICAgICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtTW92ZVF1aXopOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguYLguJvguKPguYDguIjguITguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguJrguLHguJnguJfguLbguIEiKTsKICAgICAgICB9CiAgICB9OwoKICAgIC8vIOC4peC4miBFdmVudCBMaXN0ZW5lciDguYDguIHguYjguLLguK3guK3guIHguIrguLHguYjguKfguITguKPguLLguKcg4LmB4Lil4LmJ4Lin4LmD4Liq4LmI4LiV4Lix4Lin4LmD4Lir4Lih4LmI4LmA4LiC4LmJ4Liy4LmE4LibCiAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybU1vdmVRdWl6KTsKICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBuZXdDb25maXJtSGFuZGxlcik7Cn0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBjb3B5VGV4dFRvQ2xpcGJvYXJkKHRleHQsIHN1Y2Nlc3NNZXNzYWdlKSB7CiAgICAgICAgICAgIGNvbnN0IHRleHRBcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKICAgICAgICAgICAgdGV4dEFyZWEudmFsdWUgPSB0ZXh0OwogICAgICAgICAgICB0ZXh0QXJlYS5zdHlsZS5wb3NpdGlvbiA9ICJmaXhlZCI7CiAgICAgICAgICAgIHRleHRBcmVhLnN0eWxlLm9wYWNpdHkgPSAiMCI7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGV4dEFyZWEpOwogICAgICAgICAgICB0ZXh0QXJlYS5mb2N1cygpOwogICAgICAgICAgICB0ZXh0QXJlYS5zZWxlY3QoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NmdWwgPSBkb2N1bWVudC5leGVjQ29tbWFuZCgnY29weScpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2Uoc3VjY2Vzc2Z1bCA/IHN1Y2Nlc3NNZXNzYWdlIDogIuC4hOC4seC4lOC4peC4reC4geC5hOC4oeC5iOC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguITguLHguJTguKXguK3guIHguYTguKHguYjguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvcHkgY29tbWFuZCBmYWlsZWQnLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQodGV4dEFyZWEpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIEFkbWluIFJlc3VsdHMgVmlldyAtLS0KICAgICAgICBmdW5jdGlvbiBsaXN0ZW5Gb3JQcm9qZWN0UXVpenplcyhwcm9qZWN0SWQpIHsKICAgICAgICAgICAgY29uc3QgcXVpenplc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2ApOwogICAgICAgICAgICBjb25zdCBxID0gcXVlcnkocXVpenplc1JlZiwgd2hlcmUoInByb2plY3RJZCIsICI9PSIsIHByb2plY3RJZCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgdW5zdWJzY3JpYmVRdWl6emVzTGlzdGVuZXIgPSBvblNuYXBzaG90KHEsIGFzeW5jIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgICAgYWxsUXVpenplcyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKICAgICAgICAgICAgICAgIHJlbmRlclF1aXp6ZXMoKTsKICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBwcm9qZWN0IHF1aXp6ZXM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtcXVpenplcy1saXN0JykuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC5geC4muC4muC4l+C4lOC4quC4reC4mjwvcD4nOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCmFzeW5jIGZ1bmN0aW9uIHJlbmRlclF1aXp6ZXMoKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBoYW5kbGVVbnBhaXJRdWl6KHF1aXpJZFRvVW5wYWlyKSB7CiAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZFRvVW5wYWlyKTsKICAgIGlmICghcXVpekRhdGEgfHwgIXF1aXpEYXRhLnBhaXJlZFF1aXpJZCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguIHguLLguKPguIjguLHguJrguITguLnguYgiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmI4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJP2AsCiAgICAgICAgYXN5bmMgKCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgZmlyc3RRdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWRUb1VucGFpcik7CiAgICAgICAgICAgICAgICBjb25zdCBzZWNvbmRRdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6RGF0YS5wYWlyZWRRdWl6SWQpOwoKICAgICAgICAgICAgICAgIC8vIOC4peC4muC4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iOC4guC4reC4h+C4l+C4seC5ieC4h+C4quC4reC4h+C4neC4seC5iOC4hwogICAgICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShmaXJzdFF1aXpSZWYsIHsgcGFpcmVkUXVpeklkOiBudWxsIH0pOwogICAgICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHNlY29uZFF1aXpSZWYsIHsgcGFpcmVkUXVpeklkOiBudWxsIH0pOwogICAgICAgICAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKLguIHguYDguKXguLTguIHguIHguLLguKPguIjguLHguJrguITguLnguYjguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIC8vIG9uU25hcHNob3Qg4LiI4Liw4Lit4Lix4Lib4LmA4LiU4LiVIFVJIOC5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tAogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdW5wYWlyaW5nIHF1aXp6ZXM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4ouC4geC5gOC4peC4tOC4geC4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgKTsKfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBmb3JtYXRBbmRQcmludExlc3NvblBsYW4g4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpmdW5jdGlvbiBmb3JtYXRBbmRQcmludExlc3NvblBsYW4obGVzc29uUGxhbiwgcXVpekRhdGEpIHsKICAgIGNvbnN0IGxlc3NvbldpbmRvdyA9IHdpbmRvdy5vcGVuKCcnLCAnX2JsYW5rJyk7CiAgICAKICAgIGNvbnN0IGxlc3Nvbkh0bWwgPSBgCiAgICAgICAgPCFET0NUWVBFIGh0bWw+CiAgICAgICAgPGh0bWwgbGFuZz0idGgiPgogICAgICAgIDxoZWFkPgogICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICAgICAgICAgIDx0aXRsZT7guYHguJzguJnguIHguLLguKPguKrguK3guJk6ICR7cXVpekRhdGEudG9waWN9PC90aXRsZT4KICAgICAgICAgICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbSI+PFwvc2NyaXB0PgogICAgICAgICAgICA8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PVNhcmFidW46d2dodEA0MDA7NzAwJmRpc3BsYXk9c3dhcCIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxzY3JpcHQ+CiAgICAgICAgICAgICAgICB3aW5kb3cuTWF0aEpheCA9IHsKICAgICAgICAgICAgICAgICAgICB0ZXg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5saW5lTWF0aDogW1snJCcsICckJ10sIFsnXFxcXCgnLCAnXFxcXCknXV0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN2ZzogewogICAgICAgICAgICAgICAgICAgICAgICBmb250Q2FjaGU6ICdnbG9iYWwnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgPFwvc2NyaXB0PgogICAgICAgICAgICA8c2NyaXB0IGlkPSJNYXRoSmF4LXNjcmlwdCIgYXN5bmMgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21hdGhqYXhAMy9lczUvdGV4LW1tbC1jaHRtbC5qcyI+PFwvc2NyaXB0PgogICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdTYXJhYnVuJywgc2Fucy1zZXJpZjsgfQogICAgICAgICAgICAgICAgQG1lZGlhIHByaW50IHsKICAgICAgICAgICAgICAgICAgICBib2R5IHsgLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6IGV4YWN0OyB9CiAgICAgICAgICAgICAgICAgICAgLm5vLXByaW50IHsgZGlzcGxheTogbm9uZTsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLmNvbnRlbnQtc2VjdGlvbiB7IHBhZ2UtYnJlYWstaW5zaWRlOiBhdm9pZDsgfQogICAgICAgICAgICA8L3N0eWxlPgogICAgICAgIDwvaGVhZD4KICAgICAgICA8Ym9keSBjbGFzcz0icC04IG1heC13LTR4bCBteC1hdXRvIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbWItOCI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyI+4LmB4Lic4LiZ4LiB4Liy4Lij4Liq4Lit4LiZ4LmB4Lil4Liw4LiE4Liz4LmB4LiZ4Liw4LiZ4Liz4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Lij4Li5PC9wPgogICAgICAgICAgICAgICAgPGgxIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQiPuC5gOC4o+C4t+C5iOC4reC4hzogJHtxdWl6RGF0YS50b3BpY308L2gxPgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktOCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24gYmctcmVkLTUwIHAtNCByb3VuZGVkLWxnIGJvcmRlci1sLTQgYm9yZGVyLXJlZC00MDAiPgogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1yZWQtODAwIG1iLTIiPuC4iOC4uOC4lOC4l+C4teC5iOC4meC4seC4geC5gOC4o+C4teC4ouC4meC4ouC4seC4h+C5hOC4oeC5iOC5gOC4guC5ieC4suC5g+C4iCAoTGVhcm5pbmcgR2Fwcyk8L2gyPgogICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHRleHQtcmVkLTkwMCBzcGFjZS15LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAke2xlc3NvblBsYW4ubGVhcm5pbmdHYXBzLm1hcChnYXAgPT4gYDxsaT4ke2dhcH08L2xpPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24gYmctYmx1ZS01MCBwLTQgcm91bmRlZC1sZyBib3JkZXItbC00IGJvcmRlci1ibHVlLTQwMCI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtODAwIG1iLTIiPuC5geC4meC4p+C4l+C4suC4h+C4geC4suC4o+C4quC4reC4meC5geC4peC4sOC5gOC4meC4t+C5ieC4reC4q+C4suC4l+C4muC4l+C4p+C4mTwvaDI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS04MDAgd2hpdGVzcGFjZS1wcmUtd3JhcCI+JHtsZXNzb25QbGFuLnRlYWNoaW5nQ29udGVudH08L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24gYmctZ3JlZW4tNTAgcC00IHJvdW5kZWQtbGcgYm9yZGVyLWwtNCBib3JkZXItZ3JlZW4tNDAwIj4KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtZ3JlZW4tODAwIG1iLTIiPuC5guC4iOC4l+C4ouC5jOC4leC4seC4p+C4reC4ouC5iOC4suC4h+C4quC4s+C4q+C4o+C4seC4muC4neC4tuC4geC4neC4mTwvaDI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHtsZXNzb25QbGFuLnByYWN0aWNlUHJvYmxlbXMubWFwKHAgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPuC5guC4iOC4l+C4ouC5jDo8L3N0cm9uZz4gJHtwLnF1ZXN0aW9ufTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPuC5gOC4ieC4peC4ojo8L3N0cm9uZz4gJHtwLnNvbHV0aW9ufTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2JvZHk+CiAgICAgICAgPC9odG1sPgogICAgYDsKICAgIAogICAgbGVzc29uV2luZG93LmRvY3VtZW50LndyaXRlKGxlc3Nvbkh0bWwpOwogICAgbGVzc29uV2luZG93LmRvY3VtZW50LmNsb3NlKCk7CiAgICBsZXNzb25XaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4LiB4Liy4Lij4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4Liy4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJIE1hdGhKYXgg4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiI4LiB4LmI4Lit4LiZ4Lie4Li04Lih4Lie4LmMCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGxlc3NvbldpbmRvdy5wcmludCgpOwogICAgICAgIH0sIDEwMDApOyAKICAgIH07Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFpRml4Rm9ybXVsYShpbmRleCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVMZXNzb25QbGFuKHF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAogICAgICAgIAovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGhhbmRsZUR1cGxpY2F0ZVF1aXog4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQphc3luYyBmdW5jdGlvbiBoYW5kbGVEdXBsaWNhdGVRdWl6KHF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVEZWxldGVRdWl6IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSAtLS0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVsZXRlUXVpeihxdWl6SWQsIHNob3dTdWNjZXNzTWVzc2FnZSA9IHRydWUpICB7IC8qIFJlbW92ZWQgKi8gfSAKCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gc2hvd1F1aXpEZXRhaWxWaWV3KHF1aXpJZCkgewogICAgICAgICAgICBpZiAodW5zdWJzY3JpYmVTdWJtaXNzaW9uc0xpc3RlbmVyKSB1bnN1YnNjcmliZVN1Ym1pc3Npb25zTGlzdGVuZXIoKTsKICAgICAgICAgICAgc3dpdGNoUXVpekRldGFpbFRhYignYW5hbHl0aWNzJyk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gMS4g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiE4Lil4Li04LiBCiAgICAgICAgICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWQpOwogICAgICAgICAgICAgICAgY29uc3QgcXVpekRvYyA9IGF3YWl0IGdldERvYyhxdWl6UmVmKTsKCiAgICAgICAgICAgICAgICBpZiAoIXF1aXpEb2MuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHF1aXpEYXRhID0geyBpZDogcXVpekRvYy5pZCwgLi4ucXVpekRvYy5kYXRhKCkgfTsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWl6RGF0YSA9IHF1aXpEYXRhOwoKICAgICAgICAgICAgICAgIC8vIC0tLSBbIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQogICAgICAgICAgICAgICAgLy8gMi4g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmC4Lib4Lij4LmA4LiI4LiE4LmB4Lih4LmI4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Lix4LmJ4LiZ4LmGIOC5gOC4quC4oeC4rQogICAgICAgICAgICAgICAgLy8g4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LmA4Lij4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZIChjdXJyZW50UHJvamVjdERhdGEpIOC4nuC4o+C5ieC4reC4oeC5g+C4iuC5ieC4h+C4suC4mQogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHF1aXpEYXRhLnByb2plY3RJZCk7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0RG9jID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwogICAgICAgICAgICAgICAgaWYgKHByb2plY3REb2MuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSBwcm9qZWN0RG9jLmRhdGEoKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvamVjdElkID0gcXVpekRhdGEucHJvamVjdElkOyAvLyDguK3guLHguJvguYDguJTguJUgSUQg4LmC4Lib4Lij4LmA4LiI4LiE4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4LmD4Lir4LmJ4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmA4Liq4Lih4LitCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOC5g+C4meC4geC4o+C4k+C4teC4l+C4teC5iOC5guC4m+C4o+C5gOC4iOC4hOC4luC4ueC4geC4peC4muC5hOC4m+C5geC4peC5ieC4p+C5geC4leC5iOC5geC4muC4muC4l+C4lOC4quC4reC4muC4ouC4seC4h+C4reC4ouC4ueC5iCAo4LiB4Lij4LiT4Li14LiJ4Li44LiB4LmA4LiJ4Li04LiZKQogICAgICAgICAgICAgICAgICAgIC8vIOC5g+C4q+C5ieC5g+C4iuC5ieC4guC5ieC4reC4oeC4ueC4peC4p+C5iOC4suC4h+C5hiDguYHguJfguJnguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguYHguK3guJvguJ7guLHguIcKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSB7IHN0dWRlbnRzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0SWQgPSBxdWl6RGF0YS5wcm9qZWN0SWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KCiAgICAgICAgICAgICAgICAvLyAzLiDguJXguLHguYnguIfguITguYjguLLguKvguLHguKfguILguYnguK3guYHguKXguLAgSUQg4Lia4LiZ4Lir4LiZ4LmJ4Liy4LiI4LitCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy1xdWl6LXRpdGxlJykudGV4dENvbnRlbnQgPSBxdWl6RGF0YS50b3BpYzsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLXF1aXotaWQtZGlzcGxheScpLnRleHRDb250ZW50ID0gcXVpeklkOwoKICAgICAgICAgICAgICAgIC8vIDQuIOC5gOC4o+C4tOC5iOC4oeC4n+C4seC4h+C4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4mSDguYHguKXguLDguKfguLLguJTguJzguKXguKXguLHguJ7guJjguYwKICAgICAgICAgICAgICAgIGNvbnN0IHN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkLCAic3VibWlzc2lvbnMiKTsKdW5zdWJzY3JpYmVTdWJtaXNzaW9uc0xpc3RlbmVyID0gb25TbmFwc2hvdChzdWJtaXNzaW9uc1JlZiwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gMS4g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICjguKPguKfguKHguJfguLHguYnguIfguJfguLXguYjguKLguLHguIfguJfguLPguYTguKHguYjguYDguKrguKPguYfguIgpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsU3VibWlzc2lvbnMgPSBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEoKSB9KSk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFN1Ym1pc3Npb25zID0gYWxsU3VibWlzc2lvbnM7IAoKICAgICAgICAgICAgICAgICAgICAvLyAyLiDguKrguKPguYnguLLguIcgbGlzdCDguYPguKvguKHguYjguJfguLXguYjguIHguKPguK3guIfguYDguK3guLLguYDguInguJ7guLLguLDguITguJnguJfguLXguYggIuC4l+C4s+C5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyIg4LiI4Lij4Li04LiH4LmGICjguKHguLXguILguYnguK3guKHguLnguKXguIHguLLguKPguJfguLPguILguYnguK3guKrguK3guJopCiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lie4Li34LmI4Lit4Liq4LmI4LiH4LmE4Lib4LmD4Lir4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liw4LmB4LiZ4LiZ4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGVkU3VibWlzc2lvbnMgPSBhbGxTdWJtaXNzaW9ucy5maWx0ZXIoc3ViID0+IHN1Yi5hdHRlbXB0cyAmJiBzdWIuYXR0ZW1wdHMubGVuZ3RoID4gMCk7CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4leC5iOC4suC4h+C5hiDguYLguJTguKLguKrguYjguIfguILguYnguK3guKHguLnguKXguJfguLXguYjguYDguKvguKHguLLguLDguKrguKHguYTguJvguYPguKvguYkKICAgICAgICAgICAgICAgICAgICByZW5kZXJCZWhhdmlvckxvZyhhbGxTdWJtaXNzaW9ucyk7IC8vIDwtLSDguYPguIrguYnguILguYnguK3guKHguLnguKXguJfguLHguYnguIfguKvguKHguJQKICAgICAgICAgICAgICAgICAgICByZW5kZXJBbnN3ZXJHcmlkKGN1cnJlbnRQcm9qZWN0RGF0YS5zdHVkZW50cywgY29tcGxldGVkU3VibWlzc2lvbnMsIHF1aXpEYXRhKTsgLy8gPC0tIOC5g+C4iuC5ieC5gOC4ieC4nuC4suC4sOC4l+C4teC5iOC4l+C4s+C5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgICAgIHJlbmRlckFuYWx5dGljcyhxdWl6RGF0YSwgY29tcGxldGVkU3VibWlzc2lvbnMpOyAvLyA8LS0g4LmD4LiK4LmJ4LmA4LiJ4Lie4Liy4Liw4LiX4Li14LmI4LiX4Liz4LmA4Liq4Lij4LmH4LiICiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUXVpelJlc3VsdHNUYWJsZShjdXJyZW50UHJvamVjdERhdGEuc3R1ZGVudHMsIGFsbFN1Ym1pc3Npb25zLCBxdWl6RGF0YSk7IC8vIDwtLSDguYPguIrguYnguILguYnguK3guKHguLnguKXguJfguLHguYnguIfguKvguKHguJQg4LmA4Lie4Li34LmI4Lit4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LmE4LiU4LmJ4LiE4Lij4Lia4LiX4Li44LiB4LiE4LiZCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUXVpekxlYWRlcmJvYXJkKGNvbXBsZXRlZFN1Ym1pc3Npb25zLCBxdWl6RGF0YSwgJ3F1aXotbGVhZGVyYm9hcmQtdGFibGUtYm9keScpOyAvLyA8LS0g4LmD4LiK4LmJ4LmA4LiJ4Lie4Liy4Liw4LiX4Li14LmI4LiX4Liz4LmA4Liq4Lij4LmH4LiICiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAvLyA1LiDguYHguKrguJTguIcgVmlldwogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3F1aXotcmVzdWx0cycpOwoKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNob3dpbmcgcXVpeiBkZXRhaWwgdmlldzoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmB4Liq4LiU4LiH4Lij4Liy4Lii4Lil4Liw4LmA4Lit4Li14Lii4LiU4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgkJCmZ1bmN0aW9uIHJlbmRlckFuc3dlckdyaWQoc3R1ZGVudHMsIHN1Ym1pc3Npb25zLCBxdWl6RGF0YSkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fuc3dlci1ncmlkLWNvbnRhaW5lcicpOwogICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKCiAgICBpZiAoIXN0dWRlbnRzIHx8IHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guKLguLHguIfguYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguJnguLHguIHguYDguKPguLXguKLguJnguYDguJ7guLfguYjguK3guJnguLPguKHguLLguKrguKPguYnguLLguIfguJXguLLguKPguLLguIc8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcXVlc3Rpb25zID0gcXVpekRhdGEucXVlc3Rpb25zOwogICAgY29uc3Qgc3VibWlzc2lvbnNCeVN0dWRlbnQgPSBzdWJtaXNzaW9ucy5yZWR1Y2UoKGFjYywgc3ViKSA9PiB7CiAgICAgICAgYWNjW3N1Yi5zdHVkZW50TmFtZV0gPSBzdWI7CiAgICAgICAgcmV0dXJuIGFjYzsKICAgIH0sIHt9KTsKCiAgICBjb25zdCB0b0NoYXIgPSAoaW5kZXgpID0+IFN0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBpbmRleCk7CgogICAgY29uc3QgZ2V0Q29ycmVjdEFuc3dlclRleHQgPSAocSkgPT4gewogICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHF1aXpEYXRhLnF1aXpUeXBlOwogICAgICAgIHN3aXRjaCAocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgICAgICAgICByZXR1cm4gcS5vcHRpb25zICYmIHEub3B0aW9ucy5sZW5ndGggPiBxLmNvcnJlY3RBbnN3ZXJJbmRleCA/IHRvQ2hhcihxLmNvcnJlY3RBbnN3ZXJJbmRleCkgOiAnLSc7CiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdEJvb2wgPSAocS5jb3JyZWN0QW5zd2VyID09PSB0cnVlIHx8IFN0cmluZyhxLmNvcnJlY3RBbnN3ZXIpLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gY29ycmVjdEJvb2wgPyAn4LmD4LiK4LmIJyA6ICfguYTguKHguYjguYPguIrguYgnOwogICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgIHJldHVybiBxLmNvcnJlY3RSZXNwb25zZSB8fCAnLSc7CiAgICAgICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgICAgICAgICByZXR1cm4gJ+C4nuC4tOC4oeC4nuC5jOC4leC4reC4mic7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJy0nOwogICAgICAgIH0KICAgIH07CgogICAgY29uc3QgZ2V0VXNlckFuc3dlclRleHQgPSAocSwgYW5zKSA9PiB7CiAgICAgICAgaWYgKGFucy5hbnN3ZXIgPT09IG51bGwgfHwgYW5zLmFuc3dlciA9PT0gdW5kZWZpbmVkKSByZXR1cm4gJy0nOwogICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHF1aXpEYXRhLnF1aXpUeXBlOwogICAgICAgIHN3aXRjaCAocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEluZGV4ID0gcS5vcHRpb25zLmZpbmRJbmRleChvcHQgPT4gb3B0ID09PSBhbnMuYW5zd2VyVGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxJbmRleCAhPT0gLTEgPyB0b0NoYXIob3JpZ2luYWxJbmRleCkgOiAoYW5zLmFuc3dlclRleHQgfHwgJy0nKTsKICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICBpZiAoYW5zLmFuc3dlciA9PSAnMCcgfHwgYW5zLmFuc3dlciA9PT0gdHJ1ZSB8fCBhbnMuYW5zd2VyID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ+C5g+C4iuC5iCc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ+C5hOC4oeC5iOC5g+C4iuC5iCc7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gYW5zLmFuc3dlcjsKICAgICAgICB9CiAgICB9OwoKICAgIGxldCB0YWJsZUh0bWwgPSBgCiAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJnLXdoaXRlIHRleHQtc20gdGV4dC1jZW50ZXIiPgogICAgICAgICAgICA8dGhlYWQgY2xhc3M9ImJnLWdyYXktMTAwIj4KICAgICAgICAgICAgICAgIDx0cj4KICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMiBib3JkZXItYiBib3JkZXItciBmb250LXNlbWlib2xkIHRleHQtbGVmdCBzdGlja3kgbGVmdC0wIGJnLWdyYXktMTAwIHotMTAiPuC4iuC4t+C5iOC4rSAtIOC4quC4geC4uOC4pTwvdGg+CiAgICAgICAgICAgICAgICAgICAgJHtxdWVzdGlvbnMubWFwKChxLCBpKSA9PiBgPHRoIGNsYXNzPSJweS0yIHB4LTIgYm9yZGVyLWIiPiR7aSArIDF9PC90aD5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICA8dHIgY2xhc3M9ImJnLWdyYXktMjAwIj4KICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiBib3JkZXItciB0ZXh0LWxlZnQgc3RpY2t5IGxlZnQtMCBiZy1ncmF5LTIwMCB6LTEwIj7guYDguInguKXguKI8L3RoPgogICAgICAgICAgICAgICAgICAgICR7cXVlc3Rpb25zLm1hcChxID0+IGA8dGQgY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiBmb250LWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtnZXRDb3JyZWN0QW5zd2VyVGV4dChxKX08L3RkPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgPHRib2R5PgogICAgYDsKCiAgICBzdHVkZW50cy5mb3JFYWNoKG5hbWUgPT4gewogICAgICAgIHRhYmxlSHRtbCArPSAnPHRyPic7CiAgICAgICAgdGFibGVIdG1sICs9IGA8dGQgY2xhc3M9InB5LTIgcHgtMiBib3JkZXItYiBib3JkZXItciB0ZXh0LWxlZnQgc3RpY2t5IGxlZnQtMCBiZy13aGl0ZSB6LTEwIj4ke25hbWV9PC90ZD5gOwogICAgICAgIAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb24gPSBzdWJtaXNzaW9uc0J5U3R1ZGVudFtuYW1lXTsKICAgICAgICBpZiAoc3VibWlzc2lvbikgewogICAgICAgICAgICBjb25zdCBsYXRlc3RBdHRlbXB0ID0gc3VibWlzc2lvbi5hdHRlbXB0c1tzdWJtaXNzaW9uLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBxdWVzdGlvbnMuZm9yRWFjaCgocSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlciA9IGxhdGVzdEF0dGVtcHQuYW5zd2Vycy5maW5kKGFucyA9PiBhbnMucXVlc3Rpb25JZCA9PT0gcS5pZCk7CgogICAgICAgICAgICAgICAgaWYgKGFuc3dlcikgewogICAgICAgICAgICAgICAgICAgIGxldCBjZWxsQ2xhc3NlcyA9ICcnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IGFuc3dlci5pc0NvcnJlY3QgPT09IHRydWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDb25maWRlbnQgPSAoYW5zd2VyLndhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCBhbnN3ZXIud2FzQ29uZmlkZW50ID09PSAnY29uZmlkZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG93ZXJ1cFVzZWQgPSBhbnN3ZXIucG93ZXJ1cFVzZWQ7CgogICAgICAgICAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Liq4Li14Liq4Liz4Lir4Lij4Lix4Lia4LmC4Lir4Lih4LiU4LmA4LiU4Li04Lih4Lie4Lix4LiZICjguJvguKPguLHguJrguYHguIHguYk6IOC5gOC4reC4siBib3JkZXIg4Lit4Lit4LiBKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsQ2xhc3NlcyA9ICdiZy15ZWxsb3ctMzAwIHRleHQteWVsbG93LTkwMCBmb250LWJvbGQnOyAvLyDguYDguKvguKXguLfguK3guYHguITguYjguKrguLXguJ7guLfguYnguJnguKvguKXguLHguIfguYHguKXguLDguJXguLHguKfguK3guLHguIHguKnguKMKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxDbGFzc2VzID0gJ2JnLXJlZC03MDAgdGV4dC13aGl0ZSBmb250LWJvbGQnOyAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb25maWRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2VsbENsYXNzZXMgPSBpc0NvcnJlY3QgPyAnYmctZ3JlZW4tNDAwIHRleHQtd2hpdGUgZm9udC1ib2xkJyA6ICdiZy1yZWQtNTAwIHRleHQtd2hpdGUgZm9udC1ib2xkJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjZWxsQ2xhc3NlcyA9IGlzQ29ycmVjdCA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdGFibGVIdG1sICs9IGA8dGQgY2xhc3M9InB5LTIgcHgtMiBib3JkZXItYiAke2NlbGxDbGFzc2VzfSI+JHtnZXRVc2VyQW5zd2VyVGV4dChxLCBhbnN3ZXIpfTwvdGQ+YDsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRhYmxlSHRtbCArPSAnPHRkIGNsYXNzPSJweS0yIHB4LTIgYm9yZGVyLWIgYmctZ3JheS01MCI+LTwvdGQ+JzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFibGVIdG1sICs9IHF1ZXN0aW9ucy5tYXAoKCkgPT4gJzx0ZCBjbGFzcz0icHktMiBweC0yIGJvcmRlci1iIGJnLWdyYXktNTAgdGV4dC1ncmF5LTQwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Liq4LmI4LiHPC90ZD4nKS5qb2luKCcnKTsKICAgICAgICB9CiAgICAgICAgdGFibGVIdG1sICs9ICc8L3RyPic7CiAgICB9KTsKCiAgICB0YWJsZUh0bWwgKz0gJzwvdGJvZHk+PC90YWJsZT4nOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9IHRhYmxlSHRtbDsKfQoKZnVuY3Rpb24gcmVuZGVyUXVpelJlc3VsdHNUYWJsZShzdHVkZW50cywgc3VibWlzc2lvbnMsIHF1aXpEYXRhKSB7CiAgICBjb25zdCBzdWJtaXNzaW9uc0J5U3R1ZGVudCA9IHN1Ym1pc3Npb25zLnJlZHVjZSgoYWNjLCBzdWIpID0+IHsKICAgICAgICBhY2Nbc3ViLnN0dWRlbnROYW1lXSA9IHN1YjsKICAgICAgICByZXR1cm4gYWNjOwogICAgfSwge30pOwoKICAgIC8vIC0tLSBb4LmB4LiB4LmJ4LmE4LiCXSAxLiDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEgKFdlaWdodGVkIE1heCBTY29yZSkgLS0tCiAgICBsZXQgdG90YWxNYXhTY29yZSA9IDA7CiAgICBjb25zdCB0eXBlU2NvcmluZyA9IHF1aXpEYXRhLnNldHRpbmdzPy50eXBlU2NvcmluZyB8fCB7IG1jcTogMSwgc2E6IDEsIHRmOiAxIH07CiAgICBpZiAocXVpekRhdGEucXVlc3Rpb25zICYmIHF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHFUeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgcXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgICAgIGxldCB3ZWlnaHQgPSAxOwogICAgICAgICAgICBpZiAocVR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHFUeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy5zYSkgfHwgMTsKICAgICAgICAgICAgZWxzZSBpZiAocVR5cGUgPT09ICd0cnVlX2ZhbHNlJykgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy50ZikgfHwgMTsKICAgICAgICAgICAgZWxzZSB3ZWlnaHQgPSBwYXJzZUZsb2F0KHR5cGVTY29yaW5nLm1jcSkgfHwgMTsKICAgICAgICAgICAgdG90YWxNYXhTY29yZSArPSB3ZWlnaHQ7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgeyB0b3RhbE1heFNjb3JlID0gMTsgfQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIDEuIOC4m+C4uOC5iOC4oeC4peC4muC4q+C4oeC4ueC5iAogICAgY29uc3QgZXhwb3J0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Njb3Jlcy10YWItY29udGVudCAubWItNC5mbGV4Jyk7CiAgICBpZiAoZXhwb3J0Q29udGFpbmVyICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVsay1kZWxldGUtc3VibWlzc2lvbnMtYnRuJykpIHsKICAgICAgICBjb25zdCBidWxrRGVsZXRlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgYnVsa0RlbGV0ZUJ0bi5pZCA9ICdidWxrLWRlbGV0ZS1zdWJtaXNzaW9ucy1idG4nOwogICAgICAgIGJ1bGtEZWxldGVCdG4uY2xhc3NOYW1lID0gJ2hpZGRlbiBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIG1sLWF1dG8gdHJhbnNpdGlvbi1hbGwnOwogICAgICAgIGJ1bGtEZWxldGVCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+IOC4peC4muC4o+C4suC4ouC4geC4suC4o+C4l+C4teC5iOC5gOC4peC4t+C4reC4gSAoPHNwYW4gaWQ9InNlbGVjdGVkLWNvdW50Ij4wPC9zcGFuPiknOwogICAgICAgIGV4cG9ydENvbnRhaW5lci5hcHBlbmRDaGlsZChidWxrRGVsZXRlQnRuKTsKICAgICAgICBidWxrRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQnVsa0RlbGV0ZVN1Ym1pc3Npb25zKTsKICAgIH0KCiAgICAvLyAyLiDguKvguLHguKfguJXguLLguKPguLLguIcKICAgIGNvbnN0IHRhYmxlSGVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZXN1bHRzLXRhYmxlIHRoZWFkIHRyJyk7CiAgICBpZiAodGFibGVIZWFkKSB7CiAgICAgICAgdGFibGVIZWFkLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgdy0xMCI+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJzZWxlY3QtYWxsLXN1Ym1pc3Npb25zIiBjbGFzcz0iaC00IHctNCByb3VuZGVkIGJvcmRlci1ncmF5LTMwMCB0ZXh0LWluZGlnby02MDAgZm9jdXM6cmluZy1pbmRpZ28tNTAwIGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgICAgPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guIrguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJk8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC4hOC4sOC5geC4meC4meC4lOC4teC4l+C4teC5iOC4quC4uOC4lDwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4Lic4LilPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guJvguKPguLDguYDguKDguJc8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC4hOC4sOC5geC4meC4meC4hOC4o+C4seC5ieC4h+C5geC4o+C4gTwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4LiE4Liw4LmB4LiZ4LiZ4Lil4LmI4Liy4Liq4Li44LiUPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij5Qb2ludHM8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC4quC4luC4suC4meC4sDwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiH4Lil4LmI4Liy4Liq4Li44LiUPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guIjguLHguJTguIHguLLguKM8L3RoPgogICAgICAgIGA7CiAgICB9CgogICAgY29uc3QgdGFibGVCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotcmVzdWx0cy10YWJsZS1ib2R5Jyk7CiAgICBpZiAoIXN0dWRlbnRzIHx8IHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRhYmxlQm9keS5pbm5lckhUTUwgPSAnPHRyPjx0ZCBjb2xzcGFuPSIxMSIgY2xhc3M9InRleHQtY2VudGVyIHAtNCB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguKPguLLguKLguIrguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYk8L3RkPjwvdHI+JzsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIGNvbnN0IGlzUmVtZWRpYWxRdWl6ID0gcXVpekRhdGEuaXNSZW1lZGlhbCA9PT0gdHJ1ZTsKICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IHF1aXpEYXRhLnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gLTE7IAoKICAgIGxldCBodG1sID0gJyc7CiAgICBzdHVkZW50cy5mb3JFYWNoKHN0dWRlbnROYW1lID0+IHsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNCeVN0dWRlbnRbc3R1ZGVudE5hbWVdOwogICAgICAgIGxldCBxdWl6VHlwZUh0bWwgPSBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPjxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtbWVkaXVtIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsICR7aXNSZW1lZGlhbFF1aXogPyAnYmctYW1iZXItMTAwIHRleHQtYW1iZXItODAwJyA6ICdiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwJ30iPiR7aXNSZW1lZGlhbFF1aXogPyAn4Liq4Lit4Lia4LiL4LmI4Lit4LihJyA6ICfguKrguK3guJrguJvguIHguJXguLQnfTwvc3Bhbj48L3RkPmA7CiAgICAgICAgCiAgICAgICAgbGV0IGNoZWNrYm94SHRtbCA9ICcnOwogICAgICAgIGlmIChzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgIGNoZWNrYm94SHRtbCA9IGA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJzdWJtaXNzaW9uLWNoZWNrYm94IGgtNCB3LTQgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCBjdXJzb3ItcG9pbnRlciIgdmFsdWU9IiR7c3R1ZGVudE5hbWV9Ij5gOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBjaGVja2JveEh0bWwgPSBgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBkaXNhYmxlZCBjbGFzcz0iaC00IHctNCByb3VuZGVkIGJvcmRlci1ncmF5LTIwMCB0ZXh0LWdyYXktMzAwIGN1cnNvci1ub3QtYWxsb3dlZCI+YDsKICAgICAgICB9CgogICAgICAgIGlmIChzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgIGlmIChzdWJtaXNzaW9uLmF0dGVtcHRzICYmIHN1Ym1pc3Npb24uYXR0ZW1wdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgbGV0IGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHN1Ym1pc3Npb24uYmVzdFNjb3JlID09PSB0b3RhbE1heFNjb3JlKSA6IChwYXNzaW5nU2NvcmUgIT09IC0xICYmIHN1Ym1pc3Npb24uYmVzdFNjb3JlID49IHBhc3NpbmdTY29yZSk7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdFRleHQgPSBpc1Bhc3MgPyAn4Lic4LmI4Liy4LiZJyA6ICfguYTguKHguYjguJzguYjguLLguJknOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0SHRtbCA9IGA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+PHNwYW4gY2xhc3M9InRleHQteHMgZm9udC1tZWRpdW0gbXItMiBweC0yLjUgcHktMC41IHJvdW5kZWQtZnVsbCAke3Jlc3VsdENsYXNzfSI+JHtyZXN1bHRUZXh0fTwvc3Bhbj48L3RkPmA7CiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXNDZWxsID0gYDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj48c3BhbiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTgwMCB0ZXh0LXhzIGZvbnQtbWVkaXVtIG1yLTIgcHgtMi41IHB5LTAuNSByb3VuZGVkLWZ1bGwiPuC4quC5iOC4h+C5geC4peC5ieC4pyAoJHtzdWJtaXNzaW9uLmF0dGVtcHRzPy5sZW5ndGggfHwgMX0g4LiE4Lij4Lix4LmJ4LiHKTwvc3Bhbj48L3RkPmA7CgogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRzSHRtbCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtYmx1ZS02MDAiPiR7KHN1Ym1pc3Npb24ucG9pbnRzIHx8IDApLnRvTG9jYWxlU3RyaW5nKCl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJlZGl0LXBvaW50cy1idG4gdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LW9yYW5nZS01MDAgdHJhbnNpdGlvbi1jb2xvcnMiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtc3R1ZGVudC1uYW1lPSIke3N0dWRlbnROYW1lfSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1jdXJyZW50LXBvaW50cz0iJHtzdWJtaXNzaW9uLnBvaW50cyB8fCAwfSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIFBvaW50cyDguJTguYnguKfguKLguKHguLfguK0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wZW4gdGV4dC14cyI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CgogICAgICAgICAgICAgICAgLy8gLS0tIFvguYHguIHguYnguYTguIJdIOC5g+C4iuC5iSB0b3RhbE1heFNjb3JlIOC5geC4l+C4mSBzdWJtaXNzaW9uLnRvdGFsUXVlc3Rpb25zIC0tLQogICAgICAgICAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJob3ZlcjpiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7Y2hlY2tib3hIdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke3N0dWRlbnROYW1lfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCI+JHtzdWJtaXNzaW9uLmJlc3RTY29yZX0gLyAke3RvdGFsTWF4U2NvcmV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtyZXN1bHRIdG1sfQogICAgICAgICAgICAgICAgICAgICAgICAke3F1aXpUeXBlSHRtbH0KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgZm9udC1zZW1pYm9sZCI+JHtzdWJtaXNzaW9uLmZpcnN0U2NvcmV9IC8gJHt0b3RhbE1heFNjb3JlfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIGZvbnQtc2VtaWJvbGQiPiR7c3VibWlzc2lvbi5sYXRlc3RTY29yZX0gLyAke3RvdGFsTWF4U2NvcmV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPiR7cG9pbnRzSHRtbH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAke3N0YXR1c0NlbGx9CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtc20gdGV4dC1ncmF5LTYwMCI+JHtuZXcgRGF0ZShzdWJtaXNzaW9uLmxhdGVzdFN1Ym1pdHRlZEF0KS50b0xvY2FsZVN0cmluZygndGgtVEgnKX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtc3R1ZGVudC1uYW1lPSIke3N0dWRlbnROYW1lfSIgY2xhc3M9ImRlbGV0ZS1zdWJtaXNzaW9uLWJ0biB0ZXh0LXJlZC01MDAgaG92ZXI6dGV4dC1yZWQtNzAwIHRleHQtbGcgcC0xIiB0aXRsZT0i4Lil4Lia4Lic4Lil4Liq4Lit4Lia4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC5gOC4o+C4tOC5iOC4oeC4l+C4s+C5geC4leC5iOC5hOC4oeC5iOC5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzQ2VsbCA9IGA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+PHNwYW4gY2xhc3M9ImJnLW9yYW5nZS0xMDAgdGV4dC1vcmFuZ2UtODAwIHRleHQteHMgZm9udC1tZWRpdW0gbXItMiBweC0yLjUgcHktMC41IHJvdW5kZWQtZnVsbCI+4LmA4Lij4Li04LmI4Lih4LmB4Lil4LmJ4LinICjguKLguLHguIfguYTguKHguYjguKrguYjguIcpPC9zcGFuPjwvdGQ+YDsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iaG92ZXI6YmctZ3JheS01MCBiZy1vcmFuZ2UtNTAiPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtjaGVja2JveEh0bWx9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPiR7c3R1ZGVudE5hbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPiA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cXVpelR5cGVIdG1sfQogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+IDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4gPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAke3N0YXR1c0NlbGx9CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtc20gdGV4dC1ncmF5LTYwMCI+JHtuZXcgRGF0ZShzdWJtaXNzaW9uLnN0YXJ0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoJ3RoLVRIJyl9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1zdHVkZW50LW5hbWU9IiR7c3R1ZGVudE5hbWV9IiBjbGFzcz0iZGVsZXRlLXN1Ym1pc3Npb24tYnRuIHRleHQtcmVkLTUwMCBob3Zlcjp0ZXh0LXJlZC03MDAgdGV4dC1sZyBwLTEiIHRpdGxlPSLguKXguJrguJzguKXguKrguK3guJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguITguJnguJnguLXguYkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0IHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmI4Lii4Lix4LiH4LmE4Lih4LmI4LmA4Lij4Li04LmI4Lih4LiX4LizCiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0NlbGwgPSBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPjxzcGFuIGNsYXNzPSJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCB0ZXh0LXhzIGZvbnQtbWVkaXVtIG1yLTIgcHgtMi41IHB5LTAuNSByb3VuZGVkLWZ1bGwiPuC4ouC4seC4h+C5hOC4oeC5iOC4quC5iOC4hzwvc3Bhbj48L3RkPmA7CiAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJob3ZlcjpiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtjaGVja2JveEh0bWx9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+JHtzdHVkZW50TmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4gPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPgogICAgICAgICAgICAgICAgICAgICR7cXVpelR5cGVIdG1sfQogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4gPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPiA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNDZWxsfQogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+PC90ZD4KICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgIGA7CiAgICAgICAgfQogICAgfSk7CiAgICB0YWJsZUJvZHkuaW5uZXJIVE1MID0gaHRtbDsKCiAgICAvLyBDaGVja2JveCBMb2dpYwogICAgY29uc3Qgc2VsZWN0QWxsQ2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWFsbC1zdWJtaXNzaW9ucycpOwogICAgY29uc3Qgcm93Q2JzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN1Ym1pc3Npb24tY2hlY2tib3gnKTsKICAgIGNvbnN0IGJ1bGtCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVsay1kZWxldGUtc3VibWlzc2lvbnMtYnRuJyk7CiAgICBjb25zdCBjb3VudFNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtY291bnQnKTsKCiAgICBjb25zdCB1cGRhdGVCdWxrQnRuU3RhdGUgPSAoKSA9PiB7CiAgICAgICAgY29uc3QgY2hlY2tlZENvdW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN1Ym1pc3Npb24tY2hlY2tib3g6Y2hlY2tlZCcpLmxlbmd0aDsKICAgICAgICBpZiAoY291bnRTcGFuKSBjb3VudFNwYW4udGV4dENvbnRlbnQgPSBjaGVja2VkQ291bnQ7CiAgICAgICAgaWYgKGNoZWNrZWRDb3VudCA+IDApIHsKICAgICAgICAgICAgYnVsa0J0bi5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWxrQnRuLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIH0KICAgIH07CgogICAgaWYgKHNlbGVjdEFsbENiKSB7CiAgICAgICAgc2VsZWN0QWxsQ2IuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgICAgICAgICAgcm93Q2JzLmZvckVhY2goY2IgPT4gY2IuY2hlY2tlZCA9IGUudGFyZ2V0LmNoZWNrZWQpOwogICAgICAgICAgICB1cGRhdGVCdWxrQnRuU3RhdGUoKTsKICAgICAgICB9KTsKICAgIH0KCiAgICByb3dDYnMuZm9yRWFjaChjYiA9PiB7CiAgICAgICAgY2IuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgICAgICBpZiAoIWNiLmNoZWNrZWQgJiYgc2VsZWN0QWxsQ2IpIHNlbGVjdEFsbENiLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGNiLmNoZWNrZWQgJiYgc2VsZWN0QWxsQ2IpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFsbENoZWNrZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc3VibWlzc2lvbi1jaGVja2JveDpjaGVja2VkJykubGVuZ3RoID09PSByb3dDYnMubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKGFsbENoZWNrZWQpIHNlbGVjdEFsbENiLmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZUJ1bGtCdG5TdGF0ZSgpOwogICAgICAgIH0pOwogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUJ1bGtEZWxldGVTdWJtaXNzaW9ucygpIHsKICAgIGNvbnN0IHNlbGVjdGVkQ2hlY2tib3hlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJtaXNzaW9uLWNoZWNrYm94OmNoZWNrZWQnKTsKICAgIGNvbnN0IHNlbGVjdGVkTmFtZXMgPSBBcnJheS5mcm9tKHNlbGVjdGVkQ2hlY2tib3hlcykubWFwKGNiID0+IGNiLnZhbHVlKTsKCiAgICBpZiAoc2VsZWN0ZWROYW1lcy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSB8fCAhY3VycmVudFF1aXpEYXRhLmlkKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC5hOC4oeC5iOC4luC4ueC4geC4leC5ieC4reC4hyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgIGDguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguJzguKXguIHguLLguKPguKrguK3guJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJkgJHtzZWxlY3RlZE5hbWVzLmxlbmd0aH0g4LiE4LiZ4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBPyDguIHguLLguKPguIHguKPguLDguJfguLPguJnguLXguYnguYTguKHguYjguKrguLLguKHguLLguKPguJbguKLguYnguK3guJnguIHguKXguLHguJrguYTguJTguYlgLAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwogICAgICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwoKICAgICAgICAgICAgc2VsZWN0ZWROYW1lcy5mb3JFYWNoKHN0dWRlbnROYW1lID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICBiYXRjaC5kZWxldGUoc3VibWlzc2lvblJlZik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoYOC4peC4muC4nOC4peC4geC4suC4o+C4quC4reC4miAke3NlbGVjdGVkTmFtZXMubGVuZ3RofSDguKPguLLguKLguIHguLLguKPguYDguKPguLXguKLguJrguKPguYnguK3guKLguYHguKXguYnguKdgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4Lib4Li44LmI4Lih4Lir4Lil4Lix4LiH4LiI4Liy4LiB4Lil4Lia4LmA4Liq4Lij4LmH4LiICiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVsay1kZWxldGUtc3VibWlzc2lvbnMtYnRuJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAvLyDguYDguITguKXguLXguKLguKPguYwgQ2hlY2tib3gg4Lir4Lix4Lin4LiV4Liy4Lij4Liy4LiHCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RBbGxIZWFkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWFsbC1zdWJtaXNzaW9ucycpOwogICAgICAgICAgICAgICAgaWYoc2VsZWN0QWxsSGVhZGVyKSBzZWxlY3RBbGxIZWFkZXIuY2hlY2tlZCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIC8vIG9uU25hcHNob3Qg4LiI4Liw4LiX4Liz4LiH4Liy4LiZ4LmB4Lil4Liw4Lij4Li14LmA4Lif4Lij4LiK4LiV4Liy4Lij4Liy4LiH4LmD4Lir4LmJ4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBidWxrIGRlbGV0aW5nIHN1Ym1pc3Npb25zOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKXguJrguILguYnguK3guKHguLnguKUiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gY29uZmlybVJlbmFtZVF1aXooKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld05hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVuYW1lLXF1aXotaW5wdXQnKS52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGlmICghbmV3TmFtZSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5g+C4quC5iOC4iuC4t+C5iOC4reC5g+C4q+C4oeC5iCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghYWN0aW9uVGFyZ2V0SWQpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGFjdGlvblRhcmdldElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhxdWl6UmVmLCB7IHRvcGljOiBuZXdOYW1lIH0pOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4m+C4peC4teC5iOC4ouC4meC4iuC4t+C5iOC4reC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgICAgICAgICAgcmVuYW1lUXVpek1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgYWN0aW9uVGFyZ2V0SWQgPSBudWxsOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcmVuYW1pbmcgcXVpejoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiK4Li34LmI4LitIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlTW92ZVF1aXoocXVpeklkKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1Nb3ZlUXVpeigpIHsKICAgICAgICAgICAgY29uc3QgbmV3UHJvamVjdElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdmUtcXVpei1wcm9qZWN0LXNlbGVjdCcpLnZhbHVlOwogICAgICAgICAgICBpZiAoIW5ld1Byb2plY3RJZCkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4m+C4peC4suC4ouC4l+C4suC4hyIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghYWN0aW9uVGFyZ2V0SWQpIHJldHVybjsKCiAgICAgICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGFjdGlvblRhcmdldElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhxdWl6UmVmLCB7IHByb2plY3RJZDogbmV3UHJvamVjdElkIH0pOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4ouC5ieC4suC4ouC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgICAgICAgICAgbW92ZVF1aXpNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGFjdGlvblRhcmdldElkID0gbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIG1vdmluZyBxdWl6OiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVF1aXpTZXR0aW5ncyhxdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIHRvZ2dsZVRpbWVySW5wdXRJbk1vZGFsKCkgewogICAgY29uc3QgbW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1tb2RlLXNlbGVjdCcpLnZhbHVlOwogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXRpbWVyLWR1cmF0aW9uLWNvbnRhaW5lcicpOwogICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24tbGFiZWwnKTsKICAgIAogICAgaWYgKG1vZGUgPT09ICdub25lJykgewogICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0gZWxzZSB7CiAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIGlmIChtb2RlID09PSAnd2hvbGVfcXVpeicpIHsKICAgICAgICAgICAgbGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguJnguLLguJfguLUpOic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguKfguLTguJnguLLguJfguLUpOic7CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiB0b2dnbGVDb25maWRlbmNlT3B0aW9uc0luTW9kYWwoKSB7CiAgICBjb25zdCBpc0NoZWNrZWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtY29uZmlkZW5jZS1zY29yaW5nLWNoZWNrYm94JykuY2hlY2tlZDsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jb25maWRlbmNlLW1vZGUtY29udGFpbmVyJyk7CiAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgICAgaWYgKGlzQ2hlY2tlZCkgewogICAgICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIH0KICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gY29uZmlybVF1aXpTZXR0aW5ncygpIHsKICAgIGlmICghYWN0aW9uVGFyZ2V0SWQpIHJldHVybjsKICAgIAogICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgYWN0aW9uVGFyZ2V0SWQpOwogICAgCiAgICBjb25zdCBuZXdTZXR0aW5ncyA9IHsKICAgICAgICBzaHVmZmxlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtc2h1ZmZsZS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICByZXN1bHRzRGlzcGxheTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXJlc3VsdHMtZGlzcGxheS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICB0aW1lck1vZGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1tb2RlLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIHRpbWVyRHVyYXRpb246IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1kdXJhdGlvbi1pbnB1dCcpLnZhbHVlKSB8fCAxMCwKICAgICAgICBwYXNzaW5nU2NvcmU6IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1wYXNzaW5nLXNjb3JlLWlucHV0JykudmFsdWUpIHx8IDAsCiAgICAgICAgaXNBZGFwdGl2ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWFkYXB0aXZlLXF1aXotY2hlY2tib3gnKS5jaGVja2VkLAogICAgICAgIGxvb3BVbnRpbFBhc3M6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1sb29wLXVudGlsLXBhc3MtY2hlY2tib3gnKS5jaGVja2VkLAogICAgICAgIGlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtY29uZmlkZW5jZS1zY29yaW5nLWNoZWNrYm94JykuY2hlY2tlZCwKICAgICAgICBjb25maWRlbmNlTW9kZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWNvbmZpZGVuY2UtbW9kZS1zZWxlY3QnKS52YWx1ZSwKCiAgICAgICAgLy8g4pa84pa84pa8IFvguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguKHguYg6IOC4muC4seC4meC4l+C4tuC4geC4hOC4sOC5geC4meC4meC4o+C4suC4ouC4m+C4o+C4sOC5gOC4oOC4l10g4pa84pa84pa8CiAgICAgICAgdHlwZVNjb3Jpbmc6IHsKICAgICAgICAgICAgbWNxOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS1tY3EnKS52YWx1ZSkgfHwgMSwgLy8g4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBCiAgICAgICAgICAgIHNhOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS1zYScpLnZhbHVlKSB8fCAxLCAgLy8g4LmA4LiV4Li04Lih4LiE4LizCiAgICAgICAgICAgIHRmOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS10ZicpLnZhbHVlKSB8fCAxICAgLy8g4LiW4Li54LiB4Lic4Li04LiUCiAgICAgICAgfQogICAgICAgIC8vIOKWsuKWsuKWsgogICAgfTsKCiAgICB0cnkgewogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhxdWl6UmVmLCB7IHNldHRpbmdzOiBuZXdTZXR0aW5ncyB9KTsKICAgICAgICBzaG93TWVzc2FnZSgi4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgcXVpelNldHRpbmdzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgYWN0aW9uVGFyZ2V0SWQgPSBudWxsOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBxdWl6IHNldHRpbmdzOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBIik7CiAgICB9Cn0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gY29uZmlybVF1aXpTdGF0dXMoKSB7CiAgICAgICAgICAgIGlmICghYWN0aW9uVGFyZ2V0SWQpIHJldHVybjsKICAgICAgICAgICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgYWN0aW9uVGFyZ2V0SWQpOwogICAgICAgICAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InN0YXR1cy1vcHRpb24iXTpjaGVja2VkJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXNlbGVjdGVkT3B0aW9uKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4Liq4LiW4Liy4LiZ4LiwIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0Nob2ljZSA9IHNlbGVjdGVkT3B0aW9uLnZhbHVlOwogICAgICAgICAgICBsZXQgZGF0YVRvVXBkYXRlID0ge307CgogICAgICAgICAgICBpZiAoc3RhdHVzQ2hvaWNlID09PSAnYWN0aXZlJyB8fCBzdGF0dXNDaG9pY2UgPT09ICdpbmFjdGl2ZScpIHsKICAgICAgICAgICAgICAgIGRhdGFUb1VwZGF0ZSA9IHsgc3RhdHVzOiBzdGF0dXNDaG9pY2UsIHN0YXJ0VGltZTogbnVsbCwgZW5kVGltZTogbnVsbCB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1c0Nob2ljZSA9PT0gJ3NjaGVkdWxlJykgewogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotc3RhcnQtdGltZScpLnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWVuZC10aW1lJykudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXJ0VGltZSAmJiAhZW5kVGltZSkgewogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguYDguKfguKXguLLguYDguJvguLTguJQg4Lir4Lij4Li34LitIOC5gOC4p+C4peC4suC4m+C4tOC4lCDguK3guKLguYjguLLguIfguJnguYnguK3guKLguKvguJnguLbguYjguIfguK3guKLguYjguLLguIciKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBkYXRhVG9VcGRhdGUgPSB7IAogICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3NjaGVkdWxlZCcsIAogICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogc3RhcnRUaW1lID8gbmV3IERhdGUoc3RhcnRUaW1lKS50b0lTT1N0cmluZygpIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBlbmRUaW1lOiBlbmRUaW1lID8gbmV3IERhdGUoZW5kVGltZSkudG9JU09TdHJpbmcoKSA6IG51bGwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocXVpelJlZiwgZGF0YVRvVXBkYXRlKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguK3guLHguJvguYDguJTguJXguKrguJbguLLguJnguLDguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIHF1aXpTdGF0dXNNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGFjdGlvblRhcmdldElkID0gbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBxdWl6IHN0YXR1czoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4reC4seC4m+C5gOC4lOC4leC4quC4luC4suC4meC4sCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gTGVhZGVyYm9hcmQgLS0tCiAgICAgICAgZnVuY3Rpb24gbGlzdGVuRm9yU3R1ZGVudFByb2ZpbGVzKHByb2plY3RJZCkgewogICAgICAgICAgICBjb25zdCBwcm9maWxlc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHMvJHtwcm9qZWN0SWR9L3N0dWRlbnRQcm9maWxlc2ApOwogICAgICAgICAgICB1bnN1YnNjcmliZVN0dWRlbnRQcm9maWxlc0xpc3RlbmVyID0gb25TbmFwc2hvdChwcm9maWxlc1JlZiwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9maWxlcyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuZGF0YSgpKTsKICAgICAgICAgICAgICAgIHJlbmRlckxlYWRlcmJvYXJkKHByb2ZpbGVzLCAnbGVhZGVyYm9hcmQtdGFibGUtYm9keScpOwogICAgICAgICAgICB9LCAoZXJyb3IpID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxpc3RlbmluZyBmb3Igc3R1ZGVudCBwcm9maWxlczoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmQtdGFibGUtYm9keScpLmlubmVySFRNTCA9ICc8dHI+PHRkIGNvbHNwYW49IjQiIGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTQgdGV4dC1yZWQtNTAwIj7guYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguILguYnguK3guKHguLnguKXguJzguLnguYnguJnguLM8L3RkPjwvdHI+JzsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJMZWFkZXJib2FyZChwcm9maWxlcywgdGFibGVCb2R5SWQpIHsKICAgICAgICAgICAgY29uc3QgdGFibGVCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVCb2R5SWQpOwogICAgICAgICAgICBpZiAoIXByb2ZpbGVzIHx8IHByb2ZpbGVzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGFibGVCb2R5LmlubmVySFRNTCA9ICc8dHI+PHRkIGNvbHNwYW49IjQiIGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTQgdGV4dC1ncmF5LTUwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liw4LmB4LiZ4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiV4Liy4Lij4Liy4LiH4Lic4Li54LmJ4LiZ4LizPC90ZD48L3RyPic7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLSBBZHZhbmNlZCBSYW5raW5nIC0tLQogICAgICAgICAgICBwcm9maWxlcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICAvLyAxLiBQcmltYXJ5OiBUb3RhbCBQb2ludHMKICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50c0RpZmYgPSAoYi50b3RhbFBvaW50cyB8fCAwKSAtIChhLnRvdGFsUG9pbnRzIHx8IDApOwogICAgICAgICAgICAgICAgaWYgKHBvaW50c0RpZmYgIT09IDApIHJldHVybiBwb2ludHNEaWZmOwoKICAgICAgICAgICAgICAgIC8vIDIuIFNlY29uZGFyeTogTnVtYmVyIG9mIFNwZWNpYWxpc3QgKPCfkanigI3wn5qAKSBiYWRnZXMKICAgICAgICAgICAgICAgIGNvbnN0IHNwZWNpYWxpc3REaWZmID0gKGIuYmFkZ2VzQ291bnQ/LnNwZWNpYWxpc3QgfHwgMCkgLSAoYS5iYWRnZXNDb3VudD8uc3BlY2lhbGlzdCB8fCAwKTsKICAgICAgICAgICAgICAgIGlmIChzcGVjaWFsaXN0RGlmZiAhPT0gMCkgcmV0dXJuIHNwZWNpYWxpc3REaWZmOwoKICAgICAgICAgICAgICAgIC8vIDMuIFRlcnRpYXJ5OiBOdW1iZXIgb2YgRmlyc3QgVHJ5IEFjZSAo8J+agCkgYmFkZ2VzCiAgICAgICAgICAgICAgICBjb25zdCBmaXJzdFRyeUFjZURpZmYgPSAoYi5iYWRnZXNDb3VudD8uZmlyc3RfdHJ5X2FjZSB8fCAwKSAtIChhLmJhZGdlc0NvdW50Py5maXJzdF90cnlfYWNlIHx8IDApOwogICAgICAgICAgICAgICAgaWYgKGZpcnN0VHJ5QWNlRGlmZiAhPT0gMCkgcmV0dXJuIGZpcnN0VHJ5QWNlRGlmZjsKCiAgICAgICAgICAgICAgICAvLyA0LiBRdWF0ZXJuYXJ5OiBOdW1iZXIgb2YgUGVyZmVjdCBTY29yZSAo8J+RkSkgYmFkZ2VzCiAgICAgICAgICAgICAgICBjb25zdCBwZXJmZWN0U2NvcmVEaWZmID0gKGIuYmFkZ2VzQ291bnQ/LnBlcmZlY3Rfc2NvcmUgfHwgMCkgLSAoYS5iYWRnZXNDb3VudD8ucGVyZmVjdF9zY29yZSB8fCAwKTsKICAgICAgICAgICAgICAgIGlmIChwZXJmZWN0U2NvcmVEaWZmICE9PSAwKSByZXR1cm4gcGVyZmVjdFNjb3JlRGlmZjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gNS4gUXVpbmFyeTogTnVtYmVyIG9mIFF1aWNrIFRoaW5rZXIgKOKaoe+4jykgYmFkZ2VzCiAgICAgICAgICAgICAgICBjb25zdCBxdWlja1RoaW5rZXJEaWZmID0gKGIuYmFkZ2VzQ291bnQ/LnF1aWNrX3RoaW5rZXIgfHwgMCkgLSAoYS5iYWRnZXNDb3VudD8ucXVpY2tfdGhpbmtlciB8fCAwKTsKICAgICAgICAgICAgICAgIGlmIChxdWlja1RoaW5rZXJEaWZmICE9PSAwKSByZXR1cm4gcXVpY2tUaGlua2VyRGlmZjsKCiAgICAgICAgICAgICAgICAvLyA2LiBGaW5hbDogQWxwaGFiZXRpY2FsIGJ5IG5hbWUKICAgICAgICAgICAgICAgIHJldHVybiBhLnN0dWRlbnROYW1lLmxvY2FsZUNvbXBhcmUoYi5zdHVkZW50TmFtZSwgJ3RoJyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbGV0IGh0bWwgPSAnJzsKICAgICAgICAgICAgcHJvZmlsZXMuZm9yRWFjaCgocHJvZmlsZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJhbmsgPSBpbmRleCArIDE7CiAgICAgICAgICAgICAgICBjb25zdCBiYWRnZXNDb3VudCA9IHByb2ZpbGUuYmFkZ2VzQ291bnQgfHwge307CgogICAgICAgICAgICAgICAgbGV0IGJhZGdlc0hUTUwgPSAnJzsKICAgICAgICAgICAgICAgIGNvbnN0IGJhZGdlT3JkZXIgPSBbJ3NwZWNpYWxpc3QnLCAncGVyZmVjdF9zY29yZScsICdmaXJzdF90cnlfYWNlJywgJ3F1aWNrX3RoaW5rZXInXTsKCiAgICAgICAgICAgICAgICBiYWRnZU9yZGVyLmZvckVhY2goYmFkZ2VJZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJhZGdlc0NvdW50W2JhZGdlSWRdID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYWRnZUluZm8gPSBPYmplY3QudmFsdWVzKEJBREdFUykuZmluZChiID0+IGIuaWQgPT09IGJhZGdlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFkZ2VJbmZvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFkZ2VJZCA9PT0gJ3NwZWNpYWxpc3QnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm9yIHNwZWNpYWxpc3QsIGp1c3Qgc2hvdyB0aGUgaWNvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhZGdlc0hUTUwgKz0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iaW5saW5lLWZsZXggaXRlbXMtY2VudGVyIG14LTEiIHRpdGxlPSIke2JhZGdlSW5mby5uYW1lfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzICR7YmFkZ2VJbmZvLmljb259IHRleHQtbGciPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBvdGhlcnMsIHNob3cgaWNvbiBhbmQgY291bnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWRnZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImlubGluZS1mbGV4IGl0ZW1zLWNlbnRlciBteC0xIiB0aXRsZT0iJHtiYWRnZUluZm8ubmFtZX0gKCR7YmFkZ2VzQ291bnRbYmFkZ2VJZF19IOC4hOC4o+C4seC5ieC4hykiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyAke2JhZGdlSW5mby5pY29ufSB0ZXh0LWxnIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibWwtMSB0ZXh0LXNtIGZvbnQtc2VtaWJvbGQiPiR7YmFkZ2VzQ291bnRbYmFkZ2VJZF19PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iaG92ZXI6YmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIGZvbnQtYm9sZCI+JHtyYW5rfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke3Byb2ZpbGUuc3R1ZGVudE5hbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCB0ZXh0LWluZGlnby02MDAiPiR7KHByb2ZpbGUudG90YWxQb2ludHMgfHwgMCkudG9Mb2NhbGVTdHJpbmcoKX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+JHtiYWRnZXNIVE1MIHx8ICctJ308L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGFibGVCb2R5LmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgfQoJCQoJCS8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQoKLyoqCiAqIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4reC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC4p+C4meC4peC4ueC4m+C5gOC4oeC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4meC4quC4reC4muC5hOC4oeC5iOC4nOC5iOC4suC4mSAo4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4Lit4Lix4Lib4LmA4LiU4LiV4Lil4LmI4Liy4Liq4Li44LiUKQogKiBAcGFyYW0ge251bWJlcn0gc2NvcmUg4LiE4Liw4LmB4LiZ4LiZ4LiX4Li14LmI4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Liz4LmE4LiU4LmJCiAqIEBwYXJhbSB7bnVtYmVyfSB0b3RhbFF1ZXN0aW9ucyDguIjguLPguJnguKfguJnguILguYnguK3guJfguLHguYnguIfguKvguKHguJQKICogQHBhcmFtIHtzdHJpbmd9IGRpc3BsYXlTZXR0aW5nIOC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4geC4suC4o+C5geC4quC4lOC4h+C4nOC4pQogKi8KZnVuY3Rpb24gZGlzcGxheUxvb3BTY3JlZW4oc2NvcmUsIHRvdGFsUXVlc3Rpb25zLCBkaXNwbGF5U2V0dGluZykgewogICAgbGV0IHNjb3JlSHRtbCA9ICcnOwogICAgaWYgKGRpc3BsYXlTZXR0aW5nICE9PSAnc2hvd19wYXNzX2ZhaWxfb25seScpIHsKICAgICAgICBzY29yZUh0bWwgPSBgPHAgY2xhc3M9InRleHQtZ3JheS03MDAgbXQtMiI+4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiE4Li44LiT4LiE4Li34LitIDxzdHJvbmcgY2xhc3M9InRleHQteGwiPiR7c2NvcmV9IC8gJHt0b3RhbFF1ZXN0aW9uc308L3N0cm9uZz48L3A+YDsKICAgIH0KCiAgICBjb25zdCBodG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy1yZWQtMTAwIHJvdW5kZWQtbGcgZmFkZS1pbiI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcmVkby1hbHQgdGV4dC01eGwgdGV4dC1yZWQtNTAwIG1iLTQgYW5pbWF0ZS1zcGluIFthbmltYXRpb24tZHVyYXRpb246MnNdIj48L2k+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtcmVkLTgwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lic4LmI4Liy4LiZ4LmA4LiB4LiT4LiR4LmM4LiZ4LiwITwvaDM+CiAgICAgICAgICAgICR7c2NvcmVIdG1sfQogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTYwMCI+4Liq4Li54LmJ4LmGIOC4peC4reC4h+C5g+C4q+C4oeC5iOC4reC4teC4geC4hOC4o+C4seC5ieC4h+C5gOC4nuC4t+C5iOC4reC4l+C4muC4l+C4p+C4meC4hOC4p+C4suC4oeC5gOC4guC5ieC4suC5g+C4iOC4meC4sDwvcD4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0icmV0YWtlLXF1aXotbG9vcC1idG4iIGNsYXNzPSJtdC02IGJnLXJlZC02MDAgdGV4dC13aGl0ZSBweS0zIHB4LTYgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLXJlZC03MDAgdHJhbnNpdGlvbi10cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1Ij4KICAgICAgICAgICAgICAgIOC4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC4reC4teC4geC4hOC4o+C4seC5ieC4hwogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSBodG1sOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBzdHVkZW50UXVpekFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldGFrZS1xdWl6LWxvb3AtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gLS0tIFsg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiUIDEg4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4Lih4Liy4LiE4Lij4Lix4LiaIF0gLS0tCiAgICAgICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4quC4seC5iOC4h+C4i+C5iOC4reC4meC4q+C4meC5ieC4suC4iOC4rSAi4Lii4Lix4LiH4LmE4Lih4LmI4Lic4LmI4Liy4LiZ4LmA4LiB4LiT4LiR4LmMIiDguIHguYjguK3guJkKICAgICAgICAKICAgICAgICBxdWl6U3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgICBkaXNwbGF5UXVpekZvclN0dWRlbnQoY3VycmVudFF1aXpEYXRhKTsKICAgIH0pOwp9CgogICAgICAgIC8vIE5FVzogUmVuZGVyIFF1aXotc3BlY2lmaWMgTGVhZGVyYm9hcmQKICAgICAgICAvLyAtLS0g4LiZ4Liz4LmC4LiE4LmJ4LiU4LiZ4Li14LmJ4LmE4Lib4Lin4Liy4LiH4LmB4LiX4LiZ4LiX4Li14LmI4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclF1aXpMZWFkZXJib2FyZCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCmZ1bmN0aW9uIHJlbmRlclF1aXpMZWFkZXJib2FyZChzdWJtaXNzaW9ucywgcXVpekRhdGEsIHRhYmxlQm9keUlkKSB7CiAgICBjb25zdCB0YWJsZUJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJsZUJvZHlJZCk7CiAgICBjb25zdCBpc1N0dWRlbnRWaWV3ID0gdGFibGVCb2R5SWQgPT09ICdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtdGFibGUtYm9keSc7CiAgICAKICAgIC8vIC0tLSBb4LmB4LiB4LmJ4LmE4LiCXSAxLiDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEgKFdlaWdodGVkIE1heCBTY29yZSkgLS0tCiAgICBsZXQgdG90YWxNYXhTY29yZSA9IDA7CiAgICBjb25zdCB0eXBlU2NvcmluZyA9IHF1aXpEYXRhLnNldHRpbmdzPy50eXBlU2NvcmluZyB8fCB7IG1jcTogMSwgc2E6IDEsIHRmOiAxIH07CiAgICAKICAgIGlmIChxdWl6RGF0YS5xdWVzdGlvbnMgJiYgcXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICBxdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaChxID0+IHsKICAgICAgICAgICAgY29uc3QgcVR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgbGV0IHdlaWdodCA9IDE7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAocVR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHFUeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgICAgICAgICAgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy5zYSkgfHwgMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChxVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgICAgICB3ZWlnaHQgPSBwYXJzZUZsb2F0KHR5cGVTY29yaW5nLnRmKSB8fCAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gbXVsdGlwbGVfY2hvaWNlLCBtYXRjaGluZywgZXRjLgogICAgICAgICAgICAgICAgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy5tY3EpIHx8IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWxNYXhTY29yZSArPSB3ZWlnaHQ7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIHRvdGFsTWF4U2NvcmUgPSAxOyAvLyDguIHguLHguJnguKvguLLguKPguJTguYnguKfguKIgMCDguIHguKPguJPguLXguYTguKHguYjguKHguLXguILguYnguK3guKrguK3guJoKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAtLS0g4Liq4LmI4Lin4LiZ4Lir4Lix4Lin4LiV4Liy4Lij4Liy4LiH4LiX4Li14LmI4LiX4Liz4LmD4Lir4LmJ4LiE4Lil4Li04LiB4LmE4LiU4LmJIC0tLQogICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YWJsZUJvZHlJZCkuY2xvc2VzdCgndGFibGUnKTsKICAgIGlmICh0YWJsZSAmJiAhaXNTdHVkZW50VmlldykgewogICAgICAgIGNvbnN0IHRoZWFkID0gdGFibGUucXVlcnlTZWxlY3RvcigndGhlYWQnKTsKICAgICAgICB0aGVhZC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDx0ciBjbGFzcz0iYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgdy0xNiI+4Lit4Lix4LiZ4LiU4Lix4LiaPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCBzb3J0YWJsZS1oZWFkZXIiIGRhdGEtc29ydD0ic3R1ZGVudE5hbWUiIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij7guIrguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJk8L3RoPgogICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgc29ydGFibGUtaGVhZGVyIiBkYXRhLXNvcnQ9ImJlc3RTY29yZSIgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjsiPuC4hOC4sOC5geC4meC4meC4lOC4teC4l+C4teC5iOC4quC4uOC4lDwvdGg+CiAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciI+4Lic4LilPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIHNvcnRhYmxlLWhlYWRlciIgZGF0YS1zb3J0PSJwb2ludHMiIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij5Qb2ludHMgKOC4hOC4o+C4seC5ieC4h+C4peC5iOC4suC4quC4uOC4lCk8L3RoPgogICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgc29ydGFibGUtaGVhZGVyIiBkYXRhLXNvcnQ9ImF0dGVtcHRzIiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4LiX4LizPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCBzb3J0YWJsZS1oZWFkZXIiIGRhdGEtc29ydD0ibGF0ZXN0U3VibWl0dGVkQXQiIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij7guYDguKfguKXguLLguJfguLXguYjguKrguYjguIfguKXguYjguLLguKrguLjguJQ8L3RoPgogICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guJvguYnguLLguKLguKPguLLguIfguKfguLHguKU8L3RoPgogICAgICAgICAgICA8L3RyPgogICAgICAgIGA7CiAgICB9CgogICAgaWYgKCFzdWJtaXNzaW9ucyB8fCBzdWJtaXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICB0YWJsZUJvZHkuaW5uZXJIVE1MID0gYDx0cj48dGQgY29sc3Bhbj0iJHtpc1N0dWRlbnRWaWV3ID8gNiA6IDh9IiBjbGFzcz0idGV4dC1jZW50ZXIgcC00IHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4meC4seC4geC5gOC4o+C4teC4ouC4meC4quC5iOC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5iTwvdGQ+PC90cj5gOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAtLS0g4Liq4LmI4Lin4LiZIExvZ2ljIOC4geC4suC4o+C4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C4guC5ieC4reC4oeC4ueC4pSAtLS0KICAgIGNvbnN0IHN1Ym1pc3Npb25zQ29weSA9IFsuLi5zdWJtaXNzaW9uc107IAogICAgc3VibWlzc2lvbnNDb3B5LnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBsZXQgdmFsQSwgdmFsQjsKICAgICAgICBzd2l0Y2ggKHF1aXpMZWFkZXJib2FyZFNvcnRCeSkgewogICAgICAgICAgICBjYXNlICdzdHVkZW50TmFtZSc6CiAgICAgICAgICAgICAgICB2YWxBID0gYS5zdHVkZW50TmFtZSB8fCAnJzsKICAgICAgICAgICAgICAgIHZhbEIgPSBiLnN0dWRlbnROYW1lIHx8ICcnOwogICAgICAgICAgICAgICAgcmV0dXJuIHF1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9PT0gJ2FzYycgPyB2YWxBLmxvY2FsZUNvbXBhcmUodmFsQiwgJ3RoJykgOiB2YWxCLmxvY2FsZUNvbXBhcmUodmFsQSwgJ3RoJyk7CiAgICAgICAgICAgIGNhc2UgJ3BvaW50cyc6CiAgICAgICAgICAgICAgICB2YWxBID0gYS5wb2ludHMgfHwgMDsKICAgICAgICAgICAgICAgIHZhbEIgPSBiLnBvaW50cyB8fCAwOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2F0dGVtcHRzJzoKICAgICAgICAgICAgICAgIHZhbEEgPSBhLmF0dGVtcHRzPy5sZW5ndGggfHwgMTsKICAgICAgICAgICAgICAgIHZhbEIgPSBiLmF0dGVtcHRzPy5sZW5ndGggfHwgMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdsYXRlc3RTdWJtaXR0ZWRBdCc6CiAgICAgICAgICAgICAgICB2YWxBID0gbmV3IERhdGUoYS5sYXRlc3RTdWJtaXR0ZWRBdCk7CiAgICAgICAgICAgICAgICB2YWxCID0gbmV3IERhdGUoYi5sYXRlc3RTdWJtaXR0ZWRBdCk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnYmVzdFNjb3JlJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHZhbEEgPSBhLmJlc3RTY29yZTsKICAgICAgICAgICAgICAgIHZhbEIgPSBiLmJlc3RTY29yZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodmFsQSA8IHZhbEIpIHJldHVybiBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gLTEgOiAxOwogICAgICAgIGlmICh2YWxBID4gdmFsQikgcmV0dXJuIHF1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9PT0gJ2FzYycgPyAxIDogLTE7CiAgICAgICAgcmV0dXJuIDA7IAogICAgfSk7CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4geC4suC4o+C4quC4o+C5ieC4suC4h+C4leC4suC4o+C4suC4hyAtLS0KICAgIGNvbnN0IGlzUmVtZWRpYWxRdWl6ID0gcXVpekRhdGEuaXNSZW1lZGlhbCA9PT0gdHJ1ZTsKICAgIC8vIOC4m+C4o+C4seC4muC5gOC4geC4k+C4keC5jOC4nOC5iOC4suC4meC5g+C4q+C5ieC5gOC4l+C4teC4ouC4muC4geC4seC4muC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC4o+C4p+C4oSAo4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LiV4Liy4Lii4LiV4Lix4Lin4LmE4Lin4LmJKQogICAgY29uc3QgcGFzc2luZ1Njb3JlID0gcXVpekRhdGEuc2V0dGluZ3M/LnBhc3NpbmdTY29yZSA/PyAodG90YWxNYXhTY29yZSAvIDIpOwoKICAgIGxldCBodG1sID0gJyc7CiAgICBzdWJtaXNzaW9uc0NvcHkuZm9yRWFjaCgoc3ViLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IHJhbmsgPSBpbmRleCArIDE7CiAgICAgICAgbGV0IHJlc3VsdEh0bWwgPSAnPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPi08L3RkPic7CiAgICAgICAgCiAgICAgICAgLy8g4LmA4LiK4LmH4LiE4Lic4LilIOC4nOC5iOC4suC4mS/guYTguKHguYjguJzguYjguLLguJkKICAgICAgICBpZiAoaXNSZW1lZGlhbFF1aXogfHwgcGFzc2luZ1Njb3JlICE9PSAtMSkgewogICAgICAgICAgICBsZXQgaXNQYXNzID0gaXNSZW1lZGlhbFF1aXogPyAoc3ViLmJlc3RTY29yZSA9PT0gdG90YWxNYXhTY29yZSkgOiAoc3ViLmJlc3RTY29yZSA+PSBwYXNzaW5nU2NvcmUpOwogICAgICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICAgICAgY29uc3QgcmVzdWx0VGV4dCA9IGlzUGFzcyA/ICfguJzguYjguLLguJknIDogJ+C5hOC4oeC5iOC4nOC5iOC4suC4mSc7CiAgICAgICAgICAgIHJlc3VsdEh0bWwgPSBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPjxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtbWVkaXVtIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsICR7cmVzdWx0Q2xhc3N9Ij4ke3Jlc3VsdFRleHR9PC9zcGFuPjwvdGQ+YDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgbGF0ZXN0QXR0ZW1wdCA9IHN1Yi5hdHRlbXB0c1tzdWIuYXR0ZW1wdHMubGVuZ3RoIC0gMV07CiAgICAgICAgY29uc3QgYmFkZ2VzSFRNTCA9IChsYXRlc3RBdHRlbXB0LmJhZGdlcyB8fCBbXSkKICAgICAgICAgICAgLm1hcChiYWRnZUlkID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhZGdlSW5mbyA9IE9iamVjdC52YWx1ZXMoQkFER0VTKS5maW5kKGIgPT4gYi5pZCA9PT0gYmFkZ2VJZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYmFkZ2VJbmZvID8gYDxzcGFuIHRpdGxlPSIke2JhZGdlSW5mby5uYW1lfSI+PGkgY2xhc3M9ImZhcyAke2JhZGdlSW5mby5pY29ufSBteC0xIHRleHQtbGciPjwvaT48L3NwYW4+YCA6ICcnOwogICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICAgICAgCiAgICAgICAgLy8gLS0tIFvguYHguIHguYnguYTguIJdIOC5g+C4iuC5iSB0b3RhbE1heFNjb3JlIOC5geC4l+C4mSB0b3RhbFF1ZXN0aW9ucyDguJfguLXguYjguYDguJvguYfguJnguIjguLPguJnguKfguJnguILguYnguK0gLS0tCiAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgIDx0ciBjbGFzcz0iaG92ZXI6YmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciBmb250LWJvbGQiPiR7cmFua308L3RkPgogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPiR7c3ViLnN0dWRlbnROYW1lfTwvdGQ+CiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciBmb250LWJvbGQgdGV4dC1ncmVlbi02MDAiPiR7c3ViLmJlc3RTY29yZX0gLyAke3RvdGFsTWF4U2NvcmV9PC90ZD4KICAgICAgICAgICAgICAgICR7cmVzdWx0SHRtbH0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTYwMCI+JHsoc3ViLnBvaW50cyB8fCAwKS50b0xvY2FsZVN0cmluZygpfTwvdGQ+CiAgICAgICAgICAgICAgICAke2lzU3R1ZGVudFZpZXcgPyAiIiA6IGA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtzdWIuYXR0ZW1wdHM/Lmxlbmd0aCB8fCAxfTwvdGQ+YH0KICAgICAgICAgICAgICAgICR7aXNTdHVkZW50VmlldyA/ICIiIDogYDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtc20gdGV4dC1ncmF5LTYwMCI+JHtuZXcgRGF0ZShzdWIubGF0ZXN0U3VibWl0dGVkQXQpLnRvTG9jYWxlU3RyaW5nKCd0aC1USCcpfTwvdGQ+YH0KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke2JhZGdlc0hUTUwgfHwgJy0nfTwvdGQ+CiAgICAgICAgICAgIDwvdHI+CiAgICAgICAgYDsKICAgIH0pOwogICAgdGFibGVCb2R5LmlubmVySFRNTCA9IGh0bWw7CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC5geC4quC4lOC4h+C4quC4seC4jeC4peC4seC4geC4qeC4k+C5jCDilrIg4pa8IC0tLQogICAgaWYgKHRhYmxlICYmICFpc1N0dWRlbnRWaWV3KSB7CiAgICAgICAgdGFibGUucXVlcnlTZWxlY3RvckFsbCgndGhlYWQgLnNvcnRhYmxlLWhlYWRlcicpLmZvckVhY2godGggPT4gewogICAgICAgICAgICBjb25zdCBpbmRpY2F0b3IgPSB0aC5xdWVyeVNlbGVjdG9yKCcuc29ydC1pbmRpY2F0b3InKTsKICAgICAgICAgICAgaWYgKGluZGljYXRvcikgaW5kaWNhdG9yLnJlbW92ZSgpOyAKICAgICAgICAgICAgaWYgKHRoLmRhdGFzZXQuc29ydCA9PT0gcXVpekxlYWRlcmJvYXJkU29ydEJ5KSB7CiAgICAgICAgICAgICAgICB0aC5pbm5lckhUTUwgKz0gYDxzcGFuIGNsYXNzPSJzb3J0LWluZGljYXRvciBtbC0yIj4ke3F1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9PT0gJ2FzYycgPyAn4payJyA6ICfilrwnfTwvc3Bhbj5gOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0KCi8qKgogKiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguKXguJrguJzguKXguIHguLLguKPguKrguK3guJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguKPguLLguKLguJrguLjguITguITguKUKICogQHBhcmFtIHtzdHJpbmd9IHN0dWRlbnROYW1lIC0g4LiK4Li34LmI4Lit4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lic4Lil4Liq4Lit4LiaCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXNzaW9uKHN0dWRlbnROYW1lKSB7CiAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSB8fCAhY3VycmVudFF1aXpEYXRhLmlkIHx8ICFzdHVkZW50TmFtZSkgewogICAgICAgIHNob3dNZXNzYWdlKCLguILguYnguK3guKHguLnguKXguYTguKHguYjguYDguJ7guLXguKLguIfguJ7guK3guJfguLXguYjguIjguLDguKXguJrguJzguKXguKrguK3guJoiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lic4Lil4LiB4Liy4Lij4Liq4Lit4Lia4LiC4Lit4LiHICIke3N0dWRlbnROYW1lfSI/IOC4meC4seC4geC5gOC4o+C4teC4ouC4meC4iOC4sOC4leC5ieC4reC4h+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5ieC5g+C4q+C4oeC5iOC4reC4teC4geC4hOC4o+C4seC5ieC4h2AsCiAgICAgICAgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBxdWl6SWQgPSBjdXJyZW50UXVpekRhdGEuaWQ7CiAgICAgICAgICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgZGVsZXRlRG9jKHN1Ym1pc3Npb25SZWYpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoYOC4peC4muC4nOC4peC4quC4reC4muC4guC4reC4hyAke3N0dWRlbnROYW1lfSDguKrguLPguYDguKPguYfguIhgKTsKICAgICAgICAgICAgICAgIC8vIOC4o+C4sOC4muC4muC4iOC4sCByZS1yZW5kZXIg4LiV4Liy4Lij4Liy4LiH4LmD4Lir4LmJ4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li04LmA4Lie4Lij4Liy4LiwIG9uU25hcHNob3Qg4LiX4Liz4LiH4Liy4LiZ4Lit4Lii4Li54LmICiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBzdWJtaXNzaW9uOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKXguJrguJzguKXguKrguK3guJoiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn0KCiAgICAgICAgLy8gLS0tIFN0dWRlbnQgRmxvdyAtLS0KICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVMb2FkUXVpeigpIHsKICAgIGNvbnN0IHF1aXpJZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotaWQtaW5wdXQnKTsKICAgIGNvbnN0IHF1aXpJZCA9IHF1aXpJZElucHV0LnZhbHVlLnRyaW0oKTsKICAgIGlmICghcXVpeklkKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4m+C5ieC4reC4meC4o+C4q+C4seC4quC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsb2FkUXVpekJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBsb2FkUXVpekJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lC4uLic7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBxdWl6RG9jUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWQpOwogICAgICAgIGNvbnN0IHF1aXpEb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHF1aXpEb2NSZWYpOwoKICAgICAgICBpZiAoIXF1aXpEb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguYHguJrguJrguJfguJTguKrguK3guJrguKrguLPguKvguKPguLHguJrguKPguKvguLHguKrguJnguLXguYkiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY3VycmVudFF1aXpEYXRhID0geyBpZDogcXVpekRvY1NuYXAuaWQsIC4uLnF1aXpEb2NTbmFwLmRhdGEoKSB9OwoKICAgICAgICAvLyBDaGVjayBRdWl6IFN0YXR1cwogICAgICAgIGNvbnN0IHN0YXR1cyA9IGN1cnJlbnRRdWl6RGF0YS5zdGF0dXMgfHwgJ2FjdGl2ZSc7CiAgICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgICAgICBpZiAoc3RhdHVzID09PSAnaW5hY3RpdmUnKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYnguJvguLTguJTguYPguIrguYnguIfguLLguJnguK3guKLguLnguYgiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhdHVzID09PSAnc2NoZWR1bGVkJykgewogICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBjdXJyZW50UXVpekRhdGEuc3RhcnRUaW1lID8gbmV3IERhdGUoY3VycmVudFF1aXpEYXRhLnN0YXJ0VGltZSkgOiBudWxsOwogICAgICAgICAgICBjb25zdCBlbmRUaW1lID0gY3VycmVudFF1aXpEYXRhLmVuZFRpbWUgPyBuZXcgRGF0ZShjdXJyZW50UXVpekRhdGEuZW5kVGltZSkgOiBudWxsOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHN0YXJ0VGltZSAmJiBub3cgPCBzdGFydFRpbWUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYnguIjguLDguYDguJvguLTguJTguYPguKvguYnguJfguLPguYPguJnguKfguLHguJnguJfguLXguYggJHtzdGFydFRpbWUudG9Mb2NhbGVTdHJpbmcoJ3RoLVRIJywgeyBob3VyMTI6IGZhbHNlIH0pfWApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbmRUaW1lICYmIG5vdyA+IGVuZFRpbWUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYnguKvguKHguJTguYDguKfguKXguLLguYHguKXguYnguKciKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBjdXJyZW50UXVpekRhdGEucHJvamVjdElkOwogICAgICAgIGN1cnJlbnRQcm9qZWN0SWQgPSBwcm9qZWN0SWQ7ICAgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgIGNvbnN0IHByb2plY3REb2NSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBwcm9qZWN0SWQpOwogICAgICAgIGNvbnN0IHByb2plY3REb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3REb2NSZWYpOwoKICAgICAgICBpZiAoIXByb2plY3REb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6IOC5hOC4oeC5iOC4nuC4muC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC5gOC4geC4teC5iOC4ouC4p+C4guC5ieC4reC4h+C4geC4seC4muC5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5iSIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gcHJvamVjdERvY1NuYXAuZGF0YSgpOwogICAgICAgIGN1cnJlbnRTdHVkZW50UHJvamVjdERhdGEgPSBwcm9qZWN0RGF0YTsgCiAgICAgICAgZGlzcGxheVN0dWRlbnROYW1lU2VsZWN0b3IocHJvamVjdERhdGEuc3R1ZGVudHMsIGN1cnJlbnRRdWl6RGF0YS50b3BpYyk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsb2FkaW5nIHF1aXogZm9yIHN0dWRlbnQ6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgIH0gZmluYWxseSB7CiAgICAgICAgbG9hZFF1aXpCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBsb2FkUXVpekJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zZWFyY2ggbXItMiI+PC9pPuC4hOC5ieC4meC4q+C4suC5geC4muC4muC4l+C4lOC4quC4reC4mic7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1hbnVhbEVkaXRQb2ludHMoc3R1ZGVudE5hbWUsIG5ld1BvaW50cykgewogICAgaWYgKCFjdXJyZW50UXVpekRhdGEgfHwgIWN1cnJlbnRRdWl6RGF0YS5pZCkgcmV0dXJuOwoKICAgIGNvbnN0IHF1aXpJZCA9IGN1cnJlbnRRdWl6RGF0YS5pZDsKICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSk7CgogICAgdHJ5IHsKICAgICAgICAvLyAxLiDguK3guLHguJvguYDguJTguJUgUG9pbnRzIOC4l+C4teC5iOC4q+C4meC5ieC4siBTdWJtaXNzaW9uCiAgICAgICAgLy8g4LmA4Lij4Liy4LiI4Liw4Lit4Lix4Lib4LmA4LiU4LiV4LiX4Li14LmIIHJvb3QgbGV2ZWwg4LmB4Lil4LiwIGF0dGVtcHQg4Lil4LmI4Liy4Liq4Li44LiU4LiU4LmJ4Lin4LiiIOC5gOC4nuC4t+C5iOC4reC4hOC4p+C4suC4oeC4iuC4seC4p+C4o+C5jAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25TbmFwID0gYXdhaXQgZ2V0RG9jKHN1Ym1pc3Npb25SZWYpOwogICAgICAgIGlmICghc3VibWlzc2lvblNuYXAuZXhpc3RzKCkpIHJldHVybjsKCiAgICAgICAgY29uc3QgZGF0YSA9IHN1Ym1pc3Npb25TbmFwLmRhdGEoKTsKICAgICAgICBjb25zdCBhdHRlbXB0cyA9IGRhdGEuYXR0ZW1wdHMgfHwgW107CiAgICAgICAgCiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiVIHBvaW50cyDguYPguJkgYXR0ZW1wdCDguKXguYjguLLguKrguLjguJQgKOC4luC5ieC4suC4oeC4tSkKICAgICAgICBpZiAoYXR0ZW1wdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBhdHRlbXB0c1thdHRlbXB0cy5sZW5ndGggLSAxXS5wb2ludHMgPSBuZXdQb2ludHM7CiAgICAgICAgICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBGbGFnIOC4nuC4tOC5gOC4qOC4qSDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguITguLPguJnguKfguJPguJfguLHguJrguYPguJnguK3guJnguLLguITguJUKICAgICAgICAgICAgYXR0ZW1wdHNbYXR0ZW1wdHMubGVuZ3RoIC0gMV0uaXNTeW5jR2FtZSA9IHRydWU7IAogICAgICAgIH0KCiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHN1Ym1pc3Npb25SZWYsIHsKICAgICAgICAgICAgcG9pbnRzOiBuZXdQb2ludHMsIC8vIOC4reC4seC4m+C5gOC4lOC4leC4hOC5iOC4suC4q+C4peC4seC4gQogICAgICAgICAgICBhdHRlbXB0czogYXR0ZW1wdHMKICAgICAgICB9KTsKCiAgICAgICAgLy8gMi4g4Liq4Liz4LiE4Lix4LiN4Lih4Liy4LiBISDguKrguLHguYjguIfguITguLPguJnguKfguJMgTGVhZGVyYm9hcmQg4LmD4Lir4Lih4LmI4LiX4Lix4LiZ4LiX4Li1CiAgICAgICAgaWYgKGN1cnJlbnRQcm9qZWN0RGF0YSAmJiBjdXJyZW50UHJvamVjdElkKSB7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVN0dWRlbnRQcm9maWxlKGN1cnJlbnRQcm9qZWN0SWQsIHN0dWRlbnROYW1lKTsKICAgICAgICB9CgogICAgICAgIHNob3dNZXNzYWdlKGDguYHguIHguYnguYTguIIgUG9pbnRzIOC4guC4reC4hyAke3N0dWRlbnROYW1lfSDguYDguJvguYfguJkgJHtuZXdQb2ludHN9IOC4quC4s+C5gOC4o+C5h+C4iCFgKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIHBvaW50czoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4hOC4sOC5geC4meC4mSIpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVKb2luTGl2ZUdhbWUoKSB7CiAgICBjb25zdCBwaW5JbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLXBpbi1pbnB1dCcpOwogICAgY29uc3Qgbmlja25hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduaWNrbmFtZS1pbnB1dCcpOwogICAgY29uc3Qgam9pbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWpvaW4tZ2FtZS1idG4nKTsKCiAgICBjb25zdCBnYW1lUGluID0gcGluSW5wdXQudmFsdWUudHJpbSgpOwogICAgY29uc3Qgbmlja25hbWUgPSBuaWNrbmFtZUlucHV0LnZhbHVlLnRyaW0oKTsKCiAgICBpZiAoIWdhbWVQaW4gfHwgIW5pY2tuYW1lKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4geC4o+C4reC4geC4o+C4q+C4seC4quC5gOC4guC5ieC4suC4o+C5iOC4p+C4oeC5geC4peC4sOC4iuC4t+C5iOC4reC5gOC4peC5iOC4meC5g+C4q+C5ieC4hOC4o+C4muC4luC5ieC4p+C4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBqb2luQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIGpvaW5CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT7guIHguLPguKXguLHguIfguJXguKPguKfguIjguKrguK3guJouLi4nOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4Lir4Liy4Lir4LmJ4Lit4LiH4LmA4LiB4Lih4LiI4Liy4LiBIFBJTgogICAgICAgIGNvbnN0IGdhbWVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgKTsKICAgICAgICAvLyDguKvguLLguYTguJTguYnguJfguLHguYnguIfguKvguYnguK3guIfguJfguLXguYjguKPguK0gKGxvYmJ5KSDguYHguKXguLDguKvguYnguK3guIfguJfguLXguYjguYDguKPguLTguYjguKHguYTguJvguYHguKXguYnguKcgKHF1ZXN0aW9uLCBzdW1tYXJ5LCByZXN1bHRzKQogICAgICAgIGNvbnN0IHEgPSBxdWVyeShnYW1lc1JlZiwgd2hlcmUoInBpbiIsICI9PSIsIGdhbWVQaW4pLCB3aGVyZSgic3RhdHVzIiwgImluIiwgWyJsb2JieSIsICJxdWVzdGlvbiIsICJzdW1tYXJ5IiwgInJlc3VsdHMiXSkpOwogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgaWYgKHNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC5gOC4iOC4reC5g+C4mSBTeW5jIEdhbWUg4Lil4Lit4LiH4LmE4Lib4Lir4Liy4LmD4LiZIFRlYW0gR2FtZSAo4LmA4Lic4Li34LmI4Lit4LmA4LiC4LmJ4Liy4Lic4Li04LiU4LmC4Lir4Lih4LiUKQogICAgICAgICAgICBjb25zdCB0ZWFtR2FtZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2ApOyAvLyB0ZWFtL2xpdmUgcmFjZSB1c2VzIGxpdmVHYW1lcyBjb2xsZWN0aW9uCiAgICAgICAgICAgIGNvbnN0IHFUZWFtID0gcXVlcnkodGVhbUdhbWVzUmVmLCB3aGVyZSgiZ2FtZVBpbiIsICI9PSIsIGdhbWVQaW4pKTsKICAgICAgICAgICAgY29uc3Qgc25hcFRlYW0gPSBhd2FpdCBnZXREb2NzKHFUZWFtKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghc25hcFRlYW0uZW1wdHkpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4iOC4reC5g+C4mSBUZWFtIE1vZGUg4LmD4Lir4LmJ4LmE4Lib4LmD4LiK4LmJIExvZ2ljIOC5gOC4lOC4tOC4oQogICAgICAgICAgICAgICAgYXdhaXQgcHJvY2VlZFdpdGhUZWFtUXVpekpvaW4oc25hcFRlYW0uZG9jc1swXSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguKvguYnguK3guIfguYDguIHguKHguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYkg4Lir4Lij4Li34Lit4LmA4LiB4Lih4LiI4Lia4LmE4Lib4LmB4Lil4LmJ4LinIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGdhbWVEb2MgPSBzbmFwc2hvdC5kb2NzWzBdOwogICAgICAgIGN1cnJlbnRMaXZlR2FtZUlkID0gZ2FtZURvYy5pZDsKICAgICAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVEb2MuZGF0YSgpOwoKICAgICAgICAvLyAyLiDguYDguIrguLfguYjguK3guKHguYLguKLguIfguILguYnguK3guKHguLnguKUgUXVpeiDguYHguKXguLAgUHJvamVjdAogICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGdhbWVEYXRhLnF1aXpJZCk7CiAgICAgICAgY29uc3QgcXVpelNuYXAgPSBhd2FpdCBnZXREb2MocXVpelJlZik7CiAgICAgICAgaWYgKHF1aXpTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXo7IC8vIOC5g+C4iuC5iSBRdWl6IOC4l+C4teC5iOC4quC4peC4seC4muC5geC4peC5ieC4p+C4iOC4suC4geC5g+C4meC4q+C5ieC4reC4hwogICAgICAgIH0KCiAgICAgICAgLy8gMy4gW+C4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4gl0g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiE4LiZ4LiZ4Li14LmJ4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICAgICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgbmlja25hbWUpOwogICAgICAgIGNvbnN0IHBsYXllclNuYXAgPSBhd2FpdCBnZXREb2MocGxheWVyUmVmKTsKCiAgICAgICAgaWYgKHBsYXllclNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgLy8gPT09IOC4geC4o+C4k+C4teC5gOC4geC5iOC4siAoUmUtam9pbikgPT09CiAgICAgICAgICAgIGpvaW5CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT7guIHguLPguKXguLHguIfguIHguLnguYnguITguLfguJnguILguYnguK3guKHguLnguKUuLi4nOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LmB4LiE4LmI4Lit4Lix4Lib4LmA4LiU4LiV4Liq4LiW4Liy4LiZ4Liw4LmA4Lib4LmH4LiZIGFjdGl2ZSDguKvguYnguLLguKHguKPguLXguYDguIvguYfguJXguITguLDguYHguJnguJkKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHBsYXllclJlZiwgeyBzdGF0dXM6ICdhY3RpdmUnIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd01lc3NhZ2UoYOC4ouC4tOC4meC4lOC4teC4leC5ieC4reC4meC4o+C4seC4muC4geC4peC4seC4miAke25pY2tuYW1lfSEg4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LiE4Li44LiT4LiW4Li54LiB4LiB4Li54LmJ4LiE4Li34LiZ4LmB4Lil4LmJ4LinYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gPT09IOC4geC4o+C4k+C4teC5g+C4q+C4oeC5iCAoTmV3IEpvaW4pID09PQogICAgICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguYDguIHguKHguYDguKPguLTguYjguKHguYTguJvguKvguKPguLfguK3guKLguLHguIcg4LiW4LmJ4Liy4LmA4Lij4Li04LmI4Lih4LmE4Lib4LmB4Lil4LmJ4Lin4Lit4Liy4LiI4LiI4Liw4Lir4LmJ4Liy4Lih4LmA4LiC4LmJ4LiyIOC4q+C4o+C4t+C4reC5gOC4guC5ieC4suC5geC4muC4miAwIOC4hOC4sOC5geC4meC4mQogICAgICAgICAgICBpZiAoZ2FtZURhdGEuc3RhdHVzICE9PSAnbG9iYnknKSB7CiAgICAgICAgICAgICAgICAvLyAoT3B0aW9uYWw6IOC4luC5ieC4suC4reC4ouC4suC4geC5g+C4q+C5ieC5gOC4guC5ieC4suC5hOC4lOC5ieC5geC4leC5iOC5gOC4o+C4tOC5iOC4oSAwIOC4geC5h+C4peC4miBCbG9jayDguJnguLXguYnguJfguLTguYnguIcpCiAgICAgICAgICAgICAgICAvLyDguYHguJXguYjguJvguIHguJXguLTguJXguKXguLLguJTguKHguLfguJTguJbguYnguLLguYDguILguYnguLLguKHguLLguJfguLXguKvguKXguLHguIfguIjguLDguYDguKrguLXguKLguYDguJvguKPguLXguKLguJrguKHguLLguIEKICAgICAgICAgICAgfQoKICAgICAgICAgICAgam9pbkJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C5gOC4guC5ieC4suC4o+C5iOC4p+C4oS4uLic7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBuZXdQbGF5ZXJEYXRhID0gewogICAgICAgICAgICAgICAgbmFtZTogbmlja25hbWUsCiAgICAgICAgICAgICAgICBzY29yZTogMCwKICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzOiAwLAogICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiAwLAogICAgICAgICAgICAgICAgcG93ZXJ1cHM6IHsKICAgICAgICAgICAgICAgICAgICBmaWZ0eUZpZnR5OiAwLCBzZWNvbmRDaGFuY2U6IDAsIGJ1eVRpbWU6IDAsIHBvbGw6IDAsCiAgICAgICAgICAgICAgICAgICAgd2FnZXJNdWx0aXBsaWVyOiAwLCBmb3JjZUNvbmZpZGVudDogMCwgY3V0T25lOiAwLCBpbnN1cmFuY2U6IDAsIHN0cmF0ZWd5U2NhbjogMCwgamlueDogMCwgcmV2ZWFsT3B0aW9uczogMAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGFuc3dlcmVkOiBmYWxzZSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICAgICAgICAgICAgICBhbnN3ZXJzOiBbXSwKICAgICAgICAgICAgICAgIGpvaW5lZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICAgICAgICAgIGlzSmlueGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgIGlzRm9yY2VkQ29uZmlkZW50OiBmYWxzZSwKICAgICAgICAgICAgICAgIHRpbWVCb251c1RoaXNRdWVzdGlvbjogMAogICAgICAgICAgICB9OwogICAgICAgICAgICBhd2FpdCBzZXREb2MocGxheWVyUmVmLCBuZXdQbGF5ZXJEYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIDQuIOC4leC4seC5ieC4h+C4hOC5iOC4suC4leC4seC4p+C5geC4m+C4oyBMb2NhbCDguYHguKXguLDguYDguKPguLTguYjguKHguJ/guLHguIfguILguYnguK3guKHguLnguKUKICAgICAgICBjdXJyZW50U3R1ZGVudE5hbWUgPSBuaWNrbmFtZTsKICAgICAgICBsb2NhbFRlYW1QbGF5ZXJzID0gW25pY2tuYW1lXTsKICAgICAgICAKICAgICAgICBzaG93VmlldygnbGl2ZS1nYW1lJyk7CiAgICAgICAgbGlzdGVuRm9yU3luY0dhbWVVcGRhdGVzKCk7CgogICAgICAgIC8vIOC5gOC4geC5h+C4miBTZXNzaW9uIOC5gOC4nuC4t+C5iOC4reC4geC4seC4mSBSZWZyZXNoIOC5geC4peC5ieC4p+C4q+C4peC4uOC4lAogICAgICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHsKICAgICAgICAgICAgZ2FtZUlkOiBjdXJyZW50TGl2ZUdhbWVJZCwKICAgICAgICAgICAgbW9kZTogJ3N5bmMnLAogICAgICAgICAgICBwbGF5ZXJzOiBsb2NhbFRlYW1QbGF5ZXJzLAogICAgICAgICAgICB0dXJuSW5kZXg6IDAKICAgICAgICB9OwogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJywgSlNPTi5zdHJpbmdpZnkoZ2FtZVN0YXRlKSk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBqb2luaW5nIGxpdmUgZ2FtZToiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4guC5ieC4suC4o+C5iOC4p+C4oTogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfSBmaW5hbGx5IHsKICAgICAgICBqb2luQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGpvaW5CdG4uaW5uZXJIVE1MLmluY2x1ZGVzKCdzcGlubmVyJykpIGpvaW5CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2lnbi1pbi1hbHQgbXItMiI+PC9pPuC5gOC4guC5ieC4suC4o+C5iOC4p+C4oSc7CiAgICB9Cn0KCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVN0dWRlbnROYW1lU2VsZWN0b3Ioc3R1ZGVudHMsIHRvcGljKSB7CiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnROYW1lU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtbmFtZS1zZWxlY3QnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcXVpei10b3BpYycpLnRleHRDb250ZW50ID0gYOC5geC4muC4muC4l+C4lOC4quC4reC4mjogJHt0b3BpY31gOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFzdHVkZW50cyB8fCBzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHN0dWRlbnROYW1lU2VsZWN0LmlubmVySFRNTCA9IGA8b3B0aW9uIHZhbHVlPSIiPuC5hOC4oeC5iOC4nuC4muC4o+C4suC4ouC4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4meC5g+C4meC5guC4m+C4o+C5gOC4iOC4hOC4meC4teC5iTwvb3B0aW9uPmA7CiAgICAgICAgICAgICAgICBzdGFydFF1aXpCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3R1ZGVudE5hbWVTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+LS0g4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4LitIC0tPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgIHN0dWRlbnRzLmZvckVhY2gobmFtZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICBvcHRpb24udGV4dENvbnRlbnQgPSBuYW1lOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnROYW1lU2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHN0YXJ0UXVpekJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdHVkZW50SW5pdGlhbFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnROYW1lU2VsZWN0aW9uVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlciB0byBzaHVmZmxlIGFycmF5cwogICAgICAgIGZ1bmN0aW9uIHNodWZmbGVBcnJheShhcnJheSkgewogICAgICAgICAgICBmb3IgKGxldCBpID0gYXJyYXkubGVuZ3RoIC0gMTsgaSA+IDA7IGktLSkgewogICAgICAgICAgICAgICAgY29uc3QgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOwogICAgICAgICAgICAgICAgW2FycmF5W2ldLCBhcnJheVtqXV0gPSBbYXJyYXlbal0sIGFycmF5W2ldXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCQkKCQkvKioKICAgICAgICAgKiDguKrguKPguYnguLLguIfguKrguLPguYDguJnguLLguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJrguYHguKXguLDguJfguLPguIHguLLguKPguKrguKXguLHguJrguILguYnguK0v4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiV4Liy4Lih4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IG9yaWdpbmFsUXVpekRhdGEgLSDguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJrguJXguYnguJnguInguJrguLHguJoKICAgICAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSDguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJrguIrguLjguJTguYPguKvguKHguYjguJfguLXguYjguJzguYjguLLguJnguIHguLLguKPguKrguKXguLHguJrguYHguKXguYnguKcKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBnZXRTaHVmZmxlZFF1aXoob3JpZ2luYWxRdWl6RGF0YSkgewogICAgICAgICAgICAvLyDguKrguKPguYnguLLguIfguKrguLPguYDguJnguLLguILguYnguK3guKHguLnguKXguJfguLHguYnguIfguKvguKHguJTguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguIHguKPguLDguJfguJrguJXguYnguJnguInguJrguLHguJoKICAgICAgICAgICAgbGV0IHByb2Nlc3NlZFF1aXogPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9yaWdpbmFsUXVpekRhdGEpKTsgCiAgICAgICAgICAgIGNvbnN0IHNodWZmbGVTZXR0aW5nID0gcHJvY2Vzc2VkUXVpei5zZXR0aW5ncz8uc2h1ZmZsZSB8fCAnbm9uZSc7CgogICAgICAgICAgICBpZiAoc2h1ZmZsZVNldHRpbmcgPT09ICdub25lJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3NlZFF1aXo7IC8vIOC4luC5ieC4suC5hOC4oeC5iOC4quC4peC4seC4miDguIHguYfguKrguYjguIfguILguYnguK3guKHguLnguKXguYDguJTguLTguKHguIHguKXguLHguJrguYTguJvguYDguKXguKIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMS4g4Liq4Lil4Lix4Lia4Lil4Liz4LiU4Lix4Lia4LiE4Liz4LiW4Liy4LihICjguJbguYnguLLguJXguLHguYnguIfguITguYjguLLguYTguKfguYkpCiAgICAgICAgICAgIGlmIChzaHVmZmxlU2V0dGluZyA9PT0gJ3F1ZXN0aW9uc19vbmx5JyB8fCBzaHVmZmxlU2V0dGluZyA9PT0gJ2JvdGgnKSB7CiAgICAgICAgICAgICAgICBzaHVmZmxlQXJyYXkocHJvY2Vzc2VkUXVpei5xdWVzdGlvbnMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAyLiDguKrguKXguLHguJrguKXguLPguJTguLHguJrguJXguLHguKfguYDguKXguLfguK3guIHguYPguJnguYHguJXguYjguKXguLDguITguLPguJbguLLguKEgKOC4luC5ieC4suC4leC4seC5ieC4h+C4hOC5iOC4suC5hOC4p+C5iSkKICAgICAgICAgICAgaWYgKHNodWZmbGVTZXR0aW5nID09PSAnY2hvaWNlc19vbmx5JyB8fCBzaHVmZmxlU2V0dGluZyA9PT0gJ2JvdGgnKSB7CiAgICAgICAgICAgICAgICBwcm9jZXNzZWRRdWl6LnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHByb2Nlc3NlZFF1aXoucXVpelR5cGU7CiAgICAgICAgICAgICAgICAgICAgLy8g4Liq4Lil4Lix4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4Liq4Liz4Lir4Lij4Lix4LiaIE11bHRpcGxlIENob2ljZQogICAgICAgICAgICAgICAgICAgIGlmIChxLm9wdGlvbnMpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvcHRpb25zVG9TaHVmZmxlID0gcS5vcHRpb25zLm1hcCgob3B0LCBpbmRleCkgPT4gKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IG9wdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdDogaW5kZXggPT09IHEuY29ycmVjdEFuc3dlckluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2h1ZmZsZUFycmF5KG9wdGlvbnNUb1NodWZmbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyDguK3guLHguJvguYDguJTguJUgb3B0aW9ucyDguYHguKXguLAgY29ycmVjdEFuc3dlckluZGV4IOC5g+C4q+C4oeC5iOC4leC4suC4oeC4peC4s+C4lOC4seC4muC4l+C4teC5iOC4quC4peC4seC4muC5geC4peC5ieC4pwogICAgICAgICAgICAgICAgICAgICAgICBxLm9wdGlvbnMgPSBvcHRpb25zVG9TaHVmZmxlLm1hcChvcHQgPT4gb3B0LnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICBxLmNvcnJlY3RBbnN3ZXJJbmRleCA9IG9wdGlvbnNUb1NodWZmbGUuZmluZEluZGV4KG9wdCA9PiBvcHQuaXNDb3JyZWN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g4Liq4Lil4Lix4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4Liq4Liz4Lir4Lij4Lix4LiaIE1hdGNoaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nICYmIHEuYWxsUmVzcG9uc2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNodWZmbGVBcnJheShxLmFsbFJlc3BvbnNlcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBwcm9jZXNzZWRRdWl6OwogICAgICAgIH0KCmZ1bmN0aW9uIGRpc3BsYXlRdWl6Rm9yU3R1ZGVudChxdWl6RGF0YSkgewogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgY3VycmVudERpc3BsYXllZFF1aXogPSBnZXRTaHVmZmxlZFF1aXoocXVpekRhdGEpOwoKICAgIC8vIC0tLSBbIOC5gOC4o+C4tOC5iOC4oeC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Lin4LmI4Liy4LmE4Lih4LmI4LmD4LiK4LmI4LmC4Lir4Lih4LiU4LiX4LiU4Liq4Lit4Lia4LiC4Lit4LiHIEFkbWluCiAgICBpZiAoY3VycmVudE1vZGUgIT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5guC4q+C4oeC4lOC4l+C4lOC4quC4reC4miDguYPguKvguYnguYDguJvguLTguJTguYPguIrguYnguIfguLLguJnguJ/guLXguYDguIjguK3guKPguYzguJvguYnguK3guIfguIHguLHguJnguJfguLHguYnguIfguKvguKHguJQKICAgICAgICByZXF1ZXN0V2FrZUxvY2soKTsgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiI4Lit4LiU4Lix4LiaCgogICAgICAgIGlzUXVpekFjdGl2ZSA9IHRydWU7CiAgICAgICAgY2hlYXRBdHRlbXB0cyA9IDA7CiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UpOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKTsKICAgICAgICBlbnRlckZ1bGxzY3JlZW4oKTsgLy8g4LmA4LiC4LmJ4Liy4LmC4Lir4Lih4LiU4LmA4LiV4LmH4Lih4LiI4LitCgogICAgICAgIC8vIOC5gOC4o+C4tOC5iOC4oeC4leC5ieC4meC4geC4suC4o+C4iOC4seC4muC5gOC4p+C4peC4suC4quC4s+C4q+C4o+C4seC4muC4q+C4o+C4teC5iOC5geC4quC4hwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCByZXNldERpbVRpbWVyKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgcmVzZXREaW1UaW1lcik7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCByZXNldERpbVRpbWVyKTsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHJlc2V0RGltVGltZXIpOwogICAgICAgIHJlc2V0RGltVGltZXIoKTsgLy8g4LmA4Lij4Li04LmI4Lih4LiZ4Lix4Lia4LiE4Lij4Lix4LmJ4LiH4LmB4Lij4LiBCiAgICB9CiAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KCiAgICBjb25zdCB0aW1lck1vZGUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8udGltZXJNb2RlIHx8ICdub25lJzsKICAgIGlmICh0aW1lck1vZGUgPT09ICd3aG9sZV9xdWl6JykgewogICAgICAgIHJlbmRlckZ1bGxRdWl6Rm9ybSgpOwogICAgICAgIHN0YXJ0V2hvbGVRdWl6VGltZXIoY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3MudGltZXJEdXJhdGlvbik7CiAgICB9IGVsc2UgaWYgKHRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICBjdXJyZW50UXVlc3Rpb25JbmRleCA9IDA7CiAgICAgICAgc3R1ZGVudEFuc3dlcnNQZXJRdWVzdGlvbiA9IFtdOwogICAgICAgIHJlbmRlclBlclF1ZXN0aW9uVmlldygpOwogICAgfSBlbHNlIHsKICAgICAgICByZW5kZXJGdWxsUXVpekZvcm0oKTsKICAgIH0KfQoKd2luZG93LnRvZ2dsZU1hdGhEcm9wZG93biA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGRyb3Bkb3duLWxpc3QtJHtpbmRleH1gKTsKICAgIGNvbnN0IGFsbExpc3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2lkXj0iZHJvcGRvd24tbGlzdC0iXScpOwogICAgCiAgICAvLyDguJvguLTguJQgRHJvcGRvd24g4Lit4Li34LmI4LiZ4LmGIOC4geC5iOC4reC4mQogICAgYWxsTGlzdHMuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgaWYgKGVsLmlkICE9PSBgZHJvcGRvd24tbGlzdC0ke2luZGV4fWApIGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSk7CgogICAgLy8g4Liq4Lil4Lix4Lia4LmA4Lib4Li04LiUL+C4m+C4tOC4lCDguK3guLHguJnguJfguLXguYjguITguKXguLTguIEKICAgIGlmIChsaXN0KSBsaXN0LmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpOwp9OwoKd2luZG93LnNlbGVjdE1hdGhPcHRpb24gPSBmdW5jdGlvbihxSW5kZXgsIG9wdEluZGV4KSB7CiAgICBjb25zdCBxdWl6ID0gY3VycmVudERpc3BsYXllZFF1aXo7CiAgICBpZiAoIXF1aXopIHJldHVybjsKCiAgICBjb25zdCBxdWVzdGlvbiA9IHF1aXoucXVlc3Rpb25zW3FJbmRleF07CiAgICBjb25zdCBzZWxlY3RlZFZhbHVlID0gcXVlc3Rpb24uYWxsUmVzcG9uc2VzW29wdEluZGV4XTsKCiAgICAvLyAxLiDguK3guLHguJvguYDguJTguJXguITguYjguLLguKXguIfguYPguJkgSGlkZGVuIElucHV0ICjguYDguJ7guLfguYjguK3guKrguYjguIfguJ/guK3guKPguYzguKEpCiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBpbnB1dC0ke3FJbmRleH1gKTsKICAgIGlmIChpbnB1dCkgaW5wdXQudmFsdWUgPSBzZWxlY3RlZFZhbHVlOwoKICAgIC8vIDIuIOC4reC4seC4m+C5gOC4lOC4leC4guC5ieC4reC4hOC4p+C4suC4oeC4muC4meC4m+C4uOC5iOC4oSDguYHguKXguLDguKrguLHguYjguIcgUmVuZGVyIE1hdGhKYXgKICAgIGNvbnN0IGRpc3BsYXlCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgc2VsZWN0ZWQtdGV4dC0ke3FJbmRleH1gKTsKICAgIGlmIChkaXNwbGF5QnRuKSB7CiAgICAgICAgZGlzcGxheUJ0bi5pbm5lckhUTUwgPSBzZWxlY3RlZFZhbHVlOyAvLyDguYPguKrguYjguKrguLnguJXguKPguKXguIfguYTguJsKICAgICAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW2Rpc3BsYXlCdG5dKTsgLy8g4LmB4Lib4Lil4LiH4Liq4Li54LiV4Lij4LiX4Lix4LiZ4LiX4Li1CiAgICAgICAgZGlzcGxheUJ0bi5jbGFzc0xpc3QuYWRkKCd0ZXh0LWluZGlnby03MDAnLCAnZm9udC1ib2xkJyk7IC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4quC4teC5g+C4q+C5ieC4o+C4ueC5ieC4p+C5iOC4suC5gOC4peC4t+C4reC4geC5geC4peC5ieC4pwogICAgfQoKICAgIC8vIDMuIOC4m+C4tOC4lCBEcm9wZG93bgogICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBkcm9wZG93bi1saXN0LSR7cUluZGV4fWApOwogICAgaWYgKGxpc3QpIGxpc3QuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn07CgovLyDguJvguLTguJQgRHJvcGRvd24g4LmA4Lih4Li34LmI4Lit4LiE4Lil4Li04LiB4LiX4Li14LmI4Lit4Li34LmI4LiZCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLmN1c3RvbS1tYXRoLWRyb3Bkb3duJykpIHsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbaWRePSJkcm9wZG93bi1saXN0LSJdJykuZm9yRWFjaChlbCA9PiBlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICB9Cn0pOwogICAgICAgIApmdW5jdGlvbiByZW5kZXJGdWxsUXVpekZvcm0oKSB7CiAgICBjb25zdCBjb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgPT09IHRydWU7CiAgICBjb25zdCBjb25maWRlbmNlTW9kZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5jb25maWRlbmNlTW9kZSB8fCAnY2hlY2tib3gnOwogICAgCiAgICAvLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIrguYfguITguKfguYjguLLguYHguKrguJTguIfguKvguLHguKfguILguYnguK0gIuC4iOC4seC4muC4hOC4ueC5iCIg4LmE4Lib4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICBsZXQgaGFzU2hvd25NYXRjaGluZ0hlYWRlciA9IGZhbHNlOwoKICAgIGxldCBodG1sID0gYAogICAgICAgICA8ZGl2IGlkPSJ0aW1lci1jb250YWluZXIiIGNsYXNzPSJtYi00Ij48L2Rpdj4KICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIG1iLTQiPgogICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCI+4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaOiAke2N1cnJlbnREaXNwbGF5ZWRRdWl6LnRvcGljfTwvaDM+CiAgICAgICAgICAgICAke2N1cnJlbnRNb2RlID09PSAnYWRtaW4tdGVzdGluZycgPyAnPGJ1dHRvbiBpZD0iY2FuY2VsLXRlc3QtYnRuIiBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtcmVkLTYwMCBmb250LXNlbWlib2xkIHB5LTEgcHgtMiByb3VuZGVkLW1kIGhvdmVyOmJnLXJlZC01MCI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcy1jaXJjbGUgbXItMSI+PC9pPiDguKLguIHguYDguKXguLTguIHguIHguLLguKPguJfguJTguKrguK3guJo8L2J1dHRvbj4nIDogJyd9CiAgICAgICAgIDwvZGl2PgogICAgICAgICA8Zm9ybSBpZD0icXVpei1mb3JtIj4KICAgIGA7CiAgICAKICAgIGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5mb3JFYWNoKChxLCBxdWVzdGlvbkluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudERpc3BsYXllZFF1aXoucXVpelR5cGU7CiAgICAgICAgY29uc3QgekluZGV4U3R5bGUgPSBgei1pbmRleDogJHsxMDAgLSBxdWVzdGlvbkluZGV4fTtgOwogICAgICAgIAogICAgICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZ4LiX4Li14LmIIDFdIOC5geC4quC4lOC4h+C4q+C4seC4p+C4guC5ieC4reC5g+C4q+C4jeC5iCAi4LiI4Lix4Lia4LiE4Li54LmILi4uIiDguYHguITguYjguITguKPguLHguYnguIfguYDguJTguLXguKLguKcgLS0tCiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nICYmICFoYXNTaG93bk1hdGNoaW5nSGVhZGVyKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1iLTYgcC00IGJnLWluZGlnby01MCBib3JkZXItbC00IGJvcmRlci1pbmRpZ28tNTAwIHRleHQtaW5kaWdvLTkwMCByb3VuZGVkLXItbGcgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9InRleHQtbGcgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leGNoYW5nZS1hbHQgbXItMyI+PC9pPiDguITguLPguIrguLXguYnguYHguIjguIc6IOC4iOC4seC4muC4hOC4ueC5iOC4guC5ieC4reC4hOC4p+C4suC4oeC4leC5iOC4reC5hOC4m+C4meC4teC5ieC5g+C4q+C5ieC4luC4ueC4geC4leC5ieC4reC4hwogICAgICAgICAgICAgICAgICAgIDwvaDQ+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgaGFzU2hvd25NYXRjaGluZ0hlYWRlciA9IHRydWU7IC8vIOC4m+C4seC4geC4mOC4h+C4p+C5iOC4suC5geC4quC4lOC4h+C5geC4peC5ieC4pwogICAgICAgIH0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJtYi02IHAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIHJlbGF0aXZlIiBzdHlsZT0iJHt6SW5kZXhTdHlsZX0iPmA7CgogICAgICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZ4LiX4Li14LmIIDJdIOC4quC5iOC4p+C4meC4q+C4seC4p+C4guC5ieC4reC4hOC4s+C4luC4suC4oSAo4LiW4LmJ4Liy4LmE4Lih4LmI4LmD4LiK4LmIIE1hdGNoaW5nIOC5g+C4q+C5ieC5geC4quC4lOC4h+C4m+C4geC4leC4tCkgLS0tCiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSAhPT0gJ21hdGNoaW5nX2l0ZW0nKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1zZW1pYm9sZCBtYi0zIj4KICAgICAgICAgICAgICAgICAgICA8cD4ke3F1ZXN0aW9uSW5kZXggKyAxfS4gJHtxLmluc3RydWN0aW9ucyB8fCBxLnF1ZXN0aW9uVGV4dH08L3A+CiAgICAgICAgICAgICAgICAgICAgJHtxLmltYWdlQ29kZSA/IGA8ZGl2IGNsYXNzPSJteS00IGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJzcGFjZS15LTIiPmA7CiAgICAgICAgCiAgICAgICAgLy8gMS4gTWF0Y2hpbmcgKEN1c3RvbSBEcm9wZG93bikKICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScgJiYgcS5hbGxSZXNwb25zZXMpIHsKICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBzbTppdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBzbTp3LTEvMiBwLTMgYmctYmx1ZS01MCByb3VuZGVkIGJvcmRlciBib3JkZXItYmx1ZS0xMDAgZm9udC1zZW1pYm9sZCB0ZXh0LWJsdWUtODAwIGZsZXggaXRlbXMtc3RhcnQgZ2FwLTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQtaW5kaWdvLTYwMCB0ZXh0LWxnIG10LVstMnB4XSI+JHtxdWVzdGlvbkluZGV4ICsgMX0uPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibGVhZGluZy1zbnVnIj4ke3Euc3RlbX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBzbTp3LTEvMiByZWxhdGl2ZSBjdXN0b20tbWF0aC1kcm9wZG93biI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIG5hbWU9InF1ZXN0aW9uJHtxdWVzdGlvbkluZGV4fSIgaWQ9ImlucHV0LSR7cXVlc3Rpb25JbmRleH0iIHJlcXVpcmVkPgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJ3LWZ1bGwgcC0zIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyBiZy13aGl0ZSB0ZXh0LWxlZnQgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIGhvdmVyOmJvcmRlci1pbmRpZ28tNTAwIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWluZGlnby0yMDAgdHJhbnNpdGlvbi1hbGwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljaz0id2luZG93LnRvZ2dsZU1hdGhEcm9wZG93bigke3F1ZXN0aW9uSW5kZXh9KSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic2VsZWN0ZWQtdGV4dC0ke3F1ZXN0aW9uSW5kZXh9IiBjbGFzcz0idHJ1bmNhdGUgdGV4dC1ncmF5LTUwMCI+LS0g4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4LiaIC0tPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24gdGV4dC1ncmF5LTQwMCB0ZXh0LXNtIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZHJvcGRvd24tbGlzdC0ke3F1ZXN0aW9uSW5kZXh9IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0iaGlkZGVuIGFic29sdXRlIHRvcC1mdWxsIGxlZnQtMCB3LWZ1bGwgbXQtMSBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgc2hhZG93LXhsIG1heC1oLTYwIG92ZXJmbG93LXktYXV0byB6LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cS5hbGxSZXNwb25zZXMubWFwKChyZXNwLCBvcHRJbmRleCkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBib3JkZXItYiBib3JkZXItZ3JheS0xMDAgaG92ZXI6YmctaW5kaWdvLTUwIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24tY29sb3JzIHRleHQtc20iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJ3aW5kb3cuc2VsZWN0TWF0aE9wdGlvbigke3F1ZXN0aW9uSW5kZXh9LCAke29wdEluZGV4fSkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3Jlc3B9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAKICAgICAgICAvLyAyLiBUcnVlL0ZhbHNlCiAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgICAgICBodG1sICs9IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InEke3F1ZXN0aW9uSW5kZXh9X29wdDAiIG5hbWU9InF1ZXN0aW9uJHtxdWVzdGlvbkluZGV4fSIgdmFsdWU9InRydWUiIGNsYXNzPSJtci0yIGFjY2VudC1pbmRpZ28tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJxJHtxdWVzdGlvbkluZGV4fV9vcHQwIj7guYPguIrguYg8L2xhYmVsPjwvZGl2PmA7CiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0icSR7cXVlc3Rpb25JbmRleH1fb3B0MSIgbmFtZT0icXVlc3Rpb24ke3F1ZXN0aW9uSW5kZXh9IiB2YWx1ZT0iZmFsc2UiIGNsYXNzPSJtci0yIGFjY2VudC1pbmRpZ28tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJxJHtxdWVzdGlvbkluZGV4fV9vcHQxIj7guYTguKHguYjguYPguIrguYg8L2xhYmVsPjwvZGl2PmA7CgogICAgICAgIC8vIDMuIE11bHRpcGxlIENob2ljZQogICAgICAgIH0gZWxzZSBpZiAocS5vcHRpb25zICYmIEFycmF5LmlzQXJyYXkocS5vcHRpb25zKSAmJiBxLm9wdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBodG1sICs9IHEub3B0aW9ucy5tYXAoKG9wdCwgaSkgPT4gYAogICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJxJHtxdWVzdGlvbkluZGV4fV9vcHQke2l9IiBuYW1lPSJxdWVzdGlvbiR7cXVlc3Rpb25JbmRleH0iIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+CiAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0icSR7cXVlc3Rpb25JbmRleH1fb3B0JHtpfSI+JHtvcHR9PC9sYWJlbD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICAgICAgCiAgICAgICAgLy8gNC4gU2hvcnQgQW5zd2VyCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaHRtbCArPSBgPHRleHRhcmVhIG5hbWU9InF1ZXN0aW9uJHtxdWVzdGlvbkluZGV4fSIgY2xhc3M9InctZnVsbCBwLTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIiByb3dzPSIzIiByZXF1aXJlZCBwbGFjZWhvbGRlcj0i4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTLi4uIj48L3RleHRhcmVhPmA7CiAgICAgICAgfQoKICAgICAgICBodG1sICs9IGA8L2Rpdj5gOwoKICAgICAgICBpZiAoY29uZmlkZW5jZVNjb3JpbmdFbmFibGVkKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgY2xhc3M9Im10LTQgcHQtMyBib3JkZXItdCBib3JkZXItZ3JheS0yMDAiPmA7CiAgICAgICAgICAgIGlmIChjb25maWRlbmNlTW9kZSA9PT0gJ21hbmRhdG9yeScpIHsKICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgbWItMiI+4LiE4Li44LiT4Lih4Lix4LmI4LiZ4LmD4LiI4LmD4LiZ4LiE4Liz4LiV4Lit4Lia4LiC4LmJ4Lit4LiZ4Li14LmJ4LmB4LiE4LmI4LmE4Lir4LiZPzo8L3A+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImhpZGRlbiIgaWQ9ImNvbmZpZGVuY2UtaW5wdXQtJHtxdWVzdGlvbkluZGV4fSIgbmFtZT0iY29uZmlkZW5jZSR7cXVlc3Rpb25JbmRleH0iIHZhbHVlPSIiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZsZXgtMSBweS0yIHB4LTQgcm91bmRlZC1tZCB0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgY29uZmlkZW5jZS1jaG9pY2UtYnRuIGNvbmZpZGVudCIgZGF0YS1xdWVzdGlvbi1pbmRleD0iJHtxdWVzdGlvbkluZGV4fSIgZGF0YS12YWx1ZT0iY29uZmlkZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXIgZmEtc21pbGUtYmVhbSBtci0yIj48L2k+4Lih4Lix4LmI4LiZ4LmD4LiICiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9ImZsZXgtMSBweS0yIHB4LTQgcm91bmRlZC1tZCB0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgY29uZmlkZW5jZS1jaG9pY2UtYnRuIG5vdC1jb25maWRlbnQiIGRhdGEtcXVlc3Rpb24taW5kZXg9IiR7cXVlc3Rpb25JbmRleH0iIGRhdGEtdmFsdWU9Im5vdF9jb25maWRlbnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhciBmYS1tZWggbXItMiI+PC9pPuC5hOC4oeC5iOC4oeC4seC5iOC4meC5g+C4iAogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJjb25maWRlbmNlJHtxdWVzdGlvbkluZGV4fSIgbmFtZT0iY29uZmlkZW5jZSR7cXVlc3Rpb25JbmRleH0iIGNsYXNzPSJoLTQgdy00IHJvdW5kZWQgYm9yZGVyLWdyYXktMzAwIHRleHQtaW5kaWdvLTYwMCBmb2N1czpyaW5nLWluZGlnby01MDAiPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZGVuY2Uke3F1ZXN0aW9uSW5kZXh9IiBjbGFzcz0ibWwtMiB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgY3Vyc29yLXBvaW50ZXIiPuC4ieC4seC4meC4oeC4seC5iOC4meC5g+C4iOC5g+C4meC4hOC4s+C4leC4reC4muC4guC5ieC4reC4meC4teC5iTwvbGFiZWw+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICAgICAgfQoKICAgICAgICBodG1sICs9IGA8L2Rpdj5gOwogICAgfSk7CiAgICAKICAgIGh0bWwgKz0gYDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0idy1mdWxsIG10LTQgYmctcHVycGxlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctcHVycGxlLTcwMCI+CiAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgbXItMiI+PC9pPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgPC9idXR0b24+YDsKICAgIGh0bWwgKz0gYDwvZm9ybT5gOwogICAgc3R1ZGVudFF1aXpBcmVhLmlubmVySFRNTCA9IGh0bWw7CiAgICAKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluLXRlc3RpbmcnKSB7CiAgICAgICAgY29uc3QgY2FuY2VsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC10ZXN0LWJ0bicpOwogICAgICAgIGlmKGNhbmNlbEJ0bikgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2FuY2VsQWRtaW5UZXN0KTsKICAgIH0KCiAgICBjb25zdCBxdWl6Rm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWZvcm0nKTsKICAgIGlmIChxdWl6Rm9ybSkgewogICAgICAgIHF1aXpGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZVN1Ym1pdFF1aXopOwogICAgICAgIHF1aXpGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29uZmlkZW5jZS1jaG9pY2UtYnRuJykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGUudGFyZ2V0OwogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBidG4uZGF0YXNldC5xdWVzdGlvbkluZGV4OwogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBidG4uZGF0YXNldC52YWx1ZTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBjb25maWRlbmNlLWlucHV0LSR7aW5kZXh9YCkudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IHBhcmVudCA9IGJ0bi5wYXJlbnRFbGVtZW50OwogICAgICAgICAgICAgICAgcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb25maWRlbmNlLWNob2ljZS1idG4nKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBpZiAod2luZG93Lk1hdGhKYXgpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgd2luZG93Lk1hdGhKYXgudHlwZXNldFByb21pc2UoW3N0dWRlbnRRdWl6QXJlYV0pOwogICAgICAgIH0sIDUwKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3VibWl0UXVpeihldmVudCkgewogICAgaWYoZXZlbnQpIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBpZihxdWl6VGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChxdWl6VGltZXJJbnRlcnZhbCk7CiAgICAKICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1mb3JtJyk7CiAgICBpZiAoIWZvcm0pIHJldHVybjsKICAgIAogICAgLy8gLS0tIExvZ2ljIOC5g+C4q+C4oeC5iDog4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Liq4LmI4LiHIC0tLQogICAgY29uc3QgY29uZmlkZW5jZUVuYWJsZWQgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgPT09IHRydWU7CiAgICBjb25zdCBjb25maWRlbmNlTW9kZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5jb25maWRlbmNlTW9kZSB8fCAnY2hlY2tib3gnOwoKICAgIGlmIChjb25maWRlbmNlRW5hYmxlZCAmJiBjb25maWRlbmNlTW9kZSA9PT0gJ21hbmRhdG9yeScpIHsKICAgICAgICBsZXQgYWxsQ29uZmlkZW5jZVNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjb25zdCBjb25maWRlbmNlSW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYCNjb25maWRlbmNlLWlucHV0LSR7aX1gKTsKICAgICAgICAgICAgaWYgKCFjb25maWRlbmNlSW5wdXQgfHwgY29uZmlkZW5jZUlucHV0LnZhbHVlID09PSAnJykgewogICAgICAgICAgICAgICAgYWxsQ29uZmlkZW5jZVNlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWFsbENvbmZpZGVuY2VTZWxlY3RlZCkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4Lij4Liw4LiU4Lix4Lia4LiE4Lin4Liy4Lih4Lih4Lix4LmI4LiZ4LmD4LiI4LmD4Lir4LmJ4LiE4Lij4Lia4LiX4Li44LiB4LiC4LmJ4Lit4LiB4LmI4Lit4LiZ4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LiE4Lij4Lix4LiaIik7CiAgICAgICAgICAgIHJldHVybjsgLy8g4Lir4Lii4Li44LiU4LiB4Liy4Lij4LiX4Liz4LiH4Liy4LiZCiAgICAgICAgfQogICAgfQogICAgLy8gLS0tIOC4quC4tOC5ieC4meC4quC4uOC4lCBMb2dpYyDguYPguKvguKHguYggLS0tCiAgICAKICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGZvcm0ucXVlcnlTZWxlY3RvcignYnV0dG9uW3R5cGU9InN1Ym1pdCJdJyk7CiAgICBjb25zdCBoYXNTaG9ydEFuc3dlciA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5zb21lKHEgPT4gcS5xdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInKTsKCiAgICBpZihzdWJtaXRCdXR0b24pIHsKICAgICAgICBzdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgIHN1Ym1pdEJ1dHRvbi5pbm5lckhUTUwgPSBoYXNTaG9ydEFuc3dlciAKICAgICAgICAgICAgPyAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPkFJIOC4geC4s+C4peC4seC4h+C4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4mi4uLicKICAgICAgICAgICAgOiAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C4quC5iOC4h+C4hOC4s+C4leC4reC4mi4uLic7CiAgICB9CiAgICAKICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKGZvcm0pOwogICAgCiAgICBjb25zdCB1c2VyQW5zd2VycyA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5tYXAoKHEsIHF1ZXN0aW9uSW5kZXgpID0+IHsKICAgICAgICBjb25zdCBhbnN3ZXIgPSBmb3JtRGF0YS5nZXQoYHF1ZXN0aW9uJHtxdWVzdGlvbkluZGV4fWApOwogICAgICAgIAogICAgICAgIC8vIOC5geC4geC5ieC5hOC4guC4geC4suC4o+C4reC5iOC4suC4meC4hOC5iOC4siB3YXNDb25maWRlbnQg4LmD4Lir4LmJ4Lij4Lit4LiH4Lij4Lix4Lia4LiX4Lix4LmJ4LiHIDIg4LmC4Lir4Lih4LiUCiAgICAgICAgbGV0IHdhc0NvbmZpZGVudDsKICAgICAgICBpZiAoY29uZmlkZW5jZU1vZGUgPT09ICdtYW5kYXRvcnknKSB7CiAgICAgICAgICAgIHdhc0NvbmZpZGVudCA9IGZvcm1EYXRhLmdldChgY29uZmlkZW5jZSR7cXVlc3Rpb25JbmRleH1gKTsgLy8g4LiI4Liw4LmE4LiU4LmJICdjb25maWRlbnQnIOC4q+C4o+C4t+C4rSAnbm90X2NvbmZpZGVudCcKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB3YXNDb25maWRlbnQgPSBmb3JtRGF0YS5nZXQoYGNvbmZpZGVuY2Uke3F1ZXN0aW9uSW5kZXh9YCkgPT09ICdvbic7IC8vIOC4iOC4sOC5hOC4lOC5iSB0cnVlIOC4q+C4o+C4t+C4rSBmYWxzZQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAuLi4gKOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4q+C4peC4t+C4reC4guC4reC4h+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkgLi4uCiAgICAgICAgbGV0IHBhcnNlZEFuc3dlciA9IG51bGw7CiAgICAgICAgaWYgKGFuc3dlciAhPT0gbnVsbCAmJiBhbnN3ZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudERpc3BsYXllZFF1aXoucXVpelR5cGU7CiAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fdGhlX2JsYW5rJykgewogICAgICAgICAgICAgICAgcGFyc2VkQW5zd2VyID0gcGFyc2VJbnQoYW5zd2VyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBhcnNlZEFuc3dlciA9IGFuc3dlcjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4geyBhbnN3ZXI6IHBhcnNlZEFuc3dlciwgd2FzQ29uZmlkZW50OiB3YXNDb25maWRlbnQgfTsKICAgIH0pOwogICAgCiAgICBjb25zdCBxdWl6SWQgPSBjdXJyZW50UXVpekRhdGEuaWQ7CiAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgY3VycmVudFN0dWRlbnROYW1lKTsKICAgIGNvbnN0IHN1Ym1pc3Npb25TbmFwID0gYXdhaXQgZ2V0RG9jKHN1Ym1pc3Npb25SZWYpOwogICAgY29uc3QgZXhpc3RpbmdEYXRhID0gc3VibWlzc2lvblNuYXAuZXhpc3RzKCkgPyBzdWJtaXNzaW9uU25hcC5kYXRhKCkgOiB7fTsKICAgIGNvbnN0IHByZXZpb3VzQXR0ZW1wdHMgPSBleGlzdGluZ0RhdGEuYXR0ZW1wdHMgfHwgW107CgogICAgYXdhaXQgcHJvY2Vzc0FuZFN1Ym1pdEFuc3dlcnModXNlckFuc3dlcnMsIHByZXZpb3VzQXR0ZW1wdHMpOwp9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ3JhZGVTaG9ydEFuc3dlcldpdGhBSSh1c2VyQW5zd2VyLCBpZGVhbEFuc3dlcikgewogICAgICAgICAgICBpZiAoIXVzZXJBbnN3ZXIgfHwgIWlkZWFsQW5zd2VyKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9tcHQgPSBgUGxlYXNlIGV2YWx1YXRlIGlmIHRoZSB1c2VyJ3MgYW5zd2VyIGlzIGNvcnJlY3QgYmFzZWQgb24gdGhlIGlkZWFsIGFuc3dlci4gVGhlIGNvbnRleHQgaXMgYSBzaW1wbGUgcXVpeiwgc28gYmUgbGVuaWVudCB3aXRoIHBocmFzaW5nIGJ1dCBzdHJpY3Qgd2l0aCB0aGUgY29yZSBjb25jZXB0LiBVc2VyIEFuc3dlcjogIiR7dXNlckFuc3dlcn0iLiBJZGVhbCBBbnN3ZXI6ICIke2lkZWFsQW5zd2VyfSIuIFJlc3BvbmQgd2l0aCBvbmx5ICJ0cnVlIiBvciAiZmFsc2UiLmA7CiAgICAgICAgICAgICAgICBjb25zdCBwYXlsb2FkID0geyBjb250ZW50czogW3sgcm9sZTogInVzZXIiLCBwYXJ0czogW3sgdGV4dDogcHJvbXB0IH1dIH1dIH07CiAgICAgICAgICAgICAgICBjb25zdCBhcGlLZXkgPSAiQUl6YVN5RDRQOWdLcHJMUGZKMVE5QmZDcHJXLVBSUkw5U01YeW9VIjsgLy8gQVBJIGtleSB3aWxsIGJlIHByb3ZpZGVkIGJ5IHRoZSBlbnZpcm9ubWVudAogICAgICAgICAgICAgICAgY29uc3QgYXBpVXJsID0gYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaC1wcmV2aWV3LTA5LTIwMjU6Z2VuZXJhdGVDb250ZW50P2tleT0ke2FwaUtleX1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGFwaVVybCwgeyBtZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpIH0pOwogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgdGhyb3cgbmV3IEVycm9yKCdBUEkgY2FsbCBmYWlsZWQnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgY29uc3QgdGV4dFJlc3BvbnNlID0gcmVzdWx0LmNhbmRpZGF0ZXNbMF0uY29udGVudC5wYXJ0c1swXS50ZXh0LnRyaW0oKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRleHRSZXNwb25zZSA9PT0gJ3RydWUnOwoKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkFJIGdyYWRpbmcgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRGVmYXVsdCB0byBpbmNvcnJlY3QgaWYgQUkgZmFpbHMKICAgICAgICAgICAgfQogICAgICAgIH0KCgphc3luYyBmdW5jdGlvbiBwcm9jZXNzQW5kU3VibWl0QW5zd2Vycyh1c2VyQW5zd2VycywgcHJldmlvdXNBdHRlbXB0cykgewogICAgLy8gMS4g4LmA4LiE4Lil4Li14Lii4Lij4LmM4Liq4LiW4Liy4LiZ4Liw4Lir4LiZ4LmJ4Liy4LiI4Lit4LmB4Lil4Liw4Lij4Liw4Lia4Lia4Lib4LmJ4Lit4LiH4LiB4Lix4LiZCiAgICBpZiAodHlwZW9mIHJlbGVhc2VXYWtlTG9jayA9PT0gJ2Z1bmN0aW9uJykgcmVsZWFzZVdha2VMb2NrKCk7CiAgICBpZiAodHlwZW9mIHN0b3BEaW1UaW1lciA9PT0gJ2Z1bmN0aW9uJykgc3RvcERpbVRpbWVyKCk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSB7CiAgICAgICAgICAgIGF3YWl0IGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybigiRnVsbHNjcmVlbiBleGl0IGZhaWxlZCAoc2FmZSB0byBpZ25vcmUpOiIsIGUpOwogICAgfQogICAgCiAgICBpc1F1aXpBY3RpdmUgPSBmYWxzZTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKTsKCiAgICAvLyAyLiDguYDguJXguKPguLXguKLguKHguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguITguLPguJnguKfguJPguITguLDguYHguJnguJkKICAgIGxldCB0b3RhbFJhd1Njb3JlID0gMDsgLy8g4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4Lij4Lin4LihICjguJXguLLguKHguJnguYnguLPguKvguJnguLHguIEpCiAgICBsZXQgdG90YWxNYXhTY29yZSA9IDA7IC8vIOC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC4o+C4p+C4oSAo4Lic4Lil4Lij4Lin4Lih4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LiX4Li44LiB4LiC4LmJ4LitKQogICAgbGV0IHRvdGFsUG9pbnRzID0gMDsgICAvLyDguITguLDguYHguJnguJkgR2FtaWZpY2F0aW9uCiAgICAKICAgIGNvbnN0IGRldGFpbGVkQW5zd2VycyA9IFtdOwogICAgY29uc3QgcXVlc3Rpb25zID0gY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zOwogICAgY29uc3QgdG90YWxRdWVzdGlvbnNDb3VudCA9IHF1ZXN0aW9ucy5sZW5ndGg7CiAgICAKICAgIGxldCBjb3JyZWN0U3RyZWFrID0gMDsKICAgIGxldCBlYXJuZWRCYWRnZXMgPSBbXTsKCiAgICAvLyAzLiDguYDguKPguLTguYjguKHguKfguJnguKXguLnguJvguJXguKPguKfguIjguITguLPguJXguK3guJrguJfguLXguKXguLDguILguYnguK0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVlc3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgcSA9IHF1ZXN0aW9uc1tpXTsKICAgICAgICBjb25zdCB1c2VyQW5zd2VyRGF0YSA9IHVzZXJBbnN3ZXJzW2ldOwogICAgICAgIGNvbnN0IHVzZXJBbnN3ZXIgPSB1c2VyQW5zd2VyRGF0YSA/IHVzZXJBbnN3ZXJEYXRhLmFuc3dlciA6IG51bGw7CiAgICAgICAgY29uc3Qgd2FzQ29uZmlkZW50ID0gdXNlckFuc3dlckRhdGEgPyB1c2VyQW5zd2VyRGF0YS53YXNDb25maWRlbnQgOiBudWxsOwogICAgICAgIAogICAgICAgIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4m+C4o+C4sOC5gOC4oOC4l+C4hOC4s+C4luC4suC4oeC5geC4peC4sOC4meC5ieC4s+C4q+C4meC4seC4geC4hOC4sOC5geC4meC4mQogICAgICAgIGNvbnN0IHFUeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudERpc3BsYXllZFF1aXoucXVpelR5cGU7CiAgICAgICAgY29uc3Qgd2VpZ2h0ID0gZ2V0UXVlc3Rpb25XZWlnaHQoY3VycmVudERpc3BsYXllZFF1aXosIHFUeXBlKTsKICAgICAgICAKICAgICAgICB0b3RhbE1heFNjb3JlICs9IHdlaWdodDsgLy8g4Lia4Lin4LiB4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4LiC4Lit4LiH4LiC4LmJ4Lit4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibCgogICAgICAgIGxldCBpc0NvcnJlY3QgPSBmYWxzZTsKICAgICAgICAKICAgICAgICAvLyAtLS0g4LiV4Lij4Lin4LiI4LiE4Liz4LiV4Lit4LiaIC0tLQogICAgICAgIGlmIChxVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcVR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgICAgIGNvbnN0IGNsZWFuVXNlciA9IFN0cmluZyh1c2VyQW5zd2VyIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgY29uc3QgY2xlYW5JZGVhbCA9IFN0cmluZyhxLmlkZWFsQW5zd2VyIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKGNsZWFuVXNlciA9PT0gY2xlYW5JZGVhbCk7IAogICAgICAgIH0gZWxzZSBpZiAocVR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgICAgICBjb25zdCBjb3JyZWN0Qm9vbCA9IChxLmNvcnJlY3RBbnN3ZXIgPT09IHRydWUgfHwgU3RyaW5nKHEuY29ycmVjdEFuc3dlcikudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKTsKICAgICAgICAgICAgY29uc3QgdXNlckJvb2wgPSAodXNlckFuc3dlciA9PT0gJ3RydWUnIHx8IHVzZXJBbnN3ZXIgPT09IHRydWUpOwogICAgICAgICAgICBpc0NvcnJlY3QgPSAodXNlckJvb2wgPT09IGNvcnJlY3RCb29sKTsKICAgICAgICB9IGVsc2UgaWYgKHFUeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKHVzZXJBbnN3ZXIgPT09IHEuY29ycmVjdFJlc3BvbnNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpc0NvcnJlY3QgPSAocGFyc2VJbnQodXNlckFuc3dlcikgPT09IHEuY29ycmVjdEFuc3dlckluZGV4KTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguJTguLTguJogKFJhdyBTY29yZSkgLS0tCiAgICAgICAgLy8g4LiV4Lit4Lia4LiW4Li54LiB4LmE4LiU4LmJ4LmA4LiV4LmH4Lih4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBIOC4leC4reC4muC4nOC4tOC4lOC5hOC4lOC5iSAwCiAgICAgICAgY29uc3QgcmF3U2NvcmVGb3JRdWVzdGlvbiA9IGlzQ29ycmVjdCA/IHdlaWdodCA6IDA7CiAgICAgICAgdG90YWxSYXdTY29yZSArPSByYXdTY29yZUZvclF1ZXN0aW9uOwoKICAgICAgICAvLyAtLS0g4LiE4Liz4LiZ4Lin4LiTIFBvaW50cyAoR2FtaWZpY2F0aW9uKSDguJXguLLguKHguKrguLHguJTguKrguYjguKfguJkgLS0tCiAgICAgICAgLy8g4Liq4Li54LiV4LijOiBQb2ludCDguJ7guLfguYnguJnguJDguLLguJkgPSDguJnguYnguLPguKvguJnguLHguIHguITguLDguYHguJnguJkKICAgICAgICAvLyDguKHguLHguYjguJnguYPguIggKyDguJbguLnguIEgPSDguJnguYnguLPguKvguJnguLHguIEgeCAyCiAgICAgICAgLy8g4Lih4Lix4LmI4LiZ4LmD4LiIICsg4Lic4Li04LiUID0g4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBIHggLTEKICAgICAgICAvLyDguYTguKHguYjguKHguLHguYjguJnguYPguIggKyDguJzguLTguJQgPSAwCiAgICAgICAgbGV0IHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IDA7CgogICAgICAgIGlmIChjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQpIHsKICAgICAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgaWYgKHdhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCB3YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gd2VpZ2h0ICogMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gd2VpZ2h0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKHdhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCB3YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKSB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gLXdlaWdodDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4m+C4tOC4lOC5guC4q+C4oeC4lOC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iCDguYTguJTguYkgUG9pbnQg4LmA4LiX4LmI4Liy4LiB4Lix4Lia4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04LiaCiAgICAgICAgICAgIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IHJhd1Njb3JlRm9yUXVlc3Rpb247CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHRvdGFsUG9pbnRzICs9IHBvaW50c0ZvclRoaXNRdWVzdGlvbjsKCiAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICBjb3JyZWN0U3RyZWFrKys7CiAgICAgICAgICAgIGlmIChjb3JyZWN0U3RyZWFrID09PSAzKSBlYXJuZWRCYWRnZXMucHVzaChCQURHRVMuT05fRklSRS5pZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29ycmVjdFN0cmVhayA9IDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxldCBhbnN3ZXJUZXh0ID0gbnVsbDsKICAgICAgICBpZiAocS5vcHRpb25zICYmIChxVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScgfHwgcVR5cGUgPT09ICdmaWxsX2luX3dpdGhfY2hvaWNlcycpICYmIHVzZXJBbnN3ZXIgIT09IG51bGwpIHsKICAgICAgICAgICAgYW5zd2VyVGV4dCA9IHEub3B0aW9uc1t1c2VyQW5zd2VyXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhbnN3ZXJUZXh0ID0gdXNlckFuc3dlcjsKICAgICAgICB9CgogICAgICAgIGRldGFpbGVkQW5zd2Vycy5wdXNoKHsKICAgICAgICAgICAgcXVlc3Rpb25JZDogcS5pZCwKICAgICAgICAgICAgYW5zd2VyOiB1c2VyQW5zd2VyLCAKICAgICAgICAgICAgYW5zd2VyVGV4dDogYW5zd2VyVGV4dCwgCiAgICAgICAgICAgIGlzQ29ycmVjdDogaXNDb3JyZWN0LAogICAgICAgICAgICB3YXNDb25maWRlbnQ6IHdhc0NvbmZpZGVudCwKICAgICAgICAgICAgcG9pbnRzQXdhcmRlZDogcG9pbnRzRm9yVGhpc1F1ZXN0aW9uLAogICAgICAgICAgICBvcmlnaW5hbFF1ZXN0aW9uVGV4dDogcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gNC4g4LiE4Liz4LiZ4Lin4LiT4LmA4Lir4Lij4Li14Lii4LiN4Lij4Liy4LiH4Lin4Lix4Lil4LmB4Lil4Liw4Liq4LiW4Li04LiV4Li0CiAgICAvLyDguYPguIrguYnguYDguIHguJPguJHguYwgIuC4nOC5iOC4suC4mSIg4LmC4LiU4Lii4LmA4LiX4Li14Lii4Lia4LiI4Liy4LiB4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihICh0b3RhbE1heFNjb3JlKQogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIHBhc3NpbmdTY29yZSDguYTguKfguYkg4LmD4Lir4LmJ4LmD4LiK4LmJIDUwJSDguILguK3guIfguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKHguYDguJvguYfguJnguYDguIHguJPguJHguYwKICAgIGNvbnN0IHVzZXJEZWZpbmVkUGFzc2luZ1Njb3JlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnBhc3NpbmdTY29yZTsKICAgIGNvbnN0IHBhc3NpbmdUaHJlc2hvbGQgPSAodXNlckRlZmluZWRQYXNzaW5nU2NvcmUgIT09IHVuZGVmaW5lZCAmJiB1c2VyRGVmaW5lZFBhc3NpbmdTY29yZSAhPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB1c2VyRGVmaW5lZFBhc3NpbmdTY29yZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICh0b3RhbE1heFNjb3JlIC8gMik7CiAgICAKICAgIC8vIOC5gOC4iuC5h+C4hOC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oSAoUGVyZmVjdCBTY29yZSkKICAgIGlmICh0b3RhbFJhd1Njb3JlID09PSB0b3RhbE1heFNjb3JlICYmIHRvdGFsTWF4U2NvcmUgPiAwICYmICFjdXJyZW50RGlzcGxheWVkUXVpei5pc1JlbWVkaWFsKSB7CiAgICAgICAgZWFybmVkQmFkZ2VzLnB1c2goQkFER0VTLlBFUkZFQ1RfU0NPUkUuaWQpOwogICAgfQogICAgCiAgICAvLyAuLi4gKOC4quC5iOC4p+C4mSBUaW1lciBCYWRnZXMg4LiE4LiH4LmA4LiU4Li04LihKSAuLi4KICAgIGNvbnN0IHRpbWVyTW9kZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy50aW1lck1vZGU7CiAgICBpZiAodGltZXJNb2RlID09PSAnd2hvbGVfcXVpeicgJiYgcXVpelN0YXJ0VGltZSkgewogICAgICAgIGNvbnN0IHRpbWVUYWtlbiA9IChuZXcgRGF0ZSgpIC0gcXVpelN0YXJ0VGltZSkgLyAxMDAwOwogICAgICAgIGNvbnN0IHRpbWVBbGxvd2VkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3MudGltZXJEdXJhdGlvbiAqIDYwOwogICAgICAgIGlmICh0b3RhbFJhd1Njb3JlID49IHBhc3NpbmdUaHJlc2hvbGQgJiYgdGltZVRha2VuIDwgdGltZUFsbG93ZWQgLyAyKSB7CiAgICAgICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5RVUlDS19USElOS0VSLmlkKTsKICAgICAgICB9CiAgICB9CgogICAgaWYgKHByZXZpb3VzQXR0ZW1wdHMubGVuZ3RoID09PSAwICYmIHRvdGFsUmF3U2NvcmUgPT09IHRvdGFsTWF4U2NvcmUgJiYgdG90YWxNYXhTY29yZSA+IDApIHsKICAgICAgICBlYXJuZWRCYWRnZXMucHVzaChCQURHRVMuRklSU1RfVFJZX0FDRS5pZCk7CiAgICB9CiAgICBpZiAocHJldmlvdXNBdHRlbXB0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3QgZmlyc3RBdHRlbXB0U2NvcmUgPSBwcmV2aW91c0F0dGVtcHRzWzBdLnNjb3JlOwogICAgICAgIC8vIOC5gOC4iuC5h+C4hOC4nuC4seC4kuC4meC4suC4geC4suC4oyAo4LiW4LmJ4Liy4LiE4Lij4Lix4LmJ4LiH4LmB4Lij4LiB4LmE4Lih4LmI4Lic4LmI4Liy4LiZIOC5geC4peC4sOC4hOC4o+C4seC5ieC4h+C4meC4teC5ieC4nOC5iOC4suC4mSkKICAgICAgICBpZiAoZmlyc3RBdHRlbXB0U2NvcmUgPCBwYXNzaW5nVGhyZXNob2xkICYmIHRvdGFsUmF3U2NvcmUgPj0gcGFzc2luZ1RocmVzaG9sZCkgewogICAgICAgICAgICBjb25zdCBoYXNDb21lYmFja0JhZGdlID0gcHJldmlvdXNBdHRlbXB0cy5zb21lKGF0dGVtcHQgPT4gKGF0dGVtcHQuYmFkZ2VzIHx8IFtdKS5pbmNsdWRlcyhCQURHRVMuQ09NRUJBQ0tfS0lORy5pZCkpOwogICAgICAgICAgICBpZiAoIWhhc0NvbWViYWNrQmFkZ2UpIHsKICAgICAgICAgICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5DT01FQkFDS19LSU5HLmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmIChwcmV2aW91c0F0dGVtcHRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5QRVJTRVZFUkFOQ0UuaWQpOwogICAgfQogICAgCiAgICBjb25zdCBkaXNwbGF5U2V0dGluZyA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzLnJlc3VsdHNEaXNwbGF5OwogICAgCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIC8vIOC4quC5iOC4hyB0b3RhbE1heFNjb3JlIOC5hOC4m+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4q+C4meC5ieC4suC4nOC4peC4peC4seC4nuC4mOC5jOC5geC4quC4lOC4hyAyNSAvIDI1CiAgICAgICAgaGFuZGxlUmVzdWx0RGlzcGxheShkaXNwbGF5U2V0dGluZywgdG90YWxSYXdTY29yZSwgdG90YWxQb2ludHMsIGVhcm5lZEJhZGdlcywgZGV0YWlsZWRBbnN3ZXJzLCB0b3RhbE1heFNjb3JlKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gNS4g4Lia4Lix4LiZ4LiX4Li24LiB4Lic4Lil4Lil4LiHIEZpcmVzdG9yZQogICAgY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwogICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2AsIGN1cnJlbnRTdHVkZW50TmFtZSk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBhdHRlbXB0cyA9IFsuLi5wcmV2aW91c0F0dGVtcHRzXTsKICAgICAgICBjb25zdCBuZXdBdHRlbXB0ID0gewogICAgICAgICAgICBzY29yZTogdG90YWxSYXdTY29yZSwgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LmA4Lib4LmH4LiZ4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4LiX4Li14LmI4Lih4Li14LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIHBvaW50czogdG90YWxQb2ludHMsCiAgICAgICAgICAgIGJhZGdlczogQXJyYXkuZnJvbShuZXcgU2V0KGVhcm5lZEJhZGdlcykpLAogICAgICAgICAgICBzdWJtaXR0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICBhbnN3ZXJzOiBkZXRhaWxlZEFuc3dlcnMKICAgICAgICB9OwogICAgICAgIGF0dGVtcHRzLnB1c2gobmV3QXR0ZW1wdCk7CgogICAgICAgIGNvbnN0IGZpcnN0U2NvcmUgPSBwcmV2aW91c0F0dGVtcHRzLmxlbmd0aCA9PT0gMCA/IHRvdGFsUmF3U2NvcmUgOiAocHJldmlvdXNBdHRlbXB0c1swXS5zY29yZSB8fCAwKTsKICAgICAgICBjb25zdCBiZXN0U2NvcmUgPSBNYXRoLm1heCguLi5hdHRlbXB0cy5tYXAoYSA9PiBhLnNjb3JlKSk7CgogICAgICAgIGF3YWl0IHNldERvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgIHN0dWRlbnROYW1lOiBjdXJyZW50U3R1ZGVudE5hbWUsCiAgICAgICAgICAgIC8vIOC4quC4s+C4hOC4seC4jTog4Lia4Lix4LiZ4LiX4Li24LiBICLguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEiIOC4peC4h+C5g+C4meC4iuC5iOC4reC4hyB0b3RhbFF1ZXN0aW9ucyDguYDguJ7guLfguYjguK3guYPguKvguYnguKvguJnguYnguLIgRGFzaGJvYXJkIOC5geC4quC4lOC4h+C4nOC4peC4luC4ueC4gSAo4LmA4LiK4LmI4LiZIDI1KQogICAgICAgICAgICB0b3RhbFF1ZXN0aW9uczogdG90YWxNYXhTY29yZSwgCiAgICAgICAgICAgIHRvdGFsUXVlc3Rpb25zQ291bnQ6IHRvdGFsUXVlc3Rpb25zQ291bnQsIC8vIOC5gOC4geC5h+C4muC4iOC4s+C4meC4p+C4meC4guC5ieC4reC5geC4ouC4geC5hOC4p+C5iSAo4LmA4Lic4Li34LmI4Lit4LmD4LiK4LmJKQogICAgICAgICAgICBhdHRlbXB0czogYXR0ZW1wdHMsCiAgICAgICAgICAgIGZpcnN0U2NvcmU6IGZpcnN0U2NvcmUsCiAgICAgICAgICAgIGJlc3RTY29yZTogYmVzdFNjb3JlLAogICAgICAgICAgICBsYXRlc3RTY29yZTogdG90YWxSYXdTY29yZSwKICAgICAgICAgICAgcG9pbnRzOiB0b3RhbFBvaW50cywKICAgICAgICAgICAgbGF0ZXN0U3VibWl0dGVkQXQ6IG5ld0F0dGVtcHQuc3VibWl0dGVkQXQKICAgICAgICB9LCB7IG1lcmdlOiB0cnVlIH0pOwoKICAgICAgICBhd2FpdCB1cGRhdGVTdHVkZW50UHJvZmlsZShjdXJyZW50UXVpekRhdGEucHJvamVjdElkLCBjdXJyZW50U3R1ZGVudE5hbWUpOwogICAgICAgIAogICAgICAgIC8vIOC4quC5iOC4hyB0b3RhbE1heFNjb3JlIOC5hOC4m+C5gOC4m+C5h+C4mSBwYXJhbWV0ZXIg4Liq4Li44LiU4LiX4LmJ4Liy4LiiIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5geC4quC4lOC4h+C4nOC4peC5gOC4m+C5h+C4mSBYIC8gTWF4U2NvcmUKICAgICAgICBoYW5kbGVSZXN1bHREaXNwbGF5KGRpc3BsYXlTZXR0aW5nLCB0b3RhbFJhd1Njb3JlLCB0b3RhbFBvaW50cywgZWFybmVkQmFkZ2VzLCBkZXRhaWxlZEFuc3dlcnMsIHRvdGFsTWF4U2NvcmUpOwogICAgICAgIAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgc3VibWlzc2lvbjoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4hOC4s+C4leC4reC4muC4guC4reC4h+C4hOC4uOC4kyIpOwogICAgfQp9CgpmdW5jdGlvbiBnZXRRdWVzdGlvbldlaWdodChxdWl6RGF0YSwgcXVlc3Rpb25UeXBlKSB7CiAgICBjb25zdCB0eXBlU2NvcmluZyA9IHF1aXpEYXRhLnNldHRpbmdzPy50eXBlU2NvcmluZyB8fCB7IG1jcTogMSwgc2E6IDEsIHRmOiAxIH07CiAgICAKICAgIC8vIOC5geC4m+C4peC4h+C4hOC5iOC4suC5gOC4m+C5h+C4mSBGbG9hdCDguYDguJ7guLfguYjguK3guITguKfguLLguKHguIrguLHguKfguKPguYwgKOC4geC4o+C4k+C4teC4o+C4seC4muC4oeC4suC5gOC4m+C5h+C4mSBTdHJpbmcpCiAgICBjb25zdCBnZXRWYWwgPSAodmFsKSA9PiB7CiAgICAgICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdCh2YWwpOwogICAgICAgIHJldHVybiBpc05hTihudW0pID8gMSA6IG51bTsKICAgIH07CgogICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgIHJldHVybiBnZXRWYWwodHlwZVNjb3Jpbmcuc2EpOwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgIHJldHVybiBnZXRWYWwodHlwZVNjb3JpbmcudGYpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBtdWx0aXBsZV9jaG9pY2UsIG1hdGNoaW5nLCBldGMuCiAgICAgICAgcmV0dXJuIGdldFZhbCh0eXBlU2NvcmluZy5tY3EpOwogICAgfQp9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlU3R1ZGVudFByb2ZpbGUocHJvamVjdElkLCBzdHVkZW50TmFtZSkgewogICAgY29uc3QgcHJvZmlsZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0cy8ke3Byb2plY3RJZH0vc3R1ZGVudFByb2ZpbGVzYCwgc3R1ZGVudE5hbWUpOwoKICAgIHRyeSB7CiAgICAgICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54LilIFF1aXog4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZIFByb2plY3QgKOC4ouC4reC4oeC5gOC4quC4teC4oiBSZWFkIOC4leC4o+C4h+C4meC4teC5ieC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4guC5ieC4reC4oeC4ueC4peC5geC4oeC5iOC4meC4ouC4s+C5gOC4p+C4peC4suC4quC4seC5iOC4hyBSZWNhbGN1bGF0ZSkKICAgICAgICBjb25zdCBxdWl6emVzUXVlcnkgPSBxdWVyeSgKICAgICAgICAgICAgY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCksCiAgICAgICAgICAgIHdoZXJlKCJwcm9qZWN0SWQiLCAiPT0iLCBwcm9qZWN0SWQpCiAgICAgICAgKTsKICAgICAgICBjb25zdCBxdWl6emVzU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHF1aXp6ZXNRdWVyeSk7CiAgICAgICAgY29uc3QgcXVpeklkcyA9IHF1aXp6ZXNTbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gZG9jLmlkKTsKCiAgICAgICAgbGV0IGNhbGN1bGF0ZWRUb3RhbFBvaW50cyA9IDA7CiAgICAgICAgY29uc3QgZmluYWxCYWRnZXNDb3VudCA9IHt9OwoKICAgICAgICAvLyDguYPguIrguYkgUHJvbWlzZS5hbGwg4LmA4Lie4Li34LmI4Lit4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lie4Lij4LmJ4Lit4Lih4LiB4Lix4LiZICjguYDguKPguYfguKfguIHguKfguYjguLIg4LmB4LiV4LmI4LmA4Liq4Li14LiiIFJlYWQg4LmA4LiX4LmI4Liy4LmA4LiU4Li04LihKQogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25Qcm9taXNlcyA9IHF1aXpJZHMubWFwKHF1aXpJZCA9PiAKICAgICAgICAgICAgZ2V0RG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2AsIHN0dWRlbnROYW1lKSkKICAgICAgICApOwogICAgICAgIAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25TbmFwcyA9IGF3YWl0IFByb21pc2UuYWxsKHN1Ym1pc3Npb25Qcm9taXNlcyk7CgogICAgICAgIHN1Ym1pc3Npb25TbmFwcy5mb3JFYWNoKGRvY1NuYXAgPT4gewogICAgICAgICAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICAgICAgLy8g4LmD4LiK4LmJIFBvaW50cyDguJfguLXguYjguJTguLXguJfguLXguYjguKrguLjguJTguILguK3guIfguYHguJXguYjguKXguLAgUXVpeiDguKHguLLguKPguKfguKHguIHguLHguJkKICAgICAgICAgICAgICAgIGNhbGN1bGF0ZWRUb3RhbFBvaW50cyArPSAoZGF0YS5wb2ludHMgfHwgMCk7CgogICAgICAgICAgICAgICAgLy8g4LiZ4Lix4LiaIEJhZGdlCiAgICAgICAgICAgICAgICBpZiAoZGF0YS5hdHRlbXB0cykgewogICAgICAgICAgICAgICAgICAgIGRhdGEuYXR0ZW1wdHMuZm9yRWFjaChhdHRlbXB0ID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGF0dGVtcHQuYmFkZ2VzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbXB0LmJhZGdlcy5mb3JFYWNoKGIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4meC4seC4muC5gOC4ieC4nuC4suC4sCBCYWRnZSDguJfguLXguYjguYTguJTguYnguIjguKPguLTguIfguYYg4LmE4Lih4LmI4LmD4LiK4LmI4LiZ4Lix4Lia4LiL4LmJ4Liz4LiL4LmJ4Lit4LiZICjguK3guLHguJnguJnguLXguYkgTG9naWMg4LmA4LiU4Li04Lih4LiC4Lit4LiH4LiE4Li44LiT4Lit4Liy4LiI4LiI4Liw4LiZ4Lix4Lia4LiL4LmJ4LizKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC5geC4leC5iOC5gOC4nuC4t+C5iOC4reC4hOC4p+C4suC4oeC4h+C5iOC4suC4oiDguYDguKPguLLguIjguLDguJnguLHguJrguKPguKfguKHguYTguJvguIHguYjguK3guJnguJXguLLguKEgTG9naWMg4LmA4LiU4Li04LihCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vICrguKvguKHguLLguKLguYDguKvguJXguLg6IExvZ2ljIOC4geC4suC4o+C4meC4seC4miBCYWRnZSDguYHguJrguJrguKXguLDguYDguK3guLXguKLguJTguK3guLLguIjguIvguLHguJrguIvguYnguK3guJkgCiAgICAgICAgICAgICAgICAgICAgLy8g4LmD4LiZ4LiX4Li14LmI4LiZ4Li14LmJ4LmA4Lij4Liy4LmA4LiZ4LmJ4LiZ4LmB4LiB4LmJ4LmA4Lij4Li34LmI4Lit4LiHIFRvdGFsIFBvaW50cyDguYPguKvguYnguJbguLnguIHguJXguYnguK3guIfguJfguLXguYjguKrguLjguJTguIHguYjguK3guJkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIC8vIOC4muC4seC4meC4l+C4tuC4geC4l+C4seC4muC4peC4h+C5hOC4m+C5gOC4peC4ogogICAgICAgIGF3YWl0IHNldERvYyhwcm9maWxlUmVmLCB7CiAgICAgICAgICAgIHN0dWRlbnROYW1lOiBzdHVkZW50TmFtZSwKICAgICAgICAgICAgdG90YWxQb2ludHM6IGNhbGN1bGF0ZWRUb3RhbFBvaW50cywKICAgICAgICAgICAgLy8gYmFkZ2VzQ291bnQ6IC4uLiAo4LiW4LmJ4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiE4Liz4LiZ4Lin4LiTIEJhZGdlIOC5g+C4q+C4oeC5iOC4leC5ieC4reC4h+C5gOC4guC4teC4ouC4mSBMb2dpYyDguKfguJnguKXguLnguJvguKXguLDguYDguK3guLXguKLguJTguIHguKfguYjguLLguJnguLXguYkpCiAgICAgICAgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlByb2ZpbGUgcmVjYWxjdWxhdGlvbiBlcnJvcjoiLCBlcnJvcik7CiAgICB9Cn0KCiAgICAgICAgZnVuY3Rpb24gc3RhcnRBZG1pblRlc3QoKSB7CiAgICAgICAgICAgIGlmICghY3VycmVudFF1aXpEYXRhKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Liq4Liz4Lir4Lij4Lix4Lia4LiX4LiU4Lil4Lit4LiHIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSwgZGVlcCBjb3B5IG9mIHRoZSBxdWl6IGRhdGEgZm9yIHRoZSB0ZXN0LgogICAgICAgICAgICAvLyBUaGlzIGNvcHkgYWxyZWFkeSBjb250YWlucyB0aGUgY29ycmVjdCBzZXR0aW5ncyBmcm9tIHRoZSBxdWl6IGl0c2VsZi4KICAgICAgICAgICAgbGV0IHRlc3RRdWl6RGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY3VycmVudFF1aXpEYXRhKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdXJyZW50TW9kZSA9ICdhZG1pbi10ZXN0aW5nJzsKICAgICAgICAgICAgY3VycmVudFN0dWRlbnROYW1lID0gJ+C4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oSAo4LiX4LiU4Liq4Lit4LiaKSc7CgogICAgICAgICAgICBhZG1pblZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBzdHVkZW50SW5pdGlhbFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnROYW1lU2VsZWN0aW9uVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHF1aXpTdGFydFRpbWUgPSBuZXcgRGF0ZSgpOyAvLyBSZWNvcmQgc3RhcnQgdGltZSBmb3IgYWRtaW4gdGVzdAogICAgICAgICAgICAvLyBQYXNzIHRoZSBxdWl6IGRhdGEgdG8gdGhlIGRpc3BsYXkgZnVuY3Rpb24uCiAgICAgICAgICAgIGRpc3BsYXlRdWl6Rm9yU3R1ZGVudCh0ZXN0UXVpekRhdGEpOwogICAgICAgIH0KCmZ1bmN0aW9uIGhhbmRsZVJlc3VsdERpc3BsYXkoZGlzcGxheVNldHRpbmcsIHNjb3JlLCBwb2ludHMsIGVhcm5lZEJhZGdlcywgZGV0YWlsZWRBbnN3ZXJzLCB0b3RhbFF1ZXN0aW9ucykgewogICAgaWYgKGRpc3BsYXlTZXR0aW5nID09PSAnbWFudWFsX3JlbGVhc2UnKSB7CiAgICAgICAgZGlzcGxheVN1Ym1pc3Npb25Db25maXJtYXRpb24oKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgcGFzc2luZ1Njb3JlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnBhc3NpbmdTY29yZSA/PyBNYXRoLmZsb29yKHRvdGFsUXVlc3Rpb25zIC8gMik7CiAgICBjb25zdCBpc0FkYXB0aXZlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LmlzQWRhcHRpdmUgPz8gZmFsc2U7CiAgICBjb25zdCBsb29wVW50aWxQYXNzRW5hYmxlZCA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5sb29wVW50aWxQYXNzID09PSB0cnVlOwogICAgY29uc3QgZGlkRmFpbCA9IHNjb3JlIDwgcGFzc2luZ1Njb3JlOwogICAgCiAgICAvLyAtLS0gWyDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4geC5iOC4reC4meC4p+C5iOC4siBkaXNwbGF5U2V0dGluZyDguYDguJvguYfguJnguKPguLnguJvguYHguJrguJrguYPguKvguKHguYjguKvguKPguLfguK3guYTguKHguYgKICAgIGNvbnN0IGlzTmV3RGlzcGxheU1vZGUgPSBkaXNwbGF5U2V0dGluZyA9PT0gJ2hhbGZfbWFya19zdGF0dXMnIHx8IGRpc3BsYXlTZXR0aW5nID09PSAncGVyZmVjdF9zY29yZV9zdGF0dXMnOwogICAgCiAgICAvLyAyLiDguYDguJ7guLTguYjguKHguYDguIfguLfguYjguK3guJnguYTguIIgIWlzTmV3RGlzcGxheU1vZGUg4LmA4LiC4LmJ4Liy4LmE4LibIOC5gOC4nuC4t+C5iOC4reC5hOC4oeC5iOC5g+C4q+C5ieC5guC4q+C4oeC4lOC4p+C4meC4peC4ueC4m+C4l+C4s+C4h+C4suC4meC4geC4seC4muC4o+C4ueC4m+C5geC4muC4muC5g+C4q+C4oeC5iAogICAgaWYgKGxvb3BVbnRpbFBhc3NFbmFibGVkICYmIGRpZEZhaWwgJiYgIWlzTmV3RGlzcGxheU1vZGUpIHsKICAgIC8vIC0tLSBbIOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4giBdIC0tLQogICAgICAgIGlmIChkaXNwbGF5U2V0dGluZyA9PT0gJ3Nob3dfcmVzdWx0c19hbmRfYW5zd2VycycpIHsKICAgICAgICAgICAgZGlzcGxheVJlc3VsdHNXaXRoQW5zd2VycyhzY29yZSwgcG9pbnRzLCBlYXJuZWRCYWRnZXMsIGRldGFpbGVkQW5zd2VycywgdG90YWxRdWVzdGlvbnMsIHRydWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRpc3BsYXlMb29wU2NyZWVuKHNjb3JlLCB0b3RhbFF1ZXN0aW9ucywgZGlzcGxheVNldHRpbmcpOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKGlzQWRhcHRpdmUgJiYgZGlkRmFpbCkgewogICAgICAgIHN0YXJ0QWRhcHRpdmVGbG93KGRldGFpbGVkQW5zd2Vycywgc2NvcmUsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8g4Liq4LmI4Lin4LiZIHN3aXRjaCBjYXNlIOC4l+C4teC5iOC5gOC4q+C4peC4t+C4reC4l+C4s+C4h+C4suC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oQogICAgc3dpdGNoIChkaXNwbGF5U2V0dGluZykgewogICAgICAgIGNhc2UgJ3Nob3dfcmVzdWx0c19hbmRfYW5zd2Vycyc6CiAgICAgICAgICAgIGRpc3BsYXlSZXN1bHRzV2l0aEFuc3dlcnMoc2NvcmUsIHBvaW50cywgZWFybmVkQmFkZ2VzLCBkZXRhaWxlZEFuc3dlcnMsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2hvd19yZXN1bHRzX29ubHknOgogICAgICAgICAgICBkaXNwbGF5UmVzdWx0c1Njb3JlT25seShzY29yZSwgcG9pbnRzLCBlYXJuZWRCYWRnZXMsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2hvd19wYXNzX2ZhaWxfb25seSc6CiAgICAgICAgICAgIGRpc3BsYXlQYXNzRmFpbE9ubHkoc2NvcmUsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnaGFsZl9tYXJrX3N0YXR1cyc6CiAgICAgICAgICAgIGRpc3BsYXlIYWxmTWFya1Jlc3VsdChzY29yZSwgdG90YWxRdWVzdGlvbnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwZXJmZWN0X3Njb3JlX3N0YXR1cyc6CiAgICAgICAgICAgIGRpc3BsYXlQZXJmZWN0U2NvcmVSZXN1bHQoc2NvcmUsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgZGlzcGxheVN1Ym1pc3Npb25Db25maXJtYXRpb24oKTsKICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUmVtZWRpYWxRdWl6KHdlYWtuZXNzRXhwbGFuYXRpb25zKSB7CiAgICAvLyDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguYLguKvguKXguJTguYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguJfguKPguLLguJoKICAgIHN0dWRlbnRSZWFkaW5nQXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2PgogICAgICAgICAgICA8cCBjbGFzcz0ibXQtNCB0ZXh0LWdyYXktNjAwIj7guYDguKLguLXguYjguKLguKHguYDguKXguKIhIEFJIOC4geC4s+C4peC4seC4h+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4iuC4uOC4lOC5g+C4q+C4oeC5iOC5gOC4nuC4t+C5iOC4reC4l+C4muC4l+C4p+C4meC4hOC4p+C4suC4oeC5gOC4guC5ieC4suC5g+C4iC4uLjwvcD4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgLy8gMS4g4Liq4Lij4LmJ4Liy4LiHIFByb21wdCDguYDguJ7guLfguYjguK3guYPguKvguYkgQUkg4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiL4LmI4Lit4LihCiAgICBjb25zdCByZW1lZGlhbFF1aXpQcm9tcHQgPSBgCiAgICAgICAg4LiI4Liy4LiB4Lir4Lix4Lin4LiC4LmJ4Lit4LmA4Lir4Lil4LmI4Liy4LiZ4Li14LmJ4LiX4Li14LmI4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lii4Lix4LiH4LmE4Lih4LmI4LmA4LiC4LmJ4Liy4LmD4LiIOgogICAgICAgICR7d2Vha25lc3NFeHBsYW5hdGlvbnN9CgogICAgICAgIOC5guC4m+C4o+C4lOC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4m+C4o+C4meC4seC4ouC4iuC4uOC4lOC5g+C4q+C4oeC5iOC4iOC4s+C4meC4p+C4mSAyIOC4guC5ieC4rSDguYDguJ7guLfguYjguK3guJfguJTguKrguK3guJrguITguKfguLLguKHguYDguILguYnguLLguYPguIjguYPguJnguKvguLHguKfguILguYnguK3guYDguKvguKXguYjguLLguJnguLXguYnguYLguJTguKLguYDguInguJ7guLLguLAKICAgICAgICDguYHguJXguYjguKXguLDguILguYnguK3guJXguYnguK3guIfguKHguLUgNCDguJXguLHguKfguYDguKXguLfguK3guIEsIOC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hywg4LmB4Lil4Liw4LiE4Liz4Lit4LiY4Li04Lia4Liy4Lii4Liq4Lix4LmJ4LiZ4LmGCgogICAgICAgIOC5g+C4q+C5ieC4nOC4peC4peC4seC4nuC4mOC5jOC5gOC4m+C5h+C4mSBKU09OIG9iamVjdCDguJfguLXguYjguKHguLXguYLguITguKPguIfguKrguKPguYnguLLguIfguJTguLHguIfguJnguLXguYk6CiAgICAgICAgLSB0b3BpYzogKHN0cmluZykg4LiV4Lix4LmJ4LiH4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4Lit4Lin4LmI4LiyICLguYHguJrguJrguJfguJTguKrguK3guJrguIvguYjguK3guKHguYDguKrguKPguLTguKEiCiAgICAgICAgLSBxdWVzdGlvbnM6IChhcnJheSBvZiBvYmplY3RzKSDguYLguJTguKLguYHguJXguYjguKXguLAgb2JqZWN0IOC4oeC4tToKICAgICAgICAgIC0gcXVlc3Rpb25UZXh0OiAoc3RyaW5nKQogICAgICAgICAgLSBvcHRpb25zOiAoYXJyYXkgb2YgNCBzdHJpbmdzKQogICAgICAgICAgLSBjb3JyZWN0QW5zd2VySW5kZXg6IChudW1iZXIpCiAgICAgICAgICAtIGV4cGxhbmF0aW9uOiAoc3RyaW5nKQoJCSAgJHtzaW1wbGVNYXRoUHJvbXB0fQogICAgYDsKCiAgICAvLyAyLiDguIHguLPguKvguJnguJQgU2NoZW1hIOC4quC4s+C4q+C4o+C4seC4muC4geC4suC4o+C4quC4o+C5ieC4suC4h+C4guC5ieC4reC4quC4reC4miAo4LmD4LiK4LmJIG1jcVNjaGVtYSDguJfguLXguYjguKHguLXguK3guKLguLnguYjguYHguKXguYnguKfguYTguJTguYkpCiAgICBjb25zdCBtY3FTY2hlbWEgPSB7CiAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICBxdWVzdGlvblRleHQ6IHsgdHlwZTogIlNUUklORyIgfSwKICAgICAgICAgICAgb3B0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sCiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJJbmRleDogeyB0eXBlOiAiTlVNQkVSIiB9LAogICAgICAgICAgICBleHBsYW5hdGlvbjogeyB0eXBlOiAiU1RSSU5HIiB9CiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogWyJxdWVzdGlvblRleHQiLCAib3B0aW9ucyIsICJjb3JyZWN0QW5zd2VySW5kZXgiLCAiZXhwbGFuYXRpb24iXQogICAgfTsKCiAgICBjb25zdCByZW1lZGlhbFF1aXpTY2hlbWEgPSB7CiAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICB0b3BpYzogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICBxdWVzdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IG1jcVNjaGVtYSB9CiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogWyJ0b3BpYyIsICJxdWVzdGlvbnMiXQogICAgfTsKCiAgICB0cnkgewogICAgICAgIC8vIDMuIOC5gOC4o+C4teC4ouC4gSBBUEkg4LmA4Lie4Li34LmI4Lit4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiL4LmI4Lit4LihCiAgICAgICAgLy8g4LmA4Lij4Liy4LiI4Liw4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGhhbmRsZUFwaUNhbGwg4LiX4Li14LmI4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC5geC4leC5iOC4quC5iOC4hyBQcm9tcHQg4LmB4Lil4LiwIFNjaGVtYSDguYPguKvguKHguYjguYDguILguYnguLLguYTguJsKICAgICAgICAvLyDguYHguKXguLDguYDguJnguLfguYjguK3guIfguIjguLLguIHguYDguKPguLLguYTguKHguYjguJXguYnguK3guIfguIHguLLguKPguYPguKvguYnguJzguKXguKXguLHguJ7guJjguYzguYTguJvguYHguKrguJTguIfguYPguJnguKrguYjguKfguJnguILguK3guIfguJzguLnguYnguITguKfguJrguITguLjguKEgKGFkbWluKSDguYDguKPguLLguIjguLbguIfguJXguYnguK3guIfguIjguLHguJTguIHguLLguKPguYDguK3guIcKICAgICAgICBjb25zdCByZW1lZGlhbFF1aXpEYXRhID0gYXdhaXQgY2FsbEFuYWx5c2lzQXBpKHJlbWVkaWFsUXVpelByb21wdCwgcmVtZWRpYWxRdWl6U2NoZW1hKTsKICAgICAgICByZW1lZGlhbFF1aXpEYXRhLmlzUmVtZWRpYWwgPSB0cnVlOwoKICAgICAgICAvLyA0LiDguYDguKHguLfguYjguK3guYTguJTguYnguILguYnguK3guKrguK3guJrguIrguLjguJTguYPguKvguKHguYjguKHguLLguYHguKXguYnguKcg4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lic4Lil4LmD4Lir4LmJ4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4LizCiAgICAgICAgc3R1ZGVudFJlYWRpbmdBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKrguYjguKfguJnguILguK3guIfguYDguJnguLfguYnguK3guKvguLLguJfguJrguJfguKfguJkKICAgICAgICAKICAgICAgICAvLyDguYDguKPguLLguJXguYnguK3guIfguYHguJnguYjguYPguIjguKfguYjguLLguILguYnguK3guKrguK3guJrguIvguYjguK3guKHguJnguLXguYnguKHguLUgc2V0dGluZ3Mg4LiX4Li14LmI4LmA4Lir4Lih4Liy4Liw4Liq4LihCiAgICAgICAgLy8g4LmC4LiU4Lii4Lit4Liy4LiI4LiI4Liw4LiE4Lix4LiU4Lil4Lit4LiBIHNldHRpbmdzIOC4muC4suC4h+C4reC4ouC5iOC4suC4h+C4oeC4suC4iOC4suC4geC4guC5ieC4reC4quC4reC4muC5gOC4lOC4tOC4oSDguYHguJXguYjguJvguLTguJTguYLguKvguKHguJQgYWRhcHRpdmUg4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4Lin4LiZ4LiL4LmJ4LizCiAgICAgICAgY29uc3QgbmV3UXVpelNldHRpbmdzID0gewogICAgICAgICAgICAuLi5jdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncywKICAgICAgICAgICAgaXNBZGFwdGl2ZTogZmFsc2UsIC8vIOC4m+C4tOC4lOC5guC4q+C4oeC4lOC4m+C4o+C4seC4muC4nuC4t+C5ieC4meC4kOC4suC4meC4quC4s+C4q+C4o+C4seC4muC4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oQogICAgICAgICAgICByZXN1bHRzRGlzcGxheTogJ3Nob3dfcmVzdWx0c19hbmRfYW5zd2VycycgLy8g4Lia4Lix4LiH4LiE4Lix4Lia4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4LmA4LiJ4Lil4Lii4Lir4Lil4Lix4LiH4LiX4Liz4LmA4Liq4Lij4LmH4LiICiAgICAgICAgfTsKICAgICAgICByZW1lZGlhbFF1aXpEYXRhLnNldHRpbmdzID0gbmV3UXVpelNldHRpbmdzOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4o+C4tOC5iOC4oeC4l+C4s+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oQogICAgICAgIGRpc3BsYXlRdWl6Rm9yU3R1ZGVudChyZW1lZGlhbFF1aXpEYXRhKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlbWVkaWFsIHF1aXogZ2VuZXJhdGlvbiBmYWlsZWQ6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguIvguYjguK3guKHguYDguKrguKPguLTguKEiKTsKICAgICAgICAvLyDguKvguLLguIHguKXguYnguKHguYDguKvguKXguKcg4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4Liy4LmB4Lij4LiBCiAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgIH0KfQoKZnVuY3Rpb24gZGlzcGxheVBhc3NGYWlsT25seShzY29yZSwgdG90YWxRdWVzdGlvbnMpIHsKICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gLTE7CiAgICBjb25zdCBpc1JlbWVkaWFsUXVpeiA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LmlzUmVtZWRpYWwgPT09IHRydWU7CiAgICBsZXQgcGFzc0ZhaWxIVE1MID0gJyc7CiAgICBsZXQgaXNQYXNzID0gZmFsc2U7CgogICAgaWYgKGlzUmVtZWRpYWxRdWl6IHx8IHBhc3NpbmdTY29yZSAhPT0gLTEpIHsKICAgICAgICBpc1Bhc3MgPSBpc1JlbWVkaWFsUXVpeiA/IChzY29yZSA9PT0gdG90YWxRdWVzdGlvbnMpIDogKHNjb3JlID49IHBhc3NpbmdTY29yZSk7CiAgICAgICAgY29uc3QgcmVzdWx0Q2xhc3MgPSBpc1Bhc3MgPyAnYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1yZWQtMTAwIHRleHQtcmVkLTgwMCc7CiAgICAgICAgY29uc3QgcmVzdWx0VGV4dCA9IGlzUGFzcyA/ICfguJzguYjguLLguJknIDogJ+C5hOC4oeC5iOC4nOC5iOC4suC4mSc7CiAgICAgICAgcGFzc0ZhaWxIVE1MID0gYDxkaXYgY2xhc3M9Im15LTQiPjxzcGFuIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgcHgtNiBweS0yIHJvdW5kZWQtZnVsbCBpbmxpbmUtYmxvY2sgJHtyZXN1bHRDbGFzc30iPiR7cmVzdWx0VGV4dH08L3NwYW4+PC9kaXY+YDsKICAgIH0gZWxzZSB7CiAgICAgICAgcGFzc0ZhaWxIVE1MID0gYDxwIGNsYXNzPSJtdC00IHRleHQtZ3JheS02MDAiPijguYTguKHguYjguYTguJTguYnguJXguLHguYnguIfguITguYjguLLguYDguIHguJPguJHguYzguJzguYjguLLguJnguKrguLPguKvguKPguLHguJrguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYkpPC9wPmA7CiAgICB9CgogICAgbGV0IHJlc3VsdEhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04IGJnLWluZGlnby0xMDAgcm91bmRlZC1sZyI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYXdhcmQgdGV4dC01eGwgdGV4dC1pbmRpZ28tNTAwIG1iLTQiPjwvaT4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS02MDAgbWItMiI+4Lic4Li54LmJ4LmA4LiC4LmJ4Liy4Liq4Lit4LiaOiA8c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWluZGlnby04MDAiPiR7Y3VycmVudFN0dWRlbnROYW1lfTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtaW5kaWdvLTgwMCBtYi0yIj7guKrguYjguIfguITguLPguJXguK3guJrguYDguKPguLXguKLguJrguKPguYnguK3guKLguYHguKXguYnguKc8L2gzPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTcwMCBtYi0yIj7guJzguKXguIHguLLguKPguJfguJTguKrguK3guJrguILguK3guIfguITguLjguJPguITguLfguK06PC9wPgogICAgICAgICAgICAke3Bhc3NGYWlsSFRNTH0KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSByZXN1bHRIVE1MOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBzdHVkZW50UXVpekFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAKICAgIHNldHVwUmVzdWx0U2NyZWVuQmFja0J1dHRvbih7IHNob3dSYW5raW5nczogdHJ1ZSwgc2hvd0ltcHJvdmVCdXR0b246ICFpc1Bhc3MgfSk7Cn0KCi8vIC0tLSDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgY2FuY2VsQWRtaW5UZXN0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KZnVuY3Rpb24gY2FuY2VsQWRtaW5UZXN0KCkgewogICAgaWYgKHF1aXpUaW1lckludGVydmFsKSBjbGVhckludGVydmFsKHF1aXpUaW1lckludGVydmFsKTsKICAgIGlmIChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwocGVyUXVlc3Rpb25UaW1lckludGVydmFsKTsKCQkJCglyZWxlYXNlV2FrZUxvY2soKTsKCXN0b3BEaW1UaW1lcigpOwoJZXhpdEZ1bGxzY3JlZW4oKTsKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKTsKICAgICAgICAgICAgCiAgICBjdXJyZW50TW9kZSA9ICdhZG1pbic7IC8vIFJlc2V0IG1vZGUKICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgYWRtaW5WaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4nuC4tOC5iOC4oeC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5gOC4nuC4t+C5iOC4reC4leC4o+C4p+C4iOC4quC4reC4miAi4LiE4Lin4Liy4Lih4LiI4LizIgogICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSBmYWxzZTsgLy8g4Lil4LmJ4Liy4LiH4LiE4Lin4Liy4Lih4LiI4LizCiAgICB9IGVsc2UgewogICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOyAvLyDguJfguLPguIfguLLguJnguJXguLLguKHguJvguIHguJXguLQKICAgIH0KfQoKZnVuY3Rpb24gc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKG9wdGlvbnMpIHsKICAgIC8vIOC4geC4s+C4q+C4meC4lOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mQogICAgY29uc3QgY29uZmlnID0gewogICAgICAgIGlzTG9vcGluZzogZmFsc2UsCiAgICAgICAgc2NvcmU6IDAsCiAgICAgICAgdG90YWxRdWVzdGlvbnM6IDEsCiAgICAgICAgc2hvd1JhbmtpbmdzOiB0cnVlLCAvLyDguYHguKrguJTguIfguJvguLjguYjguKHguK3guLHguJnguJTguLHguJrguYDguJvguYfguJnguITguYjguLLguYDguKPguLTguYjguKHguJXguYnguJkKICAgICAgICBzaG93SW1wcm92ZUJ1dHRvbjogdW5kZWZpbmVkLCAvLyB1bmRlZmluZWQg4Lir4Lih4Liy4Lii4LiW4Li24LiH4LmD4Lir4LmJ4LiV4Lix4LiU4Liq4Li04LiZ4LmD4LiI4LiI4Liy4LiBIHNjb3JlCiAgICAgICAgLi4ub3B0aW9ucyAKICAgIH07CgogICAgaWYgKGNvbmZpZy5pc0xvb3BpbmcpIHsKICAgICAgICBjb25zdCBidXR0b25IVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC02IHB0LTYgYm9yZGVyLXQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTQgdy1mdWxsIG1heC13LW1kIG14LWF1dG8iPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0icmV0YWtlLXF1aXotbG9vcC1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctcmVkLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctcmVkLTcwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgd2hpdGVzcGFjZS1ub3dyYXAiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcmVkby1hbHQgbXItMiI+PC9pPuC4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC4reC4teC4geC4hOC4o+C4seC5ieC4hwogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBidXR0b25IVE1MKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV0YWtlLXF1aXotbG9vcC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIHF1aXpTdGFydFRpbWUgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgICBkaXNwbGF5UXVpekZvclN0dWRlbnQoY3VycmVudFF1aXpEYXRhKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgYmFja0J1dHRvbklkID0gJ2JhY2stZnJvbS1yZXN1bHRzLWJ0bic7CiAgICBjb25zdCBpc1Rlc3RpbmcgPSBjdXJyZW50TW9kZSA9PT0gJ2FkbWluLXRlc3RpbmcnOwogICAgY29uc3QgYmFja0J1dHRvblRleHQgPSBpc1Rlc3RpbmcgPyAnPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1sZWZ0IG1yLTIiPjwvaT7guIHguKXguLHguJrguYTguJvguKvguJnguYnguLLguIjguLHguJTguIHguLLguKMnIDogJzxpIGNsYXNzPSJmYXMgZmEtaG9tZSBtci0yIj48L2k+4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4LmB4Lij4LiBJzsKICAgIAogICAgbGV0IGJ1dHRvbnNIVE1MID0gJyc7CgogICAgLy8g4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCOiDguYHguKrguJTguIfguJvguLjguYjguKEgIuC4lOC4ueC4reC4seC4meC4lOC4seC4miIKICAgIGlmIChjb25maWcuc2hvd1JhbmtpbmdzKSB7CiAgICAgICAgYnV0dG9uc0hUTUwgKz0gYDxidXR0b24gaWQ9InZpZXctcmFua2luZ3MtYnRuIiBjbGFzcz0idy1mdWxsIHNtOnctYXV0byBmbGV4LTEgYmcteWVsbG93LTUwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmcteWVsbG93LTYwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiB3aGl0ZXNwYWNlLW5vd3JhcCI+PGkgY2xhc3M9ImZhcyBmYS10cm9waHkiPjwvaT7guJTguLnguK3guLHguJnguJTguLHguJo8L2J1dHRvbj5gOwogICAgfQoKICAgIC8vIOC5gOC4h+C4t+C5iOC4reC4meC5hOC4gjog4LmB4Liq4LiU4LiH4Lib4Li44LmI4LihICLguJvguKPguLHguJrguJvguKPguLjguIfguITguLDguYHguJnguJkiCiAgICBsZXQgc2hvdWxkU2hvd0ltcHJvdmUgPSBjb25maWcuc2hvd0ltcHJvdmVCdXR0b247CiAgICBpZiAoc2hvdWxkU2hvd0ltcHJvdmUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHNob3VsZFNob3dJbXByb3ZlID0gY29uZmlnLnNjb3JlIDwgY29uZmlnLnRvdGFsUXVlc3Rpb25zOwogICAgfQoKICAgIGlmIChzaG91bGRTaG93SW1wcm92ZSkgewogICAgICAgICBidXR0b25zSFRNTCArPSBgPGJ1dHRvbiBpZD0icmV0YWtlLWZvci1pbXByb3ZlbWVudC1idG4iIGNsYXNzPSJ3LWZ1bGwgc206dy1hdXRvIGZsZXgtMSBiZy1vcmFuZ2UtNTAwIHRleHQtd2hpdGUgcHktMyBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1vcmFuZ2UtNjAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwIj48aSBjbGFzcz0iZmFzIGZhLXJlZG8tYWx0Ij48L2k+4Lib4Lij4Lix4Lia4Lib4Lij4Li44LiH4LiE4Liw4LmB4LiZ4LiZPC9idXR0b24+YDsKICAgIH0KICAgIAogICAgLy8g4Lib4Li44LmI4LihICLguIHguKXguLHguJoiICjguKHguLXguYDguKrguKHguK0pCiAgICBidXR0b25zSFRNTCArPSBgPGJ1dHRvbiBpZD0iJHtiYWNrQnV0dG9uSWR9IiBjbGFzcz0idy1mdWxsIHNtOnctYXV0byBmbGV4LTEgYmctYmx1ZS02MDAgdGV4dC13aGl0ZSBweS0zIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLWJsdWUtNzAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwIj4ke2JhY2tCdXR0b25UZXh0fTwvYnV0dG9uPmA7CgogICAgY29uc3QgZmluYWxDb250YWluZXJIVE1MID0gYDxkaXYgY2xhc3M9Im10LTYgcHQtNiBib3JkZXItdCBmbGV4IGZsZXgtY29sIHNtOmZsZXgtcm93IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCB3LWZ1bGwgbWF4LXctbGcgbXgtYXV0byI+JHtidXR0b25zSFRNTH08L2Rpdj5gOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBmaW5hbENvbnRhaW5lckhUTUwpOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lcnMKICAgIHN0dWRlbnRSZXN1bHRBcmVhLnF1ZXJ5U2VsZWN0b3IoJyN2aWV3LXJhbmtpbmdzLWJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNob3dTdHVkZW50UmFua2luZ3MpOwogICAgCiAgICBjb25zdCByZXRha2VCdG4gPSBzdHVkZW50UmVzdWx0QXJlYS5xdWVyeVNlbGVjdG9yKCcjcmV0YWtlLWZvci1pbXByb3ZlbWVudC1idG4nKTsKICAgIGlmIChyZXRha2VCdG4pIHsKICAgICAgICAgcmV0YWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGRpc3BsYXlRdWl6Rm9yU3R1ZGVudChjdXJyZW50UXVpekRhdGEpOwogICAgICAgIH0pOwogICAgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJhY2tCdXR0b25JZCkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWYgKGlzVGVzdGluZykgewogICAgICAgICAgICBjdXJyZW50TW9kZSA9ICdhZG1pbic7CiAgICAgICAgICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBhZG1pblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWlkLWlucHV0JykudmFsdWUgPSAnJzsKICAgICAgICB9CiAgICB9KTsKfQoKIGZ1bmN0aW9uIGRpc3BsYXlSZXN1bHRzV2l0aEFuc3dlcnMoc2NvcmUsIHBvaW50cywgZWFybmVkQmFkZ2VzLCBkZXRhaWxlZEFuc3dlcnMsIHRvdGFsUXVlc3Rpb25zLCBpc0xvb3BpbmcgPSBmYWxzZSkgewogICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsUXVlc3Rpb25zID4gMCA/IChzY29yZSAvIHRvdGFsUXVlc3Rpb25zKSAqIDEwMCA6IDA7CiAgICBjb25zdCBwYXNzaW5nU2NvcmUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IC0xOwogICAgY29uc3QgaXNSZW1lZGlhbFF1aXogPSBjdXJyZW50RGlzcGxheWVkUXVpei5pc1JlbWVkaWFsID09PSB0cnVlOwogICAgbGV0IHBhc3NGYWlsSFRNTCA9ICcnOwoKICAgIGlmIChpc1JlbWVkaWFsUXVpeiB8fCBwYXNzaW5nU2NvcmUgIT09IC0xKSB7CiAgICAgICAgbGV0IGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHNjb3JlID09PSB0b3RhbFF1ZXN0aW9ucykgOiAoc2NvcmUgPj0gcGFzc2luZ1Njb3JlKTsKICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gaXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJzsKICAgICAgICBwYXNzRmFpbEhUTUwgPSBgPHAgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtdC0yIHB4LTQgcHktMSByb3VuZGVkLWZ1bGwgaW5saW5lLWJsb2NrICR7cmVzdWx0Q2xhc3N9Ij4ke3Jlc3VsdFRleHR9PC9wPmA7CiAgICB9CiAgICAKICAgIGxldCByZXN1bHRIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtNiBiZy1pbmRpZ28tMTAwIHJvdW5kZWQtbGcgbWItNiI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIG1iLTIiPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjogPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tODAwIj4ke2N1cnJlbnRTdHVkZW50TmFtZX08L3NwYW4+PC9wPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXB1cnBsZS03MDAgbWItMiI+4Lic4Lil4LiB4Liy4Lij4LiX4LiU4Liq4Lit4LiaPC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBteS0yIj4ke3Njb3JlfSA8c3BhbiBjbGFzcz0idGV4dC14bCBmb250LW5vcm1hbCB0ZXh0LWdyYXktNjAwIj4vICR7dG90YWxRdWVzdGlvbnN9PC9zcGFuPjwvcD4KICAgICAgICAgICAgJHtwYXNzRmFpbEhUTUx9CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTYwMCBtdC0yIj4rJHtwb2ludHN9IFBvaW50czwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbWQiPuC4hOC4uOC4k+C5hOC4lOC5ieC4hOC4sOC5geC4meC4mSAke3BlcmNlbnRhZ2UudG9GaXhlZCgwKX0lPC9wPgogICAgICAgICAgICA8ZGl2IGlkPSJlYXJuZWQtYmFkZ2VzLWNvbnRhaW5lciIgY2xhc3M9Im10LTQgZmxleCBqdXN0aWZ5LWNlbnRlciBnYXAtNCBmbGV4LXdyYXAiPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxoNCBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItNCI+4LiX4Lia4LiX4Lin4LiZ4LiE4Liz4LiV4Lit4LiaPC9oND4KICAgIGA7CiAgICAKICAgIGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5mb3JFYWNoKChxLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IGRldGFpbGVkQW5zd2VyID0gZGV0YWlsZWRBbnN3ZXJzW2luZGV4XTsKICAgICAgICBjb25zdCB1c2VyQW5zd2VyID0gZGV0YWlsZWRBbnN3ZXIuYW5zd2VyOwogICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IGRldGFpbGVkQW5zd2VyLmlzQ29ycmVjdDsKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50RGlzcGxheWVkUXVpei5xdWl6VHlwZTsKCiAgICAgICAgcmVzdWx0SFRNTCArPSBgPGRpdiBjbGFzcz0ibWItNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgJHtpc0NvcnJlY3QgPyAnYm9yZGVyLWdyZWVuLTMwMCBiZy1ncmVlbi01MCcgOiAnYm9yZGVyLXJlZC0zMDAgYmctcmVkLTUwJ30iPjxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke2luZGV4ICsgMX0uICR7cS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0fTwvcD48ZGl2IGNsYXNzPSJtdC0zIHNwYWNlLXktMiB0ZXh0LXNtIj5gOwogICAgICAgIAogICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgICAgICBjb25zdCB1c2VyUmVzcG9uc2VUZXh0ID0gdXNlckFuc3dlciB8fCAn4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lit4LiaJzsKICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RSZXNwb25zZVRleHQgPSBxLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxwPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTOjwvc3Ryb25nPiA8c3BhbiBjbGFzcz0iJHshaXNDb3JyZWN0ID8gJ2xpbmUtdGhyb3VnaCB0ZXh0LXJlZC03MDAnIDogJyd9Ij4ke3VzZXJSZXNwb25zZVRleHR9PC9zcGFuPjwvcD5gOwogICAgICAgICAgICAgICAgaWYgKCFpc0NvcnJlY3QpIHsgcmVzdWx0SFRNTCArPSBgPHAgY2xhc3M9InRleHQtZ3JlZW4tNzAwIj48c3Ryb25nPuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hzo8L3N0cm9uZz4gJHtjb3JyZWN0UmVzcG9uc2VUZXh0fTwvcD5gOyB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vID09PSBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguJ7guLTguYjguKHguYDguITguKogZmlsbF9pbl9ub19jaG9pY2VzIOC5g+C4q+C5ieC5geC4quC4lOC4h+C4nOC4peC5geC4muC4muC5gOC4leC4tOC4oeC4hOC4syA9PT0KICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzoKICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxwPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTOjwvc3Ryb25nPiAke3VzZXJBbnN3ZXIgfHwgJ+C5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4mid9PC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHRIVE1MICs9IGA8cCBjbGFzcz0idGV4dC1ncmVlbi03MDAiPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmA4Lir4Lih4Liy4Liw4Liq4LihOjwvc3Ryb25nPiAke3EuaWRlYWxBbnN3ZXJ9PC9wPmA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgcmVzdWx0SFRNTCArPSBgPHAgY2xhc3M9IiR7cS5jb3JyZWN0QW5zd2VyID09PSB0cnVlID8gJ2ZvbnQtYm9sZCB0ZXh0LWdyZWVuLTcwMCcgOiAnJ30gJHt1c2VyQW5zd2VyID09PSAndHJ1ZScgJiYgIWlzQ29ycmVjdCA/ICdsaW5lLXRocm91Z2ggdGV4dC1yZWQtNzAwJyA6ICcnfSI+4LmD4LiK4LmIPC9wPmA7CiAgICAgICAgICAgICAgICByZXN1bHRIVE1MICs9IGA8cCBjbGFzcz0iJHtxLmNvcnJlY3RBbnN3ZXIgPT09IGZhbHNlID8gJ2ZvbnQtYm9sZCB0ZXh0LWdyZWVuLTcwMCcgOiAnJ30gJHt1c2VyQW5zd2VyID09PSAnZmFsc2UnICYmICFpc0NvcnJlY3QgPyAnbGluZS10aHJvdWdoIHRleHQtcmVkLTcwMCcgOiAnJ30iPuC5hOC4oeC5iOC5g+C4iuC5iDwvcD5gOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIAogICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICBjYXNlICdmaWxsX2luX3dpdGhfY2hvaWNlcyc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAocS5vcHRpb25zICYmIEFycmF5LmlzQXJyYXkocS5vcHRpb25zKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gcS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzdHlsZSA9ICcnOyBsZXQgaWNvbiA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PT0gcS5jb3JyZWN0QW5zd2VySW5kZXgpIHsgc3R5bGUgPSAnZm9udC1ib2xkIHRleHQtZ3JlZW4tNzAwJzsgaWNvbiA9ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSBtci0yIHRleHQtZ3JlZW4tNjAwIj48L2k+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpID09PSB1c2VyQW5zd2VyKSB7IHN0eWxlID0gJ2ZvbnQtYm9sZCB0ZXh0LXJlZC03MDAgbGluZS10aHJvdWdoJzsgaWNvbiA9ICc8aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSBtci0yIHRleHQtcmVkLTYwMCI+PC9pPic7IH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSIke3N0eWxlfSI+JHtpY29ufSR7b3B0fTwvZGl2PmA7IH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayDguIHguKPguJPguLXguILguYnguK3guKHguLnguKXguJzguLTguJTguJ7guKXguLLguJQgKOC5gOC4iuC5iOC4mSB0eXBlIOC4nOC4tOC4lCDguYHguKXguLDguYTguKHguYjguKHguLUgb3B0aW9ucykKICAgICAgICAgICAgICAgICAgICByZXN1bHRIVE1MICs9IGA8cD48c3Ryb25nPuC4hOC4s+C4leC4reC4muC4guC4reC4h+C4hOC4uOC4kzo8L3N0cm9uZz4gJHt1c2VyQW5zd2VyIHx8ICfguYTguKHguYjguYTguJTguYnguJXguK3guJonfTwvcD5gOwogICAgICAgICAgICAgICAgICAgIGlmICghaXNDb3JyZWN0KSByZXN1bHRIVE1MICs9IGA8cCBjbGFzcz0idGV4dC1ncmVlbi03MDAiPjxzdHJvbmc+KOC5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4leC4seC4p+C5gOC4peC4t+C4reC4gSk8L3N0cm9uZz48L3A+YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAKICAgICAgICByZXN1bHRIVE1MICs9IGA8L2Rpdj48ZGl2IGNsYXNzPSJtdC0zIHAtMyBiZy1ibHVlLTUwIGJvcmRlci1sLTQgYm9yZGVyLWJsdWUtNDAwIHRleHQtc20iPjxzdHJvbmcgY2xhc3M9InRleHQtYmx1ZS04MDAiPuC4hOC4s+C4reC4mOC4tOC4muC4suC4ojo8L3N0cm9uZz4gJHtxLmV4cGxhbmF0aW9uIHx8ICfguYTguKHguYjguKHguLXguITguLPguK3guJjguLTguJrguLLguKInfTwvZGl2PmA7CiAgICAgICAgaWYgKCFpc0NvcnJlY3QpIHsKICAgICAgICAgICAgY29uc3QgcHJhY3RpY2VUb3BpYyA9IHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dDsKICAgICAgICAgICAgcmVzdWx0SFRNTCArPSBgPGRpdiBjbGFzcz0ibXQtMyB0ZXh0LXJpZ2h0Ij48YnV0dG9uIGNsYXNzPSJwcmFjdGljZS10b3BpYy1idG4gYmcteWVsbG93LTUwMCB0ZXh0LXdoaXRlIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctNjAwIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIG1sLWF1dG8iIGRhdGEtdG9waWM9IiR7ZXNjYXBlKHByYWN0aWNlVG9waWMpfSI+PGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0Ij48L2k+IOC4neC4tuC4geC4neC4meC5gOC4o+C4t+C5iOC4reC4h+C4meC4teC5ieC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgfQogICAgICAgIHJlc3VsdEhUTUwgKz0gYDwvZGl2PmA7CiAgICB9KTsKICAgCiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSByZXN1bHRIVE1MOwogICAgcmVuZGVyRWFybmVkQmFkZ2VzKGVhcm5lZEJhZGdlcywgJ2Vhcm5lZC1iYWRnZXMtY29udGFpbmVyJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgaXNMb29waW5nLCBzY29yZSwgdG90YWxRdWVzdGlvbnMsIHNob3dSYW5raW5nczogdHJ1ZSB9KTsKICAgIAogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB3aW5kb3cuTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFJlc3VsdEFyZWFdKTsKfQoKZnVuY3Rpb24gZGlzcGxheVJlc3VsdHNTY29yZU9ubHkoc2NvcmUsIHBvaW50cywgZWFybmVkQmFkZ2VzLCB0b3RhbFF1ZXN0aW9ucykgewogICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsUXVlc3Rpb25zID4gMCA/IChzY29yZSAvIHRvdGFsUXVlc3Rpb25zKSAqIDEwMCA6IDA7CiAgICBjb25zdCBwYXNzaW5nU2NvcmUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IC0xOwogICAgY29uc3QgaXNSZW1lZGlhbFF1aXogPSBjdXJyZW50RGlzcGxheWVkUXVpei5pc1JlbWVkaWFsID09PSB0cnVlOwogICAgbGV0IHBhc3NGYWlsSFRNTCA9ICcnOwoKICAgIGlmIChpc1JlbWVkaWFsUXVpeiB8fCBwYXNzaW5nU2NvcmUgIT09IC0xKSB7CiAgICAgICAgbGV0IGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHNjb3JlID09PSB0b3RhbFF1ZXN0aW9ucykgOiAoc2NvcmUgPj0gcGFzc2luZ1Njb3JlKTsKICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gaXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJzsKICAgICAgICBwYXNzRmFpbEhUTUwgPSBgPHAgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtdC0yIHB4LTQgcHktMSByb3VuZGVkLWZ1bGwgaW5saW5lLWJsb2NrICR7cmVzdWx0Q2xhc3N9Ij4ke3Jlc3VsdFRleHR9PC9wPmA7CiAgICB9CiAgICAKICAgIGxldCByZXN1bHRIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy1pbmRpZ28tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWF3YXJkIHRleHQtNXhsIHRleHQtaW5kaWdvLTUwMCBtYi00Ij48L2k+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIG1iLTIiPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjogPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tODAwIj4ke2N1cnJlbnRTdHVkZW50TmFtZX08L3NwYW4+PC9wPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWluZGlnby04MDAgbWItMiI+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinPC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS03MDAgbWItMiI+4LiZ4Li14LmI4LiE4Li34Lit4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiE4Li44LiTOjwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNXhsIGZvbnQtYm9sZCBteS0yIj4ke3Njb3JlfSA8c3BhbiBjbGFzcz0idGV4dC0yeGwgZm9udC1ub3JtYWwgdGV4dC1ncmF5LTYwMCI+LyAke3RvdGFsUXVlc3Rpb25zfTwvc3Bhbj48L3A+CiAgICAgICAgICAgICR7cGFzc0ZhaWxIVE1MfQogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtYmx1ZS02MDAgbXQtMiI+KyR7cG9pbnRzfSBQb2ludHM8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIj7guITguLTguJTguYDguJvguYfguJkgJHtwZXJjZW50YWdlLnRvRml4ZWQoMCl9JTwvcD4KICAgICAgICAgICAgPGRpdiBpZD0iZWFybmVkLWJhZGdlcy1jb250YWluZXIiIGNsYXNzPSJtdC00IGZsZXgganVzdGlmeS1jZW50ZXIgZ2FwLTQgZmxleC13cmFwIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSByZXN1bHRIVE1MOwogICAgcmVuZGVyRWFybmVkQmFkZ2VzKGVhcm5lZEJhZGdlcywgJ2Vhcm5lZC1iYWRnZXMtY29udGFpbmVyJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgc2NvcmUsIHRvdGFsUXVlc3Rpb25zLCBzaG93UmFua2luZ3M6IHRydWUgfSk7Cn0KCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVN1Ym1pc3Npb25Db25maXJtYXRpb24oKSB7CiAgICBsZXQgcmVzdWx0SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggYmctZ3JlZW4tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSB0ZXh0LTV4bCB0ZXh0LWdyZWVuLTUwMCBtYi00Ij48L2k+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIG1iLTIiPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjogPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmVlbi04MDAiPiR7Y3VycmVudFN0dWRlbnROYW1lfTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtZ3JlZW4tODAwIG1iLTIiPuC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ouC5geC4peC5ieC4pzwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIj7guJzguLnguYnguITguKfguJrguITguLjguKHguIjguLDguYHguIjguYnguIfguJzguKXguITguLDguYHguJnguJnguYPguKvguYnguJfguKPguLLguJrguKDguLLguKLguKvguKXguLHguIc8L3A+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC02IHB0LTYgYm9yZGVyLXQgZmxleCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJiYWNrLXRvLWhvbWUtbWFudWFsLXJlbGVhc2UiIGNsYXNzPSJiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNiByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctYmx1ZS03MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaG9tZSBtci0yIj48L2k+4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4Liy4LmB4Lij4LiBCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gcmVzdWx0SFRNTDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguIHguLHguJrguJvguLjguYjguKHguJfguLXguYjguKrguKPguYnguLLguIfguILguLbguYnguJnguYPguKvguKHguYgKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWhvbWUtbWFudWFsLXJlbGVhc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWlkLWlucHV0JykudmFsdWUgPSAnJzsKICAgIH0pOwp9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlckVhcm5lZEJhZGdlcyhiYWRnZUlkcywgY29udGFpbmVySWQpIHsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVySWQpOwogICAgICAgICAgICBpZiAoIWNvbnRhaW5lciB8fCAhYmFkZ2VJZHMgfHwgYmFkZ2VJZHMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgICAgICAgICBsZXQgYmFkZ2VzSFRNTCA9ICcnOwogICAgICAgICAgICBiYWRnZUlkcy5mb3JFYWNoKChiYWRnZUlkLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYmFkZ2VJbmZvID0gT2JqZWN0LnZhbHVlcyhCQURHRVMpLmZpbmQoYiA9PiBiLmlkID09PSBiYWRnZUlkKTsKICAgICAgICAgICAgICAgIGlmIChiYWRnZUluZm8pIHsKICAgICAgICAgICAgICAgICAgICBiYWRnZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmFkZ2UtaWNvbiB0ZXh0LWNlbnRlciBwLTIgYmctd2hpdGUgcm91bmRlZC1sZyBzaGFkb3ciIHN0eWxlPSJhbmltYXRpb24tZGVsYXk6ICR7aW5kZXggKiAwLjJ9czsiIHRpdGxlPSIke2JhZGdlSW5mby5kZXNjcmlwdGlvbn0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyAke2JhZGdlSW5mby5pY29ufSB0ZXh0LTN4bCI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgZm9udC1zZW1pYm9sZCBtdC0xIj4ke2JhZGdlSW5mby5uYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBiYWRnZXNIVE1MOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFByZXNlbnRhdGlvbiBNb2RlIEZ1bmN0aW9ucyAtLS0KICAgICAgICBmdW5jdGlvbiBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSkgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXoocXVpekRhdGEpOyAvLyDguYHguIHguYnguYDguJvguYfguJkgcXVpekRhdGEKICAgICAgICAgICAgY3VycmVudFByZXNlbnRhdGlvblNsaWRlID0gMDsKICAgICAgICAgICAgcHJlc2VudGF0aW9uTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgLy8gVXNlIHN0eWxlIHRvIHNob3cKICAgICAgICAgICAgcmVuZGVyUHJlc2VudGF0aW9uU2xpZGUoY3VycmVudFByZXNlbnRhdGlvblNsaWRlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb3NlUHJlc2VudGF0aW9uKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJlc2VudGF0aW9uTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tc2xpZGUtY29udGFpbmVyJyk7CiAgICAgICAgICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2luZGV4XSkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGA8cCBjbGFzcz0idGV4dC0yeGwiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDog4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiW4Liy4LihPC9wPmA7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcXVlc3Rpb24gPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2luZGV4XTsKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgcHJldmlvdXMgc2xpZGUKCiAgICAgICAgICAgIGxldCBzbGlkZUhUTUwgPSBgCiAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXdoaXRlIHRleHQtZ3JheS04MDAgcC02IG1kOnAtMTIgcm91bmRlZC0yeGwgc2hhZG93LTJ4bCB3LWZ1bGwgbWF4LWgtWzkwdmhdIG92ZXJmbG93LXktYXV0byBmYWRlLWluIGZsZXggZmxleC1jb2wiPgogICAgICAgICAgICAgICAgICAgICR7cXVlc3Rpb24uaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTQgZmxleCBqdXN0aWZ5LWNlbnRlciI+JHtxdWVzdGlvbi5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBzbTp0ZXh0LTN4bCBsZzp0ZXh0LTR4bCBmb250LWJvbGQgbWItNiBtZDptYi0xMiB0ZXh0LWxlZnQiIHN0eWxlPSJsaW5lLWhlaWdodDogMS44OyI+JHtpbmRleCArIDF9LiAke3F1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJwcmVzZW50YXRpb24tb3B0aW9ucyIgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTQgbWQ6Z2FwLTYgaXRlbXMtc3RyZXRjaCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgICAgICBzbGlkZUhUTUwgKz0gcXVlc3Rpb24uYWxsUmVzcG9uc2VzLm1hcCgocmVzcCkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZW50YXRpb24tb3B0aW9uIHAtNCBtZDpwLTYgcm91bmRlZC1sZyB0ZXh0LWxnIG1kOnRleHQtMnhsIGJvcmRlci00IGJvcmRlci1ncmF5LTMwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRyYW5zaXRpb24tYWxsIGxlYWRpbmctbm9ybWFsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVzcH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgICAgICAgICBzbGlkZUhUTUwgKz0gYDxidXR0b24gY2xhc3M9InByZXNlbnRhdGlvbi1vcHRpb24gcC00IG1kOnAtNiByb3VuZGVkLWxnIHRleHQtbGcgbWQ6dGV4dC0yeGwgYm9yZGVyLTQgYm9yZGVyLWdyYXktMzAwIGhvdmVyOmJnLWluZGlnby0xMDAgdHJhbnNpdGlvbi1hbGwgbGVhZGluZy1ub3JtYWwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIiIGRhdGEtYW5zd2VyPSJ0cnVlIj7guYPguIrguYg8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgPGJ1dHRvbiBjbGFzcz0icHJlc2VudGF0aW9uLW9wdGlvbiBwLTQgbWQ6cC02IHJvdW5kZWQtbGcgdGV4dC1sZyBtZDp0ZXh0LTJ4bCBib3JkZXItNCBib3JkZXItZ3JheS0zMDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCBsZWFkaW5nLW5vcm1hbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciIgZGF0YS1hbnN3ZXI9ImZhbHNlIj7guYTguKHguYjguYPguIrguYg8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgICAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBpZD0icHJlc2VudGF0aW9uLXNob3J0LWFuc3dlci1pbnB1dCIgY2xhc3M9InctZnVsbCBwLTQgdGV4dC0yeGwgYm9yZGVyLTIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCIgcm93cz0iMiIgcGxhY2Vob2xkZXI9IuC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4meC4teC5iC4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNoZWNrLXByZXNlbnRhdGlvbi1hbnN3ZXItYnRuIiBjbGFzcz0ibXQtNCBiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNiByb3VuZGVkLWxnIHRleHQteGwgaG92ZXI6YmctYmx1ZS03MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4g4LiV4Lij4Lin4LiI4LiE4Liz4LiV4Lit4LiaCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InByZXNlbnRhdGlvbi1haS1yZXN1bHQiIGNsYXNzPSJoaWRkZW4gbXQtNCB0ZXh0LTJ4bCBmb250LWJvbGQiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl90aGVfYmxhbmsnOgogICAgICAgICAgICAgICAgY2FzZSAnbXVsdGlwbGVfY2hvaWNlJzoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgc2xpZGVIVE1MICs9IHF1ZXN0aW9uLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2VudGF0aW9uLW9wdGlvbiBwLTQgbWQ6cC02IHJvdW5kZWQtbGcgdGV4dC1sZyBtZDp0ZXh0LTJ4bCBib3JkZXItNCBib3JkZXItZ3JheS0zMDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCBsZWFkaW5nLW5vcm1hbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciIgZGF0YS1pbmRleD0iJHtpfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke29wdH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0icHJlc2VudGF0aW9uLWV4cGxhbmF0aW9uIiBjbGFzcz0iaGlkZGVuIG10LTggcC00IGJnLWJsdWUtNTAgdGV4dC1ibHVlLTgwMCByb3VuZGVkLWxnIHRleHQtbGVmdCB0ZXh0LWxnIG1kOnRleHQteGwgbWF4LXctNHhsIG14LWF1dG8gbGVhZGluZy1yZWxheGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0iZm9udC1ib2xkIj7guITguLPguK3guJjguLTguJrguLLguKI6PC9zdHJvbmc+ICR7cXVlc3Rpb24uZXhwbGFuYXRpb24gfHwgJ+C5hOC4oeC5iOC4oeC4teC4hOC4s+C4reC4mOC4tOC4muC4suC4oid9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBzbGlkZUhUTUw7CiAgICAgICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgd2luZG93Lk1hdGhKYXgudHlwZXNldFByb21pc2UoW2NvbnRhaW5lcl0pOwoKICAgICAgICAgICAgLy8g4pa84pa84pa8IC0tLSDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tIOKWvOKWvOKWvAogICAgICAgICAgICAvLyAxLiDguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguJXguLHguKfguYDguKXguLfguK3guIEgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgICAgICAgICAgbGV0IG9wdGlvbnNGb3JTY3JhdGNocGFkID0gW107CiAgICAgICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ21hdGNoaW5nX2l0ZW0nOiBvcHRpb25zRm9yU2NyYXRjaHBhZCA9IHF1ZXN0aW9uLmFsbFJlc3BvbnNlcyB8fCBbXTsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzogb3B0aW9uc0ZvclNjcmF0Y2hwYWQgPSBbJ+C5g+C4iuC5iCcsICfguYTguKHguYjguYPguIrguYgnXTsgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiBvcHRpb25zRm9yU2NyYXRjaHBhZCA9IHF1ZXN0aW9uLm9wdGlvbnMgfHwgW107IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiDguITguYnguJnguKvguLLguJvguLjguYjguKEgIuC4l+C4lOC5gOC4peC4giIg4LiX4Li14LmI4LiV4Lit4LiZ4LiZ4Li14LmJ4Lit4Lii4Li54LmI4LmD4LiZIEhUTUwg4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIGNvbnN0IHNjcmF0Y2hwYWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlc2VudGF0aW9uLXNjcmF0Y2hwYWQtYnRuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiDguYDguJvguKXguLXguYjguKLguJnguIjguLLguIHguIHguLLguKMgIuC4quC4o+C5ieC4suC4h+C4m+C4uOC5iOC4oeC5g+C4q+C4oeC5iCIg4Lih4Liy4LmA4Lib4LmH4LiZICLguK3guLHguJvguYDguJTguJUgRXZlbnQgYG9uY2xpY2tgIiDguILguK3guIfguJvguLjguYjguKHguYDguJTguLTguKEKICAgICAgICAgICAgLy8g4LiB4Liy4Lij4LmD4LiK4LmJIC5vbmNsaWNrIOC4iOC4sOC5gOC4m+C5h+C4meC4geC4suC4o+C5gOC4guC4teC4ouC4meC4l+C4seC4miBMaXN0ZW5lciDguYDguIHguYjguLLguJfguLjguIHguITguKPguLHguYnguIcg4LiX4Liz4LmD4Lir4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmA4Liq4Lih4LitCiAgICAgICAgICAgIGlmIChzY3JhdGNocGFkQnRuKSB7CiAgICAgICAgICAgICAgICBzY3JhdGNocGFkQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIG9wdGlvbnNGb3JTY3JhdGNocGFkKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g4pay4pay4payIC0tLSDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguYHguIHguYnguYTguIIgLS0tIOKWsuKWsuKWsgoKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnByZXNlbnRhdGlvbi1vcHRpb24nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gcmV2ZWFsQW5zd2VyRm9yUHJlc2VudGF0aW9uKGluZGV4LCBlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjaGVja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1wcmVzZW50YXRpb24tYW5zd2VyLWJ0bicpOwogICAgICAgICAgICBpZiAoY2hlY2tCdG4pIHsKICAgICAgICAgICAgICAgIGNoZWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gY2hlY2tTaG9ydEFuc3dlckZvclByZXNlbnRhdGlvbihpbmRleCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xpZGUtY291bnRlcicpLnRleHRDb250ZW50ID0gYOC4guC5ieC4reC4l+C4teC5iCAke2luZGV4ICsgMX0gLyAke2N1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RofWA7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2LXF1ZXN0aW9uLWJ0bicpLmRpc2FibGVkID0gaW5kZXggPT09IDA7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXF1ZXN0aW9uLWJ0bicpLmRpc2FibGVkID0gaW5kZXggPT09IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gY2hlY2tTaG9ydEFuc3dlckZvclByZXNlbnRhdGlvbihxdWVzdGlvbkluZGV4KSB7CiAgICBjb25zdCBxdWVzdGlvbiA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tc2hvcnQtYW5zd2VyLWlucHV0Jyk7CiAgICBjb25zdCBjaGVja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1wcmVzZW50YXRpb24tYW5zd2VyLWJ0bicpOwogICAgY29uc3QgcmVzdWx0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXNlbnRhdGlvbi1haS1yZXN1bHQnKTsKICAgIGNvbnN0IGV4cGxhbmF0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXNlbnRhdGlvbi1leHBsYW5hdGlvbicpOwoKICAgIGlmICghaW5wdXQgfHwgIWNoZWNrQnRuIHx8ICFyZXN1bHRDb250YWluZXIgfHwgIWV4cGxhbmF0aW9uQ29udGFpbmVyKSByZXR1cm47CgogICAgY29uc3QgdXNlckFuc3dlciA9IGlucHV0LnZhbHVlLnRyaW0oKTsKICAgIGlmICh1c2VyQW5zd2VyID09PSAnJykgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjaGVja0J0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBjaGVja0J0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C4leC4o+C4p+C4iC4uLic7CiAgICBpbnB1dC5kaXNhYmxlZCA9IHRydWU7CgogICAgLy8gLS0tIOC4meC4teC5iOC4hOC4t+C4reC4muC4o+C4o+C4l+C4seC4lOC4l+C4teC5iOC4luC4ueC4geC5geC4geC5ieC5hOC4giAtLS0KICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4oeC4suC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4muC4leC4seC4p+C5g+C4q+C4oeC5iOC4l+C4teC5iOC4ieC4peC4suC4lOC4guC4tuC5ieC4mQogICAgY29uc3QgaXNDb3JyZWN0ID0gYXdhaXQgZ3JhZGVTaG9ydEFuc3dlcih1c2VyQW5zd2VyLCBxdWVzdGlvbik7CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9InRleHQtZ3JlZW4tNTAwIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPiDguJbguLnguIHguJXguYnguK3guIc8L3NwYW4+JzsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGV4dC1yZWQtNTAwIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPiDguYTguKHguYjguJbguLnguIHguJXguYnguK3guIc8L3NwYW4+ICjguITguLPguJXguK3guJrguJfguLXguYjguITguLLguJTguKvguKfguLHguIc6ICR7cXVlc3Rpb24uaWRlYWxBbnN3ZXJ9KWA7CiAgICB9CiAgICAKICAgIHJlc3VsdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGV4cGxhbmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgY2hlY2tCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4m+C4uOC5iOC4oeC4leC4o+C4p+C4iOC4q+C4peC4seC4h+C4iOC4suC4geC4leC4o+C4p+C4iOC5geC4peC5ieC4pwp9CgogICAgICAgIGZ1bmN0aW9uIHJldmVhbEFuc3dlckZvclByZXNlbnRhdGlvbihxdWVzdGlvbkluZGV4LCBzZWxlY3RlZEJ1dHRvbikgewogICAgICAgICAgICBjb25zdCBxdWVzdGlvbiA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgICAgIAogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucHJlc2VudGF0aW9uLW9wdGlvbicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXI6YmctaW5kaWdvLTEwMCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZihxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fdGhlX2JsYW5rJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbkluZGV4ID0gcGFyc2VJbnQoYnRuLmRhdGFzZXQuaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IG9wdGlvbkluZGV4ID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXg7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uQW5zd2VyID0gYnRuLmRhdGFzZXQuYW5zd2VyID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gb3B0aW9uQW5zd2VyID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IGJ0bi50ZXh0Q29udGVudC50cmltKCkgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2JnLWdyZWVuLTUwMCcsICd0ZXh0LXdoaXRlJywgJ2JvcmRlci1ncmVlbi03MDAnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxlY3RlZEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7CgogICAgICAgICAgICBsZXQgd2FzU2VsZWN0aW9uQ29ycmVjdCA9IGZhbHNlOwogICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJykgewogICAgICAgICAgICAgICAgd2FzU2VsZWN0aW9uQ29ycmVjdCA9IHBhcnNlSW50KHNlbGVjdGVkQnV0dG9uLmRhdGFzZXQuaW5kZXgpID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgIHdhc1NlbGVjdGlvbkNvcnJlY3QgPSAoc2VsZWN0ZWRCdXR0b24uZGF0YXNldC5hbnN3ZXIgPT09ICd0cnVlJykgPT09IHF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgICAgIHdhc1NlbGVjdGlvbkNvcnJlY3QgPSBzZWxlY3RlZEJ1dHRvbi50ZXh0Q29udGVudC50cmltKCkgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF3YXNTZWxlY3Rpb25Db3JyZWN0KSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdiZy1yZWQtNTAwJywgJ3RleHQtd2hpdGUnLCAnYm9yZGVyLXJlZC03MDAnKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tZXhwbGFuYXRpb24nKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBUaW1lciBGdW5jdGlvbnMgLS0tCiAgICAgICAgZnVuY3Rpb24gc3RhcnRXaG9sZVF1aXpUaW1lcihkdXJhdGlvbkluTWludXRlcykgewogICAgICAgICAgICBjb25zdCB0aW1lckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1lci1jb250YWluZXInKTsKICAgICAgICAgICAgaWYgKCF0aW1lckNvbnRhaW5lcikgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCkgKyBkdXJhdGlvbkluTWludXRlcyAqIDYwICogMTAwMDsKICAgICAgICAgICAgdGltZXJDb250YWluZXIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIGJnLWdyYXktMTAwIHAtMiByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWluZGlnby03MDAiPuC5gOC4p+C4peC4suC4l+C4teC5iOC5gOC4q+C4peC4t+C4rTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImNvdW50ZG93bi1kaXNwbGF5IiBjbGFzcz0iZm9udC1ib2xkIHRleHQtbGcgdGV4dC1yZWQtNjAwIj4tLTotLTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICBjb25zdCBjb3VudGRvd25EaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bi1kaXNwbGF5Jyk7CgogICAgICAgICAgICBxdWl6VGltZXJJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZyA9IGVuZFRpbWUgLSBEYXRlLm5vdygpOwogICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChxdWl6VGltZXJJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgY291bnRkb3duRGlzcGxheS50ZXh0Q29udGVudCA9ICIwMDowMCI7CiAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4q+C4oeC4lOC5gOC4p+C4peC4siEg4LiB4Liz4Lil4Lix4LiH4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaLi4uIik7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU3VibWl0UXVpeihudWxsKTsgLy8gQXV0by1zdWJtaXQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHJlbWFpbmluZyAvIDEwMDAgLyA2MCkgJSA2MCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChyZW1haW5pbmcgLyAxMDAwKSAlIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgICAgICAgICAgICAgY291bnRkb3duRGlzcGxheS50ZXh0Q29udGVudCA9IGAke21pbnV0ZXN9OiR7c2Vjb25kc31gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclBlclF1ZXN0aW9uVmlldyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIHJlbmRlclBlclF1ZXN0aW9uVmlldygpIHsKICAgIGlmIChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwocGVyUXVlc3Rpb25UaW1lckludGVydmFsKTsKICAgIAogICAgY29uc3QgcSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50RGlzcGxheWVkUXVpei5xdWl6VHlwZTsKICAgIC8vIC0tLSDguYDguJ7guLTguYjguKHguKrguYjguKfguJnguJnguLXguYk6IOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5gOC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC5guC4q+C4oeC4lOC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iCAtLS0KICAgIGNvbnN0IGNvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyAxLiDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIfguKvguKXguLHguIHguILguK3guIfguKvguJnguYnguLLguIjguK0KICAgIGxldCBodG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi0yIj4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCI+4LiE4Liz4LiW4Liy4Lih4LiX4Li14LmIICR7Y3VycmVudFF1ZXN0aW9uSW5kZXggKyAxfSDguIjguLLguIEgJHtjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubGVuZ3RofTwvcD4KICAgICAgICAgICAgJHtjdXJyZW50TW9kZSA9PT0gJ2FkbWluLXRlc3RpbmcnID8gJzxidXR0b24gaWQ9ImNhbmNlbC10ZXN0LWJ0biIgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LXJlZC02MDAgZm9udC1zZW1pYm9sZCBweS0xIHB4LTIgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtNTAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTEiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LiX4LiU4Liq4Lit4LiaPC9idXR0b24+JyA6ICcnfQogICAgICAgIDwvZGl2PgogICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItMiB0ZXh0LWNlbnRlciI+4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaOiAke2N1cnJlbnREaXNwbGF5ZWRRdWl6LnRvcGljfTwvaDM+CiAgICAgICAgCiAgICAgICAgPGRpdiBpZD0icGVyLXF1ZXN0aW9uLXRpbWVyLWNvbnRhaW5lciIgY2xhc3M9Im1iLTQiPjwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJtYi02IHAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1zZW1pYm9sZCBtYi0zIiBpZD0icGVyLXF1ZXN0aW9uLXRleHQiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS0yIiBpZD0icGVyLXF1ZXN0aW9uLW9wdGlvbnMiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UXVpekFyZWEuaW5uZXJIVE1MID0gaHRtbDsKCiAgICAvLyAyLiDguYDguJXguKPguLXguKLguKEgSFRNTCDguKrguLPguKvguKPguLHguJrguITguLPguJbguLLguKHguYHguKXguLDguJXguLHguKfguYDguKXguLfguK3guIEKICAgIGxldCBxdWVzdGlvblRleHRIVE1MID0gKHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dCk7CiAgICBpZiAocS5pbWFnZUNvZGUpIHsKICAgICAgICBxdWVzdGlvblRleHRIVE1MICs9IGA8ZGl2IGNsYXNzPSJteS00IGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YDsKICAgIH0KICAgIAogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CiAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzoKICAgICAgICBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8dGV4dGFyZWEgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJvd3M9IjMiIHJlcXVpcmVkPjwvdGV4dGFyZWE+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0icV9zaW5nbGVfb3B0MCIgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiB2YWx1ZT0idHJ1ZSIgY2xhc3M9Im1yLTIgYWNjZW50LWluZGlnby02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InFfc2luZ2xlX29wdDAiPuC5g+C4iuC5iDwvbGFiZWw+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InFfc2luZ2xlX29wdDEiIG5hbWU9InF1ZXN0aW9uX3NpbmdsZSIgdmFsdWU9ImZhbHNlIiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icV9zaW5nbGVfb3B0MSI+4LmE4Lih4LmI4LmD4LiK4LmIPC9sYWJlbD48L2Rpdj5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxzZWxlY3QgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJlcXVpcmVkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4LiaIC0tPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHsocS5hbGxSZXNwb25zZXMgfHwgW10pLm1hcChyZXNwID0+IGA8b3B0aW9uIHZhbHVlPSIke3Jlc3B9Ij4ke3Jlc3B9PC9vcHRpb24+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZihxLm9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gcS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgPGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJxX3NpbmdsZV9vcHQke2l9IiBuYW1lPSJxdWVzdGlvbl9zaW5nbGUiIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icV9zaW5nbGVfb3B0JHtpfSI+JHtvcHR9PC9sYWJlbD48L2Rpdj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICAvLyAzLiDguJnguLMgSFRNTCDguILguK3guIfguITguLPguJbguLLguKHguYHguKXguLDguJXguLHguKfguYDguKXguLfguK3guIHguYTguJvguYPguKrguYjguYPguJnguKvguJnguYnguLIKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXItcXVlc3Rpb24tdGV4dCcpLmlubmVySFRNTCA9IHF1ZXN0aW9uVGV4dEhUTUw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXF1ZXN0aW9uLW9wdGlvbnMnKS5pbm5lckhUTUwgPSBvcHRpb25zSFRNTDsKCmNvbnN0IGNvbmZpZGVuY2VFbmFibGVkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID09PSB0cnVlOwpjb25zdCBjb25maWRlbmNlTW9kZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5jb25maWRlbmNlTW9kZSB8fCAnY2hlY2tib3gnOwoKLy8g4pa84pa84pa8IOC4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4gjog4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCIGAmJiBjb25maWRlbmNlTW9kZSA9PT0gJ2NoZWNrYm94J2Ag4LmA4LiC4LmJ4Liy4LmE4LibIOKWvOKWvOKWvAppZiAoY29uZmlkZW5jZUVuYWJsZWQgJiYgY29uZmlkZW5jZU1vZGUgPT09ICdjaGVja2JveCcpIHsKICAgIC8vIOC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5g+C4q+C4oeC5iOC4meC4teC5ieC4iOC4sOC4l+C4s+C5g+C4q+C5iSBDaGVja2JveCDguYHguKrguJTguIfguJzguKUgIuC5gOC4ieC4nuC4suC4sOC5gOC4oeC4t+C5iOC4rSIg4LmA4Lil4Li34Lit4LiB4LmC4Lir4Lih4LiUIGNoZWNrYm94IOC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgY29uc3QgY29uZmlkZW5jZUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibXQtNCBwdC0zIGJvcmRlci10IGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImNvbmZpZGVuY2Vfc2luZ2xlIiBuYW1lPSJjb25maWRlbmNlX3NpbmdsZSIgY2xhc3M9ImgtNCB3LTQgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZGVuY2Vfc2luZ2xlIiBjbGFzcz0ibWwtMiB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgY3Vyc29yLXBvaW50ZXIiPuC4ieC4seC4meC4oeC4seC5iOC4meC5g+C4iOC5g+C4meC4hOC4s+C4leC4reC4muC4guC5ieC4reC4meC4teC5iTwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFF1aXpBcmVhLnF1ZXJ5U2VsZWN0b3IoJy5tYi02LnAtNCcpLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgY29uZmlkZW5jZUhUTUwpOwp9CgogICAgLy8gNC4g4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4LihICLguJbguLHguJTguYTguJsiIOC5geC4peC4sOC5gOC4o+C4tOC5iOC4oSBUaW1lcgogICAgc3R1ZGVudFF1aXpBcmVhLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYAogICAgICAgIDxidXR0b24gaWQ9Im5leHQtcXVlc3Rpb24tdGltZWQtYnRuIiBjbGFzcz0idy1mdWxsIG10LTQgYmctaW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctaW5kaWdvLTcwMCI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQgbXItMiI+PC9pPgogICAgICAgICAgICAke2N1cnJlbnRRdWVzdGlvbkluZGV4ID09PSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubGVuZ3RoIC0gMSA/ICfguKrguYjguIfguITguLPguJXguK3guJonIDogJ+C4hOC4s+C4luC4suC4oeC4luC4seC4lOC5hOC4myd9CiAgICAgICAgPC9idXR0b24+CiAgICBgKTsKCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtdGVzdC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjYW5jZWxBZG1pblRlc3QpOwogICAgfQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQtcXVlc3Rpb24tdGltZWQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVOZXh0UXVlc3Rpb25JblRpbWVkTW9kZShmYWxzZSkpOwogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB3aW5kb3cuTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFF1aXpBcmVhXSk7CiAgICBpZiAoY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICBzdGFydFBlclF1ZXN0aW9uVGltZXIoKTsKICAgIH0KfQoKICAgICAgICBmdW5jdGlvbiBzdGFydFBlclF1ZXN0aW9uVGltZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uSW5TZWNvbmRzID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3MudGltZXJEdXJhdGlvbjsKICAgICAgICAgICAgY29uc3QgdGltZXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXF1ZXN0aW9uLXRpbWVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoIXRpbWVyQ29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uSW5TZWNvbmRzOwogICAgICAgICAgICB0aW1lckNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ0aW1lci1iYXItY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIGJnLWdyYXktMjAwIHJvdW5kZWQtZnVsbCBoLTIuNSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idGltZXItYmFyIiBjbGFzcz0iYmctaW5kaWdvLTYwMCBoLTIuNSByb3VuZGVkLWZ1bGwiIHN0eWxlPSJ3aWR0aDogMTAwJSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXNtIHRleHQtZ3JheS02MDAgbXQtMSI+4LmA4Lir4Lil4Li34Lit4LmA4Lin4Lil4LiyIDxzcGFuIGlkPSJwZXItcS1jb3VudGRvd24iPiR7cmVtYWluaW5nVGltZX08L3NwYW4+IOC4p+C4tOC4meC4suC4l+C4tTwvcD4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgY29uc3QgdGltZXJCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItYmFyJyk7CiAgICAgICAgICAgIGNvbnN0IGNvdW50ZG93bkRpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXEtY291bnRkb3duJyk7CgogICAgICAgICAgICBwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgICAgICByZW1haW5pbmdUaW1lLS07CiAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gKHJlbWFpbmluZ1RpbWUgLyBkdXJhdGlvbkluU2Vjb25kcykgKiAxMDA7CiAgICAgICAgICAgICAgICB0aW1lckJhci5zdHlsZS53aWR0aCA9IGAke3BlcmNlbnRhZ2V9JWA7CiAgICAgICAgICAgICAgICBjb3VudGRvd25EaXNwbGF5LnRleHRDb250ZW50ID0gcmVtYWluaW5nVGltZTsKCiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nVGltZSA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKvguKHguJTguYDguKfguKXguLLguKrguLPguKvguKPguLHguJrguILguYnguK3guJnguLXguYkhIik7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTmV4dFF1ZXN0aW9uSW5UaW1lZE1vZGUodHJ1ZSk7IC8vIEF1dG8tYWR2YW5jZSwgdHJ1ZSBtZWFucyBza2lwcGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0KICAgICAgICAKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVOZXh0UXVlc3Rpb25JblRpbWVkTW9kZSDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIGhhbmRsZU5leHRRdWVzdGlvbkluVGltZWRNb2RlKHdhc1NraXBwZWQgPSBmYWxzZSkgewogICAgaWYgKHBlclF1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwoKICAgIGxldCBzZWxlY3RlZEFuc3dlciA9IG51bGw7CiAgICBsZXQgd2FzQ29uZmlkZW50ID0gZmFsc2U7IC8vIOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mQoKICAgIGlmICghd2FzU2tpcHBlZCkgewogICAgICAgIC8vIC0tLSDguKrguYjguKfguJnguJTguLbguIfguILguYnguK3guKHguLnguKXguIjguLLguIHguJ/guK3guKPguYzguKEgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkgLS0tCiAgICAgICAgY29uc3QgY3VycmVudFF1ZXN0aW9uID0gY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbkluZGV4XTsKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBjdXJyZW50UXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1aXpUeXBlOwogICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHsKICAgICAgICAgICAgc2VsZWN0ZWRBbnN3ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXScpPy52YWx1ZS50cmltKCkgPz8gIiI7CiAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICBzZWxlY3RlZEFuc3dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdFtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXScpPy52YWx1ZSA/PyAiIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBjaGVja2VkUmFkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXTpjaGVja2VkJyk7CiAgICAgICAgICAgIGlmIChjaGVja2VkUmFkaW8pIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkQW5zd2VyID0gY2hlY2tlZFJhZGlvLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzZWxlY3RlZEFuc3dlciA9PT0gbnVsbCB8fCBzZWxlY3RlZEFuc3dlciA9PT0gIiIpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4geC5iOC4reC4meC4geC4lOC4m+C4uOC5iOC4oeC4luC4seC4lOC5hOC4m+C4hOC4o+C4seC4miIpOwogICAgICAgICAgICBzdGFydFBlclF1ZXN0aW9uVGltZXIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIOC4quC5iOC4p+C4mSBMb2dpYyDguYPguKvguKHguYjguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICAgICAgY29uc3QgY29uZmlkZW5jZUVuYWJsZWQgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgPT09IHRydWU7CiAgICAgICAgY29uc3QgY29uZmlkZW5jZU1vZGUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uY29uZmlkZW5jZU1vZGUgfHwgJ2NoZWNrYm94JzsKCiAgICAgICAgLy8gKirguYDguIfguLfguYjguK3guJnguYTguILguKrguLPguITguLHguI06Kiog4LiW4LmJ4Liy4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZIOC5geC4peC4sOC5gOC4m+C5h+C4meC5guC4q+C4oeC4lOC4muC4seC4h+C4hOC4seC4muC5gOC4peC4t+C4reC4gQppZiAoY29uZmlkZW5jZUVuYWJsZWQgJiYgY29uZmlkZW5jZU1vZGUgPT09ICdtYW5kYXRvcnknKSB7CiAgICAgICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4muC4reC4gSBNb2RhbCDguKfguYjguLLguJnguLXguYjguITguLfguK3guYLguKvguKHguJTguIjguLHguJrguYDguKfguKXguLLguKPguLLguKLguILguYnguK0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKS5kYXRhc2V0LmN1cnJlbnRNb2RlID0gJ3RpbWVkJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuICLguJ7guLHguIEiIOC4hOC4s+C4leC4reC4muC5hOC4p+C5ieC5g+C4mSBoaWRkZW4gaW5wdXQKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGVkLWFuc3dlci1pbmRleC1oaWRkZW4nKS52YWx1ZSA9IHNlbGVjdGVkQW5zd2VyOwogICAgICAgICAgICAvLyAyLiDguYHguKrguJTguIcgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgLy8gMy4g4Lir4Lii4Li44LiU4LiB4Liy4Lij4LiX4Liz4LiH4Liy4LiZ4LiC4Lit4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LiX4Lix4LiZ4LiX4Li1ISAo4Lij4Lit4LmD4Lir4LmJ4Lic4Li54LmJ4LmD4LiK4LmJ4LiE4Lil4Li04LiB4Lib4Li44LmI4Lih4LmD4LiZIE1vZGFsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4meC5guC4q+C4oeC4lCBDaGVja2JveCAo4LiC4Lit4LiH4LmA4LiU4Li04LihKSDguYPguKvguYnguJTguLbguIfguITguYjguLLguJXguLLguKHguJvguIHguJXguLQKICAgICAgICBjb25zdCBjb25maWRlbmNlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZV9zaW5nbGUnKTsKICAgICAgICBpZiAoY29uZmlkZW5jZUNoZWNrYm94KSB7CiAgICAgICAgICAgIHdhc0NvbmZpZGVudCA9IGNvbmZpZGVuY2VDaGVja2JveC5jaGVja2VkOwogICAgICAgIH0KICAgICAgICAvLyAtLS0g4Liq4Li04LmJ4LiZ4Liq4Li44LiUIExvZ2ljIOC5g+C4q+C4oeC5iCAtLS0KICAgIH0KICAgIAogICAgLy8g4Liq4Lij4LmJ4Liy4LiHIG9iamVjdCDguITguLPguJXguK3guJoKICAgIGNvbnN0IGFuc3dlckRhdGEgPSB7IAogICAgICAgIGFuc3dlcjogc2VsZWN0ZWRBbnN3ZXIsIAogICAgICAgIHdhc0NvbmZpZGVudDogd2FzQ29uZmlkZW50IAogICAgfTsKCiAgICAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguYDguJ7guLfguYjguK3guYTguJvguILguYnguK3guJXguYjguK3guYTguJsKICAgIHByb2NlZWRUb05leHRRdWVzdGlvbihhbnN3ZXJEYXRhKTsKfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBmaW5hbGl6ZVBlclF1ZXN0aW9uUXVpeigpIHsKICAgICAgICAgICAgY29uc3QgaGFzU2hvcnRBbnN3ZXIgPSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMuc29tZShxID0+IHEucXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyk7CiAgICAgICAgICAgIGlmIChoYXNTaG9ydEFuc3dlcikgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4miBBSSDguIHguLPguKXguLHguIfguJXguKPguKfguIjguITguLPguJXguK3guJrguK3guLHguJXguJnguLHguKIuLi4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguJfguLPguYHguJrguJrguJfguJTguKrguK3guJog4LiB4Liz4Lil4Lix4LiH4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaLi4uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLS0tIOC5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4myAtLS0KY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwpjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgY3VycmVudFN0dWRlbnROYW1lKTsKY29uc3Qgc3VibWlzc2lvblNuYXAgPSBhd2FpdCBnZXREb2Moc3VibWlzc2lvblJlZik7CmNvbnN0IGV4aXN0aW5nRGF0YSA9IHN1Ym1pc3Npb25TbmFwLmV4aXN0cygpID8gc3VibWlzc2lvblNuYXAuZGF0YSgpIDoge307CmNvbnN0IHByZXZpb3VzQXR0ZW1wdHMgPSBleGlzdGluZ0RhdGEuYXR0ZW1wdHMgfHwgW107CgovLyAtLS0g4LmB4LiB4LmJ4LmE4LiC4Lia4Lij4Lij4LiX4Lix4LiU4LmA4LiU4Li04Lih4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4LmB4Lia4Lia4LiZ4Li14LmJIC0tLQphd2FpdCBwcm9jZXNzQW5kU3VibWl0QW5zd2VycyhzdHVkZW50QW5zd2Vyc1BlclF1ZXN0aW9uLCBwcmV2aW91c0F0dGVtcHRzKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBFeHBvcnQgRnVuY3Rpb25zIC0tLQogICAgICAgIGZ1bmN0aW9uIGdldFJlc3VsdHNGaWxlbmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgcXVpelRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtcXVpei10aXRsZScpLnRleHRDb250ZW50LnJlcGxhY2UoL1teYS16MC05XS9naSwgJ18nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gYHJlc3VsdHNfJHtxdWl6VGl0bGUgfHwgJ3F1aXonfWA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHBvcnRSZXN1bHRzQXNJbWFnZSgpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0c1RhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJyk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguKPguLnguJvguKDguLLguJ4uLi4iKTsKICAgICAgICAgICAgaHRtbDJjYW52YXMocmVzdWx0c1RhYmxlKS50aGVuKGNhbnZhcyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IGAke2dldFJlc3VsdHNGaWxlbmFtZSgpfS5wbmdgOwogICAgICAgICAgICAgICAgbGluay5ocmVmID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0UmVzdWx0c0FzUERGKCkgewogICAgICAgICAgICBjb25zdCB7IGpzUERGIH0gPSB3aW5kb3cuanNwZGY7CiAgICAgICAgICAgIGNvbnN0IGRvYyA9IG5ldyBqc1BERigpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTm90ZToganNQREYgaGFzIGxpbWl0ZWQgc3VwcG9ydCBmb3Igbm9uLWxhdGluIGNoYXJhY3RlcnMgd2l0aG91dCBjdXN0b20gZm9udHMuCiAgICAgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIGZvciBiYXNpYyB0ZXh0IGJ1dCBtaWdodCBub3QgcmVuZGVyIFRoYWkgY2hhcmFjdGVycyBjb3JyZWN0bHkuCiAgICAgICAgICAgIC8vIEZvciBmdWxsIFRoYWkgc3VwcG9ydCwgYSBmb250IGxpa2UgJ1NhcmFidW4nIHdvdWxkIG5lZWQgdG8gYmUgZW1iZWRkZWQuCiAgICAgICAgICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCAnbm9ybWFsJyk7IAogICAgICAgICAgICBkb2MuYXV0b1RhYmxlKHsgaHRtbDogJyNyZXN1bHRzLXRhYmxlJyB9KTsKICAgICAgICAgICAgZG9jLnNhdmUoYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LnBkZmApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0UmVzdWx0c0FzV29yZCgpIHsKICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gIjxodG1sIHhtbG5zOm89J3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScgIisKICAgICAgICAgICAgICAgICJ4bWxuczp3PSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkJyAiKwogICAgICAgICAgICAgICAgInhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwJz4iKwogICAgICAgICAgICAgICAgIjxoZWFkPjxtZXRhIGNoYXJzZXQ9J3V0Zi04Jz48dGl0bGU+RXhwb3J0IEhUTUwgdG8gV29yZDwvdGl0bGU+PC9oZWFkPjxib2R5PiI7CiAgICAgICAgICAgIGNvbnN0IGZvb3RlciA9ICI8L2JvZHk+PC9odG1sPiI7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhUTUwgPSBoZWFkZXIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVzdWx0cy10YWJsZS1jb250YWluZXIiKS5pbm5lckhUTUwgKyBmb290ZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzb3VyY2UgPSAnZGF0YTphcHBsaWNhdGlvbi92bmQubXMtd29yZDtjaGFyc2V0PXV0Zi04LCcgKyBlbmNvZGVVUklDb21wb25lbnQoc291cmNlSFRNTCk7CiAgICAgICAgICAgIGNvbnN0IGZpbGVEb3dubG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmaWxlRG93bmxvYWQpOwogICAgICAgICAgICBmaWxlRG93bmxvYWQuaHJlZiA9IHNvdXJjZTsKICAgICAgICAgICAgZmlsZURvd25sb2FkLmRvd25sb2FkID0gYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LmRvY2A7CiAgICAgICAgICAgIGZpbGVEb3dubG9hZC5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGZpbGVEb3dubG9hZCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHBvcnRSZXN1bHRzQXNFeGNlbCgpIHsKICAgICAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy10YWJsZScpOwogICAgICAgICAgICBsZXQgY3N2ID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFibGUucm93cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IHJvdyA9IFtdLCBjb2xzID0gdGFibGUucm93c1tpXS5xdWVyeVNlbGVjdG9yQWxsKCd0ZCwgdGgnKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29scy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIC8vIEVzY2FwZSBkb3VibGUgcXVvdGVzIGFuZCB3cmFwIGluIGRvdWJsZSBxdW90ZXMKICAgICAgICAgICAgICAgICAgICByb3cucHVzaCgnIicgKyBjb2xzW2pdLmlubmVyVGV4dC5yZXBsYWNlKC8iL2csICciIicpICsgJyInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNzdi5wdXNoKHJvdy5qb2luKCcsJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNzdkZpbGUgPSBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoWzB4RUYsIDB4QkIsIDB4QkZdKSwgY3N2LmpvaW4oJ1xuJyldLCB7dHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7J30pOyAvLyBBZGQgQk9NIGZvciBFeGNlbAogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGNzdkZpbGUpOwogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LmNzdmA7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CgkJCgkJZnVuY3Rpb24gZXhwb3J0VGFibGVBc0ltYWdlKGNvbnRhaW5lcklkLCBmaWxlbmFtZSkgewogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTsKICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLXF1aXotdGl0bGUnKTsgCiAgICAKICAgIGlmICghZWxlbWVudCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNob3dNZXNzYWdlKCLguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguKPguLnguJvguKDguLLguJ4gKOC4i+C5iOC4reC4meC4nOC4peC4peC4seC4nuC4mOC5jCkuLi4iKTsKCiAgICAvLyAxLiDguKrguKPguYnguLLguIcgQ29udGFpbmVyIOC4iuC4seC5iOC4p+C4hOC4o+C4suC4pwogICAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd3JhcHBlci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7CiAgICB3cmFwcGVyLnN0eWxlLnBhZGRpbmcgPSAnMzBweCc7CiAgICB3cmFwcGVyLnN0eWxlLndpZHRoID0gJzEwMDBweCc7IAogICAgd3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7IAogICAgd3JhcHBlci5zdHlsZS5sZWZ0ID0gJy05OTk5cHgnOwogICAgd3JhcHBlci5zdHlsZS50b3AgPSAnMCc7CiAgICB3cmFwcGVyLnN0eWxlLnpJbmRleCA9ICctMSc7CiAgICAKICAgIC8vIDIuIOC4quC4o+C5ieC4suC4h+C4q+C4seC4p+C4guC5ieC4reC4iOC4s+C4peC4reC4hwogICAgY29uc3QgaGVhZGVyQ2xvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwogICAgaGVhZGVyQ2xvbmUuaW5uZXJUZXh0ID0gdGl0bGVFbGVtZW50ID8gdGl0bGVFbGVtZW50LmlubmVyVGV4dCA6ICfguKPguLLguKLguIfguLLguJnguJzguKXguITguLDguYHguJnguJknOwogICAgaGVhZGVyQ2xvbmUuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5mb250RmFtaWx5ID0gIidTYXJhYnVuJywgc2Fucy1zZXJpZiI7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5mb250U2l6ZSA9ICcyOHB4JzsKICAgIGhlYWRlckNsb25lLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5jb2xvciA9ICcjNDMzOGNhJzsgCiAgICBoZWFkZXJDbG9uZS5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMjBweCc7CiAgICAKICAgIC8vIDMuIOC4quC4o+C5ieC4suC4h+C4leC4suC4o+C4suC4h+C4iOC4s+C4peC4reC4hyAoQ2xvbmUgVGFibGUpCiAgICBjb25zdCB0YWJsZUNsb25lID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7CiAgICB0YWJsZUNsb25lLnN0eWxlLm1heEhlaWdodCA9ICdub25lJzsKICAgIHRhYmxlQ2xvbmUuc3R5bGUub3ZlcmZsb3cgPSAndmlzaWJsZSc7CgogICAgLy8gLS0tIFvguYDguJ7guLTguYjguKEgTG9naWM6IOC4i+C5iOC4reC4meC4hOC4reC4peC4seC4oeC4meC5jCAi4Lic4LilIl0gLS0tCiAgICAvLyDguITguYnguJnguKvguLIgaW5kZXgg4LiC4Lit4LiH4Lir4Lix4Lin4LiC4LmJ4Lit4LiV4Liy4Lij4Liy4LiH4LiX4Li14LmI4LmA4LiC4Li14Lii4LiZ4Lin4LmI4LiyICLguJzguKUiCiAgICBjb25zdCBoZWFkZXJzID0gdGFibGVDbG9uZS5xdWVyeVNlbGVjdG9yQWxsKCd0aCcpOwogICAgbGV0IHJlc3VsdENvbHVtbkluZGV4ID0gLTE7CgogICAgaGVhZGVycy5mb3JFYWNoKCh0aCwgaW5kZXgpID0+IHsKICAgICAgICBpZiAodGgudGV4dENvbnRlbnQudHJpbSgpID09PSAn4Lic4LilJykgewogICAgICAgICAgICB0aC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAvLyDguIvguYjguK3guJnguKvguLHguKfguILguYnguK0KICAgICAgICAgICAgcmVzdWx0Q29sdW1uSW5kZXggPSBpbmRleDsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyDguJbguYnguLLguYDguIjguK3guITguK3guKXguLHguKHguJnguYwgIuC4nOC4pSIg4LmD4Lir4LmJ4Lin4LiZ4Lil4Li54Lib4LiL4LmI4Lit4LiZ4LiC4LmJ4Lit4Lih4Li54Lil4LmD4LiZ4LiX4Li44LiB4LmB4LiW4LinCiAgICBpZiAocmVzdWx0Q29sdW1uSW5kZXggIT09IC0xKSB7CiAgICAgICAgY29uc3Qgcm93cyA9IHRhYmxlQ2xvbmUucXVlcnlTZWxlY3RvckFsbCgndHInKTsKICAgICAgICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKTsKICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LmB4LiW4Lin4LiZ4Li14LmJ4Lih4Li1IGNlbGwg4LiE4Lij4Lia4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZ4Lir4Lij4Li34Lit4LmE4Lih4LmIICjguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJkgZXJyb3IpCiAgICAgICAgICAgIGlmIChjZWxscy5sZW5ndGggPiByZXN1bHRDb2x1bW5JbmRleCkgewogICAgICAgICAgICAgICAgY2VsbHNbcmVzdWx0Q29sdW1uSW5kZXhdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IC8vIOC4i+C5iOC4reC4meC4iuC5iOC4reC4h+C4guC5ieC4reC4oeC4ueC4pQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIAogICAgLy8gNC4g4Lib4Lij4Liw4LiB4Lit4Lia4Lij4LmI4Liy4LiHCiAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGhlYWRlckNsb25lKTsKICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQodGFibGVDbG9uZSk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHdyYXBwZXIpOwoKICAgIC8vIDUuIOC4quC4seC5iOC4hyBodG1sMmNhbnZhcyDguJbguYjguLLguKLguKPguLnguJsKICAgIGh0bWwyY2FudmFzKHdyYXBwZXIsIHsKICAgICAgICBzY2FsZTogMiwgCiAgICAgICAgdXNlQ09SUzogdHJ1ZSwKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJwogICAgfSkudGhlbihjYW52YXMgPT4gewogICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgbGluay5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS5wbmdgOwogICAgICAgIGxpbmsuaHJlZiA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwogICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHdyYXBwZXIpOwogICAgICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXhwb3J0IEltYWdlIEVycm9yOiIsIGVycik7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh3cmFwcGVyKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4Lij4Li54Lib4Lig4Liy4LieIik7CiAgICB9KTsKfQoKICAgICAgICAvLyBSRUZBQ1RPUkVEIGV4cG9ydFJlc3VsdHNBc1BERiB0byBleHBvcnRUYWJsZUFzUERGCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0VGFibGVBc1BERih0YWJsZUlkLCBmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCB7IGpzUERGIH0gPSB3aW5kb3cuanNwZGY7CiAgICAgICAgICAgIGNvbnN0IGRvYyA9IG5ldyBqc1BERigpOwogICAgICAgICAgICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywgJ25vcm1hbCcpOyAKICAgICAgICAgICAgZG9jLmF1dG9UYWJsZSh7IGh0bWw6IGAjJHt0YWJsZUlkfWAgfSk7CiAgICAgICAgICAgIGRvYy5zYXZlKGAke2ZpbGVuYW1lfS5wZGZgKTsKICAgICAgICB9CgogICAgICAgIC8vIFJFRkFDVE9SRUQgZXhwb3J0UmVzdWx0c0FzV29yZCB0byBleHBvcnRUYWJsZUFzV29yZAogICAgICAgIGZ1bmN0aW9uIGV4cG9ydFRhYmxlQXNXb3JkKGNvbnRhaW5lcklkLCBmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVySWQpOwogICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gIjxodG1sIHhtbG5zOm89J3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScgIisKICAgICAgICAgICAgICAgICJ4bWxuczp3PSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkJyAiKwogICAgICAgICAgICAgICAgInhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwJz4iKwogICAgICAgICAgICAgICAgIjxoZWFkPjxtZXRhIGNoYXJzZXQ9J3V0Zi04Jz48dGl0bGU+RXhwb3J0IEhUTUwgdG8gV29yZDwvdGl0bGU+PC9oZWFkPjxib2R5PiI7CiAgICAgICAgICAgIGNvbnN0IGZvb3RlciA9ICI8L2JvZHk+PC9odG1sPiI7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhUTUwgPSBoZWFkZXIgKyBlbGVtZW50LmlubmVySFRNTCArIGZvb3RlcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5tcy13b3JkO2NoYXJzZXQ9dXRmLTgsJyArIGVuY29kZVVSSUNvbXBvbmVudChzb3VyY2VIVE1MKTsKICAgICAgICAgICAgY29uc3QgZmlsZURvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVEb3dubG9hZCk7CiAgICAgICAgICAgIGZpbGVEb3dubG9hZC5ocmVmID0gc291cmNlOwogICAgICAgICAgICBmaWxlRG93bmxvYWQuZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uZG9jYDsKICAgICAgICAgICAgZmlsZURvd25sb2FkLmNsaWNrKCk7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZmlsZURvd25sb2FkKTsKICAgICAgICB9CgogICAgICAgIC8vIFJFRkFDVE9SRUQgZXhwb3J0UmVzdWx0c0FzRXhjZWwgdG8gZXhwb3J0VGFibGVBc0V4Y2VsCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0VGFibGVBc0V4Y2VsKHRhYmxlSWQsIGZpbGVuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVJZCk7CiAgICAgICAgICAgIGlmICghdGFibGUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGNzdiA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYmxlLnJvd3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXSwgY29scyA9IHRhYmxlLnJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbCgndGQsIHRoJyk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICByb3cucHVzaCgnIicgKyBjb2xzW2pdLmlubmVyVGV4dC5yZXBsYWNlKC8iL2csICciIicpICsgJyInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNzdi5wdXNoKHJvdy5qb2luKCcsJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNzdkZpbGUgPSBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoWzB4RUYsIDB4QkIsIDB4QkZdKSwgY3N2LmpvaW4oJ1xuJyldLCB7dHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7J30pOwogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGNzdkZpbGUpOwogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYCR7ZmlsZW5hbWV9LmNzdmA7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CgogZnVuY3Rpb24gcmVuZGVyQW5hbHl0aWNzKHF1aXpEYXRhLCBzdWJtaXNzaW9ucykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRXhwb3J0TGVzc29uUERGKCkgewogICAgY29uc3QgbGVzc29uQ29udGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlc3Nvbi1wbGFuLWNvbnRlbnQiKTsKICAgIGNvbnN0IHF1aXpUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tcGxhbi10aXRsZScpLnRleHRDb250ZW50OwogICAgCiAgICAvLyDguYDguJvguLTguJTguKvguJnguYnguLLguJXguYjguLLguIfguYPguKvguKHguYjguYDguJ7guLfguYjguK3guYDguJXguKPguLXguKLguKHguJ7guLTguKHguJ7guYwKICAgIGNvbnN0IHByaW50V2luZG93ID0gd2luZG93Lm9wZW4oJycsICdfYmxhbmsnKTsKCiAgICAvLyDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIcgSFRNTCDguJfguLHguYnguIfguKvguKHguJTguKrguLPguKvguKPguLHguJrguKvguJnguYnguLLguJfguLXguYjguIjguLDguJ7guLTguKHguJ7guYwKICAgIGNvbnN0IHByaW50SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPiR7cXVpelRpdGxlfTwvdGl0bGU+CiAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi50YWlsd2luZGNzcy5jb20iPjxcL3NjcmlwdD4KICAgICAgICAgICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1TYXJhYnVuOndnaHRANDAwOzcwMCZkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXggPSB7CiAgICAgICAgICAgICAgICAgICAgdGV4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZU1hdGg6IFtbJyQnLCAnJCddLCBbJ1xcXFwoJywgJ1xcXFwpJ11dCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgPFwvc2NyaXB0PgogICAgICAgICAgICA8c2NyaXB0IGlkPSJNYXRoSmF4LXNjcmlwdCIgYXN5bmMgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21hdGhqYXhAMy9lczUvdGV4LW1tbC1jaHRtbC5qcyI+PFwvc2NyaXB0PgogICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICBib2R5IHsgCiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdTYXJhYnVuJywgc2Fucy1zZXJpZjsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAbWVkaWEgcHJpbnQgewogICAgICAgICAgICAgICAgICAgIGJvZHkgeyAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3Q7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5jb250ZW50LXNlY3Rpb24geyAKICAgICAgICAgICAgICAgICAgICBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7IC8qIOC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4leC4seC4lOC5gOC4meC4t+C5ieC4reC4q+C4suC4guC5ieC4suC4oeC4q+C4meC5ieC4siAqLwogICAgICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDJyZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTggbWF4LXctNHhsIG14LWF1dG8iPgogICAgICAgICAgICAke2xlc3NvbkNvbnRlbnRFbC5pbm5lckhUTUx9IAogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwogICAgCiAgICAvLyDguYDguILguLXguKLguJkgSFRNTCDguKXguIfguYPguJnguKvguJnguYnguLLguJXguYjguLLguIfguYPguKvguKHguYgKICAgIHByaW50V2luZG93LmRvY3VtZW50LndyaXRlKHByaW50SHRtbCk7CiAgICBwcmludFdpbmRvdy5kb2N1bWVudC5jbG9zZSgpOwoKICAgIC8vIOC4leC4seC5ieC4h+C5gOC4p+C4peC4suC4q+C4meC5iOC4p+C4h+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBNYXRoSmF4IHJlbmRlciDguKrguLnguJXguKPguITguJPguLTguJXguKjguLLguKrguJXguKPguYwgKOC4luC5ieC4suC4oeC4tSkg4LmD4Lir4LmJ4LmA4Liq4Lij4LmH4LiI4LiB4LmI4Lit4LiZ4Liq4Lix4LmI4LiH4Lie4Li04Lih4Lie4LmMCiAgICBwcmludFdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcHJpbnRXaW5kb3cucHJpbnQoKTsKICAgICAgICB9LCAxNTAwKTsgLy8g4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4LiyIDEuNSDguKfguLTguJnguLLguJfguLUKICAgIH07Cn0KCi8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQpmdW5jdGlvbiByZW5kZXJJbnRlcmVzdGluZ1N0YXRzKHF1aXpEYXRhLCBzdWJtaXNzaW9ucykgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludGVyZXN0aW5nLXN0YXRzLWNvbnRhaW5lcicpOwogICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKICAgIGlmIChzdWJtaXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIGNvbC1zcGFuLWZ1bGwgdGV4dC1jZW50ZXIiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC5gOC4nuC4teC4ouC4h+C4nuC4reC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C4quC4luC4tOC4leC4tDwvcD4nOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAxLiDguITguLPguJnguKfguJPguKrguJbguLTguJXguLTguKPguLLguKLguILguYnguK0gKOC4q+C4suC4guC5ieC4reC4l+C4teC5iOC4luC4ueC4gS/guJzguLTguJTguKHguLLguIHguJfguLXguYjguKrguLjguJQpCiAgICBjb25zdCBxdWVzdGlvblN0YXRzID0gcXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+ICh7CiAgICAgICAgaW5kZXg6IGluZGV4ICsgMSwKICAgICAgICB0ZXh0OiBxLnF1ZXN0aW9uVGV4dCB8fCBxLnN0ZW0sCiAgICAgICAgY29ycmVjdDogMAogICAgfSkpOwoKICAgIHN1Ym1pc3Npb25zLmZvckVhY2goc3ViID0+IHsKICAgICAgICBjb25zdCBsYXRlc3RBdHRlbXB0ID0gc3ViLmF0dGVtcHRzW3N1Yi5hdHRlbXB0cy5sZW5ndGggLSAxXTsKICAgICAgICBpZiAobGF0ZXN0QXR0ZW1wdCAmJiBsYXRlc3RBdHRlbXB0LmFuc3dlcnMpIHsKICAgICAgICAgICAgbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZvckVhY2goYW5zID0+IHsKICAgICAgICAgICAgICAgIC8vIOC4hOC5ieC4meC4q+C4suC4guC5ieC4reC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C4iOC4suC4gSAi4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiC4Lit4LiH4LiE4Liz4LiW4Liy4LihIiDguYHguJfguJnguJfguLXguYjguIjguLDguYPguIrguYkgIuC4leC4s+C5geC4q+C4meC5iOC4hyIKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRUb1VwZGF0ZSA9IHF1ZXN0aW9uU3RhdHMuZmluZChxID0+IHEudGV4dCA9PT0gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0ICYmIHN0YXRUb1VwZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHN0YXRUb1VwZGF0ZS5jb3JyZWN0Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnN0IHRvdGFsU3VibWlzc2lvbnMgPSBzdWJtaXNzaW9ucy5sZW5ndGg7CiAgICBjb25zdCBtYXhDb3JyZWN0Q291bnQgPSBNYXRoLm1heCguLi5xdWVzdGlvblN0YXRzLm1hcChxID0+IHEuY29ycmVjdCkpOwogICAgY29uc3QgbWluQ29ycmVjdENvdW50ID0gTWF0aC5taW4oLi4ucXVlc3Rpb25TdGF0cy5tYXAocSA9PiBxLmNvcnJlY3QpKTsKCiAgICBjb25zdCBtb3N0Q29ycmVjdFF1ZXN0aW9ucyA9IHF1ZXN0aW9uU3RhdHMKICAgICAgICAuZmlsdGVyKHEgPT4gcS5jb3JyZWN0ID09PSBtYXhDb3JyZWN0Q291bnQpCiAgICAgICAgLm1hcChxID0+IGDguILguYnguK0gJHtxLmluZGV4fWApOwogICAgICAgIAogICAgY29uc3QgbGVhc3RDb3JyZWN0UXVlc3Rpb25zID0gcXVlc3Rpb25TdGF0cwogICAgICAgIC5maWx0ZXIocSA9PiBxLmNvcnJlY3QgPT09IG1pbkNvcnJlY3RDb3VudCkKICAgICAgICAubWFwKHEgPT4gYOC4guC5ieC4rSAke3EuaW5kZXh9YCk7CgogICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4Liq4LiW4Li04LiV4Li04Lij4Liy4Lii4LiE4LiZICjguKvguLLguITguJnguJfguLXguYjguJbguLnguIEv4Lic4Li04LiU4Lih4Liy4LiB4LiX4Li14LmI4Liq4Li44LiUKQogICAgY29uc3QgdG9wU2NvcmVycyA9IHN1Ym1pc3Npb25zCiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIubGF0ZXN0U2NvcmUgLSBhLmxhdGVzdFNjb3JlKQogICAgICAgIC5maWx0ZXIoKHMsIGksIGFycikgPT4gcy5sYXRlc3RTY29yZSA9PT0gYXJyWzBdLmxhdGVzdFNjb3JlKTsKCiAgICBjb25zdCBsb3dlc3RTY29yZXJzID0gc3VibWlzc2lvbnMKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5sYXRlc3RTY29yZSAtIGIubGF0ZXN0U2NvcmUpCiAgICAgICAgLmZpbHRlcigocywgaSwgYXJyKSA9PiBzLmxhdGVzdFNjb3JlID09PSBhcnJbMF0ubGF0ZXN0U2NvcmUpOwoKICAgIC8vIDMuIOC4quC4o+C5ieC4suC4hyBIVE1MIOC4quC4s+C4q+C4o+C4seC4muC4geC4suC4o+C5jOC4lOC5geC4leC5iOC4peC4sOC5g+C4mgogICAgY29uc3QgaHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmVlbi01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWdyZWVuLTIwMCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIGZhLWxnIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCI+4LiC4LmJ4Lit4LiX4Li14LmI4LiX4Liz4LiW4Li54LiB4Lih4Liy4LiB4LiX4Li14LmI4Liq4Li44LiUPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1ncmVlbi04MDAgdGV4dC1sZyI+JHttb3N0Q29ycmVjdFF1ZXN0aW9ucy5qb2luKCcsICcpfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4oJHttYXhDb3JyZWN0Q291bnR9IC8gJHt0b3RhbFN1Ym1pc3Npb25zfSDguITguJkpPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1yZWQtNTAgcC00IHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1yZWQtMjAwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctcmVkLTEwMCB0ZXh0LXJlZC02MDAgcC0yIHJvdW5kZWQtZnVsbCBtci0zIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSBmYS1sZyI+PC9pPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAiPuC4guC5ieC4reC4l+C4teC5iOC4l+C4s+C4nOC4tOC4lOC4oeC4suC4geC4l+C4teC5iOC4quC4uOC4lDwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtcmVkLTgwMCB0ZXh0LWxnIj4ke2xlYXN0Q29ycmVjdFF1ZXN0aW9ucy5qb2luKCcsICcpfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4oJHt0b3RhbFN1Ym1pc3Npb25zIC0gbWluQ29ycmVjdENvdW50fSAvICR7dG90YWxTdWJtaXNzaW9uc30g4LiE4LiZKTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0iYmctYmx1ZS01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWJsdWUtMjAwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5IGZhLWxnIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCI+4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li14LmI4LiE4Liw4LmB4LiZ4LiZ4Liq4Li54LiH4Liq4Li44LiUPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1ibHVlLTgwMCB0ZXh0LWxnIj4ke3RvcFNjb3JlcnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSkuam9pbignLCAnKX08L3A+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+KOC5hOC4lOC5iSAke3RvcFNjb3JlcnNbMF0ubGF0ZXN0U2NvcmV9IOC4hOC4sOC5geC4meC4mSk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImJnLXllbGxvdy01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLXllbGxvdy0yMDAiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaGFuZHMtaGVscGluZyBmYS1sZyI+PC9pPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAiPuC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4hOC4p+C4o+C4lOC4ueC5geC4peC5gOC4m+C5h+C4meC4nuC4tOC5gOC4qOC4qTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQteWVsbG93LTgwMCB0ZXh0LWxnIj4ke2xvd2VzdFNjb3JlcnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSkuam9pbignLCAnKX08L3A+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+KOC5hOC4lOC5iSAke2xvd2VzdFNjb3JlcnNbMF0ubGF0ZXN0U2NvcmV9IOC4hOC4sOC5geC4meC4mSk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7Cn0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyU3VibWlzc2lvbkNoYXJ0KHN1Ym1pdHRlZENvdW50LCBub3RTdWJtaXR0ZWRDb3VudCwgc3VibWlzc2lvbnMsIHN0dWRlbnRzKSB7CiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXNzaW9uLXN0YXR1cy1jaGFydCcpLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIGNvbnN0IHN1Ym1pdHRlZE5hbWVzID0gc3VibWlzc2lvbnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgIGNvbnN0IG5vdFN1Ym1pdHRlZE5hbWVzID0gc3R1ZGVudHMuZmlsdGVyKG5hbWUgPT4gIXN1Ym1pdHRlZE5hbWVzLmluY2x1ZGVzKG5hbWUpKTsKCiAgICAgICAgICAgIGlmIChjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgICAgICAgICAgdHlwZTogJ2RvdWdobnV0JywKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IFsn4Liq4LmI4LiH4LmB4Lil4LmJ4LinJywgJ+C4ouC4seC4h+C5hOC4oeC5iOC4quC5iOC4hyddLAogICAgICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBbc3VibWl0dGVkQ291bnQsIG5vdFN1Ym1pdHRlZENvdW50XSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBbJyMxMEI5ODEnLCAnI0Y1OUUwQiddLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogWycjZmZmZmZmJywgJyNmZmZmZmYnXSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHBsdWdpbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7IHBvc2l0aW9uOiAnYm90dG9tJyB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24oY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGFiZWwgPSBjb250ZXh0LmxhYmVsIHx8ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9ICc6ICc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gY29udGV4dC5yYXc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyTGFiZWw6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5kYXRhSW5kZXggPT09IDApIHsgLy8gU3VibWl0dGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyA9IHN1Ym1pdHRlZE5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBOb3QgU3VibWl0dGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyA9IG5vdFN1Ym1pdHRlZE5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lcy5sZW5ndGggPiAwID8gbmFtZXMuam9pbignXG4nKSA6ICfguYTguKHguYjguKHguLUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJTY29yZURpc3RyaWJ1dGlvbkNoYXJ0KHN1Ym1pc3Npb25zLCB0b3RhbFF1ZXN0aW9ucykgewogICAgICAgICAgICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtZGlzdHJpYnV0aW9uLWNoYXJ0JykuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgY29uc3Qgc2NvcmVDb3VudHMgPSB7fTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdG90YWxRdWVzdGlvbnM7IGkrKykgewogICAgICAgICAgICAgICAgc2NvcmVDb3VudHNbaV0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1Ym1pc3Npb25zLmZvckVhY2goc3ViID0+IHsKICAgICAgICAgICAgICAgIGlmIChzY29yZUNvdW50c1tzdWIubGF0ZXN0U2NvcmVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzY29yZUNvdW50c1tzdWIubGF0ZXN0U2NvcmVdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGNoYXJ0SW5zdGFuY2VzLnNjb3JlKSB7CiAgICAgICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zY29yZS5kZXN0cm95KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhcnRJbnN0YW5jZXMuc2NvcmUgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgICAgICAgICB0eXBlOiAnYmFyJywKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IE9iamVjdC5rZXlzKHNjb3JlQ291bnRzKSwKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0czogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICfguIjguLPguJnguKfguJnguJnguLHguIHguYDguKPguLXguKLguJknLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBPYmplY3QudmFsdWVzKHNjb3JlQ291bnRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoNzksIDcwLCAyMjksIDAuOCknLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogJ3JnYmEoNzksIDcwLCAyMjksIDEpJywKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7IHN0ZXBTaXplOiAxIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgeDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHsgZGlzcGxheTogdHJ1ZSwgdGV4dDogJ+C4hOC4sOC5geC4meC4mScgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwbHVnaW5zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlckxhYmVsOiBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gY29udGV4dC5sYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHNXaXRoU2NvcmUgPSBzdWJtaXNzaW9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzID0+IHMubGF0ZXN0U2NvcmUgPT0gc2NvcmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKHMgPT4gcy5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHVkZW50c1dpdGhTY29yZS5sZW5ndGggPiAwID8gc3R1ZGVudHNXaXRoU2NvcmUuam9pbignXG4nKSA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgZnVuY3Rpb24gcmVuZGVyUXVlc3Rpb25BbmFseXRpY3MocXVpekRhdGEsIHN1Ym1pc3Npb25zLCBzdHVkZW50cykgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uLWFuYWx5dGljcy1jb250YWluZXInKTsKICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIj7guKLguLHguIfguYTguKHguYjguKHguLXguJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guKfguLTguYDguITguKPguLLguLDguKvguYzguKPguLLguKLguILguYnguK08L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iCAxOiDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguITguLPguJnguKfguJPguKrguJbguLTguJXguLTguJfguLHguYnguIfguKvguKHguJTguJfguLXguYjguIjguLPguYDguJvguYfguJkgLS0tCiAgICBjb25zdCBpdGVtQW5hbHlzaXMgPSBjYWxjdWxhdGVJdGVtQW5hbHlzaXMocXVpekRhdGEsIHN1Ym1pc3Npb25zKTsKICAgIGNvbnN0IGRpc3RyYWN0b3JBbmFseXNpcyA9IGNhbGN1bGF0ZURpc3RyYWN0b3JBbmFseXNpcyhxdWl6RGF0YSwgc3VibWlzc2lvbnMpOwoKICAgIC8vIC0tLSDguKrguYjguKfguJnguJfguLXguYggMjog4Liq4Lij4LmJ4Liy4LiH4LiB4Lil4LmI4Lit4LiH4Liq4Lij4Li44Lib4Lig4Liy4Lie4Lij4Lin4Lih4LiC4Lit4LiH4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiH4LmB4Lil4Liw4LiB4Lil4Li44LmI4Lih4Lit4LmI4Lit4LiZICjguKrguYjguKfguJnguYPguKvguKHguYgpIC0tLQogICAgbGV0IG92ZXJhbGxHcm91cHNIVE1MID0gJyc7CiAgICBpZiAoaXRlbUFuYWx5c2lzLm92ZXJhbGxHcm91cHMpIHsKICAgICAgICBvdmVyYWxsR3JvdXBzSFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJmb250LXNlbWlib2xkIG1iLTIiPuC4quC4o+C4uOC4m+C4oOC4suC4nuC4o+C4p+C4oeC4geC4peC4uOC5iOC4oeC4l+C4teC5iOC5g+C4iuC5ieC5g+C4meC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jDwvaDQ+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00IHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPuC4geC4peC4uOC5iOC4oeC5gOC4geC5iOC4hyAoJHtpdGVtQW5hbHlzaXMub3ZlcmFsbEdyb3Vwcy51cHBlckdyb3VwTmFtZXMubGVuZ3RofSDguITguJkpPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSB0ZXh0LWdyYXktNjAwIG10LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpdGVtQW5hbHlzaXMub3ZlcmFsbEdyb3Vwcy51cHBlckdyb3VwTmFtZXMubWFwKG5hbWUgPT4gYDxsaT4ke25hbWV9PC9saT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCI+4LiB4Lil4Li44LmI4Lih4Lit4LmI4Lit4LiZICgke2l0ZW1BbmFseXNpcy5vdmVyYWxsR3JvdXBzLmxvd2VyR3JvdXBOYW1lcy5sZW5ndGh9IOC4hOC4mSk8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHRleHQtZ3JheS02MDAgbXQtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW1BbmFseXNpcy5vdmVyYWxsR3JvdXBzLmxvd2VyR3JvdXBOYW1lcy5tYXAobmFtZSA9PiBgPGxpPiR7bmFtZX08L2xpPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iCAzOiDguKrguKPguYnguLLguIcgSFRNTCDguKrguLPguKvguKPguLHguJrguKPguLLguKLguKXguLDguYDguK3guLXguKLguJTguYHguJXguYjguKXguLDguILguYnguK0gKOC4p+C4mSBMb29wKSAtLS0KICAgIGxldCBodG1sID0gJyc7CiAgICBjb25zdCBzdWJtaXR0ZWROYW1lcyA9IHN1Ym1pc3Npb25zLm1hcChzID0+IHMuc3R1ZGVudE5hbWUpOwoKICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lij4LmJ4Liy4LiHIEJhZGdlIOC4guC4reC4h+C4hOC5iOC4suC4hOC4p+C4suC4oeC4ouC4suC4gSAocCkKY29uc3QgZ2V0UEJhZGdlID0gKHApID0+IHsKICAgIGlmIChwID49IDAuODApIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLXRlYWwtMTAwIHRleHQtdGVhbC04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guIfguYjguLLguKLguKHguLLguIE8L3NwYW4+YDsKICAgIGlmIChwID49IDAuNjApIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4h+C5iOC4suC4ojwvc3Bhbj5gOwogICAgaWYgKHAgPj0gMC40MCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4m+C4suC4meC4geC4peC4suC4hyAo4LmA4Lir4Lih4Liy4Liw4Liq4LihKTwvc3Bhbj5gOwogICAgaWYgKHAgPj0gMC4yMCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guKLguLLguIE8L3NwYW4+YDsKICAgIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLXJlZC0xMDAgdGV4dC1yZWQtODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4Lii4Liy4LiB4Lih4Liy4LiBPC9zcGFuPmA7Cn07CiAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgQmFkZ2Ug4LiC4Lit4LiH4LiE4LmI4Liy4Lit4Liz4LiZ4Liy4LiI4LiI4Liz4LmB4LiZ4LiBIChyKQpjb25zdCBnZXRSQmFkZ2UgPSAocikgPT4gewogICAgaWYgKHIgPCAwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1waW5rLTIwMCB0ZXh0LXBpbmstOTAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCIgdGl0bGU9IuC4reC4suC4iOC4l+C4s+C5g+C4q+C5ieC5gOC4lOC5h+C4geC4reC5iOC4reC4meC4leC4reC4muC4luC4ueC4geC4oeC4suC4geC4geC4p+C5iOC4suC5gOC4lOC5h+C4geC5gOC4geC5iOC4hyDguJXguYnguK3guIfguYHguIHguYnguYTguILguKvguKPguLfguK3guJXguLHguJTguJfguLTguYnguIciPuC4nOC4tOC4lOC4m+C4geC4leC4tDwvc3Bhbj5gOwogICAgaWYgKHIgPj0gMC40MCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4LiU4Li14Lih4Liy4LiBPC9zcGFuPmA7CiAgICBpZiAociA+PSAwLjMwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4LiU4Li1PC9zcGFuPmA7CiAgICBpZiAociA+PSAwLjIwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4nuC4reC5g+C4iuC5iTwvc3Bhbj5gOwogICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guITguKfguKPguJvguKPguLHguJrguJvguKPguLjguIc8L3NwYW4+YDsKfTsKCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4hyBCYWRnZSDguILguK3guIfguYDguJvguK3guKPguYzguYDguIvguYfguJnguJXguYzguITguJnguJXguK3guJrguJbguLnguIEgKOC5geC4geC5ieC5hOC4guC4peC5iOC4suC4quC4uOC4lCkKY29uc3QgZ2V0UGVyY2VudENvcnJlY3RCYWRnZSA9IChyYXRlKSA9PiB7CiAgICBjb25zdCByb3VuZGVkUmF0ZSA9IHJhdGUudG9GaXhlZCgwKTsKICAgIAogICAgLy8gPT09IOC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iCA9PT0KICAgIC8vIOC4luC5ieC4suC4hOC4sOC5geC4meC4meC5gOC4l+C5iOC4suC4geC4seC4miAxMDAlIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4quC4teC5gOC4guC4teC4ouC4pwogICAgaWYgKHBhcnNlRmxvYXQocm91bmRlZFJhdGUpID09PSAxMDApIHsKICAgICAgICByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1ncmVlbi0yMDAgdGV4dC1ncmVlbi05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7CiAgICB9CiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy8g4LiW4LmJ4Liy4LmA4Lib4Lit4Lij4LmM4LmA4LiL4LmH4LiZ4LiV4LmM4Lih4Liy4LiB4LiB4Lin4LmI4Liy4Lir4Lij4Li34Lit4LmA4LiX4LmI4Liy4LiB4Lix4LiaIDUwJSDguYPguKvguYnguYDguJvguYfguJnguJvguYnguLLguKLguKrguLXguYDguKvguKXguLfguK3guIcKICAgIGlmIChyYXRlID49IDUwKSB7CiAgICAgICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmcteWVsbG93LTIwMCB0ZXh0LXllbGxvdy05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7CiAgICB9CiAgICAvLyDguJnguYnguK3guKLguIHguKfguYjguLIgNTAlIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4m+C5ieC4suC4ouC4quC4teC5geC4lOC4hwogICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctcmVkLTIwMCB0ZXh0LXJlZC05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7Cn07CgogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2goKHEsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBpdGVtQW5hbHlzaXMucGVyUXVlc3Rpb25TdGF0c1tpbmRleF07IC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4iOC4suC4geC5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IGRpc3RyYWN0b3JzID0gZGlzdHJhY3RvckFuYWx5c2lzW2luZGV4XTsKICAgICAgICBjb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0IHx8IHEuaW5zdHJ1Y3Rpb25zOwoKICAgICAgICAvLyDguITguLPguJnguKfguJPguKrguLHguJTguKrguYjguKfguJnguITguJnguJXguK3guJrguJbguLnguIEv4Lic4Li04LiUICjguKDguLLguJ7guKPguKfguKEpCiAgICAgICAgbGV0IGNvcnJlY3RDb3VudCA9IDA7CiAgICAgICAgY29uc3QgY29ycmVjdFN0dWRlbnRzID0gW107CiAgICAgICAgY29uc3QgaW5jb3JyZWN0U3R1ZGVudHMgPSBbXTsKICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAobGF0ZXN0QXR0ZW1wdCAmJiBsYXRlc3RBdHRlbXB0LmFuc3dlcnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckl0ZW0gPSBsYXRlc3RBdHRlbXB0LmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0ID09PSBxdWVzdGlvbkRpc3BsYXlUZXh0KSA/PyBsYXRlc3RBdHRlbXB0LmFuc3dlcnNbaW5kZXhdID8/IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoYW5zd2VySXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdFN0dWRlbnRzLnB1c2goc3ViLnN0dWRlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3RTdHVkZW50cy5wdXNoKHN1Yi5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgY29ycmVjdFJhdGUgPSBzdWJtaXNzaW9ucy5sZW5ndGggPiAwID8gKGNvcnJlY3RDb3VudCAvIHN1Ym1pc3Npb25zLmxlbmd0aCkgKiAxMDAgOiAwOwogICAgICAgIGNvbnN0IHVuc3VibWl0dGVkU3R1ZGVudHMgPSBzdHVkZW50cy5maWx0ZXIobmFtZSA9PiAhc3VibWl0dGVkTmFtZXMuaW5jbHVkZXMobmFtZSkpOwoKICAgICAgIGNvbnN0IGFuYWx5c2lzSFRNTCA9IGFuYWx5c2lzID8gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCBib3JkZXItbCBwbC00IG1sLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgZm9udC1zYW5zIj7guITguYjguLLguITguKfguLLguKHguKLguLLguIEgKHApPC9wPjxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1pbmRpZ28tNzAwIHRleHQtbGciPiR7YW5hbHlzaXMucC50b0ZpeGVkKDIpfTwvcD48ZGl2PiR7Z2V0UEJhZGdlKGFuYWx5c2lzLnApfTwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgZm9udC1zYW5zIj7guITguYjguLLguK3guLPguJnguLLguIjguIjguLPguYHguJnguIEgKHIpPC9wPjxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC10ZWFsLTcwMCB0ZXh0LWxnIj4ke2FuYWx5c2lzLnIudG9GaXhlZCgyKX08L3A+PGRpdj4ke2dldFJCYWRnZShhbmFseXNpcy5yKX08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcGwtMiI+CiAgICAgICAgICAgICAgICAgICAgJHtnZXRQZXJjZW50Q29ycmVjdEJhZGdlKGNvcnJlY3RSYXRlKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YCA6ICcnOwoKICAgICAgICAvLyDguKrguKPguYnguLLguIfguJXguLLguKPguLLguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguJXguLHguKfguKXguKfguIcKICAgICAgICBsZXQgZGlzdHJhY3RvclRhYmxlSFRNTCA9ICcnOwogICAgICAgIGlmIChkaXN0cmFjdG9ycykgewogICAgICAgICAgICBkaXN0cmFjdG9yVGFibGVIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtNCI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQiPuC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4leC4seC4p+C5gOC4peC4t+C4reC4gTo8L3A+CiAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJnLXdoaXRlIGJvcmRlciBtdC0xIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9ImJnLWdyYXktMjAwIj48dHI+PHRoIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guJXguLHguKfguYDguKXguLfguK3guIE8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guIHguKXguLjguYjguKHguYDguIHguYjguIc8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guIHguKXguLjguYjguKHguK3guYjguK3guJk8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guKPguKfguKE8L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5PiR7T2JqZWN0LmtleXMoZGlzdHJhY3RvcnMpLm1hcChvcHRJbmRleCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRpc3RyYWN0b3JzW29wdEluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBwYXJzZUludChvcHRJbmRleCkgPT09IHEuY29ycmVjdEFuc3dlckluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzR29vZERpc3RyYWN0b3IgPSAhaXNDb3JyZWN0ICYmIGRhdGEubG93ZXJfZ3JvdXBfY291bnQgPiBkYXRhLnVwcGVyX2dyb3VwX2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgPHRyIGNsYXNzPSIke2lzQ29ycmVjdCA/ICdiZy1ncmVlbi0xMDAgZm9udC1ib2xkJyA6ICcnfSI+PHRkIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIiPiR7aXNDb3JyZWN0ID8gJ+KclCAnIDogJyd9JHtkYXRhLnRleHR9PC90ZD48dGQgY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtkYXRhLnVwcGVyX2dyb3VwX2NvdW50fTwvdGQ+PHRkIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7ZGF0YS5sb3dlcl9ncm91cF9jb3VudH0gJHtpc0dvb2REaXN0cmFjdG9yID8gJ/CfkY0nIDogJyd9PC90ZD48dGQgY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtkYXRhLnRvdGFsfTwvdGQ+PC90cj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+PC90YWJsZT48L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4Liq4LmI4Lin4LiZ4LmB4Liq4LiU4LiH4Lij4Liy4Lii4LiK4Li34LmI4Lit4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiHL+C4reC5iOC4reC4meC4quC4s+C4q+C4o+C4seC4muC4guC5ieC4reC4meC4seC5ieC4meC5hiAo4Liq4LmI4Lin4LiZ4LmD4Lir4Lih4LmIKQogICAgICAgIGxldCBncm91cERldGFpbHNIVE1MID0gJyc7CiAgICAgICAgaWYgKGFuYWx5c2lzICYmIGFuYWx5c2lzLnVwcGVyR3JvdXBSZXNwb25kZXJzKSB7CiAgICAgICAgICAgIGdyb3VwRGV0YWlsc0hUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC00IGdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCI+4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiHICgke2FuYWx5c2lzLnVwcGVyR3JvdXBSZXNwb25kZXJzLmxlbmd0aH0g4LiE4LiZKTo8L3A+PHVsIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiBzcGFjZS15LTEgbXQtMSI+JHthbmFseXNpcy51cHBlckdyb3VwUmVzcG9uZGVycy5tYXAoc3R1ZGVudCA9PiBgPGxpPiR7c3R1ZGVudC5pc0NvcnJlY3QgPyAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgdGV4dC1ncmVlbi01MDAiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtcmVkLTUwMCI+PC9pPid9ICR7c3R1ZGVudC5uYW1lfTwvbGk+YCkuam9pbignJyl9PC91bD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PjxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPuC4geC4peC4uOC5iOC4oeC4reC5iOC4reC4mSAoJHthbmFseXNpcy5sb3dlckdyb3VwUmVzcG9uZGVycy5sZW5ndGh9IOC4hOC4mSk6PC9wPjx1bCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNjAwIHBsLTIgc3BhY2UteS0xIG10LTEiPiR7YW5hbHlzaXMubG93ZXJHcm91cFJlc3BvbmRlcnMubWFwKHN0dWRlbnQgPT4gYDxsaT4ke3N0dWRlbnQuaXNDb3JyZWN0ID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtZ3JlZW4tNTAwIj48L2k+JyA6ICc8aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSB0ZXh0LXJlZC01MDAiPjwvaT4nfSAke3N0dWRlbnQubmFtZX08L2xpPmApLmpvaW4oJycpfTwvdWw+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8g4Lib4Lij4Liw4LiB4Lit4Lia4Lij4LmI4Liy4LiHIEhUTUwg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiC4Lit4LiH4LiC4LmJ4Lit4LiZ4Lix4LmJ4LiZ4LmGCiAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgIDxkZXRhaWxzIGNsYXNzPSJiZy1ncmF5LTUwIHAtMyByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgIDxzdW1tYXJ5IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgY3Vyc29yLXBvaW50ZXIgZm9udC1zZW1pYm9sZCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InctMi80IHRydW5jYXRlIj7guILguYnguK0gJHtpbmRleCArIDF9OiAke3F1ZXN0aW9uRGlzcGxheVRleHR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00Ij4ke2FuYWx5c2lzSFRNTH08aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tcmlnaHQgZGV0YWlscy1tYXJrZXIiPjwvaT48L2Rpdj4KICAgICAgICAgICAgICAgIDwvc3VtbWFyeT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTMgcHQtMyBib3JkZXItdCB0ZXh0LXNtIHNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guITguLPguJbguLLguKE6PC9zdHJvbmc+ICR7cXVlc3Rpb25EaXNwbGF5VGV4dH08L3A+CiAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guKrguJbguLTguJXguLQ6PC9zdHJvbmc+IOC4meC4seC4geC5gOC4o+C4teC4ouC4mSAke2NvcnJlY3RDb3VudH0g4LiI4Liy4LiBICR7c3VibWlzc2lvbnMubGVuZ3RofSDguITguJnguJfguLXguYjguKrguYjguIcg4LiV4Lit4Lia4LiW4Li54LiBICgke2NvcnJlY3RSYXRlLnRvRml4ZWQoMCl9JSk8L3A+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMiI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmVlbi03MDAiPuC4leC4reC4muC4luC4ueC4gSAoJHtjb3JyZWN0U3R1ZGVudHMubGVuZ3RofSDguITguJkpOjwvcD48cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNjAwIHBsLTIiPiR7Y29ycmVjdFN0dWRlbnRzLmxlbmd0aCA+IDAgPyBjb3JyZWN0U3R1ZGVudHMuam9pbignLCAnKSA6ICfguYTguKHguYjguKHguLUnfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIj48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXJlZC03MDAiPuC4leC4reC4muC4nOC4tOC4lCAoJHtpbmNvcnJlY3RTdHVkZW50cy5sZW5ndGh9IOC4hOC4mSk6PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiI+JHtpbmNvcnJlY3RTdHVkZW50cy5sZW5ndGggPiAwID8gaW5jb3JyZWN0U3R1ZGVudHMuam9pbignLCAnKSA6ICfguYTguKHguYjguKHguLUnfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIj48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNTAwIj7guKLguLHguIfguYTguKHguYjguKrguYjguIcgKCR7dW5zdWJtaXR0ZWRTdHVkZW50cy5sZW5ndGh9IOC4hOC4mSk6PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiI+JHt1bnN1Ym1pdHRlZFN0dWRlbnRzLmxlbmd0aCA+IDAgPyB1bnN1Ym1pdHRlZFN0dWRlbnRzLmpvaW4oJywgJykgOiAn4LmE4Lih4LmI4Lih4Li1J308L3A+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgJHtkaXN0cmFjdG9yVGFibGVIVE1MfQogICAgICAgICAgICAgICAgICAgICR7Z3JvdXBEZXRhaWxzSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2RldGFpbHM+CiAgICAgICAgYDsKICAgIH0pOwogICAgCiAgICAvLyAtLS0g4Liq4LmI4Lin4LiZ4LiX4Li14LmIIDQ6IOC4meC4syBIVE1MIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5hOC4m+C5geC4quC4lOC4h+C4nOC4peC5g+C4meC4q+C4meC5ieC4suC5gOC4p+C5h+C4miAtLS0KICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBvdmVyYWxsR3JvdXBzSFRNTCArIGh0bWw7CiAgICAKICAgIHRyeSB7CiAgICAgICAgaWYgKHdpbmRvdy5NYXRoSmF4ICYmIE1hdGhKYXgudHlwZXNldFByb21pc2UpIHsKICAgICAgICAgICAgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbY29udGFpbmVyXSk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ01hdGhKYXggdHlwZXNldCBlcnJvciAoYW5hbHl0aWNzKTonLCBlKTsKICAgIH0KfQoKLyoqCiAqIOC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4m+C4o+C4sOC4quC4tOC4l+C4mOC4tOC4oOC4suC4nuC4guC4reC4h+C4leC4seC4p+C4peC4p+C4h+C5g+C4meC4guC5ieC4reC4quC4reC4muC4m+C4o+C4meC4seC4ouC5geC4leC5iOC4peC4sOC4guC5ieC4rQogKiBAcGFyYW0ge29iamVjdH0gcXVpekRhdGEg4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCiAqIEBwYXJhbSB7QXJyYXl9IHN1Ym1pc3Npb25zIOC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4uOC4geC4hOC4mQogKiBAcmV0dXJucyB7b2JqZWN0fSDguJzguKXguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYzguJXguLHguKfguKXguKfguIfguILguK3guIfguYHguJXguYjguKXguLDguILguYnguK0KICovCmZ1bmN0aW9uIGNhbGN1bGF0ZURpc3RyYWN0b3JBbmFseXNpcyhxdWl6RGF0YSwgc3VibWlzc2lvbnMpIHsKICAgIGNvbnN0IGRpc3RyYWN0b3JSZXN1bHRzID0ge307CiAgICBpZiAoc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgcmV0dXJuIGRpc3RyYWN0b3JSZXN1bHRzOwoKICAgIGNvbnN0IHNvcnRlZFN1Ym1pc3Npb25zID0gWy4uLnN1Ym1pc3Npb25zXS5zb3J0KChhLCBiKSA9PiB7CiAgICAvLyAxLiDguYDguKPguLXguKLguIfguJXguLLguKHguITguLDguYHguJnguJnguKXguYjguLLguKrguLjguJQgKOC4oeC4suC4geC5hOC4m+C4meC5ieC4reC4oikKICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIubGF0ZXN0U2NvcmUgLSBhLmxhdGVzdFNjb3JlOwogICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKCiAgICAvLyAyLiDguJbguYnguLLguITguLDguYHguJnguJnguYDguJfguYjguLLguIHguLHguJkg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4LiX4LizICjguJnguYnguK3guKLguYTguJvguKHguLLguIEpCiAgICBjb25zdCBhdHRlbXB0c0EgPSBhLmF0dGVtcHRzPy5sZW5ndGggfHwgMTsKICAgIGNvbnN0IGF0dGVtcHRzQiA9IGIuYXR0ZW1wdHM/Lmxlbmd0aCB8fCAxOwogICAgY29uc3QgYXR0ZW1wdERpZmYgPSBhdHRlbXB0c0EgLSBhdHRlbXB0c0I7CiAgICBpZiAoYXR0ZW1wdERpZmYgIT09IDApIHJldHVybiBhdHRlbXB0RGlmZjsKCiAgICAvLyAzLiDguJbguYnguLLguIjguLPguJnguKfguJnguITguKPguLHguYnguIfguYDguJfguYjguLLguIHguLHguJkg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiHICjguIHguYjguK3guJnguYTguJvguKvguKXguLHguIcpCiAgICBjb25zdCB0aW1lQSA9IG5ldyBEYXRlKGEubGF0ZXN0U3VibWl0dGVkQXQpOwogICAgY29uc3QgdGltZUIgPSBuZXcgRGF0ZShiLmxhdGVzdFN1Ym1pdHRlZEF0KTsKICAgIGNvbnN0IHRpbWVEaWZmID0gdGltZUEgLSB0aW1lQjsKICAgIGlmICh0aW1lRGlmZiAhPT0gMCkgcmV0dXJuIHRpbWVEaWZmOwoKICAgIC8vIDQuIOC4luC5ieC4suC5gOC4p+C4peC4suC4quC5iOC4h+C5gOC4l+C5iOC4suC4geC4seC4mSDguYPguKvguYnguYDguKPguLXguKLguIfguJXguLLguKHguIrguLfguYjguK0gKOC4gS3guK4pCiAgICByZXR1cm4gYS5zdHVkZW50TmFtZS5sb2NhbGVDb21wYXJlKGIuc3R1ZGVudE5hbWUsICd0aCcpOwp9KTsKICAgIGNvbnN0IHRvdGFsU3R1ZGVudHMgPSBzb3J0ZWRTdWJtaXNzaW9ucy5sZW5ndGg7CiAgICBjb25zdCBncm91cFNpemUgPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKHRvdGFsU3R1ZGVudHMgKiAwLjMzKSk7IC8vIOC4m+C5ieC4reC4h+C4geC4seC4mSBncm91cFNpemUg4LmA4Lib4LmH4LiZIDAKCiAgICBjb25zdCB1cHBlckdyb3VwID0gc29ydGVkU3VibWlzc2lvbnMuc2xpY2UoMCwgZ3JvdXBTaXplKTsKICAgIGNvbnN0IGxvd2VyR3JvdXAgPSBzb3J0ZWRTdWJtaXNzaW9ucy5zbGljZSgtZ3JvdXBTaXplKTsKCiAgICBxdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24sIGluZGV4KSA9PiB7CiAgICAgICAgLy8g4LiX4Liz4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmA4LiJ4Lie4Liy4Liw4LiC4LmJ4Lit4Liq4Lit4Lia4Lib4Lij4LiZ4Lix4Lii4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgaWYgKHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSAhPT0gJ211bHRpcGxlX2Nob2ljZScgfHwgIXF1ZXN0aW9uLm9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcXVlc3Rpb25UZXh0ID0gcXVlc3Rpb24ucXVlc3Rpb25UZXh0OwogICAgICAgIGNvbnN0IGFuYWx5c2lzID0ge307CiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4Liq4Liz4Lir4Lij4Lix4Lia4LiZ4Lix4Lia4LmB4LiV4LmI4Lil4Liw4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBCiAgICAgICAgcXVlc3Rpb24ub3B0aW9ucy5mb3JFYWNoKChvcHQsIG9wdEluZGV4KSA9PiB7CiAgICAgICAgICAgIGFuYWx5c2lzW29wdEluZGV4XSA9IHsKICAgICAgICAgICAgICAgIHRleHQ6IG9wdCwKICAgICAgICAgICAgICAgIHVwcGVyX2dyb3VwX2NvdW50OiAwLAogICAgICAgICAgICAgICAgbG93ZXJfZ3JvdXBfY291bnQ6IDAsCiAgICAgICAgICAgICAgICB0b3RhbDogMAogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICAvLyDguKfguJnguKXguLnguJvguYDguJ7guLfguYjguK3guJnguLHguJrguIjguLPguJnguKfguJnguITguJnguYDguKXguLfguK3guIHguYPguJnguYHguJXguYjguKXguLDguIHguKXguLjguYjguKEKICAgICAgICBzb3J0ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBjb25zdCBhbnN3ZXJJdGVtID0gbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZpbmQoYW5zID0+IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCA9PT0gcXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtICYmIGFuc3dlckl0ZW0uYW5zd2VyICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0g4LiI4Li44LiU4LmB4LiB4LmJ4LmE4LiC4Lia4Lix4LmK4LiBIC0tLQogICAgICAgICAgICAgICAgLy8g4LiE4LmJ4LiZ4Lir4Liy4LiU4Lix4LiK4LiZ4Li14LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LiI4Liy4LiBICLguILguYnguK3guITguKfguLLguKEiIOC5geC4l+C4meC4l+C4teC5iOC4iOC4sOC5g+C4iuC5iSAi4LiV4Liz4LmB4Lir4LiZ4LmI4LiHIiDguJfguLXguYjguJzguLTguJTguYDguJ7guLXguYnguKLguJkKICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RPcmlnaW5hbEluZGV4ID0gcXVlc3Rpb24ub3B0aW9ucy5maW5kSW5kZXgob3B0ID0+IG9wdCA9PT0gYW5zd2VySXRlbS5hbnN3ZXJUZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoY29ycmVjdE9yaWdpbmFsSW5kZXggIT09IC0xICYmIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XSkgewogICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS50b3RhbCsrOwoKICAgICAgICAgICAgICAgICAgICAvLyDguYDguIrguYfguITguKfguYjguLLguYDguJvguYfguJnguITguJnguYPguJnguIHguKXguLjguYjguKHguYDguIHguYjguIfguKvguKPguLfguK3guIHguKXguLjguYjguKHguK3guYjguK3guJkKICAgICAgICAgICAgICAgICAgICBpZiAodXBwZXJHcm91cC5pbmNsdWRlcyhzdWIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS51cHBlcl9ncm91cF9jb3VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobG93ZXJHcm91cC5pbmNsdWRlcyhzdWIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS5sb3dlcl9ncm91cF9jb3VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGRpc3RyYWN0b3JSZXN1bHRzW2luZGV4XSA9IGFuYWx5c2lzOwogICAgfSk7CgogICAgcmV0dXJuIGRpc3RyYWN0b3JSZXN1bHRzOwp9CgovKioKICog4LiE4Liz4LiZ4Lin4LiT4LiE4LmI4Liy4LiE4Lin4Liy4Lih4LmA4LiK4Li34LmI4Lit4Lih4Lix4LmI4LiZ4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiU4LmJ4Lin4Lii4Liq4Li54LiV4LijIEtSLTIwCiAqIEBwYXJhbSB7b2JqZWN0fSBxdWl6RGF0YSDguILguYnguK3guKHguLnguKXguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJoKICogQHBhcmFtIHtBcnJheX0gc3VibWlzc2lvbnMg4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li44LiB4LiE4LiZCiAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtQW5hbHlzaXMg4Lic4Lil4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiE4LmI4LiyIHAg4LiC4Lit4LiH4LmB4LiV4LmI4Lil4Liw4LiC4LmJ4LitCiAqIEByZXR1cm5zIHtudW1iZXJ8bnVsbH0g4LiE4LmI4LiyIEtSLTIwIOC4q+C4o+C4t+C4rSBudWxsIOC4luC5ieC4suC4hOC4s+C4meC4p+C4k+C5hOC4oeC5iOC5hOC4lOC5iQogKi8KLy8g4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCmZ1bmN0aW9uIGNhbGN1bGF0ZVJlbGlhYmlsaXR5S1IyMChxdWl6RGF0YSwgc3VibWlzc2lvbnMsIGl0ZW1BbmFseXNpcykgewogICAgY29uc3QgayA9IHF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CiAgICBpZiAoayA8IDIgfHwgc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgcmV0dXJuIG51bGw7CgogICAgLy8gLS0tIFvguYHguIHguYnguYTguIJdIOC4hOC4s+C4meC4p+C4k+C4hOC4sOC5geC4meC4meC4lOC4tOC4muC5geC4muC4miAi4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiW4Li54LiBIiAoVW53ZWlnaHRlZCBTY29yZSkgLS0tCiAgICAvLyDguYDguJ7guLfguYjguK3guYPguKvguYnguKrguK3guJTguITguKXguYnguK3guIfguIHguLHguJrguKrguLnguJXguKMgS1ItMjAg4LiX4Li14LmI4LmD4LiK4LmJ4LiE4LmI4LiyIHAgKOC4quC4seC4lOC4quC5iOC4p+C4meC4hOC4meC4leC4reC4muC4luC4ueC4gSkKICAgIGNvbnN0IHVud2VpZ2h0ZWRTY29yZXMgPSBzdWJtaXNzaW9ucy5tYXAoc3ViID0+IHsKICAgICAgICAvLyDguJTguLbguIfguIHguLLguKPguJfguLPguITguKPguLHguYnguIfguKXguYjguLLguKrguLjguJQKICAgICAgICBjb25zdCBhdHRlbXB0ID0gc3ViLmF0dGVtcHRzICYmIHN1Yi5hdHRlbXB0cy5sZW5ndGggPiAwIAogICAgICAgICAgICA/IHN1Yi5hdHRlbXB0c1tzdWIuYXR0ZW1wdHMubGVuZ3RoIC0gMV0gCiAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgaWYgKCFhdHRlbXB0IHx8ICFhdHRlbXB0LmFuc3dlcnMpIHJldHVybiAwOwogICAgICAgIAogICAgICAgIC8vIOC4meC4seC4muC4iOC4s+C4meC4p+C4meC4guC5ieC4reC4l+C4teC5iOC4leC4reC4muC4luC4ueC4gSAoaXNDb3JyZWN0ID0gdHJ1ZSkg4LmC4LiU4Lii4LmE4Lih4LmI4Liq4LiZ4LmD4LiI4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LiE4Liw4LmB4LiZ4LiZCiAgICAgICAgcmV0dXJuIGF0dGVtcHQuYW5zd2Vycy5maWx0ZXIoYSA9PiBhLmlzQ29ycmVjdCkubGVuZ3RoOwogICAgfSk7CgogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiE4Lin4Liy4Lih4LmB4Lib4Lij4Lib4Lij4Lin4LiZIChWYXJpYW5jZSkg4LiI4Liy4LiB4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4LiX4Li14LmI4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4LitCiAgICBjb25zdCBtZWFuID0gdW53ZWlnaHRlZFNjb3Jlcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHVud2VpZ2h0ZWRTY29yZXMubGVuZ3RoOwogICAgY29uc3Qgc2NvcmVWYXJpYW5jZSA9IHVud2VpZ2h0ZWRTY29yZXMubWFwKHNjb3JlID0+IE1hdGgucG93KHNjb3JlIC0gbWVhbiwgMikpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gdW53ZWlnaHRlZFNjb3Jlcy5sZW5ndGg7CgogICAgaWYgKHNjb3JlVmFyaWFuY2UgPT09IDApIHJldHVybiBudWxsOwoKICAgIGxldCBzdW1fcHEgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrOyBpKyspIHsKICAgICAgICBjb25zdCBwID0gaXRlbUFuYWx5c2lzW2ldPy5wOwogICAgICAgIGlmIChwID09PSB1bmRlZmluZWQpIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IHEgPSAxIC0gcDsKICAgICAgICBzdW1fcHEgKz0gcCAqIHE7CiAgICB9CgogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4Lin4Liy4Lih4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LiC4Lit4LiHIHN1bV9wcQogICAgaWYgKHN1bV9wcSA9PT0gMCkgcmV0dXJuIG51bGw7CgogICAgY29uc3Qga3IyMCA9IChrIC8gKGsgLSAxKSkgKiAoMSAtIChzdW1fcHEgLyBzY29yZVZhcmlhbmNlKSk7CgogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4LmI4Liy4LmA4LiB4Li04LiZIDEgKOC4nOC4tOC4lOC4m+C4geC4leC4tCkKICAgIGlmIChrcjIwID4gMSkgcmV0dXJuIG51bGw7CgogICAgcmV0dXJuIGtyMjA7Cn0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlQW5hbHl6ZUNsYXNzKCkgewogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiB4Liz4Lil4Lix4LiH4LiU4Li54Lit4Lii4Li54LmI4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSB8fCAhY3VycmVudFF1aXpEYXRhLmlkKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDog4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7Y3VycmVudFF1aXpEYXRhLmlkfS9zdWJtaXNzaW9uc2ApOwogICAgY29uc3Qgc3VibWlzc2lvbnNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3Moc3VibWlzc2lvbnNSZWYpOwogICAgY29uc3Qgc3VibWlzc2lvbnMgPSBzdWJtaXNzaW9uc1NuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuZGF0YSgpKTsKCiAgICBpZiAoc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgewogICAgICAgIHNob3dNZXNzYWdlKCLguJXguYnguK3guIfguKHguLXguJnguLHguIHguYDguKPguLXguKLguJnguKrguYjguIfguIfguLLguJnguK3guKLguYjguLLguIfguJnguYnguK3guKIgMiDguITguJnguILguLbguYnguJnguYTguJsg4LiI4Li24LiH4LiI4Liw4Liq4Liy4Lih4Liy4Lij4LiW4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lig4Liy4Lie4Lij4Lin4Lih4LmE4LiU4LmJIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGFuYWx5c2lzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVuZ3RoLXdlYWtuZXNzLWFuYWx5c2lzLWNvbnRhaW5lcicpOwogICAgYW5hbHlzaXNDb250YWluZXIuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHB5LTgiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQtZ3JheS02MDAiPkFJIOC4geC4s+C4peC4seC4h+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4oOC4suC4nuC4o+C4p+C4oS4uLiDguK3guLLguIjguYPguIrguYnguYDguKfguKXguLLguKrguLHguIHguITguKPguLnguYg8L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emUtc3RyZW5ndGhzLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKCiAgICAvLyDguKrguKPguLjguJvguILguYnguK3guKHguLnguKXguITguLPguJXguK3guJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguJfguLjguIHguITguJnguYDguJ7guLfguYjguK3guKrguYjguIfguYPguKvguYkgQUkKICAgIGNvbnN0IHN0dWRlbnREYXRhU3VtbWFyeSA9IHN1Ym1pc3Npb25zLm1hcCgoc3ViLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgIGlmICghbGF0ZXN0QXR0ZW1wdCkgcmV0dXJuICcnOyAvLyDguILguYnguLLguKHguIHguKPguJPguLXguJfguLXguYjguYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguIHguLLguKPguJfguLPguILguYnguK3guKrguK3guJoKICAgICAgICByZXR1cm4gYAogICAgICAgICAgICDguJnguLHguIHguYDguKPguLXguKLguJnguITguJnguJfguLXguYggJHtpbmRleCArIDF9ICgke3N1Yi5zdHVkZW50TmFtZX0pOgogICAgICAgICAgICDguITguLDguYHguJnguJk6ICR7bGF0ZXN0QXR0ZW1wdC5zY29yZX0vJHtzdWIudG90YWxRdWVzdGlvbnN9CiAgICAgICAgICAgIOC4hOC4s+C4leC4reC4muC4o+C4suC4ouC4guC5ieC4rTogJHtKU09OLnN0cmluZ2lmeShsYXRlc3RBdHRlbXB0LmFuc3dlcnMpfQogICAgICAgIGA7CiAgICB9KS5qb2luKCdcbi0tLVxuJyk7CgogICAgY29uc3QgYW5hbHlzaXNQcm9tcHQgPSBgCiAgICAgICAg4LiE4Li44LiT4LiE4Li34Lit4LiZ4Lix4LiB4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiB4Liy4Lij4Lio4Li24LiB4Lip4Liy4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiNIOC4oOC4suC4o+C4geC4tOC4iOC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4reC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4oOC4suC4nuC4o+C4p+C4oeC4guC4reC4h+C4q+C5ieC4reC4h+C5gOC4o+C4teC4ouC4meC4iOC4suC4geC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4mgoKICAgICAgICDguYHguJrguJrguJfguJTguKrguK3guJrguYDguKPguLfguYjguK3guIc6ICIke2N1cnJlbnRRdWl6RGF0YS50b3BpY30iCiAgICAgICAg4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiW4Liy4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUOiAke0pTT04uc3RyaW5naWZ5KGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMpfQoKICAgICAgICDguJnguLXguYjguITguLfguK3guILguYnguK3guKHguLnguKXguKrguKPguLjguJvguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguKvguYnguK3guIc6CiAgICAgICAgJHtzdHVkZW50RGF0YVN1bW1hcnl9CgogICAgICAgIOC4iOC4suC4geC4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lCDguYLguJvguKPguJTguKfguLTguYDguITguKPguLLguLDguKvguYzguYHguKXguLDguKrguKPguLjguJvguJzguKXguK3guK3guIHguKHguLLguYDguJvguYfguJkgSlNPTiBvYmplY3Qg4LiX4Li14LmI4Lih4Li14LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LiU4Lix4LiH4LiZ4Li14LmJ4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZOgogICAgICAgIC0gY2xhc3NTdHJlbmd0aHM6IOC4iOC4uOC4lOC5geC4guC5h+C4h+C5guC4lOC4ouC4o+C4p+C4oeC4guC4reC4h+C4q+C5ieC4reC4h+C5gOC4o+C4teC4ouC4meC4meC4teC5iSDguKvguKPguLfguK3guITguK3guJnguYDguIvguYfguJvguJXguYzguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKrguYjguKfguJnguYPguKvguI3guYjguYDguILguYnguLLguYPguIjguJXguKPguIfguIHguLHguJkgKGFycmF5IOC4guC4reC4hyBzdHJpbmcpCiAgICAgICAgLSBjbGFzc1dlYWtuZXNzZXM6IOC4iOC4uOC4lOC4reC5iOC4reC4meC5guC4lOC4ouC4o+C4p+C4oSDguKvguKPguLfguK3guITguKfguLLguKHguYDguILguYnguLLguYPguIjguJzguLTguJTguJfguLXguYjguJ7guJrguJrguYjguK3guKLguJfguLXguYjguKrguLjguJQgKGFycmF5IOC4guC4reC4hyBzdHJpbmcpCiAgICAgICAgLSB0ZWFjaGVyU3VnZ2VzdGlvbnM6IOC4guC5ieC4reC5gOC4quC4meC4reC5geC4meC4sOC5gOC4iuC4tOC4h+C4m+C4j+C4tOC4muC4seC4leC4tCAyLTMg4LiC4LmJ4Lit4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Lij4Li5IOC5gOC4nuC4t+C5iOC4reC4meC4s+C5hOC4m+C4nuC4seC4kuC4meC4suC4geC4suC4o+C4quC4reC4meC5g+C4meC4hOC4o+C4seC5ieC4h+C4leC5iOC4reC5hOC4myAoYXJyYXkg4LiC4Lit4LiHIHN0cmluZykKCiAgICAgICAg4LiV4Lit4Lia4LmA4Lib4LmH4LiZ4Lig4Liy4Lip4Liy4LmE4LiX4Lii4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICBgOwoKICAgIGNvbnN0IGFuYWx5c2lzU2NoZW1hID0gewogICAgICAgIHR5cGU6ICJPQkpFQ1QiLAogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgY2xhc3NTdHJlbmd0aHM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LAogICAgICAgICAgICBjbGFzc1dlYWtuZXNzZXM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LAogICAgICAgICAgICB0ZWFjaGVyU3VnZ2VzdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9CiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogWyJjbGFzc1N0cmVuZ3RocyIsICJjbGFzc1dlYWtuZXNzZXMiLCAidGVhY2hlclN1Z2dlc3Rpb25zIl0KICAgIH07CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBhbmFseXNpc1Jlc3VsdCA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShhbmFseXNpc1Byb21wdCwgYW5hbHlzaXNTY2hlbWEpOwogICAgICAgIGRpc3BsYXlDbGFzc0FuYWx5c2lzKGFuYWx5c2lzUmVzdWx0KTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIGNsYXNzIGFuYWx5c2lzOiIsIGVycm9yKTsKICAgICAgICBhbmFseXNpc0NvbnRhaW5lci5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idGV4dC1yZWQtNTAwIHRleHQtY2VudGVyIj48cD7guILguK3guK3guKDguLHguKIsIOC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4peC5ieC4oeC5gOC4q+C4peC4pzogJHtlcnJvci5tZXNzYWdlfTwvcD48L2Rpdj5gOwogICAgfSBmaW5hbGx5IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZS1zdHJlbmd0aHMtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KfQpmdW5jdGlvbiBkaXNwbGF5Q2xhc3NBbmFseXNpcyhkYXRhKSB7CiAgICBjb25zdCBhbmFseXNpc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHJlbmd0aC13ZWFrbmVzcy1hbmFseXNpcy1jb250YWluZXInKTsKICAgIGlmICghZGF0YSkgewogICAgICAgIGFuYWx5c2lzQ29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1yZWQtNTAwIj7guYTguKHguYjguYTguJTguYnguKPguLHguJrguILguYnguK3guKHguLnguKXguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYzguIjguLLguIEgQUk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBhbmFseXNpc0NvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iZmFkZS1pbiBzcGFjZS15LTQgbXQtNCBib3JkZXItdCBwdC00Ij4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtZ3JlZW4tNzAwIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIiPjwvaT7guIjguLjguJTguYHguILguYfguIfguILguK3guIfguKvguYnguK3guIfguYDguKPguLXguKLguJk8L2g0PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0xIGJnLWdyZWVuLTUwIHAtMyByb3VuZGVkLWxnIHRleHQtZ3JlZW4tODAwIj4KICAgICAgICAgICAgICAgICAgICAke2RhdGEuY2xhc3NTdHJlbmd0aHMubWFwKGl0ZW0gPT4gYDxsaT4ke2l0ZW19PC9saT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtcmVkLTcwMCBtYi0yIj48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSBtci0yIj48L2k+4LiI4Li44LiU4Lit4LmI4Lit4LiZIC8g4LiE4Lin4Liy4Lih4LmA4LiC4LmJ4Liy4LmD4LiI4Lic4Li04LiU4LiX4Li14LmI4Lie4Lia4Lia4LmI4Lit4LiiPC9oND4KICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHNwYWNlLXktMSBiZy1yZWQtNTAgcC0zIHJvdW5kZWQtbGcgdGV4dC1yZWQtODAwIj4KICAgICAgICAgICAgICAgICAgICAke2RhdGEuY2xhc3NXZWFrbmVzc2VzLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICA8aDQgY2xhc3M9InRleHQtbGcgZm9udC1zZW1pYm9sZCB0ZXh0LWJsdWUtNzAwIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIG1yLTIiPjwvaT7guILguYnguK3guYDguKrguJnguK3guYHguJnguLDguKrguLPguKvguKPguLHguJrguITguKPguLk8L2g0PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0xIGJnLWJsdWUtNTAgcC0zIHJvdW5kZWQtbGcgdGV4dC1ibHVlLTgwMCI+CiAgICAgICAgICAgICAgICAgICAke2RhdGEudGVhY2hlclN1Z2dlc3Rpb25zLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7Cn0KZnVuY3Rpb24gZm9ybWF0QW5kUHJpbnRXb3Jrc2hlZXQocXVpekRhdGEsIHdvcmtzaGVldFdpbmRvdykgeyAKICAgIGNvbnN0IHdvcmtzaGVldEh0bWwgPSBgCiAgICAgICAgPCFET0NUWVBFIGh0bWw+CiAgICAgICAgPGh0bWwgbGFuZz0idGgiPgogICAgICAgIDxoZWFkPgogICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICAgICAgICAgIDx0aXRsZT7guYPguJrguIfguLLguJk6ICR7cXVpekRhdGEudG9waWN9PC90aXRsZT4KICAgICAgICAgICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbSI+PFwvc2NyaXB0PgogICAgICAgICAgICA8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PVNhcmFidW46d2dodEA0MDA7NzAwJmRpc3BsYXk9c3dhcCIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxzY3JpcHQ+IHdpbmRvdy5NYXRoSmF4ID0geyB0ZXg6IHsgaW5saW5lTWF0aDogW1snJCcsICckJ10sIFsnXFwoJywgJ1xcKSddXSB9IH07IDxcL3NjcmlwdD4KICAgICAgICAgICAgPHNjcmlwdCBpZD0iTWF0aEpheC1zY3JpcHQiIGFzeW5jIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tYXRoamF4QDMvZXM1L3RleC1tbWwtY2h0bWwuanMiPjxcL3NjcmlwdD4KICAgICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2FyYWJ1bicsIHNhbnMtc2VyaWY7IH0KICAgICAgICAgICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAgICAgICAgIC5uby1wcmludCB7IGRpc3BsYXk6IG5vbmU7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5xdWVzdGlvbi1pdGVtIHsgcGFnZS1icmVhay1pbnNpZGU6IGF2b2lkOyB9CiAgICAgICAgICAgICAgICAuYW5zd2VyLWxpbmUgewogICAgICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQgYmxhY2s7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCU7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDFyZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTgiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi04Ij4KICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIj7guYPguJrguIfguLLguJnguYDguKPguLfguYjguK3guIc6ICR7cXVpekRhdGEudG9waWN9PC9oMT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIG1iLTggdGV4dC1sZyI+CiAgICAgICAgICAgICAgICA8cD7guIrguLfguYjguK06IC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uPC9wPgogICAgICAgICAgICAgICAgPHA+4Lin4Lix4LiZ4LiX4Li14LmIOiAuLi4uLi4uLy4uLi4uLi4vLi4uLi4uLi4uPC9wPgogICAgICAgICAgICAgICAgPHA+4LiE4Liw4LmB4LiZ4LiZOiAuLi4uLi4uLi4uLi4uLi4uLjwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiI+CiAgICAgICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icXVlc3Rpb24taXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgbWItMiI+JHtpbmRleCArIDF9LiAke3EucXVlc3Rpb25UZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtxLmltYWdlQ29kZSA/IGA8ZGl2IGNsYXNzPSJteS0yIGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+4LiV4Lit4LiaOjwvc3Ryb25nPiA8c3BhbiBjbGFzcz0iYW5zd2VyLWxpbmUiPjwvc3Bhbj48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwogICAgd29ya3NoZWV0V2luZG93LmRvY3VtZW50LndyaXRlKHdvcmtzaGVldEh0bWwpOwogICAgd29ya3NoZWV0V2luZG93LmRvY3VtZW50LmNsb3NlKCk7CiAgICB3b3Jrc2hlZXRXaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4LiB4Liy4Lij4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4Liy4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4Lii4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJIE1hdGhKYXgg4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiI4LiB4LmI4Lit4LiZ4Lie4Li04Lih4Lie4LmMCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHdvcmtzaGVldFdpbmRvdy5wcmludCgpOwogICAgICAgIH0sIDEwMDApOyAvLyDguKvguJnguYjguKfguIfguYDguKfguKXguLIgMSDguKfguLTguJnguLLguJfguLUKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXb3Jrc2hlZXQoKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN0YXJ0U3luY01vZGUocXVpeklkLCBzaG91bGRTYXZlID0gZmFsc2UsIHZhcmlhbnQgPSAnY2xhc3NpYycpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIGNhbGN1bGF0ZUZpbmFsUG9kaXVtU2NvcmVzKGdhbWVEYXRhKSB7CiAgICBpZiAoIWdhbWVEYXRhIHx8ICFnYW1lRGF0YS5zaHVmZmxlZFF1aXogfHwgIWdhbWVEYXRhLnBsYXllcnMpIHsKICAgICAgICByZXR1cm4gZ2FtZURhdGEucGxheWVycyB8fCB7fTsKICAgIH0KCiAgICBjb25zdCBmaW5hbFBsYXllcnMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGdhbWVEYXRhLnBsYXllcnMpKTsgCgogICAgT2JqZWN0LnZhbHVlcyhmaW5hbFBsYXllcnMpLmZvckVhY2gocGxheWVyID0+IHsKICAgICAgICBwbGF5ZXIucmVhbFNjb3JlID0gcGxheWVyLnNjb3JlIHx8IDA7CiAgICAgICAgcGxheWVyLnRvdGFsUG9pbnRzID0gcGxheWVyLnRvdGFsUG9pbnRzIHx8IDA7IAogICAgICAgIAogICAgICAgIC8vIOC4leC4seC4lCBMb2dpYyDguIHguLLguKPguJrguKfguIEgKzEgQm9udXMg4Lit4Lit4LiB4LiV4Liy4Lih4LiX4Li14LmI4LiC4LitCiAgICAgICAgcGxheWVyLmhhc1BlcmZlY3RTY29yZUJvbnVzID0gZmFsc2U7IAogICAgfSk7CgogICAgcmV0dXJuIGZpbmFsUGxheWVyczsKfQoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinIChEYXRhIE9wdGltaXphdGlvbikKbGV0IGNhY2hlZEdhbWVEYXRhID0gbnVsbDsKbGV0IGNhY2hlZFBsYXllckRhdGEgPSB7fTsgCmxldCB1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyID0gbnVsbDsKbGV0IHVuc3Vic2NyaWJlUGxheWVyc0NvbGxlY3Rpb25MaXN0ZW5lciA9IG51bGw7CgpmdW5jdGlvbiBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKSB7CiAgICAvLyAxLiDguYDguITguKXguLXguKLguKPguYwgTGlzdGVuZXIg4LmA4LiB4LmI4LiyCiAgICBpZiAodW5zdWJzY3JpYmVMaXZlR2FtZUxpc3RlbmVyKSB1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIoKTsKICAgIGlmICh1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyKSB1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyKCk7CiAgICBpZiAodW5zdWJzY3JpYmVQbGF5ZXJzQ29sbGVjdGlvbkxpc3RlbmVyKSB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIoKTsKCiAgICAvLyA9PT0gW+C5gOC4nuC4tOC5iOC4oeC4quC5iOC4p+C4meC4meC4teC5iV0g4Lil4LmJ4Liy4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4LmI4Liy4LiX4Li04LmJ4LiH4LiB4LmI4Lit4LiZ4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4Lir4LmJ4Lit4LiH4LmD4Lir4Lih4LmI4LmA4Liq4Lih4LitID09PQogICAgY2FjaGVkUGxheWVyRGF0YSA9IHt9OyAKICAgIGNhY2hlZEdhbWVEYXRhID0gbnVsbDsKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwoKICAgIC8vIDIuIOC4n+C4seC4h+C4guC5ieC4reC4oeC4ueC4peC4quC4luC4suC4meC4sOC5gOC4geC4oSAoTWFpbiBEb2MpCiAgICB1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIgPSBvblNuYXBzaG90KGdhbWVSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgaWYgKCFkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJyk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguLTguIjguIHguKPguKPguKHguKrguLTguYnguJnguKrguLjguJTguKXguIfguYHguKXguYnguKciKTsKICAgICAgICAgICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICAgICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjYWNoZWRHYW1lRGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgIGlmIChjYWNoZWRHYW1lRGF0YS5zaHVmZmxlZFF1aXopIHsKICAgICAgICAgICAgY3VycmVudFF1aXpEYXRhID0gY2FjaGVkR2FtZURhdGEuc2h1ZmZsZWRRdWl6OwogICAgICAgIH0KICAgICAgICBzeW5jRGF0YUFuZFJlbmRlcigpOwogICAgfSk7CgogICAgLy8gMy4g4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZIChTdWJjb2xsZWN0aW9uKQogICAgY29uc3QgcGxheWVyc0NvbFJlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgKTsKCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIgPSBvblNuYXBzaG90KHBsYXllcnNDb2xSZWYsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICBzbmFwc2hvdC5kb2NDaGFuZ2VzKCkuZm9yRWFjaCgoY2hhbmdlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICJhZGRlZCIgfHwgY2hhbmdlLnR5cGUgPT09ICJtb2RpZmllZCIpIHsKICAgICAgICAgICAgICAgICAgICBjYWNoZWRQbGF5ZXJEYXRhW2NoYW5nZS5kb2MuaWRdID0gY2hhbmdlLmRvYy5kYXRhKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYW5nZS50eXBlID09PSAicmVtb3ZlZCIpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY2FjaGVkUGxheWVyRGF0YVtjaGFuZ2UuZG9jLmlkXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN5bmNEYXRhQW5kUmVuZGVyKCk7CiAgICAgICAgfSk7CgogICAgfSBlbHNlIHsKICAgICAgICBpZiAobG9jYWxUZWFtUGxheWVycyAmJiBsb2NhbFRlYW1QbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHBsYXllcnNDb2xSZWYsIHdoZXJlKCduYW1lJywgJ2luJywgbG9jYWxUZWFtUGxheWVycykpOwogICAgICAgICAgICB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIgPSBvblNuYXBzaG90KHEsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgICAgc25hcHNob3QuZG9jQ2hhbmdlcygpLmZvckVhY2goKGNoYW5nZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gImFkZGVkIiB8fCBjaGFuZ2UudHlwZSA9PT0gIm1vZGlmaWVkIikgewogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQbGF5ZXJEYXRhW2NoYW5nZS5kb2MuaWRdID0gY2hhbmdlLmRvYy5kYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzeW5jRGF0YUFuZFJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIHN5bmNEYXRhQW5kUmVuZGVyKCkgewogICAgaWYgKCFjYWNoZWRHYW1lRGF0YSkgcmV0dXJuOwoKICAgIC8vIOC4hOC4s+C4meC4p+C4k+C4quC4luC4suC4meC4sCAnYW5zd2VyZWQnIOC4reC4seC4leC5guC4meC4oeC4seC4leC4tCAo4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmA4LiC4Li14Lii4LiZIERhdGFiYXNlIOC4muC5iOC4reC4ouC5hikKICAgIGNvbnN0IHBsYXllcnNEaXNwbGF5ID0ge307CiAgICBjb25zdCBjdXJyZW50SW5kZXggPSBjYWNoZWRHYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKCiAgICBPYmplY3Qua2V5cyhjYWNoZWRQbGF5ZXJEYXRhKS5mb3JFYWNoKHBpZCA9PiB7CiAgICAgICAgY29uc3QgcCA9IGNhY2hlZFBsYXllckRhdGFbcGlkXTsKICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJzguLnguYnguYDguKXguYjguJnguJXguK3guJrguILguYnguK3guJvguLHguIjguIjguLjguJrguLHguJnguKvguKPguLfguK3guKLguLHguIcKICAgICAgICBjb25zdCBoYXNBbnN3ZXJlZFRoaXNUdXJuID0gcC5hbnN3ZXJzICYmIHAuYW5zd2Vycy5zb21lKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpOwogICAgICAgIAogICAgICAgIHBsYXllcnNEaXNwbGF5W3BpZF0gPSB7CiAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgIGFuc3dlcmVkOiBoYXNBbnN3ZXJlZFRoaXNUdXJuIC8vIE92ZXJyaWRlIOC4hOC5iOC4suC4meC4teC5ieC5g+C4q+C5iSBVSSDguYDguJTguLTguKHguYDguK3guLLguYTguJvguYPguIrguYkKICAgICAgICB9OwogICAgfSk7CgogICAgLy8g4Lij4Lin4Lih4Lij4LmI4Liy4LiH4LiC4LmJ4Lit4Lih4Li54LilCiAgICBjb25zdCBtZXJnZWRHYW1lRGF0YSA9IHsKICAgICAgICAuLi5jYWNoZWRHYW1lRGF0YSwKICAgICAgICBwbGF5ZXJzOiBwbGF5ZXJzRGlzcGxheQogICAgfTsKCiAgICAvLyDguKrguYjguIfguYPguKvguYkgVUkg4LmA4LiU4Li04Lih4LiC4Lit4LiH4LiE4Li44LiT4LiX4Liz4LiH4Liy4LiZ4LiV4LmI4LitICjguYTguKHguYjguJXguYnguK3guIfguYHguIHguYkgVUkpCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICB1cGRhdGVBZG1pblN5bmNWaWV3KG1lcmdlZEdhbWVEYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdXBkYXRlU3R1ZGVudFN5bmNWaWV3KG1lcmdlZEdhbWVEYXRhKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyU3luY0xvYmJ5VmlldyhwaW4sIHRvcGljKSB7CiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtYi0yIj5TeW5jIE1vZGU6ICR7dG9waWN9PC9oMj4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgbWItNCI+4LmD4Lir4LmJ4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LiU4LmJ4Lin4Lii4Lij4Lir4Lix4Liq4LiZ4Li14LmJOjwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgdGV4dC1ncmF5LTgwMCByb3VuZGVkLWxnIHAtNCBtYi00Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTZ4bCBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0Ij4ke3Bpbn08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgYmctd2hpdGUvMjAgcC00IHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItMiI+4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihICg8c3BhbiBpZD0icGxheWVyLWNvdW50Ij4wPC9zcGFuPik8L2gzPgogICAgICAgICAgICAgICAgPGRpdiBpZD0icGxheWVyLWxpc3QtbG9iYnkiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtaW5kaWdvLTIwMCI+4LiB4Liz4Lil4Lix4LiH4Lij4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZLi4uPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTQgdGV4dC1sZWZ0Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZGVuY2Utc2NvcmluZy10b2dnbGUiIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJjb25maWRlbmNlLXNjb3JpbmctdG9nZ2xlIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImgtNSB3LTUgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCIgY2hlY2tlZD4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibWwtMyB0ZXh0LWxnIGZvbnQtc2VtaWJvbGQiPuC5gOC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC4o+C4sOC4muC4muC4hOC4sOC5geC4meC4meC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iDwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjb25maWRlbmNlLXNjb3JpbmctZGVzY3JpcHRpb24iIGNsYXNzPSJtdC0yIHRleHQtc20gdGV4dC1pbmRpZ28tMjAwIHBsLTggc3BhY2UteS0xIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtd2hpdGUiPuC4hOC4sOC5geC4meC4meC4nuC4tOC5gOC4qOC4qeC4l+C4teC5iOC4iOC4sOC4luC4ueC4geC4hOC4s+C4meC4p+C4k+C5g+C4meC4leC4reC4meC4l+C5ieC4suC4ojo8L3A+CiAgICAgICAgICAgICAgICAgICAgPHA+LSDguJXguK3guJrguJbguLnguIEgJiDguKHguLHguYjguJnguYPguIggPSDguYTguJTguYnguYLguJrguJnguLHguKogPHN0cm9uZyBjbGFzcz0idGV4dC13aGl0ZSI+KzE8L3N0cm9uZz4g4LiE4Liw4LmB4LiZ4LiZPC9wPgogICAgICAgICAgICAgICAgICAgIDxwPi0g4LiV4Lit4Lia4Lic4Li04LiUICYg4Lih4Lix4LmI4LiZ4LmD4LiIID0g4LiW4Li54LiB4Lir4Lix4LiBIDxzdHJvbmcgY2xhc3M9InRleHQtd2hpdGUiPi0xPC9zdHJvbmc+IOC4hOC4sOC5geC4meC4mTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTQwMCI+KOC4geC4o+C4k+C4tSAi4LmE4Lih4LmI4Lih4Lix4LmI4LiZ4LmD4LiIIiDguIjguLDguYTguKHguYjguKHguLXguITguLDguYHguJnguJnguJ7guLTguYDguKjguKkpPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMyB0ZXh0LXNtIHRleHQteWVsbG93LTMwMCBwbC04Ij4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0YXIiPjwvaT4g4Lie4Li04LmA4Lio4LipOiDguJzguLnguYnguJfguLXguYjguYTguJTguYnguITguLDguYHguJnguJnguKvguKXguLHguIHguYDguJXguYfguKEg4LiI4Liw4LmE4LiU4LmJ4Lij4Lix4Lia4LmC4Lia4LiZ4Lix4LiqIDxzdHJvbmcgY2xhc3M9InRleHQtd2hpdGUiPisxPC9zdHJvbmc+IOC4hOC4sOC5geC4meC4meC5g+C4meC4q+C4meC5ieC4suC4quC4o+C4uOC4m+C4nOC4peC4quC4uOC4lOC4l+C5ieC4suC4ogogICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RhcnQtc3luYy1nYW1lLWJ0biIgY2xhc3M9Im10LTYgYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCBkaXNhYmxlZDpiZy1ncmF5LTQwMCIgZGlzYWJsZWQ+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkiPjwvaT4g4LmA4Lij4Li04LmI4Lih4LmA4LiB4LihCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIAogICAgLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5g+C4q+C5iSBDaGVja2JveCDguIvguYjguK3guJkv4LmB4Liq4LiU4LiH4LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiCiAgICBjb25zdCB0b2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLXRvZ2dsZScpOwogICAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLWRlc2NyaXB0aW9uJyk7CiAgICB0b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgIGRlc2NyaXB0aW9uLnN0eWxlLmRpc3BsYXkgPSB0b2dnbGUuY2hlY2tlZCA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9KTsKCiAgICAvLyDguYHguIHguYnguYTguIIgRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiH4Lib4Li44LmI4Lih4LmA4Lij4Li04LmI4Lih4LmA4LiB4Lih4LmD4Lir4LmJ4Lia4Lix4LiZ4LiX4Li24LiB4LiE4LmI4LiyIHNldHRpbmcg4LiZ4Li14LmJ4LiU4LmJ4Lin4LiiCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtc3luYy1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIC8vIOC4reC5iOC4suC4meC4hOC5iOC4suC4iOC4suC4gSBDaGVja2JveAogICAgICAgIGNvbnN0IGNvbmZpZGVuY2VFbmFibGVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2Utc2NvcmluZy10b2dnbGUnKS5jaGVja2VkOwogICAgICAgIC8vIOC4quC5iOC4h+C4hOC5iOC4siBzZXR0aW5nIOC5hOC4m+C4nuC4o+C5ieC4reC4oeC4geC4seC4muC4geC4suC4o+C5gOC4o+C4tOC5iOC4oeC5gOC4geC4oQogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7CiAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywKICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IDAsCiAgICAgICAgICAgIHF1ZXN0aW9uRGlzcGxheWVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgICAgICAgICBpc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZDogY29uZmlkZW5jZUVuYWJsZWQgLy8gPC0tIOC4muC4seC4meC4l+C4tuC4geC4hOC5iOC4suC4meC4teC5ieC4peC4hyBGaXJlc3RvcmUKICAgICAgICB9KTsKICAgIH0pOwp9CgpmdW5jdGlvbiB1cGRhdGVBZG1pblN5bmNWaWV3KGdhbWVEYXRhKSB7CiAgICBpZiAoc3luY1F1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChzeW5jUXVlc3Rpb25UaW1lckludGVydmFsKTsKCiAgICBzd2l0Y2ggKGdhbWVEYXRhLnN0YXR1cykgewogICAgICAgIGNhc2UgJ2xvYmJ5JzoKICAgICAgICAgICAgcmVuZGVyU3luY0xvYmJ5VmlldyhnYW1lRGF0YS5waW4sIGdhbWVEYXRhLnNodWZmbGVkUXVpei50b3BpYyk7CiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVBsYXllcnMgPSBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIoKFtuYW1lLCBkYXRhXSkgPT4gZGF0YS5zdGF0dXMgIT09ICdpbmFjdGl2ZScpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWNvdW50JykudGV4dENvbnRlbnQgPSBhY3RpdmVQbGF5ZXJzLmxlbmd0aDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1saXN0LWxvYmJ5JykuaW5uZXJIVE1MID0gYWN0aXZlUGxheWVycy5tYXAoKFtuYW1lLCBkYXRhXSkgPT4gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmxhY2svMzAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0bi1zeW5jIHRleHQtcmVkLTMwMCBob3Zlcjp0ZXh0LXdoaXRlIGZvbnQtYm9sZCIgdGl0bGU9IuC4meC4s+C4nOC4ueC5ieC5gOC4peC5iOC4meC4meC4teC5ieC4reC4reC4gSI+JnRpbWVzOzwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGApLmpvaW4oJycpIHx8ICc8cCBjbGFzcz0idGV4dC1pbmRpZ28tMjAwIj7guIHguLPguKXguLHguIfguKPguK3guJzguLnguYnguYDguKXguYjguJkuLi48L3A+JzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LXN5bmMtZ2FtZS1idG4nKS5kaXNhYmxlZCA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoID09PSAwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAncXVlc3Rpb24nOgogICAgICAgICAgICBjb25zdCBwbGF5ZXJzSW5HYW1lID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIocCA9PiBwLnN0YXR1cyAhPT0gJ2luYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBhbnN3ZXJlZFBsYXllcnMgPSBwbGF5ZXJzSW5HYW1lLmZpbHRlcihwID0+IHAuYW5zd2VyZWQgPT09IHRydWUgfHwgcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IHdhaXRpbmdQbGF5ZXJzID0gcGxheWVyc0luR2FtZS5maWx0ZXIocCA9PiAhcC5hbnN3ZXJlZCAmJiAhcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbik7CgogICAgICAgICAgICBjb25zdCBhbnN3ZXJlZENvdW50ID0gYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aDsKICAgICAgICAgICAgY29uc3Qgd2FpdGluZ0NvdW50ID0gd2FpdGluZ1BsYXllcnMubGVuZ3RoOwogICAgICAgICAgICBjb25zdCB0b3RhbEFjdGl2ZSA9IHBsYXllcnNJbkdhbWUubGVuZ3RoOwogICAgICAgICAgICBjb25zdCBhbGxBbnN3ZXJlZCA9IGFuc3dlcmVkQ291bnQgPT09IHRvdGFsQWN0aXZlICYmIHRvdGFsQWN0aXZlID4gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC4uLiAo4LmC4LiE4LmJ4LiU4LmA4LiK4LmH4LiEIGFsbEFuc3dlcmVkIOC5gOC4lOC4tOC4oSDguITguIfguYTguKfguYkpIC4uLgogICAgICAgICAgICBpZiAoYWxsQW5zd2VyZWQgJiYgZ2FtZURhdGEuc3RhdHVzID09PSAncXVlc3Rpb24nKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3N1bW1hcnknIH0pOyAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXBsYXllci1tYW5hZ2VtZW50JykgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlbmRlckFkbWluU3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgLy8gLi4uICjguYLguITguYnguJQgdXBkYXRlIHBsYXllciBsaXN0IOC5gOC4lOC4tOC4oSDguITguIfguYTguKfguYkpIC4uLgogICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckNvdW50ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5zd2VyLWNvdW50ZXInKTsKICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyQ291bnRlcikgeyBhbnN3ZXJDb3VudGVyLnRleHRDb250ZW50ID0gYCR7YW5zd2VyZWRDb3VudH0vJHt0b3RhbEFjdGl2ZX1gOyB9CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgY29uc3Qgc2hvd1Jlc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LXJlc3VsdHMtYnRuJyk7CiAgICAgICAgICAgICAgICAgaWYgKHNob3dSZXNCdG4pIHNob3dSZXNCdG4uZGlzYWJsZWQgPSAhYWxsQW5zd2VyZWQ7CgogICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1wbGF5ZXItbGlzdCcpOwogICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJMaXN0Q29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgIC8vIC4uLiAo4LmC4LiE4LmJ4LiUIHJlbmRlciBsaXN0IOC5gOC4lOC4tOC4oSkgLi4uCiAgICAgICAgICAgICAgICAgICAgIHBsYXllckxpc3RDb250YWluZXIuaW5uZXJIVE1MID0gcGxheWVyc0luR2FtZS5tYXAocGxheWVyID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Fuc3dlcmVkID0gcGxheWVyLmFuc3dlcmVkID09PSB0cnVlIHx8IHBsYXllci5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJnQ29sb3IgPSBoYXNBbnN3ZXJlZCA/ICdiZy1ncmVlbi01MDAnIDogJ2JnLWdyYXktNjAwJzsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC13aGl0ZSB0ZXh0LXNtICR7YmdDb2xvcn0gYm9yZGVyIGJvcmRlci13aGl0ZS8xMCBzaGFkb3ctc20iPiR7aWNvbn08c3Bhbj4ke3BsYXllci5uYW1lfTwvc3Bhbj48YnV0dG9uIGRhdGEtcGxheWVyLW5hbWU9IiR7cGxheWVyLm5hbWV9IiBjbGFzcz0ia2ljay1wbGF5ZXItYnRuLXN5bmMgdGV4dC1yZWQtMjAwIGhvdmVyOnRleHQtd2hpdGUgZm9udC1ib2xkIG1sLTEgaG92ZXI6YmctcmVkLTUwMC8yMCByb3VuZGVkLWZ1bGwgdy01IGgtNSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciIgdGl0bGU9IuC4meC4s+C4nOC4ueC5ieC5gOC4peC5iOC4meC4meC4teC5ieC4reC4reC4gSI+JnRpbWVzOzwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgLy8gLi4uICjguYLguITguYnguJQgdXBkYXRlIHdhaXRpbmcgY291bnQg4LmA4LiU4Li04LihKSAuLi4KICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbmFnZS10b3RhbC1wbGF5ZXJzJyk7CiAgICAgICAgICAgICAgICAgY29uc3Qgd2FpdGluZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbmFnZS13YWl0aW5nLXBsYXllcnMnKTsKICAgICAgICAgICAgICAgICBpZiAodG90YWxFbCkgdG90YWxFbC50ZXh0Q29udGVudCA9IHRvdGFsQWN0aXZlOwogICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nRWwpIHdhaXRpbmdFbC50ZXh0Q29udGVudCA9IHdhaXRpbmdDb3VudDsKCiAgICAgICAgICAgICAgICAgY29uc3QgZmFzdFJlc3BvbmRlckJvdHRvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXN0LXJlc3BvbmRlci1jb250YWluZXInKTsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFzdFJlc3BvbmRlckhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItZmFzdC1yZXNwb25kZXInKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMS4g4LiW4LmJ4Liy4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmIIOC5g+C4q+C5ieC5gOC4hOC4peC4teC4ouC4o+C5jOC4hOC5iOC4suC4l+C4teC5iOC4iOC4s+C5hOC4p+C5iSDguYDguJ7guLfguYjguK3guYDguKPguLTguYjguKHguKvguLLguITguJnguYDguIHguYjguIfguKPguK3guJrguYPguKvguKHguYgKICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggIT09IGxhc3RMb2NrZWRRdWVzdGlvbkluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2tlZEZhc3Rlc3RSZXNwb25kZXJOYW1lID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdExvY2tlZFF1ZXN0aW9uSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckhlYWRlcikgZmFzdFJlc3BvbmRlckhlYWRlci5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckJvdHRvbSkgZmFzdFJlc3BvbmRlckJvdHRvbS5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIExvZ2ljIOC4geC4suC4o+C4q+C4suC5geC4peC4sOC4iOC4s+C4iuC4t+C5iOC4reC4hOC4meC5hOC4p+C4quC4uOC4lCAo4LiX4Liz4LiH4Liy4LiZ4LmA4Lih4Li34LmI4Lit4Lih4Li14LiE4LiZ4LiV4Lit4LiaIOC5geC4peC4sOC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4iOC4s+C4iuC4t+C5iOC4reC5g+C4hOC4o+C5hOC4p+C5iSkKICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aCA+IDAgJiYgIWxvY2tlZEZhc3Rlc3RSZXNwb25kZXJOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguKPguLXguKLguIfguKXguLPguJTguLHguJrguYDguKfguKXguLI6IOC5g+C4hOC4o+C5hOC4oeC5iOC4oeC4teC5gOC4p+C4peC4siAobnVsbCkg4LmD4Lir4LmJ4LmE4Lib4LiV4LmI4Lit4LiX4LmJ4Liy4LiiIChJbmZpbml0eSkg4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LmB4Lii4LmI4LiH4LiX4Li14LmICiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZEJ5VGltZSA9IFsuLi5hbnN3ZXJlZFBsYXllcnNdLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldFRpbWUgPSAocCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcC5zdWJtaXR0ZWRBdCkgcmV0dXJuIEluZmluaXR5OyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC5zdWJtaXR0ZWRBdC50b0RhdGUgPyBwLnN1Ym1pdHRlZEF0LnRvRGF0ZSgpLmdldFRpbWUoKSA6IG5ldyBEYXRlKHAuc3VibWl0dGVkQXQpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGltZShhKSAtIGdldFRpbWUoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiI4Liz4LiK4Li34LmI4Lit4LiE4LiZ4LmB4Lij4LiB4LiX4Li14LmI4LmA4Lij4Li14Lii4LiH4LmE4LiU4LmJICjguITguJnguJnguLXguYnguITguLfguK3guYHguIrguKHguJvguYzguILguK3guIfguILguYnguK3guJnguLXguYnguYHguJnguYjguJnguK3guJkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3J0ZWRCeVRpbWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWUgPSBzb3J0ZWRCeVRpbWVbMF0ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gMy4g4Liq4LmI4Lin4LiZ4LmB4Liq4LiU4LiH4Lic4LilICjguYPguIrguYnguIrguLfguYjguK0gbG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWUg4LiX4Li14LmI4LiI4Liz4LmE4Lin4LmJ4LmA4Liq4Lih4LitKQogICAgICAgICAgICAgICAgICAgIGlmIChsb2NrZWRGYXN0ZXN0UmVzcG9uZGVyTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuc3dlcmVkUGxheWVycy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguKHguLXguITguJnguJXguK3guJrguYHguITguYggMSDguITguJk6IOC5geC4quC4lOC4h+C4m+C5ieC4suC4ouC5g+C4q+C4jeC5iOC4quC4teC5gOC4guC4teC4ouC4p+C4lOC5ieC4suC4meC4peC5iOC4suC4hyAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJIZWFkZXIpIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gJyc7IC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4guC5ieC4suC4h+C4muC4mQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckJvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWdyYWRpZW50LXRvLXIgZnJvbS1ncmVlbi01MDAgdG8tZW1lcmFsZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTYgcm91bmRlZC14bCBzaGFkb3ctbGcgYm9yZGVyLTIgYm9yZGVyLWdyZWVuLTMwMCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTMgYW5pbWF0ZS1ib3VuY2UiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSB0b3AtMCBsZWZ0LTAgdy1mdWxsIGgtZnVsbCBiZy13aGl0ZSBvcGFjaXR5LTIwIHRyYW5zZm9ybSBza2V3LXgtMTIiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWJvbHQgdGV4dC15ZWxsb3ctMzAwIHRleHQtMnhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC1sZyI+4LiE4LiZ4Liq4LmI4LiH4LmE4Lin4LiX4Li14LmI4Liq4Li44LiUOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtZXh0cmFib2xkIHRleHQtMnhsIHRleHQteWVsbG93LTEwMCBkcm9wLXNoYWRvdy1tZCI+JHtsb2NrZWRGYXN0ZXN0UmVzcG9uZGVyTmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguKHguLXguITguJnguJXguK3guJogMiDguITguJnguILguLbguYnguJnguYTguJs6IOC4ouC5ieC4suC4ouC4iuC4t+C5iOC4reC4hOC4meC5geC4o+C4geC5hOC4m+C5geC4m+C4sOC4m+C5ieC4suC4ouC5gOC4peC5h+C4geC4lOC5ieC4suC4meC4muC4mSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJCb3R0b20pIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gJyc7IC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4guC5ieC4suC4h+C4peC5iOC4suC4hwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLWdyZWVuLTYwMC85MCBiYWNrZHJvcC1ibHVyLXNtIHRleHQtd2hpdGUgcHgtNCBweS0xIHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLWdyZWVuLTQwMCBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSB0cmFuc2Zvcm0gdHJhbnNpdGlvbi1hbGwgbWwtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYm9sdCB0ZXh0LXllbGxvdy0zMDAiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gZm9udC1ib2xkIj7guYTguKfguKrguLjguJQ6IDxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy0xMDAiPiR7bG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWV9PC9zcGFuPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LmD4LiE4Lij4LiV4Lit4LiaICjguYDguITguKXguLXguKLguKPguYzguJfguLHguYnguIfguITguLnguYgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJIZWFkZXIpIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJCb3R0b20pIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgICAgICAvLyDguKrguYjguKfguJnguJfguLXguYggMjogTG9naWMg4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZ4LiE4LiZ4LiK4LmJ4LiyIChTbG93IFJlc3BvbmRlcikgLSDguK3guLHguJnguJnguLXguYnguITguLfguK3guK3guLHguJnguYDguJTguLTguKHguJfguLXguYjguKvguLLguKLguYTguJsKICAgICAgICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgICAgICBjb25zdCBzaG93U2xvdyA9IGdhbWVEYXRhLnNob3dTbG93UmVzcG9uZGVycyAhPT0gZmFsc2U7CiAgICAgICAgICAgICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChnYW1lRGF0YS5zbG93UmVzcG9uZGVyQ291bnQgfHwgMywgMTApOwogICAgICAgICAgICAgICAgIGNvbnN0IHNsb3dDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xvdy1yZXNwb25kZXItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgaWYgKHNsb3dDb250YWluZXIpIHsKICAgICAgICAgICAgICAgICAgICAgLy8g4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCOiDguYDguJvguLTguJTguYLguKvguKHguJTguYHguIjguYnguIfguYDguJXguLfguK3guJkgKyDguYDguKvguKXguLfguK3guITguJnguJnguYnguK3guKLguIHguKfguYjguLIgTGltaXQgKyDguKHguLXguITguJnguYDguKXguYjguJnguKHguLLguIHguIHguKfguYjguLLguITguJnguKPguK0gKOC5hOC4oeC5iOC5g+C4iuC5iOC5gOC4nuC4tOC5iOC4h+C5gOC4o+C4tOC5iOC4oSkKICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dTbG93ICYmIHdhaXRpbmdDb3VudCA+IDAgJiYgd2FpdGluZ0NvdW50IDw9IGxpbWl0ICYmIHRvdGFsQWN0aXZlID4gd2FpdGluZ0NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gd2FpdGluZ1BsYXllcnMubWFwKHAgPT4gcC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgICAgICAgICAgICAgICAgICBzbG93Q29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXJlZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS00IHB4LTYgcm91bmRlZC14bCBzaGFkb3ctMnhsIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTQgYm9yZGVyLXJlZC04MDAgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIG10LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFic29sdXRlIHRvcC0wIGxlZnQtMCB3LWZ1bGwgaC1mdWxsIGJnLXdoaXRlIG9wYWNpdHktMTAgdHJhbnNmb3JtIC1za2V3LXgtMTIiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIHotMTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0yIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2hpcHBpbmctZmFzdCBmYS1sZyI+PC9pPiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPuC4o+C4reC4reC4teC4gSAke3dhaXRpbmdDb3VudH0g4LiE4LiZ4Liq4Li44LiU4LiX4LmJ4Liy4LiiITwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtM3hsIGZvbnQtZXh0cmFib2xkIHRleHQteWVsbG93LTMwMCB0cmFja2luZy13aWRlIGRyb3Atc2hhZG93LW1kIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7bmFtZXN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXNtIG10LTIgb3BhY2l0eS05MCBmb250LW1lZGl1bSBiZy1ibGFjay8yMCBpbmxpbmUtYmxvY2sgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDguKPguLXguJrguJXguK3guJrguKvguJnguYjguK3guKLguIjguYnguLIhIOC5gOC4nuC4t+C5iOC4reC4meC4o+C4reC4reC4ouC4ueC5iAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3dDb250YWluZXIuaW5uZXJIVE1MID0gJyc7IAogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaW1lciBMb2dpYwogICAgICAgICAgICBjb25zdCBpc1RpbWVyT24gPSBnYW1lRGF0YS50aW1lck1vZGUgPT09ICdwZXJfcXVlc3Rpb24nICYmIGdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQ7CiAgICAgICAgICAgIGlmIChpc1RpbWVyT24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQudG9EYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBnYW1lRGF0YS50aW1lckR1cmF0aW9uICogMTAwMDsKICAgICAgICAgICAgICAgIGNvbnN0IGFkbWluRW5kVGltZSA9IHN0YXJ0VGltZSArIGR1cmF0aW9uOyAKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdGltZXItYmFyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb3VudGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy10aW1lci1jb3VudGRvd24nKTsKCiAgICAgICAgICAgICAgICBzeW5jUXVlc3Rpb25UaW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsUGxheWVyc0RvbmUgPSBwbGF5ZXJzSW5HYW1lLmxlbmd0aCA+IDAgJiYgcGxheWVyc0luR2FtZS5ldmVyeShwID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuYW5zd2VyZWQpIHJldHVybiB0cnVlOyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9udXMgPSBwLnRpbWVCb251c1RoaXNRdWVzdGlvbiB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG5vdyA+PSBzdGFydFRpbWUgKyBkdXJhdGlvbiArIGJvbnVzKTsgCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhbGxQbGF5ZXJzRG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAnc3VtbWFyeScgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWRtaW5SZW1haW5pbmcgPSBhZG1pbkVuZFRpbWUgLSBub3c7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFkbWluUmVtYWluaW5nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyQmFyKSB0aW1lckJhci5zdHlsZS53aWR0aCA9ICcwJSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudGRvd24pIGNvdW50ZG93bi50ZXh0Q29udGVudCA9ICcwICjguKPguK3guYLguJrguJnguLHguKopJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZXJCYXIgJiYgY291bnRkb3duKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gKGFkbWluUmVtYWluaW5nIC8gZHVyYXRpb24pICogMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXJCYXIuc3R5bGUud2lkdGggPSBgJHtwZXJjZW50YWdlfSVgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRkb3duLnRleHRDb250ZW50ID0gTWF0aC5jZWlsKGFkbWluUmVtYWluaW5nIC8gMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdzdW1tYXJ5JzoKICAgICAgICAgICAgY29uc3QgcUluZGV4Rm9yU3VtbWFyeSA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICBjb25zdCBxdWVzdGlvbkZvclN1bW1hcnkgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zW3FJbmRleEZvclN1bW1hcnldOwogICAgICAgICAgICByZW5kZXJTeW5jU3VtbWFyeVZpZXcoZ2FtZURhdGEsIHF1ZXN0aW9uRm9yU3VtbWFyeSwgdHJ1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdyZXN1bHRzJzoKICAgICAgICAgICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgICAgICAgICAgaWYgKHZhcmlhbnQgPT09ICdyZXZlYWxfYXRfZW5kJyB8fCB2YXJpYW50ID09PSAnYW5vbnltb3VzX3JldmVhbF9lbmQnKSB7CiAgICAgICAgICAgICAgICByZW5kZXJBZG1pblN5bmNEYXNoYm9hcmQoZ2FtZURhdGEsIHRydWUsIGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4Lij4Lit4Lia4LiZ4Li14LmJ4LmE4Lib4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICAgICAgICAgICAgICBpZiAoZ2FtZURhdGEuc3RhdHVzID09PSAncmVzdWx0cycgJiYgIWdhbWVEYXRhLnNjb3Jlc0NhbGN1bGF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxLiDguKXguYfguK3guITguKrguJbguLLguJnguLDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguITguLPguJnguKfguJPguIvguYnguLMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHNjb3Jlc0NhbGN1bGF0ZWQ6IHRydWUgfSk7IAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllcnNUb0NhbGN1bGF0ZSA9IGNhY2hlZFBsYXllckRhdGEgfHwge307IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMi4g4Lij4Liw4Lia4Lia4LiE4Liz4LiZ4Lin4LiT4LiB4Lit4LiH4LiB4Lil4Liy4LiHIChUaGUgUG90IFN5c3RlbSkgLS0tCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcG90RnJvbUxvc2VycyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3YWdlcldpbm5lcnMgPSBbXTsgCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMocGxheWVyc1RvQ2FsY3VsYXRlKS5mb3JFYWNoKChbcGlkLCBwbGF5ZXJdKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5zdGF0dXMgIT09ICdpbmFjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFucyA9IChwbGF5ZXIuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gY3VycmVudEluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zICYmIGN1cnJlbnRBbnMucG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3YWdlciA9IGN1cnJlbnRBbnMud2FnZXJBbW91bnQgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhZ2VyV2lubmVycy5wdXNoKHBpZCk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3RGcm9tTG9zZXJzICs9IHdhZ2VyOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzUG90ID0gZ2FtZURhdGEuY2VudHJhbFBvdCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxQb3RUb0Rpc3RyaWJ1dGUgPSBwcmV2aW91c1BvdCArIHBvdEZyb21Mb3NlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaGFyZVBlcldpbm5lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV3UmVtYWluZGVyID0gdG90YWxQb3RUb0Rpc3RyaWJ1dGU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhZ2VyV2lubmVycy5sZW5ndGggPiAwICYmIHRvdGFsUG90VG9EaXN0cmlidXRlID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlUGVyV2lubmVyID0gTWF0aC5mbG9vcih0b3RhbFBvdFRvRGlzdHJpYnV0ZSAvIHdhZ2VyV2lubmVycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JlbWFpbmRlciA9IHRvdGFsUG90VG9EaXN0cmlidXRlICUgd2FnZXJXaW5uZXJzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdQdWJsaWNMZWFkZXJib2FyZCA9IFtdOyAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAzLiDguK3guLHguJvguYDguJTguJXguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJnguYHguJXguYjguKXguLDguITguJkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMocGxheWVyc1RvQ2FsY3VsYXRlKS5mb3JFYWNoKHBsYXllciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5zdGF0dXMgIT09ICdpbmFjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyTmFtZSA9IHBsYXllci5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4q+C4suC4hOC4s+C4leC4reC4muC4guC4reC4h+C4o+C4reC4muC4meC4teC5iQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zID0gKHBsYXllci5hbnN3ZXJzIHx8IFtdKS5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvaW50c1RvQWRkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwZGF0ZWRBbnN3ZXJzID0gcGxheWVyLmFuc3dlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBb4LmB4LiB4LmJ4LmE4LiC4LiI4Li44LiU4LiZ4Li14LmJXSDguJbguYnguLLguYTguKHguYjguKHguLXguITguLPguJXguK3guJogKOC4q+C4oeC4lOC5gOC4p+C4peC4sikg4LmD4Lir4LmJ4Lij4Li14LmA4LiL4LmH4LiVIFN0cmVhayDilrzilrzilrwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1N0cmVhayA9IHBsYXllci5jb3JyZWN0U3RyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRBbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1N0cmVhayA9IDA7IC8vIOC5hOC4oeC5iOC4leC4reC4miA9IFN0cmVhayDguKvguKXguLjguJQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDilrLilrLilrIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YWdlcldpbm5lcnMuaW5jbHVkZXMocGxheWVyTmFtZSkgJiYgc2hhcmVQZXJXaW5uZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHNUb0FkZCA9IHNoYXJlUGVyV2lubmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEFuc3dlcnMgPSAocGxheWVyLmFuc3dlcnMgfHwgW10pLm1hcChhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4uYSwgcG90Qm9udXM6IHNoYXJlUGVyV2lubmVyIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocGxheWVyUmVmLCB7IGFuc3dlcnM6IHVwZGF0ZWRBbnN3ZXJzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXdTY29yZSA9IHBsYXllci5zY29yZSB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxQb2ludHMgPSBwbGF5ZXIudG90YWxQb2ludHMgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxQb2ludHMgKz0gcG9pbnRzVG9BZGQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc09uZXRNb2RlID0gZ2FtZURhdGEuaXNPbmV0TW9kZSA9PT0gdHJ1ZTsgLy8g4LmA4LiK4LmH4LiE4LmC4Lir4Lih4LiUCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc09uZXRNb2RlICYmIHRvdGFsUXVlc3Rpb25zID4gMCAmJiByYXdTY29yZSA9PT0gdG90YWxRdWVzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxQb2ludHMgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocGxheWVyUmVmLCB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHJhd1Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IGZpbmFsUG9pbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiBmaW5hbFBvaW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IG5ld1N0cmVhayAvLyA8LS0g4Lia4Lix4LiZ4LiX4Li24LiBIFN0cmVhayDguYPguKvguKHguYjguKXguIcgREIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQdWJsaWNMZWFkZXJib2FyZC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBsYXllciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogcmF3U2NvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBvaW50czogZmluYWxQb2ludHMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiBmaW5hbFBvaW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IHVwZGF0ZWRBbnN3ZXJzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IG5ld1N0cmVhayAvLyA8LS0g4Liq4LmI4LiH4LiE4LmI4Liy4LmD4Lir4Lih4LmI4LmE4Lib4LmB4Liq4LiU4LiH4Lic4Lil4LiX4Li14LmI4Lir4LiZ4LmJ4Liy4LiI4Lit4LiX4Li44LiB4LiE4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUoZ2FtZVJlZiwgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50cmFsUG90OiBuZXdSZW1haW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljTGVhZGVyYm9hcmQ6IG5ld1B1YmxpY0xlYWRlcmJvYXJkIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFBvdCBEaXN0cmlidXRlZC4gTGVhZGVyYm9hcmQgVXBkYXRlZC5gKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjYWxjdWxhdGluZyBmaW5hbCBzY29yZXMgd2l0aCBwb3Q6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlbmRlckFkbWluU3luY0Rhc2hib2FyZChnYW1lRGF0YSwgdHJ1ZSwgZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdwb2RpdW0nOgogICAgICAgICAgICBjb25zdCBoYXNQbGF5ZXJzVG9DaGVjayA9IE9iamVjdC5rZXlzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGNvbnN0IGlzQWxyZWFkeVNhdmVkID0gZ2FtZURhdGEucmVzdWx0c1NhdmVkID09PSB0cnVlOwogICAgICAgICAgICBjb25zdCBzaG91bGRTYXZlQ29uZmlnID0gZ2FtZURhdGEuc2hvdWxkU2F2ZVJlc3VsdHMgPT09IHRydWU7CgogICAgICAgICAgICBpZiAoc2hvdWxkU2F2ZUNvbmZpZyAmJiAhaXNBbHJlYWR5U2F2ZWQgJiYgaGFzUGxheWVyc1RvQ2hlY2spIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEZXRlY3RpbmcgdW5zYXZlZCBnYW1lIHVwb24gcmVzdW1lLi4uIFNhdmluZyBub3cuIik7CiAgICAgICAgICAgICAgICBzYXZlR2FtZVJlc3VsdHNBc1N1Ym1pc3Npb25zKGdhbWVEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgICAgICAgICAgY29uc3QgZmluYWxTY29yZXNBZG1pbiA9IGNhbGN1bGF0ZUZpbmFsUG9kaXVtU2NvcmVzKGdhbWVEYXRhKTsKICAgICAgICAgICAgc2hvd1BvZGl1bVZpZXcoZmluYWxTY29yZXNBZG1pbiwgJ3N5bmMnLCBnYW1lRGF0YSk7IAogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyQWRtaW5TeW5jUXVlc3Rpb25WaWV3KGdhbWVEYXRhKSB7CiAgICBjb25zdCBxSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgIGNvbnN0IHF1ZXN0aW9uID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1txSW5kZXhdOwogICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgIAogICAgLy8gMS4g4LiE4Liz4LiZ4Lin4LiT4LiV4Lix4Lin4LmA4Lil4LiCCiAgICBjb25zdCBwbGF5ZXJzSW5HYW1lID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIocCA9PiBwLnN0YXR1cyAhPT0gJ2luYWN0aXZlJyk7CiAgICBjb25zdCBhbnN3ZXJlZFBsYXllcnMgPSBwbGF5ZXJzSW5HYW1lLmZpbHRlcihwID0+IHAuYW5zd2VyZWQgPT09IHRydWUgfHwgcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSk7CiAgICBjb25zdCB3YWl0aW5nUGxheWVycyA9IHBsYXllcnNJbkdhbWUuZmlsdGVyKHAgPT4gIXAuYW5zd2VyZWQgJiYgIXAuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24pOwogICAgCiAgICBjb25zdCBhbnN3ZXJlZENvdW50ID0gYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aDsKICAgIGNvbnN0IHRvdGFsQWN0aXZlID0gcGxheWVyc0luR2FtZS5sZW5ndGg7ICAgICAgCiAgICBjb25zdCB3YWl0aW5nQ291bnQgPSB3YWl0aW5nUGxheWVycy5sZW5ndGg7ICAgIAogICAgY29uc3QgYWxsQW5zd2VyZWQgPSBhbnN3ZXJlZENvdW50ID09PSB0b3RhbEFjdGl2ZSAmJiB0b3RhbEFjdGl2ZSA+IDA7CgogICAgLy8g4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCiAgICBjb25zdCBzaG93U2xvd1Jlc3BvbmRlcnMgPSBnYW1lRGF0YS5zaG93U2xvd1Jlc3BvbmRlcnMgIT09IGZhbHNlOyAKICAgIGNvbnN0IHNsb3dMaW1pdCA9IHBhcnNlSW50KGdhbWVEYXRhLnNsb3dSZXNwb25kZXJDb3VudCB8fCAzLCAxMCk7CiAgICBjb25zdCBwb3RIVE1MID0gZ2V0Q2VudHJhbFBvdEhUTUwoZ2FtZURhdGEpOwoKICAgIC8vIE9wdGlvbnMgSFRNTAogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgIGxldCBvcHRpb25zSFRNTCA9ICcnOwogICAgaWYgKChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpICYmIHF1ZXN0aW9uLm9wdGlvbnMgJiYgcXVlc3Rpb24ub3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgb3B0aW9uc0hUTUwgPSBgPGRpdiBjbGFzcz0iY29sLXNwYW4tZnVsbCB0ZXh0LWNlbnRlciBwLTggYmctYmxhY2svMjAgcm91bmRlZC1sZyBib3JkZXItMiBib3JkZXItZGFzaGVkIGJvcmRlci13aGl0ZS8zMCI+PGkgY2xhc3M9ImZhcyBmYS1leWUtc2xhc2ggdGV4dC00eGwgdGV4dC15ZWxsb3ctMzAwIG1iLTQiPjwvaT48cCBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC13aGl0ZSI+4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiW4Li54LiB4LiL4LmI4Lit4LiZ4Lit4Lii4Li54LmIPC9wPjwvZGl2PmA7CiAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnNIVE1MID0gKHF1ZXN0aW9uLm9wdGlvbnMgfHwgW10pLm1hcChvcHQgPT4gYDxkaXYgY2xhc3M9InAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUvMzAgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1zbSI+JHtvcHR9PC9kaXY+YCkuam9pbignJyk7CiAgICB9CgogICAgbGV0IHRpbWVySFRNTCA9ICcnOwogICAgaWYgKGdhbWVEYXRhLnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICB0aW1lckhUTUwgPSBgPGRpdiBjbGFzcz0ibXktNCI+PGRpdiBpZD0ic3luYy10aW1lci1iYXItY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIGJnLWdyYXktMjAwLzUwIHJvdW5kZWQtZnVsbCBoLTIuNSI+PGRpdiBpZD0ic3luYy10aW1lci1iYXIiIGNsYXNzPSJiZy15ZWxsb3ctNDAwIGgtMi41IHJvdW5kZWQtZnVsbCIgc3R5bGU9IndpZHRoOiAxMDAlIj48L2Rpdj48L2Rpdj48cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1zbSB0ZXh0LXllbGxvdy0zMDAgbXQtMSI+4LmA4Lir4Lil4Li34Lit4LmA4Lin4Lil4LiyIDxzcGFuIGlkPSJzeW5jLXRpbWVyLWNvdW50ZG93biIgY2xhc3M9ImZvbnQtYm9sZCI+JHtnYW1lRGF0YS50aW1lckR1cmF0aW9ufTwvc3Bhbj4g4Lin4Li04LiZ4Liy4LiX4Li1PC9wPjwvZGl2PmA7CiAgICB9CiAgICAKICAgIC8vIFBsYXllciBMaXN0IEhUTUwKICAgIGNvbnN0IHBsYXllckxpc3RIVE1MID0gcGxheWVyc0luR2FtZS5tYXAocGxheWVyID0+IHsKICAgICAgICAgY29uc3QgaGFzQW5zd2VyZWQgPSBwbGF5ZXIuYW5zd2VyZWQgPT09IHRydWUgfHwgcGxheWVyLmFuc3dlcmVkQ3VycmVudFF1ZXN0aW9uID09PSB0cnVlOwogICAgICAgICBjb25zdCBiZ0NvbG9yID0gaGFzQW5zd2VyZWQgPyAnYmctZ3JlZW4tNTAwJyA6ICdiZy1ncmF5LTYwMCc7CiAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CiAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXdoaXRlIHRleHQtc20gJHtiZ0NvbG9yfSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1zbSI+JHtpY29ufTxzcGFuPiR7cGxheWVyLm5hbWV9PC9zcGFuPjxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtwbGF5ZXIubmFtZX0iIGNsYXNzPSJraWNrLXBsYXllci1idG4tc3luYyB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQgbWwtMSBob3ZlcjpiZy1yZWQtNTAwLzIwIHJvdW5kZWQtZnVsbCB3LTUgaC01IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIiB0aXRsZT0i4LiZ4Liz4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiZ4Li14LmJ4Lit4Lit4LiBIj4mdGltZXM7PC9idXR0b24+PC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwoKICAgIC8vIFNsb3cgUmVzcG9uZGVycyBIVE1MCiAgICBsZXQgc2xvd1Jlc3BvbmRlcnNIVE1MID0gJyc7CiAgICBpZiAoc2hvd1Nsb3dSZXNwb25kZXJzICYmIHdhaXRpbmdDb3VudCA+IDAgJiYgd2FpdGluZ0NvdW50IDw9IHNsb3dMaW1pdCAmJiB0b3RhbEFjdGl2ZSA+IHdhaXRpbmdDb3VudCkgewogICAgICAgIGNvbnN0IG5hbWVzID0gd2FpdGluZ1BsYXllcnMubWFwKHAgPT4gcC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgIHNsb3dSZXNwb25kZXJzSFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtNiB3LWZ1bGwgbWF4LXctNHhsIG14LWF1dG8gcHgtNCBmYWRlLWluIiBpZD0ic2xvdy1yZXNwb25kZXItY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXJlZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0zIHB4LTYgcm91bmRlZC14bCBzaGFkb3ctMnhsIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTQgYm9yZGVyLXJlZC04MDAgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSB6LTEwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgbWItMSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNoaXBwaW5nLWZhc3QiPjwvaT4gPHNwYW4+4Lij4Lit4Lit4Li14LiBICR7d2FpdGluZ0NvdW50fSDguITguJnguKrguLjguJTguJfguYnguLLguKIhPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC0yeGwgZm9udC1leHRyYWJvbGQgdGV4dC15ZWxsb3ctMzAwIGRyb3Atc2hhZG93LW1kIj4ke25hbWVzfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9IGVsc2UgewogICAgICAgIHNsb3dSZXNwb25kZXJzSFRNTCA9ICc8ZGl2IGlkPSJzbG93LXJlc3BvbmRlci1jb250YWluZXIiIGNsYXNzPSJtdC02IHctZnVsbCBtYXgtdy00eGwgbXgtYXV0byBweC00Ij48L2Rpdj4nOwogICAgfQoKICAgIC8vIOKWvOKWvOKWvCBb4LmA4Lie4Li04LmI4Lih4LmD4Lir4Lih4LmIXSDguKrguKPguYnguLLguIcgQ29udGFpbmVyIOC5gOC4m+C4peC5iOC4suC5hiDguKrguLPguKvguKPguLHguJrguITguJnguKrguYjguIfguITguJnguYHguKPguIEg4pa84pa84pa8CiAgICBjb25zdCBmYXN0UmVzcG9uZGVySFRNTCA9ICc8ZGl2IGlkPSJmYXN0LXJlc3BvbmRlci1jb250YWluZXIiIGNsYXNzPSJtdC0yIHctZnVsbCBtYXgtdy00eGwgbXgtYXV0byBweC00Ij48L2Rpdj4nOwogICAgLy8g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKFdIOKWsuKWsuKWsgoKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciB0ZXh0LWxnIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgPHNwYW4+4LiC4LmJ4Lit4LiX4Li14LmIICR7cUluZGV4ICsgMX0gLyAke3RvdGFsUXVlc3Rpb25zfTwvc3Bhbj4KICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSBmb250LW1vbm8iPjxpIGNsYXNzPSJmYXMgZmEta2V5IG1yLTIgb3BhY2l0eS03MCI+PC9pPiR7Z2FtZURhdGEucGlufTwvc3Bhbj4KICAgICR7cG90SFRNTH0KICAgIDxkaXYgaWQ9ImhlYWRlci1mYXN0LXJlc3BvbmRlciIgY2xhc3M9InRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTUwMCI+PC9kaXY+CjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4leC4reC4muC5geC4peC5ieC4pzogPHNwYW4gaWQ9ImFuc3dlci1jb3VudGVyIiBjbGFzcz0iZm9udC1ib2xkIj4ke2Fuc3dlcmVkQ291bnR9LyR7dG90YWxBY3RpdmV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzeW5jLW1hbmFnZS1wbGF5ZXJzLWJ0biIgY2xhc3M9InRleHQteHMgYmctd2hpdGUvMjAgaG92ZXI6Ymctd2hpdGUvNDAgcHgtMiBweS0xIHJvdW5kZWQtbWQgYm9yZGVyIGJvcmRlci13aGl0ZS8zMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlcnMtY29nIG1yLTEiPjwvaT4g4LiI4Lix4LiU4LiB4Liy4LijCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZW5kLXN5bmMtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIj7guIjguJrguYDguIHguKE8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgaWQ9InN5bmMtcGxheWVyLW1hbmFnZW1lbnQiIGNsYXNzPSJoaWRkZW4gdy1mdWxsIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTQgdGV4dC1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1pbm5lciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIG1iLTMgcGItMiBib3JkZXItYiBib3JkZXItd2hpdGUvMTAgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBjdXJzb3ItcG9pbnRlciB0ZXh0LXllbGxvdy0zMDAgaG92ZXI6dGV4dC15ZWxsb3ctMjAwIHNlbGVjdC1ub25lIGJnLWJsYWNrLzIwIHB4LTIgcHktMSByb3VuZGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1zbG93LXJlc3BvbmRlcnMiIGNsYXNzPSJoLTQgdy00IHRleHQtaW5kaWdvLTYwMCByb3VuZGVkIiAke3Nob3dTbG93UmVzcG9uZGVycyA/ICdjaGVja2VkJyA6ICcnfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtbC0yIGZvbnQtc2VtaWJvbGQiPjxpIGNsYXNzPSJmYXMgZmEtYmVsbCI+PC9pPiDguYHguIjguYnguIfguYDguJXguLfguK3guJnguITguJnguIrguYnguLI8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiB0ZXh0LWdyYXktMzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPuC5gOC4leC4t+C4reC4meC5gOC4oeC4t+C5iOC4reC5gOC4q+C4peC4t+C4rTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iaW5wdXQtc2xvdy1jb3VudCIgdmFsdWU9IiR7c2xvd0xpbWl0fSIgbWluPSIxIiBtYXg9IiR7TWF0aC5tYXgoMSwgdG90YWxBY3RpdmUgLSAxKX0iIGNsYXNzPSJ3LTEyIHAtMC41IHRleHQtYmxhY2sgdGV4dC1jZW50ZXIgcm91bmRlZCBmb250LWJvbGQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+4LiE4LiZPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjbG9zZS1tYW5hZ2UtYnRuIiBjbGFzcz0idGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXdoaXRlIHB4LTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi11cCI+PC9pPiDguIvguYjguK3guJk8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDxkaXYgaWQ9InN5bmMtcGxheWVyLWxpc3QiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LXN0YXJ0IGdhcC0yIG1heC1oLTMyIG92ZXJmbG93LXktYXV0byBjdXN0b20tc2Nyb2xsYmFyIj4KICAgICAgICAgICAgICAgICAgICAke3BsYXllckxpc3RIVE1MfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAke3RpbWVySFRNTH0gCiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcmVsYXRpdmUiPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItOCB0ZXh0LWNlbnRlciBsZWFkaW5nLXRpZ2h0IG1heC13LTV4bCI+JHtxdWVzdGlvbi5xdWVzdGlvblRleHQgfHwgcXVlc3Rpb24uc3RlbX08L2gyPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LTR4bCBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00Ij4ke29wdGlvbnNIVE1MfTwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAke2Zhc3RSZXNwb25kZXJIVE1MfQogICAgICAgICAgICAgICAgJHtzbG93UmVzcG9uZGVyc0hUTUx9CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbXQtOCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCBmbGV4LXNocmluay0wIj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im9wZW4tc3luYy1zY3JhdGNocGFkLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzIwIGhvdmVyOmJnLXdoaXRlLzMwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzIwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBlbmNpbC1hbHQiPjwvaT4g4LiX4LiU4LmA4Lil4LiCCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InNob3ctcmVzdWx0cy1idG4iIGNsYXNzPSJiZy15ZWxsb3ctNTAwIGhvdmVyOmJnLXllbGxvdy02MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwgZGlzYWJsZWQ6YmctZ3JheS01MDAgZGlzYWJsZWQ6Y3Vyc29yLW5vdC1hbGxvd2VkIHNoYWRvdy1sZyIgJHshYWxsQW5zd2VyZWQgPyAnZGlzYWJsZWQnIDogJyd9PgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtYmFyIG1yLTIiPjwvaT4g4LmB4Liq4LiU4LiH4Lic4Lil4Lil4Lix4Lie4LiY4LmMCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZSgpOwogICAgCiAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvdy1yZXN1bHRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4geyBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgeyBzdGF0dXM6ICdzdW1tYXJ5JyB9KTsgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1zeW5jLXNjcmF0Y2hwYWQtYnRuJykub25jbGljayA9ICgpID0+IHsgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIHF1ZXN0aW9uLm9wdGlvbnMgfHwgW10pOyB9OwogICAgCiAgICAvLyBUb2dnbGUgQXJlYQogICAgY29uc3QgbWFuYWdlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtcGxheWVyLW1hbmFnZW1lbnQnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLW1hbmFnZS1wbGF5ZXJzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBtYW5hZ2VDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7IH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLW1hbmFnZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgbWFuYWdlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9KTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXNsb3ctcmVzcG9uZGVycycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc2hvd1Nsb3dSZXNwb25kZXJzOiBlLnRhcmdldC5jaGVja2VkIH0pOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQtc2xvdy1jb3VudCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7CiAgICAgICAgbGV0IHZhbCA9IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKTsgaWYgKHZhbCA8IDEpIHZhbCA9IDE7IGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHNsb3dSZXNwb25kZXJDb3VudDogdmFsIH0pOwogICAgfSk7CiAgICBjb25zdCBlbmRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW5kLXN5bmMtZ2FtZS1idG4nKTsKICAgIGlmIChlbmRCdG4pIHsgZW5kQnRuLm9uY2xpY2sgPSAoKSA9PiB7IHNob3dDb25maXJtYXRpb24oJ+C4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4muC5gOC4geC4oeC4meC4teC5iT8nLCBhc3luYyAoKSA9PiB7IGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7IH0pOyB9OyB9Cn0KCmZ1bmN0aW9uIHJlbmRlclN5bmNMZWFkZXJib2FyZFZpZXcoZ2FtZURhdGEsIGlzQWRtaW4pIHsKICAgIGNvbnN0IHBsYXllcnMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pOwogICAgcGxheWVycy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICBjb25zdCB0b3A1ID0gcGxheWVycy5zbGljZSgwLCA1KTsKCiAgICBsZXQgYWN0aW9uQnV0dG9uSFRNTCA9ICcnOwogICAgaWYgKGlzQWRtaW4pIHsKICAgICAgICBjb25zdCBpc0xhc3RRdWVzdGlvbiA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoIC0gMTsKICAgICAgICBhY3Rpb25CdXR0b25IVE1MID0gYDxidXR0b24gaWQ9Im5leHQtc3luYy1xdWVzdGlvbi1idG4iIGNsYXNzPSJiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCBtdC04Ij4ke2lzTGFzdFF1ZXN0aW9uID8gJ+C4lOC4ueC4nOC4peC4quC4o+C4uOC4m+C4quC4uOC4lOC4l+C5ieC4suC4oicgOiAn4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibJ30gPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCI+PC9pPjwvYnV0dG9uPmA7CiAgICB9IGVsc2UgewogICAgICAgIGFjdGlvbkJ1dHRvbkhUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC1sZyB0ZXh0LWluZGlnby0yMDAiPuC5gOC4leC4o+C4teC4ouC4oeC4leC4seC4p+C4quC4s+C4q+C4o+C4seC4muC4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD5gOwogICAgfQoKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBtYi02Ij7guJXguLLguKPguLLguIfguITguLDguYHguJnguJk8L2gyPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgc3BhY2UteS0zIj4ke3RvcDUubWFwKChwbGF5ZXIsIGluZGV4KSA9PiBgPGRpdiBjbGFzcz0iYmctYmxhY2svMjAgcC0zIHJvdW5kZWQtbGcgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHRleHQteGwiPjxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke2luZGV4ICsgMX0uICR7cGxheWVyLm5hbWV9PC9zcGFuPjxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7cGxheWVyLnNjb3JlfTwvc3Bhbj48L2Rpdj5gKS5qb2luKCcnKX08L2Rpdj4KICAgICAgICAgICAgJHthY3Rpb25CdXR0b25IVE1MfQogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICBpZiAoaXNBZG1pbikgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXN5bmMtcXVlc3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgICAgICBjb25zdCBuZXh0SW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCArIDE7CgogICAgICAgICAgICBpZiAobmV4dEluZGV4IDwgZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllclVwZGF0ZXMgPSB7fTsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGdhbWVEYXRhLnBsYXllcnMpLmZvckVhY2gobmFtZSA9PiB7IHBsYXllclVwZGF0ZXNbYHBsYXllcnMuJHtuYW1lfS5hbnN3ZXJlZGBdID0gZmFsc2U7IH0pOwogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgCiAgICBzdGF0dXM6ICdxdWVzdGlvbicsIAogICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IG5leHRJbmRleCwKICAgIHF1ZXN0aW9uRGlzcGxheWVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgc2NvcmVzQ2FsY3VsYXRlZDogZmFsc2UgLy8gPC0tLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYnguYDguJ7guLfguYjguK3guKPguLXguYDguIvguYfguJXguITguYjguLLguYDguKHguLfguYjguK3guYDguKPguLTguYjguKHguILguYnguK3guYPguKvguKHguYgKfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgeyBzdGF0dXM6ICdwb2RpdW0nIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUpvaW5TeW5jR2FtZSgpIHsKICAgIGNvbnN0IHBpbiA9IHByb21wdCgi4LiB4Lij4Li44LiT4Liy4Lib4LmJ4Lit4LiZ4Lij4Lir4Lix4LiqIFN5bmMgR2FtZSAoMiDguKvguKXguLHguIEpOiIpOwogICAgaWYgKCFwaW4gfHwgcGluLnRyaW0oKS5sZW5ndGggIT09IDIpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4Lij4Lir4Lix4Liq4LmE4Lih4LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgZ2FtZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2ApOwogICAgICAgIGNvbnN0IHEgPSBxdWVyeShnYW1lc1JlZiwgd2hlcmUoInBpbiIsICI9PSIsIHBpbi50cmltKCkpLCB3aGVyZSgic3RhdHVzIiwgIj09IiwgImxvYmJ5IikpOwogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgaWYgKHNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJogU3luYyBHYW1lIOC4lOC5ieC4p+C4ouC4o+C4q+C4seC4quC4meC4teC5iSDguKvguKPguLfguK3guIHguLTguIjguIHguKPguKPguKHguYTguJTguYnguYDguKPguLTguYjguKHguYTguJvguYHguKXguYnguKciKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZ2FtZURvYyA9IHNuYXBzaG90LmRvY3NbMF07CiAgICAgICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lRG9jLmlkOyAvLyDguYPguIrguYnguJXguLHguKfguYHguJvguKPguIHguKXguLLguIfguYDguJTguLTguKEKICAgICAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVEb2MuZGF0YSgpOwoKICAgICAgICAvLyDguJTguLbguIfguILguYnguK3guKHguLnguKUgUHJvamVjdCDguIjguLLguIEgcXVpeklkIOC4l+C4teC5iOC4reC4ouC4ueC5iOC5g+C4mSBnYW1lRGF0YQogICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGdhbWVEYXRhLnF1aXpJZCk7CiAgICAgICAgY29uc3QgcXVpelNuYXAgPSBhd2FpdCBnZXREb2MocXVpelJlZik7CiAgICAgICAgaWYgKCFxdWl6U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJrguJfguLXguYjguYPguIrguYnguYPguJnguYDguIHguKHguJnguLXguYkiKTsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IHF1aXpTbmFwLmRhdGEoKTsKICAgICAgICAKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgcXVpekRhdGEucHJvamVjdElkKTsKICAgICAgICBjb25zdCBwcm9qZWN0U25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpKSB0aHJvdyBuZXcgRXJyb3IoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5guC4m+C4o+C5gOC4iOC4hCIpOwoKICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXo7IC8vIOC5g+C4iuC5ieC4guC5ieC4reC4quC4reC4muC4l+C4teC5iOC4quC4peC4seC4muC5geC4peC5ieC4p+C4iOC4suC4geC5g+C4meC5gOC4geC4oQogICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gcHJvamVjdFNuYXAuZGF0YSgpOwoKICAgICAgICAvLyAqKiog4LiI4Li44LiU4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Liq4Liz4LiE4Lix4LiNOiDguYDguKPguLXguKLguIHguYPguIrguYnguKvguJnguYnguLLguIjguK3guYDguKXguLfguK3guIHguJzguLnguYnguYDguKXguYjguJnguILguK3guIcgVGVhbSBNb2RlICoqKgogICAgICAgIHNob3dWaWV3KCdzdHVkZW50LXRlYW0tam9pbicpOyAvLyDguKrguLHguYjguIfguYPguKvguYnguYHguKrguJTguIfguKvguJnguYnguLLguIjguK0gY2hlY2tib3gKICAgICAgICBzaG93VGVhbVBsYXllclNlbGVjdGlvbihwcm9qZWN0RGF0YS5zdHVkZW50cywgcXVpekRhdGEudG9waWMpOwoKICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJkgRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiH4Lib4Li44LmI4Lih4Lii4Li34LiZ4Lii4Lix4LiZ4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiC4Lit4LiHIFN5bmMgTW9kZQogICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS10ZWFtLXBsYXllcnMtYnRuJyk7CiAgICAgICAgY29uZmlybUJ0bi5vbmNsaWNrID0gY29uZmlybUFuZEpvaW5TeW5jR2FtZTsgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmD4Lir4LmJ4LmE4Lib4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmICgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBqb2luaW5nIHN5bmMgZ2FtZToiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfQp9CgpmdW5jdGlvbiB1cGRhdGVTdHVkZW50U3luY1ZpZXcoZ2FtZURhdGEpIHsKICAgIGNvbnN0IG15TmFtZSA9IGxvY2FsVGVhbVBsYXllcnNbMF07CiAgICBjb25zdCBteURhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW215TmFtZV0gfHwge307IAoKICAgIGlmIChzeW5jUXVlc3Rpb25UaW1lckludGVydmFsKSBjbGVhckludGVydmFsKHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgCiAgICBzd2l0Y2ggKGdhbWVEYXRhLnN0YXR1cykgewogICAgICAgIGNhc2UgJ2xvYmJ5JzoKICAgICAgICAgICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOwogICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPjxoMj7guYDguILguYnguLLguKPguYjguKfguKHguKrguLPguYDguKPguYfguIghPC9oMj48cD7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYDguKPguLTguYjguKHguYDguIHguKEuLi48L3A+PC9kaXY+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIAogICAgICAgIGNhc2UgJ3F1ZXN0aW9uJzoKICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmI4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgICAgIGlmIChnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCAhPT0gbGFzdFNlZW5RdWVzdGlvbkluZGV4KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiTmV3IHF1ZXN0aW9uIGRldGVjdGVkLiBDbGVhbmluZyB1cC4iKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLS0tIFvguIjguLjguJTguJfguLXguYjguYHguIHguYnguYTguII6IOC4ouC5ieC4suC4ouC4geC4suC4o+C4o+C4teC5gOC4i+C5h+C4leC4peC4s+C4lOC4seC4muC4oeC4suC5hOC4p+C5ieC4leC4o+C4h+C4meC4teC5iV0gLS0tCiAgICAgICAgICAgICAgICAvLyDguIjguLDguKPguLXguYDguIvguYfguJXguYDguJvguYfguJnguITguJnguYHguKPguIEg4LmA4LiJ4Lie4Liy4Liw4LmA4Lih4Li34LmI4LitICLguILguLbguYnguJnguILguYnguK3guYPguKvguKHguYgiIOC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgICAgICAgICAgbG9jYWxQbGF5ZXJUdXJuSW5kZXggPSAwOyAKICAgICAgICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgICAgICAgICAvLyAxLiDguKXguYnguLLguIcgU2Vzc2lvblN0b3JhZ2UKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3Bvd2VydXBVc2VkVGhpc1R1cm4nKTsgCiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdvblNlY29uZENoYW5jZScpOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgncG9sbFVzZWRUaGlzVHVybicpOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgb2xkTWFya2V0RmxhZ1ByZWZpeCA9ICdmcmVlTWFya2V0RW50cnlVc2VkX3EnICsgbGFzdFNlZW5RdWVzdGlvbkluZGV4OwogICAgICAgICAgICAgICAgY29uc3Qgb2xkUG93ZXJ1cEZsYWdQcmVmaXggPSAncG93ZXJ1cFVzZWRfcScgKyBsYXN0U2VlblF1ZXN0aW9uSW5kZXg7IAogICAgICAgICAgICAgICAgY29uc3Qgb2xkSGlkZGVuT3B0aW9uc1ByZWZpeCA9ICdoaWRkZW5PcHRpb25zX3EnICsgbGFzdFNlZW5RdWVzdGlvbkluZGV4OwoKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHNlc3Npb25TdG9yYWdlKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKG9sZE1hcmtldEZsYWdQcmVmaXgpIHx8IGtleS5zdGFydHNXaXRoKG9sZFBvd2VydXBGbGFnUHJlZml4KSB8fCBrZXkuc3RhcnRzV2l0aChvbGRIaWRkZW5PcHRpb25zUHJlZml4KSkgewogICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gMi4g4Lil4LmJ4Liy4LiH4Liq4LiW4Liy4LiZ4Liw4LiE4LmJ4Liy4LiH4LmD4LiZIERhdGFiYXNlCiAgICAgICAgICAgICAgICBpZiAobXlEYXRhLmlzSmlueGVkIHx8IG15RGF0YS5pc0ZvcmNlZENvbmZpZGVudCB8fCAobXlEYXRhLnRpbWVCb251c1RoaXNRdWVzdGlvbiB8fCAwKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBteU5hbWUpOwogICAgICAgICAgICAgICAgICAgIHVwZGF0ZURvYyhwbGF5ZXJSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNKaW54ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICBpc0ZvcmNlZENvbmZpZGVudDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVCb251c1RoaXNRdWVzdGlvbjogMAogICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGUgPT4gY29uc29sZS5lcnJvcigiQXV0by1jbGVhbnVwIGZhaWxlZDoiLCBlKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGFzdFNlZW5RdWVzdGlvbkluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIC0tLSBb4LiI4Li44LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCOiDguKXguJrguJrguKPguKPguJfguLHguJTguJnguLXguYnguK3guK3guIFdIC0tLQogICAgICAgICAgICAvLyBsb2NhbFBsYXllclR1cm5JbmRleCA9IDA7IDwtLS0g4Lil4Lia4Lit4Lit4LiBIOC5gOC4nuC4o+C4suC4sOC4oeC4seC4meC4l+C4s+C5g+C4q+C5ieC5gOC4lOC5ieC4h+C4geC4peC4seC4muC4l+C4uOC4geC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4i+C4t+C5ieC4reC4guC4reC4hwogICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICBjb25zdCBhbGxMb2NhbFBsYXllcnNBbnN3ZXJlZCA9IGxvY2FsVGVhbVBsYXllcnMuZXZlcnkobmFtZSA9PiBnYW1lRGF0YS5wbGF5ZXJzW25hbWVdPy5hbnN3ZXJlZCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoYWxsTG9jYWxQbGF5ZXJzQW5zd2VyZWQpIHsKICAgICAgICAgICAgICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IHRleHQtY2VudGVyIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCI+PGgyPuC4quC5iOC4h+C4hOC4s+C4leC4reC4muC4hOC4o+C4muC5geC4peC5ieC4pyE8L2gyPjxwPuC4o+C4reC4nOC4ueC5ieC5gOC4peC5iOC4meC4hOC4meC4reC4t+C5iOC4meC4quC4seC4geC4hOC4o+C4ueC5iC4uLjwvcD48L2Rpdj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudFN5bmNRdWVzdGlvblZpZXcoZ2FtZURhdGEpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBMb2dpYyBUaW1lciAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICAgICAgaWYgKGdhbWVEYXRhLnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQpIHJldHVybjsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gZ2FtZURhdGEucXVlc3Rpb25EaXNwbGF5ZWRBdC50b0RhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBnYW1lRGF0YS50aW1lckR1cmF0aW9uICogMTAwMDsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbXlCb251c2VzID0gbG9jYWxUZWFtUGxheWVycy5tYXAobmFtZSA9PiBnYW1lRGF0YS5wbGF5ZXJzW25hbWVdPy50aW1lQm9udXNUaGlzUXVlc3Rpb24gfHwgMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlQm9udXNNcyA9IE1hdGgubWF4KC4uLm15Qm9udXNlcywgMCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IHN0YXJ0VGltZSArIGR1cmF0aW9uICsgYWN0aXZlQm9udXNNczsgCgogICAgICAgICAgICAgICAgICAgIHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZyA9IGVuZFRpbWUgLSBEYXRlLm5vdygpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lckJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXRpbWVyLWJhcicpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjb3VudGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy10aW1lci1jb3VudGRvd24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyQmFyKSB0aW1lckJhci5zdHlsZS53aWR0aCA9ICcwJSc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRkb3duKSBjb3VudGRvd24udGV4dENvbnRlbnQgPSAnMCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5g+C4hOC4o+C4l+C4teC5iOC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4muC5gOC4oeC4t+C5iOC4reC5gOC4p+C4peC4suC4q+C4oeC4lAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFBsYXllciA9IGxvY2FsVGVhbVBsYXllcnNbbG9jYWxQbGF5ZXJUdXJuSW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWVEYXRhLnBsYXllcnNbY3VycmVudFBsYXllcl0/LmFuc3dlcmVkICE9PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IHRleHQtY2VudGVyIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNsb2NrIGZhLTN4IHRleHQteWVsbG93LTMwMCBtYi00Ij48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCI+4Lir4Lih4LiU4LmA4Lin4Lil4LiyITwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtNCB0ZXh0LXhsIHRleHQtaW5kaWdvLTIwMCI+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44LihLi4uICjguITguLPguJXguK3guJrguILguK3guIfguITguLjguJPguYTguKHguYjguJbguLnguIHguJrguLHguJnguJfguLbguIEpPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyQmFyICYmIGNvdW50ZG93bikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsRHVyYXRpb25XaXRoQm9udXMgPSBkdXJhdGlvbiArIGFjdGl2ZUJvbnVzTXM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsRHVyYXRpb25XaXRoQm9udXMgPiAwID8gKHJlbWFpbmluZyAvIHRvdGFsRHVyYXRpb25XaXRoQm9udXMpICogMTAwIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lckJhci5zdHlsZS53aWR0aCA9IGAke3BlcmNlbnRhZ2V9JWA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRkb3duLnRleHRDb250ZW50ID0gTWF0aC5jZWlsKHJlbWFpbmluZyAvIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgNTAwKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgCiAgICAgICAgY2FzZSAnc3VtbWFyeSc6CiAgICAgICAgICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkZXIiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIG10LTQiPuC4l+C4uOC4geC4hOC4meC4leC4reC4muC4hOC4o+C4muC5geC4peC5ieC4pyE8L2gyPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQteGwgdGV4dC1pbmRpZ28tMjAwIj7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYHguKrguJTguIfguJzguKXguKXguLHguJ7guJjguYwuLi48L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIAogICAgICAgY2FzZSAncmVzdWx0cyc6CiAgICAgICAgICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gMDsgLy8g4Lij4Li14LmA4LiL4LmH4LiV4LiV4Lit4LiZ4Lir4LiZ4LmJ4Liy4Liq4Lij4Li44Lib4Lic4Lil4LmE4LiU4LmJICjguYDguJ7guLfguYjguK3guYDguJXguKPguLXguKLguKHguJ7guKPguYnguK3guKHguKrguLPguKvguKPguLHguJrguKPguK3guJrguKvguJnguYnguLIpCiAgICAgICAgICAgIGNvbnN0IHZhcmlhbnQgPSBnYW1lRGF0YS5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodmFyaWFudCA9PT0gJ2Fub255bW91cycgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJykgewogICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudEFub255bW91c1Jlc3VsdHNWaWV3KGdhbWVEYXRhLCBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJykgewogICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudENvbXBldGl0aW9uUmVzdWx0c1ZpZXcoZ2FtZURhdGEsIGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4KTsgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50U3luY1Jlc3VsdHNWaWV3KGdhbWVEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgCiAgICAgICAgY2FzZSAncG9kaXVtJzoKICAgICAgICAgICAgcmVsZWFzZVdha2VMb2NrKCk7CiAgICAgICAgICAgIHN0b3BEaW1UaW1lcigpOwogICAgICAgICAgICBleGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgICBpc1F1aXpBY3RpdmUgPSBmYWxzZTsKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UpOwogICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjdXJyZW50SFRNTCA9IGxpdmVHYW1lVmlldy5pbm5lckhUTUw7CiAgICAgICAgICAgIGNvbnN0IGlzQWxyZWFkeVNob3dpbmdSZXN1bHRzID0gY3VycmVudEhUTUwuaW5jbHVkZXMoJ+C4quC4o+C4uOC4m+C4hOC4sOC5geC4meC4meC4guC4reC4h+C4hOC4uOC4kycpIHx8IGN1cnJlbnRIVE1MLmluY2x1ZGVzKCfguKrguKPguLjguJvguK3guLHguJnguJTguLHguJonKTsKCiAgICAgICAgICAgIGlmICghaXNBbHJlYWR5U2hvd2luZ1Jlc3VsdHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsVmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgICAgICAgICAgICAgIGNvbnN0IGxhc3RRSW5kZXggPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aCAtIDE7IAoKICAgICAgICAgICAgICAgIGlmIChmaW5hbFZhcmlhbnQgPT09ICdhbm9ueW1vdXMnIHx8IGZpbmFsVmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJykgewogICAgICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRBbm9ueW1vdXNSZXN1bHRzVmlldyhnYW1lRGF0YSwgbGFzdFFJbmRleCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbmFsVmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJykgewogICAgICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRDb21wZXRpdGlvblJlc3VsdHNWaWV3KGdhbWVEYXRhLCBsYXN0UUluZGV4KTsgCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRTeW5jUmVzdWx0c1ZpZXcoZ2FtZURhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBhbGxQYXJhZ3JhcGhzID0gbGl2ZUdhbWVWaWV3LnF1ZXJ5U2VsZWN0b3JBbGwoJ3AnKTsKICAgICAgICAgICAgYWxsUGFyYWdyYXBocy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgaWYgKHAudGV4dENvbnRlbnQuaW5jbHVkZXMoJ+C5gOC4leC4o+C4teC4ouC4oeC4nuC4muC4geC4seC4muC4nOC4peC4quC4o+C4uOC4m+C4quC4uOC4lOC4l+C5ieC4suC4oicpIHx8IAogICAgICAgICAgICAgICAgICAgIHAudGV4dENvbnRlbnQuaW5jbHVkZXMoJ+C4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oScpKSB7CiAgICAgICAgICAgICAgICAgICAgcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtZXhpdC1nYW1lLWJ0bicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBleGl0QnV0dG9uSFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgZmxleCBqdXN0aWZ5LWNlbnRlciBtdC04IHBiLTggZmFkZS1pbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InN0dWRlbnQtZXhpdC1nYW1lLWJ0biIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLnJlbG9hZCgpIiBjbGFzcz0iYmctcmVkLTYwMCBob3ZlcjpiZy1yZWQtNzAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWZ1bGwgdGV4dC14bCBzaGFkb3ctbGcgdHJhbnNpdGlvbi10cmFuc2Zvcm0gdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNpZ24tb3V0LWFsdCI+PC9pPiDguIjguJrguYDguIHguKHguYHguKXguLDguIHguKXguLHguJrguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgaWYgKGxpdmVHYW1lVmlldy5maXJzdEVsZW1lbnRDaGlsZCkgewogICAgICAgICAgICAgICAgICAgIGxpdmVHYW1lVmlldy5maXJzdEVsZW1lbnRDaGlsZC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGV4aXRCdXR0b25IVE1MKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbGl2ZUdhbWVWaWV3Lmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgZXhpdEJ1dHRvbkhUTUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgfQp9CgpmdW5jdGlvbiByZW5kZXJTdHVkZW50U3luY1Jlc3VsdHNWaWV3KGdhbWVEYXRhKSB7CiAgICAvLyAxLiDguJTguLbguIfguJzguLnguYnguYDguKXguYjguJkgIuC4l+C4uOC4geC4hOC4mSIg4LmD4LiZ4Lir4LmJ4Lit4LiHCiAgICBsZXQgYWxsUGxheWVyc1NvdXJjZSA9IFtdOwogICAgaWYgKGdhbWVEYXRhLnB1YmxpY0xlYWRlcmJvYXJkICYmIEFycmF5LmlzQXJyYXkoZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQpICYmIGdhbWVEYXRhLnB1YmxpY0xlYWRlcmJvYXJkLmxlbmd0aCA+IDApIHsKICAgICAgICBhbGxQbGF5ZXJzU291cmNlID0gZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQ7CiAgICB9IGVsc2UgewogICAgICAgIGFsbFBsYXllcnNTb3VyY2UgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pOwogICAgfQoKICAgIGNvbnN0IHZhcmlhbnQgPSBnYW1lRGF0YS5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICBjb25zdCBpc1JldmVhbEF0RW5kTW9kZSA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBxdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zOwogICAgCiAgICBjb25zdCBsaW1pdEluZGV4ID0gKGlzUmV2ZWFsQXRFbmRNb2RlICYmIGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXggIT09IHVuZGVmaW5lZCkgCiAgICAgICAgICAgICAgICAgICAgICAgPyBnYW1lRGF0YS5yZXZpZXdRdWVzdGlvbkluZGV4IAogICAgICAgICAgICAgICAgICAgICAgIDogZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICAKICAgIGNvbnN0IHF1ZXN0aW9uSW5kZXhUb0NoZWNrID0gKGlzUmV2ZWFsQXRFbmRNb2RlKSA/IGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXggOiBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKCiAgICAvLyAyLiDguITguLPguJnguKfguJPguITguLDguYHguJnguJkKICAgIGNvbnN0IGFsbFBsYXllcnNDYWxjdWxhdGVkID0gYWxsUGxheWVyc1NvdXJjZS5tYXAocCA9PiB7CiAgICAgICAgY29uc3QgYW5zd2Vyc1RvQ29uc2lkZXIgPSAocC5hbnN3ZXJzIHx8IFtdKS5maWx0ZXIoYW5zID0+IGFucy5xdWVzdGlvbkluZGV4IDw9IGxpbWl0SW5kZXgpOwogICAgICAgIGxldCByZWFsU2NvcmUgPSAwOwogICAgICAgIGxldCBwb2ludHMgPSAwOyAKICAgICAgICBpZiAoaXNSZXZlYWxBdEVuZE1vZGUpIHsKICAgICAgICAgICAgcmVhbFNjb3JlID0gYW5zd2Vyc1RvQ29uc2lkZXIuZmlsdGVyKGEgPT4gYS5pc0NvcnJlY3QpLmxlbmd0aDsKICAgICAgICAgICAgcG9pbnRzID0gYW5zd2Vyc1RvQ29uc2lkZXIucmVkdWNlKChzdW0sIGEpID0+IHN1bSArIChhLnBvaW50c0F3YXJkZWQgfHwgMCksIDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlYWxTY29yZSA9IHAuc2NvcmUgfHwgMDsKICAgICAgICAgICAgcG9pbnRzID0gcC50b3RhbFBvaW50cyB8fCAwOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAtLS0gW0ZJWCBMT0dJQyBTVEFSVF0g4LiE4Liz4LiZ4Lin4LiTIFN0cmVhayDguYHguJrguJrguYDguILguYnguKHguIfguKfguJQgKOC5gOC4q+C4oeC4t+C4reC4mSBBZG1pbikgLS0tCiAgICAgICAgbGV0IGR5bmFtaWNTdHJlYWsgPSAwOwogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGxpbWl0SW5kZXg7IGkrKykgewogICAgICAgICAgICAgY29uc3QgYW5zID0gYW5zd2Vyc1RvQ29uc2lkZXIuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gaSk7CiAgICAgICAgICAgICBpZiAoYW5zKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0NvbWJvQnJlYWtlciA9IChhbnMucG93ZXJ1cFVzZWQgJiYgYW5zLnBvd2VydXBVc2VkICE9PSAnd2FnZXJNdWx0aXBsaWVyJykgfHwgYW5zLnVzZWRCdXlUaW1lOwogICAgICAgICAgICAgICAgaWYgKGFucy5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IGlzQ29tYm9CcmVha2VyID8gMCA6IGR5bmFtaWNTdHJlYWsgKyAxOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkeW5hbWljU3RyZWFrID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiE4Liz4LiV4Lit4Lia4LmD4LiZ4Lij4Lit4Lia4LiZ4Li14LmJID0g4Lic4Li04LiUID0g4Lij4Li14LmA4LiL4LmH4LiVCiAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIEVORF0gLS0tCgogICAgICAgIHJldHVybiB7IC4uLnAsIHJlYWxTY29yZSwgdG90YWxQb2ludHM6IHBvaW50cywgYW5zd2VyczogcC5hbnN3ZXJzLCBjb3JyZWN0U3RyZWFrOiBkeW5hbWljU3RyZWFrIH07CiAgICB9KTsKCiAgICBjb25zdCBtYXhQb2ludHMgPSBNYXRoLm1heCguLi5hbGxQbGF5ZXJzQ2FsY3VsYXRlZC5tYXAocCA9PiBwLnRvdGFsUG9pbnRzKSwgLUluZmluaXR5KTsKICAgIGNvbnN0IG1heFJhd1Njb3JlID0gTWF0aC5tYXgoLi4uYWxsUGxheWVyc0NhbGN1bGF0ZWQubWFwKHAgPT4gcC5yZWFsU2NvcmUpLCAtSW5maW5pdHkpOwogICAgY29uc3QgaXNNYXJrZXRNb2RlID0gZ2FtZURhdGEuaXNCbGFja01hcmtldEVuYWJsZWQgPT09IHRydWU7CgogICAgLy8g4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LmB4Lil4Liw4LiE4Liz4LiZ4Lin4LiT4Lit4Lix4LiZ4LiU4Lix4LiaCiAgICBjb25zdCBzb3J0ZWRBbGxQbGF5ZXJzID0gWy4uLmFsbFBsYXllcnNDYWxjdWxhdGVkXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICBsZXQgY3VycmVudFJhbmsgPSAxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0ZWRBbGxQbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHByZXYgPSBzb3J0ZWRBbGxQbGF5ZXJzW2kgLSAxXTsKICAgICAgICAgICAgY29uc3QgY3VyciA9IHNvcnRlZEFsbFBsYXllcnNbaV07CiAgICAgICAgICAgIGxldCBpc1RpZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICAgICAgIGlzVGllZCA9IChjdXJyLnRvdGFsUG9pbnRzID09PSBwcmV2LnRvdGFsUG9pbnRzKSAmJiAoY3Vyci5yZWFsU2NvcmUgPT09IHByZXYucmVhbFNjb3JlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICBpc1RpZWQgPSAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cykgJiYgKGN1cnIucmVhbFNjb3JlID09PSBwcmV2LnJlYWxTY29yZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghaXNUaWVkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UmFuayA9IGkgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNvcnRlZEFsbFBsYXllcnNbaV0uZGlzcGxheVJhbmsgPSBjdXJyZW50UmFuazsKICAgIH0KCiAgICAvLyDguIHguKPguK3guIfguYDguInguJ7guLLguLDguJzguLnguYnguYDguKXguYjguJnguYPguJnguYDguITguKPguLfguYjguK3guIfguJnguLXguYkKICAgIGxldCBteVBsYXllcnNUb1JlbmRlciA9IHNvcnRlZEFsbFBsYXllcnMuZmlsdGVyKHAgPT4gbG9jYWxUZWFtUGxheWVycy5pbmNsdWRlcyhwLm5hbWUpKTsKICAgIG15UGxheWVyc1RvUmVuZGVyLnNvcnQoKGEsIGIpID0+IChiLnRvdGFsUG9pbnRzIHx8IDApIC0gKGEudG90YWxQb2ludHMgfHwgMCkpOwoKICAgIGxldCBmb290ZXJNZXNzYWdlSFRNTCA9ICcnOwogICAgY29uc3QgaXNMYXN0UXVlc3Rpb24gPSAoaXNSZXZlYWxBdEVuZE1vZGUpID8gKGxpbWl0SW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpIDogKGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKTsKICAgIAogICAgaWYgKGdhbWVEYXRhLnN0YXR1cyA9PT0gJ3BvZGl1bScpIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9ICcnOyAKICAgIH0gZWxzZSBpZiAoaXNMYXN0UXVlc3Rpb24pIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9IGA8cCBjbGFzcz0ibXQtOCB0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXllbGxvdy0zMDAgYW5pbWF0ZS1wdWxzZSI+4LmA4LiV4Lij4Li14Lii4Lih4Lie4Lia4LiB4Lix4Lia4Lic4Lil4Liq4Lij4Li44Lib4Liq4Li44LiU4LiX4LmJ4Liy4LiiITwvcD5gOwogICAgfSBlbHNlIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9IGA8cCBjbGFzcz0ibXQtOCB0ZXh0LWxnIHRleHQtaW5kaWdvLTIwMCI+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmE4Lib4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibLi4uPC9wPmA7CiAgICB9CgogICAgY29uc3QgcG90SFRNTCA9IGdldENlbnRyYWxQb3RIVE1MKGdhbWVEYXRhKTsKCiAgICBjb25zdCByZXN1bHRzSFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTYgZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1iLTQgc2NhbGUtMTEwIj4ke3BvdEhUTUx9PC9kaXY+CgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi02IHRleHQtY2VudGVyIj7guKrguKPguLjguJvguITguLDguYHguJnguJnguILguK3guIfguITguLjguJM8L2gyPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgc3BhY2UteS0zIj4KICAgICAgICAgICAgICAgICR7bXlQbGF5ZXJzVG9SZW5kZXIubWFwKChwbGF5ZXIsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGJnQ2xhc3MgPSAnYmctd2hpdGUgdGV4dC1ncmF5LTgwMCc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFuc3dlciA9IChwbGF5ZXIuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gcXVlc3Rpb25JbmRleFRvQ2hlY2spOwoKICAgICAgICAgICAgICAgICAgICBsZXQgcG90Qm9udXNIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXIgJiYgY3VycmVudEFuc3dlci5wb3RCb251cyA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG90Qm9udXNIVE1MID0gYDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctODAwIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCBmb250LWJvbGQgbWwtMSBzaGFkb3ctc20gYm9yZGVyIGJvcmRlci15ZWxsb3ctMzAwIiB0aXRsZT0i4Liq4LmI4Lin4LiZ4LmB4Lia4LmI4LiH4LiI4Liy4LiB4LiE4LiZ4LiV4Lit4Lia4Lic4Li04LiUIj4rJHtjdXJyZW50QW5zd2VyLnBvdEJvbnVzfSBQb3Q8L3NwYW4+YDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGxldCB0dXJuU3RhdHVzSWNvbnNIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXIud2FzRm9yY2VkKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmC4LiU4LiZ4Lia4Lix4LiH4LiE4Lix4LiaIj7wn5G7PC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyLndhc0ppbnhlZCkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5guC4lOC4meC4hOC4s+C4quC4suC4myI+8J+YiDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFuc3dlci51c2VkQnV5VGltZSkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5g+C4iuC5ieC5gOC4p+C4peC4siI+4o+zPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJyZW50QW5zd2VyLnBvd2VydXBVc2VkOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb25zID0geyAncG9sbCc6ICfwn5OKJywgJ2N1dE9uZSc6ICfinILvuI8nLCAnaW5zdXJhbmNlJzogJ/Cfm6HvuI8nLCAnZmlmdHlGaWZ0eSc6ICfwn4yXJywgJ3dhZ2VyTXVsdGlwbGllcic6ICfwn5KwJywgJ3NlY29uZENoYW5jZSc6ICfwn5SBJywgJ3JldmVhbE9wdGlvbnMnOiAn8J+Rge+4jycgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWNvbnNbaXRlbV0pIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gYDxzcGFuIHRpdGxlPSLguYPguIrguYkgJHtpdGVtfSI+JHtpY29uc1tpdGVtXX08L3NwYW4+YDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDb3JyZWN0ID0gY3VycmVudEFuc3dlci5pc0NvcnJlY3Q7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29uZmlkZW50ID0gKGN1cnJlbnRBbnN3ZXIud2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IGN1cnJlbnRBbnN3ZXIud2FzQ29uZmlkZW50ID09PSAnY29uZmlkZW50Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gY3VycmVudEFuc3dlci5wb3dlcnVwVXNlZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvd2VydXBVc2VkID09PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdDbGFzcyA9IGlzQ29ycmVjdCA/ICdiZy15ZWxsb3ctMzAwIHRleHQteWVsbG93LTkwMCBmb250LWJvbGQnIDogJ2JnLXJlZC03MDAgdGV4dC13aGl0ZSBmb250LWJvbGQnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29uZmlkZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZ0NsYXNzID0gaXNDb3JyZWN0ID8gJ2JnLVsjNEFERTgwXSB0ZXh0LWdyZWVuLTkwMCBmb250LWJvbGQnIDogJ2JnLVsjRUY0NDQ0XSB0ZXh0LXdoaXRlIGZvbnQtYm9sZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZ0NsYXNzID0gJ2JnLVsjRENGQ0U3XSB0ZXh0LWdyZWVuLTkwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZ0NsYXNzID0gJ2JnLXJlZC0xMDAgdGV4dC1yZWQtOTAwJzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFvguYDguJ7guLTguYjguKFdIOC4luC5ieC4suC5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4miAo4Lir4Lih4LiU4LmA4Lin4Lil4LiyKSDguYPguKvguYnguJ7guLfguYnguJnguKvguKXguLHguIfguYDguJvguYfguJnguKrguLXguYHguJTguIcgKOC4nOC4tOC4lCkKICAgICAgICAgICAgICAgICAgICAgICAgYmdDbGFzcyA9ICdiZy1yZWQtMTAwIHRleHQtcmVkLTkwMCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCBwdW5pc2htZW50SFRNTCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyICYmIGN1cnJlbnRBbnN3ZXIucG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInICYmICFjdXJyZW50QW5zd2VyLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBwdW5pc2htZW50SFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTIgcC0yIGJnLXJlZC02MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHRleHQtY2VudGVyIGFuaW1hdGUtYm91bmNlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWhhbmQtaG9sZGluZy11c2QgZmEtMnggbWItMSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtYm9sZCI+4LmA4LiU4Li04Lih4Lie4Lix4LiZ4Lic4Li04LiUITwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBmb250LWV4dHJhYm9sZCB0ZXh0LXllbGxvdy0zMDAiPvCfkrgg4LmA4LiH4Li04LiZ4LiW4Li54LiB4Lii4Li24LiU4LmA4LiC4LmJ4Liy4LiB4Lit4LiH4LiB4Lil4Liy4LiHITwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9pbnRzRGlzcGxheSA9IHBsYXllci50b3RhbFBvaW50cyA+PSAwIAogICAgICAgICAgICAgICAgICAgICAgICA/IGAoKyR7cGxheWVyLnRvdGFsUG9pbnRzLnRvTG9jYWxlU3RyaW5nKCl9KWAgCiAgICAgICAgICAgICAgICAgICAgICAgIDogYCgke3BsYXllci50b3RhbFBvaW50cy50b0xvY2FsZVN0cmluZygpfSlgOwoKICAgICAgICAgICAgICAgICAgICBsZXQgc3RhdHVzSWNvbkhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEFuc3dlcnNTb0ZhciA9IHBsYXllci5hbnN3ZXJzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFF1ZXN0aW9uc0Fza2VkID0gbGltaXRJbmRleCArIDE7CgogICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbEFuc3dlcnNTb0ZhciA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci50b3RhbFBvaW50cyA9PT0gbWF4UG9pbnRzICYmIG1heFBvaW50cyA+IDApIHN0YXR1c0ljb25IVE1MICs9ICc8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctNTAwIG1sLTEgdGV4dC0yeGwgZHJvcC1zaGFkb3ctbWQiPvCfkZE8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIucmVhbFNjb3JlID09PSBtYXhSYXdTY29yZSAmJiBtYXhSYXdTY29yZSA+IDApIHN0YXR1c0ljb25IVE1MICs9ICc8c3BhbiBjbGFzcz0idGV4dC1ibHVlLTUwMCBtbC0xIHRleHQtMnhsIGRyb3Atc2hhZG93LW1kIj7wn46TPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnJlYWxTY29yZSA9PT0gdG90YWxRdWVzdGlvbnNBc2tlZCkgc3RhdHVzSWNvbkhUTUwgKz0gJzxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy00MDAgbWwtMSB0ZXh0LXhsIGRyb3Atc2hhZG93LW1kIj7irZA8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzR29vZEljb24gPSBzdGF0dXNJY29uSFRNTC5pbmNsdWRlcygn8J+RkScpIHx8IHN0YXR1c0ljb25IVE1MLmluY2x1ZGVzKCfwn46TJykgfHwgc3RhdHVzSWNvbkhUTUwuaW5jbHVkZXMoJ+KtkCcpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhhc0dvb2RJY29uICYmIHBsYXllci50b3RhbFBvaW50cyA8IDApIHN0YXR1c0ljb25IVE1MICs9ICc8c3BhbiBjbGFzcz0idGV4dC1yZWQtNTAwIG1sLTEgdGV4dC14bCI+4pqg77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCBmaXJlSWNvbkhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0dXJuVXNlZEJ1eVRpbWUgPSBjdXJyZW50QW5zd2VyICYmIGN1cnJlbnRBbnN3ZXIudXNlZEJ1eVRpbWU7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHVyblVzZWRJdGVtID0gY3VycmVudEFuc3dlciAmJiBjdXJyZW50QW5zd2VyLnBvd2VydXBVc2VkICYmIGN1cnJlbnRBbnN3ZXIucG93ZXJ1cFVzZWQgIT09ICd3YWdlck11bHRpcGxpZXInOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIXR1cm5Vc2VkQnV5VGltZSAmJiAhdHVyblVzZWRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBb4LmD4LiK4LmJ4LiE4LmI4Liy4LiX4Li14LmI4LiE4Liz4LiZ4Lin4LiT4LmD4Lir4Lih4LmIXSAtLS0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcFN0cmVhayA9IHBsYXllci5jb3JyZWN0U3RyZWFrIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwU3RyZWFrID49IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVJY29uSFRNTCA9IGA8c3BhbiBjbGFzcz0ibWwtMiB0ZXh0LW9yYW5nZS01MDAgYW5pbWF0ZS1wdWxzZSBmb250LWJvbGQiPvCflKUgeCR7cFN0cmVha308L3NwYW4+YDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSIke2JnQ2xhc3N9IHAtMyByb3VuZGVkLWxnIGZsZXggZmxleC1jb2wgZ2FwLTIgYm9yZGVyLTIgYm9yZGVyLWJsYWNrLzEwIHNoYWRvdy1zbSB0cmFuc2l0aW9uLWFsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgc206aXRlbXMtY2VudGVyIHNtOmp1c3RpZnktYmV0d2VlbiBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIHctZnVsbCBzbTp3LWF1dG8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtc2hyaW5rLTAgdy04IGgtOCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLWZ1bGwgYmctYmxhY2svMTAgZm9udC1ib2xkIHRleHQtbGciPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3BsYXllci5kaXNwbGF5UmFua30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIgZ2FwLTEgbWluLXctMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC1sZyB0cnVuY2F0ZSBicmVhay13b3JkcyBtYXgtdy1bMTgwcHhdIHNtOm1heC13LXhzIGxlYWRpbmctdGlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwbGF5ZXIubmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3R1cm5TdGF0dXNJY29uc0hUTUx9ICR7c3RhdHVzSWNvbkhUTUx9ICR7ZmlyZUljb25IVE1MfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHNtOmp1c3RpZnktZW5kIHctZnVsbCBzbTp3LWF1dG8gcGwtMTEgc206cGwtMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gb3BhY2l0eS03MCBzbTpoaWRkZW4iPuC4hOC4sOC5geC4meC4meC4o+C4p+C4oTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1yaWdodCB3aGl0ZXNwYWNlLW5vd3JhcCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC14bCI+JHtwbGF5ZXIucmVhbFNjb3JlfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gb3BhY2l0eS04MCBtbC0xIGZvbnQtbWVkaXVtIj4ke3BvaW50c0Rpc3BsYXl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3BvdEJvbnVzSFRNTH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cHVuaXNobWVudEhUTUx9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgfSkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAke2Zvb3Rlck1lc3NhZ2VIVE1MfSAKICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gcmVzdWx0c0hUTUw7Cn0KCmZ1bmN0aW9uIHJlbmRlclN0dWRlbnRBbm9ueW1vdXNSZXN1bHRzVmlldyhnYW1lRGF0YSwgcXVlc3Rpb25JbmRleFRvU2hvdykgewogICAgbGV0IHBsYXllcnMgPSBbXTsKICAgIGlmIChnYW1lRGF0YS5wdWJsaWNMZWFkZXJib2FyZCkgewogICAgICAgIHBsYXllcnMgPSBnYW1lRGF0YS5wdWJsaWNMZWFkZXJib2FyZDsKICAgIH0gZWxzZSB7CiAgICAgICAgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICB9CgogICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIGNvbnN0IGlzUmV2ZWFsQXRFbmRNb2RlID0gKHZhcmlhbnQgPT09ICdyZXZlYWxfYXRfZW5kJyB8fCB2YXJpYW50ID09PSAnYW5vbnltb3VzX3JldmVhbF9lbmQnKTsKICAgIGNvbnN0IGlzUmV2ZWFsZWQgPSAoZ2FtZURhdGEuaXNBbm9ueW1vdXNSZXZlYWxlZCA9PT0gdHJ1ZSk7CiAgICBjb25zdCBxdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zOwogICAgY29uc3QgbGltaXRJbmRleCA9IChpc1JldmVhbEF0RW5kTW9kZSAmJiBnYW1lRGF0YS5yZXZpZXdRdWVzdGlvbkluZGV4ICE9PSB1bmRlZmluZWQpID8gZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCA6IHF1ZXN0aW9uSW5kZXhUb1Nob3c7CgogICAgY29uc3QgcGxheWVyc1dpdGhTY29yZXMgPSBwbGF5ZXJzLm1hcChwID0+IHsKICAgICAgICBjb25zdCBhbnN3ZXJzVG9Db25zaWRlciA9IChwLmFuc3dlcnMgfHwgW10pLmZpbHRlcihhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPD0gbGltaXRJbmRleCk7CiAgICAgICAgbGV0IHJlYWxTY29yZSA9IDAsIHBvaW50cyA9IDA7CiAgICAgICAgaWYgKGlzUmV2ZWFsQXRFbmRNb2RlKSB7CiAgICAgICAgICAgIHJlYWxTY29yZSA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbHRlcihhID0+IGEuaXNDb3JyZWN0KS5sZW5ndGg7CiAgICAgICAgICAgIHBvaW50cyA9IGFuc3dlcnNUb0NvbnNpZGVyLnJlZHVjZSgoc3VtLCBhKSA9PiBzdW0gKyAoYS5wb2ludHNBd2FyZGVkIHx8IDApLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWFsU2NvcmUgPSBwLnNjb3JlIHx8IDA7CiAgICAgICAgICAgIHBvaW50cyA9IHAudG90YWxQb2ludHMgfHwgMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLS0tIFtGSVggTE9HSUMgU1RBUlRdIOC4hOC4s+C4meC4p+C4kyBTdHJlYWsg4LmB4Lia4Lia4LmA4LiC4LmJ4Lih4LiH4Lin4LiU4Liq4Liz4Lir4Lij4Lix4Lia4LmC4Lir4Lih4LiUIEFub255bW91cyAtLS0KICAgICAgICBsZXQgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgCiAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiV4Lix4LmJ4LiH4LmB4LiV4LmI4LiC4LmJ4Lit4LmB4Lij4LiB4LiI4LiZ4LiW4Li24LiH4LiC4LmJ4Lit4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZIOC5gOC4nuC4t+C5iOC4reC4q+C4suC4iOC4uOC4lOC4l+C4teC5iCAi4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lit4LiaIgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGxpbWl0SW5kZXg7IGkrKykgewogICAgICAgICAgICAgY29uc3QgYW5zID0gYW5zd2Vyc1RvQ29uc2lkZXIuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gaSk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGlmIChhbnMpIHsKICAgICAgICAgICAgICAgIC8vIOC4oeC4teC4hOC4s+C4leC4reC4mjog4LmA4LiK4LmH4LiE4Lin4LmI4Liy4LiW4Li54LiB4LmE4Lir4LihIOC5geC4peC4sOC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oeC4leC4seC4lOC4hOC4reC4oeC5guC4muC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgICAgICAgICAgY29uc3QgaXNDb21ib0JyZWFrZXIgPSAoYW5zLnBvd2VydXBVc2VkICYmIGFucy5wb3dlcnVwVXNlZCAhPT0gJ3dhZ2VyTXVsdGlwbGllcicpIHx8IGFucy51c2VkQnV5VGltZTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSBpc0NvbWJvQnJlYWtlciA/IDAgOiBkeW5hbWljU3RyZWFrICsgMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7IC8vIOC4leC4reC4muC4nOC4tOC4lCA9IOC4o+C4teC5gOC4i+C5h+C4lQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAvLyDguYTguKHguYjguKHguLXguITguLPguJXguK3guJrguYPguJnguILguYnguK3guJnguLXguYkgKOC4q+C4oeC4lOC5gOC4p+C4peC4sikgPSDguKPguLXguYDguIvguYfguJXguJfguLHguJnguJfguLUKICAgICAgICAgICAgICAgICBkeW5hbWljU3RyZWFrID0gMDsKICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gLS0tIFtGSVggTE9HSUMgRU5EXSAtLS0KCiAgICAgICAgcmV0dXJuIHsgLi4ucCwgcmVhbFNjb3JlLCB0b3RhbFBvaW50czogcG9pbnRzLCBhbnN3ZXJzOiBhbnN3ZXJzVG9Db25zaWRlciwgY29ycmVjdFN0cmVhazogZHluYW1pY1N0cmVhayB9OwogICAgfSk7CgogICAgY29uc3QgbWF4UG9pbnRzID0gTWF0aC5tYXgoLi4ucGxheWVyc1dpdGhTY29yZXMubWFwKHAgPT4gcC50b3RhbFBvaW50cyksIC1JbmZpbml0eSk7CiAgICBjb25zdCBtYXhSYXdTY29yZSA9IE1hdGgubWF4KC4uLnBsYXllcnNXaXRoU2NvcmVzLm1hcChwID0+IHAucmVhbFNjb3JlKSwgLUluZmluaXR5KTsKICAgIGNvbnN0IGlzTWFya2V0TW9kZSA9IGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlOwoKICAgIGNvbnN0IHNvcnRlZFBsYXllcnMgPSBbLi4ucGxheWVyc1dpdGhTY29yZXNdLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgIGlmIChiLnRvdGFsUG9pbnRzICE9PSBhLnRvdGFsUG9pbnRzKSByZXR1cm4gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChiLnJlYWxTY29yZSAhPT0gYS5yZWFsU2NvcmUpIHJldHVybiBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChiLnRvdGFsUG9pbnRzICE9PSBhLnRvdGFsUG9pbnRzKSByZXR1cm4gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChiLnJlYWxTY29yZSAhPT0gYS5yZWFsU2NvcmUpIHJldHVybiBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGEubmFtZSB8fCAnJykubG9jYWxlQ29tcGFyZShiLm5hbWUgfHwgJycsICd0aCcpOwogICAgfSk7CgogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4Lit4Lix4LiZ4LiU4Lix4LiaCiAgICBsZXQgY3VycmVudFJhbmsgPSAxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0ZWRQbGF5ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHByZXYgPSBzb3J0ZWRQbGF5ZXJzW2kgLSAxXTsKICAgICAgICAgICAgY29uc3QgY3VyciA9IHNvcnRlZFBsYXllcnNbaV07CiAgICAgICAgICAgIGxldCBpc1RpZWQgPSAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cykgJiYgKGN1cnIucmVhbFNjb3JlID09PSBwcmV2LnJlYWxTY29yZSk7CiAgICAgICAgICAgIGlmICghaXNUaWVkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UmFuayA9IGkgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNvcnRlZFBsYXllcnNbaV0uZGlzcGxheVJhbmsgPSBjdXJyZW50UmFuazsKICAgIH0KCiAgICBsZXQgdmlld2VyUGxheWVyID0gbnVsbDsKICAgIGNvbnN0IGxvY2FsUGxheWVyRGF0YSA9IHBsYXllcnNXaXRoU2NvcmVzLmZpbHRlcihwID0+IGxvY2FsVGVhbVBsYXllcnMuaW5jbHVkZXMocC5uYW1lKSk7CiAgICB2aWV3ZXJQbGF5ZXIgPSBsb2NhbFBsYXllckRhdGEubGVuZ3RoID4gMCA/IGxvY2FsUGxheWVyRGF0YS5zb3J0KChhLCBiKSA9PiBiLnRvdGFsUG9pbnRzIC0gYS50b3RhbFBvaW50cylbMF0gOiBudWxsOwogICAgCiAgICBpZiAoIXZpZXdlclBsYXllcikgeyAKICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPjxoMj7guIHguLPguKXguLHguIfguKPguK3guILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJkuLi48L2gyPjwvZGl2PmA7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgdmlld2VyUHJpbWFyeVNjb3JlID0gaXNNYXJrZXRNb2RlID8gdmlld2VyUGxheWVyLnRvdGFsUG9pbnRzIDogdmlld2VyUGxheWVyLnRvdGFsUG9pbnRzOwogICAgY29uc3QgdG90YWxRdWVzdGlvbnNBc2tlZFNvRmFyID0gbGltaXRJbmRleCArIDE7CiAgICAKICAgIGNvbnN0IHNjb3Jlc0h0bWwgPSBzb3J0ZWRQbGF5ZXJzLm1hcCgocCwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCByZWFsU2NvcmVTb0ZhciA9IHAucmVhbFNjb3JlOwogICAgICAgIGNvbnN0IHBvaW50c1ZhbHVlID0gcC50b3RhbFBvaW50czsKICAgICAgICAKICAgICAgICBjb25zdCBjdXJyZW50VHVybkFuc3dlciA9IChwLmFuc3dlcnMgfHwgW10pLmZpbmQoYW5zID0+IGFucy5xdWVzdGlvbkluZGV4ID09PSBsaW1pdEluZGV4KTsgCgogICAgICAgIGxldCBwb3RCb251c0hUTUwgPSAnJzsKICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIucG90Qm9udXMgPiAwKSB7CiAgICAgICAgICAgIHBvdEJvbnVzSFRNTCA9IGA8c3BhbiBjbGFzcz0idGV4dC14cyBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCBweC0yIHB5LTAuNSByb3VuZGVkLWZ1bGwgZm9udC1ib2xkIG1sLTEgc2hhZG93LXNtIGJvcmRlciBib3JkZXIteWVsbG93LTMwMCIgdGl0bGU9IuC4quC5iOC4p+C4meC5geC4muC5iOC4h+C4iOC4suC4geC4hOC4meC4leC4reC4muC4nOC4tOC4lCI+KyR7Y3VycmVudFR1cm5BbnN3ZXIucG90Qm9udXN9IFBvdDwvc3Bhbj5gOwogICAgICAgIH0KCiAgICAgICAgbGV0IHR1cm5TdGF0dXNJY29uc0hUTUwgPSAnJzsKICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIpIHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyLndhc0ZvcmNlZCkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5guC4lOC4meC4muC4seC4h+C4hOC4seC4miI+8J+Ruzwvc3Bhbj4nOwogICAgICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIud2FzSmlueGVkKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmC4LiU4LiZ4LiE4Liz4Liq4Liy4LibIj7wn5iIPC9zcGFuPic7CiAgICAgICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlci51c2VkQnV5VGltZSkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5g+C4iuC5ieC5gOC4p+C4peC4siI+4o+zPC9zcGFuPic7CiAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQ7CiAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCkgewogICAgICAgICAgICAgICAgY29uc3QgaWNvbnMgPSB7ICdwb2xsJzogJ/Cfk4onLCAnY3V0T25lJzogJ+Kcgu+4jycsICdpbnN1cmFuY2UnOiAn8J+boe+4jycsICdmaWZ0eUZpZnR5JzogJ/CfjJcnLCAnd2FnZXJNdWx0aXBsaWVyJzogJ/CfkrAnLCAnc2Vjb25kQ2hhbmNlJzogJ/CflIEnLCAnYnV5VGltZSc6ICfij7MnLCAncmV2ZWFsT3B0aW9ucyc6ICfwn5GB77iPJyB9OwogICAgICAgICAgICAgICAgaWYgKGljb25zW3Bvd2VydXBVc2VkXSkgdHVyblN0YXR1c0ljb25zSFRNTCArPSBgPHNwYW4gdGl0bGU9IuC5g+C4iuC5iSAke3Bvd2VydXBVc2VkfSI+JHtpY29uc1twb3dlcnVwVXNlZF19PC9zcGFuPmA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGV0IHN0YXR1c0ljb25IVE1MID0gJyc7IAogICAgICAgIGlmICh0b3RhbFF1ZXN0aW9uc0Fza2VkU29GYXIgPiAwKSB7CiAgICAgICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgICAgIGlmIChwb2ludHNWYWx1ZSA9PT0gbWF4UG9pbnRzICYmIG1heFBvaW50cyA+IDApIHN0YXR1c0ljb25IVE1MICs9ICc8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctMzAwIG1sLTEgdGV4dC0yeGwgZHJvcC1zaGFkb3ctbWQiPvCfkZE8L3NwYW4+JzsKICAgICAgICAgICAgICAgIGlmIChyZWFsU2NvcmVTb0ZhciA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtYmx1ZS0zMDAgbWwtMSB0ZXh0LTJ4bCBkcm9wLXNoYWRvdy1tZCI+8J+Okzwvc3Bhbj4nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgaXNQZXJmZWN0UmVhbFNjb3JlID0gKHAucmVhbFNjb3JlID09PSB0b3RhbFF1ZXN0aW9uc0Fza2VkU29GYXIgJiYgdG90YWxRdWVzdGlvbnNBc2tlZFNvRmFyID4gMCk7CiAgICAgICAgICAgICAgICBpZiAoaXNQZXJmZWN0UmVhbFNjb3JlKSBzdGF0dXNJY29uSFRNTCA9ICc8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctMzAwIG1sLTEiPuKtkDwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0dXNJY29uSFRNTCA9PT0gJycgJiYgcG9pbnRzVmFsdWUgPCAwKSBzdGF0dXNJY29uSFRNTCA9ICc8c3BhbiBjbGFzcz0idGV4dC1yZWQtNDAwIG1sLTEiPuKaoO+4jzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsZXQgZmlyZUljb25IVE1MID0gJyc7CiAgICAgICAgY29uc3QgdHVyblVzZWRCdXlUaW1lID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIudXNlZEJ1eVRpbWU7CiAgICAgICAgY29uc3QgdHVyblVzZWRJdGVtID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgIT09ICd3YWdlck11bHRpcGxpZXInOwoKICAgICAgICAvLyDguYPguIrguYkgY29ycmVjdFN0cmVhayDguJfguLXguYjguITguLPguJnguKfguJPguYPguKvguKHguYjguYHguKXguYnguKcKICAgICAgICBpZiAoIXR1cm5Vc2VkQnV5VGltZSAmJiAhdHVyblVzZWRJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IHBTdHJlYWsgPSBwLmNvcnJlY3RTdHJlYWsgfHwgMDsKICAgICAgICAgICAgaWYgKHBTdHJlYWsgPj0gMykgewogICAgICAgICAgICAgICAgZmlyZUljb25IVE1MID0gYDxzcGFuIGNsYXNzPSJtbC0xIHRleHQtb3JhbmdlLTUwMCBhbmltYXRlLXB1bHNlIGZvbnQtYm9sZCB0ZXh0LXNtIj7wn5SlIHgke3BTdHJlYWt9PC9zcGFuPmA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxldCBoaWdobGlnaHRDbGFzcyA9ICdiZy1ibGFjay8yMCc7IAogICAgICAgIGxldCBpc1dhZ2VyV2luID0gZmFsc2U7CiAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyKSB7IAogICAgICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBjdXJyZW50VHVybkFuc3dlci5pc0NvcnJlY3Q7CiAgICAgICAgICAgIGNvbnN0IGlzQ29uZmlkZW50ID0gKGN1cnJlbnRUdXJuQW5zd2VyLndhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCBjdXJyZW50VHVybkFuc3dlci53YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKTsKICAgICAgICAgICAgY29uc3QgcG93ZXJ1cFVzZWQgPSBjdXJyZW50VHVybkFuc3dlci5wb3dlcnVwVXNlZDsgCiAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgIGlmIChpc0NvcnJlY3QpIHsgaGlnaGxpZ2h0Q2xhc3MgPSAnYmcteWVsbG93LTMwMCB0ZXh0LXllbGxvdy05MDAgZm9udC1ib2xkJzsgaXNXYWdlcldpbiA9IHRydWU7IH0gCiAgICAgICAgICAgICAgICBlbHNlIHsgaGlnaGxpZ2h0Q2xhc3MgPSAnYmctcmVkLTcwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCc7IH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvbmZpZGVudCkgewogICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q2xhc3MgPSBpc0NvcnJlY3QgPyAnYmctWyM0QURFODBdIHRleHQtZ3JlZW4tOTAwIGZvbnQtYm9sZCcgOiAnYmctWyNFRjQ0NDRdIHRleHQtd2hpdGUgZm9udC1ib2xkJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLVsjRENGQ0U3XSB0ZXh0LWdyZWVuLTkwMCc7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGV0IGRpc3BsYXlOYW1lID0gJyc7CiAgICAgICAgY29uc3QgcmVhbE5hbWUgPSBwLm5hbWU7CiAgICAgICAgY29uc3Qgbmlja25hbWUgPSBnYW1lRGF0YS5wbGF5ZXJOaWNrbmFtZXNbcC5uYW1lXSB8fCAnPz8/JzsKICAgICAgICBjb25zdCBpc1NlbGYgPSBsb2NhbFRlYW1QbGF5ZXJzLmluY2x1ZGVzKHJlYWxOYW1lKTsgCiAgICAgICAgY29uc3Qgbmlja25hbWVDb2xvckNsYXNzID0gaXNXYWdlcldpbiA/ICd0ZXh0LXllbGxvdy04MDAnIDogJ3RleHQtZ3JheS0zMDAnOwogICAgICAgIAogICAgICAgIGNvbnN0IHRhcmdldFByaW1hcnlTY29yZSA9IGlzTWFya2V0TW9kZSA/IHAudG90YWxQb2ludHMgOiBwLnRvdGFsUG9pbnRzOwogICAgICAgIGNvbnN0IGNhblNlZVJlYWxOYW1lID0gaXNSZXZlYWxlZCB8fCBpc1NlbGYgfHwgKHZpZXdlclByaW1hcnlTY29yZSA+IHRhcmdldFByaW1hcnlTY29yZSk7CgogICAgICAgIGlmIChjYW5TZWVSZWFsTmFtZSkgewogICAgICAgICAgICAgZGlzcGxheU5hbWUgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke3JlYWxOYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1zbSAke25pY2tuYW1lQ29sb3JDbGFzc30iPigke25pY2tuYW1lfSk8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgZGlzcGxheU5hbWUgPSBgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtuaWNrbmFtZX08L3NwYW4+YDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKGlzU2VsZikgewogICAgICAgICAgICBkaXNwbGF5TmFtZSA9IGA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+PGRpdj4ke2Rpc3BsYXlOYW1lfTwvZGl2PjxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGJnLXdoaXRlLzIwIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCB3aGl0ZXNwYWNlLW5vd3JhcCI+4LiE4Li44LiTPC9zcGFuPjwvZGl2PmA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IGFsbEljb25zID0gYDxkaXYgY2xhc3M9ImZsZXggZmxleC13cmFwIGdhcC0xIj4ke3R1cm5TdGF0dXNJY29uc0hUTUx9ICR7c3RhdHVzSWNvbkhUTUx9ICR7ZmlyZUljb25IVE1MfTwvZGl2PmA7CiAgICAgICAgY29uc3QgcG9pbnRzRGlzcGxheSA9IHBvaW50c1ZhbHVlID49IDAgPyBgKCskeyhwb2ludHNWYWx1ZSkudG9Mb2NhbGVTdHJpbmcoKX0pYCA6IGAoJHsocG9pbnRzVmFsdWUpLnRvTG9jYWxlU3RyaW5nKCl9KWA7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLXN0YXJ0IHAtMyByb3VuZGVkLWxnIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCAke2hpZ2hsaWdodENsYXNzfSBnYXAtMiI+CiAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBzbTppdGVtcy1jZW50ZXIgdy1mdWxsIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLXN0YXJ0IHNtOml0ZW1zLWNlbnRlciBnYXAtMyBmbGV4LWdyb3cgbWluLXctMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LXNocmluay0wIHctOCBoLTggZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1mdWxsIGJnLWJsYWNrLzEwIGZvbnQtYm9sZCB0ZXh0LWxnIG10LTEgc206bXQtMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3AuZGlzcGxheVJhbmt9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIHNtOmZsZXgtcm93IHNtOml0ZW1zLWNlbnRlciBnYXAtMSBzbTpnYXAtMyBtaW4tdy0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7ZGlzcGxheU5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2FsbEljb25zfQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHNtOmp1c3RpZnktZW5kIHctZnVsbCBzbTp3LWF1dG8gcGwtMTEgc206cGwtMCBtdC0xIHNtOm10LTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gb3BhY2l0eS03MCBzbTpoaWRkZW4iPuC4hOC4sOC5geC4meC4meC4o+C4p+C4oTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXJpZ2h0IHdoaXRlc3BhY2Utbm93cmFwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC14bCI+JHtyZWFsU2NvcmVTb0Zhcn08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1zbSBvcGFjaXR5LTgwIG1sLTEgZm9udC1tZWRpdW0iPiR7cG9pbnRzRGlzcGxheX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3BvdEJvbnVzSFRNTH0gPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgbGV0IGZvb3Rlck1lc3NhZ2VIVE1MID0gJyc7CiAgICBjb25zdCBpc0xhc3RRdWVzdGlvbiA9IChpc1JldmVhbEF0RW5kTW9kZSkgPyAobGltaXRJbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSkgOiAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpOwogICAgCiAgICBpZiAoZ2FtZURhdGEuc3RhdHVzID09PSAncG9kaXVtJykgewogICAgICAgIGZvb3Rlck1lc3NhZ2VIVE1MID0gJyc7IAogICAgfSBlbHNlIGlmIChpc0xhc3RRdWVzdGlvbikgewogICAgICAgIGZvb3Rlck1lc3NhZ2VIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQteGwgZm9udC1ib2xkIHRleHQteWVsbG93LTMwMCBhbmltYXRlLXB1bHNlIj7guYDguJXguKPguLXguKLguKHguJ7guJrguIHguLHguJrguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKIhPC9wPmA7CiAgICB9IGVsc2UgewogICAgICAgIGZvb3Rlck1lc3NhZ2VIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQtbGcgdGV4dC1pbmRpZ28tMjAwIj7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYTguJvguILguYnguK3guJXguYjguK3guYTguJsuLi48L3A+YDsKICAgIH0KCiAgICBjb25zdCBwb3RIVE1MID0gZ2V0Q2VudHJhbFBvdEhUTUwoZ2FtZURhdGEpOwoKICAgIGNvbnN0IGRhc2hib2FyZEh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC02IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi00IHNjYWxlLTExMCI+JHtwb3RIVE1MfTwvZGl2PgoKICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItNiB0ZXh0LWNlbnRlciI+4Liq4Lij4Li44Lib4Lit4Lix4LiZ4LiU4Lix4LiaICjguKPguLLguKLguJrguLjguITguITguKUpPC9oMj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIHNwYWNlLXktMiI+JHtzY29yZXNIdG1sfTwvZGl2PgogICAgICAgICAgICAke2Zvb3Rlck1lc3NhZ2VIVE1MfQogICAgICAgIDwvZGl2PgogICAgYDsKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBkYXNoYm9hcmRIdG1sOwp9CgpmdW5jdGlvbiByZW5kZXJTdHVkZW50Q29tcGV0aXRpb25SZXN1bHRzVmlldyhnYW1lRGF0YSwgcXVlc3Rpb25JbmRleFRvU2hvdykgewogICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICBjb25zdCBjdXJyZW50UXVlc3Rpb25JbmRleCA9IHF1ZXN0aW9uSW5kZXhUb1Nob3c7IAogICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIGNvbnN0IHF1ZXN0aW9ucyA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnM7CgogICAgY29uc3QgcGxheWVyc1dpdGhTY29yZXMgPSBwbGF5ZXJzLm1hcChwID0+IHsKICAgICAgICBjb25zdCByZWFsU2NvcmUgPSBwLnNjb3JlIHx8IDA7IAogICAgICAgIGNvbnN0IHBvaW50cyA9IHAudG90YWxQb2ludHMgfHwgMDsgCiAgICAgICAgY29uc3QgYW5zd2Vyc1RvQ29uc2lkZXIgPSAocC5hbnN3ZXJzIHx8IFtdKS5maWx0ZXIoYW5zID0+ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcpID8gYW5zLnF1ZXN0aW9uSW5kZXggPD0gY3VycmVudFF1ZXN0aW9uSW5kZXggOiB0cnVlKTsKICAgICAgICByZXR1cm4geyAuLi5wLCByZWFsU2NvcmU6IHJlYWxTY29yZSwgdG90YWxQb2ludHM6IHBvaW50cywgYW5zd2VyczogYW5zd2Vyc1RvQ29uc2lkZXIgfTsKICAgIH0pOwoKICAgIGNvbnN0IGlzTWFya2V0TW9kZSA9IGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlOwoKICAgIGNvbnN0IHNvcnRlZFBsYXllcnMgPSBbLi4ucGxheWVyc1dpdGhTY29yZXNdLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIucmVhbFNjb3JlIC0gYS5yZWFsU2NvcmU7CiAgICAgICAgICAgIGlmIChzY29yZURpZmYgIT09IDApIHJldHVybiBzY29yZURpZmY7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0RpZmYgPSBiLnRvdGFsUG9pbnRzIC0gYS50b3RhbFBvaW50czsKICAgICAgICAgICAgaWYgKHBvaW50c0RpZmYgIT09IDApIHJldHVybiBwb2ludHNEaWZmOwogICAgICAgICAgICByZXR1cm4gKGEubmFtZSB8fCAnJykubG9jYWxlQ29tcGFyZShiLm5hbWUgfHwgJycsICd0aCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0RpZmYgPSBiLnRvdGFsUG9pbnRzIC0gYS50b3RhbFBvaW50czsKICAgICAgICAgICAgaWYgKHBvaW50c0RpZmYgIT09IDApIHJldHVybiBwb2ludHNEaWZmOwogICAgICAgICAgICBjb25zdCBzY29yZURpZmYgPSBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgICAgICBpZiAoc2NvcmVEaWZmICE9PSAwKSByZXR1cm4gc2NvcmVEaWZmOwogICAgICAgICAgICByZXR1cm4gKGEubmFtZSB8fCAnJykubG9jYWxlQ29tcGFyZShiLm5hbWUgfHwgJycsICd0aCcpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIOKWvOKWvOKWvCBbU1RBUlRdIOC4hOC4s+C4meC4p+C4k+C4reC4seC4meC4lOC4seC4muC5geC4muC4miAxLCAxLCAzIOKWvOKWvOKWvAogICAgbGV0IGN1cnJlbnRSYW5rID0gMTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGVkUGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICBjb25zdCBwcmV2ID0gc29ydGVkUGxheWVyc1tpIC0gMV07CiAgICAgICAgICAgIGNvbnN0IGN1cnIgPSBzb3J0ZWRQbGF5ZXJzW2ldOwogICAgICAgICAgICAvLyDguYPguIrguYnguJXguKPguKPguIHguLDguYDguJTguLXguKLguKfguIHguLHguJrguJXguK3guJkgU29ydAogICAgICAgICAgICBsZXQgaXNUaWVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgICAgIGlzVGllZCA9IChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpICYmIChjdXJyLnRvdGFsUG9pbnRzID09PSBwcmV2LnRvdGFsUG9pbnRzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlzVGllZCA9IChjdXJyLnRvdGFsUG9pbnRzID09PSBwcmV2LnRvdGFsUG9pbnRzKSAmJiAoY3Vyci5yZWFsU2NvcmUgPT09IHByZXYucmVhbFNjb3JlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFpc1RpZWQpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5rID0gaSArIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc29ydGVkUGxheWVyc1tpXS5kaXNwbGF5UmFuayA9IGN1cnJlbnRSYW5rOwogICAgfQogICAgLy8g4pay4pay4payIFtFTkRdIOC4hOC4s+C4meC4p+C4k+C4reC4seC4meC4lOC4seC4muC5gOC4quC4o+C5h+C4iOC4quC4tOC5ieC4mSDilrLilrLilrIKICAgIAogICAgLy8g4Liq4Lij4LmJ4Liy4LiHIEhUTUwKICAgIGNvbnN0IHNjb3Jlc0h0bWwgPSBzb3J0ZWRQbGF5ZXJzLm1hcCgocCwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCBwZXJmZWN0U2NvcmVTeW1ib2wgPSAnJzsgCiAgICAgICAgbGV0IGhpZ2hsaWdodENsYXNzID0gJ2JnLWJsYWNrLzIwJzsgCiAgICAgICAgY29uc3QgcmVhbE5hbWUgPSBwLm5hbWU7CiAgICAgICAgY29uc3QgZGl2U3R5bGUgPSAibGluZS1oZWlnaHQ6IDEuMzsgbWluLXdpZHRoOiAwOyI7IAogICAgICAgIGNvbnN0IHNwYW5TdHlsZSA9ICJ3b3JkLWJyZWFrOiBicmVhay1hbGw7IjsgCiAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBgPGRpdiBzdHlsZT0iJHtkaXZTdHlsZX0iIHRpdGxlPSIke3JlYWxOYW1lfSI+PHNwYW4gc3R5bGU9IiR7c3BhblN0eWxlfSI+JHtyZWFsTmFtZX08L3NwYW4+JHtwZXJmZWN0U2NvcmVTeW1ib2x9PC9kaXY+YDsKICAgICAgICBjb25zdCBzY29yZUhUTUwgPSAnJzsgCgogICAgICAgIC8vIOKWvOKWvOKWvCBb4LmB4LiB4LmJ4LmE4LiCIEhUTUxdIOC5g+C4iuC5iSBkaXNwbGF5UmFuayDguYHguJfguJkgaW5kZXgrMSDilrzilrzilrwKICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBwLTMgcm91bmRlZC1sZyB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0zMDAgJHtoaWdobGlnaHRDbGFzc30gZ2FwLTIiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1sZWZ0IiBzdHlsZT0iZmxleC1zaHJpbms6IDA7IG1pbi13aWR0aDogMi41cmVtOyI+JHtwLmRpc3BsYXlSYW5rfS48L3NwYW4+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3ciPiR7ZGlzcGxheU5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAke3Njb3JlSFRNTH0KICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAvLyDilrLilrLilrIgW+C4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4gl0g4pay4pay4payCiAgICB9KS5qb2luKCcnKTsKCiAgICBsZXQgZm9vdGVyTWVzc2FnZUhUTUwgPSAnJzsKICAgIGNvbnN0IGlzTGFzdFF1ZXN0aW9uID0gKHZhcmlhbnQgPT09ICdyZXZlYWxfYXRfZW5kJykgPyAoZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSkgOiAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpOwogICAgaWYgKGlzTGFzdFF1ZXN0aW9uKSB7CiAgICAgICAgZm9vdGVyTWVzc2FnZUhUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC14bCBmb250LWJvbGQgdGV4dC15ZWxsb3ctMzAwIGFuaW1hdGUtcHVsc2UiPuC5gOC4leC4o+C4teC4ouC4oeC4nuC4muC4geC4seC4muC4nOC4peC4quC4o+C4uOC4m+C4quC4uOC4lOC4l+C5ieC4suC4oiE8L3A+YDsKICAgIH0gZWxzZSB7CiAgICAgICAgZm9vdGVyTWVzc2FnZUhUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC1sZyB0ZXh0LWluZGlnby0yMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD5gOwogICAgfQoKICAgIGNvbnN0IGRhc2hib2FyZEh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC02IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIG1iLTYiPuC4quC4o+C4uOC4m+C4reC4seC4meC4lOC4seC4miAo4Lij4Liy4Lii4Lia4Li44LiE4LiE4LilKTwvaDI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgc3BhY2UteS0yIj4KICAgICAgICAgICAgICAgICR7c2NvcmVzSHRtbH0KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAke2Zvb3Rlck1lc3NhZ2VIVE1MfQogICAgICAgIDwvZGl2PgogICAgYDsKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBkYXNoYm9hcmRIdG1sOwp9CgpmdW5jdGlvbiByZW5kZXJTdHVkZW50U3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSkgewogICAgLy8gMS4g4Lir4Liy4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCiAgICB3aGlsZShsb2NhbFBsYXllclR1cm5JbmRleCA8IGxvY2FsVGVhbVBsYXllcnMubGVuZ3RoICYmIGdhbWVEYXRhLnBsYXllcnNbbG9jYWxUZWFtUGxheWVyc1tsb2NhbFBsYXllclR1cm5JbmRleF1dPy5hbnN3ZXJlZCA9PT0gdHJ1ZSkgewogICAgICAgIGxvY2FsUGxheWVyVHVybkluZGV4Kys7CiAgICB9CiAgICAKICAgIGlmIChsb2NhbFBsYXllclR1cm5JbmRleCA+PSBsb2NhbFRlYW1QbGF5ZXJzLmxlbmd0aCkgewogICAgICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gbG9jYWxUZWFtUGxheWVycy5maW5kSW5kZXgobmFtZSA9PiBnYW1lRGF0YS5wbGF5ZXJzW25hbWVdPy5hbnN3ZXJlZCAhPT0gdHJ1ZSk7CiAgICB9CgogICAgY29uc3QgY3VycmVudFBsYXllck9uRGV2aWNlID0gbG9jYWxUZWFtUGxheWVyc1tsb2NhbFBsYXllclR1cm5JbmRleF07CiAgICBpZiAoIWN1cnJlbnRQbGF5ZXJPbkRldmljZSkgcmV0dXJuOyAKCiAgICBjb25zdCBwbGF5ZXJEYXRhID0gZ2FtZURhdGEucGxheWVyc1tjdXJyZW50UGxheWVyT25EZXZpY2VdOwogICAgY29uc3QgcUluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICBjb25zdCB0b3RhbFF1ZXN0aW9ucyA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoOwogICAgY29uc3QgcSA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnNbcUluZGV4XTsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgIAogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CiAgICBsZXQgaGFzU3VibWl0QnV0dG9uID0gZmFsc2U7CgogICAgLy8gMi4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Liq4LiW4Liy4LiZ4Liw4LmE4Lit4LmA4LiX4Lih4LmB4Lil4LiwIEZsYWcKICAgIGNvbnN0IHBvd2VydXBGbGFnTmFtZSA9IGBwb3dlcnVwVXNlZF9xJHtxSW5kZXh9X3Ake2N1cnJlbnRQbGF5ZXJPbkRldmljZX1gOwogICAgY29uc3QgYWN0aXZlUG93ZXJ1cCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0ocG93ZXJ1cEZsYWdOYW1lKTsKICAgIGNvbnN0IGlzUmV2ZWFsZWQgPSAoYWN0aXZlUG93ZXJ1cCA9PT0gJ3JldmVhbE9wdGlvbnMnKTsgCgogICAgY29uc3QgaGlkZGVuRmxhZ05hbWUgPSBgaGlkZGVuT3B0aW9uc19xJHtxSW5kZXh9X3Ake2N1cnJlbnRQbGF5ZXJPbkRldmljZX1gOwogICAgY29uc3QgaGlkZGVuSW5kaWNlcyA9IChKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaGlkZGVuRmxhZ05hbWUpIHx8ICdbXScpKS5tYXAoU3RyaW5nKTsKCiAgICAvLyAtLS0gW+C4quC5iOC4p+C4meC4geC4suC4o+C5geC4quC4lOC4h+C4nOC4peC4leC4seC4p+C5gOC4peC4t+C4reC4gV0gLS0tCiAgICBpZiAoKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgJiYgaXNSZXZlYWxlZCAmJiBxLm9wdGlvbnMgJiYgcS5vcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICBvcHRpb25zSFRNTCA9IHEub3B0aW9ucy5tYXAoKG9wdCwgaSkgPT4gewogICAgICAgICAgICBpZiAoaGlkZGVuSW5kaWNlcy5pbmNsdWRlcyhTdHJpbmcoaSkpKSByZXR1cm4gJyc7CiAgICAgICAgICAgIHJldHVybiBgPGJ1dHRvbiBkYXRhLXZhbHVlPSIke29wdH0iIGRhdGEtaW5kZXg9IiR7aX0iIGNsYXNzPSJsaXZlLWFuc3dlci1idG4gcC00IHJvdW5kZWQtbGcgdGV4dC14bCB0ZXh0LWNlbnRlciBiZy13aGl0ZSB0ZXh0LWdyYXktODAwIGhvdmVyOmJnLWluZGlnby0xMDAgYm9yZGVyLTIgYm9yZGVyLXB1cnBsZS0zMDAgc2hhZG93LW1kIHRyYW5zZm9ybSB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUiPiR7b3B0fTwvYnV0dG9uPmA7CiAgICAgICAgfSkuam9pbignJyk7CiAgICB9IAogICAgZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgaGFzU3VibWl0QnV0dG9uID0gdHJ1ZTsKICAgICAgICBjb25zdCBpc051bWVyaWNBbnN3ZXIgPSBxLmlkZWFsQW5zd2VyICYmIC9eLT9bXGQuLF0rJC8udGVzdChTdHJpbmcocS5pZGVhbEFuc3dlcikudHJpbSgpKTsKICAgICAgICBsZXQgaW5wdXRGaWVsZEhUTUwgPSBpc051bWVyaWNBbnN3ZXIgCiAgICAgICAgICAgID8gYDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0ic3luYy1zaG9ydC1hbnN3ZXItaW5wdXQiIGlucHV0bW9kZT0iZGVjaW1hbCIgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBwLTQgYm9yZGVyLTIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgdGV4dC1ncmF5LTgwMCB0ZXh0LTN4bCB0ZXh0LWNlbnRlciBmb250LWJvbGQgZm9jdXM6Ym9yZGVyLWluZGlnby01MDAgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCBvdXRsaW5lLW5vbmUiIHBsYWNlaG9sZGVyPSIwIiBhdXRvY29tcGxldGU9Im9mZiI+YAogICAgICAgICAgICA6IGA8dGV4dGFyZWEgaWQ9InN5bmMtc2hvcnQtYW5zd2VyLWlucHV0IiBjbGFzcz0idy1mdWxsIG1heC13LWxnIHAtMyBib3JkZXIgcm91bmRlZC1sZyB0ZXh0LWdyYXktODAwIHRleHQtbGciIHJvd3M9IjMiIHBsYWNlaG9sZGVyPSLguJ7guLTguKHguJ7guYzguITguLPguJXguK3guJrguILguK3guIfguITguLjguJMuLi4iPjwvdGV4dGFyZWE+YDsKCiAgICAgICAgb3B0aW9uc0hUTUwgPSBgPGRpdiBjbGFzcz0idy1mdWxsIG1kOmNvbC1zcGFuLTIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTQiPiR7aW5wdXRGaWVsZEhUTUx9PGJ1dHRvbiBpZD0ic3luYy1zdWJtaXQtYnRuIiBjbGFzcz0iYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LXhsIj48aSBjbGFzcz0iZmFzIGZhLXBhcGVyLXBsYW5lIG1yLTIiPjwvaT7guKrguYjguIfguITguLPguJXguK3guJo8L2J1dHRvbj48L2Rpdj5gOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgc3dpdGNoKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgICAgIGNvbnN0IGJ0blllcyA9IGhpZGRlbkluZGljZXMuaW5jbHVkZXMoJzAnKSA/ICcnIDogYDxidXR0b24gZGF0YS12YWx1ZT0iMCIgZGF0YS1pbmRleD0iMCIgY2xhc3M9ImxpdmUtYW5zd2VyLWJ0biBwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIHRleHQtY2VudGVyIGJnLXdoaXRlIHRleHQtZ3JheS04MDAgaG92ZXI6YmctaW5kaWdvLTEwMCI+4LmD4LiK4LmIIC8g4LiW4Li54LiBPC9idXR0b24+YDsKICAgICAgICAgICAgICAgIGNvbnN0IGJ0bk5vID0gaGlkZGVuSW5kaWNlcy5pbmNsdWRlcygnMScpID8gJycgOiBgPGJ1dHRvbiBkYXRhLXZhbHVlPSIxIiBkYXRhLWluZGV4PSIxIiBjbGFzcz0ibGl2ZS1hbnN3ZXItYnRuIHAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIj7guYTguKHguYjguYPguIrguYggLyDguJzguLTguJQ8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBidG5ZZXMgKyBidG5ObzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgLy8g4pa84pa84pa8IFvguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguII6IOC5g+C4iuC5iSBkYXRhLXZhbHVlIOC5gOC4nuC4t+C5iOC4reC4o+C4seC4geC4qeC4siBCYWNrc2xhc2hdIOKWvOKWvOKWvAogICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgIGhhc1N1Ym1pdEJ1dHRvbiA9IHRydWU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGRyb3Bkb3duSXRlbXMgPSAocS5hbGxSZXNwb25zZXMgfHwgW10pLm1hcChvcHQgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIOC5geC4m+C4peC4hyAiIOC5gOC4m+C5h+C4mSBIVE1MIGVudGl0eSDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYkgQXR0cmlidXRlIOC4nuC4seC4hwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhZmVWYWx1ZSA9IG9wdC5yZXBsYWNlKC8iL2csICcmcXVvdDsnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBib3JkZXItYiBib3JkZXItZ3JheS0xMDAgaG92ZXI6YmctaW5kaWdvLTUwIGN1cnNvci1wb2ludGVyIHRyYW5zaXRpb24tY29sb3JzIHRleHQtbGcgdGV4dC1ncmF5LTgwMCIKICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdmFsdWU9IiR7c2FmZVZhbHVlfSIKICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s9IndpbmRvdy5zZWxlY3RTeW5jT3B0aW9uKHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLXZhbHVlJykpIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvcHR9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1kOmNvbC1zcGFuLTIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTQgc3luYy1jdXN0b20tZHJvcGRvd24gcmVsYXRpdmUiPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJzeW5jLW1hdGNoaW5nLWlucHV0IiB2YWx1ZT0iIj4KCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3aW5kb3cudG9nZ2xlU3luY0Ryb3Bkb3duKCkiIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBwLTQgYm9yZGVyLTIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgYmctd2hpdGUgdGV4dC1sZWZ0IGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBob3Zlcjpib3JkZXItaW5kaWdvLTUwMCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1pbmRpZ28tMjAwIHRyYW5zaXRpb24tYWxsIHNoYWRvdy1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJzeW5jLWRyb3Bkb3duLWRpc3BsYXkiIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIHRleHQtbGciPi0tIOC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4hOC4ueC5iOC4geC4seC4mSAtLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGV2cm9uLWRvd24gdGV4dC1ncmF5LTQwMCI+PC9pPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJzeW5jLWRyb3Bkb3duLWxpc3QiIGNsYXNzPSJoaWRkZW4gYWJzb2x1dGUgdG9wLTIwIHctZnVsbCBtYXgtdy1sZyBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgc2hhZG93LXhsIG1heC1oLTYwIG92ZXJmbG93LXktYXV0byB6LTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtkcm9wZG93bkl0ZW1zfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzeW5jLXN1Ym1pdC1idG4iIGNsYXNzPSJiZy1ncmVlbi01MDAgaG92ZXI6YmctZ3JlZW4tNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgbXQtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUgbXItMiI+PC9pPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyDilrLilrLilrIgW+C4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4gl0g4pay4pay4payCgogICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSAocS5vcHRpb25zIHx8IFtdKS5tYXAoKG9wdCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChoaWRkZW5JbmRpY2VzLmluY2x1ZGVzKFN0cmluZyhpKSkpIHJldHVybiAnJzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxidXR0b24gZGF0YS12YWx1ZT0iJHtpfSIgZGF0YS1pbmRleD0iJHtpfSIgY2xhc3M9ImxpdmUtYW5zd2VyLWJ0biBwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIHRleHQtY2VudGVyIGJnLXdoaXRlIHRleHQtZ3JheS04MDAgaG92ZXI6YmctaW5kaWdvLTEwMCI+JHtvcHR9PC9idXR0b24+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZIFRpbWVyXSAtLS0KICAgIGxldCB0aW1lckhUTUwgPSAnJzsKICAgIGlmIChnYW1lRGF0YS50aW1lck1vZGUgPT09ICdwZXJfcXVlc3Rpb24nKSB7CiAgICAgICAgdGltZXJIVE1MID0gYDxkaXYgY2xhc3M9Im15LTQiPjxkaXYgaWQ9InN5bmMtdGltZXItYmFyLWNvbnRhaW5lciIgY2xhc3M9InctZnVsbCBiZy1ncmF5LTIwMC81MCByb3VuZGVkLWZ1bGwgaC0yLjUiPjxkaXYgaWQ9InN5bmMtdGltZXItYmFyIiBjbGFzcz0iYmcteWVsbG93LTQwMCBoLTIuNSByb3VuZGVkLWZ1bGwiIHN0eWxlPSJ3aWR0aDogMTAwJTsgdHJhbnNpdGlvbjogd2lkdGggMC41cyBsaW5lYXIgMHM7Ij48L2Rpdj48L2Rpdj48cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1zbSB0ZXh0LXllbGxvdy0zMDAgbXQtMSI+4LmA4Lir4Lil4Li34Lit4LmA4Lin4Lil4LiyIDxzcGFuIGlkPSJzeW5jLXRpbWVyLWNvdW50ZG93biIgY2xhc3M9ImZvbnQtYm9sZCI+JHtnYW1lRGF0YS50aW1lckR1cmF0aW9ufTwvc3Bhbj4g4Lin4Li04LiZ4Liy4LiX4Li1PC9wPjwvZGl2PmA7CiAgICB9CiAgICAKICAgIC8vIC0tLSBbTWFya2V0ICYgSW52ZW50b3J5IExvZ2ljXSAtLS0KICAgIGxldCBtYXJrZXRBbmRJbnZlbnRvcnlIVE1MID0gJyc7CiAgICBjb25zdCB2YXJpYW50ID0gZ2FtZURhdGEuZ2FtZVZhcmlhbnQgfHwgJ2NsYXNzaWMnOwogICAgY29uc3QgaXNTZWNyZXRTY29yZU1vZGUgPSBbJ3JldmVhbF9hdF9lbmQnLCAnYW5vbnltb3VzX3JldmVhbF9lbmQnLCAnY29tcGV0aXRpb24nXS5pbmNsdWRlcyh2YXJpYW50KTsKCiAgICBpZiAoZ2FtZURhdGEuaXNCbGFja01hcmtldEVuYWJsZWQgPT09IHRydWUpIHsKICAgICAgICBpZiAoaXNTZWNyZXRTY29yZU1vZGUpIHsKICAgICAgICAgICAgaWYgKCFhY3RpdmVQb3dlcnVwKSB7CiAgICAgICAgICAgICAgICAgbWFya2V0QW5kSW52ZW50b3J5SFRNTCA9IGA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktY2VudGVyIG15LTQiPjxidXR0b24gaWQ9InVzZS1wb3dlcnVwLXdhZ2VyTXVsdGlwbGllci1pbnN0YW50IiBjbGFzcz0iYmctZ3JhZGllbnQtdG8tciBmcm9tLXJlZC01MDAgdG8tcGluay02MDAgdGV4dC13aGl0ZSBzaGFkb3ctbGcgYm9yZGVyLTQgYm9yZGVyLXdoaXRlLzIwIGFjdGl2ZTpzY2FsZS05NSBhbmltYXRlLXB1bHNlIHB5LTMgcHgtNiByb3VuZGVkLWZ1bGwgZm9udC1ib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC0xIj48ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1yb2NrZXQiPjwvaT4gPHNwYW4+4LmA4LiU4Li04Lih4Lie4Lix4LiZ4Lir4Lih4LiU4Lir4LiZ4LmJ4Liy4LiV4Lix4LiBISAo4Lin4Lix4LiU4LiU4Lin4LiHKTwvc3Bhbj48L2Rpdj48c3BhbiBjbGFzcz0idGV4dC1bMTBweF0gb3BhY2l0eS05MCBmb250LW5vcm1hbCI+KOC4nOC4tOC4lD3guYLguJTguJTguJXguJogMTAg4LiE4Lij4Lix4LmJ4LiHISk8L3NwYW4+PC9idXR0b24+PC9kaXY+YDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllclBvaW50cyA9IHBsYXllckRhdGEudG90YWxQb2ludHMgfHwgMDsKICAgICAgICAgICAgY29uc3QgcGxheWVyUG93ZXJ1cHMgPSBwbGF5ZXJEYXRhLnBvd2VydXBzIHx8IHt9OwogICAgICAgICAgICAgY29uc3QgaW52ZW50b3J5QnV0dG9ucyA9IFsKICAgICAgICAgICAgICAgIHBsYXllclBvd2VydXBzLmJ1eVRpbWUgPiAwID8gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLWJ1eVRpbWUiIGNsYXNzPSJwb3dlcnVwLWJ0biBiZy1ncmVlbi01MDAgdGV4dC13aGl0ZSBweS0xIHB4LTMgcm91bmRlZC1mdWxsIHRleHQteHMiPuKPsyDguIvguLfguYnguK3guYDguKfguKXguLIgKCR7cGxheWVyUG93ZXJ1cHMuYnV5VGltZX0pPC9idXR0b24+YCA6ICcnLAogICAgICAgICAgICAgICAgcGxheWVyUG93ZXJ1cHMucmV2ZWFsT3B0aW9ucyA+IDAgPyBgPGJ1dHRvbiBpZD0idXNlLXBvd2VydXAtcmV2ZWFsT3B0aW9ucyIgY2xhc3M9InBvd2VydXAtYnRuIGJnLXB1cnBsZS01MDAgdGV4dC13aGl0ZSBweS0xIHB4LTMgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1ib2xkIGJvcmRlci0yIGJvcmRlci15ZWxsb3ctMzAwIHNoYWRvdy1zbSI+8J+Rge+4jyDguYDguJzguKLguJXguLHguKfguYDguKXguLfguK3guIEgKCR7cGxheWVyUG93ZXJ1cHMucmV2ZWFsT3B0aW9uc30pPC9idXR0b24+YCA6ICcnLCAKICAgICAgICAgICAgICAgIHBsYXllclBvd2VydXBzLmN1dE9uZSA+IDAgPyBgPGJ1dHRvbiBpZD0idXNlLXBvd2VydXAtY3V0T25lIiBjbGFzcz0icG93ZXJ1cC1idG4gYmctZ3JlZW4tNTAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj7inILvuI8g4LiV4Lix4LiUIDEgKCR7cGxheWVyUG93ZXJ1cHMuY3V0T25lfSk8L2J1dHRvbj5gIDogJycsCiAgICAgICAgICAgICAgICBwbGF5ZXJQb3dlcnVwcy5pbnN1cmFuY2UgPiAwID8gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLWluc3VyYW5jZSIgY2xhc3M9InBvd2VydXAtYnRuIGJnLWdyZWVuLTUwMCB0ZXh0LXdoaXRlIHB5LTEgcHgtMyByb3VuZGVkLWZ1bGwgdGV4dC14cyI+8J+boe+4jyDguJvguKPguLDguIHguLHguJnguKDguLHguKIgKCR7cGxheWVyUG93ZXJ1cHMuaW5zdXJhbmNlfSk8L2J1dHRvbj5gIDogJycsCiAgICAgICAgICAgICAgICBwbGF5ZXJQb3dlcnVwcy5maWZ0eUZpZnR5ID4gMCA/IGA8YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC1maWZ0eUZpZnR5IiBjbGFzcz0icG93ZXJ1cC1idG4gYmctZ3JlZW4tNTAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj7wn4yXIDUwOjUwICgke3BsYXllclBvd2VydXBzLmZpZnR5RmlmdHl9KTwvYnV0dG9uPmAgOiAnJywKICAgICAgICAgICAgICAgIHBsYXllclBvd2VydXBzLnNlY29uZENoYW5jZSA+IDAgPyBgPGJ1dHRvbiBpZD0idXNlLXBvd2VydXAtc2Vjb25kQ2hhbmNlIiBjbGFzcz0icG93ZXJ1cC1idG4gYmctZ3JlZW4tNTAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj7wn5SBIOC5geC4geC5ieC4leC4seC4pyAoJHtwbGF5ZXJQb3dlcnVwcy5zZWNvbmRDaGFuY2V9KTwvYnV0dG9uPmAgOiAnJywKICAgICAgICAgICAgXS5maWx0ZXIoQm9vbGVhbikuam9pbignICcpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZmxhZ05hbWVNYXJrZXQgPSAnZnJlZU1hcmtldEVudHJ5VXNlZF9xJyArIHFJbmRleCArICdfcCcgKyBjdXJyZW50UGxheWVyT25EZXZpY2U7CiAgICAgICAgICAgIGNvbnN0IGZyZWVFbnRyeVVzZWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGZsYWdOYW1lTWFya2V0KSA9PT0gJ3RydWUnOwogICAgICAgICAgICBjb25zdCBjYW5FbnRlck1hcmtldCA9IChwbGF5ZXJQb2ludHMgPiAwKSAmJiAoIWZyZWVFbnRyeVVzZWQgfHwgcGxheWVyUG9pbnRzID49IDEpOwogICAgICAgICAgICBjb25zdCBtYXJrZXRCdG5UZXh0ID0gcGxheWVyUG9pbnRzID09PSAwID8gYOC4leC4peC4suC4lOC4oeC4t+C4lCAoMCBQKWAgOiAoZnJlZUVudHJ5VXNlZCA/IGDguJXguKXguLLguJTguKHguLfguJQgKC0xIFApYCA6IGDguJXguKXguLLguJTguKHguLfguJQgKCR7cGxheWVyUG9pbnRzfSBQKWApOwogICAgICAgICAgICBjb25zdCBtYXJrZXRCdG5DbGFzcyA9IGNhbkVudGVyTWFya2V0ID8gImJnLXB1cnBsZS02MDAgdGV4dC13aGl0ZSBob3ZlcjpiZy1wdXJwbGUtNzAwIHNoYWRvdy1tZCIgOiAiYmctZ3JheS00MDAgdGV4dC1ncmF5LTIwMCBjdXJzb3Itbm90LWFsbG93ZWQgb3BhY2l0eS03MCI7CiAgICAgICAgICAgIGNvbnN0IG1hcmtldEJ0bkRpc2FibGVkID0gY2FuRW50ZXJNYXJrZXQgPyAiIiA6ICJkaXNhYmxlZCI7CgogICAgICAgICAgICBsZXQgbWFpbkFjdGlvbkJ1dHRvbnMgPSBgPGJ1dHRvbiBpZD0ib3Blbi1tYXJrZXQtYnRuIiBjbGFzcz0iJHttYXJrZXRCdG5DbGFzc30gcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIG1pbi1oLVs1NHB4XSIgJHttYXJrZXRCdG5EaXNhYmxlZH0+PGkgY2xhc3M9ImZhcyBmYS1zdG9yZSBtci0yIj48L2k+ICR7bWFya2V0QnRuVGV4dH08L2J1dHRvbj5gOwoKICAgICAgICAgICAgaWYgKCFhY3RpdmVQb3dlcnVwKSB7CiAgICAgICAgICAgICAgICAgY29uc3QgY2FuV2FnZXIgPSBwbGF5ZXJQb2ludHMgPiAwOwogICAgICAgICAgICAgICAgIGNvbnN0IHdhZ2VyQnRuQ2xhc3MgPSBjYW5XYWdlciA/ICJiZy15ZWxsb3ctNDAwIHRleHQteWVsbG93LTkwMCBob3ZlcjpiZy15ZWxsb3ctNTAwIHNoYWRvdy1tZCBib3JkZXItYi00IGJvcmRlci15ZWxsb3ctNjAwIGFjdGl2ZTpib3JkZXItYi0wIGFjdGl2ZTp0cmFuc2xhdGUteS0xIiA6ICJiZy1ncmF5LTQwMCB0ZXh0LWdyYXktNjAwIGN1cnNvci1ub3QtYWxsb3dlZCBib3JkZXItYi00IGJvcmRlci1ncmF5LTUwMCBvcGFjaXR5LTcwIjsKICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW50V2FnZXJCdG5DbGFzcyA9IGNhbldhZ2VyID8gImJnLWdyYWRpZW50LXRvLXIgZnJvbS1yZWQtNTAwIHRvLXBpbmstNjAwIHRleHQtd2hpdGUgc2hhZG93LW1kIGJvcmRlci1iLTQgYm9yZGVyLXJlZC04MDAgYWN0aXZlOmJvcmRlci1iLTAgYWN0aXZlOnRyYW5zbGF0ZS15LTEiIDogImJnLWdyYXktNDAwIHRleHQtZ3JheS0yMDAgY3Vyc29yLW5vdC1hbGxvd2VkIGJvcmRlci1iLTQgYm9yZGVyLWdyYXktNTAwIG9wYWNpdHktNzAiOwogICAgICAgICAgICAgICAgIGNvbnN0IHdhZ2VyRGlzYWJsZWRBdHRyID0gY2FuV2FnZXIgPyAiIiA6ICJkaXNhYmxlZCI7CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgbWFpbkFjdGlvbkJ1dHRvbnMgKz0gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLXdhZ2VyTXVsdGlwbGllciIgY2xhc3M9IiR7d2FnZXJCdG5DbGFzc30gcHktMSBweC0zIHJvdW5kZWQtbGcgZm9udC1ib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1pbi1oLVs1NHB4XSIgJHt3YWdlckRpc2FibGVkQXR0cn0+PHNwYW4gY2xhc3M9InRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPvCfkrAg4LmA4LiU4Li04Lih4Lie4Lix4LiZ4LmA4Lil4Li34Lit4LiB4LmA4Lit4LiHPC9zcGFuPjwvYnV0dG9uPjxidXR0b24gaWQ9InVzZS1wb3dlcnVwLXdhZ2VyTXVsdGlwbGllci1pbnN0YW50IiBjbGFzcz0iJHtpbnN0YW50V2FnZXJCdG5DbGFzc30gcHktMSBweC0zIHJvdW5kZWQtbGcgZm9udC1ib2xkIHRyYW5zaXRpb24tYWxsIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG1pbi1oLVs1NHB4XSIgJHt3YWdlckRpc2FibGVkQXR0cn0+PHNwYW4gY2xhc3M9InRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPjxpIGNsYXNzPSJmYXMgZmEtcm9ja2V0Ij48L2k+IOC5gOC4lOC4tOC4oeC4nuC4seC4meC4l+C4uOC5iOC4oeC4q+C4oeC4lDwvc3Bhbj48L2J1dHRvbj5gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hcmtldEFuZEludmVudG9yeUhUTUwgPSBgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIgZ2FwLTIgbXktNCBwLTIgYmctYmxhY2svMjAgcm91bmRlZC1sZyI+PGRpdiBjbGFzcz0iZmxleCBmbGV4LXdyYXAganVzdGlmeS1jZW50ZXIgaXRlbXMtc3RyZXRjaCBnYXAtMiB3LWZ1bGwiPiR7bWFpbkFjdGlvbkJ1dHRvbnN9PC9kaXY+PGRpdiBjbGFzcz0iZmxleCBmbGV4LXdyYXAgZ2FwLTEgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIG10LTEiPiR7aW52ZW50b3J5QnV0dG9ucyB8fCAnJ308L2Rpdj48L2Rpdj5gOwogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8gLS0tIFtTdGF0dXMgQmFubmVyc10gLS0tCiAgICBsZXQgYWN0aXZlUG93ZXJ1cEhUTUwgPSAnJzsKICAgIGlmIChwbGF5ZXJEYXRhLmlzSmlueGVkKSBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1yZWQtNzAwIHRvLXJlZC05MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTQgcm91bmRlZC1sZyBtYi0zIHNoYWRvdy1sZyBhbmltYXRlLXB1bHNlIGJvcmRlci0yIGJvcmRlci1yZWQtNDAwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1za3VsbC1jcm9zc2JvbmVzIj48L2k+IDxzcGFuPuC4hOC4uOC4k+C5guC4lOC4meC4hOC4s+C4quC4suC4myE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQteHMgb3BhY2l0eS04MCI+4LiE4Liw4LmB4LiZ4LiZ4LiV4Li04LiU4Lil4LiaIHgyIOC4luC5ieC4suC4leC4reC4muC4nOC4tOC4lDwvcD48L2Rpdj5gOwogICAgaWYgKHBsYXllckRhdGEuaXNGb3JjZWRDb25maWRlbnQpIGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLWdyYXktNzAwIHRvLWdyYXktOTAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItZ3JheS01MDAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLWdob3N0Ij48L2k+IDxzcGFuPuC4luC4ueC4geC4muC4seC4h+C4hOC4seC4muC4oeC4seC5iOC4meC5g+C4iCE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQteHMgb3BhY2l0eS04MCI+4LiV4LmJ4Lit4LiH4LmA4LiU4Li04Lih4Lie4Lix4LiZ4LiU4LmJ4Lin4Lii4LiE4Lin4Liy4Lih4Lih4Lix4LmI4LiZ4LmD4LiI4Liq4Li54LiH4Liq4Li44LiUPC9wPjwvZGl2PmA7CiAgICBpZiAoKHBsYXllckRhdGEudGltZUJvbnVzVGhpc1F1ZXN0aW9uIHx8IDApID4gMCkgYWN0aXZlUG93ZXJ1cEhUTUwgKz0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20teWVsbG93LTQwMCB0by1vcmFuZ2UtNTAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItd2hpdGUvMzAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLWNsb2NrIGZhLWxnIj48L2k+PHNwYW4+4LmA4Lin4Lil4Liy4LmC4Lia4LiZ4Lix4Liq4LiX4Liz4LiH4Liy4LiZITwvc3Bhbj48L2Rpdj48cCBjbGFzcz0idGV4dC1zbSBvcGFjaXR5LTkwIj4rMjUlIOC5gOC4p+C4peC4suC4hOC4tOC4lOC5gOC4nuC4tOC5iOC4oeC4nuC4tOC5gOC4qOC4qTwvcD48L2Rpdj5gOwogICAgaWYgKGFjdGl2ZVBvd2VydXApIHsKICAgICAgICBpZiAoYWN0aXZlUG93ZXJ1cCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgIGNvbnN0IHdhZ2VyVGV4dCA9IGlzU2VjcmV0U2NvcmVNb2RlID8gJ/CfmoAg4LiE4Li44LiT4LmA4LiU4Li04Lih4Lie4Lix4LiZ4Lir4Lih4LiU4Lir4LiZ4LmJ4Liy4LiV4Lix4LiBIScgOiAn8J+SsCDguYLguKvguKHguJTguYDguJTguLTguKHguJ7guLHguJnguJfguLPguIfguLLguJnguK3guKLguLnguYghJzsKICAgICAgICAgICAgIGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgdGV4dC1jZW50ZXIgcHktMyBweC00IHJvdW5kZWQtbGcgYmctZ3JhZGllbnQtdG8tciBmcm9tLXllbGxvdy00MDAgdG8teWVsbG93LTYwMCB0ZXh0LWJsYWNrIGZvbnQtZXh0cmFib2xkIG1iLTMgYW5pbWF0ZS1wdWxzZSBib3JkZXItNCBib3JkZXIteWVsbG93LTIwMCBzaGFkb3ctbGcgdGV4dC14bCB0cmFuc2Zvcm0gc2NhbGUtMTA1Ij4ke3dhZ2VyVGV4dH0gPHNwYW4gY2xhc3M9ImJsb2NrIHRleHQtc20gbXQtMSBmb250LW5vcm1hbCB0ZXh0LXJlZC05MDAiPijguJXguK3guJrguJbguLnguIEgeDIgLyDguJXguK3guJrguJzguLTguJTguYDguKrguLXguKLguYDguIfguLTguJnguYDguILguYnguLLguIHguK3guIfguIHguKXguLLguIchKTwvc3Bhbj48L2Rpdj5gOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlUG93ZXJ1cCA9PT0gJ2N1dE9uZScpIHsgYWN0aXZlUG93ZXJ1cEhUTUwgKz0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20tZ3JlZW4tNDAwIHRvLWVtZXJhbGQtNjAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItd2hpdGUvMzAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLWN1dCBmYS1sZyI+PC9pPiA8c3Bhbj7guJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJfguLPguIfguLLguJkhPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktOTAiPuC4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4teC5iOC4nOC4tOC4lCAxIOC4guC5ieC4reC4luC4ueC4geC4leC4seC4lOC4reC4reC4geC5geC4peC5ieC4pzwvcD48L2Rpdj5gOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlUG93ZXJ1cCA9PT0gJ2ZpZnR5RmlmdHknKSB7IGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLXB1cnBsZS01MDAgdG8taW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHRleHQtY2VudGVyIHB5LTIgcHgtNCByb3VuZGVkLWxnIG1iLTMgc2hhZG93LWxnIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTIgYm9yZGVyLXdoaXRlLzMwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1hZGp1c3QgZmEtbGciPjwvaT4gPHNwYW4+NTA6NTAg4LiX4Liz4LiH4Liy4LiZITwvc3Bhbj48L2Rpdj48cCBjbGFzcz0idGV4dC1zbSBvcGFjaXR5LTkwIj7guJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguK3guK3guIEgMiDguILguYnguK08L3A+PC9kaXY+YDsKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVBvd2VydXAgPT09ICdzZWNvbmRDaGFuY2UnKSB7IGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLWJsdWUtNDAwIHRvLWN5YW4tNTAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItd2hpdGUvMzAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLXVuZG8tYWx0IGZhLWxnIj48L2k+IDxzcGFuPuC5guC4reC4geC4suC4quC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4quC4reC4hyE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQtc20gb3BhY2l0eS05MCI+4LiV4Lit4Lia4Lic4Li04LiU4LmE4LiU4LmJIDEg4LiE4Lij4Lix4LmJ4LiH4LmC4LiU4Lii4LmE4Lih4LmI4LmA4Liq4Li14Lii4LiE4Liw4LmB4LiZ4LiZPC9wPjwvZGl2PmA7CiAgICAgICAgfSBlbHNlIGlmIChhY3RpdmVQb3dlcnVwID09PSAncmV2ZWFsT3B0aW9ucycpIHsgYWN0aXZlUG93ZXJ1cEhUTUwgKz0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20tcGluay01MDAgdG8tcm9zZS02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTQgcm91bmRlZC1sZyBtYi0zIHNoYWRvdy1sZyBhbmltYXRlLXB1bHNlIGJvcmRlci0yIGJvcmRlci13aGl0ZS8zMCI+PGRpdiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtZXllIGZhLWxnIj48L2k+IDxzcGFuPuC5gOC4nOC4ouC4leC4seC4p+C5gOC4peC4t+C4reC4gSE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQtc20gb3BhY2l0eS05MCI+4LmB4Liq4LiU4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Li14LmI4LiL4LmI4Lit4LiZ4Lit4Lii4Li54LmI4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4LiiPC9wPjwvZGl2PmA7CiAgICAgICAgfSBlbHNlIGlmIChhY3RpdmVQb3dlcnVwID09PSAnaW5zdXJhbmNlJykgeyBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1ncmF5LTUwMCB0by1zbGF0ZS02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTQgcm91bmRlZC1sZyBtYi0zIHNoYWRvdy1sZyBhbmltYXRlLXB1bHNlIGJvcmRlci0yIGJvcmRlci13aGl0ZS8zMCI+PGRpdiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtc2hpZWxkLWFsdCBmYS1sZyI+PC9pPiA8c3Bhbj7guJvguKPguLDguIHguLHguJnguKDguLHguKLguJfguLPguIfguLLguJkhPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktOTAiPuC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C5gOC4quC4teC4ouC4hOC4sOC5geC4meC4meC4q+C4suC4geC4leC4reC4muC4nOC4tOC4lDwvcD48L2Rpdj5gOwogICAgICAgIH0gZWxzZSB7IGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgdGV4dC1jZW50ZXIgcHktMiBweC0zIHJvdW5kZWQtbGcgYmcteWVsbG93LTUwMCB0ZXh0LWJsYWNrIGZvbnQtYm9sZCBtYi0zIGFuaW1hdGUtcHVsc2Ugc2hhZG93LW1kIj4ke2FjdGl2ZVBvd2VydXB9IOC4l+C4s+C4h+C4suC4meC4reC4ouC4ueC5iCE8L2Rpdj5gOyB9CiAgICB9CgogICAgbGV0IGZpcmVCYW5uZXJIVE1MID0gJyc7CiAgICBpZiAoIWlzU2VjcmV0U2NvcmVNb2RlKSB7CiAgICAgICAgY29uc3QgY3VycmVudFN0cmVhayA9IHBsYXllckRhdGEuY29ycmVjdFN0cmVhayB8fCAwOwogICAgICAgIGlmIChjdXJyZW50U3RyZWFrID49IDMpIHsKICAgICAgICAgICAgZmlyZUJhbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1vcmFuZ2UtNTAwIHRvLXJlZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTQgcm91bmRlZC1sZyBtYi00IHNoYWRvdy1sZyBhbmltYXRlLXB1bHNlIGJvcmRlci0yIGJvcmRlci15ZWxsb3ctMzAwIj48ZGl2IGNsYXNzPSJ0ZXh0LWxnIGZvbnQtZXh0cmFib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLWZpcmUgdGV4dC15ZWxsb3ctMjAwIHRleHQtMnhsIj48L2k+PHNwYW4+T04gRklSRSEg4LiE4Liw4LmB4LiZ4LiZIHgyPC9zcGFuPjxpIGNsYXNzPSJmYXMgZmEtZmlyZSB0ZXh0LXllbGxvdy0yMDAgdGV4dC0yeGwiPjwvaT48L2Rpdj48L2Rpdj5gOwogICAgICAgIH0gZWxzZSBpZiAoY3VycmVudFN0cmVhayA+IDApIHsKICAgICAgICAgICAgZmlyZUJhbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idy1mdWxsIHRleHQtY2VudGVyIG1iLTQiPjxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtYm9sZCB0ZXh0LW9yYW5nZS00MDAgYmctYmxhY2svMjAgcHgtMiBweS0xIHJvdW5kZWQtZnVsbCI+8J+UpSBDb21ibzogJHtjdXJyZW50U3RyZWFrfS8zPC9zcGFuPjwvZGl2PmA7CiAgICAgICAgfQogICAgfQoKICAgIGNvbnN0IHBvdEhUTUwgPSBnZXRDZW50cmFsUG90SFRNTChnYW1lRGF0YSk7CgogICAgLy8gLS0tIFvguJvguLjguYjguKHguYDguJvguKXguLXguYjguKLguJnguITguJnguJXguK3guJpdIC0tLQogICAgbGV0IGNoYW5nZVJlc3BvbmRlckJ0bkhUTUwgPSAnJzsKICAgIGNvbnN0IHBlbmRpbmdQbGF5ZXJzID0gbG9jYWxUZWFtUGxheWVycy5maWx0ZXIobmFtZSA9PiBnYW1lRGF0YS5wbGF5ZXJzW25hbWVdPy5hbnN3ZXJlZCAhPT0gdHJ1ZSk7CiAgICBpZiAobG9jYWxUZWFtUGxheWVycy5sZW5ndGggPiAxICYmIHBlbmRpbmdQbGF5ZXJzLmxlbmd0aCA+IDEpIHsKICAgICAgICBjaGFuZ2VSZXNwb25kZXJCdG5IVE1MID0gYAogICAgICAgICAgICA8YnV0dG9uIGlkPSJzd2l0Y2gtcmVzcG9uZGVyLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzIwIGhvdmVyOmJnLXdoaXRlLzMwIHRleHQtd2hpdGUgdGV4dC1zbSBmb250LXNlbWlib2xkIHB4LTMgcHktMiByb3VuZGVkLWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHRyYW5zaXRpb24tYWxsIGJvcmRlciBib3JkZXItd2hpdGUvMzAgc2hhZG93LXNtIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlcnMiPjwvaT4g4LmA4Lib4Lil4Li14LmI4Lii4LiZCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIGA7CiAgICB9CgogICAgLy8gLS0tIFtSZW5kZXIgSFRNTCDguKvguKXguLHguIFdIC0tLQogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwiPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMyBpdGVtcy1jZW50ZXIgbWItNCByZWxhdGl2ZSB6LTIwIj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LXN0YXJ0Ij4KICAgICAgICAgICAgICAgICAgICAke2NoYW5nZVJlc3BvbmRlckJ0bkhUTUx9CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tOTAwLzUwIHB4LTQgcHktMS41IHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLWluZGlnby00MDAvMzAgYmFja2Ryb3AtYmx1ci1zbSBzaGFkb3ctbGciPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgdGV4dC13aGl0ZSB3aGl0ZXNwYWNlLW5vd3JhcCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDguILguYnguK3guJfguLXguYggPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTMwMCI+JHtxSW5kZXggKyAxfTwvc3Bhbj4gLyAke3RvdGFsUXVlc3Rpb25zfQogICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktZW5kIHRyYW5zZm9ybSBzY2FsZS05MCBvcmlnaW4tcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICR7cG90SFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1jZW50ZXIgdGV4dC15ZWxsb3ctMzAwIG15LTIgZHJvcC1zaGFkb3ctbWQiPuC4leC4suC4guC4reC4hzogJHtjdXJyZW50UGxheWVyT25EZXZpY2V9PC9wPgogICAgICAgICAgICAKICAgICAgICAgICAgJHtmaXJlQmFubmVySFRNTH0gCiAgICAgICAgICAgICR7dGltZXJIVE1MfSAKICAgICAgICAgICAgJHttYXJrZXRBbmRJbnZlbnRvcnlIVE1MfSAKICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICAke2FjdGl2ZVBvd2VydXBIVE1MfQogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItOCB0ZXh0LWNlbnRlciBsZWFkaW5nLXRpZ2h0Ij4ke3EucXVlc3Rpb25UZXh0IHx8IHEuc3RlbX08L2gyPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LTR4bCBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00Ij4ke29wdGlvbnNIVE1MfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICAKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZSgpOwoKICAgIC8vIC0tLSBbRnVuY3Rpb24g4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaXSAtLS0KICAgIGZ1bmN0aW9uIHRyaWdnZXJTdWJtaXNzaW9uKGFuc3dlclZhbHVlLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllck5hbWUpIHsKICAgICAgICBjb25zdCBjb25maWRlbmNlRW5hYmxlZCA9IGdhbWVEYXRhLmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID09PSB0cnVlOwogICAgICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgIGNvbnN0IGZsYWdOYW1lID0gYHBvd2VydXBVc2VkX3Eke3FJbmRleH1fcCR7cGxheWVyTmFtZX1gOwogICAgICAgIGNvbnN0IGFjdGl2ZVBvd2VydXAgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGZsYWdOYW1lKTsKICAgICAgICBjb25zdCBpc1dhZ2VyTW9kZSA9IGFjdGl2ZVBvd2VydXAgPT09ICd3YWdlck11bHRpcGxpZXInOwogICAgICAgIGNvbnN0IHBsYXllckRhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW3BsYXllck5hbWVdOwoKICAgICAgICBpZiAoaXNXYWdlck1vZGUpIHsKICAgICAgICAgICAgY29uc3QgaXNJbnN0YW50V2FnZXIgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdpbnN0YW50V2FnZXInKSA9PT0gJ3RydWUnOwogICAgICAgICAgICBpZiAoaXNTZWNyZXRTY29yZU1vZGUgfHwgaXNJbnN0YW50V2FnZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQb2ludHMgPSBwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIHx8IDA7CiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdpbnN0YW50V2FnZXInKTsgCiAgICAgICAgICAgICAgICBoYW5kbGVTeW5jQW5zd2VyU3VibWl0KGFuc3dlclZhbHVlLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllck5hbWUsIGZhbHNlLCBjdXJyZW50UG9pbnRzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IHdhZ2VyTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FnZXItbW9kYWwnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNsaWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1zbGlkZXInKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FnZXItYW1vdW50LWRpc3BsYXknKTsKICAgICAgICAgICAgICAgIGNvbnN0IG1heFBvaW50c0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLW1heC1wb2ludHMnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQb2ludHMgPSBwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIHx8IDA7CiAgICAgICAgICAgICAgICBzbGlkZXIubWF4ID0gY3VycmVudFBvaW50czsgc2xpZGVyLnZhbHVlID0gY3VycmVudFBvaW50czsgZGlzcGxheS50ZXh0Q29udGVudCA9IGN1cnJlbnRQb2ludHM7CiAgICAgICAgICAgICAgICBtYXhQb2ludHNFbC50ZXh0Q29udGVudCA9IGN1cnJlbnRQb2ludHM7CiAgICAgICAgICAgICAgICBzbGlkZXIub25pbnB1dCA9ICgpID0+IHsgZGlzcGxheS50ZXh0Q29udGVudCA9IHNsaWRlci52YWx1ZTsgfTsgCiAgICAgICAgICAgICAgICBjb25zdCBoaWRkZW5JbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3RlZC1hbnN3ZXItaW5kZXgtaGlkZGVuLXdhZ2VyJyk7CiAgICAgICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LmFuc3dlclZhbHVlID0gYW5zd2VyVmFsdWU7CiAgICAgICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LnF1ZXN0aW9uID0gSlNPTi5zdHJpbmdpZnkocXVlc3Rpb24pOwogICAgICAgICAgICAgICAgaGlkZGVuSW5wdXQuZGF0YXNldC5nYW1lRGF0YSA9IEpTT04uc3RyaW5naWZ5KGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgIGhpZGRlbklucHV0LmRhdGFzZXQucGxheWVyTmFtZSA9IHBsYXllck5hbWU7CiAgICAgICAgICAgICAgICB3YWdlck1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyAKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoY29uZmlkZW5jZUVuYWJsZWQpIHsgCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWRlbmNlLW1vZGFsJykuZGF0YXNldC5jdXJyZW50TW9kZSA9ICdzeW5jJzsKICAgICAgICAgICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbicpOwogICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LmFuc3dlclZhbHVlID0gYW5zd2VyVmFsdWU7CiAgICAgICAgICAgIGhpZGRlbklucHV0LmRhdGFzZXQucXVlc3Rpb24gPSBKU09OLnN0cmluZ2lmeShxdWVzdGlvbik7CiAgICAgICAgICAgIGhpZGRlbklucHV0LmRhdGFzZXQuZ2FtZURhdGEgPSBKU09OLnN0cmluZ2lmeShnYW1lRGF0YSk7CiAgICAgICAgICAgIGhpZGRlbklucHV0LmRhdGFzZXQucGxheWVyTmFtZSA9IHBsYXllck5hbWU7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWRlbmNlLW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGFuZGxlU3luY0Fuc3dlclN1Ym1pdChhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJOYW1lLCBmYWxzZSwgMCk7IAogICAgICAgIH0KICAgIH0KCiAgICBpZiAoaGFzU3VibWl0QnV0dG9uKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtc3VibWl0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXNob3J0LWFuc3dlci1pbnB1dCcpIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLW1hdGNoaW5nLXNlbGVjdCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIFvguKrguYjguKfguJnguYHguIHguYnguYTguIJdIOC4leC4o+C4p+C4iOC4quC4reC4muC4hOC5iOC4suC4iOC4suC4gSBpbnB1dCDguJfguLHguYnguIfguKrguK3guIfguYHguJrguJogLS0tCiAgICAgICAgICAgIGxldCBhbnN3ZXJWYWx1ZSA9ICcnOwogICAgICAgICAgICBpZiAoaW5wdXQpIHsKICAgICAgICAgICAgICAgIGFuc3dlclZhbHVlID0gaW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hpbmdJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLW1hdGNoaW5nLWlucHV0Jyk7CiAgICAgICAgICAgICAgICBpZiAobWF0Y2hpbmdJbnB1dCkgYW5zd2VyVmFsdWUgPSBtYXRjaGluZ0lucHV0LnZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYW5zd2VyVmFsdWUgPT09ICcnKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguKvguKPguLfguK3guJ7guLTguKHguJ7guYzguITguLPguJXguK3guJrguIHguYjguK3guJnguITguKPguLHguJoiKTsgcmV0dXJuOyB9CiAgICAgICAgICAgIHRyaWdnZXJTdWJtaXNzaW9uKGFuc3dlclZhbHVlLCBxLCBnYW1lRGF0YSwgY3VycmVudFBsYXllck9uRGV2aWNlKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpdmUtYW5zd2VyLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgdHJpZ2dlclN1Ym1pc3Npb24oYnRuLmRhdGFzZXQudmFsdWUsIHEsIGdhbWVEYXRhLCBjdXJyZW50UGxheWVyT25EZXZpY2UpOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KCiAgICBjb25zdCBzd2l0Y2hCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3dpdGNoLXJlc3BvbmRlci1idG4nKTsKICAgIGlmIChzd2l0Y2hCdG4pIHsKICAgICAgICBzd2l0Y2hCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIHNob3dSZXNwb25kZXJTZWxlY3Rpb25Nb2RhbChnYW1lRGF0YSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gLS0tIE1hcmtldCBMaXN0ZW5lcnMgLS0tCiAgICBpZiAoZ2FtZURhdGEuaXNCbGFja01hcmtldEVuYWJsZWQgPT09IHRydWUgJiYgIWlzU2VjcmV0U2NvcmVNb2RlKSB7CiAgICAgICAgY29uc3QgbWFya2V0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW4tbWFya2V0LWJ0bicpOwogICAgICAgIGlmIChtYXJrZXRCdG4pIHsKICAgICAgICAgICAgbWFya2V0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgIGNvbnN0IGZsYWdOYW1lID0gJ2ZyZWVNYXJrZXRFbnRyeVVzZWRfcScgKyBxSW5kZXggKyAnX3AnICsgY3VycmVudFBsYXllck9uRGV2aWNlOwogICAgICAgICAgICAgICAgIGNvbnN0IGZyZWVFbnRyeVVzZWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGZsYWdOYW1lKSA9PT0gJ3RydWUnOwogICAgICAgICAgICAgICAgIGlmICghZnJlZUVudHJ5VXNlZCkgewogICAgICAgICAgICAgICAgICAgICBvcGVuQmxhY2tNYXJrZXQoZ2FtZURhdGEsIHBsYXllckRhdGEpOwogICAgICAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGZsYWdOYW1lLCAndHJ1ZScpOwogICAgICAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50U3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllckRhdGEudG90YWxQb2ludHMgPCAxKSB7IHNob3dNZXNzYWdlKCLguITguLjguJPguKHguLUgUG9pbnRzIOC5hOC4oeC5iOC4nuC4rSAo4LiV4LmJ4Lit4LiH4LmD4LiK4LmJIDFQKSIpOyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigi4LmA4LiC4LmJ4Liy4LiV4Lil4Liy4LiU4Lih4Li34LiU4LiE4Lij4Lix4LmJ4LiH4LiV4LmI4Lit4LmE4Lib4LmA4Liq4Li14Lii4LiE4LmI4Liy4LiY4Lij4Lij4Lih4LmA4LiZ4Li14Lii4LihIDEgUG9pbnQg4Lii4Li34LiZ4Lii4Lix4LiZPyIsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZVBheUZvck1hcmtldEVudHJ5KGN1cnJlbnRQbGF5ZXJPbkRldmljZSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOwogICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtYnV5VGltZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICdidXlUaW1lJywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtY3V0T25lJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlOyBoYW5kbGVVc2VQb3dlcnVwKGN1cnJlbnRQbGF5ZXJPbkRldmljZSwgJ2N1dE9uZScsIHEsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsgfSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLWluc3VyYW5jZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICdpbnN1cmFuY2UnLCBxLCBnYW1lRGF0YSwgcGxheWVyRGF0YSk7IH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2UtcG93ZXJ1cC1maWZ0eUZpZnR5Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlOyBoYW5kbGVVc2VQb3dlcnVwKGN1cnJlbnRQbGF5ZXJPbkRldmljZSwgJ2ZpZnR5RmlmdHknLCBxLCBnYW1lRGF0YSwgcGxheWVyRGF0YSk7IH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2UtcG93ZXJ1cC1zZWNvbmRDaGFuY2UnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4geyBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7IGhhbmRsZVVzZVBvd2VydXAoY3VycmVudFBsYXllck9uRGV2aWNlLCAnc2Vjb25kQ2hhbmNlJywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtcmV2ZWFsT3B0aW9ucycpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICdyZXZlYWxPcHRpb25zJywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtd2FnZXJNdWx0aXBsaWVyJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlOyBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdpbnN0YW50V2FnZXInLCAnZmFsc2UnKTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICd3YWdlck11bHRpcGxpZXInLCBxLCBnYW1lRGF0YSwgcGxheWVyRGF0YSk7IH0pOwogICAgfQogICAgaWYgKGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLXdhZ2VyTXVsdGlwbGllci1pbnN0YW50Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlOyBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdpbnN0YW50V2FnZXInLCAndHJ1ZScpOyBoYW5kbGVVc2VQb3dlcnVwKGN1cnJlbnRQbGF5ZXJPbkRldmljZSwgJ3dhZ2VyTXVsdGlwbGllcicsIHEsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsgfSk7CiAgICB9Cn0KCi8vIC0tLSDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJogQ3VzdG9tIERyb3Bkb3duIOC5g+C4mSBTeW5jIE1vZGUgLS0tCndpbmRvdy50b2dnbGVTeW5jRHJvcGRvd24gPSBmdW5jdGlvbigpIHsKICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1kcm9wZG93bi1saXN0Jyk7CiAgICBpZiAobGlzdCkgbGlzdC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsKfTsKCndpbmRvdy5zZWxlY3RTeW5jT3B0aW9uID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIC8vIDEuIOC4reC4seC4m+C5gOC4lOC4leC4hOC5iOC4suC4peC4h+C5g+C4mSBIaWRkZW4gSW5wdXQKICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtbWF0Y2hpbmctaW5wdXQnKTsKICAgIGlmIChpbnB1dCkgaW5wdXQudmFsdWUgPSB2YWx1ZTsKCiAgICAvLyAyLiDguK3guLHguJvguYDguJTguJXguILguYnguK3guITguKfguLLguKHguJrguJnguJvguLjguYjguKHguYHguKrguJTguIfguJzguKUKICAgIGNvbnN0IGRpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1kcm9wZG93bi1kaXNwbGF5Jyk7CiAgICBpZiAoZGlzcGxheSkgewogICAgICAgIGRpc3BsYXkuaW5uZXJIVE1MID0gdmFsdWU7CiAgICAgICAgZGlzcGxheS5jbGFzc0xpc3QucmVtb3ZlKCd0ZXh0LWdyYXktNDAwJyk7CiAgICAgICAgZGlzcGxheS5jbGFzc0xpc3QuYWRkKCd0ZXh0LWdyYXktODAwJywgJ2ZvbnQtYm9sZCcpOwogICAgICAgIC8vIDMuIOC4quC4seC5iOC4hyBNYXRoSmF4IOC5geC4m+C4peC4h+C4quC4ueC4leC4o+C4l+C4seC4meC4l+C4tQogICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbZGlzcGxheV0pOwogICAgfQoKICAgIC8vIDQuIOC4m+C4tOC4lCBEcm9wZG93bgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtZHJvcGRvd24tbGlzdCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9OwoKLy8g4Lib4Li04LiUIERyb3Bkb3duIOC5gOC4oeC4t+C5iOC4reC4hOC4peC4tOC4geC4l+C4teC5iOC4reC4t+C5iOC4mQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5zeW5jLWN1c3RvbS1kcm9wZG93bicpKSB7CiAgICAgICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLWRyb3Bkb3duLWxpc3QnKTsKICAgICAgICBpZiAobGlzdCkgbGlzdC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0KfSk7CgpmdW5jdGlvbiBzaG93UmVzcG9uZGVyU2VsZWN0aW9uTW9kYWwoZ2FtZURhdGEpIHsKICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgIAogICAgLy8g4Lir4Liy4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiX4Li14LmI4Lii4Lix4LiH4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lit4LiaCiAgICBjb25zdCBwZW5kaW5nUGxheWVycyA9IGxvY2FsVGVhbVBsYXllcnMuZmlsdGVyKG5hbWUgPT4gZ2FtZURhdGEucGxheWVyc1tuYW1lXT8uYW5zd2VyZWQgIT09IHRydWUpOwoKICAgIGNvbnN0IGxpc3RIVE1MID0gcGVuZGluZ1BsYXllcnMubWFwKG5hbWUgPT4gYAogICAgICAgIDxidXR0b24gY2xhc3M9InctZnVsbCBiZy13aGl0ZSB0ZXh0LWluZGlnby03MDAgZm9udC1ib2xkIHB5LTQgcHgtNiByb3VuZGVkLXhsIHNoYWRvdy1tZCBob3ZlcjpzaGFkb3ctbGcgdHJhbnNpdGlvbi1hbGwgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgZ3JvdXAgc2VsZWN0LXJlc3BvbmRlci1idG4iIGRhdGEtbmFtZT0iJHtuYW1lfSI+CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXktY2lyY2xlIHRleHQtM3hsIHRleHQtaW5kaWdvLTQwMCBncm91cC1ob3Zlcjp0ZXh0LWluZGlnby02MDAgdHJhbnNpdGlvbi1jb2xvcnMiPjwvaT4KICAgICAgICA8L2J1dHRvbj4KICAgIGApLmpvaW4oJycpOwoKICAgIGNvbnN0IG1vZGFsSFRNTCA9IGAKICAgICAgICA8ZGl2IGlkPSJyZXNwb25kZXItc2VsZWN0aW9uLW92ZXJsYXkiIGNsYXNzPSJmaXhlZCBpbnNldC0wIGJnLWluZGlnby03MDAgei1bOTk5XSBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBwLTYgZmFkZS1pbiI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZS8yMCBweC00IHB5LTEgcm91bmRlZC1mdWxsIG1iLTYiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtd2hpdGUgdGV4dC1zbSI+4LiC4LmJ4Lit4LiX4Li14LmIICR7cUluZGV4ICsgMX0gLyAke3RvdGFsUXVlc3Rpb25zfTwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIG1iLTggZHJvcC1zaGFkb3ctbWQiPuC5g+C4hOC4o+C4nuC4o+C5ieC4reC4oeC4leC4reC4mj88L2gyPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LW1kIHNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICAke2xpc3RIVE1MfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxidXR0b24gaWQ9ImNsb3NlLXJlc3BvbmRlci1vdmVybGF5IiBjbGFzcz0ibXQtMTIgdGV4dC1pbmRpZ28tMjAwIGhvdmVyOnRleHQtd2hpdGUgdW5kZXJsaW5lIHRleHQtc20gdHJhbnNpdGlvbi1jb2xvcnMiPgogICAgICAgICAgICAgICAg4LiB4Lil4Lix4Lia4LmE4Lib4LiV4Liy4Lih4Lil4Liz4LiU4Lix4Lia4Lib4LiB4LiV4Li0CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICAvLyDguYHguJfguKPguIEgSFRNTCDguYDguILguYnguLLguYTguJvguYPguJkgYm9keSAo4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4LiX4Lix4Lia4LiX4Li44LiB4Lit4Lii4LmI4Liy4LiHKQogICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIG1vZGFsSFRNTCk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXJzCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VsZWN0LXJlc3BvbmRlci1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWxlY3RlZE5hbWUgPSBidG4uZGF0YXNldC5uYW1lOwogICAgICAgICAgICBzd2l0Y2hQbGF5ZXJPbkRldmljZShzZWxlY3RlZE5hbWUsIGdhbWVEYXRhKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3BvbmRlci1zZWxlY3Rpb24tb3ZlcmxheScpLnJlbW92ZSgpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXJlc3BvbmRlci1vdmVybGF5JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3BvbmRlci1zZWxlY3Rpb24tb3ZlcmxheScpLnJlbW92ZSgpOwogICAgfSk7Cn0KCi8qKgogKiBb4LmD4Lir4Lih4LmIXSDguKrguKXguLHguJogSW5kZXgg4LiC4Lit4LiH4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiHIOC5geC4peC4sOC4quC4seC5iOC4hyBSZW5kZXIg4LmD4Lir4Lih4LmICiAqLwpmdW5jdGlvbiBzd2l0Y2hQbGF5ZXJPbkRldmljZShzZWxlY3RlZE5hbWUsIGdhbWVEYXRhKSB7CiAgICBjb25zdCBuZXdJbmRleCA9IGxvY2FsVGVhbVBsYXllcnMuaW5kZXhPZihzZWxlY3RlZE5hbWUpOwogICAgaWYgKG5ld0luZGV4ICE9PSAtMSkgewogICAgICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gbmV3SW5kZXg7CiAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiBIHJlbmRlciDguYPguKvguKHguYjguJfguLHguJnguJfguLUKICAgICAgICByZW5kZXJTdHVkZW50U3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN5bmNBbnN3ZXJTdWJtaXQoYW5zd2VyVmFsdWUsIHF1ZXN0aW9uLCBnYW1lRGF0YSwgcGxheWVyTmFtZSwgaXNDb25maWRlbnQsIHdhZ2VyQW1vdW50ID0gMCkgewogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpdmUtYW5zd2VyLWJ0biwgI3N5bmMtc3VibWl0LWJ0bicpLmZvckVhY2goYiA9PiBiLmRpc2FibGVkID0gdHJ1ZSk7CgogICAgY29uc3QgcUluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICBjb25zdCBwbGF5ZXJEYXRhID0gZ2FtZURhdGEucGxheWVyc1twbGF5ZXJOYW1lXSB8fCB7fTsgCiAgICBjb25zdCBpc09uZXRNb2RlID0gZ2FtZURhdGEuaXNPbmV0TW9kZSA9PT0gdHJ1ZTsKCiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1aXpUeXBlOwogICAgbGV0IGlzQ29ycmVjdCA9IGZhbHNlOwogICAgbGV0IGFuc3dlclRleHQgPSBhbnN3ZXJWYWx1ZTsKCiAgICAvLyDguJXguKPguKfguIjguITguLPguJXguK3guJogKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgY29uc3QgYW5zd2VySW5kZXhURiA9IHBhcnNlSW50KGFuc3dlclZhbHVlKTsgCiAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RCb29sID0gKHF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIgPT09IHRydWUgfHwgU3RyaW5nKHF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIpLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJyk7CiAgICAgICAgICAgIGlzQ29ycmVjdCA9IChhbnN3ZXJJbmRleFRGID09PSAwICYmIGNvcnJlY3RCb29sKSB8fCAoYW5zd2VySW5kZXhURiA9PT0gMSAmJiAhY29ycmVjdEJvb2wpOwogICAgICAgICAgICBhbnN3ZXJUZXh0ID0gKGFuc3dlckluZGV4VEYgPT09IDApID8gJ+C5g+C4iuC5iCAvIOC4luC4ueC4gScgOiAn4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUJzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzoKICAgICAgICBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKGFuc3dlclZhbHVlLCBxdWVzdGlvbik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ21hdGNoaW5nX2l0ZW0nOgogICAgICAgICAgICBpc0NvcnJlY3QgPSAoYW5zd2VyVmFsdWUgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgY29uc3QgYW5zd2VySW5kZXhNQyA9IHBhcnNlSW50KGFuc3dlclZhbHVlKTsKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKGFuc3dlckluZGV4TUMgPT09IHF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXJJbmRleCk7CiAgICAgICAgICAgIGlmIChxdWVzdGlvbi5vcHRpb25zICYmIHF1ZXN0aW9uLm9wdGlvbnNbYW5zd2VySW5kZXhNQ10pIGFuc3dlclRleHQgPSBxdWVzdGlvbi5vcHRpb25zW2Fuc3dlckluZGV4TUNdOwogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICAvLyAtLS0gW0xPR0lDIOC4geC4suC4o+C5g+C4q+C5ieC4hOC4sOC5geC4meC4meC5g+C4q+C4oeC5iF0gLS0tCiAgICBsZXQgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gMDsKICAgIGxldCBiYXNlU3RyZWFrID0gcGxheWVyRGF0YS5jb3JyZWN0U3RyZWFrIHx8IDA7CiAgICBsZXQgbmV3U3RyZWFrID0gMDsKCiAgICAvLyAxLiDguKvguLLguJnguYnguLPguKvguJnguLHguIHguITguLDguYHguJnguJnguILguK3guIfguILguYnguK3guJnguLXguYkKICAgIGNvbnN0IHdlaWdodCA9IGdldFF1ZXN0aW9uV2VpZ2h0KGdhbWVEYXRhLnNodWZmbGVkUXVpeiwgcXVlc3Rpb25UeXBlKTsKCiAgICAvLyAyLiDguJXguKPguKfguIjguKrguK3guJrguKrguJbguLLguJnguLDguJXguYjguLLguIfguYYgKFBvd2VydXBzLCBXYWdlciwgZXRjLikKICAgIC8vIE8tTkVUIE1vZGUg4LiI4Liw4LmE4Lih4LmI4Lih4Li1IFBvd2VydXBzIOC5geC4leC5iOC4oeC4tSBXYWdlci9Db25maWRlbmNlIOC5hOC4lOC5iQogICAgY29uc3QgZmxhZ05hbWUgPSBgcG93ZXJ1cFVzZWRfcSR7cUluZGV4fV9wJHtwbGF5ZXJOYW1lfWA7CiAgICBjb25zdCBhY3RpdmVQb3dlcnVwID0gaXNPbmV0TW9kZSA/IG51bGwgOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGZsYWdOYW1lKTsgLy8gTy1ORVQg4LmE4Lih4LmI4Lih4Li1IGl0ZW0KICAgIGNvbnN0IGlzV2FnZXJNb2RlID0gYWN0aXZlUG93ZXJ1cCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicgfHwgKGlzT25ldE1vZGUgJiYgcGFyc2VJbnQod2FnZXJBbW91bnQpID4gMCk7IC8vIE8tTkVUIOC5gOC4lOC4tOC4oeC4nuC4seC4meC5hOC4lOC5iQogICAgCiAgICAvLyBMb2dpYyDguJfguLHguYjguKfguYTguJsKICAgIGNvbnN0IGlzSW5zdXJhbmNlID0gIWlzT25ldE1vZGUgJiYgYWN0aXZlUG93ZXJ1cCA9PT0gJ2luc3VyYW5jZSc7CiAgICBjb25zdCBpc1BvbGwgPSAhaXNPbmV0TW9kZSAmJiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdwb2xsVXNlZFRoaXNUdXJuJykgPT09ICd0cnVlJzsKICAgIGNvbnN0IGlzSmlueGVkID0gIWlzT25ldE1vZGUgJiYgKHBsYXllckRhdGEuaXNKaW54ZWQgPT09IHRydWUpOwogICAgY29uc3QgaXNGb3JjZWQgPSAhaXNPbmV0TW9kZSAmJiAocGxheWVyRGF0YS5pc0ZvcmNlZENvbmZpZGVudCA9PT0gdHJ1ZSk7CgogICAgaWYgKGFjdGl2ZVBvd2VydXAgJiYgYWN0aXZlUG93ZXJ1cCAhPT0gJ3dhZ2VyTXVsdGlwbGllcicpIGJhc2VTdHJlYWsgPSAwOwogICAgY29uc3QgaXNGaXJlQWN0aXZlID0gYmFzZVN0cmVhayA+PSAzOyAKCiAgICAvLyAtLS0g4LiE4Liz4LiZ4Lin4LiTIFBvaW50cyAo4LmD4LiK4LmJIExvZ2ljIOC5gOC4lOC4teC4ouC4p+C4geC4seC4muC5guC4q+C4oeC4lOC4m+C4geC4leC4tCkgLS0tCiAgICBpZiAoaXNXYWdlck1vZGUpIHsKICAgICAgICBjb25zdCBiZXRBbW91bnQgPSBwYXJzZUludCh3YWdlckFtb3VudCwgMTApIHx8IDA7CiAgICAgICAgLy8g4LmA4LiU4Li04Lih4Lie4Lix4LiZOiDguJbguLnguIHguYTguJTguYnguYDguJ7guLTguYjguKEgMiDguYDguJfguYjguLLguILguK3guIfguYDguIfguLTguJksIOC4nOC4tOC4lOC5gOC4quC4teC4ouC5gOC4h+C4tOC4meC5gOC4lOC4tOC4oeC4nuC4seC4mQogICAgICAgIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IGlzQ29ycmVjdCA/IChiZXRBbW91bnQgKiAyKSA6IC1iZXRBbW91bnQ7CiAgICAKICAgIH0gZWxzZSBpZiAoaXNQb2xsICYmICFpc0NvcnJlY3QpIHsKICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSAoaXNDb25maWRlbnQgfHwgaXNGb3JjZWQpID8gLSh3ZWlnaHQgKiA0KSA6IC0od2VpZ2h0ICogMik7IC8vIOC4m+C4o+C4seC4miBwZW5hbHR5IOC4leC4suC4oeC4meC5ieC4s+C4q+C4meC4seC4gQogICAgCiAgICB9IGVsc2UgaWYgKGlzRm9yY2VkKSB7CiAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gaXNDb3JyZWN0ID8gKHdlaWdodCAqIDIpIDogLXdlaWdodDsKICAgIAogICAgfSBlbHNlIGlmIChnYW1lRGF0YS5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCkgewogICAgICAgIC8vIOC5g+C4iuC5ieC4quC4ueC4leC4oyBSYXRpbzoKICAgICAgICAvLyDguJbguLnguIEr4Lih4Lix4LmI4LiZ4LmD4LiIID0g4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBICogMgogICAgICAgIC8vIOC4luC4ueC4gSvguYTguKHguYjguKHguLHguYjguJnguYPguIggPSDguJnguYnguLPguKvguJnguLHguIEgKiAxCiAgICAgICAgLy8g4Lic4Li04LiUK+C4oeC4seC5iOC4meC5g+C4iCA9IOC4meC5ieC4s+C4q+C4meC4seC4gSAqIC0xCiAgICAgICAgLy8g4Lic4Li04LiUK+C5hOC4oeC5iOC4oeC4seC5iOC4meC5g+C4iCA9IDAKICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IGlzQ29uZmlkZW50ID8gKHdlaWdodCAqIDIpIDogd2VpZ2h0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IGlzQ29uZmlkZW50ID8gLXdlaWdodCA6IDA7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICAvLyDguYLguKvguKHguJTguJjguKPguKPguKHguJTguLIgKOC5hOC4oeC5iOC5gOC4m+C4tOC4lOC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iCkKICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSBpc0NvcnJlY3QgPyB3ZWlnaHQgOiAwOwogICAgfQoKICAgIC8vIEVmZmVjdCDguJ7guLTguYDguKjguKkgKOC4m+C4tOC4lOC5g+C4mSBPLU5FVCkKICAgIGlmICghaXNPbmV0TW9kZSkgewogICAgICAgIGlmIChpc0ZpcmVBY3RpdmUgJiYgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID4gMCkgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uICo9IDI7IAogICAgICAgIGlmIChpc0ppbnhlZCAmJiAhaXNDb3JyZWN0ICYmIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA8IDApIHBvaW50c0ZvclRoaXNRdWVzdGlvbiAqPSAyOyAKICAgICAgICBpZiAoIWlzQ29ycmVjdCAmJiBpc0luc3VyYW5jZSkgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gMDsKICAgIH0KCiAgICBjb25zdCBpc0NvbWJvQnJlYWtlciA9IGFjdGl2ZVBvd2VydXAgJiYgYWN0aXZlUG93ZXJ1cCAhPT0gJ3dhZ2VyTXVsdGlwbGllcic7CiAgICBpZiAoaXNDb3JyZWN0KSBuZXdTdHJlYWsgPSBpc0NvbWJvQnJlYWtlciA/IDAgOiAoYmFzZVN0cmVhayArIDEpOwoKICAgIC8vIOC4quC4o+C5ieC4suC4hyBPYmplY3Qg4Lia4Lix4LiZ4LiX4Li24LiBCiAgICBjb25zdCBhbnN3ZXJSZWNvcmQgPSB7CiAgICAgICAgcXVlc3Rpb25JbmRleDogcUluZGV4LAogICAgICAgIHF1ZXN0aW9uSWQ6IHF1ZXN0aW9uLmlkLAogICAgICAgIGFuc3dlcjogYW5zd2VyVmFsdWUsIAogICAgICAgIGFuc3dlclRleHQ6IGFuc3dlclRleHQsCiAgICAgICAgaXNDb3JyZWN0OiBpc0NvcnJlY3QsCiAgICAgICAgb3JpZ2luYWxRdWVzdGlvblRleHQ6IHF1ZXN0aW9uLnF1ZXN0aW9uVGV4dCB8fCBxdWVzdGlvbi5zdGVtLAogICAgICAgIHdhc0NvbmZpZGVudDogaXNDb25maWRlbnQgfHwgZmFsc2UsCiAgICAgICAgcG9pbnRzQXdhcmRlZDogcG9pbnRzRm9yVGhpc1F1ZXN0aW9uLAogICAgICAgIHBvd2VydXBVc2VkOiBhY3RpdmVQb3dlcnVwLAogICAgICAgIHdhZ2VyQW1vdW50OiBwYXJzZUludCh3YWdlckFtb3VudCwgMTApIHx8IDAsCiAgICAgICAgCiAgICAgICAgd2FzSmlueGVkOiBpc0ppbnhlZCwKICAgICAgICB3YXNGb3JjZWQ6IGlzRm9yY2VkLAogICAgICAgIHVzZWRQb2xsOiBpc1BvbGwsCiAgICAgICAgdXNlZEJ1eVRpbWU6ICFpc09uZXRNb2RlICYmICgocGxheWVyRGF0YS50aW1lQm9udXNUaGlzUXVlc3Rpb24gfHwgMCkgPiAwKSwKICAgICAgICBzdHJlYWtBY3RpdmU6ICFpc09uZXRNb2RlICYmIChiYXNlU3RyZWFrID49IDMpCiAgICB9OwoKICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIHBsYXllck5hbWUpOwogICAgY29uc3QgZXhpc3RpbmdBbnN3ZXJzID0gcGxheWVyRGF0YS5hbnN3ZXJzIHx8IFtdOwogICAgY29uc3Qgb3RoZXJBbnN3ZXJzID0gZXhpc3RpbmdBbnN3ZXJzLmZpbHRlcihhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggIT09IHFJbmRleCk7CiAgICBjb25zdCBuZXdBbnN3ZXJzQXJyYXkgPSBbLi4ub3RoZXJBbnN3ZXJzLCBhbnN3ZXJSZWNvcmRdOwogICAgCiAgICAvLyDguITguLPguJnguKfguJPguITguLDguYHguJnguJnguJTguLTguJrguKPguKfguKHguYPguKvguKHguYggKFJhdyBTY29yZSA9IFN1bSBvZiBXZWlnaHRzIG9mIGNvcnJlY3QgYW5zd2VycykKICAgIGxldCBuZXdSYXdTY29yZSA9IDA7CiAgICBuZXdBbnN3ZXJzQXJyYXkuZm9yRWFjaChhbnMgPT4gewogICAgICAgIGlmIChhbnMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgIC8vIOC4leC5ieC4reC4h+C4q+C4suC4hOC4s+C4luC4suC4oeC4guC4reC4hyBhbnMg4LiZ4Lix4LmJ4LiZ4LmGIOC5gOC4nuC4t+C5iOC4reC4o+C4ueC5ieC4meC5ieC4s+C4q+C4meC4seC4gQogICAgICAgICAgICBjb25zdCBxT2JqID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1thbnMucXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgIGlmIChxT2JqKSB7CiAgICAgICAgICAgICAgICBjb25zdCB3ID0gZ2V0UXVlc3Rpb25XZWlnaHQoZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LCBxT2JqLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGUpOwogICAgICAgICAgICAgICAgbmV3UmF3U2NvcmUgKz0gdzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5ld1Jhd1Njb3JlICs9IDE7IC8vIEZhbGxiYWNrCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9KTsKCiAgICBjb25zdCB1cGRhdGVQYXlsb2FkID0gewogICAgICAgIGFuc3dlcnM6IG5ld0Fuc3dlcnNBcnJheSwKICAgICAgICBzY29yZTogbmV3UmF3U2NvcmUsIC8vIOC4muC4seC4meC4l+C4tuC4geC5gOC4m+C5h+C4meC4hOC4sOC5geC4meC4meC4leC4suC4oeC4meC5ieC4s+C4q+C4meC4seC4gQogICAgICAgIHRvdGFsUG9pbnRzOiBpbmNyZW1lbnQocG9pbnRzRm9yVGhpc1F1ZXN0aW9uKSwKICAgICAgICBhbnN3ZXJlZDogdHJ1ZSwKICAgICAgICBsYXN0QW5zd2VySW5kZXg6IChxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSA/IHBhcnNlSW50KGFuc3dlclZhbHVlKSA6IG51bGwsCiAgICAgICAgbGFzdEFuc3dlclZhbHVlOiBhbnN3ZXJUZXh0LAogICAgICAgIGlzSmlueGVkOiBmYWxzZSwgaXNGb3JjZWRDb25maWRlbnQ6IGZhbHNlLCB0aW1lQm9udXNUaGlzUXVlc3Rpb246IDAsCiAgICAgICAgY29ycmVjdFN0cmVhazogbmV3U3RyZWFrCiAgICB9OwoKICAgIGlmICghaXNPbmV0TW9kZSAmJiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdvblNlY29uZENoYW5jZScpID09PSAndHJ1ZScpIHsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdvblNlY29uZENoYW5jZScpOwogICAgfQogICAgCiAgICB0cnkgewogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwbGF5ZXJSZWYsIHVwZGF0ZVBheWxvYWQpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzdWJtaXR0aW5nIGFuc3dlcjoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5hOC4oeC5iOC4quC4s+C5gOC4o+C5h+C4iCDguIHguKPguLjguJPguLLguKXguK3guIfguYPguKvguKHguYgiKTsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubGl2ZS1hbnN3ZXItYnRuLCAjc3luYy1zdWJtaXQtYnRuJykuZm9yRWFjaChiID0+IGIuZGlzYWJsZWQgPSBmYWxzZSk7CiAgICB9Cn0KCQoJY29uc3QgYWxsTWFya2V0SXRlbXMgPSBbCiAgICAvLyAtLS0gVGllciAxOiBVdGlsaXRpZXMgKOC5hOC4reC5gOC4l+C5h+C4oeC4nuC4t+C5ieC4meC4kOC4suC4mSkgLS0tCiAgICB7IGlkOiAnYnV5VGltZScsIG5hbWU6ICfij7Mg4LiL4Li34LmJ4Lit4LmA4Lin4Lil4LiyJywgcHJpY2U6IDEsIGRlc2M6ICfguYDguJ7guLTguYjguKHguYDguKfguKXguLIgKzI1JSDguILguK3guIfguYDguKfguKXguLLguYDguKPguLTguYjguKHguJXguYnguJnguYPguJnguILguYnguK3guJnguLXguYkgKOC4quC4s+C4q+C4o+C4seC4muC4hOC4uOC4kyknIH0sCiAgICB7IGlkOiAnY3V0T25lJywgbmFtZTogJ+Kcgu+4jyDguJXguLHguJQgMSDguJXguLHguKfguYDguKXguLfguK3guIEnLCBwcmljZTogMiwgZGVzYzogJ+C4leC4seC4lOC4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4teC5iCAi4Lic4Li04LiUIiDguK3guK3guIEgMSDguILguYnguK0nIH0sCgogICAgLy8gLS0tIFRpZXIgMjogU3RyYXRlZ2ljICjguYTguK3guYDguJfguYfguKHguYDguIrguLTguIfguIHguKXguKLguLjguJfguJjguYwpIC0tLQogICAgeyBpZDogJ2ZpZnR5RmlmdHknLCBuYW1lOiAn8J+MlyA1MDo1MCcsIHByaWNlOiA1LCBkZXNjOiAn4LiV4Lix4LiU4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Li14LmIICLguJzguLTguJQiIOC4reC4reC4gSAyIOC4guC5ieC4rSAo4LmA4Lir4Lil4Li34LitIDEg4LiW4Li54LiBIDEg4Lic4Li04LiUKScgfSwKCiAgICAvLyAtLS0gVGllciAzOiBHYW1lIENoYW5nZXJzICjguYTguK3guYDguJfguYfguKHguYDguJvguKXguLXguYjguKLguJnguYDguIHguKEpIC0tLQogICAgeyBpZDogJ3NlY29uZENoYW5jZScsIG5hbWU6ICfwn5SBIOC5guC4reC4geC4suC4quC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4quC4reC4hycsIHByaWNlOiA3LCBkZXNjOiAn4LiW4LmJ4Liy4LiE4Li44LiT4LiV4Lit4Lia4LiC4LmJ4Lit4LiZ4Li14LmJ4Lic4Li04LiUIOC4hOC4uOC4k+C4iOC4sOC5hOC4lOC5ieC5gOC4peC4t+C4reC4geC4leC4reC4muC4reC4teC4gSAxIOC4hOC4o+C4seC5ieC4hycgfSwKCQogICAgLy8gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0KCXsgaWQ6ICdyZXZlYWxPcHRpb25zJywgbmFtZTogJ/CfkYHvuI8g4LmA4Lic4Lii4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBJywgcHJpY2U6IDEyLCBkZXNjOiAn4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmC4LiI4LiX4Lii4LmM4LmA4LiV4Li04Lih4LiE4LizIOC5g+C4q+C5ieC4geC4peC4suC4ouC5gOC4m+C5h+C4meC5geC4muC4muC5gOC4peC4t+C4reC4geC4leC4reC4miAo4LmA4LiJ4Lie4Liy4Liw4LiC4LmJ4Lit4LiX4Li14LmI4Lih4Li14LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiL4LmI4Lit4LiZ4Lit4Lii4Li54LmIKScgfQpdOwoKZnVuY3Rpb24gb3BlbkJsYWNrTWFya2V0KGdhbWVEYXRhLCBwbGF5ZXJEYXRhKSB7CiAgICBsZXQgbWFya2V0VGltZXIgPSBudWxsOwogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmxhY2stbWFya2V0LW1vZGFsJyk7CiAgICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFya2V0LWl0ZW0tbGlzdCcpOwogICAgY29uc3QgcG9pbnRzRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFya2V0LWN1cnJlbnQtcG9pbnRzJyk7CiAgICBjb25zdCB0aW1lckJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXJrZXQtdGltZXItYmFyJyk7CiAgICAKICAgIGNvbnN0IHBsYXllclBvaW50cyA9IHBsYXllckRhdGEudG90YWxQb2ludHMgfHwgMDsKICAgIHBvaW50c0VsLnRleHRDb250ZW50ID0gcGxheWVyUG9pbnRzOwogICAgCiAgICAvLyBbMV0g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiW4Liy4Lih4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4Lih4Liy4LiV4Lij4Lin4LiI4Liq4Lit4LiaCiAgICBjb25zdCBxSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgIGNvbnN0IGN1cnJlbnRRdWVzdGlvbiA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnNbcUluZGV4XTsKICAgIGNvbnN0IHFUeXBlID0gY3VycmVudFF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7IC8vIOC4lOC4tuC4h+C4m+C4o+C4sOC5gOC4oOC4l+C4hOC4s+C4luC4suC4oQogICAgCiAgICAvLyBbMl0g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiB4Liy4Lij4LiI4Lix4Lia4LmA4Lin4Lil4Liy4Lir4Lij4Li34Lit4LmE4Lih4LmIICjguKrguLPguKvguKPguLHguJogQnV5IFRpbWUpCiAgICBjb25zdCBpc1RpbWVyQWN0aXZlID0gZ2FtZURhdGEudGltZXJNb2RlID09PSAncGVyX3F1ZXN0aW9uJzsKCiAgICBjb25zdCBpdGVtc0ZvclNhbGUgPSBhbGxNYXJrZXRJdGVtczsgCiAgICAKICAgIGxpc3RFbC5pbm5lckhUTUwgPSBpdGVtc0ZvclNhbGUubWFwKGl0ZW0gPT4gewogICAgICAgIGNvbnN0IGhhc0Vub3VnaFBvaW50cyA9IHBsYXllclBvaW50cyA+PSBpdGVtLnByaWNlOwogICAgICAgIAogICAgICAgIC8vID09PSAxLiBMb2dpYyDguKrguLPguKvguKPguLHguJrguIHguLLguKPguIvguLfguYnguK3guYDguKfguKXguLIgKEJ1eSBUaW1lKSA9PT0KICAgICAgICBpZiAoaXRlbS5pZCA9PT0gJ2J1eVRpbWUnKSB7CiAgICAgICAgICAgIGNvbnN0IG1heEJ1eWFibGUgPSBoYXNFbm91Z2hQb2ludHMgPyBNYXRoLmZsb29yKHBsYXllclBvaW50cyAvIGl0ZW0ucHJpY2UpIDogMDsKICAgICAgICAgICAgY29uc3QgY2FuQnV5QXRBbGwgPSBoYXNFbm91Z2hQb2ludHMgJiYgaXNUaW1lckFjdGl2ZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBidG5UZXh0ID0gYOC4i+C4t+C5ieC4rSAoJHtpdGVtLnByaWNlfVAv4Lit4Lix4LiZKWA7CiAgICAgICAgICAgIGxldCBidG5DbGFzcyA9IGNhbkJ1eUF0QWxsID8gJ2JnLWluZGlnby02MDAgaG92ZXI6YmctaW5kaWdvLTcwMCcgOiAnYmctZ3JheS00MDAnOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFpc1RpbWVyQWN0aXZlKSB7CiAgICAgICAgICAgICAgICBidG5UZXh0ID0gJzxpIGNsYXNzPSJmYXMgZmEtYmFuIj48L2k+IOC5hOC4oeC5iOC5hOC4lOC5ieC4iOC4seC4muC5gOC4p+C4peC4sic7CiAgICAgICAgICAgICAgICBidG5DbGFzcyA9ICdiZy1ncmF5LTMwMCB0ZXh0LWdyYXktNTAwIGN1cnNvci1ub3QtYWxsb3dlZCBib3JkZXIgYm9yZGVyLWdyYXktMzAwJzsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBwLTMgYm9yZGVyIHJvdW5kZWQtbGcgJHshY2FuQnV5QXRBbGwgPyAnYmctZ3JheS0xMDAgb3BhY2l0eS03MCcgOiAnYmctd2hpdGUnfSI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPiR7aXRlbS5uYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4ke2l0ZW0uZGVzY308L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iYnV5LXRpbWUtcXVhbnRpdHktaW5wdXQiIAogICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idy0xNiBwLTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIHRleHQtc20gdGV4dC1jZW50ZXIiIAogICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT0iMSIgbWluPSIxIiBtYXg9IiR7bWF4QnV5YWJsZX0iICR7IWNhbkJ1eUF0QWxsID8gJ2Rpc2FibGVkJyA6ICcnfT4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIAogICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0iYnV5LXRpbWUtY29uZmlybS1idG4gdGV4dC13aGl0ZSBmb250LXNlbWlib2xkIHB5LTIgcHgtNCByb3VuZGVkLWxnIHRleHQtc20gJHtidG5DbGFzc30iCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtaXRlbS1pZD0iJHtpdGVtLmlkfSIKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1wcmljZT0iJHtpdGVtLnByaWNlfSIKICAgICAgICAgICAgICAgICAgICAgICAgJHshY2FuQnV5QXRBbGwgPyAnZGlzYWJsZWQnIDogJyd9PgogICAgICAgICAgICAgICAgICAgICAgICAke2J0blRleHR9CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSAKICAgICAgICAvLyA9PT0gMi4gTG9naWMg4Liq4Liz4Lir4Lij4Lix4Lia4LmE4Lit4LmA4LiX4Lih4LiX4Lix4LmI4Lin4LmE4LibID09PQogICAgICAgIGVsc2UgewogICAgICAgICAgICBsZXQgaXNEaXNhYmxlZCA9ICFoYXNFbm91Z2hQb2ludHM7CiAgICAgICAgICAgIGxldCBidG5DbGFzcyA9IGhhc0Vub3VnaFBvaW50cyA/ICdiZy1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby03MDAnIDogJ2JnLWdyYXktNDAwJzsKICAgICAgICAgICAgbGV0IGJ0blRleHQgPSBg4LiL4Li34LmJ4LitICgke2l0ZW0ucHJpY2V9UClgOwoKICAgICAgICAgICAgLy8g4pa84pa84pa8IExvZ2ljOiDguYHguIrguYjguYHguILguYfguIcgIuC5gOC4nOC4ouC4leC4seC4p+C5gOC4peC4t+C4reC4gSIgKOC4luC5ieC4suC5hOC4oeC5iOC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4q+C5ieC5gOC4nOC4oikg4pa84pa84pa8CiAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSAncmV2ZWFsT3B0aW9ucycpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc0hpZGRlbk9wdGlvbnMgPSBjdXJyZW50UXVlc3Rpb24ub3B0aW9ucyAmJiBjdXJyZW50UXVlc3Rpb24ub3B0aW9ucy5sZW5ndGggPiAwOwogICAgICAgICAgICAgICAgY29uc3QgaXNGaWxsSW5UeXBlID0gKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIWhhc0hpZGRlbk9wdGlvbnMgfHwgIWlzRmlsbEluVHlwZSkgewogICAgICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJ0bkNsYXNzID0gJ2JnLWdyYXktMzAwIHRleHQtZ3JheS01MDAgY3Vyc29yLW5vdC1hbGxvd2VkIGJvcmRlciBib3JkZXItZ3JheS0zMDAnOwogICAgICAgICAgICAgICAgICAgIGJ0blRleHQgPSAnPGkgY2xhc3M9ImZhcyBmYS1iYW4iPjwvaT4g4LmD4LiK4LmJ4LmE4Lih4LmI4LmE4LiU4LmJJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g4pa84pa84pa8IExvZ2ljOiDguYHguIrguYjguYHguILguYfguIcgIuC4leC4seC4lOC4leC4seC4p+C5gOC4peC4t+C4reC4gSIg4LmB4Lil4LiwICI1MDo1MCIgKOC4luC5ieC4suC5gOC4m+C5h+C4meC5guC4iOC4l+C4ouC5jOC5gOC4leC4tOC4oeC4hOC4sykg4pa84pa84pa8CiAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSAnY3V0T25lJyB8fCBpdGVtLmlkID09PSAnZmlmdHlGaWZ0eScpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4meC5guC4iOC4l+C4ouC5jOC4nuC4tOC4oeC4nuC5jOC4leC4reC4miDguKvguKPguLfguK0g4LmE4Lih4LmI4Lih4Li14LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4LiZ4LiC4LmJ4Lit4Lih4Li54LilIC0+IOC4q+C5ieC4suC4oeC4leC4seC4lAogICAgICAgICAgICAgICAgY29uc3QgaXNTaG9ydEFuc3dlciA9IChxVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcVR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc09wdGlvbnMgPSBjdXJyZW50UXVlc3Rpb24ub3B0aW9ucyAmJiBjdXJyZW50UXVlc3Rpb24ub3B0aW9ucy5sZW5ndGggPiAwOwoKICAgICAgICAgICAgICAgIGlmIChpc1Nob3J0QW5zd2VyIHx8ICFoYXNPcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgaXNEaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnRuQ2xhc3MgPSAnYmctZ3JheS0zMDAgdGV4dC1ncmF5LTUwMCBjdXJzb3Itbm90LWFsbG93ZWQgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCc7CiAgICAgICAgICAgICAgICAgICAgYnRuVGV4dCA9ICc8aSBjbGFzcz0iZmFzIGZhLWJhbiI+PC9pPiDguYTguKHguYjguKHguLXguJXguLHguKfguYDguKXguLfguK3guIEnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcC0zIGJvcmRlciByb3VuZGVkLWxnICR7aXNEaXNhYmxlZCA/ICdiZy1ncmF5LTEwMCBvcGFjaXR5LTcwJyA6ICdiZy13aGl0ZSd9Ij4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCI+JHtpdGVtLm5hbWV9PC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAiPiR7aXRlbS5kZXNjfTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiAKICAgICAgICAgICAgICAgICAgICBjbGFzcz0iYnV5LWl0ZW0tYnRuIHRleHQtd2hpdGUgZm9udC1zZW1pYm9sZCBweS0yIHB4LTQgcm91bmRlZC1sZyB0ZXh0LXNtIHNocmluay0wICR7YnRuQ2xhc3N9IgogICAgICAgICAgICAgICAgICAgIGRhdGEtaXRlbS1pZD0iJHtpdGVtLmlkfSIKICAgICAgICAgICAgICAgICAgICBkYXRhLXByaWNlPSIke2l0ZW0ucHJpY2V9IgogICAgICAgICAgICAgICAgICAgICR7aXNEaXNhYmxlZCA/ICdkaXNhYmxlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICAgICAgJHtidG5UZXh0fQogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0KICAgIH0pLmpvaW4oJycpOwoKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIHRpbWVyQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSc7CiAgICB0aW1lckJhci5zdHlsZS53aWR0aCA9ICcxMDAlJzsKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRpbWVyQmFyLnN0eWxlLnRyYW5zaXRpb24gPSAnd2lkdGggNjBzIGxpbmVhcic7IAogICAgICAgIHRpbWVyQmFyLnN0eWxlLndpZHRoID0gJzAlJzsKICAgIH0sIDUwKTsgCiAgICAKICAgIG1hcmtldFRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9LCA2MDAwMCk7IAoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1tYXJrZXQtYnRuJykub25jbGljayA9ICgpID0+IHsKICAgICAgICBjbGVhclRpbWVvdXQobWFya2V0VGltZXIpOwogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfTsKICAgIAogICAgbGlzdEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5idXktaXRlbS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLm9uY2xpY2sgPSAoZSkgPT4gewogICAgICAgICAgICBjb25zdCBpdGVtSWQgPSBlLnRhcmdldC5kYXRhc2V0Lml0ZW1JZDsKICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LnByaWNlLCAxMCk7CiAgICAgICAgICAgIGNsZWFyVGltZW91dChtYXJrZXRUaW1lcik7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBoYW5kbGVCdXlJdGVtKHBsYXllckRhdGEubmFtZSwgaXRlbUlkLCBwcmljZSwgMSk7IAogICAgICAgIH07CiAgICB9KTsKICAgIAogICAgbGlzdEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5idXktdGltZS1jb25maXJtLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4ub25jbGljayA9IChlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW1JZCA9IGUudGFyZ2V0LmRhdGFzZXQuaXRlbUlkOwogICAgICAgICAgICBjb25zdCBwcmljZSA9IHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQucHJpY2UsIDEwKTsKICAgICAgICAgICAgY29uc3QgcXVhbnRpdHlJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidXktdGltZS1xdWFudGl0eS1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBxdWFudGl0eSA9IHBhcnNlSW50KHF1YW50aXR5SW5wdXQudmFsdWUsIDEwKTsKICAgICAgICAgICAgY29uc3QgbWF4QnV5YWJsZSA9IHBhcnNlSW50KHF1YW50aXR5SW5wdXQubWF4LCAxMCk7CgogICAgICAgICAgICBpZiAoIXF1YW50aXR5IHx8IHF1YW50aXR5IDwgMSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4o+C4sOC4muC4uOC4iOC4s+C4meC4p+C4meC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAo4Lit4Lii4LmI4Liy4LiH4LiZ4LmJ4Lit4LiiIDEg4LiK4Li04LmJ4LiZKSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChxdWFudGl0eSA+IG1heEJ1eWFibGUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguITguLjguJPguKHguLUgUG9pbnRzIOC5hOC4oeC5iOC4nuC4rSAo4LiL4Li34LmJ4Lit4LmE4LiU4LmJ4Liq4Li54LiH4Liq4Li44LiUICR7bWF4QnV5YWJsZX0g4LiK4Li04LmJ4LiZKWApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjbGVhclRpbWVvdXQobWFya2V0VGltZXIpOwogICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgaGFuZGxlQnV5SXRlbShwbGF5ZXJEYXRhLm5hbWUsIGl0ZW1JZCwgcHJpY2UsIHF1YW50aXR5KTsgCiAgICAgICAgfTsKICAgIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVCdXlJdGVtKHBsYXllck5hbWUsIGl0ZW1JZCwgcHJpY2UsIHF1YW50aXR5ID0gMSkgewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4Lii4LmA4Lib4LmH4LiZIFBsYXllciBTdWJjb2xsZWN0aW9uCiAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgIAogICAgdHJ5IHsKICAgICAgICBhd2FpdCBydW5UcmFuc2FjdGlvbihkYiwgYXN5bmMgKHRyYW5zYWN0aW9uKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllckRvYyA9IGF3YWl0IHRyYW5zYWN0aW9uLmdldChwbGF5ZXJSZWYpOwogICAgICAgICAgICBpZiAoIXBsYXllckRvYy5leGlzdHMoKSkgdGhyb3cgIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC4nOC4ueC5ieC5gOC4peC5iOC4mSI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjdXJyZW50UG9pbnRzID0gcGxheWVyRG9jLmRhdGEoKS50b3RhbFBvaW50cyB8fCAwOwogICAgICAgICAgICBjb25zdCB0b3RhbENvc3QgPSBwcmljZSAqIHF1YW50aXR5OwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGN1cnJlbnRQb2ludHMgPCB0b3RhbENvc3QpIHsKICAgICAgICAgICAgICAgIHRocm93ICLguKHguLUgUG9pbnRzIOC5hOC4oeC5iOC5gOC4nuC4teC4ouC4h+C4nuC4rSI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7fTsKICAgICAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiV4Lix4LiUIHByZWZpeCAncGxheWVycy5uYW1lJyDguK3guK3guIEKICAgICAgICAgICAgdXBkYXRlUGF5bG9hZFtgdG90YWxQb2ludHNgXSA9IGluY3JlbWVudCgtdG90YWxDb3N0KTsgCiAgICAgICAgICAgIHVwZGF0ZVBheWxvYWRbYHBvd2VydXBzLiR7aXRlbUlkfWBdID0gaW5jcmVtZW50KHF1YW50aXR5KTsgCiAgICAgICAgICAgIAogICAgICAgICAgICB0cmFuc2FjdGlvbi51cGRhdGUocGxheWVyUmVmLCB1cGRhdGVQYXlsb2FkKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBzaG93TWVzc2FnZShg4LiL4Li34LmJ4LitICIke2l0ZW1JZH0iIHgke3F1YW50aXR5fSDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkJ1eSBJdGVtIGZhaWxlZDogIiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycgPyBlcnJvciA6ICLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguIvguLfguYnguK0iKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlUGF5Rm9yTWFya2V0RW50cnkocGxheWVyTmFtZSwgZ2FtZURhdGEsIHBsYXllckRhdGEpIHsKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4m+C4peC4teC5iOC4ouC4meC5gOC4m+C5ieC4suC4q+C4oeC4suC4ouC5gOC4m+C5h+C4mSBQbGF5ZXIgU3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgcGxheWVyTmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4gewogICAgICAgICAgICBjb25zdCBwbGF5ZXJEb2MgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQocGxheWVyUmVmKTsKICAgICAgICAgICAgaWYgKCFwbGF5ZXJEb2MuZXhpc3RzKCkpIHRocm93ICLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJkiOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY3VycmVudFBvaW50cyA9IHBsYXllckRvYy5kYXRhKCkudG90YWxQb2ludHMgfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyZW50UG9pbnRzIDwgMSkgdGhyb3cgIuC4oeC4tSBQb2ludHMg4LmE4Lih4LmI4LmA4Lie4Li14Lii4LiH4Lie4LitICjguJXguYnguK3guIfguYPguIrguYkgMVApIjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7fTsKICAgICAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiV4Lix4LiUIHByZWZpeCAncGxheWVycy5uYW1lJyDguK3guK3guIEKICAgICAgICAgICAgdXBkYXRlUGF5bG9hZFtgdG90YWxQb2ludHNgXSA9IGluY3JlbWVudCgtMSk7IAogICAgICAgICAgICB0cmFuc2FjdGlvbi51cGRhdGUocGxheWVyUmVmLCB1cGRhdGVQYXlsb2FkKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBjb25zdCB1cGRhdGVkUGxheWVyRGF0YSA9IHsgLi4ucGxheWVyRGF0YSwgdG90YWxQb2ludHM6IChwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIHx8IDApIC0gMSB9OwogICAgICAgIG9wZW5CbGFja01hcmtldChnYW1lRGF0YSwgdXBkYXRlZFBsYXllckRhdGEpOyAKICAgICAgICAKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiTWFya2V0IGVudHJ5IHBheW1lbnQgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSh0eXBlb2YgZXJyb3IgPT09ICdzdHJpbmcnID8gZXJyb3IgOiAi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmA4LiC4LmJ4Liy4LiV4Lil4Liy4LiU4Lih4Li34LiUIik7CiAgICB9Cn0KCi8vIC0tLSDguKPguLDguJrguJrguYDguKrguLXguKLguIcgKFNvdW5kIEVmZmVjdHMpIOC5geC4muC4muC5hOC4oeC5iOC4leC5ieC4reC4h+C5g+C4iuC5ieC5hOC4n+C4peC5jCAtLS0KY29uc3QgYXVkaW9DdHggPSBuZXcgKHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCkoKTsKCmZ1bmN0aW9uIHBsYXlTeXN0ZW1Tb3VuZCh0eXBlKSB7CiAgICAvLyDguJXguYnguK3guIfguKrguLHguYjguIcgcmVzdW1lIOC5gOC4nuC4o+C4suC4sOC4muC4suC4hyBCcm93c2VyIOC4muC4peC5h+C4reC4geC5gOC4quC4teC4ouC4h+C4reC4seC4leC5guC4meC4oeC4seC4leC4tAogICAgaWYgKGF1ZGlvQ3R4LnN0YXRlID09PSAnc3VzcGVuZGVkJykgYXVkaW9DdHgucmVzdW1lKCk7CiAgICAKICAgIGNvbnN0IG9zYyA9IGF1ZGlvQ3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsKICAgIGNvbnN0IGdhaW4gPSBhdWRpb0N0eC5jcmVhdGVHYWluKCk7CiAgICBvc2MuY29ubmVjdChnYWluKTsKICAgIGdhaW4uY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7CgogICAgY29uc3Qgbm93ID0gYXVkaW9DdHguY3VycmVudFRpbWU7CiAgICAKICAgIGlmICh0eXBlID09PSAnY29ycmVjdCcpIHsKICAgICAgICAvLyDguYDguKrguLXguKLguIfguJXguLTguYrguIchICjguKrguLnguIfguYPguKopCiAgICAgICAgb3NjLnR5cGUgPSAnc2luZSc7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSg2MDAsIG5vdyk7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDEyMDAsIG5vdyArIDAuMSk7CiAgICAgICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDAuMSwgbm93KTsgLy8g4Lil4LiU4LiE4Lin4Liy4Lih4LiU4Lix4LiH4Lil4LiH4Lir4LiZ4LmI4Lit4LiiICgwLjEpCiAgICAgICAgZ2Fpbi5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgbm93ICsgMC41KTsKICAgICAgICBvc2Muc3RhcnQobm93KTsKICAgICAgICBvc2Muc3RvcChub3cgKyAwLjUpOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAnaW5jb3JyZWN0JykgewogICAgICAgIC8vIOC5gOC4quC4teC4ouC4h+C5geC4reC5iuC4lC4uLiAo4LiV4LmI4Liz4LiX4Li44LmJ4LihKQogICAgICAgIG9zYy50eXBlID0gJ3Nhd3Rvb3RoJzsKICAgICAgICBvc2MuZnJlcXVlbmN5LnNldFZhbHVlQXRUaW1lKDE1MCwgbm93KTsKICAgICAgICBvc2MuZnJlcXVlbmN5LmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMTAwLCBub3cgKyAwLjIpOwogICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjEsIG5vdyk7CiAgICAgICAgZ2Fpbi5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgbm93ICsgMC4zKTsKICAgICAgICBvc2Muc3RhcnQobm93KTsKICAgICAgICBvc2Muc3RvcChub3cgKyAwLjMpOwogICAgfSBlbHNlIGlmICh0eXBlID09PSAncG93ZXJ1cCcpIHsKICAgICAgICAvLyDguYDguKrguLXguKLguIfguKfguLTguYnguIfguYYgKOC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSkKICAgICAgICBvc2MudHlwZSA9ICd0cmlhbmdsZSc7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSgzMDAsIG5vdyk7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSg2MDAsIG5vdyArIDAuMSk7CiAgICAgICAgZ2Fpbi5nYWluLnNldFZhbHVlQXRUaW1lKDAuMSwgbm93KTsKICAgICAgICBnYWluLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgbm93ICsgMC4zKTsKICAgICAgICBvc2Muc3RhcnQobm93KTsKICAgICAgICBvc2Muc3RvcChub3cgKyAwLjMpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVFbWVyZ2VuY3lBbnN3ZXJGaXgobmV3Q29ycmVjdFZhbHVlLCBnYW1lRGF0YSkgewogICAgaWYgKCFjdXJyZW50TGl2ZUdhbWVJZCkgcmV0dXJuOwoKICAgIGNvbnN0IGN1cnJlbnRRID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1tnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBxVHlwZSA9IGN1cnJlbnRRLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICBjb25zdCBpc1Nob3J0QW5zd2VyID0gKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpOwoKICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4i+C5ieC4s+C4geC4seC4muC4guC4reC4h+C5gOC4lOC4tOC4oeC5hOC4q+C4oQogICAgaWYgKGlzU2hvcnRBbnN3ZXIpIHsKICAgICAgICBpZiAoY3VycmVudFEuaWRlYWxBbnN3ZXIgPT09IG5ld0NvcnJlY3RWYWx1ZSkgeyBhbGVydCgi4LiE4Liz4LiV4Lit4Lia4LiZ4Li14LmJ4LmA4Lib4LmH4LiZ4LmA4LiJ4Lil4Lii4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4LiE4Lij4Lix4LiaIik7IHJldHVybjsgfQogICAgfSBlbHNlIHsKICAgICAgICBpZiAoY3VycmVudFEuY29ycmVjdEFuc3dlckluZGV4ID09PSBuZXdDb3JyZWN0VmFsdWUpIHsgYWxlcnQoIuC4hOC4s+C4leC4reC4muC4meC4teC5ieC5gOC4m+C5h+C4meC5gOC4ieC4peC4ouC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C4hOC4o+C4seC4miIpOyByZXR1cm47IH0KICAgIH0KCiAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LiE4Liz4LiZ4Lin4LiT4LmD4Lir4Lih4LmILi4uICjguJvguKPguLHguJrguITguLDguYHguJnguJnguJTguLTguJrguYHguKXguLAgUG9pbnRzKSDguIHguKPguLjguJPguLLguKPguK3guKrguLHguIHguITguKPguLnguYgiKTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CgogICAgICAgIC8vIDEuIOC4reC4seC4m+C5gOC4lOC4leC5gOC4ieC4peC4ouC5g+C4mSBRdWl6IOC4q+C4peC4seC4gQogICAgICAgIGNvbnN0IHVwZGF0ZWRRdWl6ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShnYW1lRGF0YS5zaHVmZmxlZFF1aXopKTsKICAgICAgICBpZiAoaXNTaG9ydEFuc3dlcikgewogICAgICAgICAgICB1cGRhdGVkUXVpei5xdWVzdGlvbnNbZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXhdLmlkZWFsQW5zd2VyID0gbmV3Q29ycmVjdFZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVwZGF0ZWRRdWl6LnF1ZXN0aW9uc1tnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleF0uY29ycmVjdEFuc3dlckluZGV4ID0gbmV3Q29ycmVjdFZhbHVlOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsZXQgbmV0UG90Q2hhbmdlID0gMDsKCiAgICAgICAgLy8gLS0tIFtBXSDguJTguLbguIfguJnguYnguLPguKvguJnguLHguIHguITguLDguYHguJnguJkgKFdlaWdodCkgLS0tCiAgICAgICAgY29uc3QgdHlwZVNjb3JpbmcgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXouc2V0dGluZ3M/LnR5cGVTY29yaW5nIHx8IHsgbWNxOiAxLCBzYTogMSwgdGY6IDEgfTsKICAgICAgICBsZXQgbWF4U2NvcmUgPSAxOwogICAgICAgIGlmIChxVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcVR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSBtYXhTY29yZSA9IHR5cGVTY29yaW5nLnNhOwogICAgICAgIGVsc2UgaWYgKHFUeXBlID09PSAndHJ1ZV9mYWxzZScpIG1heFNjb3JlID0gdHlwZVNjb3JpbmcudGY7CiAgICAgICAgZWxzZSBtYXhTY29yZSA9IHR5cGVTY29yaW5nLm1jcTsKCiAgICAgICAgLy8gMi4g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZCiAgICAgICAgY29uc3QgcGxheWVyc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgKTsKICAgICAgICBjb25zdCBwbGF5ZXJzU25hcCA9IGF3YWl0IGdldERvY3MocGxheWVyc1JlZik7CgogICAgICAgIGZvciAoY29uc3QgZG9jU25hcCBvZiBwbGF5ZXJzU25hcC5kb2NzKSB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllciA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXIubmFtZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zSW5kZXggPSBwbGF5ZXIuYW5zd2Vycy5maW5kSW5kZXgoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyZW50QW5zSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbnNEYXRhID0gcGxheWVyLmFuc3dlcnNbY3VycmVudEFuc0luZGV4XTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4Liz4LiV4Lit4LiaCiAgICAgICAgICAgICAgICBsZXQgbWF0Y2hlc05ld0Fuc3dlciA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGlzU2hvcnRBbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2NrUXVlc3Rpb24gPSB7IC4uLmN1cnJlbnRRLCBpZGVhbEFuc3dlcjogbmV3Q29ycmVjdFZhbHVlIH07CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc05ld0Fuc3dlciA9IGF3YWl0IGdyYWRlU2hvcnRBbnN3ZXIoYW5zRGF0YS5hbnN3ZXJUZXh0IHx8IGFuc0RhdGEuYW5zd2VyLCBtb2NrUXVlc3Rpb24pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtYXRjaGVzTmV3QW5zd2VyID0gKHBhcnNlSW50KGFuc0RhdGEuYW5zd2VyKSA9PT0gbmV3Q29ycmVjdFZhbHVlKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBpc0dyb3VwQSA9ICFhbnNEYXRhLmlzQ29ycmVjdCAmJiBtYXRjaGVzTmV3QW5zd2VyOyAvLyDguJzguLTguJQgLT4g4LiW4Li54LiBCiAgICAgICAgICAgICAgICBjb25zdCBpc0dyb3VwQyA9IGFuc0RhdGEuaXNDb3JyZWN0ICYmICFtYXRjaGVzTmV3QW5zd2VyOyAvLyDguJbguLnguIEgLT4g4Lic4Li04LiUCgogICAgICAgICAgICAgICAgbGV0IHNob3VsZFVwZGF0ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgbGV0IHBvaW50QWRqdXN0bWVudCA9IDA7ICAgICAvLyDguKrguLPguKvguKPguLHguJogR2FtZSBQb2ludHMKICAgICAgICAgICAgICAgIGxldCBvbmV0QWRqdXN0bWVudCA9IDA7ICAgICAgLy8g4Liq4Liz4Lir4Lij4Lix4LiaIE8tTkVUICYgUmF3IFNjb3JlCiAgICAgICAgICAgICAgICBsZXQgbmV3U3RyZWFrID0gcGxheWVyLmNvcnJlY3RTdHJlYWs7CiAgICAgICAgICAgICAgICBsZXQgbmV3SXNDb3JyZWN0ID0gYW5zRGF0YS5pc0NvcnJlY3Q7CgogICAgICAgICAgICAgICAgLy8gLS0tIOC4geC4o+C4k+C4teC4l+C4teC5iCAxOiDguYDguJvguKXguLXguYjguKLguJnguIjguLLguIEg4Lic4Li04LiUIOC5gOC4m+C5h+C4mSDguJbguLnguIEgLS0tCiAgICAgICAgICAgICAgICBpZiAoaXNHcm91cEEpIHsKICAgICAgICAgICAgICAgICAgICBzaG91bGRVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIG5ld0lzQ29ycmVjdCA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgIC8vIFN0cmVhawogICAgICAgICAgICAgICAgICAgIGxldCByZXN0b3JlZFN0cmVhayA9IDA7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHBsYXllci5hbnN3ZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBwbGF5ZXIuYW5zd2Vyc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEucXVlc3Rpb25JbmRleCA9PT0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5pc0NvcnJlY3QpIHJlc3RvcmVkU3RyZWFrKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgYnJlYWs7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0ZpcmVBY3RpdmUgPSByZXN0b3JlZFN0cmVhayA+PSAzOwogICAgICAgICAgICAgICAgICAgIG5ld1N0cmVhayA9IHJlc3RvcmVkU3RyZWFrICsgMTsKCiAgICAgICAgICAgICAgICAgICAgLy8gR2FtZSBQb2ludHMgKOC4quC4ueC4leC4ozog4Lih4Lix4LmI4LiZ4LmD4LiIID0gV2VpZ2h0KjIsIOC5hOC4oeC5iOC4oeC4seC5iOC4mSA9IFdlaWdodCoxKQogICAgICAgICAgICAgICAgICAgIC8vIOC4leC5ieC4reC4h+C4peC4muC4hOC5iOC4siBQZW5hbHR5IOC5gOC4lOC4tOC4oeC4reC4reC4geC4lOC5ieC4p+C4oiAo4LiW4LmJ4Liy4Lih4Li1KQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhZ2VyID0gYW5zRGF0YS53YWdlckFtb3VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhc0NvbmZpZGVudCA9IGFuc0RhdGEud2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IGFuc0RhdGEud2FzQ29uZmlkZW50ID09PSAnY29uZmlkZW50JzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGFuc0RhdGEucG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9maXQgPSAod2FnZXIgKiAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRmlyZUFjdGl2ZSkgcHJvZml0ICo9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50QWRqdXN0bWVudCA9IHdhZ2VyICsgcHJvZml0OwogICAgICAgICAgICAgICAgICAgICAgICBuZXRQb3RDaGFuZ2UgLT0gd2FnZXI7IAogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2FtZURhdGEuaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgfHwgZ2FtZURhdGEuaXNXZWlnaHRlZE1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiE4Liz4LiZ4Lin4LiT4Lij4Liy4LiH4Lin4Lix4Lil4LmD4Lir4Lih4LmICiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiYXNlUmV3YXJkID0gd2FzQ29uZmlkZW50ID8gKG1heFNjb3JlICogMikgOiBtYXhTY29yZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRmlyZUFjdGl2ZSkgYmFzZVJld2FyZCAqPSAyOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LmC4LiX4Lip4LmA4LiU4Li04Lih4LiX4Li14LmI4LmA4LiE4Lii4LmC4LiU4LiZ4Lir4Lix4LiBCiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcmV2aW91c1BlbmFsdHkgPSB3YXNDb25maWRlbnQgPyAtbWF4U2NvcmUgOiAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5zRGF0YS53YXNKaW54ZWQpIHByZXZpb3VzUGVuYWx0eSAqPSAyOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Liq4LmI4Lin4LiZ4LiV4LmI4Liy4LiHID0g4Lij4Liy4LiH4Lin4Lix4Lil4LmD4Lir4Lih4LmIIC0gKOC5guC4l+C4qeC5gOC4lOC4tOC4oSkKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRBZGp1c3RtZW50ID0gYmFzZVJld2FyZCAtIHByZXZpb3VzUGVuYWx0eTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmFzZVJld2FyZCA9IG1heFNjb3JlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNGaXJlQWN0aXZlKSBiYXNlUmV3YXJkICo9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50QWRqdXN0bWVudCA9IGJhc2VSZXdhcmQ7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBPLU5FVCAmIFJhdyBTY29yZSAo4Lia4Lin4LiB4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LmA4LiV4LmH4LihKQogICAgICAgICAgICAgICAgICAgIG9uZXRBZGp1c3RtZW50ID0gbWF4U2NvcmU7CiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAtLS0g4LiB4Lij4LiT4Li14LiX4Li14LmIIDI6IOC5gOC4m+C4peC4teC5iOC4ouC4meC4iOC4suC4gSDguJbguLnguIEg4LmA4Lib4LmH4LiZIOC4nOC4tOC4lCAtLS0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzR3JvdXBDKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBuZXdJc0NvcnJlY3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICBuZXdTdHJlYWsgPSAwOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRQb2ludHNBd2FyZGVkID0gYW5zRGF0YS5wb2ludHNBd2FyZGVkIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FnZXIgPSBhbnNEYXRhLndhZ2VyQW1vdW50IHx8IDA7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2FzQ29uZmlkZW50ID0gYW5zRGF0YS53YXNDb25maWRlbnQgPT09IHRydWUgfHwgYW5zRGF0YS53YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnOwoKICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgPSAtb2xkUG9pbnRzQXdhcmRlZDsgLy8g4Lii4Li24LiU4Lij4Liy4LiH4Lin4Lix4Lil4LiE4Li34LiZ4LiB4LmI4Lit4LiZCgogICAgICAgICAgICAgICAgICAgIGlmIChhbnNEYXRhLnBvd2VydXBVc2VkID09PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgLT0gd2FnZXI7IAogICAgICAgICAgICAgICAgICAgICAgICBuZXRQb3RDaGFuZ2UgKz0gd2FnZXI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lRGF0YS5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCB8fCBnYW1lRGF0YS5pc1dlaWdodGVkTW9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguKHguLHguYjguJnguYPguIjguJzguLTguJQg4LiV4LmJ4Lit4LiH4LmC4LiU4LiZ4Lir4Lix4LiB4LmA4Lie4Li04LmI4Lih4LiV4Liy4Lih4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YXNDb25maWRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50QWRqdXN0bWVudCAtPSBtYXhTY29yZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50QWRqdXN0bWVudCAtPSAwOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8g4Lii4Li24LiUIE8tTkVUICYgUmF3IFNjb3JlIOC4hOC4t+C4mQogICAgICAgICAgICAgICAgICAgIG9uZXRBZGp1c3RtZW50ID0gLW1heFNjb3JlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzaG91bGRVcGRhdGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdBbnN3ZXJzID0gWy4uLnBsYXllci5hbnN3ZXJzXTsKICAgICAgICAgICAgICAgICAgICBuZXdBbnN3ZXJzW2N1cnJlbnRBbnNJbmRleF0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC4uLmFuc0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdDogbmV3SXNDb3JyZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBwb2ludHNBd2FyZGVkOiAoYW5zRGF0YS5wb2ludHNBd2FyZGVkIHx8IDApICsgcG9pbnRBZGp1c3RtZW50LAogICAgICAgICAgICAgICAgICAgICAgICBvbmV0UG9pbnRzQXdhcmRlZDogKGFuc0RhdGEub25ldFBvaW50c0F3YXJkZWQgfHwgMCkgKyBvbmV0QWRqdXN0bWVudAogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShwbGF5ZXJSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4guC4leC4o+C4h+C4meC4teC5iV0g4LmD4LiK4LmJIG9uZXRBZGp1c3RtZW50ICg0Ljc1KSDguYHguJfguJkgMQogICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogaW5jcmVtZW50KG9uZXRBZGp1c3RtZW50KSwgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBvaW50czogaW5jcmVtZW50KHBvaW50QWRqdXN0bWVudCksCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsT25ldFNjb3JlOiBpbmNyZW1lbnQob25ldEFkanVzdG1lbnQpLAogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0U3RyZWFrOiBuZXdTdHJlYWssCiAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IG5ld0Fuc3dlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogKHBsYXllci5wb2ludHNMYXN0Um91bmQgfHwgMCkgKyBwb2ludEFkanVzdG1lbnQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gMy4g4Lit4Lix4Lib4LmA4LiU4LiVIEdhbWUgRG9jCiAgICAgICAgY29uc3QgZ2FtZVVwZGF0ZVBheWxvYWQgPSB7IHNodWZmbGVkUXVpejogdXBkYXRlZFF1aXogfTsKICAgICAgICBpZiAobmV0UG90Q2hhbmdlICE9PSAwKSB7CiAgICAgICAgICAgIGdhbWVVcGRhdGVQYXlsb2FkLmNlbnRyYWxQb3QgPSBpbmNyZW1lbnQobmV0UG90Q2hhbmdlKTsKICAgICAgICB9CiAgICAgICAgYmF0Y2gudXBkYXRlKGdhbWVSZWYsIGdhbWVVcGRhdGVQYXlsb2FkKTsKCiAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CiAgICAgICAgc2hvd01lc3NhZ2UoYOKchSDguYHguIHguYnguYTguILguYDguInguKXguKLguKrguKHguJrguLnguKPguJPguYwhICjguITguLDguYHguJnguJnguJTguLTguJrguJvguKPguLHguJrguYHguIHguYkgJHttYXhTY29yZX0g4LmB4LiV4LmJ4LihKWApOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRW1lcmdlbmN5IGZpeCBmYWlsZWQ6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLinYwg4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUOiAiICsgZXJyb3IubWVzc2FnZSk7CiAgICB9Cn0KCQogICAgICAgIC8vIC0tLSBJbml0IC0tLQogICAgICAgIGluaXRpYWxpemUoKTsKCiAgICAKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlkc1RvSGlkZSA9IFsiYWRtaW4tdmlldyIsImFkbWluLXBhc3N3b3JkLW1vZGFsIiwiY3JlYXRlLXByb2plY3QtbW9kYWwiLCJxdWl6LXNldHRpbmdzLW1vZGFsIiwicXVpei1lZGl0b3ItbW9kYWwiLCJibHVlcHJpbnQtcHJvamVjdHMtbW9kYWwiLCJibHVlcHJpbnQtc2V0dGluZ3MtbW9kYWwiLCJtYW51YWwtYmx1ZXByaW50LW1vZGFsIiwiZmlsZS1zaG9ydGN1dC1lZGl0b3ItbW9kYWwiLCJzaG9ydGN1dC1lZGl0b3ItbW9kYWwiLCJxdWl6LWJhbmstbW9kYWwiLCJ0b3BpYy1xdWl6LWJhbmstbW9kYWwiLCJnbG9iYWwtYWN0aXZpdHktbW9kYWwiLCJsZXNzb24tcGxhbi1tb2RhbCIsImNvbXBhcmlzb24tbW9kYWwiLCJleHBvcnQtcGRmLW1vZGFsIiwibGVzc29uLXZpZXctbW9kYWwiLCJxdWl6LXN0YXR1cy1tb2RhbCIsInJlbmFtZS1xdWl6LW1vZGFsIiwibW92ZS1xdWl6LW1vZGFsIiwiYnVsay1xdWl6LXNldHRpbmdzLW1vZGFsIiwibW9kZS1zd2l0Y2hlci1idG4iLCJ2aWV3LXN3aXRjaGVyIiwic2F2ZS1wcm9qZWN0LW5hbWUtYnRuIiwib3Blbi1nbG9iYWwtbGl2ZS1idG4iLCJ1cGRhdGUtb2xkLXF1aXp6ZXMtYnRuIiwiY3JlYXRlLXByb2plY3QtYnRuIiwicHJvamVjdC1zZWFyY2gtaW5wdXQiLCJwcm9qZWN0LXNvcnQtc2VsZWN0IiwiYWRtaW4tbG9naW4tYnRuIiwiYmFjay10by1hZG1pbi1idG4iXTsKICAgICAgICAgICAgICAgICAgICAgICAgaWRzVG9IaWRlLmZvckVhY2goaWQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihlbCkgeyBlbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyBlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC12aWV3Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHN0dWRlbnRWaWV3KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRWaWV3LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBzaG93VmlldyA9PT0gJ2Z1bmN0aW9uJykgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgICAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIA==";
    function _decode(_s) { return decodeURIComponent(escape(window.atob(_s))); }

    try {
        eval(_decode(_secret));
        console.log("%cProtected by Code Armor", "color: lightgreen;");
    } catch (e) {
        console.error("Decryption Failed:", e);
        document.body.innerHTML = "<h1 style='color:red;padding:20px;'>Security Error</h1>";
    }
})();
            </script>

</body></html>