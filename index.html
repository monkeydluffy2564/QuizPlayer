<!DOCTYPE html>
<html lang="th"><head>
                <script>
                    console.log("%cSTOP!", "color: red; font-size: 60px; font-weight: bold; text-shadow: 2px 2px black;");
                    console.log("%cProtected Content.", "font-size: 18px; color: gray;");
                </script>
            
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Quiz Generator By Kru Amorn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&amp;display=swap" rel="stylesheet">
	
	<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <!-- Libraries for Exporting & Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Libraries for File Reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.18/mammoth.browser.min.js"></script>
	
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- MathJax for rendering math formulas -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
	
	/* ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå A.html ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô <style> */
.ai-content h1, .ai-content h2, .ai-content h3, .ai-content h4 { font-weight: 700; color: #1e3a8a; margin-top: 1.5rem; margin-bottom: 0.75rem; }
.ai-content h1 { font-size: 1.8rem; } .ai-content h2 { font-size: 1.5rem; } .ai-content h3 { font-size: 1.25rem; }
.ai-content p { margin-bottom: 1rem; line-height: 1.7; }
.ai-content ul, .ai-content ol { margin-left: 1.5rem; margin-bottom: 1rem; list-style-position: outside; }
.ai-content li { margin-bottom: 0.5rem; }
.ai-content blockquote { background-color: #eff6ff; border-left: 4px solid #3b82f6; padding: 0.75rem 1rem; margin: 1rem 0; border-radius: 0.25rem; color: #1e40af; }
.ai-content table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
.ai-content th, .ai-content td { border: 1px solid #e2e8f0; padding: 0.75rem 1rem; text-align: left; }
.ai-content th { background-color: #fefce8; font-weight: 600; }
.ai-content code { background-color: #f1f5f9; color: #475569; padding: 0.2em 0.4em; border-radius: 3px; }
.ai-content svg { max-width: 100%; height: auto; margin: 1rem auto; display: block; }
.section-header { display: flex; align-items: center; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #1e3a8a; border-bottom: 2px solid #dbeafe; padding-bottom: 0.5rem; }
.section-header i { margin-right: 0.75rem; color: #3b82f6; }
	
        body {
            font-family: 'Sarabun', sans-serif;
        }
		#message-modal { z-index: 60; } /* <-- ‡∏ß‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ */
		
		.correct {
    background-color: #dcfce7 !important;
    border-color: #22c55e !important;
    color: #166534;
    font-weight: bold;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in-up {
  animation: fadeInUp 0.3s ease-out;
}

.incorrect {
    background-color: #fee2e2 !important;
    border-color: #ef4444 !important;
    color: #991b1b;
}
		
        .main-tab.active {
            border-color: #4f46e5;
            color: #4f46e5;
            background-color: #eef2ff;
        }
        .generation-tab.active {
            border-color: #4f46e5;
            color: #4f46e5;
        }
		
		        .view-btn.active {
            background-color: white;
            color: #4f46e5; /* indigo-600 */
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
		
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4f46e5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Presentation Mode Styles */
        .presentation-option {
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        #presentation-modal:fullscreen {
            background-color: #1f2937; /* bg-gray-800 */
        }
        /* Timer Bar */
        #timer-bar-container {
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        #timer-bar {
            height: 100%;
            background-color: #4f46e5;
            transition: width 1s linear;
        }
		
		#sync-timer-bar {
        /* * ‡πÄ‡∏û‡∏¥‡πà‡∏° transition 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (500ms) 
         * ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡∏≠‡∏á onSnapshot (500ms)
         * ‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•
         */
        transition: width 0.5s linear;
    }
		
        [contenteditable="true"] {
            outline: 2px dashed #4f46e5;
            background-color: #eef2ff;
            padding: 2px;
        }
        .details-marker {
            transition: transform 0.2s;
        }
        details[open] .details-marker {
            transform: rotate(90deg);
        }
        .badge-icon {
            animation: popIn 0.5s ease-out forwards;
            transform: scale(0);
        }
        @keyframes popIn {
            0% { transform: scale(0); }
            80% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .delete-svg-btn {
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .delete-svg-btn:hover {
            opacity: 1;
        }
        /* Live Game Styles */
        .live-game-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .podium-step {
            transition: transform 0.5s ease-out;
        }
        .podium-step:hover {
            transform: translateY(-10px);
        }
		
		.live-summary-tooltip {
    /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    opacity: 0;
    pointer-events: none; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà */
    transition: opacity 0.2s ease-in-out;
}

.live-summary-tooltip.visible {
    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ */
    opacity: 1;
    pointer-events: auto;
}

.pen-color-btn {
    box-shadow: 0 0 0 2px white; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ */
}
.pen-color-btn.active {
    border-color: #3b82f6; /* border-blue-500 */
    box-shadow: 0 0 0 2px #3b82f6;
}

.tool-btn.active {
    background-color: #3b82f6; /* bg-blue-500 */
    color: white;
    border-color: #1d4ed8; /* border-blue-700 */
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-controls ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
#scratchpad-controls {
    display: flex;
    flex-wrap: wrap; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    align-items: center;
    gap: 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
    background-color: #f3f4f6; /* bg-gray-100 */
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid #e5e7eb; /* border-gray-200 */
    z-index: 30;
}

/* ‚ñº‚ñº‚ñº ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á ‚ñº‚ñº‚ñº */
.tool-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.separator {
    width: 1px;
    height: 1.5rem; /* 24px */
    background-color: #d1d5db; /* bg-gray-300 */
    margin: 0 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤ */
}
/* ‚ñ≤‚ñ≤‚ñ≤ ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° ‚ñ≤‚ñ≤‚ñ≤ */


/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î .scratchpad-content-wrapper ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
.scratchpad-content-wrapper {
    position: relative;
    overflow: hidden;
    flex-grow: 1; /* ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
}

.sortable-ghost {
    opacity: 0.4;
    background-color: #e0e7ff; /* ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÜ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏≤ */
    border: 2px dashed #6366f1;
}
.sortable-drag {
    cursor: grabbing;
    opacity: 1 !important;
    background-color: white;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    transform: scale(1.02); /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡∏ï‡∏≠‡∏ô‡∏ñ‡∏∑‡∏≠ */
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-canvas ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº */
#scratchpad-canvas {
    position: absolute;
    inset: 0;
    z-index: 10;
}

/* ‚ñº‚ñº‚ñº ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î #scratchpad-header ‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ (‡∏•‡∏ö padding-right ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÅ‡∏Å‡πâ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ) ‚ñº‚ñº‚ñº */
#scratchpad-header {
    position: relative;
    z-index: 20;
    pointer-events: none;
    
}
		
		/* --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô <style> --- */

#dim-overlay {
    position: fixed; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
    inset: 0; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (top:0, right:0, bottom:0, left:0) */
    background-color: rgba(0, 0, 0, 1); /* ‡∏™‡∏µ‡∏î‡∏≥‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á 100% */
    z-index: 9998; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
    display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
}

/* ‡πÄ‡∏°‡∏∑‡πà‡∏≠ body ‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™ .dimmed ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ overlay ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
body.dimmed #dim-overlay {
    display: flex;
}

.pen-size-btn.active {
    background-color: #3b82f6; /* bg-blue-500 */
    color: white;
    border-color: #1d4ed8; /* border-blue-700 */
}

.confidence-choice-btn {
    background-color: #f3f4f6; /* bg-gray-100 */
    color: #4b5563; /* text-gray-600 */
    border: 1px solid #d1d5db; /* border-gray-300 */
    transition: all 0.2s;
}
.confidence-choice-btn.active.confident {
    background-color: #10b981; /* bg-emerald-500 */
    color: white;
    border-color: #059669; /* border-emerald-700 */
}
.confidence-choice-btn.active.not-confident {
    background-color: #6b7280; /* bg-gray-500 */
    color: white;
    border-color: #4b5563; /* border-gray-600 */
}
		
    </style>
<style>
                /* Security Mask */
                #admin-view, #admin-password-modal, #create-project-modal, #quiz-settings-modal, #quiz-editor-modal, #blueprint-projects-modal, #blueprint-settings-modal, #manual-blueprint-modal, #file-shortcut-editor-modal, #shortcut-editor-modal, #quiz-bank-modal, #topic-quiz-bank-modal, #global-activity-modal, #lesson-plan-modal, #comparison-modal, #export-pdf-modal, #lesson-view-modal, #quiz-status-modal, #rename-quiz-modal, #move-quiz-modal, #bulk-quiz-settings-modal, #mode-switcher-btn, #view-switcher, #save-project-name-btn, #open-global-live-btn, #update-old-quizzes-btn, #create-project-btn, #project-search-input, #project-sort-select, #admin-login-btn, #back-to-admin-btn {
                    display: none !important;
                    visibility: hidden !important;
                    pointer-events: none !important;
                    opacity: 0 !important;
                    position: absolute !important;
                    z-index: -9999 !important;
                    width: 0 !important; height: 0 !important;
                    overflow: hidden !important;
                }
                .admin-only-btn, .teacher-control { display: none !important; }
                #student-view { display: block !important; }
            </style></head>

<body class="bg-gray-100 text-gray-800">

<div id="dim-overlay">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠</div>

    <div class="container mx-auto p-4 md:p-8 max-w-6xl relative">
        <!-- Admin Mode Toggle Button -->
        <button id="mode-switcher-btn" class="absolute top-4 right-4 text-gray-500 hover:text-indigo-600 transition-colors duration-300 z-10 p-3 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" title="‡∏™‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°">
            <i class="fas fa-user-shield fa-lg"></i>
        </button>

        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600">
                <i class="fas fa-brain mr-2"></i>AI Quiz Generator
            </h1>
            <p class="text-lg text-gray-600 mt-1">By Kru Amorn</p>
            <p class="text-gray-500 mt-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="bg-white p-6 rounded-2xl shadow-lg min-h-[400px]">
            <!-- Admin View -->
            <div id="admin-view" class="hidden fade-in">
                <!-- Project Dashboard (Default Admin View) -->
                <div id="project-dashboard-view">
                    <!-- NEW: Starred Quizzes Section -->
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                        <h2 class="text-2xl font-bold text-indigo-700">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                         <div class="flex items-center gap-2 w-full md:w-auto flex-wrap md:justify-end">
						 
						         <div id="view-switcher" class="flex items-center p-1 bg-gray-100 rounded-lg mr-2">
            <button id="grid-view-btn" class="px-3 py-1 rounded-md text-gray-700 view-btn" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á">
                <i class="fas fa-th-large pointer-events-none"></i>
            </button>
            <button id="list-view-btn" class="px-3 py-1 rounded-md text-gray-500 view-btn" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£">
                <i class="fas fa-list pointer-events-none"></i>
            </button>
        </div>
						 
                           <input type="text" id="project-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ..." class="w-full md:w-auto p-2 border border-gray-300 rounded-lg">
                           <select id="project-sort-select" class="p-2 border border-gray-300 rounded-lg">
                               <option value="date_desc">‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
                               <option value="date_asc">‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
                               <option value="name_asc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
                               <option value="name_desc">‡∏ä‡∏∑‡πà‡∏≠ (‡∏Æ-‡∏Å)</option>
                           </select>
                           <button id="reset-project-order-btn" class="text-sm text-gray-500 hover:underline" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏•‡∏≥‡∏î‡∏±‡∏ö</button>
                           <button id="create-project-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-300 flex items-center shrink-0">
                               <i class="fas fa-plus-circle mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á
                           </button>
						   <button id="open-global-live-btn" class="bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-bolt mr-2"></i>Live Game
</button>
<button id="open-quiz-bank-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-book mr-2"></i>‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
</button>

<button id="open-blueprint-projects-btn" class="bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-all duration-300 flex items-center shrink-0">
    <i class="fas fa-sitemap mr-2"></i>‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint
</button>

<button id="update-old-quizzes-btn" class="bg-yellow-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-yellow-700 transition-all duration-300 flex items-center shrink-0">
  <i class="fas fa-wrench mr-2"></i>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
</button>

                        </div>
                    </div>
                    <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                        <!-- Project cards will be inserted here -->
                        <p id="no-projects-msg" class="text-gray-500 col-span-full text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ... ‡∏Ñ‡∏•‡∏¥‡∏Å '‡∏™‡∏£‡πâ‡∏≤‡∏á' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</p>
                    </div>
                </div>

                <!-- Project Detail View -->
                <div id="project-detail-view" class="hidden">
                    <button id="back-to-dashboard-btn" class="mb-4 text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
                    <div class="flex items-center gap-3 mb-2">
    <h2 id="project-title" contenteditable="true" class="text-3xl font-bold text-indigo-700 outline-none focus:ring-2 focus:ring-indigo-300 focus:bg-indigo-50 rounded-md px-2 py-1 transition-all" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠">
    </h2>
    <button id="save-project-name-btn" class="hidden bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition-all text-sm">
        <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    </button>
</div>
                    <p class="text-sm text-gray-500 mb-6">Project ID: <span id="project-id-display" class="font-mono"></span></p>
                    
                    <!-- Project Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-6">
                            <button id="manage-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                                <i class="fas fa-sliders-h mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            </button>
                            <button id="results-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-poll mr-2"></i>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                            </button>
                            <button id="leaderboard-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-trophy mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥
                            </button>
                        </nav>
                    </div>

                    <!-- Manage Tab Content -->
                    <div id="manage-tab-content">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Left Column: Settings & Students -->
                            <div class="space-y-6">
                                <!-- Quiz Settings -->
                                <div>
                                    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)</h3>
<div class="space-y-4 p-4 bg-gray-50 rounded-lg">
    <div>
        <label for="quiz-type-select" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
        <select id="quiz-type-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <optgroup label="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">
                <option value="multiple_choice">‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö (‡∏Å, ‡∏Ç, ‡∏Ñ, ‡∏á)</option>
                <option value="matching">‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠)</option>
                <option value="true_false">‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î</option>
            </optgroup>
            <optgroup label="‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥">
                <option value="fill_in_with_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ)</option>
                <option value="fill_in_no_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)</option>
                <option value="mixed">‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥)</option>
            </optgroup>
        </select>
    </div>

    <div>
        <label for="difficulty-level-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</label>
        <select id="difficulty-level-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="auto" selected="">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠)</option>
            
            <optgroup label="üßí ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏ê‡∏°‡∏ß‡∏±‡∏¢">
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1 (K1)</option>
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 2 (K2)</option>
                <option value="‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3">‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 3 (K3)</option>
            </optgroup>

            <optgroup label="üìó ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (‡∏õ.1)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏õ.2)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3 (‡∏õ.3)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4 (‡∏õ.4)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5 (‡∏õ.5)</option>
                <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6 (‡∏õ.6)</option>
            </optgroup>
            
            <optgroup label="üìò ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1 (‡∏°.1)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 2 (‡∏°.2)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 3 (‡∏°.3)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 4 (‡∏°.4)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 5 (‡∏°.5)</option>
                <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6 (‡∏°.6)</option>
            </optgroup>

            <optgroup label="üéì ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏∏‡∏î‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡∏ï‡∏£‡∏µ</option>
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÇ‡∏ó</option>
                <option value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å">‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤‡πÄ‡∏≠‡∏Å</option>
            </optgroup>
        </select>
    </div>

    <div>
        <label for="question-complexity-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Bloom's Taxonomy):</label>
        <select id="question-complexity-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="mixed" selected="">‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏∞ (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</option>
            <option value="remembering">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≥ (Remembering)</option>
            <option value="understanding">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à (Understanding)</option>
            <option value="applying">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ (Applying)</option>
            <option value="analyzing">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (Analyzing)</option>
            <option value="evaluating">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤ (Evaluating)</option>
            <option value="creating">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå (Creating)</option>
        </select>
    </div>

    <div>
        <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠):</label>
        <details class="mt-1 border border-gray-300 rounded-lg bg-white">
            <summary class="p-2 cursor-pointer text-gray-500">
                ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠... <span id="selected-topics-count" class="font-bold text-indigo-600"></span>
            </summary>
            
            <div class="sticky top-0 bg-white p-2 border-b border-gray-200 flex justify-between items-center gap-4">
                <input type="text" id="math-topic-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠..." class="w-full p-2 border border-gray-300 rounded-lg text-sm">
                <div class="flex items-center gap-3 shrink-0">
                    <button id="select-all-topics-btn" class="text-xs font-semibold text-blue-600 hover:underline">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                    <button id="deselect-all-topics-btn" class="text-xs font-semibold text-gray-500 hover:underline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>
            <div id="math-topics-checkbox-container" class="p-3 max-h-60 overflow-y-auto">
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</p>
            </div>
        </details>
    </div>

    <div class="mt-3 p-3 bg-gray-100 rounded-lg">
        <label for="custom-math-topic-input" class="block text-sm font-medium text-gray-700 mb-1">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á:
        </label>
        <div class="flex items-center gap-2">
            <input type="text" id="custom-math-topic-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏ö‡∏ó‡πÄ‡∏®‡∏©‡πÄ‡∏´‡∏•‡∏∑‡∏≠..." class="w-full p-2 border border-gray-300 rounded-lg text-sm">
            <button id="add-custom-math-topic-btn" class="bg-blue-600 text-white py-2 px-3 rounded-lg font-semibold hover:bg-blue-700 text-sm shrink-0">
                <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
            </button>
        </div>
    </div>								

    <div class="grid grid-cols-2 gap-4">
        <div>
            <label for="num-questions" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠:</label>
            <input type="number" id="num-questions" value="5" min="1" max="20" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
        <div>
            <label for="passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
            <input type="number" id="passing-score-input" value="3" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
    </div>
    <div id="num-choices-container">
        <label for="num-choices" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <input type="number" id="num-choices" value="4" min="2" max="6" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
    </div>
    <div>
        <label for="shuffle-setting-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <select id="shuffle-setting-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
            <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
            <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
        </select>
    </div>
    <div>
        <label for="results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
            <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
            <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
            <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>
            <optgroup label="‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÉ‡∏´‡∏°‡πà)">
                <option value="half_mark_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á/‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á</option>
                <option value="perfect_score_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°/‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</option>
            </optgroup>
        </select>
    </div>
    <div class="flex items-center mt-2">
        <input id="adaptive-quiz-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="adaptive-quiz-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
        </label>
    </div>
    
    <div class="flex items-center mt-2">
        <input id="loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
        </label>
    </div>

    <div class="flex items-center mt-2">
        <input id="force-math-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="force-math-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå)
        </label>
    </div>
    <div class="flex items-center mt-2">
        <input id="include-images-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="include-images-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï, ‡∏Å‡∏£‡∏≤‡∏ü, ‡∏Ø‡∏•‡∏Ø)
        </label>
    </div>
    <div class="p-3 border-t border-gray-200 mt-2 space-y-2 bg-indigo-50 rounded-lg">
        <div class="flex items-center">
            <input id="confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
            </label>
        </div>
        <div id="confidence-mode-container" class="hidden pl-6">
            <label for="confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
            <select id="confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
            </select>
        </div>
    </div>
    <div class="border-t pt-4 mt-2">
        <label for="timer-mode-select" class="block text-sm font-medium text-gray-700">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤:</label>
        <select id="timer-mode-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</option>
            <option value="whole_quiz">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ)</option>
            <option value="per_question">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</option>
        </select>
        <div id="timer-duration-container" class="mt-2 hidden">
            <label for="timer-duration-input" id="timer-duration-label" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
            <input type="number" id="timer-duration-input" value="10" min="1" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
        </div>
    </div>
    <button id="save-settings-btn" class="w-full bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-colors text-sm">
        <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    </button>
</div>
                                </div>
								
								       <div id="project-visibility-settings">
    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</h3>
    <div class="p-4 bg-gray-50 rounded-lg">
        <div class="flex items-center">
            <input id="show-in-student-dashboard-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="show-in-student-dashboard-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
                ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" ‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            </label>
        </div>
        <p class="text-xs text-gray-500 mt-2">
            ‡∏´‡∏≤‡∏Å‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥)
        </p>

        <div class="mt-4 pt-4 border-t">
            <div class="flex items-center mb-2">
                <input id="enable-passcode-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                <label for="enable-passcode-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
                    ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ
                </label>
            </div>
            <div id="passcode-input-container" class="hidden">
                <label for="project-passcode-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (4-8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£):</label>
                <input type="text" id="project-passcode-input" class="w-full p-2 border border-gray-300 rounded-lg" maxlength="8">
            </div>
            <p class="text-xs text-red-500 mt-1">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
        </div>
        <button id="save-visibility-settings-btn" class="mt-4 w-full bg-teal-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-colors text-sm">
            <i class="fas fa-save mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        </button>
    </div>
</div>
								
                                <!-- Student Management -->
                                <div>
								
                                    <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                                    <div class="p-4 bg-gray-50 rounded-lg">
                                        <div class="flex flex-col gap-2 mb-3">
                                            <label for="student-name-input" class="text-sm font-medium text-gray-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡πà‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î):</label>
                                            <textarea id="student-name-input" rows="3" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ
‡∏™‡∏°‡∏®‡∏£‡∏µ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç"></textarea>
                                            <button id="add-student-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 self-end"><i class="fas fa-user-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
                                        </div>
                                        <div class="flex justify-between items-center mb-2">
                                            <h4 class="font-semibold text-sm">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</h4>
                                            <button id="delete-all-students-btn" class="text-red-600 hover:text-red-800 text-xs font-semibold py-1 px-2 rounded-md bg-red-100 hover:bg-red-200 transition-colors hidden"><i class="fas fa-trash-alt mr-1"></i>‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                        </div>
                                        <div id="student-list" class="max-h-40 overflow-y-auto space-y-1 text-sm p-2 bg-white border rounded-md">
                                            <!-- Student names will be here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column: Quiz Generation -->
                            <div>
                                <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h3>
                                <div id="quiz-generation-container" class="p-4 bg-gray-50 rounded-lg">
                                    <!-- Generation Tabs -->
                                    <div class="flex border-b mb-4 flex-wrap">
                                        <button id="topic-tab" class="generation-tab py-2 px-4 font-semibold active"><i class="fas fa-lightbulb mr-2"></i>‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
                                        <button id="text-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-file-alt mr-2"></i>‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</button>
                                        <button id="file-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-file-upload mr-2"></i>‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
                                        <button id="link-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-link mr-2"></i>‡∏à‡∏≤‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
										<button id="blueprint-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-map-marked-alt mr-2"></i>‡∏à‡∏≤‡∏Å Test Blueprint</button>
										<button id="parallel-test-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-clone mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡∏ô‡∏≤‡∏ô</button>
                                        <button id="worksheet-tab" class="generation-tab py-2 px-4 font-semibold text-gray-500"><i class="fas fa-print mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô</button>
                                    </div>

<div id="blueprint-input-area" class="hidden space-y-4">

    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î (Blueprint Shortcuts):</label>
    <div id="blueprint-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4">
        <p id="shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
        <label for="blueprint-upload-input" class="text-sm text-gray-600 font-semibold hover:underline cursor-pointer">
            <i class="fas fa-upload mr-1"></i>‡∏´‡∏£‡∏∑‡∏≠ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
        </label>
        <input type="file" id="blueprint-upload-input" class="hidden" accept=".pdf">
    </div>
    <div id="blueprint-options-container" class="hidden mt-4 pt-4 border-t border-gray-200 space-y-3">
        <button id="save-blueprint-as-project-btn" class="hidden w-full bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 mb-4 items-center justify-center">
            <i class="fas fa-save mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô Project
        </button>
        <div class="flex items-center p-3 bg-indigo-50 rounded-lg">
            <input id="separate-by-content-checkbox" type="checkbox" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="separate-by-content-checkbox" class="ml-3 block font-medium text-gray-800">
                ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏ß‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
            </label>
        </div>
        <div id="blueprint-topics-list-container" class="hidden p-3 border rounded-md bg-white">
            <p class="text-sm font-semibold mb-2 text-gray-700">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
            <div id="blueprint-topics-list" class="space-y-2">
                <p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠...</p>
            </div>
            <p class="text-xs text-gray-500 mt-3">*‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏≤‡∏Å Blueprint</p>
        </div>
    </div>

    <div class="mt-4 pt-4 border-t">
        <label for="reference-pdf-upload" class="block text-sm font-medium text-gray-700">
            (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°) ‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (.pdf, .txt):
        </label>
        <input type="file" id="reference-pdf-upload" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100" accept=".pdf,.txt">
        <p class="text-xs text-gray-500 mt-1">
            AI ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏°‡∏≤‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
        </p>
    </div>

    <button id="generate-from-blueprint-btn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏° Blueprint (‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î)
    </button>
</div>

<div id="parallel-test-input-area" class="hidden space-y-4">
<div class="mt-4 pt-4 border-t">
    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Source Shortcuts):</label>
    <div id="parallel-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2">
        <p id="parallel-shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-parallel-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>
</div>
    <label for="parallel-test-upload-input" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (.pdf, .txt):</label>
    <input type="file" id="parallel-test-upload-input" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" accept=".pdf,.txt">
    <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∏‡∏î</p>

    <button id="generate-from-parallel-test-btn" class="w-full bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡∏ô‡∏≤‡∏ô
    </button>
</div>
                                    <!-- Topic Input -->
                                    <div id="topic-input-area" class="space-y-4">
                                        <input type="text" id="topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡∏ö‡∏ó‡∏û‡∏µ‡∏ó‡∏≤‡πÇ‡∏Å‡∏£‡∏±‡∏™">
                                        <button id="generate-from-topic-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center"><i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                                    </div>
                                    <!-- Text Input -->
                                    <div id="text-input-area" class="hidden space-y-4">
    <div class="flex justify-end gap-2 flex-wrap">
        <input type="file" id="camera-input" class="hidden" accept="image/*" capture="environment">
        
        <button id="camera-crop-btn" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 text-sm flex items-center gap-2 transition-all shadow-sm">
            <i class="fas fa-camera"></i> ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û &amp; ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (Crop)
        </button>

        <input type="file" id="scan-text-image-input" class="hidden" accept="image/*">
        <button id="scan-text-image-btn" class="bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 text-sm flex items-center gap-2 transition-all shadow-sm">
            <i class="fas fa-file-image"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏•‡∏¢)
        </button>
    </div>

    <textarea id="text-content-input" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all" placeholder="‡∏ß‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô..."></textarea>
    
    <button id="generate-from-text-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center shadow-md transition-transform hover:scale-[1.01]">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    </button>
</div>
                                    <!-- File Input -->
                                    <div id="file-input-area" class="hidden space-y-4">
									<div class="mt-4 pt-4 border-t">
    <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå (File Shortcuts):</label>
    <div id="file-shortcut-container" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2">
        <p id="file-shortcuts-loading-msg" class="col-span-full text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
    <div class="flex justify-between items-center mt-2">
        <button id="add-file-shortcut-btn" class="text-sm text-blue-600 font-semibold hover:underline">
            <i class="fas fa-plus-circle mr-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡∏•‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
        </button>
    </div>
</div>
    <label for="file-upload-input" class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå PDF, Word (.docx), ‡∏´‡∏£‡∏∑‡∏≠ Text (.txt):</label>
    <input type="file" id="file-upload-input" class="w-full p-2 border border-gray-300 rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" accept=".pdf,.docx,.txt">
	
	<div id="pdf-page-selector" class="hidden mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
    <label class="block text-sm font-medium text-blue-800 mb-1">
        <i class="fas fa-print mr-1"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤ PDF ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏ = ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):
    </label>
    <input type="text" id="pdf-page-range" class="w-full p-2 border border-blue-300 rounded text-sm" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1, 3-5, 8 (‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤)">
    <p class="text-xs text-blue-600 mt-1">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</p>
</div>
	
	<div class="flex items-center my-3 p-3 bg-indigo-50 rounded-lg">
    <input id="separate-by-content-from-file-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
    <label for="separate-by-content-from-file-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏ß‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
        <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</p>
    </label>
</div>

<div id="file-topics-list-container" class="hidden p-3 mt-4 border rounded-md bg-white">
    <p class="text-sm font-semibold mb-2 text-gray-700">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
    <div id="file-topics-list" class="space-y-2">
        <p class="text-gray-400">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</p>
    </div>
</div>
	
	    <div class="flex items-center my-3 p-3 bg-indigo-50 rounded-lg">
        <input id="original-mode-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="original-mode-checkbox" class="ml-3 block text-sm font-medium text-gray-800">
            ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (Original Mode)
            <p class="text-xs text-gray-500">AI ‡∏à‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        </label>
    </div>
	
    <input type="text" id="file-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)...">
    <p class="text-xs text-gray-500">‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</p>

    <button id="generate-from-file-btn" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed" disabled="">
        <i class="fas fa-cogs mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
    </button>
</div>

<div id="file-shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="file-shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</h3>
        <div class="space-y-4">
            <div>
                <label for="file-shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="file-shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡∏•‡∏≤‡∏á‡∏†‡∏≤‡∏Ñ .pdf">
            </div>
            <div>
                <label for="file-shortcut-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå (.pdf, .txt ‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="file-shortcut-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="file-shortcut-id-input">
            <button id="cancel-file-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-file-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-file-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-file-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="file-shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-file-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>

    <div id="additional-file-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

<div id="parallel-shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="parallel-shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</h3>
        <div class="space-y-4">
            <div>
                <label for="parallel-shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="parallel-shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô O-NET ‡∏õ.6 ‡∏õ‡∏µ 65">
            </div>
            <div>
                <label for="parallel-shortcut-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö (.pdf, .txt ‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="parallel-shortcut-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="parallel-shortcut-id-input">
            <button id="cancel-parallel-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-parallel-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-parallel-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-parallel-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="parallel-shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-parallel-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>

    <div id="additional-parallel-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

                                    <!-- Link Input -->
                                    <div id="link-input-area" class="hidden space-y-4">
                                        <input type="url" id="link-url-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
                                        <input type="text" id="link-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥)...">
                                        <button id="generate-from-link-btn" class="w-full bg-cyan-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-cyan-700 flex items-center justify-center">
                                            <i class="fas fa-cogs mr-2"></i>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                                        </button>
                                    </div>
                                    <!-- Worksheet Input -->
                                    <div id="worksheet-input-area" class="hidden space-y-4">
                                        <input type="text" id="worksheet-topic-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å‡πÄ‡∏•‡∏Ç‡∏™‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å">
                                        <button id="generate-worksheet-btn" class="w-full bg-emerald-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-emerald-700 flex items-center justify-center"><i class="fas fa-file-alt mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå</button>
                                    </div>
                                </div>
                                <!-- Generation Result Area -->
                                <div id="quiz-generation-area" class="mt-6 hidden">
                                    <div id="loader" class="flex flex-col items-center justify-center hidden">
                                        <div class="loader"></div>
                                        <p id="loader-text" class="mt-3 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...</p>
                                    </div>
                                    <div id="generated-quiz-container"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Tab Content -->
                    <div id="results-tab-content" class="hidden">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏ô‡∏µ‡πâ</h3>
                             <input type="text" id="quiz-search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö..." class="w-full md:w-auto p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div id="project-quizzes-list" class="space-y-3">
                            <p class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</p>
                        </div>
                    </div>

                    <!-- Leaderboard Tab Content -->
                    <div id="leaderboard-tab-content" class="hidden">
                        <h3 class="text-xl font-semibold mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-200">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-2 px-4 border-b text-center w-16">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                        <th class="py-2 px-4 border-b text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° (Points)</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboard-table-body">
                                    <!-- Leaderboard rows will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Quiz Detail/Results View -->
                <div id="quiz-results-view" class="hidden">
<div class="flex items-center gap-4 mb-4">
        <button id="back-to-project-btn" class="text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</button>

        <!-- --- ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ --- -->
        <button id="back-to-dashboard-from-results-btn" class="text-gray-500 hover:underline text-sm"><i class="fas fa-th-large mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard</button>
    </div>

    <h2 id="results-quiz-title" class="text-3xl font-bold text-indigo-700 mb-2"></h2>
    <p class="text-sm text-gray-500 mb-4">Quiz ID: <span id="results-quiz-id-display" class="font-mono"></span></p>

                    

                       <!-- Quiz Detail Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-6">
                            <button id="analytics-tab-btn" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                                <i class="fas fa-chart-line mr-2"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•
                            </button>
                            <button id="scores-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-users mr-2"></i>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                            </button>
                            <!-- NEW: Quiz Leaderboard Tab Button -->
                            <button id="leaderboard-quiz-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                                <i class="fas fa-trophy mr-2"></i>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥
                            </button>
							
							        <button id="behavior-log-tab-btn" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
            <i class="fas fa-user-clock mr-2"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°
        </button>
							
                        </nav>
                    </div>

                    <!-- Analytics Tab -->
                    <div id="analytics-tab-content">
                        <!-- Summary Cards -->
                        <div id="analytics-summary-cards" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <!-- Cards will be injected here -->
                        </div>
                        <!-- Charts -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô</h4>
                                <canvas id="submission-status-chart"></canvas>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-2 text-center">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h4>
                                <canvas id="score-distribution-chart"></canvas>
                            </div>
                        </div>

                        <!-- NEW: AI Strength/Weakness Analysis Section -->
                        <div class="mt-8">
                            <h3 class="text-xl font-semibold mb-3 border-b pb-2">AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h3>
                            <div class="flex justify-center">
                                <button id="analyze-strengths-btn" class="bg-indigo-600 text-white py-2 px-5 rounded-lg font-semibold hover:bg-indigo-700 transition-all duration-300 flex items-center gap-2">
                                    <i class="fas fa-magic"></i>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡πÅ‡∏Ç‡πá‡∏á-‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á
                                </button>
                            </div>
                            <div id="strength-weakness-analysis-container" class="mt-4">
                                <!-- Analysis results will be displayed here -->
                            </div>
                        </div>

                        <!-- Per-Question Analysis -->
                        <div class="mt-8">
                             <h3 class="text-xl font-semibold mb-3 border-b pb-2">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠</h3>
                             <div id="question-analytics-container" class="space-y-4">
                                 <!-- Accordions will be injected here -->
                             </div>
                        </div>
                    </div>

                    <!-- Scores Tab -->
                    <div id="scores-tab-content" class="hidden">
                        <!-- Export Buttons -->
                        <div class="mb-4 flex flex-wrap gap-2">
                            <span class="self-center font-semibold mr-2">Export ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</span>
                            <button id="export-image-btn" class="bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700 text-sm flex items-center gap-2"><i class="fas fa-file-image"></i>Image</button>
                            <button id="export-pdf-btn" class="bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700 text-sm flex items-center gap-2"><i class="fas fa-file-pdf"></i>PDF</button>
                            <button id="export-word-btn" class="bg-blue-600 text-white py-1 px-3 rounded-md hover:bg-blue-700 text-sm flex items-center gap-2"><i class="fas fa-file-word"></i>Word</button>
                            <button id="export-excel-btn" class="bg-green-600 text-white py-1 px-3 rounded-md hover:bg-green-700 text-sm flex items-center gap-2"><i class="fas fa-file-excel"></i>Excel</button>
                        </div>
						
						                        <h3 class="text-xl font-semibold mb-2 mt-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
                        <p class="text-sm text-gray-500 mb-2">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                        <div id="answer-grid-container" class="overflow-x-auto mb-8 border border-gray-200 rounded-lg">
                            </div>
						
                        <div class="overflow-x-auto" id="results-table-container">
                            <table class="min-w-full bg-white border border-gray-200" id="results-table">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏ú‡∏•</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                        <th class="py-2 px-4 border-b text-left">Points</th>
                                        <th class="py-2 px-4 border-b text-left">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="py-2 px-4 border-b text-left">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                                    </tr>
                                </thead>
                                <tbody id="quiz-results-table-body">
                                    <!-- Results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- NEW: Quiz Leaderboard Tab Content -->
                    <div id="leaderboard-quiz-tab-content" class="hidden">
    <h3 class="text-xl font-semibold mb-4">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ)</h3>

    <div class="mb-4 flex flex-wrap gap-2">
        <span class="self-center font-semibold mr-2">Export ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</span>
        <button id="export-leaderboard-image-btn" class="bg-gray-600 text-white py-1 px-3 rounded-md hover:bg-gray-700 text-sm flex items-center gap-2"><i class="fas fa-file-image"></i>Image</button>
        <button id="export-leaderboard-pdf-btn" class="bg-red-600 text-white py-1 px-3 rounded-md hover:bg-red-700 text-sm flex items-center gap-2"><i class="fas fa-file-pdf"></i>PDF</button>
        <button id="export-leaderboard-word-btn" class="bg-blue-600 text-white py-1 px-3 rounded-md hover:bg-blue-700 text-sm flex items-center gap-2"><i class="fas fa-file-word"></i>Word</button>
        <button id="export-leaderboard-excel-btn" class="bg-green-600 text-white py-1 px-3 rounded-md hover:bg-green-700 text-sm flex items-center gap-2"><i class="fas fa-file-excel"></i>Excel</button>
    </div>
    <div class="overflow-x-auto" id="quiz-leaderboard-table-container">
        <table class="min-w-full bg-white border border-gray-200" id="quiz-leaderboard-table">
            <thead class="bg-gray-100">
                <tr>
                    <th class="py-2 px-4 border-b text-center w-16">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th>
                    <th class="py-2 px-4 border-b text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                    <th class="py-2 px-4 border-b text-center">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</th>
                    <th class="py-2 px-4 border-b text-center">‡∏ú‡∏•</th>
                    <th class="py-2 px-4 border-b text-center">Points (‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</th>
                    <th class="py-2 px-4 border-b text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏≥</th>
                    <th class="py-2 px-4 border-b text-left">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
                    <th class="py-2 px-4 border-b text-left">‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</th>
                </tr>
            </thead>
            <tbody id="quiz-leaderboard-table-body">
                </tbody>
        </table>
    </div>
</div>

<div id="behavior-log-tab-content" class="hidden">
    <h3 class="text-xl font-semibold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
    <div id="behavior-log-container" class="space-y-4">
        </div>
</div>

                </div>
				
<div id="blueprint-project-manager-view" class="hidden fade-in">
    <button id="back-to-dashboard-from-bp-btn" class="mb-4 text-indigo-600 hover:underline">
        <i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Dashboard
    </button>

    <div class="flex justify-between items-center mb-4">
        <h2 id="bp-project-title" class="text-3xl font-bold text-teal-700"></h2>
        <button id="bp-quiz-settings-btn" class="bg-orange-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-orange-600 flex items-center gap-2">
            <i class="fas fa-cog"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
        </button>
    </div>

<div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-r-lg">
    <label for="bp-reference-file-url" class="block text-sm font-medium text-yellow-800 mb-1">
        <i class="fas fa-link mr-1"></i> ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö O-NET ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô):
    </label>
    <div class="flex items-center gap-2">
        <input type="url" id="bp-reference-file-url" class="w-full p-2 border border-yellow-300 rounded-lg text-sm" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå .pdf ‡∏´‡∏£‡∏∑‡∏≠ .txt ‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
        <button id="save-bp-reference-btn" class="bg-yellow-600 text-white py-2 px-3 rounded-lg font-semibold hover:bg-yellow-700 text-sm shrink-0">
            <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </button>
    </div>
    <p class="text-xs text-yellow-700 mt-1">
        AI ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô "‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡∏≠‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå O-NET ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
    </p>
</div>

    <div class="bg-gray-50 p-4 rounded-lg">
        <h3 class="font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</h3>
        
        <div id="bp-topic-list-container" class="space-y-2">
            </div>
        
        <div class="mt-4 pt-4 border-t">
            <button id="bp-add-topic-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 text-sm">
                <i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>
</div>
				
            </div>

            <!-- Student View -->
            <div id="student-view" class="fade-in">
                <div id="student-initial-view">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-700 text-center">‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h2>
                    <div id="student-entry-area" class="space-y-4 max-w-md mx-auto">
                        <div>
                            <label for="quiz-id-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
                            <input type="text" id="quiz-id-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°">
                        </div>
                        <button id="load-quiz-btn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center">
                            <i class="fas fa-search mr-2"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                        </button>
                        <div class="relative flex py-3 items-center">
                            <div class="flex-grow border-t border-gray-300"></div>
                            <span class="flex-shrink mx-4 text-gray-500">‡∏´‡∏£‡∏∑‡∏≠</span>
                            <div class="flex-grow border-t border-gray-300"></div>
                        </div>
						
						<button id="view-my-progress-btn" class="w-full bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 flex items-center justify-center">
    <i class="fas fa-chart-line mr-2"></i>‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
</button>
						
                        <button id="join-live-game-btn" class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-purple-700 flex items-center justify-center">
                            <i class="fas fa-flag-checkered mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°‡∏™‡∏î
                        </button>
						<button id="join-group-activity-btn" class="w-full bg-cyan-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-cyan-700 flex items-center justify-center">
    <i class="fas fa-broadcast-tower mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Live)
</button>
                    </div>
                </div>

                <!-- NEW: Student Join Live Game View -->
                <div id="student-join-game-view" class="hidden max-w-md mx-auto">
                     <h2 class="text-2xl font-bold mb-4 text-indigo-700 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°‡∏™‡∏î</h2>
                     <div class="space-y-4">
                         <div>
                             <label for="game-pin-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (Game PIN):</label>
                             <input type="number" id="game-pin-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (2 ‡∏´‡∏•‡∏±‡∏Å)" maxlength="2">
                         </div>
                         <div>
                             <label for="nickname-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô:</label>
                             <input type="text" id="nickname-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                         </div>
                         <button id="confirm-join-game-btn" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
                             <i class="fas fa-sign-in-alt mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                         </button>
                         <button id="back-to-student-initial-btn" class="w-full mt-2 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">
                             ‡∏Å‡∏•‡∏±‡∏ö
                         </button>
                     </div>
                </div>
                
                <div id="student-name-selection-view" class="hidden max-w-md mx-auto">
                    <h2 id="student-quiz-topic" class="text-2xl font-bold mb-4 text-indigo-700 text-center"></h2>
                    <label for="student-name-select" class="block text-sm font-medium text-gray-700 mb-1">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
                    <select id="student-name-select" class="w-full p-3 border border-gray-300 rounded-lg"></select>
                    <button id="start-quiz-btn" class="w-full mt-4 bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
                        <i class="fas fa-play-circle mr-2"></i>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                    </button>
                </div>
				
				<div id="student-team-selection-view" class="hidden max-w-md mx-auto">
    <h2 id="team-quiz-topic" class="text-2xl font-bold mb-4 text-cyan-700 text-center"></h2>
    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ:</label>
    <div id="team-student-list" class="space-y-2 p-3 border rounded-lg max-h-60 overflow-y-auto bg-gray-50">
        </div>
    <div class="flex gap-2 mt-4">
        <button id="cancel-team-selection-btn" class="w-1/3 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300">
            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
        <button id="confirm-team-players-btn" class="w-2/3 bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700">
            <i class="fas fa-play-circle mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°
        </button>
    </div>
</div>
				
				<div id="student-progress-view" class="hidden max-w-4xl mx-auto">
    <button id="back-to-student-home-btn" class="mb-4 text-indigo-600 hover:underline"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button>
    <h2 class="text-2xl font-bold mb-4 text-teal-700 text-center">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>

    <div class="flex flex-col md:flex-row gap-4 mb-6 p-4 bg-gray-100 rounded-lg">
        <div class="flex-1">
            <label for="progress-project-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <select id="progress-project-select" class="w-full p-2 border border-gray-300 rounded-lg"></select>
        </div>
        <div class="flex-1">
            <label for="progress-student-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
            <select id="progress-student-select" class="w-full p-2 border border-gray-300 rounded-lg" disabled=""></select>
        </div>
    </div>

    <div id="student-progress-content">
        <p class="text-center text-gray-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
    </div>
</div>
				
                <div id="student-quiz-area" class="mt-6 hidden"></div>
                <div id="student-result-area" class="mt-6 hidden"></div>
                <div id="student-reading-area" class="mt-6 hidden"></div>
            </div>

            <!-- NEW: Live Game View (Covers the whole main content area) -->
            <div id="live-game-view" class="hidden fade-in">
                <!-- Content will be injected by JS -->
            </div>

        </main>
        
        <div id="user-info" class="text-center mt-6 text-xs text-gray-400">
            User ID: <span id="user-id-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="modal-message" class="text-lg mb-4"></p>
            <button id="modal-close-btn" class="bg-indigo-600 text-white py-2 px-6 rounded-lg hover:bg-indigo-700">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>
	
	<div id="export-pdf-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
        <h3 class="text-xl font-bold mb-6 text-center">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£ Export PDF</h3>
        <div class="space-y-4">
            <button id="export-compact-pdf-btn" class="w-full flex items-center justify-center gap-3 bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all">
                <i class="fas fa-columns fa-lg"></i>
                <div>
                    <p>‡πÅ‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö (2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)</p>
                    <p class="text-xs font-normal">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏à‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©</p>
                </div>
            </button>
            <button id="export-tutor-pdf-btn" class="w-full flex items-center justify-center gap-3 bg-teal-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-teal-700 transition-all">
                <i class="fas fa-chalkboard-teacher fa-lg"></i>
                <div>
                    <p>‡πÅ‡∏ö‡∏ö‡∏ï‡∏¥‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏Ç‡πâ‡∏≠‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤)</p>
                    <p class="text-xs font-normal">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏ô, ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</p>
                </div>
            </button>
        </div>
        <div class="flex justify-end mt-8">
            <button id="cancel-export-pdf-btn" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>
	
	<div id="comparison-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-5xl w-full h-[90vh] flex flex-col">
        <div class="flex justify-between items-center mb-2">
            <h3 id="comparison-title" class="text-2xl font-bold text-indigo-700">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h3>
            <button id="close-comparison-modal-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
        </div>

        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-6">
                <button id="comparison-overall-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                    <i class="fas fa-chart-pie mr-2"></i>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                </button>
                <button id="comparison-individual-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500 hover:text-gray-700">
                    <i class="fas fa-user-friends mr-2"></i>‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </button>
            </nav>
        </div>
        
        <div class="flex-grow overflow-y-auto pt-4 bg-gray-50 p-2 md:p-6">
            <div id="comparison-overall-content">
                </div>
            <div id="comparison-individual-content" class="hidden">
                </div>
        </div>

        <div class="mt-4 pt-4 border-t flex justify-end">
            <button id="close-comparison-modal-footer-btn" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
</div>

<div id="lesson-view-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-50 p-4 flex items-center justify-center">
    <div class="bg-white w-full max-w-5xl h-[95vh] rounded-lg shadow-xl flex flex-col">
 <div class="flex justify-between items-center p-4 border-b">
    <h3 id="lesson-view-title" class="text-2xl font-bold text-indigo-700"></h3>
    <div class="flex items-center gap-4">
        <button id="fix-lesson-latex-btn" class="bg-yellow-500 text-white py-2 px-4 rounded-lg font-semibold hover:bg-yellow-600 transition-colors text-sm flex items-center gap-2">
            <i class="fas fa-magic-wand-sparkles"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£
        </button>
        <button id="export-lesson-to-pdf-btn" class="bg-red-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-red-700 transition-colors text-sm flex items-center gap-2">
            <i class="fas fa-file-pdf"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF
        </button>
        <button id="close-lesson-view-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
    </div>
</div>
        <div id="lesson-view-content" class="flex-grow overflow-y-auto p-6 bg-gray-50">
            <div id="lesson-loader" class="hidden text-center py-16">
                <div class="loader mx-auto"></div>
                <p id="lesson-loader-text" class="mt-4 text-gray-600">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
            </div>
            <div id="lesson-sections-container" class="hidden space-y-6 ai-content">
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-bullseye"></i>POINT ‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏î‡∏µ</h3><div id="pointContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-sd-card"></i>MEMORY ‡∏°‡∏µ‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏≥</h3><div id="memoryContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-pencil-alt"></i>APPLICATION ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ</h3><div id="applicationContent"></div></div>
                <div class="p-6 bg-white rounded-lg shadow-sm border"><h3 class="section-header"><i class="fas fa-file-alt"></i>ONE-PAGE SUMMARY ‡πÑ‡∏ß‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</h3><div id="summaryContent"></div></div>
            </div>
        </div>
    </div>
</div>

    <div id="create-project-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÉ‡∏´‡∏°‡πà</h3>
            <label for="project-name-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <input type="text" id="project-name-input" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏°.1 ‡πÄ‡∏ó‡∏≠‡∏° 2">
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-create-project-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-create-project-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ</button>
            </div>
        </div>
    </div>

    <div id="admin-password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full">
            <h3 class="text-xl font-bold mb-4 text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡∏ú‡∏π‡πâ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</h3>
            <p class="text-center text-gray-600 mb-4">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</p>
            <input type="password" id="admin-password-input" class="w-full p-3 border border-gray-300 rounded-lg text-center" placeholder="******">
            <p id="password-error-msg" class="text-red-500 text-sm text-center mt-2 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-admin-login-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-admin-login-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-[60]">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full text-center">
            <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-4"></i>
            <h3 class="text-xl font-bold mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</h3>
            <p id="confirmation-message" class="text-gray-600 mb-6"></p>
            <div class="flex justify-center gap-4">
                <button id="cancel-delete-btn" class="bg-gray-300 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-delete-btn" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>
	
	<div id="lesson-plan-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col">
        <div class="flex justify-between items-center mb-4 border-b pb-3">
            <h3 id="lesson-plan-title" class="text-2xl font-bold text-indigo-700">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏ó‡∏µ‡πà AI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
            <button id="close-lesson-plan-modal-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
        </div>
        
        <div id="lesson-plan-content" class="flex-grow overflow-y-auto bg-gray-50 p-8">
            </div>

        <div class="mt-6 pt-4 border-t flex justify-end gap-3">
            <button id="close-lesson-plan-modal-footer-btn" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300">‡∏õ‡∏¥‡∏î</button>
            <button id="export-lesson-pdf-btn" class="bg-red-600 text-white py-2 px-6 rounded-lg hover:bg-red-700 flex items-center gap-2">
                <i class="fas fa-file-pdf"></i> Export ‡πÄ‡∏õ‡πá‡∏ô PDF
            </button>
        </div>
    </div>
</div>

    <div id="rename-quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <label for="rename-quiz-input" class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà:</label>
            <input type="text" id="rename-quiz-input" class="w-full p-3 border border-gray-300 rounded-lg">
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-rename-quiz-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-rename-quiz-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <div id="move-quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏≠‡∏∑‡πà‡∏ô</h3>
            <label for="move-quiz-project-select" class="block text-sm font-medium text-gray-700 mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</label>
            <select id="move-quiz-project-select" class="w-full p-3 border border-gray-300 rounded-lg">
                <!-- Project options will be populated here -->
            </select>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-move-quiz-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-move-quiz-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏¢‡πâ‡∏≤‡∏¢</button>
            </div>
        </div>
    </div>
	
	<div id="blueprint-projects-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl w-full flex flex-col">
<div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-bold text-teal-700">‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</h3>
    <div class="flex items-center gap-4">
        <button id="manual-create-blueprint-btn" class="bg-blue-600 text-white py-1 px-3 rounded-lg font-semibold hover:bg-blue-700 flex items-center text-sm">
            <i class="fas fa-plus mr-2"></i>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏≠‡∏á
        </button>
        <button id="cancel-blueprint-projects-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>
</div>
    <div id="blueprint-project-list" class="max-h-96 overflow-y-auto border rounded-md">
        <p class="p-4 text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>
  </div>
</div>

<div id="manual-blueprint-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col">
    <h3 class="text-xl font-bold text-blue-700 mb-4">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ Blueprint ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</h3>

    <div class="space-y-4">
        <div>
            <label for="manual-bp-project-name" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ:</label>
            <input type="text" id="manual-bp-project-name" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô O-NET ‡∏õ.6 (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏á)">
        </div>
        <div>
            <label for="manual-bp-grade-level" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</label>
            <input type="text" id="manual-bp-grade-level" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 6">
        </div>
        <div>
            <label for="manual-bp-content" class="block text-sm font-medium text-gray-700">
                ‡∏ß‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ (‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤):
            </label>
            <textarea id="manual-bp-content" rows="10" class="mt-1 w-full p-2 border border-gray-300 rounded-lg font-mono text-sm" placeholder="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏µ‡πà 1: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏µ‡∏ä‡∏Ñ‡∏ì‡∏¥‡∏ï
    ‡∏Å‡∏≤‡∏£‡∏ö‡∏ß‡∏Å ‡∏•‡∏ö ‡∏Ñ‡∏π‡∏ì ‡∏´‡∏≤‡∏£‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏ö
        ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï
    ‡πÄ‡∏ß‡∏•‡∏≤
        ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤"></textarea>
            <p class="text-xs text-gray-500 mt-1">
                <b>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</b><br>
                ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ = ‡∏™‡∏≤‡∏£‡∏∞ (Sara)<br>
                ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏£‡∏∞‡∏î‡∏±‡∏ö = ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å (Main Topic)<br>
                ‡∏¢‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤ 2 ‡∏£‡∏∞‡∏î‡∏±‡∏ö = ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢ (Sub Topic)
            </p>
        </div>
    </div>

    <div class="flex justify-end gap-3 mt-6">
      <button id="cancel-manual-bp-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">
        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
      </button>
      <button id="confirm-manual-bp-btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
      </button>
    </div>
  </div>
</div>
	
<div id="global-activity-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4 flex-shrink-0">
        <h3 class="text-xl font-bold text-gray-700">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡∏ó‡∏∏‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ)
            <span id="global-quiz-count" class="text-base font-normal text-gray-500 ml-2"></span>
        </h3>
        <button id="cancel-global-activity-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <input id="global-quiz-search-input" type="text" class="w-full p-2 border border-gray-300 rounded-lg mb-3 flex-shrink-0" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ...">

    <div id="global-activity-quiz-list" class="flex-grow overflow-y-auto border rounded-md">
      </div>

    </div>
</div>

<div id="quiz-bank-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl w-full flex flex-col">
    <div class="flex justify-between items-center mb-4">
    <h3 class="text-xl font-bold">‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        <span id="quiz-bank-count" class="text-base font-normal text-gray-500 ml-2"></span>
    </h3>
    <div class="flex items-center gap-4">
        <button id="bulk-quiz-settings-btn" class="bg-orange-500 text-white py-2 px-3 rounded-lg font-semibold hover:bg-orange-600 text-sm flex items-center gap-2">
            <i class="fas fa-cogs"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
        <button id="cancel-quiz-bank-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>
</div>

    <input id="bank-quiz-search-input" type="text" class="w-full p-2 border border-gray-300 rounded-lg mb-3" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö, ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ, ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö...">

    <div id="bank-quiz-list" class="max-h-96 overflow-y-auto border rounded-md">
      </div>

  </div>
</div>

<div id="topic-quiz-bank-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[90vh]">
        <div class="flex justify-between items-center mb-4 border-b pb-3">
            <div>
                <h3 class="text-xl font-bold text-gray-800">‡∏Ñ‡∏•‡∏±‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
                <p id="topic-bank-subtopic-name" class="text-sm text-gray-500"></p>
            </div>
            <button id="close-topic-bank-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
        </div>
        
        <div id="topic-bank-list" class="flex-grow overflow-y-auto border rounded-md">
            </div>

        <div class="mt-4 pt-4 border-t flex justify-between items-center">
            <p class="text-xs text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞</p>
			<button id="clear-all-links-btn" class="hidden bg-red-100 text-red-700 py-2 px-4 rounded-lg font-semibold hover:bg-red-200 text-sm">
                <i class="fas fa-eraser mr-2"></i>‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button id="add-from-global-bank-btn" class="bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-purple-700">
                <i class="fas fa-plus-circle mr-2"></i>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏ß‡∏°
            </button>
        </div>
    </div>
</div>

    <div id="quiz-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full" style="max-height: 90vh; overflow-y: auto;">
            <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div class="space-y-4">
                <div>
                    <label for="modal-shuffle-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                    <select id="modal-shuffle-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
                        <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
                        <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                        <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                    </select>
                </div>
                <div>
                    <label for="modal-results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                    <select id="modal-results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
                        <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
                        <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
                        <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>

                        <optgroup label="‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡πÉ‡∏´‡∏°‡πà)">
                            <option value="half_mark_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏£‡∏∂‡πà‡∏á/‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á</option>
                            <option value="perfect_score_status">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°/‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</option>
                        </optgroup>
                    </select>
                </div>
                <div class="flex items-center mt-2">
                    <input id="modal-adaptive-quiz-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="modal-adaptive-quiz-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
                    </label>
                </div>
				
				<div class="flex items-center mt-2">
    <input id="modal-enable-remedial-checkbox" type="checkbox" class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
    <label for="modal-enable-remedial-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏° (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡∏Å)
    </label>
</div>
<div id="remedial-logic-container" class="mt-2 ml-6 p-3 bg-gray-50 border border-gray-200 rounded-lg">
    <label for="modal-remedial-logic-select" class="block text-sm font-medium text-gray-700 mb-1">
        ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°:
    </label>
    <select id="modal-remedial-logic-select" class="w-full p-2 border border-gray-300 rounded-md text-sm">
    <option value="round_5">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 1: ‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ 5 (‡∏ú‡∏¥‡∏î 1-5 ‚Üí ‡πÅ‡∏Å‡πâ 5)</option>
    <option value="round_3">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 2: ‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ 3 (‡∏ú‡∏¥‡∏î 1-3 ‚Üí ‡πÅ‡∏Å‡πâ 3)</option>
    
    <option value="round_2" selected="">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 3: ‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ 2 (‡∏ú‡∏¥‡∏î 1-2 ‚Üí ‡πÅ‡∏Å‡πâ 2)</option>
    
    <option value="exact">‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏ó‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á (‡∏ú‡∏¥‡∏î 1 ‚Üí ‡πÅ‡∏Å‡πâ 1)</option>
</select>
    <p class="text-xs text-gray-500 mt-1">‡πÄ‡∏ä‡πà‡∏ô ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏µ‡∏•‡∏∞ 3" ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ú‡∏¥‡∏î 4 ‡∏Ç‡πâ‡∏≠ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏° 6 ‡∏Ç‡πâ‡∏≠</p>
</div>

                <div class="flex items-center mt-2">
                    <input id="modal-loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <label for="modal-loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
                    </label>
                </div>
                <div class="p-3 border rounded-lg bg-indigo-50 space-y-2">
                    <div class="flex items-center">
                        <input id="modal-confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        <label for="modal-confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
                        </label>
                    </div>
                    <div id="modal-confidence-mode-container" class="hidden pl-6">
                        <label for="modal-confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
                        <select id="modal-confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                            <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                            <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
                        </select>
                    </div>
                </div>
                <div class="border-t pt-4">
                    <label for="modal-timer-mode-select" class="block text-sm font-medium text-gray-700">‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <select id="modal-timer-mode-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                        <option value="none">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</option>
                        <option value="whole_quiz">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ)</option>
                        <option value="per_question">‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</option>
                    </select>
                </div>
                <div id="modal-timer-duration-container" class="hidden">
                    <label for="modal-timer-duration-input" id="modal-timer-duration-label" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</label>
                    <input type="number" id="modal-timer-duration-input" value="10" min="1" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="border-t pt-4">
                    <label for="modal-passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
                    <input type="number" id="modal-passing-score-input" value="5" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div class="border-t pt-4 mt-2">
                    <p class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-balance-scale mr-1"></i> ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 1):
                    </p>
                    <div class="grid grid-cols-3 gap-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å / ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà</label>
                            <input type="number" id="modal-score-mcq" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-blue-600">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö)</label>
                            <input type="number" id="modal-score-sa" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-purple-600">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">‡∏ñ‡∏π‡∏Å / ‡∏ú‡∏¥‡∏î</label>
                            <input type="number" id="modal-score-tf" step="0.001" value="1" class="w-full p-2 border border-gray-300 rounded text-center font-bold text-green-600">
                        </div>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">*‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° (‡πÄ‡∏ä‡πà‡∏ô 6.50, 7.125)</p>
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-quiz-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-quiz-settings-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
	
	<div id="blueprint-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full flex flex-col">
        <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)</h3>
        
        <div class="space-y-4 max-h-[70vh] overflow-y-auto pr-4">
            
            <div>
                <label for="bp-modal-quiz-type-select" class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
                <select id="bp-modal-quiz-type-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    <optgroup label="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">
                        <option value="multiple_choice">‡πÅ‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö (‡∏Å, ‡∏Ç, ‡∏Ñ, ‡∏á)</option>
                        <option value="matching">‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà (‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠)</option>
                        <option value="true_false">‡πÅ‡∏ö‡∏ö‡∏ñ‡∏π‡∏Å/‡∏ú‡∏¥‡∏î</option>
                    </optgroup>
                    <optgroup label="‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥">
                        <option value="fill_in_with_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏´‡πâ)</option>
                        <option value="fill_in_no_choices">‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≠‡∏ö‡πÄ‡∏≠‡∏á)</option>
                        <option value="mixed">‡πÅ‡∏ö‡∏ö‡∏ú‡∏™‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥)</option>
                    </optgroup>
                </select>
            </div>

            <div>
                <label for="bp-modal-difficulty-level-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å:</label>
                <select id="bp-modal-difficulty-level-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                     </select>
            </div>

            <div>
                <label for="bp-modal-question-complexity-select" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</label>
                <select id="bp-modal-question-complexity-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    </select>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="bp-modal-num-questions" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠:</label>
                    <input type="number" id="bp-modal-num-questions" value="5" min="1" max="20" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label for="bp-modal-passing-score-input" class="block text-sm font-medium text-gray-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô:</label>
                    <input type="number" id="bp-modal-passing-score-input" value="3" min="0" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            
            <div id="bp-modal-num-choices-container">
                <label for="bp-modal-num-choices" class="block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                <input type="number" id="bp-modal-num-choices" value="4" min="2" max="6" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            </div>

            <div>
                <label for="bp-modal-shuffle-setting-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
                <select id="bp-modal-shuffle-setting-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                    <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
                    <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
                    <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                    <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                </select>
            </div>
            
            <div class="flex items-center mt-2">
                <input id="bp-modal-include-images-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                <label for="bp-modal-include-images-checkbox" class="ml-2 block text-sm font-medium text-gray-900">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
            </div>

        </div>
        
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-bp-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-bp-settings-btn" class="bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        </div>
    </div>
</div>
    
    <div id="quiz-status-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-md w-full">
            <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div class="space-y-4">
                <div class="space-y-2" id="quiz-status-options">
                    <!-- Radio buttons will be dynamically inserted here -->
                </div>
                <div id="quiz-schedule-end-container" class="hidden space-y-2 border-t pt-3">
                    <label for="quiz-end-time" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏¥‡∏î:</label>
                    <input type="datetime-local" id="quiz-end-time" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
                <div id="quiz-schedule-start-container" class="hidden space-y-2 border-t pt-3">
                    <label for="quiz-start-time" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î:</label>
                    <input type="datetime-local" id="quiz-start-time" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
                </div>
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="cancel-quiz-status-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-quiz-status-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
	
	<div id="bulk-quiz-settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full">
        <h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á</h3>
        <p class="text-sm text-red-600 mb-4">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö **‡∏ó‡∏∏‡∏Å‡∏ä‡∏∏‡∏î** ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
<div class="space-y-4">
    <div>
        <label for="bulk-shuffle-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</label>
        <select id="bulk-shuffle-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="none">‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö</option>
            <option value="questions_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠</option>
            <option value="choices_only">‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option value="both">‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
        </select>
    </div>
    <div>
        <label for="bulk-results-display-select" class="block text-sm font-medium text-gray-700">‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
        <select id="bulk-results-display-select" class="mt-1 w-full p-2 border border-gray-300 rounded-lg">
            <option value="show_results_and_answers">‡∏ó‡∏£‡∏≤‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</option>
            <option value="show_results_only">‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏•‡∏¢)</option>
            <option value="show_pass_fail_only">‡∏ó‡∏£‡∏≤‡∏ö‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô/‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</option>
            <option value="manual_release">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏ú‡∏•</option>
        </select>
    </div>
    <div class="flex items-center mt-2">
        <input id="bulk-loop-until-pass-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
        <label for="bulk-loop-until-pass-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏™‡∏≠‡∏ö‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô)
        </label>
    </div>

    <div class="p-3 border-t border-gray-200 mt-2 space-y-2 bg-indigo-50 rounded-lg">
        <div class="flex items-center">
            <input id="bulk-confidence-scoring-checkbox" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
            <label for="bulk-confidence-scoring-checkbox" class="ml-2 block text-sm font-medium text-gray-900">
                ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
            </label>
        </div>
        <div id="bulk-confidence-mode-container" class="hidden pl-6">
            <label for="bulk-confidence-mode-select" class="block text-xs font-medium text-gray-600">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:</label>
            <select id="bulk-confidence-mode-select" class="mt-1 w-full p-1 text-sm border border-gray-300 rounded-lg">
                <option value="checkbox">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏ï‡∏¥‡πä‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</option>
                <option value="mandatory">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à/‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)</option>
            </select>
        </div>
    </div>
    </div>
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-bulk-quiz-settings-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="confirm-bulk-quiz-settings-btn" class="bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
    </div>
</div>

<div id="quiz-editor-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b pb-3">
                <h3 class="text-2xl font-bold text-indigo-700">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
                <button id="cancel-quiz-edits-btn" class="text-gray-500 hover:text-red-600 text-3xl">√ó</button>
            </div>
            <div class="flex-grow overflow-y-auto pr-2">
                <div class="mb-4">
                    <label for="editor-quiz-topic" class="block text-sm font-medium text-gray-700 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</label>
                    <input type="text" id="editor-quiz-topic" class="w-full p-2 border border-gray-300 rounded-lg text-lg font-semibold">
                </div>
                <div id="quiz-editor-questions-container" class="space-y-6">
                    </div>
            </div>
          <div class="mt-6 pt-4 border-t flex flex-col sm:flex-row sm:justify-end gap-3">
    <button id="auto-fix-latex-btn" class="bg-yellow-500 text-white py-2 px-6 rounded-lg hover:bg-yellow-600 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-magic-wand-sparkles"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    </button>
    <button id="verify-answers-editor-btn" class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-check-double"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏¢ (AI)
    </button>
    <button id="cancel-quiz-edits-btn-footer" class="bg-gray-200 text-gray-800 py-2 px-6 rounded-lg hover:bg-gray-300 w-full sm:w-auto justify-center">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <button id="save-quiz-edits-btn" class="bg-green-600 text-white py-2 px-6 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 w-full sm:w-auto">
        <i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    </button>
</div>
			
        </div>
    </div>
	
	<div id="confirm-game-start-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full flex flex-col" style="max-height: 90vh;">
        
        <div class="p-6 border-b flex-shrink-0">
            <h3 id="game-start-modal-title" class="text-xl font-bold mb-2">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
            <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
        </div>

        <div class="flex-grow overflow-y-auto p-6">
            <div class="my-4">
                <label for="save-game-results-checkbox" class="flex items-center cursor-pointer">
                    <input id="save-game-results-checkbox" type="checkbox" checked="" class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                    <span class="ml-3 text-gray-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏µ‡πâ‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                </label>
                <p class="text-xs text-gray-500 mt-1 pl-8">‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥</p>
            </div>
            
            <div id="sync-variant-selector" class="my-4 text-left">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏•‡∏¢ (Sync Mode):</label>
                <div class="space-y-2">
    
    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="anonymous" class="mr-3" checked="">
        <div>
            <p class="font-semibold">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô (Anonymous)</p>
            <p class="text-xs text-gray-500">‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="anonymous_reveal_end" class="mr-3">
        <div>
            <p class="font-semibold">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô + ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢</p>
            <p class="text-xs text-gray-500">‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏°</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="classic" class="mr-3">
        <div>
            <p class="font-semibold">‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ (Classic)</p>
            <p class="text-xs text-gray-500">‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="reveal_at_end" class="mr-3">
        <div>
            <p class="font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢ (Reveal at End)</p>
            <p class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏Ç‡πâ‡∏≠ ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏â‡∏•‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡∏ï‡∏≠‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏Å‡∏°)</p>
        </div>
    </label>

    <label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
        <input type="radio" name="syncVariant" value="competition" class="mr-3">
        <div>
            <p class="font-semibold">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô (‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)</p>
            <p class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á) ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏µ‡πÉ‡∏î‡πÜ</p>
        </div>
    </label>
	
	<label class="flex items-center p-2 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-400">
    <input type="radio" name="syncVariant" value="exam_strict" class="mr-3">
    <div>
        <p class="font-semibold">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á (Exam Mode)</p>
        <p class="text-xs text-gray-500">‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á, ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°, ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏°</p>
    </div>
</label>
	
</div>

<div id="onet-mode-container" class="my-4 pt-4 border-t border-gray-200 text-left hidden">
                <label class="flex items-center cursor-pointer bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <input id="onet-mode-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <div class="ml-3">
                        <span class="text-blue-800 font-bold">‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏ô‡∏≤‡∏°‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á (O-NET Mode)</span>
                        <p class="text-xs text-blue-600 mt-1">
                            <i class="fas fa-info-circle"></i> ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏ä‡πà‡∏ô 6.5, 7.125) ‡πÅ‡∏•‡∏∞ <u>‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</u> (‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô, ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à)
                        </p>
                    </div>
                </label>
            </div>

            </div>
			
			<div id="anon-settings-container" class="my-4 pl-8 text-left hidden">
            <label for="anon-show-answer-toggle" class="flex items-center cursor-pointer">
                <input id="anon-show-answer-toggle" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked="">
                <span class="ml-3 text-sm text-gray-700">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏•‡∏¢‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Dashboard (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô)</span>
            </label>
        </div>

            <div class="my-4 pt-4 border-t border-gray-200 text-left">
                <label for="sync-timer-enable-checkbox" class="flex items-center cursor-pointer">
                    <input id="sync-timer-enable-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                    <span class="ml-3 text-gray-700 font-semibold">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ (‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠)</span>
                </label>
                <div id="sync-timer-duration-container" class="hidden mt-2 pl-8">
    <label for="sync-timer-duration-input" class="block text-sm font-medium text-gray-600">
        ‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ):
    </label>
    <input type="number" id="sync-timer-duration-input" value="300" min="10" class="mt-1 w-24 p-2 border border-gray-300 rounded-lg text-sm">
    <p class="text-xs text-gray-500 mt-1">(‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 300 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ = 5 ‡∏ô‡∏≤‡∏ó‡∏µ)</p>
</div>
            </div>
			
			<div id="black-market-settings-container" class="my-4 pt-4 border-t border-gray-200 text-left hidden">
            <label for="enable-black-market-checkbox" class="flex items-center cursor-pointer">
                <input id="enable-black-market-checkbox" type="checkbox" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked="">
                <span class="ml-3 text-gray-700 font-semibold">‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î (Black Market)</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 pl-8">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ Points ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ ‡∏ã‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠</p>
        </div>
			
        </div>

        <div class="p-6 border-t flex-shrink-0">
            <input type="hidden" id="game-start-quiz-id">
            <input type="hidden" id="game-start-mode">
            <div class="flex justify-end gap-3">
                <button id="cancel-game-start-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="confirm-game-start-btn" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
            </div>
        </div>
        
    </div>
</div>

<div id="shortcut-editor-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-lg w-full">
        <h3 id="shortcut-modal-title" class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î</h3>
        <div class="space-y-4">
            <div>
                <label for="shortcut-name-input" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î:</label>
                <input type="text" id="shortcut-name-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô Blueprint O-NET ‡∏õ.6">
            </div>
            <div>
                <label for="shortcut-blueprint-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå Test Blueprint (‡∏à‡∏≤‡∏Å Google Drive):</label>
                <input type="url" id="shortcut-blueprint-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ö‡∏ö '‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå' ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
            </div>
            <div>
                <label for="shortcut-reference-url-input" class="block text-sm font-medium text-gray-700">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å (‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏°):</label>
                <input type="url" id="shortcut-reference-url-input" class="mt-1 w-full p-2 border border-gray-300 rounded-lg" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå PDF ‡∏´‡∏£‡∏∑‡∏≠ TXT">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <input type="hidden" id="shortcut-id-input">
            <button id="cancel-shortcut-edit-btn" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="save-shortcut-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="additional-shortcuts-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full flex flex-col h-[80vh]">
    <div class="flex justify-between items-center mb-4">
        <h3 id="shortcut-modal-main-title" class="text-xl font-bold text-gray-700">‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <button id="close-additional-shortcuts-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
    </div>

    <div class="flex items-center border-b border-gray-200 mb-3 flex-shrink-0">
        <nav id="shortcut-tabs-nav" class="flex-grow -mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
            </nav>
        <button id="add-shortcut-tab-btn" class="ml-4 text-blue-600 hover:text-blue-800 font-semibold text-sm whitespace-nowrap py-3" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà">
            <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ó‡πá‡∏ö
        </button>
    </div>
    <div id="additional-shortcuts-list" class="flex-grow overflow-y-auto border rounded-md">
        </div>
</div>
</div>

    <!-- Presentation Mode Container -->
    <div id="presentation-modal" class="fixed inset-0 bg-gray-800 text-white flex-col items-center justify-center hidden z-50 p-4">
        <button id="close-presentation-btn" class="absolute top-4 right-6 text-4xl hover:text-gray-300">√ó</button>
        <div id="presentation-slide-container" class="w-full max-w-5xl h-full flex flex-col items-center justify-center">
            <!-- Slide content will be injected here -->
        </div>
<div class="absolute bottom-4 w-full flex justify-between items-center px-8 max-w-5xl mx-auto left-0 right-0">
            <button id="prev-question-btn" class="bg-indigo-600 py-2 px-5 rounded-lg hover:bg-indigo-700 disabled:bg-gray-500 disabled:cursor-not-allowed"><i class="fas fa-arrow-left mr-2"></i>‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
            
            <div class="flex-grow flex justify-center items-center gap-8">
                <div id="slide-counter" class="text-lg font-semibold"></div>
                <button id="presentation-scratchpad-btn" class="bg-white/20 hover:bg-white/40 text-white font-bold py-2 px-5 rounded-lg text-lg flex items-center gap-2" title="‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏ó‡∏î‡πÄ‡∏•‡∏Ç">
                    <i class="fas fa-pencil-alt"></i> ‡∏ó‡∏î‡πÄ‡∏•‡∏Ç
                </button>
            </div>
            
            <button id="next-question-btn" class="bg-indigo-600 py-2 px-5 rounded-lg hover:bg-indigo-700 disabled:bg-gray-500 disabled:cursor-not-allowed">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ<i class="fas fa-arrow-right ml-2"></i></button>
        </div>
    </div>
    <!-- NEW: Student Rankings Modal -->
    <div id="student-rankings-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-3xl w-full h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-indigo-700">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ô‡∏≥</h3>
                <button id="close-student-rankings-btn" class="text-gray-500 hover:text-red-600 text-2xl">√ó</button>
            </div>
            <!-- Tabs -->
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-6">
                    <button id="student-quiz-leaderboard-tab" class="main-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                        <i class="fas fa-list-ol mr-2"></i>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ
                    </button>
                    <button id="student-project-leaderboard-tab" class="main-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg text-gray-500">
                        <i class="fas fa-trophy mr-2"></i>‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
                    </button>
                </nav>
            </div>
            <!-- Content -->
            <div class="flex-grow overflow-y-auto mt-4">
                <div id="student-quiz-leaderboard-content">
                    <table class="min-w-full bg-white">
                        <thead class="bg-gray-100 sticky top-0">
                            <!-- Header for Quiz Leaderboard -->
                        </thead>
                        <tbody id="student-quiz-leaderboard-table-body"></tbody>
                    </table>
                </div>
                <div id="student-project-leaderboard-content" class="hidden">
                     <table class="min-w-full bg-white">
                        <thead class="bg-gray-100 sticky top-0">
                           <!-- Header for Project Leaderboard -->
                        </thead>
                        <tbody id="student-project-leaderboard-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
	
	<div id="project-passcode-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-lg shadow-xl max-w-sm w-full">
        <h3 class="text-xl font-bold mb-2 text-center">‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
        <p id="passcode-prompt-message" class="text-center text-gray-600 mb-4"></p>
        <input type="text" id="student-passcode-input" class="w-full p-3 border border-gray-300 rounded-lg text-center" placeholder="‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        <p id="passcode-error-msg" class="text-red-500 text-sm text-center mt-2 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        <div class="flex justify-end gap-3 mt-6">
            <button id="cancel-passcode-btn" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button id="confirm-passcode-btn" class="bg-indigo-600 text-white py-2 px-4 rounded-lg hover:bg-indigo-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
</div>

<div id="confidence-modal" data-current-mode="" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 text-center max-w-sm w-full relative">
        <button id="cancel-confidence-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">
            √ó
        </button>
        <p class="text-xl font-semibold text-gray-800 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?</p>
 <div class="flex justify-center gap-4">
    <button id="confirm-confident" class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-green-700 transition-transform hover:scale-105">
        <i class="far fa-smile-beam mr-2"></i>‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
    </button>
    <button id="confirm-not-confident" class="flex-1 bg-gray-500 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-gray-600 transition-transform hover:scale-105">
        <i class="far fa-meh mr-2"></i>‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à
    </button>
</div>
        <input type="hidden" id="selected-answer-index-hidden">
    </div>
</div>

<div id="wager-modal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-8 text-center max-w-sm w-full relative">
        <button id="cancel-wager-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">
            √ó
        </button>
        <p class="text-xl font-semibold text-gray-800 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?</p>
        <p class="text-lg text-gray-600 mb-2">
            ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ <span id="wager-max-points" class="font-bold text-indigo-600">0</span> Points
        </p>
        
        <div class="my-4 flex items-center gap-3">
    <input id="wager-slider" type="range" min="0" max="0" value="0" class="flex-grow h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600">
    
    <button id="wager-all-in-btn" class="bg-gradient-to-r from-red-500 to-pink-600 text-white text-xs font-bold py-2 px-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all shrink-0 flex items-center gap-1">
        <span>‡∏ó‡∏∏‡πà‡∏°‡∏´‡∏°‡∏î!</span> <i class="fas fa-rocket"></i>
    </button>
</div>
        
        <p class="text-5xl font-bold text-indigo-700 mb-6">
            <span id="wager-amount-display">0</span>
        </p>
        
        <button id="confirm-wager-btn" class="w-full bg-green-600 text-white py-3 px-6 rounded-lg text-lg font-bold hover:bg-green-700 transition-transform hover:scale-105">
            <i class="fas fa-gavel mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏°‡∏û‡∏±‡∏ô
        </button>
        
        <input type="hidden" id="selected-answer-index-hidden-wager">
    </div>
</div>

<div id="black-market-modal" class="hidden fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 text-center max-w-lg w-full relative">
        <button id="close-market-btn" class="absolute top-2 right-2 text-gray-400 hover:text-red-500 text-2xl w-8 h-8 rounded-full transition-colors" title="‡∏õ‡∏¥‡∏î‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î">
            √ó
        </button>
        
        <h2 class="text-3xl font-bold text-gray-800 mb-2">
            <i class="fas fa-store text-purple-600"></i> ‡∏ï‡∏•‡∏≤‡∏î‡∏°‡∏∑‡∏î
        </h2>
        <p class="text-lg text-gray-600 mb-4">
            ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ <span id="market-current-points" class="font-bold text-purple-600">0</span> Points
        </p>
        
        <div id="market-timer-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
            <div id="market-timer-bar" class="bg-purple-600 h-2.5 rounded-full" style="width: 100%; transition: width 1s linear;"></div>
        </div>

        <div id="market-item-list" class="space-y-2 max-h-64 overflow-y-auto text-left">
            </div>
    </div>
</div>

<div id="pin-entry-modal" class="fixed inset-0 bg-black/80 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden flex flex-col">
        
        <div class="bg-indigo-600 p-6 text-center relative">
            <button id="close-pin-modal-btn" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h3 class="text-xl font-bold text-white mb-1">‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h3>
            <p class="text-indigo-200 text-sm">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 4 ‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ñ‡∏£‡∏π</p>
        </div>

        <div class="p-6 flex justify-center gap-3 mb-2">
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
            <div class="pin-digit-box w-12 h-14 border-2 border-gray-300 rounded-lg flex items-center justify-center text-3xl font-bold text-indigo-600 bg-gray-50"></div>
        </div>

        <div class="px-6 pb-8">
            <div class="grid grid-cols-3 gap-4">
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="1">1</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="2">2</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="3">3</button>
                
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="4">4</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="5">5</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="6">6</button>
                
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="7">7</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="8">8</button>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="9">9</button>
                
                <div class="flex items-center justify-center">
                     </div>
                <button class="pin-key bg-gray-100 hover:bg-indigo-100 active:bg-indigo-200 text-gray-700 font-bold text-2xl py-4 rounded-xl transition-colors" data-val="0">0</button>
                <button id="pin-backspace-btn" class="bg-red-50 hover:bg-red-100 active:bg-red-200 text-red-500 font-bold text-xl py-4 rounded-xl transition-colors flex items-center justify-center">
                    <i class="fas fa-backspace"></i>
                </button>
            </div>
        </div>

    </div>
</div>

<!-- ‚ñº‚ñº‚ñº 3.1 ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà <div id="scratchpad-modal"> ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ ‚ñº‚ñº‚ñº -->
<div id="scratchpad-modal" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 sm:p-6 md:p-8">
    <div class="bg-white w-full h-full rounded-lg shadow-xl flex flex-col overflow-hidden">
        
        <div id="scratchpad-controls" class="flex-shrink-0">
             </div>

        <div class="scratchpad-content-wrapper flex-grow relative">
            <canvas id="scratchpad-canvas" class="absolute inset-0 z-10"></canvas>
            <div id="scratchpad-header" class="p-4 sm:p-6 relative z-20 pointer-events-none">
                <h3 id="scratchpad-question" class="text-xl sm:text-2xl font-bold text-gray-800"></h3>
                <div id="scratchpad-options" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 mt-3 text-gray-700">
                </div>
            </div>
        </div>
    </div>
</div>

<div id="remedial-list-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] flex flex-col">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <div>
                <h3 class="text-xl font-bold text-indigo-700" id="remedial-modal-title">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°</h3>
                <p class="text-sm text-gray-500">Master ID: <span id="remedial-master-id"></span></p>
            </div>
            <button onclick="document.getElementById('remedial-list-modal').classList.add('hidden')" class="text-gray-500 hover:text-red-500 text-2xl">√ó</button>
        </div>
        <div class="overflow-y-auto flex-grow">
            <table class="min-w-full bg-white text-sm md:text-base">
                <thead class="bg-gray-100 sticky top-0 shadow-sm">
                    <tr>
                        <th class="py-3 px-4 text-left font-bold text-gray-600">Repair ID</th>
                        <th class="py-3 px-4 text-left font-bold text-gray-600">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                        
                        <th class="py-3 px-4 text-center font-bold text-gray-600">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th>
                        <th class="py-3 px-4 text-left font-bold text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</th>
                        <th class="py-3 px-4 text-center font-bold text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="py-3 px-4 text-center font-bold text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
                        <th class="py-3 px-4 text-center font-bold text-gray-600">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="remedial-list-body" class="divide-y divide-gray-200"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="student-progress-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-[70]">
    <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col overflow-hidden">
        <div class="bg-indigo-50 px-6 py-4 border-b border-indigo-100 flex justify-between items-center">
            <div>
                <h3 class="text-xl font-bold text-indigo-800"><i class="fas fa-tasks mr-2"></i>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠</h3>
                <p id="progress-student-name" class="text-gray-600 text-sm mt-1"></p>
            </div>
            <button onclick="document.getElementById('student-progress-modal').classList.add('hidden')" class="text-gray-400 hover:text-red-500 transition-colors">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-0 overflow-y-auto flex-grow bg-gray-50">
            <div id="progress-content-area" class="p-6"></div>
        </div>
        <div class="bg-white px-6 py-3 border-t text-right">
            <button onclick="document.getElementById('student-progress-modal').classList.add('hidden')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg shadow">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>
</div>

<div id="admin-review-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-[75]">
    <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[85vh] flex flex-col overflow-hidden">
        <div class="bg-blue-50 px-6 py-4 border-b border-blue-100 flex justify-between items-center">
            <div>
                <h3 class="text-xl font-bold text-blue-800"><i class="fas fa-file-alt mr-2"></i>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°</h3>
                <p id="review-student-name" class="text-gray-600 font-semibold text-sm"></p>
            </div>
            <button onclick="document.getElementById('admin-review-modal').classList.add('hidden')" class="text-gray-400 hover:text-red-500 transition-colors">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div id="admin-review-body" class="p-6 overflow-y-auto bg-gray-50 flex-grow space-y-4"></div>
        <div class="bg-white px-6 py-3 border-t text-right">
            <button onclick="document.getElementById('admin-review-modal').classList.add('hidden')" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg shadow">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>
</div>

<div id="remedial-dashboard-modal" class="fixed inset-0 bg-gray-900 hidden z-50 flex flex-col">
    
    <div class="bg-gray-800 border-b border-gray-700 shadow-md z-20 px-4 py-3 md:px-6">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-3">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-600 p-2 rounded-lg text-white">
                        <i class="fas fa-desktop text-lg"></i>
                    </div>
                    <div>
                        <h1 id="dashboard-topic" class="text-xl md:text-2xl font-bold text-white leading-tight">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏°</h1>
                        <p class="text-xs text-gray-400">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏™‡∏≠‡∏ö‡∏ã‡πà‡∏≠‡∏° Real-time</p>
                    </div>
                </div>
                <button onclick="document.getElementById('remedial-dashboard-modal').classList.add('hidden')" class="text-gray-400 hover:text-white bg-gray-700 hover:bg-red-600 p-2 rounded-full transition-all w-8 h-8 flex items-center justify-center">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4">
                <div class="bg-gray-700/50 rounded-lg p-2 px-3 flex items-center justify-between border border-gray-600">
                    <span class="text-xs text-gray-400">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                    <div class="flex items-baseline gap-1">
                        <span id="dash-total-students" class="text-xl font-bold text-white">0</span>
                        <span class="text-xs text-gray-500">‡∏Ñ‡∏ô</span>
                    </div>
                </div>

                <div class="bg-green-900/20 rounded-lg p-2 px-3 flex items-center justify-between border border-green-800/30">
                    <span class="text-xs text-green-400">‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                    <div class="flex items-baseline gap-1">
                        <span id="dash-passed-students" class="text-xl font-bold text-green-400">0</span>
                        <span class="text-xs text-green-600">‡∏Ñ‡∏ô</span>
                    </div>
                </div>

                <div class="bg-red-900/20 rounded-lg p-2 px-3 flex items-center justify-between border border-red-800/30">
                    <span class="text-xs text-red-400">‡∏£‡∏≠‡∏™‡∏≠‡∏ö</span>
                    <div class="flex items-baseline gap-1">
                        <span id="dash-pending-students" class="text-xl font-bold text-red-400">0</span>
                        <span class="text-xs text-red-600">‡∏Ñ‡∏ô</span>
                    </div>
                </div>

                <div class="bg-gray-700/50 rounded-lg p-2 px-3 border border-gray-600 flex flex-col justify-center">
                    <div class="flex justify-between text-xs mb-1">
                        <span class="text-blue-300">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                        <span id="dash-overall-percent-text" class="text-white font-bold">0%</span>
                    </div>
                    <div class="w-full bg-gray-600 rounded-full h-1.5 overflow-hidden">
                        <div id="dash-overall-bar" class="bg-blue-500 h-1.5 rounded-full transition-all duration-700" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="flex-1 overflow-y-auto bg-gray-900 p-4 md:p-6 custom-scrollbar">
        <div class="max-w-7xl mx-auto">
            <div id="dash-student-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-4 pb-10">
                </div>
        </div>
    </div>
</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, addDoc, updateDoc, collection, query, where, getDocs, onSnapshot, deleteDoc, deleteField, writeBatch, runTransaction, serverTimestamp, increment, arrayUnion, arrayRemove, getCountFromServer } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// SECURE BOOTSTRAP
(function() {
    setInterval(function(){
        const t0 = Date.now();
        debugger; 
        const t1 = Date.now();
        if(t1 - t0 > 100) { console.warn("Debugger detected"); }
    }, 2000);
    
    const _secret = "CiAgICAgICAgLy8g4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCgkJCgkJLy8gLS0tIFsg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4LibIF0gLS0tCmNvbnN0IEFOT05ZTU9VU19OQU1FUyA9IFsKICAi4LiZ4Lix4LiB4Lil4LmI4Liy4Lid4Lix4LiZIiwgIuC4muC4seC4geC5geC4leC4h+C5guC4oSIsICLguYDguJfguJ7guJfguKPguLkiLCAi4LmA4Lir4Lih4Li14Lii4Lin4LiC4Li14LmJ4LmA4LiL4LiyIiwgIuC4meC4geC4ruC4ueC4geC4geC4peC4suC4h+C4p+C4seC4mSIsICLguYDguJXguYjguLLguKrguLLguKLguJ/guYnguLIiLCAi4LmC4Lil4Lih4Liy4Lia4Li04LiZIiwgIuC4quC4tOC4h+C5guC4leC4ouC4tOC5ieC4oSIsICLguYDguJ7guJnguIHguKfguLTguJnguYTguJ8iLCAi4LiI4Li04LiH4LmC4LiI4LmJ4Liq4LmC4Lil4Lin4LmM4LmE4Lil4Lif4LmMIiwKICAi4Lic4Li54LmJ4Lie4Li04LiK4Li04LiV4LiU4Liy4LinIiwgIuC4oeC4t+C4reC4m+C4o+C4suC4muC4quC4suC4ouC4o+C4uOC5ieC4hyIsICLguYDguIfguLLguJvguKPguLTguKjguJnguLIiLCAi4Liq4Liy4Lii4Lil4Lih4LmB4Lir4LmI4LiH4LmC4LiK4LiE4LiK4Liw4LiV4LiyIiwgIuC4reC4seC4qOC4p+C4tOC4meC4o+C4seC4leC4leC4tOC4geC4suC4pSIsICLguIjguK3guKHguYDguKfguJfguKLguYzguILguJnguKHguKvguKfguLLguJkiLCAi4LiZ4Li04LiZ4LiI4Liy4LiK4Liy4LmA4LiC4Li14Lii4LinIiwgIuC4i+C4suC4oeC4ueC5hOC4o+C4quC4suC4ouC5gOC4lOC4teC5iOC4ouC4pyIsICLguYLguIjguKPguKrguKXguLHguJTguK3guKfguIHguLLguKgiLCAi4Lih4Lix4LiH4LiB4Lij4LiB4Li04LiZ4LiI4Li4IiwKICAi4Lir4Lih4Li14LiC4Lix4LmJ4Lin4LmC4Lil4LiB4LmD4LiV4LmJIiwgIuC5geC4oeC4p+C5gOC4geC5ieC4suC4iuC4teC4p+C4tOC4lSIsICLguJvguKXguLLguJfguLnguITguLDguJnguK3guIciLCAi4LmE4LiB4LmI4Lif4LmJ4Liy4Lie4LiN4Liy4Lil4LitIiwgIuC4geC4uOC5ieC4h+C5gOC4leC5ieC4meC5geC4o+C5ieC4h+C4geC4siIsICLguKvguKHguLLguJvguYjguLLguYDguJTguLXguKLguKfguJTguLLguKIiLCAi4LiB4Lij4Liw4LiV4LmI4Liy4Lii4LiV4Li34LmI4LiZ4LiV4Li54LihIiwgIuC5gOC4quC4t+C4reC4i+C5iOC4reC4meC5gOC4peC5h+C4miIsICLguKHguYnguLLguJTguLXguJTguIHguLDguYLguKvguKXguIEiLCAi4Lir4LiZ4Lit4LiZ4Lir4LiZ4Lix4LiH4Liq4Li34LitIiwKICAi4Lii4Lit4LiU4LiZ4Lix4LiB4Liq4Li34LiaIiwgIuC4quC4suC4ouC4peC4seC4muC4iOC4seC4muC4muC5ieC4suC4meC5gOC4peC5h+C4gSIsICLguITguJnguJTguLXguKjguKPguLXguKrguKLguLLguKEiLCAi4LiU4Liy4LinVGlrVG9rIiwgIuC4ouC4ueC4l+C4ueC4m+C5gOC4muC4reC4o+C5jOC4neC4tuC4geC4q+C4seC4lCIsICJDRU/guJ7guLHguJnguKXguYnguLLguJkiLCAi4LmA4Lio4Lij4Lip4LiQ4Li14LiU4Li54LmE4LiaIiwgIuC4reC4tOC4meC4n+C4peC4ueC5gOC4reC4meC5gOC4i+C4reC4o+C5jCIsICLguYDguJnguYfguJXguYTguK3guJTguK3guKUiLCAi4LiU4Liy4Lin4Liq4Lig4LiyIiwKICAi4LiB4Liy4LmB4Lif4LiC4LihIiwgIuC4iuC4suC5hOC4guC5iOC4oeC4uOC4gSIsICLguKrguYnguKHguJXguLPguJvguLnguJvguKXguLLguKPguYnguLIiLCAi4Lie4Li04LiL4LiL4LmI4Liy4Lir4LiZ4LmJ4Liy4LiX4Li44LmA4Lij4Li14Lii4LiZIiwgIuC5hOC4reC4leC4tOC4oeC4l+C4reC4lCIsICLguILguYnguLLguKfguKHguLHguJnguYTguIHguYjguJ7guLTguYDguKjguKkiLCAi4Lir4Lih4Li54LiB4Lij4Liw4LiX4Liw4LiI4Liw4LmA4Lii4Li14Lii4Lin4Lii4Liy4LiX4Li44LiB4Liq4Li04LmI4LiHIiwgIuC4hOC4o+C4seC4p+C4i+C4reC4h+C4leC5jCIsICLguIrguLXguKrguYDguITguYnguIEiLCAi4Lil4Liy4LmA4LiV4LmJ4LmE4Lih4LmI4Lir4Lin4Liy4LiZIiwKICAi4Liq4Liy4Lii4LiV4Liy4Liq4Lix4LmJ4LiZIiwgIuC4m+C4p+C4lOC4q+C4peC4seC4hyIsICLguK3guK3guJ/guJ/guLTguKjguIvguLTguJnguYLguJTguKPguKEiLCAi4LiZ4Lit4LiZ4LmE4Lih4LmI4Lie4LitIiwgIuC4leC4tOC4lOC4i+C4teC4o+C4teC4quC5jCIsICLguYHguJrguJXguKvguKHguJQiLCAi4LmA4LiZ4LmH4LiV4LiK4LmJ4LiyIiwgIuC5guC4q+C4peC4lOC4meC4suC4mSIsICI0MDQgTm90IEZvdW5kIiwgIuC4geC4reC4h+C4lOC4reC4hyIsCiAgIuC4iOC4seC4meC4l+C4o+C5jOC5gOC4iOC5ieC4siIsICLguJXguLDguKfguLHguJnguInguLLguKIiLCAi4Liq4Liy4Lii4Lir4Lih4Lit4LiBIiwgIuC4geC5ieC4reC4meC5gOC4oeC4hiIsICLguJTguKfguIfguJTguLLguKciLCAi4LiX4LmJ4Lit4LiH4Lif4LmJ4LiyIiwgIuC4l+C4sOC5gOC4pSIsICLguKDguLnguYDguILguLIiLCAi4Lib4LmI4Liy4LmE4Lih4LmJIiwgIuC5geC4oeC5iOC4meC5ieC4syIsCiAgIuC4meC4seC4geC5gOC4lOC4tOC4meC4l+C4suC4hyIsICLguIrguYjguLLguIfguKDguLLguJ4iLCAi4LmA4LiB4Lih4LmA4Lih4Lit4Lij4LmMIiwgIuC4qOC4tOC4peC4m+C4tOC4mSIsICLguJnguLHguIHguJTguJnguJXguKPguLUiLCAi4LiZ4Lix4LiB4LmA4LiC4Li14Lii4LiZIiwgIuC4meC4seC4geC4p+C4tOC4l+C4ouC4suC4qOC4suC4quC4leC4o+C5jCIsICLguJnguLHguIHguJvguKPguLDguJTguLTguKnguJDguYwiLCAi4LiZ4Lix4LiB4LiB4Li14Lis4LiyIiwgIuC4hOC4o+C4ueC5g+C4q+C4jeC5iCIsCiAgIuC4nuC4peC4seC4h+C4hOC4peC4t+C5iOC4meC5gOC4leC5iOC4siIsICLguJvguKXguYjguK3guKLguJ7guKXguLHguIciLCAi4LmB4Lib4Lil4LiH4Lij4LmI4Liy4LiHIiwgIuC4leC4seC4p+C5geC4l+C4meC5geC4q+C5iOC4h+C4lOC4p+C4h+C4iOC4seC4meC4l+C4o+C5jCIsICLguJTguLLguJrguJ7guLTguIbguLLguJXguK3guKrguLnguKMiLCAi4LiE4Liy4LiW4Liy4LmB4Lii4LiB4LmA4LiH4Liy4Lie4Lix4LiZ4Lij4LmI4Liy4LiHIiwgIuC4mOC4reC4o+C5jOC4hOC5ieC4reC4meC4muC4tOC4mSIsICLguYTguK3guKPguK3guJnguYHguKHguJkiLCAi4LiB4Lix4Lib4LiV4Lix4LiZIiwgIuC4ruC4seC4peC4hOC5jCIsCiAgIuC4o+C4seC4geC5geC4o+C4geC4nuC4miIsICLguITguJnguYLguKrguJQiLCAi4LmB4Lit4Lia4LiK4Lit4LiaIiwgIuC4reC4geC4q+C4seC4gSIsICLguYDguJ7guLfguYjguK3guJnguKrguJnguLTguJciLCAi4LiE4Li54LmI4LiI4Li04LmJ4LiZIiwgIuC5geC4n+C4meC4l+C4tOC4nuC4ouC5jCIsICLguITguJnguITguLjguKIiLCAi4Liq4LiW4Liy4LiZ4Liw4LmE4Lih4LmI4LiK4Lix4LiU4LmA4LiI4LiZIiwgIuC4oeC4ueC5gOC4leC4peC4uSIKXTsKbGV0IGxhc3RTZWVuUXVlc3Rpb25JbmRleCA9IC0xOwpsZXQgb3JkZXJlZFBsYXllclNlbGVjdGlvbiA9IFtdOyAvLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguKPguLLguKLguIrguLfguYjguK3guJXguLLguKHguKXguLPguJTguLHguJrguJfguLXguYjguIHguJTguYDguKXguLfguK3guIEKbGV0IGNsaWVudFNpZGVIaWRkZW5PcHRpb25zID0ge307CmxldCBibHVlcHJpbnRTaG9ydGN1dHMgPSBbXTsKbGV0IHNob3J0Y3V0VGFicyA9IFtdOyAgICAgICAgIC8vIE5FVzog4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4LiX4LmH4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCmxldCBzaG9ydGN1dE9yZGVyID0ge307ICAgICAgICAvLyBORVc6IOC4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4muC4peC4s+C4lOC4seC4muC4geC4suC4o+C4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C4guC4reC4h+C5geC4leC5iOC4peC4sOC5geC4l+C5h+C4mgpsZXQgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyBORVc6IElEIOC4guC4reC4h+C5geC4l+C5h+C4muC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4luC4ueC4geC5gOC4peC4t+C4reC4gQpsZXQgZmlsZVNob3J0Y3V0VGFicyA9IFtdOwpsZXQgZmlsZVNob3J0Y3V0T3JkZXIgPSB7fTsKbGV0IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID0gJ2FsbCc7CmxldCBwYXJhbGxlbFNob3J0Y3V0VGFicyA9IFtdOwpsZXQgcGFyYWxsZWxTaG9ydGN1dE9yZGVyID0ge307CmxldCBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKbGV0IGZpbGVTaG9ydGN1dHMgPSBbXTsKbGV0IHBhcmFsbGVsVGVzdFNob3J0Y3V0cyA9IFtdOwpsZXQgY2FtZUZyb21CbHVlcHJpbnQgPSBmYWxzZTsKbGV0IHdha2VMb2NrID0gbnVsbDsKbGV0IGxvY2FsR3JvdXBRdWVzdGlvbkluZGV4ID0gMDsKCmxldCBibHVlcHJpbnRQYWdlU2V0dGluZ3MgPSBudWxsOyAvLyDguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguITguYjguLIgc2V0dGluZyDguIrguLHguYjguKfguITguKPguLLguKfguYPguJnguKvguJnguYnguLLguJnguLXguYkKCmxldCBleHRyYWN0ZWRCbHVlcHJpbnREYXRhID0gbnVsbDsgLy8g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmE4LiU4LmJ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCmxldCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkID0gbnVsbDsgLy8g4LmA4LiB4LmH4LiaIElEIOC4guC4reC4hyBQcm9qZWN0IOC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4lOC4ueC4reC4ouC4ueC5iAoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaICLguILguK0iIOC5g+C4q+C5ieC5gOC4muC4o+C4suC4p+C5jOC5gOC4i+C4reC4o+C5jOC5gOC4m+C4tOC4lOC4geC4suC4o+C4peC5h+C4reC4geC4q+C4meC5ieC4suC4iOC4rQpjb25zdCByZXF1ZXN0V2FrZUxvY2sgPSBhc3luYyAoKSA9PiB7CiAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Lin4LmI4Liy4LmA4Lia4Lij4Liy4Lin4LmM4LmA4LiL4Lit4Lij4LmM4LiZ4Li14LmJ4Lij4Lit4LiH4Lij4Lix4LiaIFdha2UgTG9jayDguKvguKPguLfguK3guYTguKHguYgKICBpZiAoJ3dha2VMb2NrJyBpbiBuYXZpZ2F0b3IpIHsKICAgIHRyeSB7CiAgICAgIC8vIOC4quC5iOC4h+C4hOC4s+C4guC4reC5geC4peC4sOC5gOC4geC5h+C4miBvYmplY3Qgd2FrZUxvY2sg4LmE4Lin4LmJ4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijCiAgICAgIHdha2VMb2NrID0gYXdhaXQgbmF2aWdhdG9yLndha2VMb2NrLnJlcXVlc3QoJ3NjcmVlbicpOwogICAgICBjb25zb2xlLmxvZygnV2FrZSBMb2NrIOC4l+C4s+C4h+C4suC4meC5geC4peC5ieC4pzog4Lir4LiZ4LmJ4Liy4LiI4Lit4LiI4Liw4LmE4Lih4LmI4LiU4Lix4Lia4LmA4Lit4LiHJyk7CgogICAgICAvLyDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXIg4LmA4Lic4Li34LmI4Lit4LiB4Lij4LiT4Li14LiX4Li14LmI4LiB4Liy4Lij4Lil4LmH4Lit4LiB4Lir4Lil4Li44LiU4LmE4Lib4LmA4Lit4LiHICjguYDguIrguYjguJkg4LmB4Lia4LiV4LmD4LiB4Lil4LmJ4Lir4Lih4LiUKQogICAgICB3YWtlTG9jay5hZGRFdmVudExpc3RlbmVyKCdyZWxlYXNlJywgKCkgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCdXYWtlIExvY2sg4LiW4Li54LiB4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4LmB4Lil4LmJ4LinJyk7CiAgICAgIH0pOwoKICAgIH0gY2F0Y2ggKGVycikgewogICAgICAvLyDguIHguKPguJPguLXguJfguLXguYjguITguLPguILguK3guKXguYnguKHguYDguKvguKXguKcgKOC5gOC4iuC5iOC4mSDguJzguLnguYnguYPguIrguYnguJXguLHguYnguIfguITguYjguLLguYDguJrguKPguLLguKfguYzguYDguIvguK3guKPguYzguYTguKHguYjguK3guJnguLjguI3guLLguJUpCiAgICAgIGNvbnNvbGUuZXJyb3IoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4m+C4tOC4lCBXYWtlIExvY2s6ICR7ZXJyLm5hbWV9LCAke2Vyci5tZXNzYWdlfWApOwogICAgfQogIH0gZWxzZSB7CiAgICBjb25zb2xlLndhcm4oJ+C5gOC4muC4o+C4suC4p+C5jOC5gOC4i+C4reC4o+C5jOC4meC4teC5ieC5hOC4oeC5iOC4o+C4reC4h+C4o+C4seC4miBXYWtlIExvY2sgQVBJJyk7CiAgfQp9OwoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaICLguJvguKXguYjguK3guKIiIOC4q+C4o+C4t+C4reC4m+C4tOC4lOC4geC4suC4o+C4peC5h+C4reC4geC4q+C4meC5ieC4suC4iOC4rQpjb25zdCByZWxlYXNlV2FrZUxvY2sgPSBhc3luYyAoKSA9PiB7CiAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4LiyIHdha2VMb2NrIOC4geC4s+C4peC4seC4h+C4l+C4s+C4h+C4suC4meC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogIGlmICh3YWtlTG9jayAhPT0gbnVsbCkgewogICAgYXdhaXQgd2FrZUxvY2sucmVsZWFzZSgpOyAvLyDguKrguLHguYjguIfguJvguLTguJQKICAgIHdha2VMb2NrID0gbnVsbDsgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4Liy4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijCiAgICBjb25zb2xlLmxvZygnV2FrZSBMb2NrIOC4luC4ueC4geC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC5geC4peC5ieC4pzog4Lir4LiZ4LmJ4Liy4LiI4Lit4LiB4Lil4Lix4Lia4Liq4Li54LmI4LmC4Lir4Lih4LiU4Lib4LiB4LiV4Li0Jyk7CiAgfQp9OwovLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEgXSAtLS0KCmxldCBkaW1UaW1lciA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4miB0aW1lcgpjb25zdCBpbmFjdGl2aXR5VGltZSA9IDYwMDAwOyAvLyA2MCDguKfguLTguJnguLLguJfguLUgKDYwMDAwIOC4oeC4tOC4peC4peC4tOC4p+C4tOC4meC4suC4l+C4tSkKCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4o+C4teC5gOC4i+C5h+C4lSBUaW1lciDguYHguKXguLDguJfguLPguYPguKvguYnguIjguK0gIuC4quC4p+C5iOC4suC4hyIKZnVuY3Rpb24gcmVzZXREaW1UaW1lcigpIHsKICAgIC8vIOC5gOC4o+C4suC4iOC4sOC4o+C4teC5gOC4i+C5h+C4leC4leC4seC4p+C4meC4seC4muC5gOC4p+C4peC4siDguIHguYfguJXguYjguK3guYDguKHguLfguYjguK3guKvguJnguYnguLLguIjguK3guKLguLHguIfguYTguKHguYjguKvguKPguLXguYjguYDguJfguYjguLLguJnguLHguYnguJkKICAgIC8vIOC4luC5ieC4suC4q+C4meC5ieC4suC4iOC4reC4q+C4o+C4teC5iOC5hOC4m+C5geC4peC5ieC4pyDguIHguLLguKPguILguKLguLHguJrguYDguKHguLLguKrguYwo4LiX4Li14LmI4LmE4Lih4LmI4LmE4LiU4LmJ4Lit4Lii4Li54LmI4Lia4LiZIE92ZXJsYXkpIOC4iOC4sOC5hOC4oeC5iOC4m+C4peC4uOC4geC4iOC4rQogICAgaWYgKCFkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucygnZGltbWVkJykpIHsKICAgICAgICBpZiAoZGltVGltZXIpIGNsZWFyVGltZW91dChkaW1UaW1lcik7CiAgICAgICAgCiAgICAgICAgZGltVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LiE4Lij4LiaIDEg4LiZ4Liy4LiX4Li1IOC5g+C4q+C5ieC4q+C4o+C4teC5iOC4iOC4rSAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2RpbW1lZCcpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn4Lir4LiZ4LmJ4Liy4LiI4Lit4Lir4Lij4Li14LmI4LmB4Liq4LiH4Lil4LiH4LmA4LiZ4Li34LmI4Lit4LiH4LiI4Liy4LiB4LmE4Lih4LmI4LmD4LiK4LmJ4LiH4Liy4LiZJyk7CiAgICAgICAgfSwgaW5hY3Rpdml0eVRpbWUpOwogICAgfQp9CgovLyDguJvguKPguLDguIHguLLguKjguJXguLHguKfguYHguJvguKMgZ2xvYmFsIOC5gOC4nuC4t+C5iOC4reC5gOC4geC5h+C4miB1bnN1YnNjcmliZSBmdW5jdGlvbgpsZXQgZGFzaGJvYXJkVW5zdWJzY3JpYmVzID0gW107Cgphc3luYyBmdW5jdGlvbiBvcGVuUmVtZWRpYWxEYXNoYm9hcmQobWFzdGVyUXVpeklkLCB0b3BpY05hbWUpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbWVkaWFsLWRhc2hib2FyZC1tb2RhbCcpOwogICAgCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaGJvYXJkLXRvcGljJykudGV4dENvbnRlbnQgPSB0b3BpY05hbWU7CiAgICBjb25zdCBncmlkQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rhc2gtc3R1ZGVudC1ncmlkJyk7CiAgICBncmlkQ29udGFpbmVyLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtY2VudGVyIGNvbC1zcGFuLWZ1bGwgcHktMTAgdGV4dC1zbSI+PGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4pS4uLjwvZGl2Pic7CiAgICAKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jCBsaXN0ZW5lciDguYDguIHguYjguLLguJfguLTguYnguIfguIHguYjguK3guJkgKOC4luC5ieC4suC4oeC4tSkKICAgIGRhc2hib2FyZFVuc3Vic2NyaWJlcy5mb3JFYWNoKHVuc3ViID0+IHVuc3ViKCkpOwogICAgZGFzaGJvYXJkVW5zdWJzY3JpYmVzID0gW107CgogICAgdHJ5IHsKICAgICAgICAvLyDguJTguLbguIfguKPguLLguKLguIHguLLguKMgUXVpeiDguKLguYjguK3guKIg4Lig4Liy4Lii4LmD4LiV4LmJIE1hc3RlciDguJnguLXguYkKICAgICAgICBjb25zdCBxID0gcXVlcnkoCiAgICAgICAgICAgIGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2ApLAogICAgICAgICAgICB3aGVyZSgicmVtZWRpYWxNYXN0ZXJJZCIsICI9PSIsIG1hc3RlclF1aXpJZCksCiAgICAgICAgICAgIHdoZXJlKCJpc1JlbWVkaWFsQ2hpbGQiLCAiPT0iLCB0cnVlKQogICAgICAgICk7CiAgICAgICAgCiAgICAgICAgLy8g4LmD4LiK4LmJIG9uU25hcHNob3Qg4LiB4Lix4Lia4Lij4Liy4Lii4LiB4Liy4LijIFF1aXog4Lir4Lil4Lix4LiB4LiU4LmJ4Lin4LiiIOC5gOC4nOC4t+C5iOC4reC4oeC4teC4geC4suC4o+C4quC4o+C5ieC4suC4hyBRdWl6IOC5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IHVuc3ViUXVpeiA9IG9uU25hcHNob3QocSwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgICAgIGlmIChzbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICAgICAgZ3JpZENvbnRhaW5lci5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0idGV4dC1ncmF5LTUwMCB0ZXh0LWNlbnRlciBjb2wtc3Bhbi1mdWxsIHB5LTQgdGV4dC1zbSI+4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZPC9kaXY+JzsKICAgICAgICAgICAgICAgIHVwZGF0ZURhc2hib2FyZFN0YXRzKDAsIDAsIDAsIDAsIDApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguJ7guLfguYnguJnguJDguLLguJnguILguK3guIfguYHguJXguYjguKXguLAgUXVpegogICAgICAgICAgICBjb25zdCBxdWl6emVzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIGRhdGE6IGRvYy5kYXRhKCkgfSkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlciDguYDguJ7guLfguYjguK3guYHguKrguJTguIfguJzguKXguYHguKXguLDguJzguLnguIEgTGlzdGVuZXIg4Lii4LmI4Lit4LiiCiAgICAgICAgICAgIHJlbmRlckxpdmVEYXNoYm9hcmRHcmlkKHF1aXp6ZXMsIGdyaWRDb250YWluZXIpOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGRhc2hib2FyZFVuc3Vic2NyaWJlcy5wdXNoKHVuc3ViUXVpeik7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJEYXNoYm9hcmQgRXJyb3I6IiwgZXJyb3IpOwogICAgICAgIGdyaWRDb250YWluZXIuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InRleHQtcmVkLTQwMCB0ZXh0LWNlbnRlciBjb2wtc3Bhbi1mdWxsIHRleHQtc20iPkVycm9yOiAke2Vycm9yLm1lc3NhZ2V9PC9kaXY+YDsKICAgIH0KfQoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmB4Lii4LiB4Liq4Liz4Lir4Lij4Lix4LiaIFJlbmRlciDguYHguKXguLDguJzguLnguIEgUmVhbC10aW1lIExpc3RlbmVyIOC4ouC5iOC4reC4ogpmdW5jdGlvbiByZW5kZXJMaXZlRGFzaGJvYXJkR3JpZChxdWl6emVzLCBjb250YWluZXIpIHsKICAgIC8vIOC5gOC4geC5h+C4muC4guC5ieC4reC4oeC4ueC4peC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4meC4o+C4ueC4m+C5geC4muC4miBPYmplY3Qg4LmA4Lie4Li34LmI4Lit4Lit4Lix4Lib4LmA4LiU4LiV4LmE4LiU4LmJ4LiH4LmI4Liy4LiiCiAgICBsZXQgc3R1ZGVudHNNYXAgPSB7fTsKCiAgICBxdWl6emVzLmZvckVhY2gocXVpek9iaiA9PiB7CiAgICAgICAgY29uc3QgcXVpeklkID0gcXVpek9iai5pZDsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IHF1aXpPYmouZGF0YTsKICAgICAgICAKICAgICAgICAvLyDguJzguLnguIEgUmVhbC10aW1lIExpc3RlbmVyIOC4geC4seC4miBTdWJtaXNzaW9ucyDguILguK3guIfguYHguJXguYjguKXguLAgUXVpegogICAgICAgIGNvbnN0IHN1YkNvbCA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgKTsKICAgICAgICAKICAgICAgICBjb25zdCB1bnN1YlN1YiA9IG9uU25hcHNob3Qoc3ViQ29sLCAoc3ViU25hcCkgPT4gewogICAgICAgICAgICAvLyDguITguLPguJnguKfguJPguILguYnguK3guKHguLnguKXguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguITguJnguJnguLXguYnguYPguKvguKHguYjguYDguKHguLfguYjguK3guKHguLXguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIcKICAgICAgICAgICAgbGV0IHNjb3JlID0gMDsKICAgICAgICAgICAgbGV0IGlzUGFzc2VkID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBoYXNTdWJtaXR0ZWQgPSBmYWxzZTsKICAgICAgICAgICAgbGV0IHJvdW5kQ291bnQgPSAwOwoKICAgICAgICAgICAgaWYgKCFzdWJTbmFwLmVtcHR5KSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJEYXRhID0gc3ViU25hcC5kb2NzWzBdLmRhdGEoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN1Ym1pdHRlZEF0ID0gc3ViRGF0YS5sYXRlc3RTdWJtaXR0ZWRBdCA/IG5ldyBEYXRlKHN1YkRhdGEubGF0ZXN0U3VibWl0dGVkQXQpLmdldFRpbWUoKSA6IDA7CiAgICAgICAgICAgICAgICBjb25zdCBjcmVhdGVkQXQgPSBuZXcgRGF0ZShxdWl6RGF0YS5jcmVhdGVkQXQpLmdldFRpbWUoKTsKCiAgICAgICAgICAgICAgICBpZiAoc3VibWl0dGVkQXQgPj0gY3JlYXRlZEF0KSB7CiAgICAgICAgICAgICAgICAgICAgc2NvcmUgPSAoc3ViRGF0YS5zY29yZSAhPT0gdW5kZWZpbmVkKSA/IHN1YkRhdGEuc2NvcmUgOiAoc3ViRGF0YS5sYXRlc3RTY29yZSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICBoYXNTdWJtaXR0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IHF1aXpEYXRhLnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gcXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBpc1Bhc3NlZCA9IHNjb3JlID49IHBhc3NpbmdTY29yZTsKCiAgICAgICAgICAgICAgICAgICAgLy8g4LiU4Li24LiH4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4Liq4Lit4LiaIChSb3VuZCkKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHN1YkRhdGEuc3VibWl0Q291bnQgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdW5kQ291bnQgPSBzdWJEYXRhLnN1Ym1pdENvdW50OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3ViRGF0YS5hdHRlbXB0cyAmJiBBcnJheS5pc0FycmF5KHN1YkRhdGEuYXR0ZW1wdHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdW5kQ291bnQgPSBzdWJEYXRhLmF0dGVtcHRzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByb3VuZENvdW50ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOC4reC4seC4m+C5gOC4lOC4leC4guC5ieC4reC4oeC4ueC4peC4meC4seC4geC5gOC4o+C4teC4ouC4meC4peC4h+C5g+C4mSBNYXAKICAgICAgICAgICAgc3R1ZGVudHNNYXBbcXVpeklkXSA9IHsKICAgICAgICAgICAgICAgIGlkOiBxdWl6SWQsCiAgICAgICAgICAgICAgICBuYW1lOiBxdWl6RGF0YS5yZW1lZGlhbEZvciwKICAgICAgICAgICAgICAgIHNjb3JlOiBzY29yZSwKICAgICAgICAgICAgICAgIHRvdGFsOiBxdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoLAogICAgICAgICAgICAgICAgaXNQYXNzZWQ6IGlzUGFzc2VkLAogICAgICAgICAgICAgICAgaGFzU3VibWl0dGVkOiBoYXNTdWJtaXR0ZWQsCiAgICAgICAgICAgICAgICByb3VuZDogcm91bmRDb3VudAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lin4Liy4LiU4Lir4LiZ4LmJ4Liy4LiI4Lit4LmD4Lir4Lih4LmI4LiX4Li44LiB4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmA4Lib4Lil4Li14LmI4Lii4LiZCiAgICAgICAgICAgIHVwZGF0ZURhc2hib2FyZFVJKE9iamVjdC52YWx1ZXMoc3R1ZGVudHNNYXApLCBjb250YWluZXIpOwogICAgICAgIH0pOwoKICAgICAgICBkYXNoYm9hcmRVbnN1YnNjcmliZXMucHVzaCh1bnN1YlN1Yik7CiAgICB9KTsKfQoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lin4Liy4LiUIFVJICjguYHguKLguIHguK3guK3guIHguKHguLLguYDguJ7guLfguYjguK3guYPguKvguYnguYDguKPguLXguKLguIHguYPguIrguYnguIvguYnguLPguYTguJTguYnguIfguYjguLLguKIpCmZ1bmN0aW9uIHVwZGF0ZURhc2hib2FyZFVJKHN0dWRlbnRzLCBjb250YWluZXIpIHsKICAgIC8vIOC4hOC4s+C4meC4p+C4kyBTdGF0cyDguKPguKfguKEKICAgIGNvbnN0IHRvdGFsU3R1ZGVudHMgPSBzdHVkZW50cy5sZW5ndGg7CiAgICBjb25zdCBwYXNzZWRDb3VudCA9IHN0dWRlbnRzLmZpbHRlcihzID0+IHMuaXNQYXNzZWQpLmxlbmd0aDsKICAgIGNvbnN0IHBlbmRpbmdDb3VudCA9IHRvdGFsU3R1ZGVudHMgLSBwYXNzZWRDb3VudDsKICAgIGNvbnN0IGdyYW5kVG90YWxTY29yZSA9IHN0dWRlbnRzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLnNjb3JlLCAwKTsKICAgIGNvbnN0IGdyYW5kVG90YWxRdWVzdGlvbnMgPSBzdHVkZW50cy5yZWR1Y2UoKHN1bSwgcykgPT4gc3VtICsgcy50b3RhbCwgMCk7CiAgICAKICAgIHVwZGF0ZURhc2hib2FyZFN0YXRzKHRvdGFsU3R1ZGVudHMsIHBhc3NlZENvdW50LCBwZW5kaW5nQ291bnQsIGdyYW5kVG90YWxTY29yZSwgZ3JhbmRUb3RhbFF1ZXN0aW9ucyk7CgogICAgLy8gU29ydAogICAgc3R1ZGVudHMuc29ydCgoYSwgYikgPT4gewogICAgICAgIGlmIChhLmlzUGFzc2VkID09PSBiLmlzUGFzc2VkKSByZXR1cm4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKTsKICAgICAgICByZXR1cm4gYS5pc1Bhc3NlZCA/IDEgOiAtMTsKICAgIH0pOwoKICAgIC8vIFJlbmRlciBIVE1MCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICBzdHVkZW50cy5mb3JFYWNoKHMgPT4gewogICAgICAgIGNvbnN0IHBlcmNlbnQgPSBzLnRvdGFsID4gMCA/IE1hdGgucm91bmQoKHMuc2NvcmUgLyBzLnRvdGFsKSAqIDEwMCkgOiAwOwogICAgICAgIAogICAgICAgIGxldCBjYXJkQmcgPSAnYmctZ3JheS04MDAnOyAKICAgICAgICBsZXQgYm9yZGVyQ29sb3IgPSBzLmlzUGFzc2VkID8gJ2JvcmRlci1ncmVlbi01MDAnIDogJ2JvcmRlci1ncmF5LTYwMCc7CiAgICAgICAgbGV0IGlkQ29sb3IgPSBzLmlzUGFzc2VkID8gJ3RleHQtZ3JlZW4tNDAwJyA6ICd0ZXh0LXllbGxvdy00MDAnOyAKICAgICAgICBsZXQgc3RhdHVzRG90ID0gcy5pc1Bhc3NlZCA/ICdiZy1ncmVlbi01MDAgc2hhZG93LVswXzBfOHB4XyMyMmM1NWVdJyA6ICdiZy1yZWQtNTAwIGFuaW1hdGUtcHVsc2UnOwogICAgICAgIGxldCBiYXJDb2xvciA9IHMuaXNQYXNzZWQgPyAnYmctZ3JhZGllbnQtdG8tciBmcm9tLWdyZWVuLTQwMCB0by1ncmVlbi02MDAnIDogJ2JnLWdyYXktNjAwJzsKICAgICAgICBsZXQgc3RhdHVzVGV4dCA9IHMuaXNQYXNzZWQgPyAn4Lic4LmI4Liy4LiZ4LmB4Lil4LmJ4LinJyA6ICfguKPguK3guKrguK3guJrguIvguYjguK3guKEnOwogICAgICAgIGxldCBzdGF0dXNUZXh0Q29sb3IgPSBzLmlzUGFzc2VkID8gJ3RleHQtZ3JlZW4tNTAwJyA6ICd0ZXh0LWdyYXktNDAwJzsKCiAgICAgICAgbGV0IHJvdW5kQmFkZ2UgPSAocy5yb3VuZCA+IDApIAogICAgICAgICAgICA/IGA8c3BhbiBjbGFzcz0iYmctaW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHRleHQtWzEwcHhdIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCBmb250LWJvbGQgbWwtYXV0byBzaGFkb3ctc20iPuC4hOC4o+C4seC5ieC4h+C4l+C4teC5iCAke3Mucm91bmR9PC9zcGFuPmAKICAgICAgICAgICAgOiBgPHNwYW4gY2xhc3M9ImJnLWdyYXktNzAwIHRleHQtZ3JheS00MDAgdGV4dC1bMTBweF0gcHgtMiBweS0wLjUgcm91bmRlZC1mdWxsIGZvbnQtYm9sZCBtbC1hdXRvIj4tPC9zcGFuPmA7CgogICAgICAgIGNvbnN0IGh0bWwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlICR7Y2FyZEJnfSBib3JkZXItdC00ICR7Ym9yZGVyQ29sb3J9IHJvdW5kZWQteGwgcC00IHNoYWRvdy1sZyBob3ZlcjpiZy1ncmF5LTc1MCB0cmFuc2l0aW9uLWFsbCBncm91cCBmbGV4IGZsZXgtY29sIGgtZnVsbCBqdXN0aWZ5LWJldHdlZW4gcmluZy0xIHJpbmctd2hpdGUvNSBhbmltYXRlLWZhZGUtaW4tdXAiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNCBzcGFjZS15LTMiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LVsxMHB4XSB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgZm9udC1zZW1pYm9sZCBibG9jayBtYi0wLjUiPlJlcGFpciBJRDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtMnhsIGZvbnQtYmxhY2sgZm9udC1tb25vICR7aWRDb2xvcn0gdHJhY2tpbmctdGlnaHRlciBzZWxlY3QtYWxsIGN1cnNvci1wb2ludGVyIGhvdmVyOnNjYWxlLTEwNSB0cmFuc2l0aW9uLXRyYW5zZm9ybSBvcmlnaW4tbGVmdCIgdGl0bGU9IuC4hOC4peC4tOC4geC5gOC4nuC4t+C5iOC4reC4hOC4seC4lOC4peC4reC4gSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtzLmlkfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAke3JvdW5kQmFkZ2V9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LVsxMHB4XSB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSB0cmFja2luZy13aWRlc3QgZm9udC1zZW1pYm9sZCBibG9jayBtYi0wLjUiPlN0dWRlbnQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtd2hpdGUgbGVhZGluZy10aWdodCB0cnVuY2F0ZSB0cmFja2luZy10aWdodCIgdGl0bGU9IiR7cy5uYW1lfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3MubmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB0LTEgYm9yZGVyLXQgYm9yZGVyLWdyYXktNzAwLzUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0yIGgtMiByb3VuZGVkLWZ1bGwgJHtzdGF0dXNEb3R9Ij48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteHMgZm9udC1tZWRpdW0gJHtzdGF0dXNUZXh0Q29sb3J9Ij4ke3N0YXR1c1RleHR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JheS05MDAvNTAgcm91bmRlZC1sZyBwLTIgbXQtYXV0byBib3JkZXIgYm9yZGVyLWdyYXktNzAwLzMwIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1lbmQgbWItMS41Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtWzEwcHhdIHRleHQtZ3JheS00MDAiPuC4hOC4p+C4suC4oeC4hOC4t+C4muC4q+C4meC5ieC4sjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyBmb250LWJvbGQgdGV4dC13aGl0ZSBmb250LW1vbm8iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IiR7cy5pc1Bhc3NlZCA/ICd0ZXh0LWdyZWVuLTQwMCcgOiAndGV4dC13aGl0ZSd9Ij4ke3Muc2NvcmV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS02MDAiPi88L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3MudG90YWx9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS03MDAgcm91bmRlZC1mdWxsIGgtMiBvdmVyZmxvdy1oaWRkZW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSIke2JhckNvbG9yfSBoLTIgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTcwMCBlYXNlLW91dCIgc3R5bGU9IndpZHRoOiAke3BlcmNlbnR9JSI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MICs9IGh0bWw7CiAgICB9KTsKfQoKLy8gKirguKrguLPguITguLHguI06Kiog4Lit4Lii4LmI4Liy4Lil4Li34Lih4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LiV4Lit4LiZ4Lib4Li04LiUIE1vZGFsIOC5gOC4nuC4t+C5iOC4reC4q+C4ouC4uOC4lOC4n+C4seC4h+C4guC5ieC4reC4oeC4ueC4pQpmdW5jdGlvbiBjbG9zZVJlbWVkaWFsRGFzaGJvYXJkKCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVtZWRpYWwtZGFzaGJvYXJkLW1vZGFsJyk7CiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgLy8g4Lii4LiB4LmA4Lil4Li04LiBIGxpc3RlbmVyIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5gOC4oeC4t+C5iOC4reC4m+C4tOC4lOC4q+C4meC5ieC4suC4iOC4rQogICAgZGFzaGJvYXJkVW5zdWJzY3JpYmVzLmZvckVhY2godW5zdWIgPT4gdW5zdWIoKSk7CiAgICBkYXNoYm9hcmRVbnN1YnNjcmliZXMgPSBbXTsKfQoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lit4Lix4Lib4LmA4LiU4LiV4LiV4Lix4Lin4LmA4Lil4LiC4Liq4LiW4Li04LiV4Li04Lia4LiZ4Lir4LiZ4LmJ4LiyIERhc2hib2FyZAovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguK3guLHguJvguYDguJTguJXguJXguLHguKfguYDguKXguILguKrguJbguLTguJXguLTguJrguJnguKvguJnguYnguLIgRGFzaGJvYXJkICjguInguJrguLHguJrguYHguIHguYnguYTguIIgRXJyb3IpCmZ1bmN0aW9uIHVwZGF0ZURhc2hib2FyZFN0YXRzKHRvdGFsLCBwYXNzZWQsIHBlbmRpbmcsIHRvdGFsU2NvcmUsIHRvdGFsTWF4KSB7CiAgICAvLyAxLiDguK3guLHguJvguYDguJTguJXguJXguLHguKfguYDguKXguILguKrguJbguLTguJXguLTguKvguKXguLHguIEKICAgIC8vIOC5gOC4iuC5h+C4hOC4geC5iOC4reC4meC4p+C5iOC4suC4oeC4tSBlbGVtZW50IOC5hOC4q+C4oSDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJkgRXJyb3IKICAgIGNvbnN0IHRvdGFsRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaC10b3RhbC1zdHVkZW50cycpOwogICAgaWYgKHRvdGFsRWwpIHRvdGFsRWwudGV4dENvbnRlbnQgPSB0b3RhbDsKCiAgICBjb25zdCBwYXNzZWRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXNoLXBhc3NlZC1zdHVkZW50cycpOwogICAgaWYgKHBhc3NlZEVsKSBwYXNzZWRFbC50ZXh0Q29udGVudCA9IHBhc3NlZDsKCiAgICBjb25zdCBwZW5kaW5nRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaC1wZW5kaW5nLXN0dWRlbnRzJyk7CiAgICBpZiAocGVuZGluZ0VsKSBwZW5kaW5nRWwudGV4dENvbnRlbnQgPSBwZW5kaW5nOwoKICAgIC8vIDIuIOC4hOC4s+C4meC4p+C4k+C5gOC4m+C4reC4o+C5jOC5gOC4i+C5h+C4meC4leC5jOC4o+C4p+C4oQogICAgY29uc3QgcGVyY2VudCA9IHRvdGFsTWF4ID4gMCA/IE1hdGgucm91bmQoKHRvdGFsU2NvcmUgLyB0b3RhbE1heCkgKiAxMDApIDogMDsKICAgIAogICAgLy8gMy4g4Lit4Lix4Lib4LmA4LiU4LiV4Lir4Lil4Lit4LiUIFByb2dyZXNzCiAgICBjb25zdCBiYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaC1vdmVyYWxsLWJhcicpOwogICAgY29uc3QgcGVyY2VudFRleHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGFzaC1vdmVyYWxsLXBlcmNlbnQtdGV4dCcpOwoKICAgIGlmIChiYXIpIHsKICAgICAgICBiYXIuc3R5bGUud2lkdGggPSBgJHtwZXJjZW50fSVgOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4quC4teC4q+C4peC4reC4lOC4luC5ieC4suC4hOC4o+C4miAxMDAlCiAgICAgICAgaWYgKHBlcmNlbnQgPT09IDEwMCkgewogICAgICAgICAgICBiYXIuY2xhc3NOYW1lID0gImJnLWdyZWVuLTUwMCBoLTEuNSByb3VuZGVkLWZ1bGwgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tNzAwIHNoYWRvdy1bMF8wXzEwcHhfcmdiYSgzNCwxOTcsOTQsMC42KV0iOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJhci5jbGFzc05hbWUgPSAiYmctYmx1ZS01MDAgaC0xLjUgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTcwMCI7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwZXJjZW50VGV4dCkgewogICAgICAgIHBlcmNlbnRUZXh0LnRleHRDb250ZW50ID0gYCR7cGVyY2VudH0lYDsKICAgIH0KCiAgICAvLyDwn5SlIOC4iOC4uOC4lOC4l+C4teC5iOC4peC4muC4reC4reC4gTogZGFzaC1vdmVyYWxsLWZyYWN0aW9uIOC5hOC4oeC5iOC4oeC4teC5g+C4mSBIVE1MIOC5g+C4q+C4oeC5iOC5geC4peC5ieC4pwogICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rhc2gtb3ZlcmFsbC1mcmFjdGlvbicpLnRleHRDb250ZW50ID0gLi4uICjguKXguJrguJfguLTguYnguIcpCn0KCmZ1bmN0aW9uIHdha2VVcFNjcmVlbihldmVudCkgewogICAgaWYgKGV2ZW50KSB7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7IC8vIDwtLS0g4LiE4Liz4Liq4Lix4LmI4LiH4Liq4Liz4LiE4Lix4LiNOiDguKvguKLguLjguJTguYTguKHguYjguYPguKvguYnguITguKXguLTguIHguJfguLDguKXguLgKICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQogICAgCiAgICAvLyAxLiDguKrguLHguYjguIfguYPguKvguYkgT3ZlcmxheSDguKvguLLguKLguYTguJsKICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZGltbWVkJyk7IAogICAgCiAgICAvLyAyLiDguKvguKXguLHguIfguIjguLLguIHguJvguKXguLjguIHguIjguK3guYHguKXguYnguKcg4LmD4Lir4LmJ4LmA4Lij4Li04LmI4Lih4LiZ4Lix4Lia4LmA4Lin4Lil4Liy4Lie4Lix4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LmD4Lir4Lih4LmICiAgICBpZiAoZGltVGltZXIpIGNsZWFyVGltZW91dChkaW1UaW1lcik7CiAgICBkaW1UaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnZGltbWVkJyk7CiAgICB9LCBpbmFjdGl2aXR5VGltZSk7Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4q+C4ouC4uOC4lOC4o+C4sOC4muC4muC4iOC4seC4muC5gOC4p+C4peC4suC4l+C4seC5ieC4h+C4q+C4oeC4lApmdW5jdGlvbiBzdG9wRGltVGltZXIoKSB7CiAgICBpZiAoZGltVGltZXIpIGNsZWFyVGltZW91dChkaW1UaW1lcik7CiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2RpbW1lZCcpOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHJlc2V0RGltVGltZXIpOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHJlc2V0RGltVGltZXIpOwogICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCByZXNldERpbVRpbWVyKTsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgcmVzZXREaW1UaW1lcik7CiAgICBjb25zb2xlLmxvZygn4Lir4Lii4Li44LiU4Lij4Liw4Lia4Lia4LiI4Lix4Lia4LmA4Lin4Lil4Liy4Lir4Lij4Li14LmI4Lir4LiZ4LmJ4Liy4LiI4LitJyk7Cn0KCiAgICAgICAgLy8gLS0tIEdsb2JhbCBTdGF0ZSAmIENvbmZpZyAtLS0KCQkKCQkvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IFvguYDguJ7guLTguYjguKFdIOC4leC4seC4p+C5geC4m+C4oyBHbG9iYWwg4LmD4Lir4Lih4LmI4Liq4Liz4Lir4Lij4Lix4LiaIFRlYW0gUXVpeiA9PT0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIOC4p+C4suC4h+C5hOC4p+C5ieC5g+C4geC4peC5ieC5hiDguIHguLHguJrguJXguLHguKfguYHguJvguKMgR2xvYmFsIOC4reC4t+C5iOC4meC5hiDguJTguYnguLLguJnguJrguJnguILguK3guIcgU2NyaXB0CmxldCBjdXJyZW50VGVhbVF1aXpJZCA9IG51bGw7CmxldCB1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIgPSBudWxsOwpsZXQgbG9jYWxUZWFtUGxheWVycyA9IFtdOyAvLyDguYDguIHguYfguJrguIrguLfguYjguK3guJzguLnguYnguYDguKXguYjguJnguJfguLXguYjguYDguKXguLfguK3guIHguYPguJnguYDguITguKPguLfguYjguK3guIfguJnguLXguYkKbGV0IGxvY2FsUGxheWVyVHVybkluZGV4ID0gMDsgLy8g4Lil4Liz4LiU4Lix4Lia4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCmxldCBsb2NhbFF1ZXN0aW9uSW5kZXggPSAwOyAgIC8vIFvguYDguJ7guLTguYjguKFdIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC4meC4seC4muC4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4mQpsZXQgbG9jYWxQbGF5ZXJJbmRleCA9IDA7ICAgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguJnguLHguJrguJzguLnguYnguYDguKXguYjguJnguYPguJnguILguYnguK3guJnguLHguYnguJnguYYKbGV0IGN1cnJlbnRBcHBsaWNhdGlvbkRhdGEgPSBbXTsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyA9PT0gW+C5gOC4nuC4tOC5iOC4oV0g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Liq4Liz4Lir4Lij4Lix4LiaIFRlYW0gUXVpeiAo4Lid4Lix4LmI4LiHIEFkbWluKSA9PT0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8qKgogKiDguYDguKPguLTguYjguKEgVGVhbSBRdWl6IFNlc3Npb24g4LmD4Lir4Lih4LmIIChBZG1pbikKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN0YXJ0VGVhbVF1aXoocXVpeklkLCBzaG91bGRTYXZlID0gZmFsc2UpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIHJlbmRlckFkbWluVGVhbVF1aXpEYXNoYm9hcmQocGluLCB0b3BpYywgbW9kZSA9ICd0ZWFtJykgeyAvLyAxLiDguYDguJ7guLTguYjguKHguJ7guLLguKPguLLguKHguLTguYDguJXguK3guKPguYwgbW9kZQogICAgLy8gMi4g4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiC4LmA4Lie4Li34LmI4Lit4LmA4Lil4Li34Lit4LiB4Lir4Lix4Lin4LiC4LmJ4LitCiAgICBjb25zdCBtb2RlVGl0bGUgPSAobW9kZSA9PT0gJ2dyb3VwJykgPyAnR3JvdXAgTW9kZScgOiAnVGVhbSBRdWl6JzsKCiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWN5YW4tNjAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItMiI+JHttb2RlVGl0bGV9OiAke3RvcGljfTwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWxnIG1iLTQiPuC5g+C4q+C5ieC4meC4seC4geC5gOC4o+C4teC4ouC4meC5gOC4guC5ieC4suC4o+C5iOC4p+C4oeC4lOC5ieC4p+C4ouC4o+C4q+C4seC4quC4meC4teC5iTo8L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXdoaXRlIHRleHQtZ3JheS04MDAgcm91bmRlZC1sZyBwLTQgbWItNCI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC02eGwgZm9udC1ib2xkIHRyYWNraW5nLXdpZGVzdCI+JHtwaW59PC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LTJ4bCBiZy13aGl0ZS8yMCBwLTQgcm91bmRlZC1sZyBtdC00IGZsZXgtZ3JvdyBvdmVyZmxvdy15LWF1dG8iPgogICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItMiB0ZXh0LWNlbnRlciI+4Liq4LiW4Liy4LiZ4Liw4Lic4Li54LmJ4LmA4Lil4LmI4LiZPC9oMz4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRlYW0tcGxheWVyLXN0YXR1cy1ncmlkIiBjbGFzcz0ic3BhY2UteS0yIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1jeWFuLTIwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihLi4uPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZW5kLXRlYW0tcXVpei1idG4iIGNsYXNzPSJtdC02IGJnLXJlZC02MDAgdGV4dC13aGl0ZSBweS0yIHB4LTYgcm91bmRlZC1sZyBob3ZlcjpiZy1yZWQtNzAwIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTIiPjwvaT7guIjguJrguIHguLTguIjguIHguKPguKPguKEKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmQtdGVhbS1xdWl6LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIHNob3dDb25maXJtYXRpb24oIuC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4muC4geC4tOC4iOC4geC4o+C4o+C4oeC4meC4teC5iT8iLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGlmKHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lcikgdW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKCk7CiAgICAgICAgICAgIGF3YWl0IGRlbGV0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvdGVhbVF1aXp6ZXNgLCBjdXJyZW50VGVhbVF1aXpJZCkpOwogICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKICAgICAgICB9KTsKICAgIH0pOwp9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGxpc3RlbkZvclRlYW1RdWl6VXBkYXRlcyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCmZ1bmN0aW9uIGxpc3RlbkZvclRlYW1RdWl6VXBkYXRlcygpIHsKICAgIGlmICh1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIpIHVuc3Vic2NyaWJlVGVhbVF1aXpMaXN0ZW5lcigpOwoKICAgIGNvbnN0IHRlYW1RdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpOwogICAgdW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyID0gb25TbmFwc2hvdCh0ZWFtUXVpelJlZiwgKGRvY1NuYXApID0+IHsKICAgICAgICBpZiAoIWRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgLy8gLS0tIFtTVEFSVF0g4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicpOwogICAgICAgICAgICBpZiAodW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKSB1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIoKTsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4tOC4iOC4geC4o+C4o+C4oeC4quC4tOC5ieC4meC4quC4uOC4lOC4peC4h+C5geC4peC5ieC4pyIpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4suC4iOC4suC4gSBCbHVlcHJpbnQg4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCBNYW5hZ2VyCiAgICAgICAgICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOyAvLyDguKXguYnguLLguIfguITguKfguLLguKHguIjguLMKICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmA4Lib4LmH4LiZIGFkbWluIOC5geC4leC5iOC5hOC4oeC5iOC5hOC4lOC5ieC4oeC4suC4iOC4suC4gSBCbHVlcHJpbnQg4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4LiyIFByb2plY3QgRGV0YWlsCiAgICAgICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4mSBzdHVkZW50IOC5g+C4q+C5ieC4geC4peC4seC4muC4q+C4meC5ieC4suC5geC4o+C4gQogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBnYW1lRGF0YSA9IGRvY1NuYXAuZGF0YSgpOwoKICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgaWYgKGdhbWVEYXRhLm1vZGUgPT09ICdncm91cCcgJiYgZ2FtZURhdGEuc3RhdHVzICE9PSAncG9kaXVtJyAmJiBnYW1lRGF0YS5zdGF0dXMgIT09ICdmaW5pc2hlZCcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwcyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEuZ3JvdXBzIHx8IHt9KTsKICAgICAgICAgICAgICAgIGlmIChncm91cHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbEZpbmlzaGVkID0gZ3JvdXBzLmV2ZXJ5KGcgPT4gZy5pc0ZpbmlzaGVkID09PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYWxsRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kR3JvdXBNb2RlR2FtZShjdXJyZW50VGVhbVF1aXpJZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0ZUFkbWluVGVhbURhc2hib2FyZChnYW1lRGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKGdhbWVEYXRhLnN0YXR1cyA9PT0gJ3BvZGl1bScgfHwgZ2FtZURhdGEuc3RhdHVzID09PSAnZmluaXNoZWQnKSB7CiAgICAgICAgICAgICAgICBpZiAodW5zdWJzY3JpYmVUZWFtUXVpekxpc3RlbmVyKSB1bnN1YnNjcmliZVRlYW1RdWl6TGlzdGVuZXIoKTsKICAgICAgICAgICAgICAgIGRpc3BsYXlUZWFtUXVpekZpbmFsUmVzdWx0cygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGdhbWVEYXRhLm1vZGUgPT09ICdncm91cCcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG15R3JvdXAgPSBnYW1lRGF0YS5ncm91cHNbdXNlcklkXTsKICAgICAgICAgICAgICAgIGlmICghbXlHcm91cCB8fCAhbXlHcm91cC5pc0ZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAgICAgIHJlbmRlclRlYW1RdWl6UXVlc3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9CgovKioKICogW0hlbHBlciBGdW5jdGlvbl0g4Liq4Lix4LmI4LiH4LiI4Lia4LmA4LiB4Lih4Liq4Liz4Lir4Lij4Lix4LiaIEdyb3VwIE1vZGUgKEFkbWluIG9ubHkpCiAqLwphc3luYyBmdW5jdGlvbiBlbmRHcm91cE1vZGVHYW1lKGdhbWVJZCkgewogICAgY29uc29sZS5sb2coIkFsbCBncm91cHMgaGF2ZSBmaW5pc2hlZC4gRW5kaW5nIGdhbWUuIik7CiAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgZ2FtZUlkKTsKICAgIHRyeSB7CgkKCSAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZ2FtZVJlZik7CiAgICAgICAgaWYgKGdhbWVTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNvbnN0IGZpbmFsR2FtZURhdGEgPSBnYW1lU25hcC5kYXRhKCk7CiAgICAgICAgICAgIGlmIChmaW5hbEdhbWVEYXRhLnNob3VsZFNhdmVSZXN1bHRzKSB7CiAgICAgICAgICAgICAgICBhd2FpdCBzYXZlR2FtZVJlc3VsdHNBc1N1Ym1pc3Npb25zKGZpbmFsR2FtZURhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4quC4luC4suC4meC4sOC5gOC4m+C5h+C4mSBwb2RpdW0g4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4LiX4Li44LiB4LiE4LiZ4LmA4Lir4LmH4LiZ4Lir4LiZ4LmJ4Liy4Liq4Lij4Li44Lib4Lic4LilCiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAncG9kaXVtJyB9KTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGVuZCBncm91cCBtb2RlIGdhbWU6IiwgZXJyb3IpOwogICAgfQp9CgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHVwZGF0ZUFkbWluVGVhbURhc2hib2FyZCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIHVwZGF0ZUFkbWluVGVhbURhc2hib2FyZChnYW1lRGF0YSkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlYW0tcGxheWVyLXN0YXR1cy1ncmlkJyk7CiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgIGNvbnN0IG1vZGUgPSBnYW1lRGF0YS5tb2RlIHx8ICd0ZWFtJzsKICAgIGNvbnN0IHRvdGFsUXVlc3Rpb25zID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CgogICAgaWYgKG1vZGUgPT09ICdncm91cCcpIHsKICAgICAgICBjb25zdCBncm91cHMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLmdyb3VwcyB8fCB7fSk7CiAgICAgICAgaWYgKGdyb3Vwcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1jeWFuLTIwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiB4Lil4Li44LmI4Lih4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihLi4uPC9wPic7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC4quC4s+C4q+C4o+C4seC4miBHcm91cCBNb2RlIC0tLQogICAgICAgIGNvbnN0IHNvcnRlZEdyb3VwcyA9IFsuLi5ncm91cHNdLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTsKICAgICAgICBjb25zdCBncm91cFNjb3Jlc0h0bWwgPSBzb3J0ZWRHcm91cHMubWFwKChnLCBpbmRleCkgPT4gewogICAgICAgICAgICAvLyAxLiDguJnguLHguJrguIjguLPguJnguKfguJnguILguYnguK3guJfguLXguYjguIHguKXguLjguYjguKHguJnguLXguYnguJXguK3guJrguYTguJvguYHguKXguYnguKcKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25zQW5zd2VyZWQgPSBnLmFuc3dlcnM/Lmxlbmd0aCB8fCAwOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMi4g4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4Lie4Lij4LmJ4Lit4Lih4LmB4Liq4LiU4LiH4LiE4Lin4Liy4Lih4LiE4Li34Lia4Lir4LiZ4LmJ4LiyCiAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ibGFjay8yMCBwLTMgcm91bmRlZC1tZCB0cmFuc2l0aW9uLWFsbCBob3ZlcjpiZy1ibGFjay80MCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7aW5kZXggKyAxfS4g4LiB4Lil4Li44LmI4LihOiA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1jeWFuLTIwMCI+JHtnLm1lbWJlcnMuam9pbignLCAnKX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktMzAwIG1sLTIiPigke3F1ZXN0aW9uc0Fuc3dlcmVkfS8ke3RvdGFsUXVlc3Rpb25zfSDguILguYnguK0pPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXdoaXRlIj4ke2cuc2NvcmV9IOC4hOC4sOC5geC4meC4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIC8vIC0tLSBbRU5EXSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguYHguIHguYnguYTguIIgLS0tCgogICAgICAgIGNvbnN0IHF1ZXN0aW9uU3VtbWFyeUh0bWwgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgbGV0IGNvcnJlY3RHcm91cENvdW50ID0gMCwgYW5zd2VyZWRHcm91cENvdW50ID0gMDsKICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZ3JvdXAgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYW5zd2VyRm9yVGhpc1EgPSBncm91cC5hbnN3ZXJzPy5maW5kKGFucyA9PiBhbnMucXVlc3Rpb25JbmRleCA9PT0gaW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGFuc3dlckZvclRoaXNRKSB7CiAgICAgICAgICAgICAgICAgICAgYW5zd2VyZWRHcm91cENvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFuc3dlckZvclRoaXNRLmlzQ29ycmVjdCkgY29ycmVjdEdyb3VwQ291bnQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnN0IGlzQ29tcGxldGUgPSBhbnN3ZXJlZEdyb3VwQ291bnQgPiAwICYmIGFuc3dlcmVkR3JvdXBDb3VudCA9PT0gZ3JvdXBzLmxlbmd0aDsKICAgICAgICAgICAgY29uc3QgY2FyZENsYXNzID0gaXNDb21wbGV0ZSA/ICdiZy1ncmVlbi0yMDAgdGV4dC1ncmVlbi05MDAgZm9udC1ib2xkJyA6ICdiZy1ibGFjay8xMCc7CiAgICAgICAgICAgIGNvbnN0IHN0YXR1c0ljb24gPSBpc0NvbXBsZXRlID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtZ3JlZW4tNzAwIG1sLTEiPjwvaT4nIDogJyc7CiAgICAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0icC0yIHJvdW5kZWQtbWQgJHtjYXJkQ2xhc3N9Ij48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+PHNwYW4+4LiC4LmJ4LitICR7aW5kZXggKyAxfTo8L3NwYW4+PHNwYW4+JHtzdGF0dXNJY29ufTwvc3Bhbj48L3A+PHAgY2xhc3M9InRleHQteHMiPuC4leC4reC4muC4luC4ueC4gSAke2NvcnJlY3RHcm91cENvdW50fS8ke2dyb3Vwcy5sZW5ndGh9IOC4geC4peC4uOC5iOC4oTwvcD48L2Rpdj5gOwogICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNCI+PGRpdj48aDQgY2xhc3M9ImZvbnQtYm9sZCBtYi0yIj7guKrguKPguLjguJvguITguLDguYHguJnguJnguIHguKXguLjguYjguKE8L2g0PjxkaXYgY2xhc3M9InNwYWNlLXktMiB0ZXh0LWxnIj4ke2dyb3VwU2NvcmVzSHRtbH08L2Rpdj48L2Rpdj48ZGl2PjxoNCBjbGFzcz0iZm9udC1ib2xkIG1iLTIiPuC4quC4o+C4uOC4m+C4o+C4suC4ouC4guC5ieC4rTwvaDQ+PGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMiBsZzpncmlkLWNvbHMtMyBnYXAtMiI+JHtxdWVzdGlvblN1bW1hcnlIdG1sfTwvZGl2PjwvZGl2PjwvZGl2PmA7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICAvLyAtLS0gTG9naWMgZm9yIFRlYW0gTW9kZSAo4LmE4Lih4LmI4Lih4Li14LiB4Liy4Lij4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmB4Lib4Lil4LiHKSAtLS0KICAgIGNvbnN0IHJlc3BvbnNlcyA9IGdhbWVEYXRhLnJlc3BvbnNlcyB8fCB7fTsKICAgIGNvbnN0IHBsYXllcnMgPSBPYmplY3Qua2V5cyhyZXNwb25zZXMpOwogICAgaWYgKHBsYXllcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1jeWFuLTIwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihLi4uPC9wPic7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcGxheWVyU2NvcmVzID0gcGxheWVycy5tYXAobmFtZSA9PiAoeyBuYW1lLCBzY29yZTogcmVzcG9uc2VzW25hbWVdLnNjb3JlIHx8IDAgfSkpLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTsKICAgIGNvbnN0IHBsYXllclNjb3Jlc0h0bWwgPSBwbGF5ZXJTY29yZXMubWFwKHAgPT4gewogICAgICAgIGNvbnN0IHR1cm5zVGFrZW4gPSByZXNwb25zZXNbcC5uYW1lXT8uYW5zd2Vycz8ubGVuZ3RoIHx8IDA7CiAgICAgICAgY29uc3QgdG90YWxUdXJuc0ZvclBsYXllciA9IE1hdGguY2VpbCh0b3RhbFF1ZXN0aW9ucyAvIHBsYXllcnMubGVuZ3RoKTsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBiZy1ibGFjay8yMCBwLTIgcm91bmRlZC1tZCI+PHNwYW4+JHtwLm5hbWV9IDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS0zMDAiPigke3R1cm5zVGFrZW59LyR7dG90YWxUdXJuc0ZvclBsYXllcn0g4LiV4LiyKTwvc3Bhbj48L3NwYW4+PHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtwLnNjb3JlfSDguITguLDguYHguJnguJk8L3NwYW4+PC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwogICAgY29uc3QgdG90YWxBbnN3ZXJzU3VibWl0dGVkID0gcGxheWVycy5yZWR1Y2UoKHN1bSwgbmFtZSkgPT4gc3VtICsgKHJlc3BvbnNlc1tuYW1lXS5hbnN3ZXJzPy5sZW5ndGggfHwgMCksIDApOwogICAgY29uc3QgcXVlc3Rpb25TdW1tYXJ5SHRtbCA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubWFwKChxLCBpbmRleCkgPT4gewogICAgICAgIGxldCBhbnN3ZXJEYXRhID0gbnVsbCwgcGxheWVyTmFtZSA9IG51bGw7CiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIHBsYXllcnMpIHsKICAgICAgICAgICAgY29uc3QgZm91bmRBbnN3ZXIgPSByZXNwb25zZXNbbmFtZV0uYW5zd2Vycz8uZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gaW5kZXgpOwogICAgICAgICAgICBpZiAoZm91bmRBbnN3ZXIpIHsKICAgICAgICAgICAgICAgIGFuc3dlckRhdGEgPSBmb3VuZEFuc3dlcjsKICAgICAgICAgICAgICAgIHBsYXllck5hbWUgPSBuYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgaXNBbnN3ZXJlZCA9ICEhYW5zd2VyRGF0YTsKICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBpc0Fuc3dlcmVkICYmIGFuc3dlckRhdGEuaXNDb3JyZWN0OwogICAgICAgIGNvbnN0IHJvdW5kRW5kSW5kZXggPSAoTWF0aC5mbG9vcihpbmRleCAvIHBsYXllcnMubGVuZ3RoKSArIDEpICogcGxheWVycy5sZW5ndGg7CiAgICAgICAgY29uc3QgaXNDb21wbGV0ZSA9IHRvdGFsQW5zd2Vyc1N1Ym1pdHRlZCA+PSByb3VuZEVuZEluZGV4OwogICAgICAgIGNvbnN0IGNhcmRDbGFzcyA9IGlzQ29tcGxldGUgPyAnYmctZ3JlZW4tMjAwIHRleHQtZ3JlZW4tOTAwJyA6ICdiZy1ibGFjay8xMCc7CiAgICAgICAgY29uc3Qgc3RhdHVzSWNvbiA9IGlzQ29tcGxldGUgPyAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgdGV4dC1ncmVlbi03MDAgbWwtMSI+PC9pPicgOiAnJzsKICAgICAgICBsZXQgc3VtbWFyeVRleHQgPSAn4Lij4LitLi4uJzsKICAgICAgICBpZiAoaXNBbnN3ZXJlZCkgewogICAgICAgICAgICBzdW1tYXJ5VGV4dCA9IGAke3BsYXllck5hbWV9IOC4leC4reC4miR7aXNDb3JyZWN0ID8gJ+C4luC4ueC4gScgOiAn4Lic4Li04LiUJ31gOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InAtMiByb3VuZGVkLW1kICR7Y2FyZENsYXNzfSI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPjxzcGFuPuC4guC5ieC4rSAke2luZGV4ICsgMX06PC9zcGFuPjxzcGFuPiR7c3RhdHVzSWNvbn08L3NwYW4+PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtbm9ybWFsIj4ke3N1bW1hcnlUZXh0fTwvcD48L2Rpdj5gOwogICAgfSkuam9pbignJyk7CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTYiPjxkaXY+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4LiE4Liw4LmB4LiZ4LiZ4Lij4Lin4LihICjguKPguLLguKLguJrguLjguITguITguKUpPC9oND48ZGl2IGNsYXNzPSJzcGFjZS15LTEgdGV4dC1sZyI+JHtwbGF5ZXJTY29yZXNIdG1sfTwvZGl2PjwvZGl2PjxkaXY+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4Lij4Liy4Lii4LiC4LmJ4LitPC9oND48ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0yIG1kOmdyaWQtY29scy0zIGdhcC0yIj4ke3F1ZXN0aW9uU3VtbWFyeUh0bWx9PC9kaXY+PC9kaXY+PC9kaXY+YDsKfQoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyA9PT0gW+C5gOC4nuC4tOC5iOC4oV0g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Liq4Liz4Lir4Lij4Lix4LiaIFRlYW0gUXVpeiAo4Lid4Lix4LmI4LiHIFN0dWRlbnQpID09PQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLyoqCiAqIOC5gOC4o+C4tOC5iOC4oeC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C5gOC4guC5ieC4suC4o+C5iOC4p+C4oSBUZWFtIFF1aXogKFN0dWRlbnQpCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVKb2luVGVhbVF1aXooKSB7CiAgICBjb25zdCBwaW4gPSBwcm9tcHQoIuC4geC4o+C4uOC4k+C4suC4m+C5ieC4reC4meC4o+C4q+C4seC4qiBUZWFtIFF1aXogKDQg4Lir4Lil4Lix4LiBKToiKTsKICAgIGlmICghcGluIHx8IHBpbi50cmltKCkubGVuZ3RoICE9PSA0KSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4o+C4q+C4seC4quC5hOC4oeC5iOC4luC4ueC4geC4leC5ieC4reC4hyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IHF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHF1aXp6ZXNSZWYsIHdoZXJlKCJwaW4iLCAiPT0iLCBwaW4udHJpbSgpKSwgd2hlcmUoInN0YXR1cyIsICI9PSIsICJsb2JieSIpKTsKICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CgogICAgICAgIGlmIChzbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4LiaIFRlYW0gUXVpeiDguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYkg4Lir4Lij4Li34Lit4LiB4Li04LiI4LiB4Lij4Lij4Lih4LmE4LiU4LmJ4LmA4Lij4Li04LmI4Lih4LmE4Lib4LmB4Lil4LmJ4LinIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGdhbWVEb2MgPSBzbmFwc2hvdC5kb2NzWzBdOwogICAgICAgIGN1cnJlbnRUZWFtUXVpeklkID0gZ2FtZURvYy5pZDsKICAgICAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVEb2MuZGF0YSgpOwoKICAgICAgICAvLyDguJTguLbguIfguILguYnguK3guKHguLnguKUgUHJvamVjdCDguYHguKXguLAgUXVpeiDguJfguLXguYjguYDguIHguLXguYjguKLguKfguILguYnguK3guIcKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgZ2FtZURhdGEucHJvamVjdElkKTsKICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgICAgIGNvbnN0IFtwcm9qZWN0U25hcCwgcXVpelNuYXBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2dldERvYyhwcm9qZWN0UmVmKSwgZ2V0RG9jKHF1aXpSZWYpXSk7CgogICAgICAgIGlmICghcHJvamVjdFNuYXAuZXhpc3RzKCkgfHwgIXF1aXpTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmC4Lib4Lij4LmA4LiI4LiE4Lir4Lij4Li34Lit4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAgICAgfQoKICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXooeyBpZDogcXVpelNuYXAuaWQsIC4uLnF1aXpTbmFwLmRhdGEoKSB9KTsKICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IHByb2plY3RTbmFwLmRhdGEoKTsKCiAgICAgICAgLy8g4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4Lil4Li34Lit4LiB4Lic4Li54LmJ4LmA4Lil4LmI4LiZCiAgICAgICAgc2hvd1RlYW1QbGF5ZXJTZWxlY3Rpb24ocHJvamVjdERhdGEuc3R1ZGVudHMsIGN1cnJlbnRRdWl6RGF0YS50b3BpYyk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBqb2luaW5nIHRlYW0gcXVpejoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfQp9CgovLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguITguYjguLIgUElOIOC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4geC4o+C4reC4gQpsZXQgY3VycmVudElucHV0UGluID0gIiI7CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJvguLTguJQgTW9kYWwg4LmB4LiX4LiZ4LiB4Liy4Lij4LmD4LiK4LmJIHByb21wdApmdW5jdGlvbiBoYW5kbGVKb2luR3JvdXBBY3Rpdml0eSgpIHsKICAgIGN1cnJlbnRJbnB1dFBpbiA9ICIiOyAvLyDguKPguLXguYDguIvguYfguJXguITguYjguLIKICAgIHVwZGF0ZVBpbkRpc3BsYXkoKTsgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4Lir4LiZ4LmJ4Liy4LiI4LitCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGluLWVudHJ5LW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4reC4seC4m+C5gOC4lOC4leC4q+C4meC5ieC4suC4iOC4rSBQSU4gKOC4iOC4uOC4lOC5hiDguKvguKPguLfguK0g4LiV4Lix4Lin4LmA4Lil4LiCKQpmdW5jdGlvbiB1cGRhdGVQaW5EaXNwbGF5KCkgewogICAgY29uc3QgYm94ZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGluLWRpZ2l0LWJveCcpOwogICAgYm94ZXMuZm9yRWFjaCgoYm94LCBpbmRleCkgPT4gewogICAgICAgIGlmIChpbmRleCA8IGN1cnJlbnRJbnB1dFBpbi5sZW5ndGgpIHsKICAgICAgICAgICAgYm94LnRleHRDb250ZW50ID0gY3VycmVudElucHV0UGluW2luZGV4XTsKICAgICAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoJ2JvcmRlci1pbmRpZ28tNTAwJywgJ2JnLXdoaXRlJyk7CiAgICAgICAgICAgIGJveC5jbGFzc0xpc3QucmVtb3ZlKCdib3JkZXItZ3JheS0zMDAnLCAnYmctZ3JheS01MCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJveC50ZXh0Q29udGVudCA9ICIiOwogICAgICAgICAgICBib3guY2xhc3NMaXN0LnJlbW92ZSgnYm9yZGVyLWluZGlnby01MDAnLCAnYmctd2hpdGUnKTsKICAgICAgICAgICAgYm94LmNsYXNzTGlzdC5hZGQoJ2JvcmRlci1ncmF5LTMwMCcsICdiZy1ncmF5LTUwJyk7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4oeC4t+C5iOC4reC4geC4lOC4m+C4uOC5iOC4oeC4leC4seC4p+C5gOC4peC4ggphc3luYyBmdW5jdGlvbiBoYW5kbGVQaW5LZXlQcmVzcyhrZXkpIHsKICAgIGlmIChrZXkgPT09ICdiYWNrc3BhY2UnKSB7CiAgICAgICAgY3VycmVudElucHV0UGluID0gY3VycmVudElucHV0UGluLnNsaWNlKDAsIC0xKTsKICAgIH0gZWxzZSBpZiAoY3VycmVudElucHV0UGluLmxlbmd0aCA8IDQpIHsKICAgICAgICBjdXJyZW50SW5wdXRQaW4gKz0ga2V5OwogICAgfQoKICAgIHVwZGF0ZVBpbkRpc3BsYXkoKTsKCiAgICAvLyDguJbguYnguLLguIHguKPguK3guIHguITguKPguJogNCDguKvguKXguLHguIEg4LmD4Lir4LmJ4Liq4LmI4LiH4LiX4Lix4LiZ4LiX4Li1IChBdXRvLXN1Ym1pdCkKICAgIGlmIChjdXJyZW50SW5wdXRQaW4ubGVuZ3RoID09PSA0KSB7CiAgICAgICAgLy8g4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4Liy4LiZ4Li04LiU4LiZ4Li24LiH4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4Lic4Li54LmJ4LmD4LiK4LmJ4LmA4Lir4LmH4LiZ4LmA4Lil4LiC4LiV4Lix4Lin4Liq4Li44LiU4LiX4LmJ4Liy4Lii4LiB4LmI4Lit4LiZCiAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaW4tZW50cnktbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgYXdhaXQgcHJvY2Vzc0pvaW5XaXRoUGluKGN1cnJlbnRJbnB1dFBpbik7CiAgICAgICAgICAgIGN1cnJlbnRJbnB1dFBpbiA9ICIiOyAvLyDguKPguLXguYDguIvguYfguJUKICAgICAgICAgICAgdXBkYXRlUGluRGlzcGxheSgpOwogICAgICAgIH0sIDMwMCk7CiAgICB9Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4quC4s+C4q+C4o+C4seC4muC4m+C4o+C4sOC4oeC4p+C4peC4nOC4peC4geC4suC4o+C5gOC4guC5ieC4suC4o+C5iOC4p+C4oSAo4Lii4LmJ4Liy4LiiIExvZ2ljIOC5gOC4lOC4tOC4oeC4oeC4suC5hOC4p+C5ieC4l+C4teC5iOC4meC4teC5iCkKYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0pvaW5XaXRoUGluKHBpbikgewogICAgY29uc3QgdHJpbW1lZFBpbiA9IHBpbi50cmltKCk7CiAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LiE4LmJ4LiZ4Lir4Liy4LiB4Li04LiI4LiB4Lij4Lij4LihLi4uIik7CgogICAgdHJ5IHsKICAgICAgICAvLyAxLiDguITguYnguJnguKvguLLguYPguJkgVGVhbSBRdWl6emVzCiAgICAgICAgY29uc3QgdGVhbVF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCk7CiAgICAgICAgY29uc3QgdGVhbVF1ZXJ5ID0gcXVlcnkodGVhbVF1aXp6ZXNSZWYsIHdoZXJlKCJwaW4iLCAiPT0iLCB0cmltbWVkUGluKSwgd2hlcmUoInN0YXR1cyIsICI9PSIsICJsb2JieSIpKTsKICAgICAgICBjb25zdCB0ZWFtU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHRlYW1RdWVyeSk7CgogICAgICAgIGlmICghdGVhbVNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCLguJ7guJogVGVhbSBRdWl6ISIpOwogICAgICAgICAgICBhd2FpdCBwcm9jZWVkV2l0aFRlYW1RdWl6Sm9pbih0ZWFtU25hcHNob3QuZG9jc1swXSk7CiAgICAgICAgICAgIHJldHVybjsgCiAgICAgICAgfQoKICAgICAgICAvLyAyLiDguITguYnguJnguKvguLLguYPguJkgU3luYyBHYW1lcwogICAgICAgIGNvbnN0IHN5bmNHYW1lc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCk7CiAgICAgICAgY29uc3Qgc3luY1F1ZXJ5ID0gcXVlcnkoc3luY0dhbWVzUmVmLCB3aGVyZSgicGluIiwgIj09IiwgdHJpbW1lZFBpbiksIHdoZXJlKCJzdGF0dXMiLCAiaW4iLCBbImxvYmJ5IiwgInF1ZXN0aW9uIiwgInN1bW1hcnkiLCAicmVzdWx0cyJdKSk7CiAgICAgICAgY29uc3Qgc3luY1NuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhzeW5jUXVlcnkpOwoKICAgICAgICBpZiAoIXN5bmNTbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygi4Lie4LiaIFN5bmMgR2FtZSEiKTsKICAgICAgICAgICAgYXdhaXQgcHJvY2VlZFdpdGhTeW5jUXVpekpvaW4oc3luY1NuYXBzaG90LmRvY3NbMF0pOwogICAgICAgICAgICByZXR1cm47IAogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAzLiDguJbguYnguLLguYTguKHguYjguYDguIjguK0KICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LiB4Li04LiI4LiB4Lij4Lij4Lih4LiU4LmJ4Lin4Lii4Lij4Lir4Lix4Liq4LiZ4Li14LmJIOC4q+C4o+C4t+C4reC4geC4tOC4iOC4geC4o+C4o+C4oeC4reC4suC4iOC5gOC4o+C4tOC5iOC4oeC5hOC4m+C5geC4peC5ieC4pyIpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyBhY3Rpdml0eToiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4iuC4t+C5iOC4reC4oeC4leC5iOC4rTogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBwcm9jZWVkV2l0aFRlYW1RdWl6Sm9pbihnYW1lRG9jKSB7CiAgICBjdXJyZW50VGVhbVF1aXpJZCA9IGdhbWVEb2MuaWQ7CiAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVEb2MuZGF0YSgpOwogICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGdhbWVEYXRhLnByb2plY3RJZCk7CiAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgY29uc3QgW3Byb2plY3RTbmFwLCBxdWl6U25hcF0gPSBhd2FpdCBQcm9taXNlLmFsbChbZ2V0RG9jKHByb2plY3RSZWYpLCBnZXREb2MocXVpelJlZildKTsKCiAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpIHx8ICFxdWl6U25hcC5leGlzdHMoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmC4Lib4Lij4LmA4LiI4LiE4Lir4Lij4Li34Lit4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICB9CiAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXooeyBpZDogcXVpelNuYXAuaWQsIC4uLnF1aXpTbmFwLmRhdGEoKSB9KTsKICAgIHNob3dUZWFtUGxheWVyU2VsZWN0aW9uKHByb2plY3RTbmFwLmRhdGEoKS5zdHVkZW50cywgY3VycmVudFF1aXpEYXRhLnRvcGljLCBnYW1lRGF0YS5tb2RlIHx8ICd0ZWFtJyk7IC8vIOC4quC5iOC4hyBtb2RlIOC5gOC4guC5ieC4suC5hOC4m+C4lOC5ieC4p+C4ogogICAgbWVzc2FnZU1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9Cgphc3luYyBmdW5jdGlvbiBwcm9jZWVkV2l0aFN5bmNRdWl6Sm9pbihnYW1lRG9jKSB7CiAgICBjdXJyZW50TGl2ZUdhbWVJZCA9IGdhbWVEb2MuaWQ7CiAgICBjb25zdCBnYW1lRGF0YSA9IGdhbWVEb2MuZGF0YSgpOwogICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZ2FtZURhdGEucXVpeklkKTsKICAgIGNvbnN0IHF1aXpTbmFwID0gYXdhaXQgZ2V0RG9jKHF1aXpSZWYpOwogICAgaWYgKCFxdWl6U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgIAogICAgY29uc3QgcXVpekRhdGEgPSBxdWl6U25hcC5kYXRhKCk7CiAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgcXVpekRhdGEucHJvamVjdElkKTsKICAgIGNvbnN0IHByb2plY3RTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwogICAgaWYgKCFwcm9qZWN0U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYLguJvguKPguYDguIjguIQiKTsKICAgIAogICAgY3VycmVudFF1aXpEYXRhID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6OwogICAgCiAgICBzaG93Vmlldygnc3R1ZGVudC10ZWFtLWpvaW4nKTsKICAgIHNob3dUZWFtUGxheWVyU2VsZWN0aW9uKHByb2plY3RTbmFwLmRhdGEoKS5zdHVkZW50cywgcXVpekRhdGEudG9waWMsICdzeW5jJyk7IC8vIOC4quC5iOC4hyBtb2RlICdzeW5jJyDguYDguILguYnguLLguYTguJsKICAgIAogICAgLy8gLS0tIFsgU1RBUlQ6IOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBCdWcgTGlzdGVuZXIg4LiX4Lix4Lia4LiL4LmJ4Lit4LiZIF0gLS0tCiAgICAKICAgIC8vIDEuIOC4hOC5ieC4meC4q+C4suC4m+C4uOC5iOC4oeC5gOC4lOC4tOC4oQogICAgY29uc3Qgb2xkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tdGVhbS1wbGF5ZXJzLWJ0bicpOwogICAgCiAgICAvLyAyLiDguYLguITguKXguJnguJvguLjguYjguKEgKOC4geC4suC4o+C5guC4hOC4peC4meC4iOC4sOC4peC4miBFdmVudCBMaXN0ZW5lcnMg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Li14LmI4LiV4Li04LiU4Lih4Liy4LiB4Lix4Lia4Lib4Li44LmI4Lih4LmA4LiB4LmI4LiyKQogICAgY29uc3QgbmV3QnRuID0gb2xkQnRuLmNsb25lTm9kZSh0cnVlKTsKICAgIAogICAgLy8gMy4g4LiZ4Liz4Lib4Li44LmI4Lih4LmD4Lir4Lih4LmIICjguJfguLXguYjguKrguLDguK3guLLguJTguYHguKXguYnguKcpIOC5hOC4m+C5geC4l+C4meC4l+C4teC5iOC4m+C4uOC5iOC4oeC5gOC4geC5iOC4suC5g+C4meC4q+C4meC5ieC4suC5gOC4p+C5h+C4mgogICAgb2xkQnRuLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld0J0biwgb2xkQnRuKTsKICAgIAogICAgLy8gNC4g4Lic4Li54LiBIEV2ZW50IExpc3RlbmVyIOC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyAo4LmA4Lie4Li14Lii4LiH4Lit4Lix4LiZ4LmA4LiU4Li14Lii4LinKSDguYPguKvguYnguIHguLHguJrguJvguLjguYjguKHguYPguKvguKHguYgKICAgIG5ld0J0bi5vbmNsaWNrID0gY29uZmlybUFuZEpvaW5TeW5jR2FtZTsgCiAgICAKICAgIC8vIC0tLSBbIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCgogICAgbWVzc2FnZU1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgcG9wLXVwICLguIHguLPguKXguLHguIfguITguYnguJnguKvguLIiCn0KCmZ1bmN0aW9uIGdldENsZWFuQXBwbGljYXRpb25IVE1MKCkgewogICAgY29uc3QgYXBwbGljYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwbGljYXRpb25Db250ZW50Jyk7CiAgICBpZiAoIWFwcGxpY2F0aW9uQ29udGFpbmVyKSByZXR1cm4gJyc7CgogICAgLy8g4Liq4Lij4LmJ4Liy4LiH4Liq4Liz4LmA4LiZ4Liy4LiC4Lit4LiHIEVsZW1lbnQg4LiC4Li24LmJ4LiZ4Lih4Liy4LmD4LiZ4Lir4LiZ4LmI4Lin4Lii4LiE4Lin4Liy4Lih4LiI4LizIOC5gOC4nuC4t+C5iOC4reC5hOC4oeC5iOC5g+C4q+C5ieC4geC4o+C4sOC4l+C4muC4q+C4meC5ieC4suC4iOC4reC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC5gOC4q+C5h+C4meC4reC4ouC4ueC5iAogICAgY29uc3QgY2xvbmUgPSBhcHBsaWNhdGlvbkNvbnRhaW5lci5jbG9uZU5vZGUodHJ1ZSk7CgogICAgLy8g4LiE4LmJ4LiZ4Lir4Liy4Lib4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4Liq4Liz4LmA4LiZ4LiyIOC5geC4peC5ieC4p+C4peC5ieC4suC4h+C4quC4luC4suC4meC4sOC4reC4reC4gQogICAgY2xvbmUucXVlcnlTZWxlY3RvckFsbCgnLmFwcGxpY2F0aW9uLW9wdGlvbnMgYnV0dG9uJykuZm9yRWFjaChidXR0b24gPT4gewogICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdjb3JyZWN0JywgJ2luY29ycmVjdCcpOwogICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgfSk7CgogICAgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4Lib4LmH4LiZIEhUTUwg4LiX4Li14LmI4Liq4Liw4Lit4Liy4LiU4LmB4Lil4LmJ4LinCiAgICByZXR1cm4gY2xvbmUuaW5uZXJIVE1MOwp9CgpmdW5jdGlvbiBzaG93VGVhbVBsYXllclNlbGVjdGlvbihzdHVkZW50cywgdG9waWMsIG1vZGUgPSAndGVhbScpIHsKICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRKb2luR2FtZVZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC10ZWFtLXNlbGVjdGlvbi12aWV3JykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8g4Lij4Li14LmA4LiL4LmH4LiV4Lil4Liz4LiU4Lix4Lia4LiB4Liy4Lij4LmA4Lil4Li34Lit4LiB4LiX4Li44LiB4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiZ4Li14LmJCiAgICBvcmRlcmVkUGxheWVyU2VsZWN0aW9uID0gW107CgogICAgbGV0IG1vZGVUaXRsZSA9ICdUZWFtIFF1aXonOyAKICAgIGlmIChtb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgbW9kZVRpdGxlID0gJ0dyb3VwIE1vZGUnOwogICAgfSBlbHNlIGlmIChtb2RlID09PSAnc3luYycpIHsKICAgICAgICBtb2RlVGl0bGUgPSAnU3luYyBNb2RlJzsKICAgIH0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZWFtLXF1aXotdG9waWMnKS50ZXh0Q29udGVudCA9IGAke21vZGVUaXRsZX06ICR7dG9waWN9YDsKCiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlYW0tc3R1ZGVudC1saXN0Jyk7CiAgICBpZiAoIXN0dWRlbnRzIHx8IHN0dWRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGxpc3RDb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIj7guYLguJvguKPguYDguIjguITguJnguLXguYnguKLguLHguIfguYTguKHguYjguKHguLXguJnguLHguIHguYDguKPguLXguKLguJk8L3A+JzsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS10ZWFtLXBsYXllcnMtYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDguKrguKPguYnguLLguIfguKPguLLguKLguIHguLLguKPguJ7guKPguYnguK3guKEgQmFkZ2Ug4Liq4Liz4Lir4Lij4Lix4Lia4LmB4Liq4LiU4LiH4LmA4Lil4LiC4Lil4Liz4LiU4Lix4LiaICjguIvguYjguK3guJnguYTguKfguYnguIHguYjguK3guJkpCiAgICBsaXN0Q29udGFpbmVyLmlubmVySFRNTCA9IHN0dWRlbnRzLm1hcChuYW1lID0+IGAKICAgICAgICA8bGFiZWwgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBwLTMgcm91bmRlZC1tZCBob3ZlcjpiZy1ncmF5LTEwMCBjdXJzb3ItcG9pbnRlciBib3JkZXIgYm9yZGVyLXRyYW5zcGFyZW50IGhvdmVyOmJvcmRlci1ncmF5LTIwMCB0cmFuc2l0aW9uLWFsbCBzZWxlY3Qtbm9uZSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0idGVhbV9wbGF5ZXIiIHZhbHVlPSIke25hbWV9IiBjbGFzcz0iaC01IHctNSByb3VuZGVkIGJvcmRlci1ncmF5LTMwMCB0ZXh0LWN5YW4tNjAwIGZvY3VzOnJpbmctY3lhbi01MDAgbXItMyI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1sZyB0ZXh0LWdyYXktNzAwIj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im9yZGVyLWJhZGdlIGJnLWluZGlnby02MDAgdGV4dC13aGl0ZSB0ZXh0LXhzIGZvbnQtYm9sZCBweC0yIHB5LTEgcm91bmRlZC1mdWxsIGhpZGRlbiBzaGFkb3ctc20iPjwvc3Bhbj4KICAgICAgICA8L2xhYmVsPgogICAgYCkuam9pbignJyk7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXRlYW0tcGxheWVycy1idG4nKS5kaXNhYmxlZCA9IGZhbHNlOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguIHguLHguJogQ2hlY2tib3gg4LiX4Li44LiB4LiV4Lix4LinCiAgICBjb25zdCBjaGVja2JveGVzID0gbGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJ0ZWFtX3BsYXllciJdJyk7CiAgICBjaGVja2JveGVzLmZvckVhY2goY2IgPT4gewogICAgICAgIGNiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHZhbCA9IGUudGFyZ2V0LnZhbHVlOwogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmA4Lil4Li34Lit4LiBIC0+IOC5gOC4nuC4tOC5iOC4oeC4leC5iOC4reC4l+C5ieC4suC4ouC5g+C4meC4reC4suC5gOC4o+C4ouC5jAogICAgICAgICAgICAgICAgaWYgKCFvcmRlcmVkUGxheWVyU2VsZWN0aW9uLmluY2x1ZGVzKHZhbCkpIHsKICAgICAgICAgICAgICAgICAgICBvcmRlcmVkUGxheWVyU2VsZWN0aW9uLnB1c2godmFsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5gOC4reC4suC4reC4reC4gSAtPiDguKXguJrguK3guK3guIHguIjguLLguIHguK3guLLguYDguKPguKLguYwKICAgICAgICAgICAgICAgIG9yZGVyZWRQbGF5ZXJTZWxlY3Rpb24gPSBvcmRlcmVkUGxheWVyU2VsZWN0aW9uLmZpbHRlcihwID0+IHAgIT09IHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiV4Lix4Lin4LmA4Lil4LiC4Lil4Liz4LiU4Lix4Lia4Lia4LiZ4Lir4LiZ4LmJ4Liy4LiI4LitCiAgICAgICAgICAgIHVwZGF0ZVNlbGVjdGlvbk9yZGVyVmlzdWFscyhsaXN0Q29udGFpbmVyKTsKICAgICAgICB9KTsKICAgIH0pOwp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguIrguYjguKfguKLguYHguKrguJTguIfguJXguLHguKfguYDguKXguILguKXguLPguJTguLHguJoKZnVuY3Rpb24gdXBkYXRlU2VsZWN0aW9uT3JkZXJWaXN1YWxzKGNvbnRhaW5lcikgewogICAgY29uc3QgY2hlY2tib3hlcyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJ0ZWFtX3BsYXllciJdJyk7CiAgICBjaGVja2JveGVzLmZvckVhY2goY2IgPT4gewogICAgICAgIGNvbnN0IGxhYmVsID0gY2IuY2xvc2VzdCgnbGFiZWwnKTsKICAgICAgICBjb25zdCBiYWRnZSA9IGxhYmVsLnF1ZXJ5U2VsZWN0b3IoJy5vcmRlci1iYWRnZScpOwogICAgICAgIAogICAgICAgIGlmIChjYi5jaGVja2VkKSB7CiAgICAgICAgICAgIC8vIOC4q+C4suC4p+C5iOC4suC4iuC4t+C5iOC4reC4meC4teC5ieC4reC4ouC4ueC5iOC4reC4seC4meC4lOC4seC4muC4l+C4teC5iOC5gOC4l+C5iOC4suC5hOC4q+C4o+C5iOC5g+C4meC4reC4suC5gOC4o+C4ouC5jAogICAgICAgICAgICBjb25zdCBpbmRleCA9IG9yZGVyZWRQbGF5ZXJTZWxlY3Rpb24uaW5kZXhPZihjYi52YWx1ZSk7CiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICAgIGJhZGdlLnRleHRDb250ZW50ID0gYOC4hOC4meC4l+C4teC5iCAke2luZGV4ICsgMX1gOwogICAgICAgICAgICAgICAgYmFkZ2UuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJnguKrguLXguJ7guLfguYnguJnguKvguKXguLHguIcgbGFiZWwg4LmD4Lir4LmJ4LiU4Li5IGFjdGl2ZQogICAgICAgICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LmFkZCgnYmctaW5kaWdvLTUwJywgJ2JvcmRlci1pbmRpZ28tMjAwJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiYWRnZS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgbGFiZWwuY2xhc3NMaXN0LnJlbW92ZSgnYmctaW5kaWdvLTUwJywgJ2JvcmRlci1pbmRpZ28tMjAwJyk7CiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1BbmRTdGFydFRlYW1RdWl6KCkgewogICAgLy8g4LmD4LiK4LmJ4Lij4Liy4Lii4LiK4Li34LmI4Lit4LiI4Liy4LiB4LiV4Lix4Lin4LmB4Lib4Lij4LiX4Li14LmI4LmA4Lij4Li14Lii4LiH4Lil4Liz4LiU4Lix4Lia4LmE4Lin4LmJ4LmB4Lil4LmJ4LinCiAgICBjb25zdCBzZWxlY3RlZFBsYXllcnMgPSBbLi4ub3JkZXJlZFBsYXllclNlbGVjdGlvbl07CgogICAgaWYgKHNlbGVjdGVkUGxheWVycy5sZW5ndGggPT09IDApIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4Lit4Lii4LmI4Liy4LiH4LiZ4LmJ4Lit4LiiIDEg4LiE4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICAvLyDguKPguLXguYDguIvguYfguJXguJXguLHguKfguJnguLHguJrguJfguLHguYnguIfguKvguKHguJQKICAgIGxvY2FsVGVhbVBsYXllcnMgPSBzZWxlY3RlZFBsYXllcnM7IC8vIOC4peC4s+C4lOC4seC4muC5g+C4meC4meC4teC5ieC4iOC4sOC4geC4s+C4q+C4meC4lOC4peC4s+C4lOC4seC4muC4geC4suC4o+C5gOC4peC5iOC4mQogICAgbG9jYWxRdWVzdGlvbkluZGV4ID0gMDsKICAgIGxvY2FsUGxheWVySW5kZXggPSAwOwoJCiAgICBjb25zdCB0ZWFtUXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2ModGVhbVF1aXpSZWYpOwogICAgICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkpIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4LihIik7CiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lU25hcC5kYXRhKCk7CgogICAgICAgIGlmIChnYW1lRGF0YS5tb2RlID09PSAnZ3JvdXAnKSB7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwUGF5bG9hZCA9IHsgW2Bncm91cHMuJHt1c2VySWR9YF06IHsgbWVtYmVyczogbG9jYWxUZWFtUGxheWVycywgc2NvcmU6IDAsIGFuc3dlcnM6IFtdIH0gfTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHRlYW1RdWl6UmVmLCBncm91cFBheWxvYWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGluaXRpYWxSZXNwb25zZXMgPSBnYW1lRGF0YS5yZXNwb25zZXMgfHwge307CiAgICAgICAgICAgIGxvY2FsVGVhbVBsYXllcnMuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICAgICAgICAgIGlmICghaW5pdGlhbFJlc3BvbnNlc1tuYW1lXSkgewogICAgICAgICAgICAgICAgICAgIGluaXRpYWxSZXNwb25zZXNbbmFtZV0gPSB7IHNjb3JlOiAwLCBhbnN3ZXJzOiBbXSB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHRlYW1RdWl6UmVmLCB7IHJlc3BvbnNlczogaW5pdGlhbFJlc3BvbnNlcyB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtdGVhbS1zZWxlY3Rpb24tdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHJlbmRlclRlYW1RdWl6UXVlc3Rpb24oKTsKICAgICAgICAKICAgICAgICBjb25zdCBnYW1lU3RhdGUgPSB7IGdhbWVJZDogY3VycmVudFRlYW1RdWl6SWQsIG1vZGU6IGdhbWVEYXRhLm1vZGUgfHwgJ3RlYW0nLCBwbGF5ZXJzOiBsb2NhbFRlYW1QbGF5ZXJzLCB0dXJuSW5kZXg6IDAgfTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicsIEpTT04uc3RyaW5naWZ5KGdhbWVTdGF0ZSkpOwogICAgICAgIGxpc3RlbkZvclRlYW1RdWl6VXBkYXRlcygpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY29uZmlybWluZyBwbGF5ZXJzOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lii4Li34LiZ4Lii4Lix4LiZ4Lic4Li54LmJ4LmA4Lil4LmI4LiZIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgcmVuZGVyVGVhbVF1aXpRdWVzdGlvbiDguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIHJlbmRlclRlYW1RdWl6UXVlc3Rpb24oKSB7CiAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJfguLPguITguKPguJrguJfguLjguIHguILguYnguK3guKvguKPguLfguK3guKLguLHguIcKICAgIGlmIChsb2NhbFF1ZXN0aW9uSW5kZXggPj0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICBkaXNwbGF5VGVhbVF1aXpGaW5hbFJlc3VsdHMoKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICAKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4luC4suC4oeC5geC4peC4sOC4nOC4ueC5ieC5gOC4peC5iOC4meC4leC4suC4oeC4o+C4reC4muC4m+C4seC4iOC4iOC4uOC4muC4seC4mQogICAgY29uc3QgcSA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbbG9jYWxRdWVzdGlvbkluZGV4XTsKICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXJOYW1lID0gbG9jYWxUZWFtUGxheWVyc1tsb2NhbFBsYXllckluZGV4XTsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWl6VHlwZTsKICAgIGxldCBxdWVzdGlvblRleHRIVE1MID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0OwogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CgogICAgLy8gKOC4quC5iOC4p+C4mSBzd2l0Y2ggY2FzZSDguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgb3B0aW9ucyDguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBzd2l0Y2ggKHF1ZXN0aW9uVHlwZSkgewogICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6IGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InRlYW1fb3B0JHtpfSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtY3lhbi02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InRlYW1fb3B0JHtpfSI+JHtvcHR9PC9sYWJlbD48L2Rpdj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0idGVhbV9vcHRfdHJ1ZSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSJ0cnVlIiBjbGFzcz0ibXItMiBhY2NlbnQtY3lhbi02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InRlYW1fb3B0X3RydWUiPuC5g+C4iuC5iCAvIOC4luC4ueC4gTwvbGFiZWw+PC9kaXY+PGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJ0ZWFtX29wdF9mYWxzZSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSJmYWxzZSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdF9mYWxzZSI+4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUPC9sYWJlbD48L2Rpdj5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOiBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8dGV4dGFyZWEgbmFtZT0idGVhbV9hbnN3ZXIiIGNsYXNzPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyIgcm93cz0iMyIgcmVxdWlyZWQgcGxhY2Vob2xkZXI9IuC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4muC4guC4reC4h+C4hOC4uOC4ky4uLiI+PC90ZXh0YXJlYT5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBgPHNlbGVjdCBuYW1lPSJ0ZWFtX2Fuc3dlciIgY2xhc3M9InctZnVsbCBwLTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIiByZXF1aXJlZD48b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4hOC4ueC5iOC4geC4seC4mSAtLTwvb3B0aW9uPiR7cS5hbGxSZXNwb25zZXMubWFwKHJlc3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7cmVzcH0iPiR7cmVzcH08L29wdGlvbj5gKS5qb2luKCcnKX08L3NlbGVjdD5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBvcHRpb25zSFRNTCA9ICc8cCBjbGFzcz0idGV4dC1yZWQtNTAwIj7guYTguKHguYjguKPguLnguYnguIjguLHguIHguJvguKPguLDguYDguKDguJfguILguK3guIfguITguLPguJbguLLguKHguJnguLXguYk8L3A+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgc3R1ZGVudFF1aXpBcmVhLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgZmFkZS1pbiI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIiPuC4guC5ieC4reC4l+C4teC5iCAke2xvY2FsUXVlc3Rpb25JbmRleCArIDF9IC8gJHtjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aH08L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1jZW50ZXIgdGV4dC1jeWFuLTcwMCBteS0yIj7guJXguLLguILguK3guIc6ICR7Y3VycmVudFBsYXllck5hbWV9PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJteS00IHAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbWItMyI+CiAgICAgICAgICAgICAgICAgICAgPHA+JHtsb2NhbFF1ZXN0aW9uSW5kZXggKyAxfS4gJHtxdWVzdGlvblRleHRIVE1MfTwvcD4KICAgICAgICAgICAgICAgICAgICAke3EuaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTQgZmxleCBqdXN0aWZ5LWNlbnRlciI+JHtxLmltYWdlQ29kZX08L2Rpdj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktMiB0ZXh0LWxnIj4ke29wdGlvbnNIVE1MfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3VibWl0LXRlYW0tYW5zd2VyLWJ0biIgY2xhc3M9InctZnVsbCBiZy1jeWFuLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctY3lhbi03MDAiPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFF1aXpBcmVhXSk7CiAgICAKICAgIC8vIOC5gOC4o+C4suC4iOC4sOC5g+C4iuC5iSBoYW5kbGVUZWFtQW5zd2VyU3VibWl0IOC4quC4s+C4q+C4o+C4seC4muC4l+C4seC5ieC4hyBUZWFtIOC5geC4peC4sCBHcm91cCBNb2RlIOC5gOC4nuC4o+C4suC4sCBHcm91cCBNb2RlIOC4oeC4tSBMb2dpYyDguYHguKLguIHguK3guKLguLnguYjguILguYnguLLguIfguYPguJnguYHguKXguYnguKcKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXQtdGVhbS1hbnN3ZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVUZWFtQW5zd2VyU3VibWl0KTsKfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVHcm91cEFuc3dlclN1Ym1pdCDguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdyb3VwQW5zd2VyU3VibWl0KCkgewogICAgY29uc3QgcSA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbbG9jYWxRdWVzdGlvbkluZGV4XTsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWl6VHlwZTsKICAgIGxldCB1c2VyQW5zd2VyID0gbnVsbDsKICAgIGxldCBpc0NvcnJlY3QgPSBmYWxzZTsKCiAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtuYW1lPSJ0ZWFtX2Fuc3dlciJdJyk7CiAgICAgICAgaWYgKCF0ZXh0YXJlYSB8fCAhdGV4dGFyZWEudmFsdWUudHJpbSgpKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguJ7guLTguKHguJ7guYzguITguLPguJXguK3guJrguILguK3guIfguIHguKXguLjguYjguKEiKTsgcmV0dXJuOyB9CiAgICAgICAgdXNlckFuc3dlciA9IHRleHRhcmVhLnZhbHVlLnRyaW0oKTsKICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKHVzZXJBbnN3ZXIsIHEpOwogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBzZWxlY3RlZElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9InRlYW1fYW5zd2VyIl06Y2hlY2tlZCwgc2VsZWN0W25hbWU9InRlYW1fYW5zd2VyIl0nKTsKICAgICAgICBpZiAoIXNlbGVjdGVkSW5wdXQgfHwgc2VsZWN0ZWRJbnB1dC52YWx1ZSA9PT0gIiIpIHsgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4guC4reC4h+C4geC4peC4uOC5iOC4oSIpOyByZXR1cm47IH0KICAgICAgICB1c2VyQW5zd2VyID0gc2VsZWN0ZWRJbnB1dC52YWx1ZTsKICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOiBpc0NvcnJlY3QgPSAoKHVzZXJBbnN3ZXIgPT09ICd0cnVlJykgPT09IHEuY29ycmVjdEFuc3dlcik7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzogaXNDb3JyZWN0ID0gKHVzZXJBbnN3ZXIgPT09IHEuY29ycmVjdFJlc3BvbnNlKTsgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6IGlzQ29ycmVjdCA9IChwYXJzZUludCh1c2VyQW5zd2VyKSA9PT0gcS5jb3JyZWN0QW5zd2VySW5kZXgpOyBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgYW5zd2VyUmVjb3JkID0geyBxdWVzdGlvbkluZGV4OiBsb2NhbFF1ZXN0aW9uSW5kZXgsIGlzQ29ycmVjdDogaXNDb3JyZWN0IH07CiAgICBjb25zdCBncm91cElkID0gdXNlcklkOwogICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHsKICAgICAgICBbYGdyb3Vwcy4ke2dyb3VwSWR9LmFuc3dlcnNgXTogYXJyYXlVbmlvbihhbnN3ZXJSZWNvcmQpCiAgICB9OwogICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgIHVwZGF0ZVBheWxvYWRbYGdyb3Vwcy4ke2dyb3VwSWR9LnNjb3JlYF0gPSBpbmNyZW1lbnQoMSk7CiAgICB9CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS90ZWFtUXVpenplc2AsIGN1cnJlbnRUZWFtUXVpeklkKSwgdXBkYXRlUGF5bG9hZCk7CiAgICAgICAgCiAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmE4Lib4LmD4LiK4LmJ4LiV4Lix4Lin4LmB4Lib4Lij4LiB4Lil4Liy4LiHIOC5geC4peC4sOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hwogICAgICAgIGxvY2FsUXVlc3Rpb25JbmRleCsrOwogICAgICAgIAogICAgICAgIGlmIChsb2NhbFF1ZXN0aW9uSW5kZXggPj0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgZGlzcGxheVRlYW1RdWl6RmluYWxSZXN1bHRzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVuZGVyR3JvdXBNb2RlUXVlc3Rpb24oKTsgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmB4Liq4LiU4LiH4Lic4Lil4Liq4Liz4Lir4Lij4Lix4LiaIEdyb3VwIE1vZGUg4LmC4LiU4Lii4LmA4LiJ4Lie4Liy4LiwCiAgICAgICAgfQogICAgICAgIAogICAgfSBjYXRjaChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHN1Ym1pdHRpbmcgZ3JvdXAgYW5zd2VyOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaIik7CiAgICB9Cn0KCgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGhhbmRsZVRlYW1BbnN3ZXJTdWJtaXQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBoYW5kbGVUZWFtQW5zd2VyU3VibWl0KCkgewogICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpKTsKICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkpIHJldHVybjsKICAgIGNvbnN0IGdhbWVEYXRhID0gZ2FtZVNuYXAuZGF0YSgpOwoKICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4mSBHcm91cCBNb2RlIOC5g+C4q+C5ieC5hOC4m+C5g+C4iuC5iSBMb2dpYyDguYDguJTguLTguKHguILguK3guIcgR3JvdXAgTW9kZQogICAgaWYgKGdhbWVEYXRhLm1vZGUgPT09ICdncm91cCcpIHsKICAgICAgICBoYW5kbGVHcm91cEFuc3dlclN1Ym1pdCgpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAtLS0gTG9naWMg4LmD4Lir4Lih4LmI4Liq4Liz4Lir4Lij4Lix4LiaIFRlYW0gTW9kZSAo4LiX4Li44LiB4LiE4LiZ4LiV4Lit4Lia4LiX4Li44LiB4LiC4LmJ4LitKSAtLS0KICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXJOYW1lID0gbG9jYWxUZWFtUGxheWVyc1tsb2NhbFBsYXllckluZGV4XTsKICAgIGNvbnN0IHEgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2xvY2FsUXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgdXNlckFuc3dlciA9IG51bGw7CiAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CgogICAgLy8gKOC4quC5iOC4p+C4meC4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4muC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHsKICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3RleHRhcmVhW25hbWU9InRlYW1fYW5zd2VyIl0nKTsKICAgICAgICBpZiAoIXRleHRhcmVhIHx8ICF0ZXh0YXJlYS52YWx1ZS50cmltKCkpIHsgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4miIpOyByZXR1cm47IH0KICAgICAgICB1c2VyQW5zd2VyID0gdGV4dGFyZWEudmFsdWUudHJpbSgpOwogICAgICAgIGlzQ29ycmVjdCA9IGF3YWl0IGdyYWRlU2hvcnRBbnN3ZXIodXNlckFuc3dlciwgcSk7IAogICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBzZWxlY3RlZElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW25hbWU9InRlYW1fYW5zd2VyIl06Y2hlY2tlZCwgc2VsZWN0W25hbWU9InRlYW1fYW5zd2VyIl0nKTsKICAgICAgICBpZiAoIXNlbGVjdGVkSW5wdXQgfHwgc2VsZWN0ZWRJbnB1dC52YWx1ZSA9PT0gIiIpIHsgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4miIpOyByZXR1cm47IH0KICAgICAgICB1c2VyQW5zd2VyID0gc2VsZWN0ZWRJbnB1dC52YWx1ZTsKICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOiBpc0NvcnJlY3QgPSAoKHVzZXJBbnN3ZXIgPT09ICd0cnVlJykgPT09IHEuY29ycmVjdEFuc3dlcik7IGJyZWFrOwogICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzogaXNDb3JyZWN0ID0gKHVzZXJBbnN3ZXIgPT09IHEuY29ycmVjdFJlc3BvbnNlKTsgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6IGlzQ29ycmVjdCA9IChwYXJzZUludCh1c2VyQW5zd2VyKSA9PT0gcS5jb3JyZWN0QW5zd2VySW5kZXgpOyBicmVhazsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgYW5zd2VyUmVjb3JkID0geyBxdWVzdGlvbkluZGV4OiBsb2NhbFF1ZXN0aW9uSW5kZXgsIGlzQ29ycmVjdDogaXNDb3JyZWN0LCBhbnN3ZXJWYWx1ZTogdXNlckFuc3dlciB9OwogICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHsgW2ByZXNwb25zZXMuJHtjdXJyZW50UGxheWVyTmFtZX0uYW5zd2Vyc2BdOiBhcnJheVVuaW9uKGFuc3dlclJlY29yZCkgfTsKICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICB1cGRhdGVQYXlsb2FkW2ByZXNwb25zZXMuJHtjdXJyZW50UGxheWVyTmFtZX0uc2NvcmVgXSA9IGluY3JlbWVudCgxKTsKICAgIH0KICAgIAogICAgdHJ5IHsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpLCB1cGRhdGVQYXlsb2FkKTsKICAgICAgICAKICAgICAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguKXguLfguYjguK3guJnguYTguJvguKLguLHguIfguJzguLnguYnguYDguKXguYjguJnguITguJnguJbguLHguJTguYTguJsKICAgICAgICBsb2NhbFBsYXllckluZGV4Kys7CgogICAgICAgIGlmIChsb2NhbFBsYXllckluZGV4ID49IGxvY2FsVGVhbVBsYXllcnMubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIOC5gOC4oeC4t+C5iOC4reC4l+C4uOC4geC4hOC4meC4leC4reC4muC4guC5ieC4reC4meC4teC5ieC4hOC4o+C4muC5geC4peC5ieC4pyDguYPguKvguYnguILguLbguYnguJnguILguYnguK3guYPguKvguKHguYgg4LmB4Lil4Liw4Lij4Li14LmA4LiL4LmH4LiV4LiE4LiZ4LiV4Lit4Lia4LmA4Lib4LmH4LiZ4LiE4LiZ4LmB4Lij4LiBCiAgICAgICAgICAgIGxvY2FsUXVlc3Rpb25JbmRleCsrOwogICAgICAgICAgICBsb2NhbFBsYXllckluZGV4ID0gMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmVuZGVyVGVhbVF1aXpRdWVzdGlvbigpOyAvLyDguYHguKrguJTguIfguJzguKXguYPguKvguKHguYggKOC4reC4suC4iOC4iOC4sOC5gOC4m+C5h+C4meC4hOC4meC4luC4seC4lOC5hOC4m+C5g+C4meC4guC5ieC4reC5gOC4lOC4tOC4oSDguKvguKPguLfguK3guITguJnguYHguKPguIHguYPguJnguILguYnguK3guYPguKvguKHguYgpCgogICAgfSBjYXRjaChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHN1Ym1pdHRpbmcgdGVhbSBhbnN3ZXI6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKrguYjguIfguITguLPguJXguK3guJoiKTsKICAgIH0KfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBkaXNwbGF5VGVhbVF1aXpGaW5hbFJlc3VsdHMg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvAovKioKICog4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4Liq4Lij4Li44Lib4Lic4Lil4Liq4Li44LiU4LiX4LmJ4Liy4LiiICjguYDguKfguK3guKPguYzguIrguLHguJnguYHguIHguYnguYTguII6IEdyb3VwIE1vZGUg4LmB4Liq4LiU4LiH4Lic4Lil4LmA4LiJ4Lie4Liy4Liw4LiB4Lil4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lit4LiHKQogKi8KYXN5bmMgZnVuY3Rpb24gZGlzcGxheVRlYW1RdWl6RmluYWxSZXN1bHRzKCkgewogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgY29uc3QgdGVhbVF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvdGVhbVF1aXp6ZXNgLCBjdXJyZW50VGVhbVF1aXpJZCk7CiAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHRlYW1RdWl6UmVmKTsKICAgIGlmICghZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IGA8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtcmVkLTUwMCI+4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4LihIOC4reC4suC4iOC4quC4tOC5ieC4meC4quC4uOC4lOC5hOC4m+C5geC4peC5ieC4pzwvcD5gOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGdhbWVEYXRhID0gZG9jU25hcC5kYXRhKCk7CgogICAgbGV0IGZpbmFsU2NvcmVzID0gW107CiAgICBjb25zdCBtb2RlID0gZ2FtZURhdGEubW9kZSB8fCAndGVhbSc7CgogICAgLy8gLS0tIFtTVEFSVF0g4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgaWYgKG1vZGUgPT09ICdncm91cCcpIHsKICAgICAgICAvLyBMb2dpYyBmb3IgR3JvdXAgTW9kZTog4LmB4Liq4LiU4LiH4Lic4Lil4LmA4LiJ4Lie4Liy4Liw4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiB4Lil4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lit4LiHCiAgICAgICAgY29uc3QgbXlHcm91cERhdGEgPSBnYW1lRGF0YS5ncm91cHNbdXNlcklkXTsgLy8gdXNlcklkIOC4hOC4t+C4rSBJRCDguILguK3guIfguYDguITguKPguLfguYjguK3guIfguJnguLXguYkKICAgICAgICBpZiAobXlHcm91cERhdGEpIHsKICAgICAgICAgICAgZmluYWxTY29yZXMgPSBbewogICAgICAgICAgICAgICAgbmFtZTogYOC4geC4peC4uOC5iOC4oTogJHtsb2NhbFRlYW1QbGF5ZXJzLmpvaW4oJywgJyl9YCwgLy8g4LmD4LiK4LmJIGxvY2FsVGVhbVBsYXllcnMg4LiX4Li14LmI4LmA4LiB4LmH4Lia4LiK4Li34LmI4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCiAgICAgICAgICAgICAgICBzY29yZTogbXlHcm91cERhdGEuc2NvcmUgfHwgMAogICAgICAgICAgICB9XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguIHguKPguJPguLXguInguLjguIHguYDguInguLTguJkg4Lir4Liy4LiB4Lir4Liy4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Lil4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lit4LiH4LmE4Lih4LmI4LmA4LiI4LitCiAgICAgICAgICAgIGZpbmFsU2NvcmVzID0gW3sgbmFtZTogJ+C4geC4peC4uOC5iOC4oeC4guC4reC4h+C4hOC4uOC4kycsIHNjb3JlOiAnTi9BJyB9XTsKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgIC8vIExvZ2ljIGZvciBUZWFtIE1vZGUgKOC4guC4reC4h+C5gOC4lOC4tOC4oSkKICAgICAgICBmaW5hbFNjb3JlcyA9IGxvY2FsVGVhbVBsYXllcnMubWFwKG5hbWUgPT4gKHsKICAgICAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICAgICAgc2NvcmU6IGdhbWVEYXRhLnJlc3BvbnNlc1tuYW1lXT8uc2NvcmUgfHwgMAogICAgICAgIH0pKS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICB9CiAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgCiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04IGJnLWN5YW4tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWN5YW4tODAwIj7guIjguJrguIHguLTguIjguIHguKPguKPguKHguYHguKXguYnguKchPC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9Im10LTQiPuC4quC4o+C4uOC4m+C4hOC4sOC5geC4meC4mTo8L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktMiBtdC0yIG1heC13LXNtIG14LWF1dG8iPgogICAgICAgICAgICAgICAgJHtmaW5hbFNjb3Jlcy5tYXAocmVzID0+IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiB0ZXh0LWxnIHAtMiBiZy13aGl0ZS81MCByb3VuZGVkLW1kIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz4ke3Jlcy5uYW1lfTwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3Jlcy5zY29yZX0g4LiE4Liw4LmB4LiZ4LiZPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSIgY2xhc3M9Im10LTYgYmctYmx1ZS02MDAgdGV4dC13aGl0ZSBweS0yIHB4LTUgcm91bmRlZC1sZyI+4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4LmB4Lij4LiBPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgCglzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicpOwoKICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJyAmJiBjdXJyZW50VGVhbVF1aXpJZCkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBkZWxldGVEb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgY3VycmVudFRlYW1RdWl6SWQpKTsKICAgICAgICB9LCAzMDAwMDApOwogICAgfQp9CgkJCgkJbGV0IGhpc3RvcnkgPSBbXTsKbGV0IGhpc3RvcnlTdGVwID0gLTE7CgkJbGV0IG1vZGFsQ29uZmlybUFjdGlvbiA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4miAi4LiE4Liz4Liq4Lix4LmI4LiH4Lie4Li04LmA4Lio4LipIiDguJfguLXguYjguIjguLDguYPguKvguYnguJvguLjguYjguKEgIuC4leC4geC4peC4hyIg4LiX4Liz4LiH4Liy4LiZCgkJbGV0IGNoZWF0QXR0ZW1wdHMgPSAwOwoJCWxldCBjaGVhdERldGVjdGlvblRpbWVvdXQgPSBudWxsOwpjb25zdCBtYXhDaGVhdEF0dGVtcHRzID0gMzsgLy8g4LiB4Liz4Lir4LiZ4LiU4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4Lit4LiZ4Li44LiN4Liy4LiV4LmD4Lir4LmJ4Lit4Lit4LiB4LiI4Liy4LiB4LiI4LitICjguJvguKPguLHguJrguYHguIHguYnguYTguJTguYkpCmxldCBpc1F1aXpBY3RpdmUgPSBmYWxzZTsgLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiK4LmH4LiE4Lin4LmI4Liy4LiB4Liz4Lil4Lix4LiH4LiX4Liz4LiC4LmJ4Lit4Liq4Lit4Lia4Lit4Lii4Li54LmI4Lir4Lij4Li34Lit4LmE4Lih4LmICgkJCgkJbGV0IGdsb2JhbERhc2hib2FyZFNldHRpbmdzID0gewogICAgcHJvamVjdFNvcnQ6ICdkYXRlX2Rlc2MnLCAvLyDguITguYjguLLguYDguKPguLTguYjguKHguJXguYnguJkKICAgIHBpbm5lZFByb2plY3RzOiBbXSwgICAgICAvLyDguITguYjguLLguYDguKPguLTguYjguKHguJXguYnguJkKCXByb2plY3RWaWV3OiAnZ3JpZCcgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQp9OwoJCQoJCS8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyA9PT0g4LmC4LiE4LmJ4LiU4Liq4Liz4Lir4Lij4Lix4Lia4LiI4Lix4LiU4LiB4Liy4LijIERyb3Bkb3duIOC5gOC4iOC4suC4sOC4iOC4h+C4q+C4seC4p+C4guC5ieC4reC4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jCA9PT0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyAxLiDguYLguITguKPguIfguKrguKPguYnguLLguIfguILguYnguK3guKHguLnguKXguKvguLHguKfguILguYnguK3guJfguLHguYnguIfguKvguKHguJQKY29uc3QgYWxsTWF0aFRvcGljcyA9IFsKICAgIC8vIOC4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4owogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguJnguLHguJonIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4o+C4sOC4muC4muC5gOC4peC4guC5geC4peC4sOC4hOC5iOC4suC4m+C4o+C4sOC4iOC4s+C4q+C4peC4seC4gScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lib4Lix4LiU4LmA4Lio4Lip4LmB4Lil4Liw4Lib4Lij4Liw4Lih4Liy4LiT4LiE4LmI4LiyJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKXguLPguJTguLHguJrguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMgKFBFTURBUyknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4muC4p+C4gScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4Lil4LiaJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguITguLnguJMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4q+C4suC4oycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiI4Liz4LiZ4Lin4LiZ4LmA4LiV4LmH4Lih4Lia4Lin4LiBJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIjguLPguJnguKfguJnguYDguJXguYfguKHguKXguJonIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4qOC4ueC4meC4ouC5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiE4LmI4Liy4Liq4Lix4Lih4Lia4Li54Lij4LiT4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguYDguKrguYnguJnguIjguLPguJnguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4leC4seC4p+C4m+C4o+C4sOC4geC4reC4muC5geC4peC4sOC4leC4seC4p+C4m+C4o+C4sOC4geC4reC4muC5gOC4ieC4nuC4suC4sCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LirLuC4oy7guKEuIChHQ0QpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIQu4LijLuC4mS4gKExDTSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4reC4seC4leC4o+C4suC4quC5iOC4p+C4meC5geC4peC4sOC4quC4seC4lOC4quC5iOC4p+C4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Lit4Lix4LiV4Lij4Liy4LmB4Lil4Liw4Lit4Lix4LiV4Lij4Liy4Lir4LiZ4LmI4Lin4LiiJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguYDguKjguKnguKrguYjguKfguJkgKOC4ouC5iOC4rS/guILguKLguLLguKIpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguJrguKfguIHguYDguKjguKnguKrguYjguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4peC4muC5gOC4qOC4qeC4quC5iOC4p+C4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4LiE4Li54LiT4LmA4Lio4Lip4Liq4LmI4Lin4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguKvguLLguKPguYDguKjguKnguKrguYjguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4iOC4s+C4meC4p+C4meC4hOC4peC4sCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiX4Lio4LiZ4Li04Lii4LihICjguITguYjguLLguJvguKPguLDguIjguLPguKvguKXguLHguIEpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguJrguKfguIHguJfguKjguJnguLTguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4geC4suC4o+C4peC4muC4l+C4qOC4meC4tOC4ouC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4LiB4Liy4Lij4LiE4Li54LiT4LiX4Lio4LiZ4Li04Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguIHguLLguKPguKvguLLguKPguJfguKjguJnguLTguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C5geC4m+C4peC4hyDguYDguKjguKnguKrguYjguKfguJnihpTguJfguKjguJnguLTguKLguKHihpTguKPguYnguK3guKLguKXguLAnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4LiB4Liy4Lij4LiU4Liz4LmA4LiZ4Li04LiZ4LiB4Liy4LijJywgbmFtZTogJ+C4o+C5ieC4reC4ouC4peC4sOC4nuC4t+C5ieC4meC4kOC4suC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Lib4Lij4Lix4Lia4LmA4Lie4Li04LmI4LihL+C4peC4lOC5gOC4m+C5h+C4meC4o+C5ieC4reC4ouC4peC4sCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Liq4LmI4Lin4LiZ4Lil4LiUIOC4oOC4suC4qeC4tSDguIHguLPguYTguKMg4LiC4Liy4LiU4LiX4Li44LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguYDguKXguILguKLguIHguIHguLPguKXguLHguIcgKOC4geC4ji/guKjguLnguJnguKLguYwv4Lil4LiaKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIjguLPguJnguKfguJnguYHguKXguLDguIHguLLguKPguJTguLPguYDguJnguLTguJnguIHguLLguKMnLCBuYW1lOiAn4Lij4Liy4LiB4LiX4Li14LmI4Liq4Lit4LiH4LmB4Lil4Liw4LiX4Li14LmI4Liq4Liy4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKPguLnguJvguKrguYHguITguKfguKPguYzguKPguLnguJcgKHN1cmQpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4iOC4s+C4meC4p+C4meC5geC4peC4sOC4geC4suC4o+C4lOC4s+C5gOC4meC4tOC4meC4geC4suC4oycsIG5hbWU6ICfguKrguLHguI3guIHguKPguJPguYzguKfguLTguJfguKLguLLguKjguLLguKrguJXguKPguYwnIH0sCiAgICAvLyDguIHguLLguKPguKfguLHguJQKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lir4LiZ4LmI4Lin4Lii4LiE4Lin4Liy4Lih4Lii4Liy4Lin4LmB4Lil4Liw4LiB4Liy4Lij4LmB4Lib4Lil4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguKvguJnguYjguKfguKLguKHguKfguKUv4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LmB4Lil4Liw4LiB4Liy4Lij4LmB4Lib4Lil4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguKvguJnguYjguKfguKLguYDguKfguKXguLLguYHguKXguLDguIHguLLguKPguITguLPguJnguKfguJPguYDguKfguKXguLInIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4m+C4o+C4tOC4oeC4suC4leC4oy/guITguKfguLLguKHguIjguLjguYHguKXguLDguIHguLLguKPguYHguJvguKXguIcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4reC4uOC4k+C4q+C4oOC4ueC4oeC4tOC5geC4peC4sOC4geC4suC4o+C5geC4m+C4peC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4LmA4Liq4LmJ4LiZ4Lij4Lit4Lia4Lij4Li54LibJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguJ7guLfguYnguJnguJfguLXguYjguKrguLXguYjguYDguKvguKXguLXguYjguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4nuC4t+C5ieC4meC4l+C4teC5iOC4quC4suC4oeC5gOC4q+C4peC4teC5iOC4ouC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lie4Li34LmJ4LiZ4LiX4Li14LmI4Lin4LiH4LiB4Lil4LihL+C4quC5iOC4p+C4meC4guC4reC4h+C4p+C4h+C4geC4peC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Lie4Li34LmJ4LiZ4LiX4Li14LmI4Lic4Li04Lin4Lij4Li54Lib4LiX4Lij4LiH4Liq4Liy4Lih4Lih4Li04LiV4Li0JyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguJvguKPguLTguKHguLLguJXguKPguKPguLnguJvguJfguKPguIfguKrguLLguKHguKHguLTguJXguLQnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiB4Liy4Lij4Lin4Lix4LiUJywgbmFtZTogJ+C4oeC4uOC4oeC5geC4peC4sOC4geC4suC4o+C4p+C4seC4lOC4oeC4uOC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguIHguLLguKPguKfguLHguJQnLCBuYW1lOiAn4Liq4LmA4LiB4Lil4LmB4Lil4Liw4LmB4Lic4LiZ4LiX4Li14LmIJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4geC4suC4o+C4p+C4seC4lCcsIG5hbWU6ICfguITguYjguLLguITguKXguLLguJTguYDguITguKXguLfguYjguK3guJnguILguK3guIfguIHguLLguKPguKfguLHguJQnIH0sCiAgICAvLyDguYDguKPguILguLLguITguJPguLTguJUKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4LiI4Li44LiUIOC5gOC4quC5ieC4mSDguKPguLDguJnguLLguJonIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4quC4seC4oeC4nuC4seC4meC4mOC5jOC4guC4reC4h+C4oeC4uOC4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Liq4Liy4Lih4LmA4Lir4Lil4Li14LmI4Lii4LihICjguIrguJnguLTguJQv4Liq4Lih4Lia4Lix4LiV4Li0KScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Lie4Li34LmJ4LiZ4LiX4Li14LmI4Liq4Liy4Lih4LmA4Lir4Lil4Li14LmI4Lii4LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguITguKfguLLguKHguYDguJfguYjguLLguIHguLHguJnguJfguLjguIHguJvguKPguLDguIHguLLguKPguILguK3guIfguKrguLLguKHguYDguKvguKXguLXguYjguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4hOC4peC5ieC4suC4ouC4guC4reC4h+C4o+C4ueC4mycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Lij4Li54Lib4Liq4Li14LmI4LmA4Lir4Lil4Li14LmI4Lii4Lih4LmB4Lil4Liw4Liq4Lih4Lia4Lix4LiV4Li0JyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguKPguLnguJvguKvguKXguLLguKLguYDguKvguKXguLXguYjguKLguKHguYHguKXguLDguKHguLjguKHguKDguLLguKLguYPguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4p+C4h+C4geC4peC4oTog4LiE4Lit4Lij4LmM4LiU4LmB4Lil4Liw4LmA4Liq4LmJ4LiZ4Liq4Lix4Lih4Lic4Lix4LiqJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguKfguIfguIHguKXguKE6IOC4oeC4uOC4oeC4l+C4teC5iOC4qOC4ueC4meC4ouC5jOC4geC4peC4suC4hy/guJrguJnguKfguIfguIHguKXguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4p+C4h+C4geC4peC4oTog4Liq4LmI4Lin4LiZ4LmC4LiE4LmJ4LiHIOC5gOC4i+C4geC5gOC4leC4reC4o+C5jCDguYDguIvguIHguYDguKHguJnguJXguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiVJywgbmFtZTogJ+C4geC4suC4o+C5geC4m+C4peC4h+C4l+C4suC4h+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lSAo4LmA4Lil4Li34LmI4Lit4LiZL+C4q+C4oeC4uOC4mS/guKrguLDguJfguYnguK3guJkv4LiC4Lii4Liy4LiiKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4Liq4Lih4Lih4Liy4LiV4LijICjguYHguIHguJkv4LiI4Li44LiUKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJUnLCBuYW1lOiAn4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4Lij4Li54Lib4LiU4LmJ4Lin4Lii4Lin4LiH4LmA4Lin4Li14Lii4LiZ4oCT4Liq4Lix4LiZ4LiV4Lij4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4lScsIG5hbWU6ICfguJfguKTguKnguI7guLXguJrguJfguJ7guLXguJfguLLguYLguIHguKPguLHguKrguYHguKXguLDguIHguLLguKPguJvguKPguLDguKLguLjguIHguJXguYwnIH0sCiAgICAvLyDguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJkKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LiV4Lix4Lin4LmB4Lib4Lij4LmB4Lil4Liw4LiZ4Li04Lie4LiI4LiZ4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguIHguLLguKPguIHguKPguLDguIjguLLguKLguYHguKXguLDguIHguLLguKPguIjguLHguJTguKvguKHguLnguYgnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4nuC4q+C4uOC4meC4suC4oSAo4Lia4Lin4LiBL+C4peC4mi/guITguLnguJMv4Lir4Liy4LijKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LiB4Liy4Lij4LmB4Lii4LiB4LiV4Lix4Lin4Lib4Lij4Liw4LiB4Lit4LiaJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKrguKHguIHguLLguKPguYDguIrguLTguIfguYDguKrguYnguJnguJXguLHguKfguYHguJvguKPguYDguJTguLXguKLguKcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4o+C4sOC4muC4muC4quC4oeC4geC4suC4o+C5gOC4iuC4tOC4h+C5gOC4quC5ieC4meC4quC4reC4h+C4leC4seC4p+C5geC4m+C4oycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4LiB4Liz4Lil4Lix4LiH4Liq4Lit4LiHICjguJfguLPguYPguKvguYnguYDguJvguYfguJnguIHguLPguKXguLHguIfguKrguK3guIfguKrguKHguJrguLnguKPguJPguYwpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKrguKHguIHguLLguKPguIHguLPguKXguLHguIfguKrguK3guIcgKOC5g+C4iuC5ieC4quC4ueC4leC4o+C4geC4s+C4peC4seC4h+C4quC4reC4hyknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C4hOC5iOC4suC4quC4seC4oeC4muC4ueC4o+C4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4LmA4Lir4LiV4Li44Lic4LilIChyYXRpb25hbCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C4o+C4suC4gSAocmFkaWNhbCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4quC4oeC4geC4suC4o+C4ouC4geC4geC4s+C4peC4seC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Liq4Lih4LiB4Liy4Lij4Lil4Lit4LiB4Liy4Lij4Li04LiX4Li24LihJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguK3guKrguKHguIHguLLguKPguYDguIrguLTguIfguYDguKrguYnguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4reC4quC4oeC4geC4suC4o+C4hOC5iOC4suC4quC4seC4oeC4muC4ueC4o+C4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lij4Liw4Lia4Lia4Lit4Liq4Lih4LiB4Liy4LijJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJk6IOC5geC4meC4p+C4hOC4tOC4lOC5geC4peC4sOC4quC4seC4jeC4geC4o+C4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LmC4LiU4LmA4Lih4LiZ4LmB4Lil4Liw4LmA4Lij4LiZ4LiI4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguK3guIfguITguYzguJvguKPguLDguIHguK3guJrguILguK3guIfguJ/guLHguIfguIHguYzguIrguLHguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4nOC4geC4nOC4seC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LiB4Liy4Lij4LmB4Lib4Lil4LiH4LiB4Lij4Liy4LifICjguYDguKXguLfguYjguK3guJkv4Lii4Li34LiUL+C4quC4sOC4l+C5ieC4reC4mSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4iuC4tOC4h+C5gOC4quC5ieC4meC5geC4peC4sOC4geC4o+C4suC4nycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiB4Liz4Lil4Lix4LiH4Liq4Lit4LiH4LmB4Lil4Liw4LiB4Lij4Liy4LifJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguJ7guKvguLjguJnguLLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4seC4oeC4nuC4seC4l+C4mOC5jCAocmF0aW9uYWwpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguKPguLLguIEgKHJvb3QpJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguITguYjguLLguKrguLHguKHguJrguLnguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC5geC4muC4muC4iuC4tOC5ieC4meC4quC5iOC4p+C4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lii4LiB4LiB4Liz4Lil4Lix4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguJ/guLHguIfguIHguYzguIrguLHguJnguKXguK3guIHguLLguKPguLTguJfguLbguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4peC4s+C4lOC4seC4muC5gOC4peC4guC4hOC4k+C4tOC4lSAoQVApJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4nuC4teC4iuC4hOC4k+C4tOC4leC5geC4peC4sOC4n+C4seC4h+C4geC5jOC4iuC4seC4mScsIG5hbWU6ICfguKXguLPguJTguLHguJrguYDguKPguILguLLguITguJPguLTguJUgKEdQKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4Lic4Lil4Lij4Lin4Lih4Lit4LiZ4Li44LiB4Lij4LihICjOoyknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Lie4Li14LiK4LiE4LiT4Li04LiV4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZJywgbmFtZTogJ+C4l+C4pOC4qeC4juC4teC4l+C4p+C4tOC4meC4suC4oSAo4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJ7guLXguIrguITguJPguLTguJXguYHguKXguLDguJ/guLHguIfguIHguYzguIrguLHguJknLCBuYW1lOiAn4LiI4Liz4LiZ4Lin4LiZ4LmA4LiK4Li04LiH4LiL4LmJ4Lit4LiZICjguYDguKrguKPguLTguKEpJyB9LAogICAgLy8g4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C4o+C4sOC4ouC4sOC4l+C4suC4h+C5geC4peC4sOC4iOC4uOC4lOC4geC4tuC5iOC4h+C4geC4peC4suC4hycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LiK4Lix4LiZ4LmB4Lil4Liw4LmA4Liq4LmJ4LiZ4LiV4Lij4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguYDguKrguYnguJnguJXguKPguIc6IOC4o+C4ueC4m+C5geC4muC4muC4quC4oeC4geC4suC4oycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4LmA4Liq4LmJ4LiZ4LiV4Lij4LiHOiDguILguJnguLLguJkv4LiV4Lix4LmJ4LiH4LiJ4Liy4LiBJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguKPguLDguKLguLDguIjguLLguIHguIjguLjguJTguJbguLbguIfguYDguKrguYnguJnguJXguKPguIcnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C4p+C4h+C4geC4peC4oTog4Liq4Lih4LiB4Liy4Lij4LmB4Lil4Liw4Liq4Lih4Lia4Lix4LiV4Li0JyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4o+C4guC4suC4hOC4k+C4tOC4leC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jCcsIG5hbWU6ICfguJ7guLLguKPguLLguYLguJrguKXguLInIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lij4LiC4Liy4LiE4LiT4Li04LiV4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmMJywgbmFtZTogJ+C4p+C4h+C4o+C4tScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKPguILguLLguITguJPguLTguJXguKfguLTguYDguITguKPguLLguLDguKvguYwnLCBuYW1lOiAn4LmE4Liu4LmA4Lie4Lit4Lij4LmM4LmC4Lia4Lil4LiyJyB9LAogICAgLy8g4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0CiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4reC4seC4leC4o+C4suC4quC5iOC4p+C4meC4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tOC5g+C4meC4quC4suC4oeC5gOC4q+C4peC4teC5iOC4ouC4oeC4oeC4uOC4oeC4ieC4suC4gScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4Lih4Li44Lih4Lie4Li04LmA4Lio4LipIDMwwrAtNjDCsC05MMKwJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguKHguLjguKHguJ7guLTguYDguKjguKkgNDXCsC00NcKwLTkwwrAnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C5gOC4o+C5gOC4lOC4teC4ouC4meC5geC4peC4sOC4geC4suC4o+C5geC4m+C4peC4h+C4q+C4meC5iOC4p+C4oicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4LiB4LiO4LiC4Lit4LiH4LmE4LiL4LiZ4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguIHguI7guILguK3guIfguYLguITguYTguIvguJnguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4reC4seC4leC4peC4seC4geC4qeC4k+C5jOC4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCAo4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4LiB4Liy4Lij4LmB4Lib4Lil4LiH4Lij4Li54Lib4Lit4Lix4LiV4Lil4Lix4LiB4Lip4LiT4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4teC5guC4geC4k+C4oeC4tOC4leC4tCcsIG5hbWU6ICfguKrguKHguIHguLLguKPguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Li14LmC4LiB4LiT4Lih4Li04LiV4Li0JywgbmFtZTogJ+C4geC4o+C4suC4n+C4n+C4seC4h+C4geC5jOC4iuC4seC4meC4leC4o+C4teC5guC4geC4kycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguJXguKPguLXguYLguIHguJPguKHguLTguJXguLQnLCBuYW1lOiAn4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiV4Lij4Li14LmC4LiB4LiT4Lic4LiB4Lic4Lix4LiZICjguJ7guLfguYnguJnguJDguLLguJkpJyB9LAogICAgLy8g4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4iuC4meC4tOC4lOC4guC4reC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4peC4sOC4geC4suC4o+C5gOC4geC5h+C4muC4guC5ieC4reC4oeC4ueC4pScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiB4Liy4Lij4LiI4Lix4LiU4LiB4Lil4Li44LmI4Lih4LiC4LmJ4Lit4Lih4Li54LilJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguJXguLLguKPguLLguIfguITguKfguLLguKHguJbguLXguYgnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4o+C4suC4n+C5geC4l+C5iOC4hyDguIHguKPguLLguJ/guYDguKrguYnguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4ruC4tOC4quC5guC4leC5geC4geC4o+C4oScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LmB4Lic4LiZ4Lig4Liy4Lie4LiB4Lil4LmI4Lit4LiHIChib3ggcGxvdCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4hOC5iOC4suC5gOC4ieC4peC4teC5iOC4oicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4Lih4Lix4LiY4Lii4LiQ4Liy4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguJDguLLguJnguJnguLTguKLguKEnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4nuC4tOC4quC4seC4oicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4Liq4LmI4Lin4LiZ4LmA4Lia4Li14LmI4Lii4LiH4LmA4Lia4LiZ4LmA4LiJ4Lil4Li14LmI4LiiJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguITguKfguLLguKHguYHguJvguKPguJvguKPguKfguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4quC5iOC4p+C4meC5gOC4muC4teC5iOC4ouC4h+C5gOC4muC4meC4oeC4suC4leC4o+C4kOC4suC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiB4Liy4Lij4LmB4LiI4LiB4LmB4LiI4LiH4Lib4LiB4LiV4Li04LmB4Lil4LiwIHotc2NvcmUnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4quC4q+C4quC4seC4oeC4nuC4seC4meC4mOC5jOC5geC4peC4sOC5gOC4quC5ieC4meC4luC4lOC4luC4reC4ouC5gOC4iuC4tOC4h+C5gOC4quC5ieC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiB4Liy4Lij4LiX4LiU4Lil4Lit4LiH4Liq4Li44LmI4LihL+C4nuC4t+C5ieC4meC4l+C4teC5iOC4leC4seC4p+C4reC4ouC5iOC4suC4hy/guYDguKvguJXguLjguIHguLLguKPguJPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4juC4muC4p+C4geC5geC4peC4sOC4geC4juC4hOC4ueC4kycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LmB4Lic4LiZ4Lig4Liy4Lie4LmA4Lin4LiZ4LiZ4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJnguYHguJrguJrguKHguLXguYDguIfguLfguYjguK3guJnguYTguIInIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4hOC4p+C4suC4oeC5gOC4m+C5h+C4meC4reC4tOC4quC4o+C4sOC4guC4reC4h+C5gOC4q+C4leC4uOC4geC4suC4o+C4k+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguKrguJbguLTguJXguLTguYHguKXguLDguITguKfguLLguKHguJnguYjguLLguIjguLDguYDguJvguYfguJknLCBuYW1lOiAn4LiB4Liy4Lij4LmA4Lij4Li14Lii4LiH4Liq4Lix4Lia4LmA4Lib4Lil4Li14LmI4Lii4LiZIChQZXJtdXRhdGlvbiknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4geC4suC4o+C4iOC4seC4lOC4q+C4oeC4ueC5iCAoQ29tYmluYXRpb24pJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4quC4luC4tOC4leC4tOC5geC4peC4sOC4hOC4p+C4suC4oeC4meC5iOC4suC4iOC4sOC5gOC4m+C5h+C4mScsIG5hbWU6ICfguIHguLLguKPguYHguIjguIHguYHguIjguIfguJfguKfguLTguJnguLLguKEgKOC4nuC4t+C5ieC4meC4kOC4suC4mSknIH0sCiAgICB7IGNhdGVnb3J5OiAn4Liq4LiW4Li04LiV4Li04LmB4Lil4Liw4LiE4Lin4Liy4Lih4LiZ4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZJywgbmFtZTogJ+C4hOC4p+C4suC4oeC4hOC4suC4lOC4q+C4oeC4suC4oiAoRXhwZWN0ZWQgdmFsdWUpJyB9LAogICAgLy8g4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4peC4tOC4oeC4tOC4lScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LiV4LmI4Lit4LmA4LiZ4Li34LmI4Lit4LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguK3guJnguLjguJ7guLHguJnguJjguYw6IOC4geC4juC4nuC4t+C5ieC4meC4kOC4suC4mScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lit4LiZ4Li44Lie4Lix4LiZ4LiY4LmMOiDguIHguI7guKXguLnguIHguYLguIvguYgnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4reC4meC4uOC4nuC4seC4meC4mOC5jDog4Lic4Lil4LiE4Li54LiTL+C4nOC4peC4q+C4suC4oycgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lit4LiZ4Li44Lie4Lix4LiZ4LiY4LmM4LiC4Lit4LiHIGV4cC9sb2cvdHJpZyAo4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4LiE4Lin4Liy4Lih4LiK4Lix4LiZ4LmA4Liq4LmJ4LiZ4Liq4Lix4Lih4Lic4Lix4LiqJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguK3guLHguJXguKPguLLguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIfguJfguLHguJnguJfguLUnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ09wdGltaXphdGlvbiAo4LiE4LmI4Liy4Liq4Li54LiH4Liq4Li44LiU4oCT4LiV4LmI4Liz4Liq4Li44LiUKScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lib4Lij4Li04Lie4Lix4LiZ4LiY4LmM4LmE4Lih4LmI4LiI4Liz4LiB4Lix4LiUJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5geC4hOC4peC4hOC4ueC4peC4seC4quC5gOC4muC4t+C5ieC4reC4h+C4leC5ieC4mScsIG5hbWU6ICfguJvguKPguLTguJ7guLHguJnguJjguYzguIjguLPguIHguLHguJQnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmB4LiE4Lil4LiE4Li54Lil4Lix4Liq4LmA4Lia4Li34LmJ4Lit4LiH4LiV4LmJ4LiZJywgbmFtZTogJ+C4l+C4pOC4qeC4juC4teC4muC4l+C4nuC4t+C5ieC4meC4kOC4suC4meC4guC4reC4h+C5geC4hOC4peC4hOC4ueC4peC4seC4qicgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYHguITguKXguITguLnguKXguLHguKrguYDguJrguLfguYnguK3guIfguJXguYnguJknLCBuYW1lOiAn4Lie4Li34LmJ4LiZ4LiX4Li14LmI4LmD4LiV4LmJ4LiB4Lij4Liy4LifL+C4o+C4sOC4q+C4p+C5iOC4suC4h+C4geC4o+C4suC4nycgfSwKICAgIC8vIOC5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKQogICAgeyBjYXRlZ29yeTogJ+C5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguYDguKfguIHguYDguJXguK3guKPguYwgMiDguKHguLTguJXguLQ6IOC4muC4p+C4gS/guITguLnguJPguKrguYDguIHguKXguLLguKPguYwnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmM4LmB4Lil4Liw4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4lOC4reC4l+C5guC4m+C4o+C4lOC4seC4geC4leC5jCAoZG90KScgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LiB4Liy4Lij4Lib4Lij4Liw4Lii4Li44LiB4LiV4LmM4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmM4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguYDguKHguJfguKPguLTguIHguIvguYw6IOC4muC4p+C4gS/guITguLnguJMnIH0sCiAgICB7IGNhdGVnb3J5OiAn4LmA4Lin4LiB4LmA4LiV4Lit4Lij4LmM4LmB4Lil4Liw4LmA4Lih4LiX4Lij4Li04LiB4LiL4LmMICjguYDguKrguKPguLTguKEpJywgbmFtZTogJ+C4reC4tOC4meC5gOC4p+C4reC4o+C5jOC4quC4guC4reC4h+C5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCcgfSwKICAgIHsgY2F0ZWdvcnk6ICfguYDguKfguIHguYDguJXguK3guKPguYzguYHguKXguLDguYDguKHguJfguKPguLTguIHguIvguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4LiU4Li14LmA4LiX4Lit4Lij4LmM4Lih4Li04LmB4LiZ4LiZ4LiV4LmMJyB9LAogICAgeyBjYXRlZ29yeTogJ+C5gOC4p+C4geC5gOC4leC4reC4o+C5jOC5geC4peC4sOC5gOC4oeC4l+C4o+C4tOC4geC4i+C5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguYHguIHguYnguKPguLDguJrguJrguKrguKHguIHguLLguKPguJTguYnguKfguKLguYDguKHguJfguKPguLTguIHguIvguYwnIH0sCiAgICAvLyDguITguJPguLTguJXguIHguLLguKPguYDguIfguLTguJkv4Lia4Li54Lij4LiT4Liy4LiB4Liy4LijCiAgICB7IGNhdGVnb3J5OiAn4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4oycsIG5hbWU6ICfguJTguK3guIHguYDguJrguLXguYnguKLguK3guKLguYjguLLguIfguIfguYjguLLguKInIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4oycsIG5hbWU6ICfguJTguK3guIHguYDguJrguLXguYnguKLguJfguJrguJXguYnguJknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4oycsIG5hbWU6ICfguYDguIfguLTguJnguIfguKfguJQgKOC4reC4meC4uOC4geC4o+C4oeC5gOC4h+C4tOC4meC4h+C4p+C4lCknIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4oycsIG5hbWU6ICfguITguYjguLLguYDguKrguLfguYjguK3guKHguKPguLLguITguLInIH0sCiAgICB7IGNhdGVnb3J5OiAn4LiE4LiT4Li04LiV4LiB4Liy4Lij4LmA4LiH4Li04LiZL+C4muC4ueC4o+C4k+C4suC4geC4suC4oycsIG5hbWU6ICfguKPguYnguK3guKLguKXguLDguJvguKPguLDguKLguLjguIHguJXguYwnIH0sCiAgICAvLyDguJXguKPguKPguIHguLAv4LiX4Lix4LiB4Lip4Liw4LiB4Liy4Lij4Lie4Li04Liq4Li54LiI4LiZ4LmMICjguYDguKrguKPguLTguKEpCiAgICB7IGNhdGVnb3J5OiAn4LiV4Lij4Lij4LiB4LiwL+C4l+C4seC4geC4qeC4sOC4geC4suC4o+C4nuC4tOC4quC4ueC4iOC4meC5jCAo4LmA4Liq4Lij4Li04LihKScsIG5hbWU6ICfguITguYjguLLguITguKfguLLguKHguIjguKPguLTguIcv4LiV4Liy4Lij4Liy4LiH4LiE4LmI4Liy4LiE4Lin4Liy4Lih4LiI4Lij4Li04LiHJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4o+C4geC4sC/guJfguLHguIHguKnguLDguIHguLLguKPguJ7guLTguKrguLnguIjguJnguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4Lij4Li54Lib4LmB4Lia4Lia4LiB4Liy4Lij4LmD4Lir4LmJ4LmA4Lir4LiV4Li44Lic4LilJyB9LAogICAgeyBjYXRlZ29yeTogJ+C4leC4o+C4o+C4geC4sC/guJfguLHguIHguKnguLDguIHguLLguKPguJ7guLTguKrguLnguIjguJnguYwgKOC5gOC4quC4o+C4tOC4oSknLCBuYW1lOiAn4Lie4Li04Liq4Li54LiI4LiZ4LmM4LmA4LiK4Li04LiH4LiV4Lij4LiHL+C4reC4uOC4m+C4meC4seC4oiAo4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZKScgfSwKXTsKCi8vIDIuIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4hyBEcm9wZG93bgovLyA9PT0g4LmB4LiX4LiZ4LiX4Li14LmI4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclRvcGljUmVmaW5lRHJvcGRvd24g4LmA4LiU4Li04Lih4LiU4LmJ4Lin4Lii4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJID09PQovLyA9PT0g4LmB4LiX4LiZ4LiX4Li14LmI4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclRvcGljQ2hlY2tib3hlcyDguYDguJTguLTguKHguJTguYnguKfguKLguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYkgPT09CmZ1bmN0aW9uIHJlbmRlclRvcGljQ2hlY2tib3hlcygpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRoLXRvcGljcy1jaGVja2JveC1jb250YWluZXInKTsKICAgIGlmICghY29udGFpbmVyKSByZXR1cm47CgogICAgY29uc3Qgc3RhbmRhcmRUb3BpY3MgPSBhbGxNYXRoVG9waWNzOwogICAgY29uc3QgdXNlckNyZWF0ZWRUb3BpY3MgPSBjdXN0b21NYXRoVG9waWNzLm1hcCh0ID0+ICh7IGlkOiB0LmlkLCBjYXRlZ29yeTogJ+C4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5gOC4reC4hycsIG5hbWU6IHQubmFtZSB9KSk7CiAgICBjb25zdCBjb21iaW5lZFRvcGljcyA9IFsuLi5zdGFuZGFyZFRvcGljcywgLi4udXNlckNyZWF0ZWRUb3BpY3NdOwogICAgCiAgICBjb25zdCB0b3BpY3NCeUNhdGVnb3J5ID0gY29tYmluZWRUb3BpY3MucmVkdWNlKChhY2MsIHRvcGljKSA9PiB7CiAgICAgICAgaWYgKCFhY2NbdG9waWMuY2F0ZWdvcnldKSB7CiAgICAgICAgICAgIGFjY1t0b3BpYy5jYXRlZ29yeV0gPSBbXTsKICAgICAgICB9CiAgICAgICAgYWNjW3RvcGljLmNhdGVnb3J5XS5wdXNoKHRvcGljKTsKICAgICAgICByZXR1cm4gYWNjOwogICAgfSwge30pOwoKICAgIGxldCBodG1sID0gJyc7CiAgICBjb25zdCBjYXRlZ29yeU9yZGVyID0gWyfguKvguLHguKfguILguYnguK3guJfguLXguYjguKrguKPguYnguLLguIfguYDguK3guIcnLCAuLi5PYmplY3Qua2V5cyh0b3BpY3NCeUNhdGVnb3J5KS5maWx0ZXIoYyA9PiBjICE9PSAn4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LmA4Lit4LiHJyldOwoKICAgIGZvciAoY29uc3QgY2F0ZWdvcnkgb2YgY2F0ZWdvcnlPcmRlcikgewogICAgICAgIGlmICh0b3BpY3NCeUNhdGVnb3J5W2NhdGVnb3J5XSkgewogICAgICAgICAgICBjb25zdCBpc0N1c3RvbUNhdGVnb3J5ID0gY2F0ZWdvcnkgPT09ICfguKvguLHguKfguILguYnguK3guJfguLXguYjguKrguKPguYnguLLguIfguYDguK3guIcnOwogICAgICAgICAgICBjb25zdCBjYXRlZ29yeUljb24gPSBpc0N1c3RvbUNhdGVnb3J5ID8gJ2ZhcyBmYS11c2VyLWVkaXQnIDogJ2ZhcyBmYS1ib29rbWFyayc7CiAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5Q29sb3IgPSBpc0N1c3RvbUNhdGVnb3J5ID8gJ3RleHQtYmx1ZS03MDAnIDogJ3RleHQtaW5kaWdvLTcwMCc7CgogICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJtYi0zIHRvcGljLWNhdGVnb3J5Ij5gOyAvLyDilrzilrzilrwg4LmB4LiB4LmJ4LmE4LiCOiDguYDguJ7guLTguYjguKEgY2xhc3MgYHRvcGljLWNhdGVnb3J5YCDilrzilrzilrwKICAgICAgICAgICAgaHRtbCArPSBgPHAgY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXNtICR7Y2F0ZWdvcnlDb2xvcn0gYm9yZGVyLWIgbWItMSBwYi0xIj48aSBjbGFzcz0iJHtjYXRlZ29yeUljb259IG1yLTIiPjwvaT4ke2NhdGVnb3J5fTwvcD5gOwoKICAgICAgICAgICAgdG9waWNzQnlDYXRlZ29yeVtjYXRlZ29yeV0uZm9yRWFjaCh0b3BpYyA9PiB7CiAgICAgICAgICAgICAgICAvLyDilrzilrzilrwg4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCOiDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIfguJfguLXguYjguYDguKvguKHguLfguK3guJnguIHguLHguJnguKrguLPguKvguKPguLHguJrguJfguLjguIHguKvguLHguKfguILguYnguK0g4pa84pa84pa8CiAgICAgICAgICAgICAgICBjb25zdCBpc0N1c3RvbSA9ICEhdG9waWMuaWQ7IC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5gOC4m+C5h+C4meC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5gOC4reC4h+C4q+C4o+C4t+C4reC5hOC4oeC5iAoKICAgICAgICAgICAgICAgIGNvbnN0IGFjdGlvbkJ1dHRvbnMgPSBpc0N1c3RvbSA/IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b3BpYy1hY3Rpb25zLXZpZXcgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7dG9waWMuaWR9IiBjbGFzcz0iZWRpdC1jdXN0b20tdG9waWMtYnRuIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC1ibHVlLTYwMCBwLTEgcm91bmRlZC1mdWxsIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wZW5jaWwtYWx0IHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHt0b3BpYy5pZH0iIGNsYXNzPSJkZWxldGUtY3VzdG9tLXRvcGljLWJ0biB0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtcmVkLTYwMCBwLTEgcm91bmRlZC1mdWxsIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaC1hbHQgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0b3BpYy1hY3Rpb25zLWVkaXQgaGlkZGVuIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3RvcGljLmlkfSIgY2xhc3M9InNhdmUtY3VzdG9tLXRvcGljLWJ0biB0ZXh0LWdyYXktNDAwIGhvdmVyOnRleHQtZ3JlZW4tNjAwIHAtMSByb3VuZGVkLWZ1bGwgdGV4dC14cyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrIHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHt0b3BpYy5pZH0iIGNsYXNzPSJjYW5jZWwtZWRpdC10b3BpYy1idG4gdGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LWdyYXktODAwIHAtMSByb3VuZGVkLWZ1bGwgdGV4dC14cyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgIDogJyc7CgogICAgICAgICAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcC0xIGhvdmVyOmJnLWdyYXktMTAwIHJvdW5kZWQtbWQgZ3JvdXAgdG9waWMtcm93IiBkYXRhLXRvcGljLWNvbnRhaW5lci1pZD0iJHt0b3BpYy5pZCB8fCAnJ30iPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0yIGN1cnNvci1wb2ludGVyIGZsZXgtZ3JvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0ibWF0aF90b3BpYyIgdmFsdWU9IiR7dG9waWMubmFtZX0iIGNsYXNzPSJoLTQgdy00IHJvdW5kZWQgYm9yZGVyLWdyYXktMzAwIHRleHQtaW5kaWdvLTYwMCBmb2N1czpyaW5nLWluZGlnby01MDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1zbSB0b3BpYy1uYW1lLWRpc3BsYXkiPiR7dG9waWMubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICR7aXNDdXN0b20gPyBgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJ0b3BpYy1uYW1lLWlucHV0IGhpZGRlbiB3LWZ1bGwgdGV4dC1zbSBwLTEgYm9yZGVyIHJvdW5kZWQiIHZhbHVlPSIke3RvcGljLm5hbWV9Ij5gIDogJyd9CiAgICAgICAgICAgICAgICAgICAgPC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAke2FjdGlvbkJ1dHRvbnN9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAvLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIOKWsuKWsuKWsgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgICAgICB9CiAgICB9CgogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWwgfHwgJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNDAwIj7guKLguLHguIfguYTguKHguYjguKHguLXguKvguLHguKfguILguYnguK08L3A+JzsKICAgIGNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVTZWxlY3RlZFRvcGljc0NvdW50KTsKICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVTZWxlY3RlZFRvcGljc0NvdW50KTsKfQoKLyoqCiAqIOC4iOC4seC4lOC4geC4suC4o+C4geC4suC4o+C4reC4seC4m+C5gOC4lOC4leC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC4quC4o+C5ieC4suC4h+C5gOC4reC4hwogKiBAcGFyYW0ge3N0cmluZ30gdG9waWNJZCAtIElEIOC4guC4reC4h+C5gOC4reC4geC4quC4suC4o+C4q+C4seC4p+C4guC5ieC4reC5g+C4mSBGaXJlc3RvcmUKICogQHBhcmFtIHtzdHJpbmd9IG5ld05hbWUgLSDguIrguLfguYjguK3guYPguKvguKHguYjguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguJrguLHguJnguJfguLbguIEKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVVwZGF0ZUN1c3RvbVRvcGljKHRvcGljSWQsIG5ld05hbWUpIHsKICAgIGlmICghdG9waWNJZCB8fCAhbmV3TmFtZS50cmltKCkpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4Lit4Lir4LmJ4Liy4Lih4Lin4LmI4Liy4LiHIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdG9waWNSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvY3VzdG9tTWF0aFRvcGljc2AsIHRvcGljSWQpOwogICAgICAgIGF3YWl0IHVwZGF0ZURvYyh0b3BpY1JlZiwgeyBuYW1lOiBuZXdOYW1lLnRyaW0oKSB9KTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmB4LiB4LmJ4LmE4LiC4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgLy8gb25TbmFwc2hvdCDguIjguLAgcmUtcmVuZGVyIOC5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tCDguIvguLbguYjguIfguIjguLDguJfguLPguYPguKvguYkgVUkg4LiB4Lil4Lix4Lia4LmA4Lib4LmH4LiZ4LmC4Lir4Lih4LiU4Lib4LiB4LiV4Li04LmA4Lit4LiHCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIGN1c3RvbSB0b3BpYzoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5geC4geC5ieC5hOC4guC4q+C4seC4p+C4guC5ieC4rSIpOwogICAgfQp9CgovKioKICog4Liq4Lil4Lix4LiaIFVJIOC4o+C4sOC4q+C4p+C5iOC4suC4h+C5guC4q+C4oeC4lOC5geC4quC4lOC4h+C4nOC4peC5geC4peC4sOC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4guC4quC4s+C4q+C4o+C4seC4muC4q+C4seC4p+C4guC5ieC4rQogKiBAcGFyYW0ge0hUTUxFbGVtZW50fSB0b3BpY0NvbnRhaW5lciAtIEVsZW1lbnQgZGl2IOC4q+C4peC4seC4geC4guC4reC4h+C4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4quC4peC4seC4mgogKiBAcGFyYW0ge2Jvb2xlYW59IGlzRWRpdGluZyAtIHRydWUg4LmA4Lie4Li34LmI4Lit4LmA4LiC4LmJ4Liy4LmC4Lir4Lih4LiU4LmB4LiB4LmJ4LmE4LiCLCBmYWxzZSDguYDguJ7guLfguYjguK3guK3guK3guIHguIjguLLguIHguYLguKvguKHguJTguYHguIHguYnguYTguIIKICovCmZ1bmN0aW9uIHRvZ2dsZVRvcGljRWRpdE1vZGUodG9waWNDb250YWluZXIsIGlzRWRpdGluZykgewogICAgaWYgKCF0b3BpY0NvbnRhaW5lcikgcmV0dXJuOwoKICAgIGNvbnN0IG5hbWVEaXNwbGF5ID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtZGlzcGxheScpOwogICAgY29uc3QgbmFtZUlucHV0ID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IHZpZXdBY3Rpb25zID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLWFjdGlvbnMtdmlldycpOwogICAgY29uc3QgZWRpdEFjdGlvbnMgPSB0b3BpY0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcudG9waWMtYWN0aW9ucy1lZGl0Jyk7CgogICAgbmFtZURpc3BsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgaXNFZGl0aW5nKTsKICAgIG5hbWVJbnB1dC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhaXNFZGl0aW5nKTsKICAgIHZpZXdBY3Rpb25zLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIGlzRWRpdGluZyk7CiAgICBlZGl0QWN0aW9ucy5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhaXNFZGl0aW5nKTsKCiAgICBpZiAoaXNFZGl0aW5nKSB7CiAgICAgICAgbmFtZUlucHV0LmZvY3VzKCk7CiAgICAgICAgbmFtZUlucHV0LnNlbGVjdCgpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVTdGFydExpdmVSYWNlKHF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gdXBkYXRlU2VsZWN0ZWRUb3BpY3NDb3VudCgpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRoLXRvcGljcy1jaGVja2JveC1jb250YWluZXInKTsKICAgIGNvbnN0IGNvdW50ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il06Y2hlY2tlZCcpLmxlbmd0aDsKICAgIGNvbnN0IGNvdW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtdG9waWNzLWNvdW50Jyk7CiAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgY291bnRFbC50ZXh0Q29udGVudCA9IGAo4LmA4Lil4Li34Lit4LiB4LmB4Lil4LmJ4LinICR7Y291bnR9IOC4q+C4seC4p+C4guC5ieC4rSlgOwogICAgfSBlbHNlIHsKICAgICAgICBjb3VudEVsLnRleHRDb250ZW50ID0gJyc7CiAgICB9Cn0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgkJCgkJY29uc3Qgc2FyYWJ1bkJhc2U2NCA9ICcnOwogICAgICAgIGxldCBkYiwgYXV0aCwgdXNlcklkOwoJCWxldCBjdXN0b21NYXRoVG9waWNzID0gW107IC8vICA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgbGV0IGN1cnJlbnRNb2RlID0gJ3N0dWRlbnQnOyAvLyAnc3R1ZGVudCcsICdhZG1pbicsIG9yICdhZG1pbi10ZXN0aW5nJwogICAgICAgIGxldCBjdXJyZW50UHJvamVjdElkID0gbnVsbDsKICAgICAgICBsZXQgY3VycmVudFByb2plY3REYXRhID0gbnVsbDsKICAgICAgICBsZXQgY3VycmVudFF1aXpEYXRhID0gbnVsbDsKICAgICAgICBsZXQgY3VycmVudERpc3BsYXllZFF1aXogPSBudWxsOyAvLyBIb2xkcyB0aGUgcG90ZW50aWFsbHkgc2h1ZmZsZWQgcXVpeiBmb3IgdGhlIHN0dWRlbnQKCQlsZXQgY3VycmVudFN1Ym1pc3Npb25zID0gW107IC8vIOC4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4muC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4peC5iOC4suC4quC4uOC4lApsZXQgcXVpekxlYWRlcmJvYXJkU29ydEJ5ID0gJ2Jlc3RTY29yZSc7IC8vIOC4hOC4reC4peC4seC4oeC4meC5jOC4l+C4teC5iOC5g+C4iuC5ieC4iOC4seC4lOC5gOC4o+C4teC4ouC4hyAo4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZKQpsZXQgcXVpekxlYWRlcmJvYXJkU29ydE9yZGVyID0gJ2Rlc2MnOyAvLyDguJfguLTguKjguJfguLLguIfguIHguLLguKPguIjguLHguJTguYDguKPguLXguKLguIcgKOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mSkKICAgICAgICBsZXQgY3VycmVudFN0dWRlbnROYW1lID0gbnVsbDsKICAgICAgICBsZXQgY3VycmVudFN0dWRlbnRQcm9qZWN0RGF0YSA9IG51bGw7IAogICAgICAgIGxldCBjdXJyZW50UHJlc2VudGF0aW9uU2xpZGUgPSAwOwogICAgICAgIGxldCBhbGxQcm9qZWN0cyA9IFtdOyAvLyBDYWNoZSBmb3IgcHJvamVjdHMKCQlsZXQgYWxsUXVpenplc0dsb2JhbCA9IFtdOyAgICAgICAgLy8g4LmB4LiE4LiK4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li44LiB4LmC4Lib4Lij4LmA4LiI4LiEICjguK3guYjguLLguJnguKPguKfguJTguYDguJTguLXguKLguKcpCgkJbGV0IHNlbGVjdGVkR2xvYmFsUXVpeklkID0gbnVsbDsgIC8vIGlkIOC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC4nOC4ueC5ieC5g+C4iuC5ieC5gOC4peC4t+C4reC4geC5g+C4mSBtb2RhbAogICAgICAgIGxldCBhbGxRdWl6emVzID0gW107IC8vIENhY2hlIGZvciBxdWl6emVzIGluIGEgcHJvamVjdAoJCWxldCBzdGFycmVkUXVpenplcyA9IFtdOyAvLyBDYWNoZSBmb3Igc3RhcnJlZCBxdWl6emVzCiAgICAgICAgbGV0IGNoYXJ0SW5zdGFuY2VzID0ge307IC8vIFRvIGhvbGQgY2hhcnQgb2JqZWN0cwogICAgICAgIGxldCB1bnN1YnNjcmliZVByb2plY3RzTGlzdGVuZXIgPSBudWxsOwogICAgICAgIGxldCB1bnN1YnNjcmliZVN0dWRlbnRzTGlzdGVuZXIgPSBudWxsOwogICAgICAgIGxldCB1bnN1YnNjcmliZVF1aXp6ZXNMaXN0ZW5lciA9IG51bGw7CiAgICAgICAgbGV0IHVuc3Vic2NyaWJlU3VibWlzc2lvbnNMaXN0ZW5lciA9IG51bGw7CiAgICAgICAgbGV0IHVuc3Vic2NyaWJlU3R1ZGVudFByb2ZpbGVzTGlzdGVuZXIgPSBudWxsOyAvLyBGb3IgTGVhZGVyYm9hcmQKICAgICAgICBsZXQgY29uZmlybUFjdGlvbiA9IG51bGw7CiAgICAgICAgbGV0IGNhbmNlbEFjdGlvbiA9IG51bGw7IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKICAgICAgICBsZXQgYWN0aW9uVGFyZ2V0SWQgPSBudWxsOyAvLyBVc2VkIGZvciByZW5hbWUvbW92ZS90aW1lciBhY3Rpb25zCgkJbGV0IHNlbGVjdGVkRmlsZSA9IG51bGw7IC8vICA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4Lih4LiyCiAgICAgICAgbGV0IGRyYWdnZWRTdmdFbGVtZW50ID0gbnVsbDsgLy8g4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4LiaIGVsZW1lbnQg4LiX4Li14LmI4LiB4Liz4Lil4Lix4LiH4LiW4Li54LiB4Lil4Liy4LiBCiAgICAgICAgbGV0IHN2Z09mZnNldCA9IHsgeDogMCwgeTogMCB9OyAvLyDguKrguLPguKvguKPguLHguJrguYDguIHguYfguJrguKPguLDguKLguLDguKvguYjguLLguIfguKPguLDguKvguKfguYjguLLguIfguYDguKHguLLguKrguYwv4LiZ4Li04LmJ4Lin4LiB4Lix4Lia4Lih4Li44Lih4LiC4Lit4LiHIGVsZW1lbnQKICAgICAgICAvLyBUaW1lci1yZWxhdGVkIHN0YXRlCiAgICAgICAgbGV0IHF1aXpUaW1lckludGVydmFsID0gbnVsbDsKICAgICAgICBsZXQgcGVyUXVlc3Rpb25UaW1lckludGVydmFsID0gbnVsbDsKICAgICAgICBsZXQgcXVpelN0YXJ0VGltZSA9IG51bGw7IC8vIEZvciBjYWxjdWxhdGluZyBkdXJhdGlvbgogICAgICAgIGxldCBjdXJyZW50UXVlc3Rpb25JbmRleCA9IDA7CiAgICAgICAgbGV0IHN0dWRlbnRBbnN3ZXJzUGVyUXVlc3Rpb24gPSBbXTsKICAgICAgICAvLyBMaXZlIEdhbWUgU3RhdGUKCQlsZXQgY2FjaGVkT3RoZXJQbGF5ZXJzRm9yUXVlc3Rpb24gPSBudWxsOwoJCWxldCBjYWNoZWRRdWVzdGlvbkluZGV4Rm9yUGxheWVycyA9IC0xOwogICAgICAgIGxldCBjdXJyZW50TGl2ZUdhbWVJZCA9IG51bGw7CiAgICAgICAgbGV0IGN1cnJlbnRMaXZlR2FtZVBpbiA9IG51bGw7CgkJbGV0IGxvY2tlZEZhc3Rlc3RSZXNwb25kZXJOYW1lID0gbnVsbDsgCgkJbGV0IGxhc3RMb2NrZWRRdWVzdGlvbkluZGV4ID0gLTE7CiAgICAgICAgbGV0IHVuc3Vic2NyaWJlTGl2ZUdhbWVMaXN0ZW5lciA9IG51bGw7CgkJbGV0IHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwgPSBudWxsOwoJCWxldCBsYXN0UmVuZGVyZWRBZG1pblF1ZXN0aW9uSW5kZXggPSAtMTsKCQkgCQkgCi8vIOKWvOKWvOKWvCBbU1RBUlRdIOC4p+C4suC4h+C4l+C4seC4muC5guC4hOC5ieC4lOC4quC5iOC4p+C4mSBTY3JhdGNocGFkIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4iuC4uOC4lOC5g+C4q+C4oeC5iOC4meC4teC5iSDilrzilrzilrwKCi8vIC0tLSDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguKrguJbguLLguJnguLDguILguK3guIfguIHguKPguLDguJTguLLguJnguJfguJQgLS0tCmxldCBpc0FuaW1hdGluZ1RyYWlsID0gZmFsc2U7IC8vIOC4leC4seC4p+C5geC4m+C4o+C5gOC4iuC5h+C4hOC4p+C5iOC4siBhbmltYXRpb24g4LiB4Liz4Lil4Lix4LiH4LiX4Liz4LiH4Liy4LiZ4Lir4Lij4Li34Lit4LmE4Lih4LmICmNvbnN0IFRSQUlMX0RVUkFUSU9OID0gMTUwMDsgLy8g4Lij4Liw4Lii4Liw4LmA4Lin4Lil4Liy4LiX4Li14LmI4LmA4Liq4LmJ4LiZ4LiI4Liw4LmB4Liq4LiU4LiH4Lit4Lii4Li54LmIICgxNTAwbXMgPSAxLjUg4Lin4Li04LiZ4Liy4LiX4Li1KQpsZXQgc2NyYXRjaHBhZEN0eCA9IG51bGw7CmxldCBpc0RyYXdpbmdPblNjcmF0Y2hwYWQgPSBmYWxzZTsKbGV0IHNjcmF0Y2hwYWRIaWdobGlnaHRlckNvbG9yID0gJ3JnYmEoMjU1LCAyNTUsIDAsIDAuNSknOyAvLyDguKrguLXguYDguKvguKXguLfguK3guIfguYLguJvguKPguYjguIfguYHguKrguIfguYDguJvguYfguJnguITguYjguLLguYDguKPguLTguYjguKHguJXguYnguJkKbGV0IHNjcmF0Y2hwYWRIaWdobGlnaHRlclNpemUgPSAyMDsgLy8g4LiC4LiZ4Liy4LiU4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZ4LiC4Lit4LiH4LmE4Liu4LmE4Lil4LiX4LmMCmxldCBpc1Bhbm5pbmcgPSBmYWxzZTsKbGV0IGlzTW91c2VQYW5uaW5nID0gZmFsc2U7CgovLyDguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguYHguJvguKXguIcgKOC4ouC5iOC4rS/guILguKLguLLguKIv4LmA4Lil4Li34LmI4Lit4LiZKQpsZXQgc2NyYXRjaHBhZFNjYWxlID0gMTsKbGV0IHNjcmF0Y2hwYWRPZmZzZXQgPSB7IHg6IDAsIHk6IDAgfTsKbGV0IHBhblN0YXJ0ID0geyB4OiAwLCB5OiAwIH07CmxldCBpbml0aWFsUGluY2hEaXN0YW5jZSA9IG51bGw7CmNvbnN0IE1JTl9TQ0FMRSA9IDAuMjsKY29uc3QgTUFYX1NDQUxFID0gNTsKCi8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC4iOC4seC4lOC4geC4suC4o+C4m+C4o+C4sOC4p+C4seC4leC4tOC4geC4suC4o+C4p+C4suC4lCAo4LmA4Liq4LmJ4LiZKQpsZXQgc3Ryb2tlcyA9IFtdOyAvLyDguYDguIHguYfguJrguYDguKrguYnguJnguJfguLXguYjguKfguLLguJTguYDguKrguKPguYfguIjguYHguKXguYnguKcKbGV0IHJlZG9TdHJva2VzID0gW107IC8vIOC5gOC4geC5h+C4muC5gOC4quC5ieC4meC4l+C4teC5iCB1bmRvIOC5hOC4mwpsZXQgY3VycmVudFN0cm9rZSA9IG51bGw7IC8vIOC5gOC4geC5h+C4muC5gOC4quC5ieC4meC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4p+C4suC4lOC4reC4ouC4ueC5iAoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lih4Li34LitCmxldCBhY3RpdmVUb29sID0gJ3Blbic7IC8vICdwZW4nLCAnZXJhc2VyJywgb3IgJ2xhc2VyJwpsZXQgc2NyYXRjaHBhZFBlbkNvbG9yID0gJyMwMDAwMDAnOwpsZXQgc2NyYXRjaHBhZFBlblNpemUgPSA1OwpsZXQgc2NyYXRjaHBhZEVyYXNlclNpemUgPSA0MDsKCmxldCBsYXNlckZhZGVUaW1lciA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4geC5h+C4miBJbmFjdGl2aXR5IFRpbWVyCmNvbnN0IExBU0VSX0lOQUNUSVZJVFlfVElNRU9VVCA9IDE1MDA7IC8vIDEuNSDguKfguLTguJnguLLguJfguLU6IOC5gOC4p+C4peC4suC4l+C4teC5iOC4leC5ieC4reC4h+C4q+C4ouC4uOC4lOC4p+C4suC4lOC4geC5iOC4reC4meC4l+C4teC5iOC5gOC4quC5ieC4meC4iOC4sOC5gOC4o+C4tOC5iOC4oeC4q+C4suC4ogoKCi8vIC0tLSDguJ/guLHguIfguIHguYzguIrguLHguJkgSGVscGVyIC0tLQpmdW5jdGlvbiBnZXREaXN0YW5jZShwMSwgcDIpIHsKICAgIHJldHVybiBNYXRoLnNxcnQoTWF0aC5wb3cocDEueCAtIHAyLngsIDIpICsgTWF0aC5wb3cocDEueSAtIHAyLnksIDIpKTsKfQoKZnVuY3Rpb24gZ2V0TWlkcG9pbnQocDEsIHAyKSB7CiAgICByZXR1cm4geyB4OiAocDEueCArIHAyLngpIC8gMiwgeTogKHAxLnkgKyBwMi55KSAvIDIgfTsKfQoKLy8g4LmB4Lib4Lil4LiH4Lie4Li04LiB4Lix4LiU4Lia4LiZ4LiI4LitIChTY3JlZW4pIOC5hOC4m+C5gOC4m+C5h+C4meC4nuC4tOC4geC4seC4lOC4muC4meC4geC4o+C4sOC4lOC4suC4meC4iOC4o+C4tOC4hyAoV29ybGQpCmZ1bmN0aW9uIGdldFRyYW5zZm9ybWVkUG9pbnQoeCwgeSkgewogICAgcmV0dXJuIHsKICAgICAgICB4OiAoeCAtIHNjcmF0Y2hwYWRPZmZzZXQueCkgLyBzY3JhdGNocGFkU2NhbGUsCiAgICAgICAgeTogKHkgLSBzY3JhdGNocGFkT2Zmc2V0LnkpIC8gc2NyYXRjaHBhZFNjYWxlLAogICAgfTsKfQoKCmZ1bmN0aW9uIHJlZHJhd1NjcmF0Y2hwYWQoKSB7CiAgICBpZiAoIXNjcmF0Y2hwYWRDdHgpIHJldHVybjsKICAgIGNvbnN0IGNhbnZhcyA9IHNjcmF0Y2hwYWRDdHguY2FudmFzOwogICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKCiAgICAvLyAtLS0gWyBTVEFSVDog4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmA4Lie4Li04LmI4Lih4LmA4LiC4LmJ4Liy4Lih4LiyIF0gLS0tCiAgICAvLyAxLiDguKvguLIgRWxlbWVudCDguILguK3guIcgSGVhZGVyIOC4l+C4teC5iOC5geC4quC4lOC4h+C5guC4iOC4l+C4ouC5jAogICAgY29uc3QgaGVhZGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyYXRjaHBhZC1oZWFkZXInKTsKCiAgICAvLyAyLiDguKrguLHguYjguIfguYPguKvguYkgSGVhZGVyIOC5g+C4iuC5iSBDU1MgVHJhbnNmb3JtIOC4leC4suC4oeC4hOC5iOC4suC4geC4suC4o+C4i+C4ueC4oS/guYDguKXguLfguYjguK3guJnguILguK3guIcgQ2FudmFzCiAgICBpZiAoaGVhZGVyRWwpIHsKICAgICAgICBoZWFkZXJFbC5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnMCAwJzsgLy8g4LiB4Liz4Lir4LiZ4LiU4LiI4Li44LiU4Lir4Lih4Li44LiZ4LiX4Li14LmI4Lih4Li44Lih4LiL4LmJ4Liy4Lii4Lia4LiZCiAgICAgICAgaGVhZGVyRWwuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3NjcmF0Y2hwYWRPZmZzZXQueH1weCwgJHtzY3JhdGNocGFkT2Zmc2V0Lnl9cHgpIHNjYWxlKCR7c2NyYXRjaHBhZFNjYWxlfSlgOwogICAgfQogICAgLy8gLS0tIFsgRU5EOiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgXSAtLS0KCiAgICAvLyAxLiDguKXguYnguLLguIcgQ2FudmFzICjguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBzY3JhdGNocGFkQ3R4LnNhdmUoKTsKICAgIHNjcmF0Y2hwYWRDdHguc2V0VHJhbnNmb3JtKGRwciwgMCwgMCwgZHByLCAwLCAwKTsKICAgIHNjcmF0Y2hwYWRDdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICBzY3JhdGNocGFkQ3R4LnJlc3RvcmUoKTsKCiAgICAvLyAyLiDguJXguLHguYnguIfguITguYjguLIgVHJhbnNmb3JtIChTY2FsZSDguYHguKXguLAgUGFuKSAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgc2NyYXRjaHBhZEN0eC5zYXZlKCk7CiAgICBzY3JhdGNocGFkQ3R4LnRyYW5zbGF0ZShzY3JhdGNocGFkT2Zmc2V0LngsIHNjcmF0Y2hwYWRPZmZzZXQueSk7CiAgICBzY3JhdGNocGFkQ3R4LnNjYWxlKHNjcmF0Y2hwYWRTY2FsZSwgc2NyYXRjaHBhZFNjYWxlKTsKCiAgICAvLyAzLiDguKfguLLguJTguYDguKrguYnguJnguJfguLHguYnguIfguKvguKHguJTguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYnguYPguJkgc3Ryb2tlcyAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgc3Ryb2tlcy5mb3JFYWNoKHN0cm9rZSA9PiB7CiAgICAgICAgZHJhd1N0cm9rZShzdHJva2UpOwogICAgfSk7CgogICAgLy8gNC4g4Lin4Liy4LiU4LmA4Liq4LmJ4LiZ4LiX4Li14LmI4LiB4Liz4Lil4Lix4LiH4Lin4Liy4LiU4Lit4Lii4Li54LmIICjguJbguYnguLLguKHguLUpICjguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBpZiAoY3VycmVudFN0cm9rZSkgewogICAgICAgIGRyYXdTdHJva2UoY3VycmVudFN0cm9rZSk7CiAgICB9CgogICAgLy8gNS4g4LiE4Li34LiZ4LiE4LmI4LiyIFRyYW5zZm9ybSAo4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgc2NyYXRjaHBhZEN0eC5yZXN0b3JlKCk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmZ1bmN0aW9uIHJlbmRlckdyb3VwTW9kZVF1ZXN0aW9uKCkgewogICAgaWYgKGxvY2FsUXVlc3Rpb25JbmRleCA+PSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCkgewogICAgICAgIGRpc3BsYXlUZWFtUXVpekZpbmFsUmVzdWx0cygpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBxID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1tsb2NhbFF1ZXN0aW9uSW5kZXhdOwogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgbGV0IHF1ZXN0aW9uVGV4dEhUTUwgPSBxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHQ7CiAgICBsZXQgb3B0aW9uc0hUTUwgPSAnJzsKCiAgICBzd2l0Y2ggKHF1ZXN0aW9uVHlwZSkgewogICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6IGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InRlYW1fb3B0JHtpfSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtY3lhbi02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InRlYW1fb3B0JHtpfSI+JHtvcHR9PC9sYWJlbD48L2Rpdj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0idGVhbV9vcHRfdHJ1ZSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSJ0cnVlIiBjbGFzcz0ibXItMiBhY2NlbnQtY3lhbi02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InRlYW1fb3B0X3RydWUiPuC5g+C4iuC5iCAvIOC4luC4ueC4gTwvbGFiZWw+PC9kaXY+PGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJ0ZWFtX29wdF9mYWxzZSIgbmFtZT0idGVhbV9hbnN3ZXIiIHZhbHVlPSJmYWxzZSIgY2xhc3M9Im1yLTIgYWNjZW50LWN5YW4tNjAwIiByZXF1aXJlZD48bGFiZWwgZm9yPSJ0ZWFtX29wdF9mYWxzZSI+4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUPC9sYWJlbD48L2Rpdj5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOiBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8dGV4dGFyZWEgbmFtZT0idGVhbV9hbnN3ZXIiIGNsYXNzPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyIgcm93cz0iMyIgcmVxdWlyZWQgcGxhY2Vob2xkZXI9IuC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4muC4guC4reC4h+C4geC4peC4uOC5iOC4oS4uLiI+PC90ZXh0YXJlYT5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBgPHNlbGVjdCBuYW1lPSJ0ZWFtX2Fuc3dlciIgY2xhc3M9InctZnVsbCBwLTIgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIiByZXF1aXJlZD48b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4hOC4ueC5iOC4geC4seC4mSAtLTwvb3B0aW9uPiR7cS5hbGxSZXNwb25zZXMubWFwKHJlc3AgPT4gYDxvcHRpb24gdmFsdWU9IiR7cmVzcH0iPiR7cmVzcH08L29wdGlvbj5gKS5qb2luKCcnKX08L3NlbGVjdD5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBvcHRpb25zSFRNTCA9ICc8cCBjbGFzcz0idGV4dC1yZWQtNTAwIj7guYTguKHguYjguKPguLnguYnguIjguLHguIHguJvguKPguLDguYDguKDguJfguILguK3guIfguITguLPguJbguLLguKHguJnguLXguYk8L3A+JzsKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgc3R1ZGVudFF1aXpBcmVhLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgZmFkZS1pbiI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIiPuC4guC5ieC4reC4l+C4teC5iCAke2xvY2FsUXVlc3Rpb25JbmRleCArIDF9IC8gJHtjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aH08L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1jZW50ZXIgdGV4dC1jeWFuLTcwMCBteS0yIj7guIHguKXguLjguYjguKE6ICR7bG9jYWxUZWFtUGxheWVycy5qb2luKCcsICcpfTwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXktNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb250LXNlbWlib2xkIG1iLTMiPgogICAgICAgICAgICAgICAgICAgIDxwPiR7bG9jYWxRdWVzdGlvbkluZGV4ICsgMX0uICR7cXVlc3Rpb25UZXh0SFRNTH08L3A+CiAgICAgICAgICAgICAgICAgICAgJHtxLmltYWdlQ29kZSA/IGA8ZGl2IGNsYXNzPSJteS00IGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTIgdGV4dC1sZyI+JHtvcHRpb25zSFRNTH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InN1Ym1pdC1ncm91cC1hbnN3ZXItYnRuIiBjbGFzcz0idy1mdWxsIGJnLWN5YW4tNjAwIHRleHQtd2hpdGUgcHktMyBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1jeWFuLTcwMCI+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtzdHVkZW50UXVpekFyZWFdKTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VibWl0LWdyb3VwLWFuc3dlci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUdyb3VwQW5zd2VyU3VibWl0KTsKfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVHZW5lcmF0ZVF1aXpGcm9tQmx1ZXByaW50VG9waWMg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZVF1aXpGcm9tQmx1ZXByaW50VG9waWModG9waWMsIGxlc3NvblRleHQgPSBudWxsLCBwcm9qZWN0SWQsIGJsdWVwcmludFRvcGljSWQgPSBudWxsLCBmb3JjZUFwcFN0eWxlID0gZmFsc2UsIGV4dHJhUGFydHMgPSBudWxsKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZUFuZFNob3dMZXNzb24odG9waWMsIGdyYWRlKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpOwogICAgY29uc3QgdGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy10aXRsZScpOwogICAgY29uc3QgbG9hZGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLWxvYWRlcicpOwogICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tc2VjdGlvbnMtY29udGFpbmVyJyk7CgkKCSAgICBbJ3BvaW50Q29udGVudCcsICdtZW1vcnlDb250ZW50JywgJ2FwcGxpY2F0aW9uQ29udGVudCcsICdzdW1tYXJ5Q29udGVudCddLmZvckVhY2goaWQgPT4gewogICAgICAgIGNvbnN0IHBhcmVudFNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkucGFyZW50RWxlbWVudDsKICAgICAgICBpZiAocGFyZW50U2VjdGlvbikgewogICAgICAgICAgICBwYXJlbnRTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgIH0KICAgIH0pOwogICAgCiAgICAvLyAxLiBSZXNldCDguYHguKXguLDguYHguKrguJTguIcgTW9kYWwg4Lie4Lij4LmJ4Lit4LihIExvYWRlcgogICAgdGl0bGVFbC50ZXh0Q29udGVudCA9IGDguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguJrguJfguYDguKPguLXguKLguJk6ICR7dG9waWN9YDsKICAgIGNvbnRlbnRDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBsb2FkZXJFbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgCiAgICAvLyAyLiDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVMZXNzb24g4LiX4Li14LmI4LmA4Lij4Liy4LiE4Lix4LiU4Lil4Lit4LiB4Lih4LiyCiAgICBnZW5lcmF0ZUxlc3Nvbih0b3BpYywgZ3JhZGUpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGdlbmVyYXRlIGxlc3NvbjoiLCBlcnIpOwogICAgICAgIHNob3dNZXNzYWdlKCLguILguK3guK3guKDguLHguKIsIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4quC4o+C5ieC4suC4h+C4muC4l+C5gOC4o+C4teC4ouC4meC4quC4s+C4q+C4o+C4seC4muC4q+C4seC4p+C4guC5ieC4reC4meC4teC5ieC5hOC4lOC5iSIpOwogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgTW9kYWwg4LiW4LmJ4Liy4LmA4LiB4Li04LiUIEVycm9yCiAgICB9KTsKfQoKZnVuY3Rpb24gaGFuZGxlUG9pbnRlckRvd24oZSkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgY2FudmFzID0gc2NyYXRjaHBhZEN0eC5jYW52YXM7CiAgICBjb25zdCByZWN0ID0gY2FudmFzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgY29uc3QgcG9pbnRlclR5cGUgPSBlLnBvaW50ZXJUeXBlIHx8IChlLnRvdWNoZXMgPyAndG91Y2gnIDogJ21vdXNlJyk7CiAgICAKICAgIGlmIChwb2ludGVyVHlwZSA9PT0gJ3BlbicgfHwgcG9pbnRlclR5cGUgPT09ICdtb3VzZScpIHsKICAgICAgICBpZiAoZS5wb2ludGVyVHlwZSA9PT0gJ21vdXNlJyAmJiBlLmJ1dHRvbiAhPT0gMCkgeyAKICAgICAgICAgICAgaWYgKGUuYnV0dG9uID09PSAxKSB7IAogICAgICAgICAgICAgICAgaXNNb3VzZVBhbm5pbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgcGFuU3RhcnQgPSB7IHg6IGUuY2xpZW50WCwgeTogZS5jbGllbnRZIH07CiAgICAgICAgICAgICAgICBjYW52YXMuc3R5bGUuY3Vyc29yID0gJ2dyYWJiaW5nJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47IAogICAgICAgIH0KCQkKCQkgICAgaWYgKGFjdGl2ZVRvb2wgPT09ICd0cmFpbCcpIHsKICAgICAgICAvLyDguJbguYnguLLguKHguLUgVGltZXIg4LiZ4Lix4Lia4LiW4Lit4Lii4Lir4Lil4Lix4LiH4Lit4Lii4Li54LmIIOC5g+C4q+C5ieC4ouC4geC5gOC4peC4tOC4geC4l+C4seC4meC4l+C4tQogICAgICAgIC8vIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC4l+C4s+C5g+C4q+C5ieC5gOC4quC5ieC4meC5gOC4geC5iOC4suC4ouC4seC4h+C5hOC4oeC5iOC4q+C4suC4ouC5hOC4m+C5gOC4oeC4t+C5iOC4reC5gOC4o+C4suC5gOC4o+C4tOC5iOC4oeC4p+C4suC4lOC5gOC4quC5ieC4meC5g+C4q+C4oeC5iAogICAgICAgIGlmIChsYXNlckZhZGVUaW1lcikgewogICAgICAgICAgICBjbGVhclRpbWVvdXQobGFzZXJGYWRlVGltZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAgICAgaXNEcmF3aW5nT25TY3JhdGNocGFkID0gdHJ1ZTsKICAgICAgICByZWRvU3Ryb2tlcyA9IFtdOwogICAgICAgIGNvbnN0IHRyYW5zZm9ybWVkUG9pbnQgPSBnZXRUcmFuc2Zvcm1lZFBvaW50KGUuY2xpZW50WCAtIHJlY3QubGVmdCwgZS5jbGllbnRZIC0gcmVjdC50b3ApOwogICAgICAgIAogICAgICAgIC8vIOC4geC4s+C4q+C4meC4lOC4hOC4uOC4k+C4quC4oeC4muC4seC4leC4tOC4guC4reC4h+C5gOC4quC5ieC4meC4leC4suC4oeC5gOC4hOC4o+C4t+C5iOC4reC4h+C4oeC4t+C4reC4l+C4teC5iOC5gOC4peC4t+C4reC4gQogICAgICAgIGxldCBzdHJva2VQcm9wZXJ0aWVzID0gewogICAgICAgICAgICB0b29sOiBhY3RpdmVUb29sLAogICAgICAgICAgICBwb2ludHM6IFt0cmFuc2Zvcm1lZFBvaW50XQogICAgICAgIH07CgogICAgICAgIGlmIChhY3RpdmVUb29sID09PSAncGVuJykgewogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLmNvbG9yID0gc2NyYXRjaHBhZFBlbkNvbG9yOwogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLnNpemUgPSBzY3JhdGNocGFkUGVuU2l6ZTsKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRvb2wgPT09ICdlcmFzZXInKSB7CiAgICAgICAgICAgIHN0cm9rZVByb3BlcnRpZXMuY29sb3IgPSBzY3JhdGNocGFkUGVuQ29sb3I7IC8vIOC4quC4teC5hOC4oeC5iOC4quC4s+C4hOC4seC4jeC4quC4s+C4q+C4o+C4seC4muC4ouC4suC4h+C4peC4mgogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLnNpemUgPSBzY3JhdGNocGFkRXJhc2VyU2l6ZTsgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC5g+C4iuC5ieC4leC4seC4p+C5geC4m+C4o+C5g+C4q+C4oeC5iAogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlVG9vbCA9PT0gJ2hpZ2hsaWdodGVyJykgewogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLmNvbG9yID0gc2NyYXRjaHBhZEhpZ2hsaWdodGVyQ29sb3I7CiAgICAgICAgICAgIHN0cm9rZVByb3BlcnRpZXMuc2l6ZSA9IHNjcmF0Y2hwYWRIaWdobGlnaHRlclNpemU7IAogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlVG9vbCA9PT0gJ3RyYWlsJykgewogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLmNvbG9yID0gc2NyYXRjaHBhZFBlbkNvbG9yOwogICAgICAgICAgICBzdHJva2VQcm9wZXJ0aWVzLnNpemUgPSBzY3JhdGNocGFkUGVuU2l6ZTsgLy8gVHJhaWwg4Lii4Lix4LiH4LiE4LiH4LmD4LiK4LmJ4LiC4LiZ4Liy4LiU4LiC4Lit4LiH4Lib4Liy4LiB4LiB4LiyCiAgICAgICAgfQoKICAgICAgICBjdXJyZW50U3Ryb2tlID0gc3Ryb2tlUHJvcGVydGllczsKCiAgICB9IGVsc2UgaWYgKGUudG91Y2hlcykgewogICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICAgIGlzUGFubmluZyA9IHRydWU7CiAgICAgICAgICAgIHBhblN0YXJ0ID0gZ2V0TWlkcG9pbnQoeyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfSwgeyB4OiBlLnRvdWNoZXNbMV0uY2xpZW50WCwgeTogZS50b3VjaGVzWzFdLmNsaWVudFkgfSk7CiAgICAgICAgICAgIGluaXRpYWxQaW5jaERpc3RhbmNlID0gZ2V0RGlzdGFuY2UoeyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfSwgeyB4OiBlLnRvdWNoZXNbMV0uY2xpZW50WCwgeTogZS50b3VjaGVzWzFdLmNsaWVudFkgfSk7CiAgICAgICAgfQogICAgfQp9CgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGFuaW1hdGVUcmFpbCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIGFuaW1hdGVUcmFpbCgpIHsKICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICBsZXQgaGFzQWN0aXZlVHJhaWxzID0gZmFsc2U7CgogICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiI4Liy4LiB4Lir4Lil4Lix4LiH4Lih4Liy4Lir4LiZ4LmJ4Liy4LmA4Liq4Lih4LitIOC5gOC4oeC4t+C5iOC4reC4oeC4teC4geC4suC4o+C4peC4miBpdGVtIOC5g+C4mSBhcnJheQogICAgZm9yIChsZXQgaSA9IHN0cm9rZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBjb25zdCBzdHJva2UgPSBzdHJva2VzW2ldOwoKICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguYDguInguJ7guLLguLDguYDguKrguYnguJnguJfguLXguYjguYDguJvguYfguJkgJ3RyYWlsJyDguYHguKXguLDguKHguLXguYDguKfguKXguLIgIuC5gOC4o+C4tOC5iOC4oeC4iOC4suC4h+C4q+C4suC4oiIg4LmB4Lil4LmJ4Lin4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgaWYgKHN0cm9rZS50b29sID09PSAndHJhaWwnICYmIHN0cm9rZS5mYWRlU3RhcnRUaW1lKSB7CiAgICAgICAgICAgIGNvbnN0IGVsYXBzZWRUaW1lID0gbm93IC0gc3Ryb2tlLmZhZGVTdGFydFRpbWU7CgogICAgICAgICAgICBpZiAoZWxhcHNlZFRpbWUgPj0gVFJBSUxfRFVSQVRJT04pIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4q+C4oeC4lOC5gOC4p+C4peC4suC5geC4peC5ieC4pyDguYPguKvguYnguKXguJrguYDguKrguYnguJnguJnguLXguYnguJfguLTguYnguIfguYTguJvguYDguKXguKIKICAgICAgICAgICAgICAgIHN0cm9rZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lir4Lih4LiU4LmA4Lin4Lil4LiyIOC5g+C4q+C5ieC4hOC4s+C4meC4p+C4k+C4hOC4p+C4suC4oeC5guC4m+C4o+C5iOC4h+C5g+C4qgogICAgICAgICAgICAgICAgc3Ryb2tlLm9wYWNpdHkgPSAxIC0gKGVsYXBzZWRUaW1lIC8gVFJBSUxfRFVSQVRJT04pOwogICAgICAgICAgICAgICAgaGFzQWN0aXZlVHJhaWxzID0gdHJ1ZTsgLy8g4Lia4Lit4LiB4LmD4Lir4LmJ4Lij4Li54LmJ4Lin4LmI4Liy4Lii4Lix4LiH4LiV4LmJ4Lit4LiH4LiX4LizIGFuaW1hdGlvbiDguJXguYjguK0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgLy8g4Lin4Liy4LiUIENhbnZhcyDguYPguKvguKHguYgKICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKCiAgICAvLyDguJbguYnguLLguKLguLHguIfguKHguLXguYDguKrguYnguJnguJfguLXguYjguJXguYnguK3guIfguJfguLMgYW5pbWF0aW9uIOC4reC4ouC4ueC5iCDguYPguKvguYnguKfguJkgTG9vcCDguJXguYjguK3guYTguJsKICAgIGlmIChoYXNBY3RpdmVUcmFpbHMpIHsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZVRyYWlsKTsKICAgIH0gZWxzZSB7CiAgICAgICAgaXNBbmltYXRpbmdUcmFpbCA9IGZhbHNlOyAvLyDguKvguKLguLjguJQgYW5pbWF0aW9uCiAgICB9Cn0KCmZ1bmN0aW9uIHN0YXJ0VHJhaWxBbmltYXRpb24oKSB7CiAgICAvLyDguJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguYDguKPguLXguKLguIEgYW5pbWF0aW9uIOC4i+C5ieC4s+C4i+C5ieC4reC4mQogICAgaWYgKCFpc0FuaW1hdGluZ1RyYWlsKSB7CiAgICAgICAgaXNBbmltYXRpbmdUcmFpbCA9IHRydWU7CiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVUcmFpbCk7CiAgICB9Cn0KCmZ1bmN0aW9uIGRyYXdTdHJva2Uoc3Ryb2tlKSB7CiAgICBpZiAoIXN0cm9rZSB8fCBzdHJva2UucG9pbnRzLmxlbmd0aCA8IDEpIHJldHVybjsKCiAgICBzY3JhdGNocGFkQ3R4LnNhdmUoKTsKICAgIHNjcmF0Y2hwYWRDdHgubGluZUpvaW4gPSAncm91bmQnOwogICAgc2NyYXRjaHBhZEN0eC5saW5lQ2FwID0gJ3JvdW5kJzsKCiAgICBpZiAoc3Ryb2tlLnRvb2wgPT09ICd0cmFpbCcpIHsKICAgICAgICBjb25zdCBhZGp1c3RlZFNpemUgPSBzdHJva2Uuc2l6ZSAvIHNjcmF0Y2hwYWRTY2FsZTsKICAgICAgICBzY3JhdGNocGFkQ3R4Lmdsb2JhbEFscGhhID0gc3Ryb2tlLm9wYWNpdHkgPz8gMS4wOyAKICAgICAgICBzY3JhdGNocGFkQ3R4LnNoYWRvd0NvbG9yID0gJ3JnYmEoMjM5LCA2OCwgNjgsIDAuOSknOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc2hhZG93Qmx1ciA9IGFkanVzdGVkU2l6ZSAqIDM7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDIzOSwgNjgsIDY4LCAwLjcpJzsKICAgICAgICBzY3JhdGNocGFkQ3R4LmxpbmVXaWR0aCA9IGFkanVzdGVkU2l6ZSAqIDIuNTsKICAgICAgICAKICAgICAgICBzY3JhdGNocGFkQ3R4LmJlZ2luUGF0aCgpOwogICAgICAgIHNjcmF0Y2hwYWRDdHgubW92ZVRvKHN0cm9rZS5wb2ludHNbMF0ueCwgc3Ryb2tlLnBvaW50c1swXS55KTsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN0cm9rZS5wb2ludHMubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG1pZFBvaW50ID0gZ2V0TWlkcG9pbnQoc3Ryb2tlLnBvaW50c1tpXSwgc3Ryb2tlLnBvaW50c1tpICsgMV0pOwogICAgICAgICAgICBzY3JhdGNocGFkQ3R4LnF1YWRyYXRpY0N1cnZlVG8oc3Ryb2tlLnBvaW50c1tpXS54LCBzdHJva2UucG9pbnRzW2ldLnksIG1pZFBvaW50LngsIG1pZFBvaW50LnkpOwogICAgICAgIH0KICAgICAgICBzY3JhdGNocGFkQ3R4LnN0cm9rZSgpOwogICAgICAgIAogICAgICAgIHNjcmF0Y2hwYWRDdHguc2hhZG93Q29sb3IgPSAndHJhbnNwYXJlbnQnOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5zdHJva2VTdHlsZSA9ICcjRkZGRkZGJzsKICAgICAgICBzY3JhdGNocGFkQ3R4LmxpbmVXaWR0aCA9IGFkanVzdGVkU2l6ZTsKICAgICAgICAKICAgICAgICBzY3JhdGNocGFkQ3R4LnN0cm9rZSgpOyAvLyBSZS1zdHJva2UgdGhlIGNlbnRlciBsaW5lCiAgICAgICAgc2NyYXRjaHBhZEN0eC5jbG9zZVBhdGgoKTsKCiAgICB9IGVsc2UgaWYgKHN0cm9rZS50b29sID09PSAnaGlnaGxpZ2h0ZXInKSB7CiAgICAgICAgLy8g4LmD4LiK4LmJICdtdWx0aXBseScg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4Liq4Li14LiL4LmJ4Lit4LiZ4LiX4Lix4Lia4LiB4Lix4LiZ4LmB4Lil4LmJ4Lin4LmA4LiC4LmJ4Lih4LiC4Li24LmJ4LiZ4LmA4Lir4Lih4Li34Lit4LiZ4LmE4Liu4LmE4Lil4LiX4LmM4LiI4Lij4Li04LiHCiAgICAgICAgc2NyYXRjaHBhZEN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnbXVsdGlwbHknOwogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlU3R5bGUgPSBzdHJva2UuY29sb3I7IC8vIOC4iOC4sOC5gOC4m+C5h+C4meC4quC4teC5geC4muC4miByZ2JhKHIsIGcsIGIsIDAuNSkKICAgICAgICBzY3JhdGNocGFkQ3R4LmxpbmVXaWR0aCA9IHN0cm9rZS5zaXplOwogICAgICAgIAogICAgICAgIHNjcmF0Y2hwYWRDdHguYmVnaW5QYXRoKCk7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5tb3ZlVG8oc3Ryb2tlLnBvaW50c1swXS54LCBzdHJva2UucG9pbnRzWzBdLnkpOwogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3Ryb2tlLnBvaW50cy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgbWlkUG9pbnQgPSBnZXRNaWRwb2ludChzdHJva2UucG9pbnRzW2ldLCBzdHJva2UucG9pbnRzW2kgKyAxXSk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRDdHgucXVhZHJhdGljQ3VydmVUbyhzdHJva2UucG9pbnRzW2ldLngsIHN0cm9rZS5wb2ludHNbaV0ueSwgbWlkUG9pbnQueCwgbWlkUG9pbnQueSk7CiAgICAgICAgfQogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlKCk7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5jbG9zZVBhdGgoKTsKCiAgICB9IGVsc2UgeyAvLyDguKrguLPguKvguKPguLHguJogJ3Blbicg4LmB4Lil4LiwICdlcmFzZXInCiAgICAgICAgc2NyYXRjaHBhZEN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBzdHJva2UudG9vbCA9PT0gJ2VyYXNlcicgPyAnZGVzdGluYXRpb24tb3V0JyA6ICdzb3VyY2Utb3Zlcic7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5zdHJva2VTdHlsZSA9IHN0cm9rZS5jb2xvcjsKICAgICAgICBzY3JhdGNocGFkQ3R4LmxpbmVXaWR0aCA9IHN0cm9rZS5zaXplOwogICAgICAgIAogICAgICAgIHNjcmF0Y2hwYWRDdHguYmVnaW5QYXRoKCk7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5tb3ZlVG8oc3Ryb2tlLnBvaW50c1swXS54LCBzdHJva2UucG9pbnRzWzBdLnkpOwogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3Ryb2tlLnBvaW50cy5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgbWlkUG9pbnQgPSBnZXRNaWRwb2ludChzdHJva2UucG9pbnRzW2ldLCBzdHJva2UucG9pbnRzW2kgKyAxXSk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRDdHgucXVhZHJhdGljQ3VydmVUbyhzdHJva2UucG9pbnRzW2ldLngsIHN0cm9rZS5wb2ludHNbaV0ueSwgbWlkUG9pbnQueCwgbWlkUG9pbnQueSk7CiAgICAgICAgfQogICAgICAgIHNjcmF0Y2hwYWRDdHguc3Ryb2tlKCk7CiAgICAgICAgc2NyYXRjaHBhZEN0eC5jbG9zZVBhdGgoKTsKICAgIH0KICAgIAogICAgc2NyYXRjaHBhZEN0eC5yZXN0b3JlKCk7Cn0KCmZ1bmN0aW9uIGhhbmRsZVBvaW50ZXJNb3ZlKGUpIHsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IGNhbnZhcyA9IHNjcmF0Y2hwYWRDdHguY2FudmFzOwogICAgY29uc3QgcmVjdCA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICBpZiAoZS50b3VjaGVzKSB7IC8vIFRvdWNoIEV2ZW50cwogICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09PSAxICYmIGlzRHJhd2luZ09uU2NyYXRjaHBhZCkgewogICAgICAgICAgICBjb25zdCB0cmFuc2Zvcm1lZFBvaW50ID0gZ2V0VHJhbnNmb3JtZWRQb2ludChlLnRvdWNoZXNbMF0uY2xpZW50WCAtIHJlY3QubGVmdCwgZS50b3VjaGVzWzBdLmNsaWVudFkgLSByZWN0LnRvcCk7CiAgICAgICAgICAgIGN1cnJlbnRTdHJva2UucG9pbnRzLnB1c2godHJhbnNmb3JtZWRQb2ludCk7CiAgICAgICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgICAgICB9IGVsc2UgaWYgKGUudG91Y2hlcy5sZW5ndGggPT09IDIgJiYgaXNQYW5uaW5nKSB7CiAgICAgICAgICAgIC8vICjguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQaW5jaERpc3RhbmNlID0gZ2V0RGlzdGFuY2UoeyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfSwgeyB4OiBlLnRvdWNoZXNbMV0uY2xpZW50WCwgeTogZS50b3VjaGVzWzFdLmNsaWVudFkgfSk7CiAgICAgICAgICAgIGNvbnN0IG1pZFBvaW50ID0gZ2V0TWlkcG9pbnQoeyB4OiBlLnRvdWNoZXNbMF0uY2xpZW50WCwgeTogZS50b3VjaGVzWzBdLmNsaWVudFkgfSwgeyB4OiBlLnRvdWNoZXNbMV0uY2xpZW50WCwgeTogZS50b3VjaGVzWzFdLmNsaWVudFkgfSk7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlRmFjdG9yID0gY3VycmVudFBpbmNoRGlzdGFuY2UgLyBpbml0aWFsUGluY2hEaXN0YW5jZTsKICAgICAgICAgICAgY29uc3QgbmV3U2NhbGUgPSBNYXRoLm1pbihNYXRoLm1heChzY3JhdGNocGFkU2NhbGUgKiBzY2FsZUZhY3RvciwgTUlOX1NDQUxFKSwgTUFYX1NDQUxFKTsKICAgICAgICAgICAgY29uc3QgZHggPSBtaWRQb2ludC54IC0gcGFuU3RhcnQueDsKICAgICAgICAgICAgY29uc3QgZHkgPSBtaWRQb2ludC55IC0gcGFuU3RhcnQueTsKICAgICAgICAgICAgc2NyYXRjaHBhZE9mZnNldC54ID0gbWlkUG9pbnQueCAtIChtaWRQb2ludC54IC0gc2NyYXRjaHBhZE9mZnNldC54KSAqIChuZXdTY2FsZSAvIHNjcmF0Y2hwYWRTY2FsZSk7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRPZmZzZXQueSA9IG1pZFBvaW50LnkgLSAobWlkUG9pbnQueSAtIHNjcmF0Y2hwYWRPZmZzZXQueSkgKiAobmV3U2NhbGUgLyBzY3JhdGNocGFkU2NhbGUpOwogICAgICAgICAgICBzY3JhdGNocGFkT2Zmc2V0LnggKz0gZHg7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRPZmZzZXQueSArPSBkeTsKICAgICAgICAgICAgc2NyYXRjaHBhZFNjYWxlID0gbmV3U2NhbGU7CiAgICAgICAgICAgIGluaXRpYWxQaW5jaERpc3RhbmNlID0gY3VycmVudFBpbmNoRGlzdGFuY2U7CiAgICAgICAgICAgIHBhblN0YXJ0ID0gbWlkUG9pbnQ7CiAgICAgICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgICAgICB9CiAgICB9IGVsc2UgeyAvLyBNb3VzZSBFdmVudAogICAgICAgIC8vIOKWvOKWvOKWvC0tLSDguYHguIHguYnguYTguIIv4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4LmD4LiZ4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLeKWvOKWvOKWvAogICAgICAgIGlmIChpc01vdXNlUGFubmluZykgewogICAgICAgICAgICBjb25zdCBkeCA9IGUuY2xpZW50WCAtIHBhblN0YXJ0Lng7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gZS5jbGllbnRZIC0gcGFuU3RhcnQueTsKICAgICAgICAgICAgc2NyYXRjaHBhZE9mZnNldC54ICs9IGR4OwogICAgICAgICAgICBzY3JhdGNocGFkT2Zmc2V0LnkgKz0gZHk7CiAgICAgICAgICAgIHBhblN0YXJ0ID0geyB4OiBlLmNsaWVudFgsIHk6IGUuY2xpZW50WSB9OwogICAgICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICAgICAgfSBlbHNlIGlmIChpc0RyYXdpbmdPblNjcmF0Y2hwYWQpIHsKICAgICAgICAgICAgY29uc3QgdHJhbnNmb3JtZWRQb2ludCA9IGdldFRyYW5zZm9ybWVkUG9pbnQoZS5jbGllbnRYIC0gcmVjdC5sZWZ0LCBlLmNsaWVudFkgLSByZWN0LnRvcCk7CiAgICAgICAgICAgIGN1cnJlbnRTdHJva2UucG9pbnRzLnB1c2godHJhbnNmb3JtZWRQb2ludCk7CiAgICAgICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgICAgICB9CiAgICAgICAgLy8g4pay4pay4payLS0tIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS3ilrLilrLilrIKICAgIH0KfQoKZnVuY3Rpb24gaGFuZGxlUG9pbnRlclVwKGUpIHsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IGNhbnZhcyA9IHNjcmF0Y2hwYWRDdHguY2FudmFzOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCgogICAgLy8g4pa84pa84pa8LS0tIOC5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5iSAtLS3ilrzilrzilrwKICAgIGlmIChpc01vdXNlUGFubmluZykgewogICAgICAgIGlzTW91c2VQYW5uaW5nID0gZmFsc2U7CiAgICAgICAgY2FudmFzLnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JzsgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZIGN1cnNvciDguIHguKXguLHguJrguYDguJvguYfguJnguJvguIHguJXguLQKICAgIH0KICAgIC8vIOKWsuKWsuKWsi0tLSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEgLS0t4pay4pay4payCgogICAgaXNQYW5uaW5nID0gZmFsc2U7CiAgICBpbml0aWFsUGluY2hEaXN0YW5jZSA9IG51bGw7CgogICAgaWYgKGlzRHJhd2luZ09uU2NyYXRjaHBhZCkgewogICAgICAgIGlzRHJhd2luZ09uU2NyYXRjaHBhZCA9IGZhbHNlOwogICAgICAgIGlmIChjdXJyZW50U3Ryb2tlICYmIGN1cnJlbnRTdHJva2UucG9pbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgc3Ryb2tlcy5wdXNoKGN1cnJlbnRTdHJva2UpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lOC4muC4peC5h+C4reC4geC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4myDilrzilrzilrwKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmA4Liq4LmJ4LiZ4LiX4Li14LmI4LmA4Lie4Li04LmI4LiH4Lin4Liy4LiU4LmA4Liq4Lij4LmH4LiI4LmA4Lib4LmH4LiZIHRyYWlsIOC5g+C4q+C5ieC5gOC4o+C4tOC5iOC4oSBhbmltYXRpb24KaWYgKGN1cnJlbnRTdHJva2UudG9vbCA9PT0gJ3RyYWlsJykgewogICAgLy8g4Lii4LiB4LmA4Lil4Li04LiBIFRpbWVyIOC5gOC4geC5iOC4suC4l+C4teC5iOC4reC4suC4iOC4iOC4sOC4geC4s+C4peC4seC4h+C4l+C4s+C4h+C4suC4mSAo4LiB4Lij4LiT4Li14LiE4Lil4Li04LiB4LmA4Lij4LmH4Lin4LmGKQogICAgaWYgKGxhc2VyRmFkZVRpbWVyKSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KGxhc2VyRmFkZVRpbWVyKTsKICAgIH0KICAgIAogICAgLy8g4LiV4Lix4LmJ4LiHIFRpbWVyIOC5g+C4q+C4oeC5iOC5gOC4nuC4t+C5iOC4reC4meC4seC4muC4luC4reC4ouC4q+C4peC4seC4hwogICAgbGFzZXJGYWRlVGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyDguYDguKHguLfguYjguK0gVGltZXIg4LiX4Liz4LiH4Liy4LiZ4LiI4LiZ4LiE4Lij4LiaICjguKvguKHguLLguKLguITguKfguLLguKHguKfguYjguLLguJzguLnguYnguYPguIrguYnguKvguKLguLjguJTguKfguLLguJTguYHguKXguYnguKcpCiAgICAgICAgLy8gMS4g4LiE4LmJ4LiZ4Lir4Liy4LmA4Liq4LmJ4LiZIHRyYWlsIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4l+C4teC5iOC4ouC4seC4h+C5hOC4oeC5iOC4luC4ueC4geC4quC4seC5iOC4h+C5g+C4q+C5ieC4iOC4suC4h+C4q+C4suC4ogogICAgICAgIGNvbnN0IHN0cm9rZXNUb0ZhZGUgPSBzdHJva2VzLmZpbHRlcihzID0+IHMudG9vbCA9PT0gJ3RyYWlsJyAmJiAhcy5mYWRlU3RhcnRUaW1lKTsKCiAgICAgICAgaWYgKHN0cm9rZXNUb0ZhZGUubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogICAgICAgICAgICAvLyAyLiDguKrguLHguYjguIfguYPguKvguYnguJfguLjguIHguYDguKrguYnguJnguYDguKPguLTguYjguKHguIjguLLguIfguKvguLLguKIg4LiTIOC5gOC4p+C4peC4suC5gOC4lOC4teC4ouC4p+C4geC4seC4mQogICAgICAgICAgICBzdHJva2VzVG9GYWRlLmZvckVhY2gocyA9PiBzLmZhZGVTdGFydFRpbWUgPSBub3cpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gMy4g4LmA4Lij4Li04LmI4LihIEFuaW1hdGlvbiDguIHguLLguKPguIjguLLguIfguKvguLLguKIKICAgICAgICAgICAgc3RhcnRUcmFpbEFuaW1hdGlvbigpOwogICAgICAgIH0KCiAgICB9LCBMQVNFUl9JTkFDVElWSVRZX1RJTUVPVVQpOyAvLyDguKPguK0gMS41IOC4p+C4tOC4meC4suC4l+C4teC4geC5iOC4reC4meC5gOC4o+C4tOC5iOC4oeC4l+C4s+C4h+C4suC4mQp9CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRTdHJva2UgPSBudWxsOwogICAgICAgIHVwZGF0ZVVuZG9SZWRvQnV0dG9ucygpOwogICAgfQp9CgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguIvguLnguKHguJTguYnguKfguKIgTW91c2UgV2hlZWwKZnVuY3Rpb24gaGFuZGxlV2hlZWwoZSkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3Qgc2NhbGVBbW91bnQgPSBlLmRlbHRhWSAqIC0wLjAwNTsKICAgIGNvbnN0IG5ld1NjYWxlID0gTWF0aC5taW4oTWF0aC5tYXgoc2NyYXRjaHBhZFNjYWxlICsgc2NhbGVBbW91bnQsIE1JTl9TQ0FMRSksIE1BWF9TQ0FMRSk7CgogICAgLy8gQWRqdXN0IG9mZnNldCB0byB6b29tIHRvd2FyZHMgdGhlIG1vdXNlIHBvaW50ZXIKICAgIHNjcmF0Y2hwYWRPZmZzZXQueCA9IGUuY2xpZW50WCAtIChlLmNsaWVudFggLSBzY3JhdGNocGFkT2Zmc2V0LngpICogKG5ld1NjYWxlIC8gc2NyYXRjaHBhZFNjYWxlKTsKICAgIHNjcmF0Y2hwYWRPZmZzZXQueSA9IGUuY2xpZW50WSAtIChlLmNsaWVudFkgLSBzY3JhdGNocGFkT2Zmc2V0LnkpICogKG5ld1NjYWxlIC8gc2NyYXRjaHBhZFNjYWxlKTsKCiAgICBzY3JhdGNocGFkU2NhbGUgPSBuZXdTY2FsZTsKICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKfQoKZnVuY3Rpb24gdW5kbygpIHsKICAgIGlmIChzdHJva2VzLmxlbmd0aCA+IDApIHsKICAgICAgICByZWRvU3Ryb2tlcy5wdXNoKHN0cm9rZXMucG9wKCkpOwogICAgICAgIHVwZGF0ZVVuZG9SZWRvQnV0dG9ucygpOwogICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVkbygpIHsKICAgIGlmIChyZWRvU3Ryb2tlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgc3Ryb2tlcy5wdXNoKHJlZG9TdHJva2VzLnBvcCgpKTsKICAgICAgICB1cGRhdGVVbmRvUmVkb0J1dHRvbnMoKTsKICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIHVwZGF0ZVVuZG9SZWRvQnV0dG9ucygpIHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1bmRvLWJ0bicpLmRpc2FibGVkID0gc3Ryb2tlcy5sZW5ndGggPT09IDA7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVkby1idG4nKS5kaXNhYmxlZCA9IHJlZG9TdHJva2VzLmxlbmd0aCA9PT0gMDsKfQoKZnVuY3Rpb24gb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIG9wdGlvbnMpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtbW9kYWwnKTsKICAgIGNvbnN0IHF1ZXN0aW9uRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyYXRjaHBhZC1xdWVzdGlvbicpOwogICAgY29uc3Qgb3B0aW9uc0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtb3B0aW9ucycpOwogICAgY29uc3QgY29udHJvbHNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyYXRjaHBhZC1jb250cm9scycpOyAvLyDguJrguKPguKPguJfguLHguJTguJnguLXguYnguK3guLLguIjguKLguLHguIfguK3guKLguLnguYggKOC5hOC4oeC5iOC5gOC4m+C5h+C4meC5hOC4oykKCiAgICBxdWVzdGlvbkVsLmlubmVySFRNTCA9IHF1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0OwogICAgb3B0aW9uc0VsLmlubmVySFRNTCA9IG9wdGlvbnMubWFwKChvcHQsIGluZGV4KSA9PiBgPGRpdj4ke1N0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBpbmRleCl9LiAke29wdH08L2Rpdj5gKS5qb2luKCcnKTsKICAgIAogICAgLy8g4LmC4LiE4LmJ4LiU4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiHIGlubmVySFRNTCDguILguK3guIcgY29udHJvbHNDb250YWluZXIg4LiW4Li54LiB4Lil4Lia4LmE4Lib4LmB4Lil4LmJ4LinCgogICAgc2V0dXBTY3JhdGNocGFkQ29udHJvbHMoKTsgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LmA4Lie4Li34LmI4Lit4Liq4Lij4LmJ4Liy4LiHIFRvb2xiYXIg4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAKICAgIC8vIOC4o+C4teC5gOC4i+C5h+C4leC4quC4luC4suC4meC4sOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4geC5iOC4reC4meC5gOC4m+C4tOC4lAogICAgc3Ryb2tlcyA9IFtdOwogICAgcmVkb1N0cm9rZXMgPSBbXTsKICAgIGN1cnJlbnRTdHJva2UgPSBudWxsOwogICAgc2NyYXRjaHBhZFNjYWxlID0gMTsKICAgIHNjcmF0Y2hwYWRPZmZzZXQgPSB7IHg6IDAsIHk6IDAgfTsKICAgIAogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBpbml0aWFsaXplU2NyYXRjaHBhZENhbnZhcygpOwogICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgIH0sIDUwKTsKCiAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW3F1ZXN0aW9uRWwsIG9wdGlvbnNFbF0pOwp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAoKLyoqCiAqIFvguYPguKvguKHguYhdIOC5gOC4m+C4tOC4lCBNb2RhbCDguJXguLHguYnguIfguITguYjguLLguKrguLPguKvguKPguLHguJrguKvguJnguYnguLIgQmx1ZXByaW50IOC5geC4peC4sOC4iOC4seC4lOC4geC4suC4o+C4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4iuC4seC5iOC4p+C4hOC4o+C4suC4pwogKi8KLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBvcGVuQmx1ZXByaW50UXVpelNldHRpbmdzIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKLyoqCiAqIFvguYPguKvguKHguYhdIOC5gOC4m+C4tOC4lCBNb2RhbCDguJXguLHguYnguIfguITguYjguLLguInguJrguLHguJrguKrguKHguJrguLnguKPguJPguYzguKrguLPguKvguKPguLHguJrguKvguJnguYnguLIgQmx1ZXByaW50CiAqLwpmdW5jdGlvbiBvcGVuQmx1ZXByaW50UXVpelNldHRpbmdzKCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXNldHRpbmdzLW1vZGFsJyk7CgogICAgLy8gMS4g4LiB4Liz4Lir4LiZ4LiU4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZOiDguYPguIrguYnguITguYjguLLguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYnguIrguLHguYjguKfguITguKPguLLguKcgKOC4luC5ieC4suC4oeC4tSkg4Lir4Lij4Li34Lit4LmD4LiK4LmJ4LiE4LmI4Liy4LiI4Liy4LiB4LmC4Lib4Lij4LmA4LiI4LiE4Lir4Lil4Lix4LiBCiAgICBjb25zdCBzZXR0aW5ncyA9IGJsdWVwcmludFBhZ2VTZXR0aW5ncyB8fCAoY3VycmVudFByb2plY3REYXRhID8gY3VycmVudFByb2plY3REYXRhLnNldHRpbmdzIDoge30pIHx8IHt9OwoKICAgIC8vIDIuIOC4meC4s+C4hOC5iOC4suC5hOC4m+C5g+C4quC5iOC5g+C4meC4n+C4reC4o+C5jOC4oeC4guC4reC4hyBNb2RhbCAo4LmD4LiK4LmJIElEIOC4l+C4teC5iOC4oeC4tSBicC1tb2RhbC0g4LiZ4Liz4Lir4LiZ4LmJ4LiyKQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXF1aXotdHlwZS1zZWxlY3QnKS52YWx1ZSA9IHNldHRpbmdzLnF1aXpUeXBlIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXR5cGUtc2VsZWN0JykudmFsdWU7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtZGlmZmljdWx0eS1sZXZlbC1zZWxlY3QnKS5pbm5lckhUTUwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlmZmljdWx0eS1sZXZlbC1zZWxlY3QnKS5pbm5lckhUTUw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtZGlmZmljdWx0eS1sZXZlbC1zZWxlY3QnKS52YWx1ZSA9IHNldHRpbmdzLmRpZmZpY3VsdHlWYWx1ZSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlmZmljdWx0eS1sZXZlbC1zZWxlY3QnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1xdWVzdGlvbi1jb21wbGV4aXR5LXNlbGVjdCcpLmlubmVySFRNTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWVzdGlvbi1jb21wbGV4aXR5LXNlbGVjdCcpLmlubmVySFRNTDsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1xdWVzdGlvbi1jb21wbGV4aXR5LXNlbGVjdCcpLnZhbHVlID0gc2V0dGluZ3MuY29tcGxleGl0eVZhbHVlIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWVzdGlvbi1jb21wbGV4aXR5LXNlbGVjdCcpLnZhbHVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLW51bS1xdWVzdGlvbnMnKS52YWx1ZSA9IHNldHRpbmdzLm51bVF1ZXN0aW9ucyB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpLnZhbHVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXBhc3Npbmctc2NvcmUtaW5wdXQnKS52YWx1ZSA9IHNldHRpbmdzLnBhc3NpbmdTY29yZSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc2luZy1zY29yZS1pbnB1dCcpLnZhbHVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLW51bS1jaG9pY2VzJykudmFsdWUgPSBzZXR0aW5ncy5udW1DaG9pY2VzIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW0tY2hvaWNlcycpLnZhbHVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLXNodWZmbGUtc2V0dGluZy1zZWxlY3QnKS52YWx1ZSA9IHNldHRpbmdzLnNodWZmbGUgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NodWZmbGUtc2V0dGluZy1zZWxlY3QnKS52YWx1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1pbmNsdWRlLWltYWdlcy1jaGVja2JveCcpLmNoZWNrZWQgPSBzZXR0aW5ncy5pbmNsdWRlSW1hZ2VzIHx8IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmNsdWRlLWltYWdlcy1jaGVja2JveCcpLmNoZWNrZWQ7CgogICAgLy8gMy4g4LmB4Liq4LiU4LiHIE1vZGFsCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5g+C4mSA8c2NyaXB0PiDilrzilrzilrwKLyoqCiAqIFvguYPguKvguKHguYhdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4iOC4suC4gSBNb2RhbCDguKXguIfguYPguJnguJXguLHguKfguYHguJvguKPguIrguLHguYjguKfguITguKPguLLguKcgYmx1ZXByaW50UGFnZVNldHRpbmdzCiAqLwpmdW5jdGlvbiBoYW5kbGVTYXZlQmx1ZXByaW50UGFnZVNldHRpbmdzKCkgewogICAgYmx1ZXByaW50UGFnZVNldHRpbmdzID0gewogICAgICAgIHF1aXpUeXBlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtcXVpei10eXBlLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIGRpZmZpY3VsdHlWYWx1ZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLWRpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykudmFsdWUsCiAgICAgICAgY29tcGxleGl0eVZhbHVlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtcXVlc3Rpb24tY29tcGxleGl0eS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICBudW1RdWVzdGlvbnM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1udW0tcXVlc3Rpb25zJykudmFsdWUsCiAgICAgICAgcGFzc2luZ1Njb3JlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtbW9kYWwtcGFzc2luZy1zY29yZS1pbnB1dCcpLnZhbHVlLAogICAgICAgIG51bUNob2ljZXM6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1udW0tY2hvaWNlcycpLnZhbHVlLAogICAgICAgIHNodWZmbGU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1tb2RhbC1zaHVmZmxlLXNldHRpbmctc2VsZWN0JykudmFsdWUsCiAgICAgICAgaW5jbHVkZUltYWdlczogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLW1vZGFsLWluY2x1ZGUtaW1hZ2VzLWNoZWNrYm94JykuY2hlY2tlZCwKICAgIH07CgogICAgc2hvd01lc3NhZ2UoIuC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC5g+C4meC4q+C4meC5ieC4suC4meC4teC5ieC5geC4peC5ieC4pyIpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zZXR0aW5ncy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9CgovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C5guC4hOC5ieC4lOC4iuC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lOC5gOC4guC5ieC4suC5hOC4m+C5g+C4mSA8c2NyaXB0PiDilrzilrzilrwKCi8qKgogKiBbUGFyYWxsZWwgU2hvcnRjdXRzXSDguYDguKPguLTguYjguKHguJ/guLHguIfguILguYnguK3guKHguLnguKXguJvguLjguYjguKHguKXguLHguJTguIjguLLguIEgRmlyZXN0b3JlCiAqLwpmdW5jdGlvbiBsaXN0ZW5Gb3JQYXJhbGxlbFRlc3RTaG9ydGN1dHMoKSB7CiAgICBjb25zdCBzaG9ydGN1dHNSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKCiAgICBvblNuYXBzaG90KHNob3J0Y3V0c1JlZiwgKGRvY1NuYXApID0+IHsKICAgICAgICBsZXQgc2hvcnRjdXRzID0gW107CiAgICAgICAgbGV0IHRhYnMgPSBbXTsKICAgICAgICBsZXQgb3JkZXIgPSB7fTsKCiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBzaG9ydGN1dHMgPSBkYXRhLnNob3J0Y3V0cyB8fCBbXTsKICAgICAgICAgICAgdGFicyA9IGRhdGEucGFyYWxsZWxTaG9ydGN1dFRhYnMgfHwgW107IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXQogICAgICAgICAgICBvcmRlciA9IGRhdGEucGFyYWxsZWxTaG9ydGN1dE9yZGVyIHx8IHt9OyAgIC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXQogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWJzLmZpbmQodCA9PiB0LmlkID09PSAnYWxsJykpIHsKICAgICAgICAgICAgdGFicy51bnNoaWZ0KHsgaWQ6ICdhbGwnLCBuYW1lOiAn4LiV4LmJ4LiZ4LiJ4Lia4Lix4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUJywgaXNEZWZhdWx0OiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdwYXJhbGxlbC1kZWZhdWx0LTEnKSkgewogICAgICAgICAgICBzaG9ydGN1dHMudW5zaGlmdCh7IGlkOiAncGFyYWxsZWwtZGVmYXVsdC0xJywgbmFtZTogJ+C4leC5ieC4meC4ieC4muC4seC4miAxJywgdXJsOiAnJywgaXNEZWZhdWx0OiB0cnVlIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoIXNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gJ3BhcmFsbGVsLWRlZmF1bHQtMicpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdwYXJhbGxlbC1kZWZhdWx0LTInLCBuYW1lOiAn4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaIDInLCB1cmw6ICcnLCBpc0RlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgfQoKICAgICAgICBwYXJhbGxlbFRlc3RTaG9ydGN1dHMgPSBzaG9ydGN1dHM7CiAgICAgICAgcGFyYWxsZWxTaG9ydGN1dFRhYnMgPSB0YWJzOyAvLyA8LS0gW+C5geC4geC5ieC5hOC4gl0KICAgICAgICBwYXJhbGxlbFNob3J0Y3V0T3JkZXIgPSBvcmRlcjsgLy8gPC0tIFvguYHguIHguYnguYTguIJdCgogICAgICAgIHJlbmRlclBhcmFsbGVsVGVzdFNob3J0Y3V0cygpOwoKICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHsKICAgICAgICAgICAgcmVuZGVyQWRkaXRpb25hbFBhcmFsbGVsU2hvcnRjdXRzTW9kYWwoKTsgLy8gPC0tIFvguYHguIHguYnguYTguIJdCiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCBb4LmD4Lir4Lih4LmIXSDguYDguJ7guLTguYjguKHguIrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKMgUGFyYWxsZWwgVGVzdCBTaG9ydGN1dCBUYWJzIOC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKCmFzeW5jIGZ1bmN0aW9uIHNhdmVQYXJhbGxlbFNob3J0Y3V0Q29uZmlnKCkgewogICAgY29uc3QgY29uZmlnUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAicGFyYWxsZWxUZXN0U2hvcnRjdXRzQ29uZmlnIik7CiAgICB0cnkgewogICAgICAgIGF3YWl0IHNldERvYyhjb25maWdSZWYsIHsgCiAgICAgICAgICAgIHBhcmFsbGVsU2hvcnRjdXRUYWJzOiBwYXJhbGxlbFNob3J0Y3V0VGFicywKICAgICAgICAgICAgcGFyYWxsZWxTaG9ydGN1dE9yZGVyOiBwYXJhbGxlbFNob3J0Y3V0T3JkZXIKICAgICAgICB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgfSBjYXRjaCAoZXJyb3IpIHsgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHBhcmFsbGVsIHNob3J0Y3V0IGNvbmZpZzoiLCBlcnJvcik7IH0KfQoKZnVuY3Rpb24gcmVuZGVyQWRkaXRpb25hbFBhcmFsbGVsU2hvcnRjdXRzTW9kYWwoKSB7CiAgICBjb25zdCBuYXZDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtdGFicy1uYXYnKTsKICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtbGlzdCcpOwogICAgaWYgKCFuYXZDb250YWluZXIgfHwgIWxpc3RDb250YWluZXIpIHJldHVybjsKCiAgICBuYXZDb250YWluZXIuaW5uZXJIVE1MID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMubWFwKHRhYiA9PiB7CiAgICAgICAgY29uc3QgaXNBY3RpdmUgPSB0YWIuaWQgPT09IGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZDsKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtdGFiLWlkPSIke3RhYi5pZH0iIGNsYXNzPSJwYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuIHdoaXRlc3BhY2Utbm93cmFwIHB5LTMgcHgtMiBib3JkZXItYi0yIGZvbnQtbWVkaXVtIHRleHQtc20gJHtpc0FjdGl2ZSA/ICdib3JkZXItaW5kaWdvLTUwMCB0ZXh0LWluZGlnby02MDAnIDogJ2JvcmRlci10cmFuc3BhcmVudCB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtZ3JheS03MDAgaG92ZXI6Ym9yZGVyLWdyYXktMzAwJ30iPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGFiLW5hbWUtZGlzcGxheSBwb2ludGVyLWV2ZW50cy1ub25lIj4ke3RhYi5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHZhbHVlPSIke3RhYi5uYW1lfSIgY2xhc3M9InRhYi1uYW1lLWlucHV0IGhpZGRlbiBiZy10cmFuc3BhcmVudCBib3JkZXItYi0yIGJvcmRlci1pbmRpZ28tNTAwIHRleHQtc20gdy0zMiI+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgJHshdGFiLmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtdGFiLWlkPSIke3RhYi5pZH0iIGNsYXNzPSJkZWxldGUtcGFyYWxsZWwtc2hvcnRjdXQtdGFiLWJ0biBhYnNvbHV0ZSAtdG9wLTEgLXJpZ2h0LTEgdGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTcwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgY29uc3QgYWN0aXZlVGFiID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZCk7CiAgICBsZXQgc2hvcnRjdXRzVG9TaG93ID0gYWN0aXZlVGFiPy5pc0RlZmF1bHQgPyBbLi4ucGFyYWxsZWxUZXN0U2hvcnRjdXRzXSA6IHBhcmFsbGVsVGVzdFNob3J0Y3V0cy5maWx0ZXIocyA9PiAoYWN0aXZlVGFiPy5zaG9ydGN1dElkcyB8fCBbXSkuaW5jbHVkZXMocy5pZCkpOwogICAgCiAgICBjb25zdCBjdXJyZW50T3JkZXIgPSBwYXJhbGxlbFNob3J0Y3V0T3JkZXJbYWN0aXZlUGFyYWxsZWxTaG9ydGN1dFRhYklkXSB8fCBbXTsKICAgIHNob3J0Y3V0c1RvU2hvdy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgY29uc3QgaW5kZXhBID0gY3VycmVudE9yZGVyLmluZGV4T2YoYS5pZCk7CiAgICAgICAgY29uc3QgaW5kZXhCID0gY3VycmVudE9yZGVyLmluZGV4T2YoYi5pZCk7CiAgICAgICAgcmV0dXJuIChpbmRleEEgPT09IC0xID8gSW5maW5pdHkgOiBpbmRleEEpIC0gKGluZGV4QiA9PT0gLTEgPyBJbmZpbml0eSA6IGluZGV4Qik7CiAgICB9KTsKCiAgICBsaXN0Q29udGFpbmVyLmlubmVySFRNTCA9IHNob3J0Y3V0c1RvU2hvdy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGNvbnN0IGljb24gPSBzaG9ydGN1dC51cmwgPyAn8J+UgScgOiAn8J+Ulyc7CiAgICAgICAgY29uc3Qgb3RoZXJUYWJzID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gIXQuaXNEZWZhdWx0KTsKICAgICAgICBjb25zdCBtb3ZlRHJvcGRvd25IVE1MID0gYWN0aXZlVGFiLmlzRGVmYXVsdCAmJiBvdGhlclRhYnMubGVuZ3RoID4gMCA/IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgaW5saW5lLWJsb2NrIHRleHQtbGVmdCBncm91cC9kcm9wZG93bi1wYXJhbGxlbCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJtb3ZlLXBhcmFsbGVsLXNob3J0Y3V0LW1lbnUtYnRuIHRleHQtZ3JheS01MDAgaG92ZXI6dGV4dC1ibHVlLTcwMCBwLTEgcm91bmRlZC1mdWxsIHRleHQtc20iPjxpIGNsYXNzPSJmYXMgZmEtZWxsaXBzaXMtdiI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1kcm9wZG93biBvcmlnaW4tdG9wLXJpZ2h0IGFic29sdXRlIHJpZ2h0LTAgbXQtMiB3LTQ4IHJvdW5kZWQtbWQgc2hhZG93LWxnIGJnLXdoaXRlIHJpbmctMSByaW5nLWJsYWNrIHJpbmctb3BhY2l0eS01IGhpZGRlbiB6LTIwIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJweS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InB4LTQgcHQtMSBwYi0yIHRleHQteHMgdGV4dC1ncmF5LTQwMCI+4LmA4Lie4Li04LmI4Lih4LmE4Lib4Lii4Lix4LiH4LmB4LiX4LmH4LiaOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdGhlclRhYnMubWFwKHRhYiA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9Im1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtaXRlbSBibG9jayBweC00IHB5LTIgdGV4dC1zbSB0ZXh0LWdyYXktNzAwIGhvdmVyOmJnLWdyYXktMTAwIiBkYXRhLXNob3J0Y3V0LWlkPSIke3Nob3J0Y3V0LmlkfSIgZGF0YS10YXJnZXQtdGFiLWlkPSIke3RhYi5pZH0iPiR7dGFiLm5hbWV9PC9hPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PmAgOiAnJzsKCiAgICAgICAgcmV0dXJuIGA8ZGl2IGNsYXNzPSJzaG9ydGN1dC1saXN0LWl0ZW0gcC0zIGJvcmRlci1iIGhvdmVyOmJnLWdyYXktNTAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIiBkYXRhLXNob3J0Y3V0LWlkPSIke3Nob3J0Y3V0LmlkfSIgZHJhZ2dhYmxlPSJ0cnVlIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PjxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtdGVhbC03MDAiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJ1c2UtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBiZy10ZWFsLTEwMCB0ZXh0LXRlYWwtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctdGVhbC0yMDAiPuC4quC4o+C5ieC4suC4h+C5gOC4peC4ojwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1oaWRkZW4tcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmcteWVsbG93LTIwMCI+4LmB4LiB4LmJ4LmE4LiCPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICR7IXNob3J0Y3V0LmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4gYmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtMjAwIj7guKXguJo8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICAgICAgICAgICR7IWFjdGl2ZVRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXNob3J0Y3V0LWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InJlbW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1mcm9tLXRhYi1idG4gdGV4dC1yZWQtNTAwIG1sLTIiIHRpdGxlPSLguJnguLPguK3guK3guIHguIjguLLguIHguYHguJfguYfguJrguJnguLXguYkiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIj48L2k+PC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAke21vdmVEcm9wZG93bkhUTUx9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJykgfHwgJzxwIGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lih4Li14Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4LiZ4LmB4LiX4LmH4Lia4LiZ4Li14LmJPC9wPic7CiAgICAKICAgIHNldHVwUGFyYWxsZWxTaG9ydGN1dE1vZGFsRXZlbnRMaXN0ZW5lcnMoKTsKfQoKZnVuY3Rpb24gc2V0dXBQYXJhbGxlbFNob3J0Y3V0TW9kYWxFdmVudExpc3RlbmVycygpIHsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5vbmNsaWNrID0gZSA9PiB7IGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOyByZW5kZXJBZGRpdGlvbmFsUGFyYWxsZWxTaG9ydGN1dHNNb2RhbCgpOyB9OwogICAgICAgIGJ0bi5vbmRibGNsaWNrID0gZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1pbnB1dCcpOwogICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcignLnRhYi1uYW1lLWRpc3BsYXknKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7IGlucHV0LmZvY3VzKCk7IGlucHV0LnNlbGVjdCgpOwogICAgICAgIH07CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNwYXJhbGxlbC1zaG9ydGN1dC10YWJzLW5hdiAudGFiLW5hbWUtaW5wdXQnKS5mb3JFYWNoKGlucHV0ID0+IHsKICAgICAgICBjb25zdCBzYXZlID0gKCkgPT4gewogICAgICAgICAgICBjb25zdCB0YWJJZCA9IGlucHV0LmNsb3Nlc3QoJy5wYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuJykuZGF0YXNldC50YWJJZDsKICAgICAgICAgICAgY29uc3QgdGFiID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhYklkKTsKICAgICAgICAgICAgaWYodGFiKSB7IHRhYi5uYW1lID0gaW5wdXQudmFsdWUudHJpbSgpIHx8IHRhYi5uYW1lOyBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpOyB9CiAgICAgICAgfTsKICAgICAgICBpbnB1dC5vbmJsdXIgPSBzYXZlOwogICAgICAgIGlucHV0Lm9ua2V5ZG93biA9IGUgPT4geyBpZiAoZS5rZXkgPT09ICdFbnRlcicpIGlucHV0LmJsdXIoKTsgfTsKICAgIH0pOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGV0ZS1wYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBjb25zdCB0YWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oIuC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC5geC4l+C5h+C4muC4meC4teC5iT8iLCAoKSA9PiB7CiAgICAgICAgICAgIHBhcmFsbGVsU2hvcnRjdXRUYWJzID0gcGFyYWxsZWxTaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gdC5pZCAhPT0gdGFiSWQpOwogICAgICAgICAgICBkZWxldGUgcGFyYWxsZWxTaG9ydGN1dE9yZGVyW3RhYklkXTsKICAgICAgICAgICAgaWYgKGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZCA9PT0gdGFiSWQpIGFjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZCA9ICdhbGwnOwogICAgICAgICAgICBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpOwogICAgICAgIH0pOwogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1pdGVtJykuZm9yRWFjaChpdGVtID0+IGl0ZW0ub25jbGljayA9IGUgPT4gewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBjb25zdCB7IHNob3J0Y3V0SWQsIHRhcmdldFRhYklkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldDsKICAgICAgICBjb25zdCB0YWIgPSBwYXJhbGxlbFNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFyZ2V0VGFiSWQpOwogICAgICAgIGlmKHRhYiAmJiAhdGFiLnNob3J0Y3V0SWRzLmluY2x1ZGVzKHNob3J0Y3V0SWQpKSB7IHRhYi5zaG9ydGN1dElkcy5wdXNoKHNob3J0Y3V0SWQpOyBzYXZlUGFyYWxsZWxTaG9ydGN1dENvbmZpZygpOyB9CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZW1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtZnJvbS10YWItYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBjb25zdCBzaG9ydGN1dElkID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuc2hvcnRjdXRJZDsKICAgICAgICBjb25zdCB0YWIgPSBwYXJhbGxlbFNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gYWN0aXZlUGFyYWxsZWxTaG9ydGN1dFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5pc0RlZmF1bHQpIHsgdGFiLnNob3J0Y3V0SWRzID0gdGFiLnNob3J0Y3V0SWRzLmZpbHRlcihpZCA9PiBpZCAhPT0gc2hvcnRjdXRJZCk7IHNhdmVQYXJhbGxlbFNob3J0Y3V0Q29uZmlnKCk7IH0KICAgIH0pOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtcGFyYWxsZWwtc2hvcnRjdXQtbWVudS1idG4nKS5mb3JFYWNoKGJ0biA9PiBidG4ub25jbGljayA9IGUgPT4gewogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgY29uc3QgZHJvcGRvd24gPSBlLmN1cnJlbnRUYXJnZXQubmV4dEVsZW1lbnRTaWJsaW5nOwogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb3ZlLXBhcmFsbGVsLXNob3J0Y3V0LWRyb3Bkb3duJykuZm9yRWFjaChkID0+IGQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgIGRyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfSk7CiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtcGFyYWxsZWwtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGxldCBkcmFnZ2VkSXRlbSA9IG51bGw7CiAgICBsaXN0Q29udGFpbmVyLm9uZHJhZ3N0YXJ0ID0gZSA9PiB7CiAgICAgICAgZHJhZ2dlZEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcuc2hvcnRjdXQtbGlzdC1pdGVtJyk7CiAgICAgICAgaWYoZHJhZ2dlZEl0ZW0pIHNldFRpbWVvdXQoKCkgPT4gZHJhZ2dlZEl0ZW0uY2xhc3NMaXN0LmFkZCgnb3BhY2l0eS01MCcpLCAwKTsKICAgIH07CiAgICBsaXN0Q29udGFpbmVyLm9uZHJhZ2VuZCA9ICgpID0+IHsgaWYoZHJhZ2dlZEl0ZW0pIHsgZHJhZ2dlZEl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS01MCcpOyBkcmFnZ2VkSXRlbSA9IG51bGw7IH19OwogICAgbGlzdENvbnRhaW5lci5vbmRyYWdvdmVyID0gZSA9PiB7IGUucHJldmVudERlZmF1bHQoKTsgfTsKICAgIGxpc3RDb250YWluZXIub25kcm9wID0gZSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGlmIChkcmFnZ2VkSXRlbSkgewogICAgICAgICAgICBjb25zdCBhZnRlckVsZW1lbnQgPSBbLi4ubGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuc2hvcnRjdXQtbGlzdC1pdGVtOm5vdCgub3BhY2l0eS01MCknKV0ucmVkdWNlKChjbG9zZXN0LCBjaGlsZCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYm94ID0gY2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBlLmNsaWVudFkgLSBib3gudG9wIC0gYm94LmhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICByZXR1cm4gKG9mZnNldCA8IDAgJiYgb2Zmc2V0ID4gY2xvc2VzdC5vZmZzZXQpID8geyBvZmZzZXQ6IG9mZnNldCwgZWxlbWVudDogY2hpbGQgfSA6IGNsb3Nlc3Q7CiAgICAgICAgICAgIH0sIHsgb2Zmc2V0OiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgfSkuZWxlbWVudDsKICAgICAgICAgICAgaWYgKGFmdGVyRWxlbWVudCA9PSBudWxsKSB7IGxpc3RDb250YWluZXIuYXBwZW5kQ2hpbGQoZHJhZ2dlZEl0ZW0pOyB9IAogICAgICAgICAgICBlbHNlIHsgbGlzdENvbnRhaW5lci5pbnNlcnRCZWZvcmUoZHJhZ2dlZEl0ZW0sIGFmdGVyRWxlbWVudCk7IH0KICAgICAgICAgICAgY29uc3QgbmV3T3JkZXIgPSBbLi4ubGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuc2hvcnRjdXQtbGlzdC1pdGVtJyldLm1hcChpdGVtID0+IGl0ZW0uZGF0YXNldC5zaG9ydGN1dElkKTsKICAgICAgICAgICAgcGFyYWxsZWxTaG9ydGN1dE9yZGVyW2FjdGl2ZVBhcmFsbGVsU2hvcnRjdXRUYWJJZF0gPSBuZXdPcmRlcjsKICAgICAgICAgICAgc2F2ZVBhcmFsbGVsU2hvcnRjdXRDb25maWcoKTsKICAgICAgICB9CiAgICB9Owp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVBZGRQYXJhbGxlbFNob3J0Y3V0VGFiKCkgewogICAgY29uc3QgbmFtZSA9IHByb21wdCgi4LiB4Lij4Li44LiT4Liy4LiV4Lix4LmJ4LiH4LiK4Li34LmI4Lit4LmB4LiX4LmH4Lia4LmD4Lir4Lih4LmIOiIsICLguYHguJfguYfguJrguYPguKvguKHguYgiKTsKICAgIGlmIChuYW1lICYmIG5hbWUudHJpbSgpKSB7CiAgICAgICAgcGFyYWxsZWxTaG9ydGN1dFRhYnMucHVzaCh7IGlkOiBgdGFiXyR7RGF0ZS5ub3coKX1gLCBuYW1lOiBuYW1lLnRyaW0oKSwgc2hvcnRjdXRJZHM6IFtdIH0pOwogICAgICAgIGF3YWl0IHNhdmVQYXJhbGxlbFNob3J0Y3V0Q29uZmlnKCk7CiAgICB9Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4iuC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCmZ1bmN0aW9uIHJlbmRlclBhcmFsbGVsVGVzdFNob3J0Y3V0cygpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1jb250YWluZXInKTsKICAgIGNvbnN0IGFkZGl0aW9uYWxMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtcGFyYWxsZWwtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGNvbnN0IGxvYWRpbmdNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXRzLWxvYWRpbmctbXNnJyk7CgogICAgaWYgKGxvYWRpbmdNc2cpIGxvYWRpbmdNc2cuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBpZiAoIWNvbnRhaW5lciB8fCAhYWRkaXRpb25hbExpc3QpIHJldHVybjsKCiAgICBjb25zdCB2aXNpYmxlU2hvcnRjdXRzID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLnNsaWNlKDAsIDQpOwogICAgY29uc3QgaGlkZGVuU2hvcnRjdXRzID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLnNsaWNlKDQpOwoKICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSB2aXNpYmxlU2hvcnRjdXRzLm1hcChzaG9ydGN1dCA9PiB7CiAgICAgICAgY29uc3QgaGFzVXJsID0gc2hvcnRjdXQudXJsICYmIHNob3J0Y3V0LnVybC50cmltKCkgIT09ICcnOwogICAgICAgIGNvbnN0IGJnQ29sb3IgPSBoYXNVcmwgPyAnYmctdGVhbC01MDAgaG92ZXI6YmctdGVhbC02MDAgdGV4dC13aGl0ZScgOiAnYmctZ3JheS0yMDAgaG92ZXI6YmctZ3JheS0zMDAgdGV4dC1ncmF5LTcwMCc7CiAgICAgICAgY29uc3QgaWNvbiA9IGhhc1VybCA/ICfwn5SBJyA6ICfwn5SXJzsKCiAgICAgICAgY29uc3QgZGVsZXRlQnRuSHRtbCA9ICFzaG9ydGN1dC5pc0RlZmF1bHQgPyAKICAgICAgICAgICAgYDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJkZWxldGUtcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGFic29sdXRlIHRvcC0xIHJpZ2h0LTEgdy02IGgtNiBiZy1yZWQtNTAwIHRleHQtd2hpdGUgcm91bmRlZC1mdWxsIHRleHQteHMgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eSIgdGl0bGU9IuC4peC4miI+JnRpbWVzOzwvYnV0dG9uPmAgOiAnJzsKCiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgZ3JvdXAiPgogICAgICAgICAgICAgICAgPGRpdiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InBhcmFsbGVsLXNob3J0Y3V0LWJ0biByb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IGgtMjQgJHtiZ0NvbG9yfSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBvaW50ZXItZXZlbnRzLW5vbmUiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGFic29sdXRlIGJvdHRvbS0xIHJpZ2h0LTEgdy02IGgtNiBiZy13aGl0ZS81MCB0ZXh0LWdyYXktODAwIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguYHguIHguYnguYTguIIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAke2RlbGV0ZUJ0bkh0bWx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9KS5qb2luKCcnKTsKCiAgICBpZiAoaGlkZGVuU2hvcnRjdXRzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MICs9IGAKICAgICAgICAgICAgPGRpdiBpZD0ib3Blbi1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4iIGNsYXNzPSJyb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IGgtMjQgYmctZ3JheS0xMDAgaG92ZXI6YmctZ3JheS0yMDAgdGV4dC1ncmF5LTYwMCI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLWggdGV4dC14bCI+PC9pPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im10LTIgdGV4dC1zbSI+4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmA4Lie4Li04LmI4Lih4LmA4LiV4Li04LihPC9zcGFuPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfQoKICAgIGlmIChoaWRkZW5TaG9ydGN1dHMubGVuZ3RoID4gMCkgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9IGhpZGRlblNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtdGVhbC03MDAiPiR7c2hvcnRjdXQudXJsID8gJ/CflIEnIDogJ/CflJcnfSAke3Nob3J0Y3V0Lm5hbWV9PC9wPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJ1c2UtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0biBiZy10ZWFsLTEwMCB0ZXh0LXRlYWwtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctdGVhbC0yMDAiPuC4quC4o+C5ieC4suC4h+C5gOC4peC4ojwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJlZGl0LWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4gYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctMjAwIj7guYHguIHguYnguYTguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tcGFyYWxsZWwtc2hvcnRjdXQtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCI+4Lil4LiaPC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGApLmpvaW4oJycpOwogICAgfSBlbHNlIHsKICAgICAgICBhZGRpdGlvbmFsTGlzdC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguJvguLjguYjguKHguKXguLHguJTguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L3A+JzsKICAgIH0KfQoKLyoqCiAqIFtQYXJhbGxlbCBTaG9ydGN1dHNdIOC5gOC4m+C4tOC4lCBNb2RhbCDguKrguLPguKvguKPguLHguJrguYHguIHguYnguYTguILguKvguKPguLfguK3guYDguJ7guLTguYjguKHguJvguLjguYjguKHguKXguLHguJTguYPguKvguKHguYgKICovCmZ1bmN0aW9uIG9wZW5QYXJhbGxlbFRlc3RTaG9ydGN1dEVkaXRvcihzaG9ydGN1dElkID0gbnVsbCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtZWRpdG9yLW1vZGFsJyk7CiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1tb2RhbC10aXRsZScpOwogICAgY29uc3QgaWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1pZC1pbnB1dCcpOwogICAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LW5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IHVybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LXVybC1pbnB1dCcpOwoKICAgIGlmIChzaG9ydGN1dElkKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXQgPSBwYXJhbGxlbFRlc3RTaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09IHNob3J0Y3V0SWQpOwogICAgICAgIGlmICghc2hvcnRjdXQpIHJldHVybjsKICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9ICfguYHguIHguYnguYTguILguJvguLjguYjguKHguKXguLHguJTguILguYnguK3guKrguK3guJrguJXguYnguJnguInguJrguLHguJonOwogICAgICAgIGlkSW5wdXQudmFsdWUgPSBzaG9ydGN1dC5pZDsKICAgICAgICBuYW1lSW5wdXQudmFsdWUgPSBzaG9ydGN1dC5uYW1lOwogICAgICAgIHVybElucHV0LnZhbHVlID0gc2hvcnRjdXQudXJsIHx8ICcnOwogICAgfSBlbHNlIHsKICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9ICfguYDguJ7guLTguYjguKHguJvguLjguYjguKHguKXguLHguJTguILguYnguK3guKrguK3guJrguJXguYnguJnguInguJrguLHguJonOwogICAgICAgIGlkSW5wdXQudmFsdWUgPSAnJzsgbmFtZUlucHV0LnZhbHVlID0gJyc7IHVybElucHV0LnZhbHVlID0gJyc7CiAgICB9CiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKLyoqCiAqIFtQYXJhbGxlbCBTaG9ydGN1dHNdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4h+C4iOC4suC4gSBNb2RhbCDguKXguIcgRmlyZWJhc2UKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVQYXJhbGxlbFRlc3RTaG9ydGN1dENoYW5nZXMoKSB7CiAgICBjb25zdCBpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1pZC1pbnB1dCcpLnZhbHVlOwogICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1uYW1lLWlucHV0JykudmFsdWUudHJpbSgpOwogICAgY29uc3QgdXJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXNob3J0Y3V0LXVybC1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKCiAgICBpZiAoIW5hbWUpIHsgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4geC4o+C4reC4gSAn4LiK4Li34LmI4Lit4Lib4Li44LmI4Lih4Lil4Lix4LiUJyIpOyByZXR1cm47IH0KCiAgICBjb25zdCBuZXdTaG9ydGN1dERhdGEgPSB7CiAgICAgICAgaWQ6IGlkIHx8IGBwYXJhbGxlbC1zaG9ydGN1dF8ke0RhdGUubm93KCl9YCwKICAgICAgICBuYW1lOiBuYW1lLCB1cmw6IHVybCwgaXNEZWZhdWx0OiBpZC5zdGFydHNXaXRoKCdwYXJhbGxlbC1kZWZhdWx0LScpCiAgICB9OwoKICAgIGxldCB1cGRhdGVkU2hvcnRjdXRzOwogICAgaWYgKGlkKSB7CiAgICAgICAgdXBkYXRlZFNob3J0Y3V0cyA9IHBhcmFsbGVsVGVzdFNob3J0Y3V0cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IG5ld1Nob3J0Y3V0RGF0YSA6IHMpOwogICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gWy4uLnBhcmFsbGVsVGVzdFNob3J0Y3V0cywgbmV3U2hvcnRjdXREYXRhXTsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBzaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFyYWxsZWwtc2hvcnRjdXQtZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBwYXJhbGxlbCBzaG9ydGN1dDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9CgovKioKICogW1BhcmFsbGVsIFNob3J0Y3V0c10g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Lir4Lil4Lix4LiB4LmA4Lih4Li34LmI4Lit4LiE4Lil4Li04LiB4LiX4Li14LmI4Lib4Li44LmI4Lih4Lil4Lix4LiUOiDguYLguKvguKXguJTguYTguJ/guKXguYzguYHguKXguLDguYDguKPguLTguYjguKHguKrguKPguYnguLLguIfguJfguLHguJnguJfguLUKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVBhcmFsbGVsVGVzdFNob3J0Y3V0Q2xpY2soc2hvcnRjdXRJZCkgewogICAgY29uc3Qgc2hvcnRjdXQgPSBwYXJhbGxlbFRlc3RTaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09IHNob3J0Y3V0SWQpOwogICAgaWYgKCFzaG9ydGN1dCkgcmV0dXJuOwoKICAgIGlmICghc2hvcnRjdXQudXJsIHx8IHNob3J0Y3V0LnVybC50cmltKCkgPT09ICcnKSB7CiAgICAgICAgb3BlblBhcmFsbGVsVGVzdFNob3J0Y3V0RWRpdG9yKHNob3J0Y3V0SWQpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIAogICAgLy8g4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiU4LiX4Li14LmI4Liq4LmI4Lin4LiZ4LiB4Lil4Liy4LiHCiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1nZW5lcmF0aW9uLWFyZWEnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZWQtcXVpei1jb250YWluZXInKS5pbm5lckhUTUwgPSAnJzsKICAgIGxvYWRlci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSAn4LiB4Liz4Lil4Lix4LiH4LiU4Li24LiH4LmE4Lif4Lil4LmM4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmM4LmB4Lil4Liw4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZLi4uJzsKCnRyeSB7CiAgICAgICAgLy8gLS0tIFtTVEFSVF0g4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4meC4suC4oeC4quC4geC4uOC4peC4iOC4suC4gSBVUkwg4LmC4LiU4Lii4LiV4Lij4LiH4LmB4Lil4Liw4LiB4Liz4Lir4LiZ4LiU4LiK4Li34LmI4Lit4LmE4Lif4Lil4LmM4LmD4Lir4LmJ4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAgICAgbGV0IGZpbGVuYW1lOwogICAgICAgIGlmIChzaG9ydGN1dC51cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnLnR4dCcpKSB7CiAgICAgICAgICAgIGZpbGVuYW1lID0gInNvdXJjZV9kb2N1bWVudC50eHQiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguYPguKvguYnguJbguLfguK3guKfguYjguLLguYDguJvguYfguJkgUERGICjguIvguLbguYjguIfguYDguJvguYfguJnguJ7guKTguJXguLTguIHguKPguKPguKHguYDguJTguLTguKHguJfguLXguYjguJfguLPguIfguLLguJnguYTguJTguYnguJTguLXguK3guKLguLnguYjguYHguKXguYnguKcpCiAgICAgICAgICAgIGZpbGVuYW1lID0gInNvdXJjZV9kb2N1bWVudC5wZGYiOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCBmaWxlT2JqZWN0ID0gYXdhaXQgZmV0Y2hGaWxlRnJvbVVybChzaG9ydGN1dC51cmwsIGZpbGVuYW1lKTsKICAgICAgICAKICAgICAgICAvLyAqKuC4iOC4uOC4lOC5gOC4iuC4t+C5iOC4reC4oeC4leC5iOC4reC4l+C4teC5iOC4quC4s+C4hOC4seC4jToqKiDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlR2VuZXJhdGVQYXJhbGxlbFRlc3Qg4LmC4LiU4Lii4LiV4Lij4LiHCiAgICAgICAgLy8g4LmB4Lil4Liw4Liq4LmI4LiHIEZpbGUgb2JqZWN0IOC4l+C4teC5iOC5hOC4lOC5ieC5gOC4guC5ieC4suC5hOC4m+C5gOC4m+C5h+C4meC4nuC4suC4o+C4suC4oeC4tOC5gOC4leC4reC4o+C5jAogICAgICAgIGF3YWl0IGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxUZXN0KGZpbGVPYmplY3QpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcHJvY2Vzc2luZyBwYXJhbGxlbCBzaG9ydGN1dCBjbGljazoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgIGxvYWRlci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZ4Liq4LiW4Liy4LiZ4Liw4LmC4Lir4Lil4LiU4LiW4LmJ4Liy4Lih4Li14Lib4Lix4LiN4Lir4LiyCiAgICB9Cn0KLy8g4pay4pay4payIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gaW5pdGlhbGl6ZVNjcmF0Y2hwYWRDYW52YXMoKSB7CiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyYXRjaHBhZC1jYW52YXMnKTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY3JhdGNocGFkLWNvbnRlbnQtd3JhcHBlcicpOwogICAgaWYgKCFjYW52YXMgfHwgIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgIHNjcmF0Y2hwYWRDdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IHdpbGxSZWFkRnJlcXVlbnRseTogdHJ1ZSB9KTsKICAgIAogICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKICAgIGNvbnN0IHJlY3QgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBjYW52YXMud2lkdGggPSByZWN0LndpZHRoICogZHByOwogICAgY2FudmFzLmhlaWdodCA9IHJlY3QuaGVpZ2h0ICogZHByOwogICAgY2FudmFzLnN0eWxlLndpZHRoID0gYCR7cmVjdC53aWR0aH1weGA7CiAgICBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gYCR7cmVjdC5oZWlnaHR9cHhgOwogICAgc2NyYXRjaHBhZEN0eC5zY2FsZShkcHIsIGRwcik7CgogICAgc2NyYXRjaHBhZEN0eC5saW5lSm9pbiA9ICdyb3VuZCc7CiAgICBzY3JhdGNocGFkQ3R4LmxpbmVDYXAgPSAncm91bmQnOwoKICAgIC8vIOC4peC4miBFdmVudCBMaXN0ZW5lcnMg4LmA4LiB4LmI4Liy4Lit4Lit4LiB4LiB4LmI4Lit4LiZCiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmRvd24nLCBoYW5kbGVQb2ludGVyRG93bik7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcm1vdmUnLCBoYW5kbGVQb2ludGVyTW92ZSk7CiAgICBjYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcnVwJywgaGFuZGxlUG9pbnRlclVwKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVyY2FuY2VsJywgaGFuZGxlUG9pbnRlclVwKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIGhhbmRsZVdoZWVsKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlUG9pbnRlckRvd24pOwogICAgY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZVBvaW50ZXJNb3ZlKTsKICAgIGNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZVBvaW50ZXJVcCk7CgogICAgLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVycyDguIrguLjguJTguYPguKvguKHguYgKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVyZG93bicsIGhhbmRsZVBvaW50ZXJEb3duKTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybW92ZScsIGhhbmRsZVBvaW50ZXJNb3ZlKTsKICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVydXAnLCBoYW5kbGVQb2ludGVyVXApOwogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJjYW5jZWwnLCBoYW5kbGVQb2ludGVyVXApOwogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgaGFuZGxlV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7CiAgICAvLyDguKrguLPguKvguKPguLHguJogVG91Y2ggKFNhZmFyaS9pT1MpCiAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGhhbmRsZVBvaW50ZXJEb3duLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZVBvaW50ZXJNb3ZlLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwogICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlUG9pbnRlclVwLCB7IHBhc3NpdmU6IGZhbHNlIH0pOwp9CgpmdW5jdGlvbiBzZXR1cFNjcmF0Y2hwYWRDb250cm9scygpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtbW9kYWwnKTsKICAgIGNvbnN0IGNvbnRyb2xzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtY29udHJvbHMnKTsKICAgIAogICAgLy8gVUkg4LiC4Lit4LiH4Lib4Li44LmI4Lih4LiE4Lin4Lia4LiE4Li44Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICjguKPguKfguKHguJvguLjguYjguKHguYTguK7guYTguKXguJfguYwsIOC4geC4peC4uOC5iOC4oeC4quC4tSwg4LmB4Lil4LiwIFNsaWRlcikKICAgIGNvbnRyb2xzQ29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic2NyYXRjaHBhZC1jbG9zZS1idG4iIGNsYXNzPSJiZy1yZWQtNTAwIHRleHQtd2hpdGUgdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBob3ZlcjpiZy1yZWQtNjAwIiB0aXRsZT0i4Lib4Li04LiU4LiB4Lij4Liw4LiU4Liy4LiZ4LiX4LiU4LmA4Lil4LiCIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0icmVzZXQtdmlldy1idG4iIGNsYXNzPSJ3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIiB0aXRsZT0i4Lij4Li14LmA4LiL4LmH4LiV4Lih4Li44Lih4Lih4Lit4LiHIj48aSBjbGFzcz0iZmFzIGZhLWV4cGFuZC1hcnJvd3MtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0idW5kby1idG4iIGNsYXNzPSJ3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIGRpc2FibGVkOm9wYWNpdHktNTAiIHRpdGxlPSLguKLguYnguK3guJnguIHguKXguLHguJoiIGRpc2FibGVkPjxpIGNsYXNzPSJmYXMgZmEtdW5kbyI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJyZWRvLWJ0biIgY2xhc3M9InctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgYm9yZGVyLTIgZGlzYWJsZWQ6b3BhY2l0eS01MCIgdGl0bGU9IuC4l+C4s+C4i+C5ieC4syIgZGlzYWJsZWQ+PGkgY2xhc3M9ImZhcyBmYS1yZWRvIj48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIj48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0b29sLWdyb3VwIj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0icGVuLXRvb2wtYnRuIiBjbGFzcz0idG9vbC1idG4gYWN0aXZlIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgYm9yZGVyLTIiIHRpdGxlPSLguJvguLLguIHguIHguLIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJoaWdobGlnaHRlci10b29sLWJ0biIgY2xhc3M9InRvb2wtYnRuIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgYm9yZGVyLTIiIHRpdGxlPSLguJvguLLguIHguIHguLLguYTguK7guYTguKXguJfguYwiPjxpIGNsYXNzPSJmYXMgZmEtaGlnaGxpZ2h0ZXIiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZXJhc2VyLXRvb2wtYnRuIiBjbGFzcz0idG9vbC1idG4gdy04IGgtOCByb3VuZGVkLW1kIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtYmFzZSBib3JkZXItMiIgdGl0bGU9IuC4ouC4suC4h+C4peC4miI+PGkgY2xhc3M9ImZhcyBmYS1lcmFzZXIiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0idHJhaWwtdG9vbC1idG4iIGNsYXNzPSJ0b29sLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGJvcmRlci0yIiB0aXRsZT0i4Lib4Liy4LiB4LiB4LiyIFRyYWlsICjguIjguLLguIfguKvguLLguKIpIj48aSBjbGFzcz0iZmFzIGZhLXNpZ25hdHVyZSI+PC9pPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InNlcGFyYXRvciI+PC9kaXY+CgkJCgkJPGRpdiBpZD0iZXJhc2VyLXRvb2xzLWdyb3VwIiBjbGFzcz0idG9vbC1ncm91cCBoaWRkZW4gaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZXJhc2VyLXNpemUtYnRuIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBib3JkZXItMiIgZGF0YS1zaXplPSIyMCIgdGl0bGU9IuC4ouC4suC4h+C4peC4muC4guC4meC4suC4lOC5gOC4peC5h+C4gSAoMjApIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctMiBoLTIgYmctZ3JheS02MDAgcm91bmRlZC1mdWxsIHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvZGl2PgogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZXJhc2VyLXNpemUtYnRuIGFjdGl2ZSB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iNDAiIHRpdGxlPSLguKLguLLguIfguKXguJrguILguJnguLLguJTguIHguKXguLLguIcgKDQwKSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTMgaC0zIGJnLWdyYXktNjAwIHJvdW5kZWQtZnVsbCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2Rpdj4KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImVyYXNlci1zaXplLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iODAiIHRpdGxlPSLguKLguLLguIfguKXguJrguILguJnguLLguJTguYPguKvguI3guYggKDgwKSI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTQgaC00IGJnLWdyYXktNjAwIHJvdW5kZWQtZnVsbCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2Rpdj4KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgaWQ9InBlbi10b29scy1ncm91cCIgY2xhc3M9InRvb2wtZ3JvdXAgaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBlbi1zaXplLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC14cyBmb250LWJvbGQgYm9yZGVyLTIiIGRhdGEtc2l6ZT0iMiIgdGl0bGU9IuC4guC4meC4suC4lOC5gOC4peC5h+C4gSI+UzwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tc2l6ZS1idG4gYWN0aXZlIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LXNtIGZvbnQtYm9sZCBib3JkZXItMiIgZGF0YS1zaXplPSI1IiB0aXRsZT0i4LiC4LiZ4Liy4LiU4LiB4Lil4Liy4LiHIj5NPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBlbi1zaXplLWJ0biB3LTggaC04IHJvdW5kZWQtbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1iYXNlIGZvbnQtYm9sZCBib3JkZXItMiIgZGF0YS1zaXplPSIxMCIgdGl0bGU9IuC4guC4meC4suC4lOC5g+C4q+C4jeC5iCI+TDwvYnV0dG9uPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzZXBhcmF0b3IgbXgtMSI+PC9kaXY+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InBlbi1jb2xvci1idG4gYWN0aXZlIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSIjMDAwMDAwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMDsiIHRpdGxlPSLguKrguLXguJTguLMiPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSIjRUY0NDQ0IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI0VGNDQ0NDsiIHRpdGxlPSLguKrguLXguYHguJTguIciPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwZW4tY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSIjM0I4MkY2IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzNCODJGNjsiIHRpdGxlPSLguKrguLXguJnguYnguLPguYDguIfguLTguJkiPjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGlkPSJoaWdobGlnaHRlci10b29scy1ncm91cCIgY2xhc3M9InRvb2wtZ3JvdXAgaGlkZGVuIGl0ZW1zLWNlbnRlciBnYXAtMyI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImhpZ2hsaWdodGVyLWNvbG9yLWJ0biBhY3RpdmUgdy03IGgtNyByb3VuZGVkLWZ1bGwgYm9yZGVyLTIiIGRhdGEtY29sb3I9InJnYmEoMjU1LCAyNTUsIDAsIDAuNSkiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiB5ZWxsb3c7IiB0aXRsZT0i4Liq4Li14LmA4Lir4Lil4Li34Lit4LiHIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaGlnaGxpZ2h0ZXItY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDU5LCAxMzAsIDI0NiwgMC41KSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMzQjgyRjY7IiB0aXRsZT0i4Liq4Li14LiZ4LmJ4Liz4LmA4LiH4Li04LiZIj48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaGlnaGxpZ2h0ZXItY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDIzNiwgNzIsIDE1MywgMC41KSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNFQzQ4OTk7IiB0aXRsZT0i4Liq4Li14LiK4Lih4Lie4Li5Ij48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iaGlnaGxpZ2h0ZXItY29sb3ItYnRuIHctNyBoLTcgcm91bmRlZC1mdWxsIGJvcmRlci0yIiBkYXRhLWNvbG9yPSJyZ2JhKDM0LCAxOTcsIDk0LCAwLjUpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzIyQzU1RTsiIHRpdGxlPSLguKrguLXguYDguILguLXguKLguKciPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJoaWdobGlnaHRlci1jb2xvci1idG4gdy03IGgtNyByb3VuZGVkLWZ1bGwgYm9yZGVyLTIiIGRhdGEtY29sb3I9InJnYmEoMjQ5LCAxMTUsIDIyLCAwLjUpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI0Y5NzMxNjsiIHRpdGxlPSLguKrguLXguKrguYnguKEiPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJoaWdobGlnaHRlci1jb2xvci1idG4gdy03IGgtNyByb3VuZGVkLWZ1bGwgYm9yZGVyLTIiIGRhdGEtY29sb3I9InJnYmEoMTY4LCA4NSwgMjQ3LCAwLjUpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI0E4NTVGNzsiIHRpdGxlPSLguKrguLXguKHguYjguKfguIciPjwvYnV0dG9uPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2VwYXJhdG9yIG14LTEiPjwvZGl2PgogICAgICAgICAgICAKICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10ZXh0LWhlaWdodCI+PC9pPgogICAgICAgICAgICA8aW5wdXQgaWQ9ImhpZ2hsaWdodGVyLXNpemUtc2xpZGVyIiB0eXBlPSJyYW5nZSIgbWluPSI1IiBtYXg9IjUwIiB2YWx1ZT0iMjAiIGNsYXNzPSJ3LTI0IGgtMiBiZy1ncmF5LTIwMCByb3VuZGVkLWxnIGFwcGVhcmFuY2Utbm9uZSBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgIDxzcGFuIGlkPSJoaWdobGlnaHRlci1zaXplLXZhbHVlIiBjbGFzcz0idGV4dC1zbSBmb250LW1vbm8gdy04IHRleHQtY2VudGVyIj4ke3NjcmF0Y2hwYWRIaWdobGlnaHRlclNpemV9PC9zcGFuPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJzZXBhcmF0b3IiPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InRvb2wtZ3JvdXAgbWwtYXV0byI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InNjcmF0Y2hwYWQtY2xlYXItYnRuIiBjbGFzcz0iYmcteWVsbG93LTUwMCB0ZXh0LXdoaXRlIHctOCBoLTggcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2UgaG92ZXI6YmcteWVsbG93LTYwMCIgdGl0bGU9IuC4peC4muC4l+C4seC5ieC4h+C4q+C4oeC4lCI+PGkgY2xhc3M9ImZhcyBmYS10cmFzaC1hbHQiPjwvaT48L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIGA7Ci8vIC0tLSDguKrguYjguKfguJnguIjguLHguJTguIHguLLguKMgRXZlbnQgTGlzdGVuZXJzIC0tLQogICAgY29uc3QgcGVuVG9vbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW4tdG9vbC1idG4nKTsKICAgIGNvbnN0IGVyYXNlclRvb2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXJhc2VyLXRvb2wtYnRuJyk7CiAgICBjb25zdCB0cmFpbFRvb2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndHJhaWwtdG9vbC1idG4nKTsKICAgIGNvbnN0IGhpZ2hsaWdodGVyVG9vbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaWdobGlnaHRlci10b29sLWJ0bicpOwogICAgCiAgICBjb25zdCBwZW5Ub29sc0dyb3VwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Blbi10b29scy1ncm91cCcpOwogICAgY29uc3QgaGlnaGxpZ2h0ZXJUb29sc0dyb3VwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpZ2hsaWdodGVyLXRvb2xzLWdyb3VwJyk7Cgljb25zdCBlcmFzZXJUb29sc0dyb3VwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VyYXNlci10b29scy1ncm91cCcpOwoKICAgIGNvbnN0IGFsbFRvb2xCdXR0b25zID0gW3BlblRvb2xCdG4sIGVyYXNlclRvb2xCdG4sIHRyYWlsVG9vbEJ0biwgaGlnaGxpZ2h0ZXJUb29sQnRuXTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NyYXRjaHBhZC1jbG9zZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldC12aWV3LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIHNjcmF0Y2hwYWRTY2FsZSA9IDE7CiAgICAgICAgc2NyYXRjaHBhZE9mZnNldCA9IHsgeDogMCwgeTogMCB9OwogICAgICAgIHJlZHJhd1NjcmF0Y2hwYWQoKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjcmF0Y2hwYWQtY2xlYXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgc3Ryb2tlcyA9IFtdOwogICAgICAgIHJlZG9TdHJva2VzID0gW107CiAgICAgICAgcmVkcmF3U2NyYXRjaHBhZCgpOwogICAgICAgIHVwZGF0ZVVuZG9SZWRvQnV0dG9ucygpOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndW5kby1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHVuZG8pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZG8tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZWRvKTsKCiAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJkgSGVscGVyIOC4quC4s+C4q+C4o+C4seC4muC4quC4peC4seC4muC5guC4q+C4oeC4lAogICAgY29uc3Qgc2V0QWN0aXZlVG9vbFVJID0gKGFjdGl2ZUJ0bikgPT4gewogICAgICAgICBhbGxUb29sQnV0dG9ucy5mb3JFYWNoKGJ0biA9PiBidG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICBhY3RpdmVCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgIAogICAgICAgICAvLyDguIvguYjguK3guJnguJfguLjguIHguIHguKXguLjguYjguKHguYDguITguKPguLfguYjguK3guIfguKHguLfguK0KICAgICAgICAgcGVuVG9vbHNHcm91cC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgaGlnaGxpZ2h0ZXJUb29sc0dyb3VwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICBlcmFzZXJUb29sc0dyb3VwLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyA8LS0gW+C5gOC4nuC4tOC5iOC4oV0g4LiL4LmI4Lit4LiZ4Lii4Liy4LiH4Lil4LiaCgogICAgICAgICAvLyDguYHguKrguJTguIfguYDguInguJ7guLLguLDguIHguKXguLjguYjguKHguJfguLXguYjguYDguIHguLXguYjguKLguKfguILguYnguK3guIcKICAgICAgICAgaWYgKGFjdGl2ZVRvb2wgPT09ICdwZW4nIHx8IGFjdGl2ZVRvb2wgPT09ICd0cmFpbCcpIHsKICAgICAgICAgICAgIHBlblRvb2xzR3JvdXAuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlVG9vbCA9PT0gJ2hpZ2hsaWdodGVyJykgewogICAgICAgICAgICAgaGlnaGxpZ2h0ZXJUb29sc0dyb3VwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRvb2wgPT09ICdlcmFzZXInKSB7CiAgICAgICAgICAgICBlcmFzZXJUb29sc0dyb3VwLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyAvLyA8LS0gW+C5gOC4nuC4tOC5iOC4oV0g4LmB4Liq4LiU4LiH4Lii4Liy4LiH4Lil4LiaCiAgICAgICAgIH0KICAgICB9OwoKICAgIC8vIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC5gOC4peC4t+C4reC4geC5gOC4hOC4o+C4t+C5iOC4reC4h+C4oeC4t+C4rQogICAgcGVuVG9vbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgYWN0aXZlVG9vbCA9ICdwZW4nOyBzZXRBY3RpdmVUb29sVUkocGVuVG9vbEJ0bik7IH0pOwogICAgZXJhc2VyVG9vbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgYWN0aXZlVG9vbCA9ICdlcmFzZXInOyBzZXRBY3RpdmVUb29sVUkoZXJhc2VyVG9vbEJ0bik7IH0pOwogICAgdHJhaWxUb29sQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBhY3RpdmVUb29sID0gJ3RyYWlsJzsgc2V0QWN0aXZlVG9vbFVJKHRyYWlsVG9vbEJ0bik7IH0pOwogICAgaGlnaGxpZ2h0ZXJUb29sQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBhY3RpdmVUb29sID0gJ2hpZ2hsaWdodGVyJzsgc2V0QWN0aXZlVG9vbFVJKGhpZ2hsaWdodGVyVG9vbEJ0bik7IH0pOwogICAgCiAgICAvLyBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguYDguITguKPguLfguYjguK3guIfguKHguLfguK3guJvguLLguIHguIHguLIKICAgIHBlblRvb2xzR3JvdXAucXVlcnlTZWxlY3RvckFsbCgnLnBlbi1zaXplLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBzY3JhdGNocGFkUGVuU2l6ZSA9IHBhcnNlSW50KGUudGFyZ2V0LmRhdGFzZXQuc2l6ZSwgMTApOwogICAgICAgICAgICBwZW5Ub29sc0dyb3VwLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW4tc2l6ZS1idG4nKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIH0pOwogICAgfSk7CgkKCWVyYXNlclRvb2xzR3JvdXAucXVlcnlTZWxlY3RvckFsbCgnLmVyYXNlci1zaXplLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgIC8vIOC5g+C4iuC5iSBjdXJyZW50VGFyZ2V0IOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4hOC4peC4tOC4geC4l+C4teC5iOC4m+C4uOC5iOC4oSDguYTguKHguYjguYPguIrguYjguJfguLXguYjguKfguIfguIHguKXguKHguJTguYnguLLguJnguYPguJkKICAgICAgICAgICAgIGNvbnN0IHRhcmdldEJ0biA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgIHNjcmF0Y2hwYWRFcmFzZXJTaXplID0gcGFyc2VJbnQodGFyZ2V0QnRuLmRhdGFzZXQuc2l6ZSwgMTApOwogICAgICAgICAgICAgZXJhc2VyVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcuZXJhc2VyLXNpemUtYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICAgdGFyZ2V0QnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICB9KTsKICAgICB9KTsKCQogICAgcGVuVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcucGVuLWNvbG9yLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICBzY3JhdGNocGFkUGVuQ29sb3IgPSBlLnRhcmdldC5kYXRhc2V0LmNvbG9yOwogICAgICAgICAgICBwZW5Ub29sc0dyb3VwLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wZW4tY29sb3ItYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgCiAgICAvLyBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguYDguITguKPguLfguYjguK3guIfguKHguLfguK3guYTguK7guYTguKXguJfguYwKICAgIGhpZ2hsaWdodGVyVG9vbHNHcm91cC5xdWVyeVNlbGVjdG9yQWxsKCcuaGlnaGxpZ2h0ZXItY29sb3ItYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIHNjcmF0Y2hwYWRIaWdobGlnaHRlckNvbG9yID0gZS50YXJnZXQuZGF0YXNldC5jb2xvcjsKICAgICAgICAgICAgaGlnaGxpZ2h0ZXJUb29sc0dyb3VwLnF1ZXJ5U2VsZWN0b3JBbGwoJy5oaWdobGlnaHRlci1jb2xvci1idG4nKS5mb3JFYWNoKGIgPT4gYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKSk7CiAgICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIH0pOwogICAgfSk7CiAgICAKICAgIGNvbnN0IGhpZ2hsaWdodGVyU2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpZ2hsaWdodGVyLXNpemUtc2xpZGVyJyk7CiAgICBjb25zdCBoaWdobGlnaHRlclNpemVWYWx1ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaWdobGlnaHRlci1zaXplLXZhbHVlJyk7CiAgICBoaWdobGlnaHRlclNsaWRlci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB7CiAgICAgICAgY29uc3QgbmV3U2l6ZSA9IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlLCAxMCk7CiAgICAgICAgc2NyYXRjaHBhZEhpZ2hsaWdodGVyU2l6ZSA9IG5ld1NpemU7IC8vIOC4reC4seC4m+C5gOC4lOC4leC4leC4seC4p+C5geC4m+C4owogICAgICAgIGhpZ2hsaWdodGVyU2l6ZVZhbHVlLnRleHRDb250ZW50ID0gbmV3U2l6ZTsgLy8g4LmB4Liq4LiU4LiH4LiE4LmI4Liy4Lia4LiZIFVJCiAgICB9KTsKCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4gewogICAgICAgIGlmICghbW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkgewogICAgICAgICAgICBpbml0aWFsaXplU2NyYXRjaHBhZENhbnZhcygpOwogICAgICAgICAgICByZWRyYXdTY3JhdGNocGFkKCk7CiAgICAgICAgfQogICAgfSk7Cn0gLy8gPC0tIOC4m+C4tOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzZXR1cFNjcmF0Y2hwYWRDb250cm9scyAgICAKCiAgICAgICAgLy8gR2FtaWZpY2F0aW9uIENvbnN0YW50cwogICAgICAgIGNvbnN0IEJBREdFUyA9IHsKICAgICAgICAgICAgUEVSRkVDVF9TQ09SRTogeyBpZDogJ3BlcmZlY3Rfc2NvcmUnLCBuYW1lOiAn4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4LihJywgZGVzY3JpcHRpb246ICfguJXguK3guJrguJbguLnguIHguJfguLjguIHguILguYnguK3guYPguJnguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYknLCBpY29uOiAnZmEtY3Jvd24gdGV4dC15ZWxsb3ctNTAwJyB9LAogICAgICAgICAgICBRVUlDS19USElOS0VSOiB7IGlkOiAncXVpY2tfdGhpbmtlcicsIG5hbWU6ICfguYDguIvguLXguKLguJnguKrguKHguK3guIfguYTguKcnLCBkZXNjcmlwdGlvbjogJ+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC5gOC4quC4o+C5h+C4iOC5gOC4o+C5h+C4p+C4geC4p+C5iOC4suC4hOC4o+C4tuC5iOC4h+C4guC4reC4h+C5gOC4p+C4peC4suC4l+C4teC5iOC4geC4s+C4q+C4meC4lCcsIGljb246ICdmYS1ib2x0IHRleHQtYmx1ZS01MDAnIH0sCiAgICAgICAgICAgIE9OX0ZJUkU6IHsgaWQ6ICdvbl9maXJlJywgbmFtZTogJ+C4l+C5h+C4reC4m+C4n+C4reC4o+C5jOC4oScsIGRlc2NyaXB0aW9uOiAn4LiV4Lit4Lia4LiW4Li54LiBIDMg4LiC4LmJ4Lit4LiV4Li04LiU4LiV4LmI4Lit4LiB4Lix4LiZJywgaWNvbjogJ2ZhLWZpcmUgdGV4dC1vcmFuZ2UtNTAwJyB9LAogICAgICAgICAgICBGSVJTVF9UUllfQUNFOiB7IGlkOiAnZmlyc3RfdHJ5X2FjZScsIG5hbWU6ICfguJzguYjguLLguJnguInguKXguLjguKInLCBkZXNjcmlwdGlvbjogJ+C4l+C4s+C4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC5g+C4meC4geC4suC4o+C4l+C4s+C4hOC4o+C4seC5ieC4h+C5geC4o+C4gScsIGljb246ICdmYS1yb2NrZXQgdGV4dC1wdXJwbGUtNTAwJyB9LAogICAgICAgICAgICBDT01FQkFDS19LSU5HOiB7IGlkOiAnY29tZWJhY2tfa2luZycsIG5hbWU6ICfguKPguLLguIrguLLguITguLHguKHguYHguJrguYfguIEnLCBkZXNjcmlwdGlvbjogJ+C4quC4reC4muC4leC4geC5g+C4meC4hOC4o+C4seC5ieC4h+C5geC4o+C4gSDguYHguJXguYjguIHguKXguLHguJrguKHguLLguKrguK3guJrguJzguYjguLLguJnguYTguJTguYknLCBpY29uOiAnZmEtc2hpZWxkLWFsdCB0ZXh0LWdyYXktNjAwJyB9LAogICAgICAgICAgICBTUEVDSUFMSVNUOiB7IGlkOiAnc3BlY2lhbGlzdCcsIG5hbWU6ICfguJzguLnguYnguYDguIrguLXguYjguKLguKfguIrguLLguI0nLCBkZXNjcmlwdGlvbjogJ+C5hOC4lOC5ieC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC5g+C4meC4l+C4uOC4geC5geC4muC4muC4l+C4lOC4quC4reC4muC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4hCcsIGljb246ICdmYS11c2VyLWFzdHJvbmF1dCB0ZXh0LWJsdWUtNzAwJyB9LAogICAgICAgICAgICBQRVJTRVZFUkFOQ0U6IHsgaWQ6ICdwZXJzZXZlcmFuY2UnLCBuYW1lOiAn4Lic4Li54LmJ4LmE4Lih4LmI4Lii4Lit4Lih4LmB4Lie4LmJJywgZGVzY3JpcHRpb246ICfguJfguLPguYHguJrguJrguJfguJTguKrguK3guJrguYDguJTguLXguKLguKfguIHguLHguJnguITguKPguJogNSDguITguKPguLHguYnguIcnLCBpY29uOiAnZmEtZHVtYmJlbGwgdGV4dC1ncmF5LTcwMCcgfQogICAgICAgIH07CgogICAgICAgIC8vIFVzZSB0aGUgY29uZmlnIHByb3ZpZGVkIGJ5IHRoZSBlbnZpcm9ubWVudCwgd2l0aCBhIGZhbGxiYWNrIGZvciBsb2NhbCBkZXZlbG9wbWVudApjb25zdCBmaXJlYmFzZUNvbmZpZyA9IHsKICBhcGlLZXk6ICJBSXphU3lDUWxWenlfTEJJbU5wNVRKTndSdWVwRnp2eFdtOEF5WmsiLAogIGF1dGhEb21haW46ICJhaS1xdWl6LWFwcC1hZWZlZS5maXJlYmFzZWFwcC5jb20iLAogIHByb2plY3RJZDogImFpLXF1aXotYXBwLWFlZmVlIiwKICBzdG9yYWdlQnVja2V0OiAiYWktcXVpei1hcHAtYWVmZWUuZmlyZWJhc2VzdG9yYWdlLmFwcCIsCiAgbWVzc2FnaW5nU2VuZGVySWQ6ICIyNzQxOTIyNTgxMTEiLAogIGFwcElkOiAiMToyNzQxOTIyNTgxMTE6d2ViOjQxMjBjOTExODIyOWI1NjQ0ZGQ0OGEiLAogIG1lYXN1cmVtZW50SWQ6ICJHLVY5MEtSTTBMNjMiCn07CiAgICAgICAgY29uc3QgYXBwSWQgPSB0eXBlb2YgX19hcHBfaWQgIT09ICd1bmRlZmluZWQnID8gX19hcHBfaWQgOiAnYWktcXVpei1nZW5lcmF0b3ItdjMnOwoKICAgICAgICAvLyAtLS0gRE9NIEVsZW1lbnRzIC0tLQogICAgICAgIGNvbnN0IGFkbWluVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi12aWV3Jyk7CiAgICAgICAgY29uc3Qgc3R1ZGVudFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC12aWV3Jyk7CiAgICAgICAgY29uc3QgcHJvamVjdERhc2hib2FyZFZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1kYXNoYm9hcmQtdmlldycpOwogICAgICAgIGNvbnN0IHByb2plY3REZXRhaWxWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtZGV0YWlsLXZpZXcnKTsKICAgICAgICBjb25zdCBxdWl6UmVzdWx0c1ZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1yZXN1bHRzLXZpZXcnKTsKICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWxpc3QnKTsKICAgICAgICBjb25zdCBub1Byb2plY3RzTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vLXByb2plY3RzLW1zZycpOwogICAgICAgIGNvbnN0IHByb2plY3RUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXRpdGxlJyk7CiAgICAgICAgY29uc3QgcHJvamVjdElkRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LWlkLWRpc3BsYXknKTsKICAgICAgICBjb25zdCBzdHVkZW50TGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWxpc3QnKTsKICAgICAgICBjb25zdCBtZXNzYWdlTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZS1tb2RhbCcpOwogICAgICAgIGNvbnN0IG1vZGFsTWVzc2FnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1tZXNzYWdlJyk7CiAgICAgICAgY29uc3QgY3JlYXRlUHJvamVjdE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWF0ZS1wcm9qZWN0LW1vZGFsJyk7CiAgICAgICAgY29uc3QgYWRtaW5QYXNzd29yZE1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkbWluLXBhc3N3b3JkLW1vZGFsJyk7CiAgICAgICAgY29uc3QgY29uZmlybWF0aW9uTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWF0aW9uLW1vZGFsJyk7CiAgICAgICAgY29uc3QgdXNlcklkRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLWlkLWRpc3BsYXknKTsKICAgICAgICBjb25zdCB0b3BpY1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BpYy10YWInKTsKICAgICAgICBjb25zdCB0ZXh0VGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RleHQtdGFiJyk7CiAgICAgICAgY29uc3QgdG9waWNJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9waWMtaW5wdXQtYXJlYScpOwogICAgICAgIGNvbnN0IHRleHRJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGV4dC1pbnB1dC1hcmVhJyk7CiAgICAgICAgY29uc3QgbWFuYWdlVGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbmFnZS10YWInKTsKICAgICAgICBjb25zdCByZXN1bHRzVGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtdGFiJyk7CiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmRUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVhZGVyYm9hcmQtdGFiJyk7CiAgICAgICAgY29uc3QgbWFuYWdlVGFiQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW5hZ2UtdGFiLWNvbnRlbnQnKTsKICAgICAgICBjb25zdCByZXN1bHRzVGFiQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLXRhYi1jb250ZW50Jyk7CiAgICAgICAgY29uc3QgbGVhZGVyYm9hcmRUYWJDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlYWRlcmJvYXJkLXRhYi1jb250ZW50Jyk7CiAgICAgICAgY29uc3QgcHJvamVjdFF1aXp6ZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtcXVpenplcy1saXN0Jyk7CiAgICAgICAgY29uc3QgZmlsZVRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXRhYicpOwogICAgICAgIGNvbnN0IGZpbGVJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1pbnB1dC1hcmVhJyk7CiAgICAgICAgY29uc3QgZmlsZVVwbG9hZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdXBsb2FkLWlucHV0Jyk7CiAgICAgICAgY29uc3Qgd29ya3NoZWV0VGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dvcmtzaGVldC10YWInKTsKICAgICAgICAKICAgICAgICBjb25zdCB3b3Jrc2hlZXRJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd29ya3NoZWV0LWlucHV0LWFyZWEnKTsKICAgICAgICBjb25zdCBnZW5lcmF0ZVdvcmtzaGVldEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS13b3Jrc2hlZXQtYnRuJyk7CiAgICAgICAgLy8gU3R1ZGVudCB2aWV3IGVsZW1lbnRzCiAgICAgICAgY29uc3Qgc3R1ZGVudEluaXRpYWxWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtaW5pdGlhbC12aWV3Jyk7CiAgICAgICAgY29uc3Qgc3R1ZGVudE5hbWVTZWxlY3Rpb25WaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtbmFtZS1zZWxlY3Rpb24tdmlldycpOwogICAgICAgIGNvbnN0IHN0dWRlbnRRdWl6QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotYXJlYScpOwogICAgICAgIGNvbnN0IHN0dWRlbnRSZXN1bHRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcmVzdWx0LWFyZWEnKTsKICAgICAgICBjb25zdCBzdHVkZW50UmVhZGluZ0FyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1yZWFkaW5nLWFyZWEnKTsKICAgICAgICBjb25zdCBsb2FkUXVpekJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2FkLXF1aXotYnRuJyk7CiAgICAgICAgY29uc3Qgc3RhcnRRdWl6QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LXF1aXotYnRuJyk7CiAgICAgICAgY29uc3Qgc3R1ZGVudEpvaW5HYW1lVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWpvaW4tZ2FtZS12aWV3Jyk7CiAgICAgICAgCiAgICAgICAgLy8gUHJlc2VudGF0aW9uIE1vZGUgZWxlbWVudHMKICAgICAgICBjb25zdCBwcmVzZW50YXRpb25Nb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tbW9kYWwnKTsKCiAgICAgICAgLy8gTW9kYWxzCiAgICAgICAgY29uc3QgcmVuYW1lUXVpek1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbmFtZS1xdWl6LW1vZGFsJyk7CiAgICAgICAgY29uc3QgbW92ZVF1aXpNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsKICAgICAgICBjb25zdCBxdWl6U2V0dGluZ3NNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXNldHRpbmdzLW1vZGFsJyk7CiAgICAgICAgY29uc3QgcXVpelN0YXR1c01vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotc3RhdHVzLW1vZGFsJyk7CgogICAgICAgIC8vIExpdmUgR2FtZSBWaWV3CiAgICAgICAgY29uc3QgbGl2ZUdhbWVWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtZ2FtZS12aWV3Jyk7CgovKioKICog4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Liq4LmB4LiB4LiZ4LmB4Lil4Liw4LmB4LiB4LmJ4LmE4LiC4LmC4LiE4LmJ4LiUIExhVGVYIOC4l+C4teC5iOC4nOC4tOC4lOC4nuC4peC4suC4lOC5guC4lOC4ouC4reC4seC4leC5guC4meC4oeC4seC4leC4tAogKiAo4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LmC4LiU4Lii4LmA4LiJ4Lie4Liy4LiwKQogKi8KZnVuY3Rpb24gaGFuZGxlRml4TGVzc29uTGF0ZXgoKSAgeyAvKiBSZW1vdmVkICovIH0gCgovLyDilrzilrzilrwg4Lin4Liy4LiH4LmC4LiE4LmJ4LiU4LiZ4Li14LmJ4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGhhbmRsZUF1dG9GaXhMYXRleCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmZ1bmN0aW9uIGhhbmRsZUF1dG9GaXhMYXRleCgpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGxpc3RlbkZvckN1c3RvbU1hdGhUb3BpY3MoKSB7CiAgICAvLyBpZiAoIXVzZXJJZCkgcmV0dXJuOyAvLyDguYTguKHguYjguIjguLPguYDguJvguYfguJnguJXguYnguK3guIfguYDguIrguYfguIQgdXNlcklkIOC5geC4peC5ieC4pyDguYDguJ7guKPguLLguLDguYDguJvguYfguJnguILguYnguK3guKHguLnguKXguKrguLLguJjguLLguKPguJPguLAKICAgIGNvbnN0IGN1c3RvbVRvcGljc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvY3VzdG9tTWF0aFRvcGljc2ApOwoKICAgIG9uU25hcHNob3QoY3VzdG9tVG9waWNzUmVmLCAoc25hcHNob3QpID0+IHsKICAgICAgICBjdXN0b21NYXRoVG9waWNzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSkpOwogICAgICAgIC8vIOC5gOC4oeC4t+C5iOC4reC4guC5ieC4reC4oeC4ueC4peC4reC4seC4m+C5gOC4lOC4lSDguYPguKvguYnguKfguLLguJTguKPguLLguKLguIHguLLguKPguKvguLHguKfguILguYnguK3guYPguKvguKHguYgKICAgICAgICByZW5kZXJUb3BpY0NoZWNrYm94ZXMoKTsgCiAgICB9LCAoZXJyb3IpID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsaXN0ZW5pbmcgZm9yIGN1c3RvbSBtYXRoIHRvcGljczoiLCBlcnJvcik7CiAgICB9KTsKfQoKZnVuY3Rpb24gaGFuZGxlU2VsZWN0QWxsVG9waWNzKCkgewogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRoLXRvcGljcy1jaGVja2JveC1jb250YWluZXInKTsKICAgICAgICBjb25zdCBjaGVja2JveGVzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9ImNoZWNrYm94Il0nKTsKICAgICAgICBjaGVja2JveGVzLmZvckVhY2goY2IgPT4gewogICAgICAgICAgICBjYi5jaGVja2VkID0gdHJ1ZTsKICAgICAgICB9KTsKICAgICAgICAvLyDguK3guLHguJvguYDguJTguJXguIjguLPguJnguKfguJnguJfguLXguYjguYDguKXguLfguK3guIEKICAgICAgICB1cGRhdGVTZWxlY3RlZFRvcGljc0NvdW50KCk7CiAgICB9CgogICAgZnVuY3Rpb24gaGFuZGxlRGVzZWxlY3RBbGxUb3BpY3MoKSB7CiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdGgtdG9waWNzLWNoZWNrYm94LWNvbnRhaW5lcicpOwogICAgICAgIGNvbnN0IGNoZWNrYm94ZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0iY2hlY2tib3giXScpOwogICAgICAgIGNoZWNrYm94ZXMuZm9yRWFjaChjYiA9PiB7CiAgICAgICAgICAgIGNiLmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICB9KTsKICAgICAgICAvLyDguK3guLHguJvguYDguJTguJXguIjguLPguJnguKfguJnguJfguLXguYjguYDguKXguLfguK3guIEKICAgICAgICB1cGRhdGVTZWxlY3RlZFRvcGljc0NvdW50KCk7CiAgICB9CgkKCS8qKgogKiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguKXguJrguKvguLHguKfguILguYnguK3guITguJPguLTguJXguKjguLLguKrguJXguKPguYzguJfguLXguYjguJzguLnguYnguYPguIrguYnguKrguKPguYnguLLguIfguYDguK3guIcKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljSWQgLSBJRCDguILguK3guIfguYDguK3guIHguKrguLLguKPguKvguLHguKfguILguYnguK3guYPguJkgRmlyZXN0b3JlCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVEZWxldGVDdXN0b21Ub3BpYyh0b3BpY0lkKSB7CiAgICBpZiAoIXRvcGljSWQpIHJldHVybjsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHRvcGljUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2N1c3RvbU1hdGhUb3BpY3NgLCB0b3BpY0lkKTsKICAgICAgICBhd2FpdCBkZWxldGVEb2ModG9waWNSZWYpOwogICAgICAgIHNob3dNZXNzYWdlKCLguKXguJrguKvguLHguKfguILguYnguK3guKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAvLyDguYTguKHguYjguJXguYnguK3guIcgcmUtcmVuZGVyIOC5gOC4reC4hyDguYDguJ7guKPguLLguLAgb25TbmFwc2hvdCDguIjguLDguJXguKPguKfguIjguIjguLHguJrguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIfguYHguKXguLAgcmUtcmVuZGVyIOC5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBjdXN0b20gdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKXguJrguKvguLHguKfguILguYnguK0iKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkQ3VzdG9tTWF0aFRvcGljKCkgewogICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VzdG9tLW1hdGgtdG9waWMtaW5wdXQnKTsKICAgIGNvbnN0IHRvcGljTmFtZSA9IGlucHV0LnZhbHVlLnRyaW0oKTsKCiAgICBpZiAoIXRvcGljTmFtZSkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguJvguYnguK3guJnguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguYDguJ7guLTguYjguKEiKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXVzZXJJZCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguJzguLnguYnguYPguIrguYkg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lia4Lix4LiZ4LiX4Li24LiB4LmE4LiU4LmJIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgY3VzdG9tVG9waWNzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9jdXN0b21NYXRoVG9waWNzYCk7CiAgICAgICAgYXdhaXQgYWRkRG9jKGN1c3RvbVRvcGljc1JlZiwgewogICAgICAgICAgICBuYW1lOiB0b3BpY05hbWUsCiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2VydmVyVGltZXN0YW1wKCkKICAgICAgICB9KTsKICAgICAgICBpbnB1dC52YWx1ZSA9ICcnOyAvLyDguKXguYnguLLguIfguIrguYjguK3guIfguIHguKPguK3guIHguILguYnguK3guKHguLnguKUKICAgICAgICBzaG93TWVzc2FnZShg4LmA4Lie4Li04LmI4Lih4Lir4Lix4Lin4LiC4LmJ4LitICIke3RvcGljTmFtZX0iIOC4quC4s+C5gOC4o+C5h+C4iGApOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBhZGRpbmcgY3VzdG9tIHRvcGljOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4Lir4Lix4Lin4LiC4LmJ4LitIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8Ci8qKgogKiDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKrguYHguIHguJnguYHguKXguLDguK3guLHguJvguYDguJTguJXguYHguJrguJrguJfguJTguKrguK3guJrguYDguIHguYjguLLguJfguLXguYjguKLguLHguIfguYTguKHguYjguKHguLUgSUQg4LmD4LiZ4LmB4LiV4LmI4Lil4Liw4LiE4Liz4LiW4Liy4LihCiAqLwphc3luYyBmdW5jdGlvbiBoYW5kbGVVcGRhdGVPbGRRdWl6emVzKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVCdWxrVXBkYXRlUXVpelNldHRpbmdzIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQnVsa1VwZGF0ZVF1aXpTZXR0aW5ncygpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8qKgogKiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguJrguLHguJnguJfguLbguIHguIrguLfguYjguK3guYLguJvguKPguYDguIjguITguYPguKvguKHguYjguKvguKXguLHguIfguIjguLLguIHguYHguIHguYnguYTguIIKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNhdmVQcm9qZWN0TmFtZSgpIHsKICAgIGNvbnN0IHByb2plY3RUaXRsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtdGl0bGUnKTsKICAgIGNvbnN0IHNhdmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1wcm9qZWN0LW5hbWUtYnRuJyk7CiAgICBjb25zdCBuZXdOYW1lID0gcHJvamVjdFRpdGxlRWwudGV4dENvbnRlbnQudHJpbSgpOwoKICAgIGlmICghbmV3TmFtZSB8fCAhY3VycmVudFByb2plY3RJZCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIrguLfguYjguK3guYLguJvguKPguYDguIjguITguKvguYnguLLguKHguKfguYjguLLguIciKTsKICAgICAgICBwcm9qZWN0VGl0bGVFbC50ZXh0Q29udGVudCA9IGN1cnJlbnRQcm9qZWN0RGF0YS5wcm9qZWN0TmFtZTsgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4LiU4Li04LihCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNhdmVCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgc2F2ZUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4nOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7IHByb2plY3ROYW1lOiBuZXdOYW1lIH0pOwoKICAgICAgICAvLyDguK3guLHguJvguYDguJTguJXguILguYnguK3guKHguLnguKXguYPguJkgc3RhdGUg4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4LiU4LmJ4Lin4LiiCiAgICAgICAgaWYoY3VycmVudFByb2plY3REYXRhKSB7CiAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0RGF0YS5wcm9qZWN0TmFtZSA9IG5ld05hbWU7CiAgICAgICAgfQoKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiK4Li34LmI4Lit4LmC4Lib4Lij4LmA4LiI4LiE4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIHByb2plY3QgbmFtZToiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgICAgIHByb2plY3RUaXRsZUVsLnRleHRDb250ZW50ID0gY3VycmVudFByb2plY3REYXRhLnByb2plY3ROYW1lOyAvLyDguITguLfguJnguITguYjguLLguYDguJTguLTguKEKICAgIH0gZmluYWxseSB7CiAgICAgICAgc2F2ZUJ0bi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBzYXZlQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgc2F2ZUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zYXZlIG1yLTIiPjwvaT7guJrguLHguJnguJfguLbguIEnOwogICAgfQp9CgovLyDinIUg4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIDE6IOC4iOC4seC4lOC4geC4suC4oyBVSSDguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoKZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVQcmFjdGljZVRlc3QodG9waWMsIGdyYWRlKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpOwogICAgY29uc3QgdGl0bGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy10aXRsZScpOwogICAgY29uc3QgbG9hZGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLWxvYWRlcicpOwogICAgY29uc3QgY29udGVudENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tc2VjdGlvbnMtY29udGFpbmVyJyk7CgogICAgLy8gMS4gUmVzZXQg4LmB4Lil4Liw4LmB4Liq4LiU4LiHIE1vZGFsIOC4nuC4o+C5ieC4reC4oSBMb2FkZXIKICAgIHRpdGxlRWwudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaOiAke3RvcGljfWA7CiAgICBjb250ZW50Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgbG9hZGVyRWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICAvLyAyLiDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdG9yIOC4leC4seC4p+C5g+C4q+C4oeC5iAogICAgZ2VuZXJhdGVQcmFjdGljZVRlc3QodG9waWMsIGdyYWRlKS5jYXRjaChlcnIgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBnZW5lcmF0ZSBwcmFjdGljZSB0ZXN0OiIsIGVycik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4guC4reC4reC4oOC4seC4oiwg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Liq4Liz4Lir4Lij4Lix4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4LiZ4Li14LmJ4LmE4LiU4LmJIik7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKfQoKLy8g4pyFIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCAyOiDguYDguKPguLXguKLguIEgQVBJIOC5geC4peC4sOC5geC4quC4lOC4h+C4nOC4peC5gOC4ieC4nuC4suC4sOC4quC5iOC4p+C4meC5geC4muC4muC4l+C4lOC4quC4reC4mgphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVByYWN0aWNlVGVzdCh0b3BpYywgZ3JhZGVMZXZlbCkgewogICAgLy8g4LiL4LmI4Lit4LiZ4LiX4Li44LiB4Liq4LmI4Lin4LiZ4LiC4Lit4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LiB4LmI4Lit4LiZCiAgICBbJ3BvaW50Q29udGVudCcsICdtZW1vcnlDb250ZW50JywgJ2FwcGxpY2F0aW9uQ29udGVudCcsICdzdW1tYXJ5Q29udGVudCddLmZvckVhY2goaWQgPT4gewogICAgICAgIGNvbnN0IHBhcmVudFNlY3Rpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkucGFyZW50RWxlbWVudDsKICAgICAgICBpZiAocGFyZW50U2VjdGlvbikgewogICAgICAgICAgICBwYXJlbnRTZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgfQogICAgfSk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBvbmV0Rm9jdXNQcm9tcHQgPSBg4LmC4LiU4Lii4LmA4LiZ4LmJ4LiZ4Liq4Lij4LmJ4Liy4LiH4LmC4LiI4LiX4Lii4LmM4LiX4Li14LmI4Liq4Lit4LiU4LiE4Lil4LmJ4Lit4LiH4LiB4Lix4Lia4LmB4LiZ4Lin4LiX4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4LiaIE8tTkVUIOC4quC4s+C4q+C4o+C4seC4muC4o+C4sOC4lOC4seC4muC4iuC4seC5ieC4meC4meC4teC5ieC4reC4ouC5iOC4suC4h+C5gOC4hOC4o+C5iOC4h+C4hOC4o+C4seC4lGA7CiAgICAgICAgY29uc3QgYXBwUHJvbXB0ID0gYOC4quC4o+C5ieC4suC4h+C5geC4muC4muC4neC4tuC4geC4q+C4seC4lOC5geC4muC4muC4m+C4o+C4meC4seC4oiA0IOC4leC4seC4p+C5gOC4peC4t+C4reC4gSDguIjguLPguJnguKfguJkgNSDguILguYnguK0g4Liq4Liz4Lir4Lij4Lix4Lia4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lij4Liw4LiU4Lix4Lia4LiK4Lix4LmJ4LiZICcke2dyYWRlTGV2ZWx9JyDguYPguJnguKvguLHguKfguILguYnguK0gJyR7dG9waWN9Jy4g4LmC4LiI4LiX4Lii4LmM4LmB4Lil4Liw4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiV4LmJ4Lit4LiH4Lih4Li14LiE4Lin4Liy4Lih4LiL4Lix4Lia4LiL4LmJ4Lit4LiZ4LmD4LiB4Lil4LmJ4LmA4LiE4Li14Lii4LiH4LiB4Lix4Lia4LmB4LiZ4Lin4LiC4LmJ4Lit4Liq4Lit4LiaIE8tTkVUIOC4iOC4o+C4tOC4h+C5hi4g4Lij4Liw4Lia4Li44LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHICjguYDguJvguYfguJkgaW5kZXggMC0zKSDguYHguKXguLDguKvguLLguIHguKHguLXguKrguLnguJXguKPguITguJPguLTguJXguKjguLLguKrguJXguKPguYzguYPguKvguYnguYPguIrguYnguKPguLnguJvguYHguJrguJogTGFUZVhgOwoKICAgICAgICBjb25zdCBhcHBDb250ZW50SnNvbiA9IGF3YWl0IGNhbGxHZW1pbmkoYXBwUHJvbXB0LCB0cnVlKTsKCiAgICAgICAgLy8gLS0tIOC4quC5iOC4p+C4meC5geC4quC4lOC4h+C4nOC4pSAtLS0KICAgICAgICBjb25zdCB0aXRsZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi12aWV3LXRpdGxlJyk7CiAgICAgICAgY29uc3QgbG9hZGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLWxvYWRlcicpOwogICAgICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXNlY3Rpb25zLWNvbnRhaW5lcicpOwogICAgICAgIGNvbnN0IGFwcGxpY2F0aW9uU2VjdGlvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBsaWNhdGlvbkNvbnRlbnQnKS5wYXJlbnRFbGVtZW50OwoKICAgICAgICB0aXRsZUVsLmlubmVyVGV4dCA9IGDguYHguJrguJrguJfguJTguKrguK3guJrguJ3guLbguIHguJ3guJnguYDguKPguLfguYjguK3guIc6ICR7dG9waWMucmVwbGFjZSgv4oCiXHMvZywgJycpfSAo4Liq4Liz4Lir4Lij4Lix4LiaICR7Z3JhZGVMZXZlbH0pYDsKCiAgICAgICAgY3VycmVudEFwcGxpY2F0aW9uRGF0YSA9IEpTT04ucGFyc2UoYXBwQ29udGVudEpzb24pOwogICAgICAgIGNvbnN0IGFwcGxpY2F0aW9uQ29udGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcGxpY2F0aW9uQ29udGVudCcpOwogICAgICAgIGFwcGxpY2F0aW9uQ29udGVudEVsLmlubmVySFRNTCA9IGN1cnJlbnRBcHBsaWNhdGlvbkRhdGEubWFwKChxLCBpbmRleCkgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJhcHBsaWNhdGlvbi1xdWVzdGlvbiBtYi00Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke2luZGV4ICsgMX0uICR7bWFya2VkLnBhcnNlSW5saW5lKHEucXVlc3Rpb24pfTwvcD4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFwcGxpY2F0aW9uLW9wdGlvbnMgbXQtMiIgaWQ9InEke2luZGV4fS1vcHRpb25zIj4KICAgICAgICAgICAgICAgICAgICAke3Eub3B0aW9ucy5tYXAoKG9wdCwgb3B0SW5kZXgpID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0idy1mdWxsIHRleHQtbGVmdCBwLTIgYm9yZGVyIHJvdW5kZWQtbWQgbXQtMSBob3ZlcjpiZy1ncmF5LTEwMCIgb25jbGljaz0iY2hlY2tBbnN3ZXIoJHtpbmRleH0sICR7b3B0SW5kZXh9KSI+JHtTdHJpbmcuZnJvbUNoYXJDb2RlKDk3ICsgb3B0SW5kZXgpfS4gJHttYXJrZWQucGFyc2VJbmxpbmUob3B0KX08L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKCiAgICAgICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB7CiAgICAgICAgICAgIE1hdGhKYXgudHlwZXNldFByb21pc2UoW2FwcGxpY2F0aW9uQ29udGVudEVsXSk7CiAgICAgICAgfQoKICAgICAgICAvLyDguYHguKrguJTguIfguYDguInguJ7guLLguLDguKrguYjguKfguJkgQVBQTElDQVRJT04KICAgICAgICBpZiAoYXBwbGljYXRpb25TZWN0aW9uKSB7CiAgICAgICAgICAgIGFwcGxpY2F0aW9uU2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICB9CgogICAgICAgIGxvYWRlckVsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGNvbnRlbnRDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gY2FsbEdlbWluaShwcm9tcHQsIGlzSnNvbiA9IGZhbHNlKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUxlc3Nvbih0b3BpY092ZXJyaWRlID0gbnVsbCwgZ3JhZGVMZXZlbE92ZXJyaWRlID0gbnVsbCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoJCQoJCSAgICAgICAgZnVuY3Rpb24gY2hlY2tBbnN3ZXIocXVlc3Rpb25JbmRleCwgc2VsZWN0ZWRPcHRpb25JbmRleCkgewogICAgICAgICAgICBjb25zdCBxdWVzdGlvbkRhdGEgPSBjdXJyZW50QXBwbGljYXRpb25EYXRhW3F1ZXN0aW9uSW5kZXhdOwogICAgICAgICAgICBjb25zdCBvcHRpb25zQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHEke3F1ZXN0aW9uSW5kZXh9LW9wdGlvbnNgKTsKICAgICAgICAgICAgY29uc3QgYnV0dG9ucyA9IG9wdGlvbnNDb250YWluZXIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2J1dHRvbicpOwoKICAgICAgICAgICAgZm9yIChsZXQgYnRuIG9mIGJ1dHRvbnMpIHsgYnRuLmRpc2FibGVkID0gdHJ1ZTsgfQoKICAgICAgICAgICAgaWYgKHNlbGVjdGVkT3B0aW9uSW5kZXggPT09IHF1ZXN0aW9uRGF0YS5hbnN3ZXIpIHsKICAgICAgICAgICAgICAgIGJ1dHRvbnNbc2VsZWN0ZWRPcHRpb25JbmRleF0uY2xhc3NMaXN0LmFkZCgnY29ycmVjdCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYnV0dG9uc1tzZWxlY3RlZE9wdGlvbkluZGV4XS5jbGFzc0xpc3QuYWRkKCdpbmNvcnJlY3QnKTsKICAgICAgICAgICAgICAgIGJ1dHRvbnNbcXVlc3Rpb25EYXRhLmFuc3dlcl0uY2xhc3NMaXN0LmFkZCgnY29ycmVjdCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoJCQp3aW5kb3cuaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uID0gaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uOwp3aW5kb3cuY2hlY2tBbnN3ZXIgPSBjaGVja0Fuc3dlcjsKd2luZG93LmhhbmRsZUdlbmVyYXRlUHJhY3RpY2VUZXN0ID0gaGFuZGxlR2VuZXJhdGVQcmFjdGljZVRlc3Q7CndpbmRvdy5oYW5kbGVHZW5lcmF0ZVF1aXpGcm9tQmx1ZXByaW50VG9waWMgPSBoYW5kbGVHZW5lcmF0ZVF1aXpGcm9tQmx1ZXByaW50VG9waWM7CgovLyAtLS0g4LiV4Lix4Lin4LmB4Lib4Lij4LmB4Lil4Liw4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaIENyb3BwZXIgKOC4ieC4muC4seC4muC5geC4geC5ieC4m+C4seC4jeC4q+C4suC4q+C4siBlbGVtZW50IOC5hOC4oeC5iOC5gOC4iOC4rSkgLS0tCmxldCBjcm9wcGVySW5zdGFuY2UgPSBudWxsOwoKLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4LiC4Lit4LiHIE1vZGFsIOC4reC4seC4leC5guC4meC4oeC4seC4leC4tCAo4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1KQpmdW5jdGlvbiBlbnN1cmVDcm9wcGVyTW9kYWxFeGlzdHMoKSB7CiAgICAvLyDguJbguYnguLLguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmICiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nyb3BwZXItbW9kYWwnKSkgcmV0dXJuOwoKICAgIC8vIOC4quC4o+C5ieC4suC4hyBIVE1MIOC4lOC5ieC4p+C4oiBKYXZhU2NyaXB0IOC5geC4peC4sOC4ouC4seC4lOC5g+C4quC5iCBib2R5IOC5guC4lOC4ouC4leC4o+C4hwogICAgY29uc3QgbW9kYWxIVE1MID0gYAogICAgPGRpdiBpZD0iY3JvcHBlci1tb2RhbCIgY2xhc3M9ImZpeGVkIGluc2V0LTAgYmctYmxhY2sgYmctb3BhY2l0eS05MCB6LVs3MF0gaGlkZGVuIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHAtNCI+CiAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgdy1mdWxsIG1heC13LTR4bCBoLVs3MHZoXSBiZy1ibGFjayBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIDxpbWcgaWQ9ImltYWdlLXRvLWNyb3AiIHNyYz0iIiBjbGFzcz0ibWF4LXctZnVsbCBtYXgtaC1mdWxsIGJsb2NrIiBzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1heC13aWR0aDogMTAwJTsiPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZ2FwLTQgbXQtNCI+CiAgICAgICAgICAgIDxidXR0b24gaWQ9ImNhbmNlbC1jcm9wLWJ0biIgY2xhc3M9ImJnLWdyYXktNTAwIHRleHQtd2hpdGUgcHktMiBweC02IHJvdW5kZWQtbGcgaG92ZXI6YmctZ3JheS02MDAgZm9udC1ib2xkIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiBCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJjb25maXJtLWNyb3AtYnRuIiBjbGFzcz0iYmctZ3JlZW4tNjAwIHRleHQtd2hpdGUgcHktMiBweC02IHJvdW5kZWQtbGcgaG92ZXI6YmctZ3JlZW4tNzAwIGZvbnQtYm9sZCBzaGFkb3ctbGcgdHJhbnNmb3JtIHRyYW5zaXRpb24gaG92ZXI6c2NhbGUtMTA1Ij4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY3JvcC1hbHQiPjwvaT4g4LiV4Lix4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJICYg4Liq4LmB4LiB4LiZCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgPC9kaXY+YDsKICAgIAogICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIG1vZGFsSFRNTCk7CiAgICAKICAgIC8vIOC4nOC4ueC4gSBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguJvguLjguYjguKHguJfguLXguYjguYDguJ7guLTguYjguIfguKrguKPguYnguLLguIcKICAgIHNldHVwQ3JvcHBlckJ1dHRvbnMoKTsKfQoKYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVSZW1lZGlhbFByb2plY3QoKSB7CiAgICBjb25zdCByZW1lZGlhbFByb2plY3ROYW1lID0gIuC4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oSAoUmVtZWRpYWwpIjsKICAgIAogICAgLy8g4LiE4LmJ4LiZ4Lir4Liy4Lin4LmI4Liy4Lih4Li14LmC4Lib4Lij4LmA4LiI4LiB4LiV4LmM4LiK4Li34LmI4Lit4LiZ4Li14LmJ4LmE4Lir4LihCiAgICBjb25zdCBwcm9qZWN0c1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgKTsKICAgIGNvbnN0IHEgPSBxdWVyeShwcm9qZWN0c1JlZiwgd2hlcmUoInByb2plY3ROYW1lIiwgIj09IiwgcmVtZWRpYWxQcm9qZWN0TmFtZSkpOwogICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpOwoKICAgIGlmICghc25hcHNob3QuZW1wdHkpIHsKICAgICAgICByZXR1cm4gc25hcHNob3QuZG9jc1swXS5pZDsgLy8g4LmA4LiI4Lit4LmB4Lil4LmJ4LinIOC4quC5iOC4hyBJRCDguIHguKXguLHguJrguYTguJsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1IOC4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iOC5gOC4peC4ogogICAgICAgIGNvbnN0IG5ld1Byb2plY3RSZWYgPSBkb2MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2ApKTsKICAgICAgICBhd2FpdCBzZXREb2MobmV3UHJvamVjdFJlZiwgewogICAgICAgICAgICBwcm9qZWN0TmFtZTogcmVtZWRpYWxQcm9qZWN0TmFtZSwKICAgICAgICAgICAgc3R1ZGVudHM6IFtdLAogICAgICAgICAgICBzZXR0aW5nczogewogICAgICAgICAgICAgICAgcmVzdWx0c0Rpc3BsYXk6ICdzaG93X3Jlc3VsdHNfb25seScsIC8vIOC4quC4reC4muC4i+C5iOC4reC4oeC5hOC4oeC5iOC4hOC4p+C4o+C5gOC4q+C5h+C4meC5gOC4ieC4peC4ouC4peC4sOC5gOC4reC4teC4ouC4lOC4l+C4seC4meC4l+C4tQogICAgICAgICAgICAgICAgc2h1ZmZsZVNldHRpbmc6ICdub25lJwogICAgICAgICAgICB9LAogICAgICAgICAgICBjcmVhdGVkQnk6ICdzeXN0ZW0nLAogICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgaXNSZW1lZGlhbFByb2plY3Q6IHRydWUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gbmV3UHJvamVjdFJlZi5pZDsgLy8g4Liq4LmI4LiHIElEIOC5g+C4q+C4oeC5iOC4geC4peC4seC4muC5hOC4mwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBjcmVhdGVSZW1lZGlhbFF1aXpGb3JTdHVkZW50KG9yaWdpbmFsUXVpekRhdGEsIGRldGFpbGVkQW5zd2Vycywgc3R1ZGVudE5hbWUpIHsKICAgIGNvbnNvbGUubG9nKCLwn5qAIFN0YXJ0aW5nIGNyZWF0ZVJlbWVkaWFsUXVpekZvclN0dWRlbnQgZm9yOiIsIHN0dWRlbnROYW1lKTsKCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIOC4quC5iOC4p+C4meC4l+C4teC5iCAxOiDguITguLPguJnguKfguJPguYHguKXguLDguYDguJXguKPguLXguKLguKHguITguLPguJbguLLguKEKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgCiAgICAvLyDguYHguKLguIHguILguYnguK3guJbguLnguIEv4LiC4LmJ4Lit4Lic4Li04LiUCiAgICBjb25zdCB3cm9uZ0Fuc3dlcnMgPSBkZXRhaWxlZEFuc3dlcnMuZmlsdGVyKGEgPT4gIWEuaXNDb3JyZWN0KTsKICAgIGNvbnN0IGNvcnJlY3RBbnN3ZXJzID0gZGV0YWlsZWRBbnN3ZXJzLmZpbHRlcihhID0+IGEuaXNDb3JyZWN0KTsKICAgIGNvbnN0IHdyb25nQ291bnQgPSB3cm9uZ0Fuc3dlcnMubGVuZ3RoOwogICAgY29uc3QgdG90YWxBdmFpbGFibGUgPSBvcmlnaW5hbFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lic4Li04LiU4LmA4Lil4LiiICjguYTguJTguYnguYDguJXguYfguKEpIOC5hOC4oeC5iOC4leC5ieC4reC4h+C4quC4o+C5ieC4suC4hwogICAgaWYgKHdyb25nQ291bnQgPT09IDApIHsKICAgICAgICBjb25zb2xlLmxvZygiU3R1ZGVudCBwYXNzZWQgcGVyZmVjdGx5LiBObyByZW1lZGlhbCBuZWVkZWQuIik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLy8g4Lit4LmI4Liy4LiZ4LiE4LmI4Liy4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIExvZ2ljCiAgICBjb25zdCBsb2dpYyA9IG9yaWdpbmFsUXVpekRhdGEuc2V0dGluZ3M/LnJlbWVkaWFsTG9naWMgfHwgJ3JvdW5kXzInOyAKICAgIGxldCB0YXJnZXRUb3RhbCA9IHdyb25nQ291bnQ7CgogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiV4Liy4Lih4Liq4Li54LiV4LijCiAgICBzd2l0Y2ggKGxvZ2ljKSB7CiAgICAgICAgY2FzZSAncm91bmRfNSc6IHRhcmdldFRvdGFsID0gTWF0aC5jZWlsKHdyb25nQ291bnQgLyA1KSAqIDU7IGJyZWFrOwogICAgICAgIGNhc2UgJ3JvdW5kXzMnOiB0YXJnZXRUb3RhbCA9IE1hdGguY2VpbCh3cm9uZ0NvdW50IC8gMykgKiAzOyBicmVhazsKICAgICAgICBjYXNlICdyb3VuZF8yJzogdGFyZ2V0VG90YWwgPSBNYXRoLmNlaWwod3JvbmdDb3VudCAvIDIpICogMjsgYnJlYWs7CiAgICAgICAgY2FzZSAnZXhhY3QnOiBkZWZhdWx0OiB0YXJnZXRUb3RhbCA9IHdyb25nQ291bnQ7IGJyZWFrOwogICAgfQoKICAgIC8vIOC4q+C5ieC4suC4oeC5gOC4geC4tOC4meC4iOC4s+C4meC4p+C4meC4guC5ieC4reC4l+C4teC5iOC4oeC4tQogICAgY29uc3QgZmluYWxDb3VudCA9IE1hdGgubWluKHRhcmdldFRvdGFsLCB0b3RhbEF2YWlsYWJsZSk7CgogICAgLy8gSGVscGVyIOC4hOC5ieC4meC4q+C4suC5guC4iOC4l+C4ouC5jAogICAgY29uc3QgZmluZEZ1bGxRdWVzdGlvbiA9IChhbnN3ZXJJdGVtKSA9PiB7CiAgICAgICAgaWYgKGFuc3dlckl0ZW0ub3JpZ2luYWxJbmRleCAhPT0gdW5kZWZpbmVkICYmIG9yaWdpbmFsUXVpekRhdGEucXVlc3Rpb25zW2Fuc3dlckl0ZW0ub3JpZ2luYWxJbmRleF0pIHsKICAgICAgICAgICAgY29uc3QgcSA9IG9yaWdpbmFsUXVpekRhdGEucXVlc3Rpb25zW2Fuc3dlckl0ZW0ub3JpZ2luYWxJbmRleF07CiAgICAgICAgICAgIGNvbnN0IHFUZXh0ID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0OwogICAgICAgICAgICBpZiAocVRleHQgPT09IGFuc3dlckl0ZW0ub3JpZ2luYWxRdWVzdGlvblRleHQpIHJldHVybiBxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gb3JpZ2luYWxRdWl6RGF0YS5xdWVzdGlvbnMuZmluZChxID0+IChxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHQpID09PSBhbnN3ZXJJdGVtLm9yaWdpbmFsUXVlc3Rpb25UZXh0KTsKICAgIH07CgogICAgLy8gMS4g4LmD4Liq4LmI4LiC4LmJ4Lit4LiX4Li14LmIICLguJzguLTguJQiIOC4peC4h+C5hOC4m+C4geC5iOC4reC4mQogICAgbGV0IHJlbWVkaWFsUXVlc3Rpb25zID0gd3JvbmdBbnN3ZXJzLm1hcChpdGVtID0+IGZpbmRGdWxsUXVlc3Rpb24oaXRlbSkpLmZpbHRlcihxID0+IHEpOwoKICAgIC8vIDIuIOC4quC4uOC5iOC4oeC4guC5ieC4reC4l+C4teC5iCAi4LiW4Li54LiBIiDguKHguLLguYDguJXguLTguKEKICAgIGNvbnN0IG5lZWRlZCA9IGZpbmFsQ291bnQgLSByZW1lZGlhbFF1ZXN0aW9ucy5sZW5ndGg7CiAgICBpZiAobmVlZGVkID4gMCAmJiBjb3JyZWN0QW5zd2Vycy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qgc2h1ZmZsZWRDb3JyZWN0ID0gY29ycmVjdEFuc3dlcnMuc29ydCgoKSA9PiAwLjUgLSBNYXRoLnJhbmRvbSgpKTsKICAgICAgICBjb25zdCBmaWxsZXJzID0gc2h1ZmZsZWRDb3JyZWN0LnNsaWNlKDAsIG5lZWRlZCkKICAgICAgICAgICAgLm1hcChpdGVtID0+IGZpbmRGdWxsUXVlc3Rpb24oaXRlbSkpCiAgICAgICAgICAgIC5maWx0ZXIocSA9PiBxKTsgCiAgICAgICAgcmVtZWRpYWxRdWVzdGlvbnMgPSByZW1lZGlhbFF1ZXN0aW9ucy5jb25jYXQoZmlsbGVycyk7CiAgICB9CgogICAgLy8g4Liq4Lil4Lix4Lia4Lil4Liz4LiU4Lix4Lia4LiC4LmJ4LitCiAgICByZW1lZGlhbFF1ZXN0aW9ucy5zb3J0KCgpID0+IDAuNSAtIE1hdGgucmFuZG9tKCkpOwoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8g4Liq4LmI4Lin4LiZ4LiX4Li14LmIIDI6IOC4iOC4seC4lOC4geC4suC4o+C4kOC4suC4meC4guC5ieC4reC4oeC4ueC4pSAoQmlnIENsZWFuaW5nIEVkaXRpb24pCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICBjb25zdCByZW1lZGlhbFByb2plY3RJZCA9IGF3YWl0IGdldE9yQ3JlYXRlUmVtZWRpYWxQcm9qZWN0KCk7CiAgICBpZiAoIXJlbWVkaWFsUHJvamVjdElkKSByZXR1cm47IAoKICAgIGNvbnN0IG9yaWdpbmFsSWQgPSBvcmlnaW5hbFF1aXpEYXRhLmlkOwogICAgY29uc3QgbWFzdGVySWQgPSBgJHtvcmlnaW5hbElkfV9NYXN0ZXJgOyAKCiAgICB0cnkgewogICAgICAgIGNvbnN0IG1hc3RlclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgbWFzdGVySWQpOwogICAgICAgIGNvbnN0IHF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgKTsKICAgICAgICAKICAgICAgICAvLyDguITguYnguJnguKvguLLguYTguJ/guKXguYzguYDguIHguYjguLIKICAgICAgICBjb25zdCBxID0gcXVlcnkoCiAgICAgICAgICAgIHF1aXp6ZXNSZWYsIAogICAgICAgICAgICB3aGVyZSgicmVtZWRpYWxNYXN0ZXJJZCIsICI9PSIsIG1hc3RlcklkKSwKICAgICAgICAgICAgd2hlcmUoInJlbWVkaWFsRm9yIiwgIj09Iiwgc3R1ZGVudE5hbWUpCiAgICAgICAgKTsKICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CgogICAgICAgIGxldCByZXBhaXJJZDsKICAgICAgICBsZXQgaXNFeGlzdGluZyA9IGZhbHNlOwogICAgICAgIAogICAgICAgIGlmICghc25hcHNob3QuZW1wdHkpIHsKICAgICAgICAgICAgLy8g4LmA4LiI4Lit4LmE4Lif4Lil4LmM4LmA4LiB4LmI4LiyIC0+IOC5g+C4iuC5iSBJRCDguYDguJTguLTguKEKICAgICAgICAgICAgcmVwYWlySWQgPSBzbmFwc2hvdC5kb2NzWzBdLmlkOwogICAgICAgICAgICBpc0V4aXN0aW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguYTguKHguYjguYDguIjguK3guYTguJ/guKXguYzguYDguIHguYjguLIgLT4g4Liq4Lij4LmJ4Liy4LiHIElEIOC5g+C4q+C4oeC5iAogICAgICAgICAgICByZXBhaXJJZCA9IGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1hc3RlclNuYXAgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQobWFzdGVyUmVmKTsKICAgICAgICAgICAgICAgIGxldCBuZXh0Q291bnQgPSAxOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIW1hc3RlclNuYXAuZXhpc3RzKCkpIHsgCiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uc2V0KG1hc3RlclJlZiwgeyAKICAgICAgICAgICAgICAgICAgICAgICAgdG9waWM6IGBb4LiL4LmI4Lit4LihXSAke29yaWdpbmFsUXVpekRhdGEudG9waWN9YCwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiByZW1lZGlhbFByb2plY3RJZCwKICAgICAgICAgICAgICAgICAgICAgICAgaXNSZW1lZGlhbE1hc3RlcjogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxRdWl6SWQ6IG9yaWdpbmFsSWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbnM6IFtdLCAKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudENvdW50OiAxLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IG1hc3RlclNuYXAuZGF0YSgpLnN0dWRlbnRDb3VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIG5leHRDb3VudCA9IGN1cnJlbnRDb3VudCArIDE7CiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24udXBkYXRlKG1hc3RlclJlZiwgeyBzdHVkZW50Q291bnQ6IG5leHRDb3VudCB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gU3RyaW5nKG5leHRDb3VudCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICAgICAgICAgIHJldHVybiBgJHtvcmlnaW5hbElkfSR7c3VmZml4fWA7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgLy8g8J+UpSBCSUcgQ0xFQU5JTkc6IOC4peC5ieC4suC4h+C4m+C4o+C4sOC4p+C4seC4leC4tOC4geC4suC4o+C4quC4reC4miAoU3VibWlzc2lvbnMpIOC4l+C4tOC5ieC4h+C5gOC4quC4oeC4rSDwn5SlCiAgICAgICAgLy8g4LmE4Lih4LmI4Lin4LmI4Liy4LiI4Liw4LmA4Lib4LmH4LiZ4LmE4Lif4Lil4LmM4LmA4LiB4LmI4LiyIOC4q+C4o+C4t+C4reC5hOC4n+C4peC5jOC5g+C4q+C4oeC5iCjguJfguLXguYjguK3guLLguIjguYDguJvguYfguJkgSUQg4LiL4LmJ4Liz4LiI4Liy4LiB4LiC4Lii4LiwKQogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIGNvbnNvbGUubG9nKGDwn6e5IENsZWFuaW5nIHVwIHN1Ym1pc3Npb25zIGZvciBJRDogJHtyZXBhaXJJZH1gKTsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uQ29sUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cmVwYWlySWR9L3N1Ym1pc3Npb25zYCk7CiAgICAgICAgY29uc3Qgc3VibWlzc2lvblNuYXAgPSBhd2FpdCBnZXREb2NzKHN1Ym1pc3Npb25Db2xSZWYpOwogICAgICAgIAogICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CgogICAgICAgIC8vIDEuIOC4quC4seC5iOC4h+C4peC4miBTdWJtaXNzaW9uIOC4l+C4uOC4geC4reC4seC4meC4l+C4teC5iOC4hOC5ieC4suC4h+C4reC4ouC4ueC5iAogICAgICAgIHN1Ym1pc3Npb25TbmFwLmZvckVhY2goKHN1YkRvYykgPT4gewogICAgICAgICAgICBiYXRjaC5kZWxldGUoc3ViRG9jLnJlZik7CiAgICAgICAgfSk7CgogICAgICAgIC8vIDIuIOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4oeC4ueC4pSBRdWl6IOC5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IHF1aXpEb2NSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIHJlcGFpcklkKTsKICAgICAgICAKICAgICAgICAvLyDguILguYnguK3guKHguLnguKXguJfguLXguYjguIjguLDguK3guLHguJvguYDguJTguJUv4Liq4Lij4LmJ4Liy4LiHCiAgICAgICAgY29uc3QgcXVpekRhdGEgPSB7CiAgICAgICAgICAgIGlkOiByZXBhaXJJZCwKICAgICAgICAgICAgcHJvamVjdElkOiByZW1lZGlhbFByb2plY3RJZCwKICAgICAgICAgICAgdG9waWM6IGDguKrguK3guJrguIvguYjguK3guKE6ICR7b3JpZ2luYWxRdWl6RGF0YS50b3BpY30gKCR7c3R1ZGVudE5hbWV9KWAsCiAgICAgICAgICAgIHF1ZXN0aW9uczogcmVtZWRpYWxRdWVzdGlvbnMsCiAgICAgICAgICAgIGlzUmVtZWRpYWw6IHRydWUsCiAgICAgICAgICAgIGlzUmVtZWRpYWxDaGlsZDogdHJ1ZSwgICAgICAgCiAgICAgICAgICAgIHJlbWVkaWFsTWFzdGVySWQ6IG1hc3RlcklkLCAgCiAgICAgICAgICAgIHJlbWVkaWFsRm9yOiBzdHVkZW50TmFtZSwgICAgCiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLCAvLyDguK3guLHguJvguYDguJTguJXguYDguKfguKXguLLguKrguKPguYnguLLguIfguYPguKvguKHguYjguYDguKrguKHguK0KICAgICAgICAgICAgc2V0dGluZ3M6IHsKICAgICAgICAgICAgICAgIC4uLm9yaWdpbmFsUXVpekRhdGEuc2V0dGluZ3MsCiAgICAgICAgICAgICAgICBzaHVmZmxlOiAncXVlc3Rpb25zX29ubHknLAogICAgICAgICAgICAgICAgcmVzdWx0c0Rpc3BsYXk6ICdzaG93X3Jlc3VsdHNfb25seScsCiAgICAgICAgICAgICAgICBwYXNzaW5nU2NvcmU6IHJlbWVkaWFsUXVlc3Rpb25zLmxlbmd0aCwKICAgICAgICAgICAgICAgIGlzQWRhcHRpdmU6IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLyAzLiDguKrguLHguYjguIfguYDguILguLXguKLguJnguILguYnguK3guKHguLnguKUgUXVpeiAo4LmD4LiK4LmJIHNldCDguYDguJ7guLfguYjguK3guJfguLHguJrguYPguKvguYnguYDguIHguKXguLXguYnguKLguIcg4Lir4Lij4Li34Lit4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmIKQogICAgICAgIGJhdGNoLnNldChxdWl6RG9jUmVmLCBxdWl6RGF0YSk7CgogICAgICAgIC8vIDQuIOC4muC4seC4meC4l+C4tuC4geC4l+C4uOC4geC4reC4ouC5iOC4suC4h+C4nuC4o+C5ieC4reC4oeC4geC4seC4mQogICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFJlbWVkaWFsIFF1aXogQ3JlYXRlZC9VcGRhdGVkOiAke3JlcGFpcklkfSB3aXRoICR7cmVtZWRpYWxRdWVzdGlvbnMubGVuZ3RofSBxdWVzdGlvbnMuYCk7CiAgICAgICAgcmV0dXJuIHJlcGFpcklkOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY3JlYXRpbmcvdXBkYXRpbmcgcmVtZWRpYWwgcXVpejoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4quC4o+C5ieC4suC4h+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oTogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQp9CgpmdW5jdGlvbiBkaXNwbGF5U3VibWlzc2lvblN1Y2Nlc3MocmFuaykgewogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiB4Liy4Lij4Liq4LmI4LiHIHJhbmsg4Lih4LiyIOC5g+C4q+C5ieC5geC4quC4lOC4h+C5gOC4m+C5h+C4mSAiLSIKICAgIGNvbnN0IHJhbmtUZXh0ID0gcmFuayA/IGDguKXguLPguJTguLHguJrguJfguLXguYggPHNwYW4gY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCB0ZXh0LWJsdWUtNjAwIj4ke3Jhbmt9PC9zcGFuPmAgOiAn4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinJzsKCiAgICBjb25zdCBodG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy13aGl0ZSBib3JkZXIgYm9yZGVyLWdyYXktMjAwIHJvdW5kZWQteGwgc2hhZG93LXhsIG1heC13LTJ4bCBteC1hdXRvIG10LTEwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJteC1hdXRvIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtMjQgdy0yNCByb3VuZGVkLWZ1bGwgYmctZ3JlZW4tMTAwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrIHRleHQtNXhsIHRleHQtZ3JlZW4tNjAwIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIAogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWdyYXktODAwIG1iLTIiPuC4quC5iOC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ojwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIG1iLTggdGV4dC1sZyI+4Lij4Liw4Lia4Lia4LmE4LiU4LmJ4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiT4LmB4Lil4LmJ4LinPC9wPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmx1ZS01MCBwLTYgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWJsdWUtMTAwIG1iLTggbWF4LXctc20gbXgtYXV0byI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ibHVlLTgwMCBmb250LW1lZGl1bSBtYi0yIj7guITguLjguJPguKrguYjguIfguYHguJrguJrguJfguJTguKrguK3guJrguYDguJvguYfguJk8L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWJsdWUtOTAwIG1iLTIiPiR7cmFua1RleHR9PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXNtIHRleHQtYmx1ZS02MDAgbXQtMiBib3JkZXItdCBib3JkZXItYmx1ZS0yMDAgcHQtMiI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1idWxsaG9ybiBtci0xIj48L2k+IOC4geC4o+C4uOC4k+C4suC4o+C4reC4m+C4o+C4sOC4geC4suC4qOC4nOC4peC4quC4reC4muC4iOC4suC4geC4hOC4o+C4ueC4nOC4ueC5ieC4quC4reC4mQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGJ1dHRvbiBpZD0iYmFjay10by1ob21lLXN1Y2Nlc3MiIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS04MDAgaG92ZXI6YmctZ3JheS05MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdHJhbnNpdGlvbi10cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IHNoYWRvdy1tZCI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWhvbWUgbXItMiI+PC9pPiDguIHguKXguLHguJrguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IGh0bWw7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stdG8taG9tZS1zdWNjZXNzJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWlkLWlucHV0JykudmFsdWUgPSAnJzsgCiAgICB9KTsKfQoKZnVuY3Rpb24gaGFuZGxlUmVtZWRpYWxSZXN1bHREaXNwbGF5KHNjb3JlLCB0b3RhbCkgewogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgucm91bmQoKHNjb3JlIC8gdG90YWwpICogMTAwKTsKICAgIGxldCBtZXNzYWdlID0gIiI7CiAgICBsZXQgaWNvbiA9ICIiOwogICAgbGV0IGNvbG9yQ2xhc3MgPSAiIjsKICAgIGxldCBidG5UZXh0ID0gIuC4peC4reC4h+C5g+C4q+C4oeC5iOC4reC4teC4geC4hOC4o+C4seC5ieC4hyI7CiAgICBsZXQgaXNQYXNzID0gZmFsc2U7CgogICAgaWYgKHBlcmNlbnRhZ2UgPT09IDEwMCkgewogICAgICAgIGlzUGFzcyA9IHRydWU7CiAgICAgICAgbWVzc2FnZSA9ICLwn46JIOC4ouC4tOC4meC4lOC4teC4lOC5ieC4p+C4oiEg4Lig4Liy4Lij4LiB4Li04LiI4Liq4Liz4LmA4Lij4LmH4LiIIOC4hOC4uOC4k+C4nOC5iOC4suC4meC4geC4suC4o+C4l+C4lOC4quC4reC4muC5geC4peC5ieC4pyI7CiAgICAgICAgaWNvbiA9ICJmYS10cm9waHkgdGV4dC15ZWxsb3ctNTAwIjsKICAgICAgICBjb2xvckNsYXNzID0gImJnLWdyZWVuLTEwMCBib3JkZXItZ3JlZW4tMzAwIHRleHQtZ3JlZW4tOTAwIjsKICAgICAgICBidG5UZXh0ID0gIuC4geC4peC4seC4muC4q+C4meC5ieC4suC4q+C4peC4seC4gSI7CiAgICB9IGVsc2UgewogICAgICAgIG1lc3NhZ2UgPSAi4p2MIOC4ouC4seC4h+C5hOC4oeC5iOC4nOC5iOC4suC4mSEg4LiE4Li44LiT4LiV4LmJ4Lit4LiH4LmE4LiU4LmJ4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4LihIDEwMCUg4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZIjsKICAgICAgICBpY29uID0gImZhLXRpbWVzLWNpcmNsZSB0ZXh0LXJlZC01MDAiOwogICAgICAgIGNvbG9yQ2xhc3MgPSAiYmctcmVkLTUwIGJvcmRlci1yZWQtMjAwIHRleHQtcmVkLTkwMCI7CiAgICB9CgogICAgY29uc3QgaHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggJHtjb2xvckNsYXNzfSBib3JkZXItNCByb3VuZGVkLXhsIHNoYWRvdy14bCBtYXgtdy0yeGwgbXgtYXV0byI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgJHtpY29ufSB0ZXh0LTd4bCBtYi02Ij48L2k+CiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC00eGwgZm9udC1leHRyYWJvbGQgbWItNCI+JHtwZXJjZW50YWdlfSU8L2gyPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtYi02IHB4LTQiPiR7bWVzc2FnZX08L2gzPgogICAgICAgICAgICAKICAgICAgICAgICAgPGJ1dHRvbiBpZD0icmVtZWRpYWwtYWN0aW9uLWJ0biIgY2xhc3M9InctZnVsbCAke2lzUGFzcyA/ICdiZy1ncmVlbi02MDAgaG92ZXI6YmctZ3JlZW4tNzAwJyA6ICdiZy1ncmF5LTgwMCBob3ZlcjpiZy1ncmF5LTkwMCd9IHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgdHJhbnNpdGlvbi1hbGwgc2hhZG93LW1kIj4KICAgICAgICAgICAgICAgICR7aXNQYXNzID8gJzxpIGNsYXNzPSJmYXMgZmEtaG9tZSBtci0yIj48L2k+JyA6ICc8aSBjbGFzcz0iZmFzIGZhLXJlZG8gbXItMiI+PC9pPid9ICR7YnRuVGV4dH0KICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IGh0bWw7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbWVkaWFsLWFjdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoaXNQYXNzKSB7CiAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgICAgIC8vIPCflKUg4LmB4LiB4LmJ4LmE4LiC4LiV4Lij4LiH4LiZ4Li14LmJOiDguKrguLHguYjguIfguJvguLTguJTguKvguJnguYnguLLguJzguKXguKXguLHguJ7guJjguYzguYDguIHguYjguLIg4LiB4LmI4Lit4LiZ4LmC4Lir4Lil4LiU4LiC4LmJ4Lit4Liq4Lit4Lia4LmD4Lir4Lih4LmIIPCflKUKICAgICAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAgLy8g4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4Liy4Lic4Lil4Lil4Lix4Lie4LiY4LmMCiAgICAgICAgICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgLy8g4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiC4LmJ4Lit4Liq4Lit4LiaICjguYDguJzguLfguYjguK3guYTguKfguYkpCgogICAgICAgICAgICAvLyDguYLguKvguKXguJTguILguYnguK3guKrguK3guJrguYDguJTguLTguKHguKHguLLguJfguLPguYPguKvguKHguYgKICAgICAgICAgICAgZGlzcGxheVF1aXpGb3JTdHVkZW50KGN1cnJlbnRRdWl6RGF0YSk7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOC4leC4seC4p+C5geC4m+C4oyBHbG9iYWwg4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Liq4Lit4Lia4LiL4LmI4Lit4LihICjguYDguJ7guLfguYjguK3guYPguKvguYkgcmVuZGVyUmVtZWRpYWxMaXN0IOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC5hOC4lOC5iSkKbGV0IGN1cnJlbnRSZW1lZGlhbFN0dWRlbnRzID0gW107CmxldCBjdXJyZW50UmVtZWRpYWxNYXN0ZXJJZCA9ICcnOwpsZXQgY3VycmVudFJlbWVkaWFsVG9waWMgPSAnJzsKCmFzeW5jIGZ1bmN0aW9uIG9wZW5SZW1lZGlhbExpc3RNb2RhbChtYXN0ZXJRdWl6SWQsIHRvcGljTmFtZSwgb3JpZ2luYWxJZCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVtZWRpYWwtbGlzdC1tb2RhbCcpOwogICAgCiAgICBjdXJyZW50UmVtZWRpYWxNYXN0ZXJJZCA9IG1hc3RlclF1aXpJZDsKICAgIGN1cnJlbnRSZW1lZGlhbFRvcGljID0gdG9waWNOYW1lOwogICAgCiAgICAvLyDguJXguLHguYnguIfguIrguLfguYjguK3guKvguLHguKfguILguYnguK0KICAgIGNvbnN0IHRpdGxlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVtZWRpYWwtbW9kYWwtdGl0bGUnKTsKICAgIGlmICh0aXRsZUVsKSB0aXRsZUVsLnRleHRDb250ZW50ID0gdG9waWNOYW1lOwogICAgCiAgICBjb25zdCBtYXN0ZXJJZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbWVkaWFsLW1hc3Rlci1pZCcpOwogICAgaWYgKG1hc3RlcklkRWwpIG1hc3RlcklkRWwudGV4dENvbnRlbnQgPSBtYXN0ZXJRdWl6SWQ7CgogICAgLy8g4Lib4Li44LmI4LihIERhc2hib2FyZCAo4LiW4LmJ4Liy4Lih4Li1IExvZ2ljIOC5gOC4lOC4tOC4oeC4geC5h+C4hOC4h+C5hOC4p+C5iSDguKvguKPguLfguK3guYPguIrguYnguYHguJrguJrguJnguLXguYkpCiAgICBjb25zdCBvbGRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLW9wZW4tZGFzaGJvYXJkLWhlYWRlcicpOwogICAgaWYgKG9sZEJ0bikgb2xkQnRuLnJlbW92ZSgpOwogICAgY29uc3QgZGFzaGJvYXJkQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBkYXNoYm9hcmRCdG4uaWQgPSAnYnRuLW9wZW4tZGFzaGJvYXJkLWhlYWRlcic7CiAgICBkYXNoYm9hcmRCdG4uY2xhc3NOYW1lID0gIm1sLTQgYmctaW5kaWdvLTYwMCBob3ZlcjpiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgdGV4dC1zbSBmb250LWJvbGQgcHktMS41IHB4LTQgcm91bmRlZCBzaGFkb3cgdHJhbnNpdGlvbi1jb2xvcnMgaW5saW5lLWZsZXggaXRlbXMtY2VudGVyIGdhcC0yIjsKICAgIGRhc2hib2FyZEJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1kZXNrdG9wIj48L2k+IOC4iOC4reC4oOC4suC4nuC4o+C4p+C4oSc7CiAgICBkYXNoYm9hcmRCdG4ub25jbGljayA9IGZ1bmN0aW9uKCkgeyBvcGVuUmVtZWRpYWxEYXNoYm9hcmQoY3VycmVudFJlbWVkaWFsTWFzdGVySWQsIGN1cnJlbnRSZW1lZGlhbFRvcGljKTsgfTsKICAgIGlmICh0aXRsZUVsICYmIHRpdGxlRWwucGFyZW50Tm9kZSkgdGl0bGVFbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShkYXNoYm9hcmRCdG4sIHRpdGxlRWwubmV4dFNpYmxpbmcpOwoKICAgIGNvbnN0IHRib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbWVkaWFsLWxpc3QtYm9keScpOwogICAgdGJvZHkuaW5uZXJIVE1MID0gJzx0cj48dGQgY29sc3Bhbj0iNyIgY2xhc3M9InRleHQtY2VudGVyIHB5LTQiPjxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IOC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lC4uLjwvdGQ+PC90cj4nOwogICAgCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHEgPSBxdWVyeSgKICAgICAgICAgICAgY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCksCiAgICAgICAgICAgIHdoZXJlKCJyZW1lZGlhbE1hc3RlcklkIiwgIj09IiwgbWFzdGVyUXVpeklkKSwKICAgICAgICAgICAgd2hlcmUoImlzUmVtZWRpYWxDaGlsZCIsICI9PSIsIHRydWUpCiAgICAgICAgKTsKCiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHEpOwogICAgICAgIAogICAgICAgIGlmIChzbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICBjdXJyZW50UmVtZWRpYWxTdHVkZW50cyA9IFtdOwogICAgICAgICAgICByZW5kZXJSZW1lZGlhbExpc3QoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBzbmFwc2hvdC5kb2NzLm1hcChhc3luYyAoZG9jKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHF1aXpEYXRhID0gZG9jLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gZG9jLmlkOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaIChTdWJtaXNzaW9uKQogICAgICAgICAgICBjb25zdCBzdWJDb2wgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCk7CiAgICAgICAgICAgIGNvbnN0IHN1YlNuYXAgPSBhd2FpdCBnZXREb2NzKHN1YkNvbCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgc2NvcmUgPSAwOwogICAgICAgICAgICBsZXQgdG90YWwgPSBxdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoOwogICAgICAgICAgICBsZXQgc3RhdHVzID0gJ3BlbmRpbmcnOwogICAgICAgICAgICBsZXQgcmVhbFJvdW5kID0gMDsgLy8g4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCgogICAgICAgICAgICBpZiAoIXN1YlNuYXAuZW1wdHkpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN1YkRhdGEgPSBzdWJTbmFwLmRvY3NbMF0uZGF0YSgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3VibWl0dGVkQXQgPSBzdWJEYXRhLmxhdGVzdFN1Ym1pdHRlZEF0ID8gbmV3IERhdGUoc3ViRGF0YS5sYXRlc3RTdWJtaXR0ZWRBdCkuZ2V0VGltZSgpIDogMDsKICAgICAgICAgICAgICAgIGNvbnN0IGNyZWF0ZWRBdCA9IG5ldyBEYXRlKHF1aXpEYXRhLmNyZWF0ZWRBdCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoc3VibWl0dGVkQXQgPj0gY3JlYXRlZEF0KSB7CiAgICAgICAgICAgICAgICAgICAgc2NvcmUgPSAoc3ViRGF0YS5zY29yZSAhPT0gdW5kZWZpbmVkKSA/IHN1YkRhdGEuc2NvcmUgOiAoc3ViRGF0YS5sYXRlc3RTY29yZSB8fCAwKTsKICAgICAgICAgICAgICAgICAgICB0b3RhbCA9IHN1YkRhdGEudG90YWxRdWVzdGlvbnNDb3VudCB8fCBzdWJEYXRhLnRvdGFsUXVlc3Rpb25zIHx8IHRvdGFsOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IHF1aXpEYXRhLnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gdG90YWw7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3JlID49IHBhc3NpbmdTY29yZSkgc3RhdHVzID0gJ2NvbXBsZXRlZCc7CiAgICAgICAgICAgICAgICAgICAgZWxzZSBzdGF0dXMgPSAnZmFpbGVkJzsKCiAgICAgICAgICAgICAgICAgICAgLy8g8J+UpSDguJTguLbguIfguIjguLPguJnguKfguJnguITguKPguLHguYnguIcgKHN1Ym1pdENvdW50KSDguJfguLXguYjguYDguKPguLLguJrguLHguJnguJfguLbguIHguYTguKfguYnguYPguJnguILguYnguK0gMSDwn5SlCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdWJEYXRhLnN1Ym1pdENvdW50ID09PSAnbnVtYmVyJykgewogICAgICAgICAgICAgICAgICAgICAgICByZWFsUm91bmQgPSBzdWJEYXRhLnN1Ym1pdENvdW50OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3ViRGF0YS5hdHRlbXB0cyAmJiBBcnJheS5pc0FycmF5KHN1YkRhdGEuYXR0ZW1wdHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWxSb3VuZCA9IHN1YkRhdGEuYXR0ZW1wdHMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4teC4guC5ieC4reC4oeC4ueC4peC5geC4leC5iOC5hOC4oeC5iOC4oeC4teC4leC4seC4p+C4meC4seC4miDguYPguKvguYnguJbguLfguK3guYDguJvguYfguJkgMQogICAgICAgICAgICAgICAgICAgICAgICByZWFsUm91bmQgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHJlbWVkaWFsUXVpeklkOiBxdWl6SWQsCiAgICAgICAgICAgICAgICBuYW1lOiBxdWl6RGF0YS5yZW1lZGlhbEZvciwKICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogcXVpekRhdGEuY3JlYXRlZEF0LAogICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsCiAgICAgICAgICAgICAgICBzY29yZTogc2NvcmUsCiAgICAgICAgICAgICAgICB0b3RhbFF1ZXN0aW9uczogdG90YWwsCiAgICAgICAgICAgICAgICByb3VuZDogcmVhbFJvdW5kIC8vIOC4quC5iOC4h+C4hOC5iOC4suC4o+C4reC4muC5hOC4m+C5geC4quC4lOC4hwogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICBjb25zdCBzdHVkZW50c0RhdGEgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICAgICAgc3R1ZGVudHNEYXRhLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIuY3JlYXRlZEF0KSAtIG5ldyBEYXRlKGEuY3JlYXRlZEF0KSk7CiAgICAgICAgCiAgICAgICAgY3VycmVudFJlbWVkaWFsU3R1ZGVudHMgPSBzdHVkZW50c0RhdGE7CiAgICAgICAgcmVuZGVyUmVtZWRpYWxMaXN0KCk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsb2FkaW5nIHJlbWVkaWFsIGxpc3Q6IiwgZXJyb3IpOwogICAgICAgIHRib2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IjciIGNsYXNzPSJ0ZXh0LWNlbnRlciBweS00IHRleHQtcmVkLTUwMCI+4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUOiAke2Vycm9yLm1lc3NhZ2V9PC90ZD48L3RyPmA7CiAgICB9Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5geC4quC4lOC4h+C4nOC4peC4leC4suC4o+C4suC4hyAo4Lib4Lij4Lix4Lia4Lib4Lij4Li44LiH4LmD4Lir4Lih4LmIIOC4leC4seC4lOC4m+C4uOC5iOC4oSBEYXNoYm9hcmQg4Lit4Lit4LiBKQpmdW5jdGlvbiByZW5kZXJSZW1lZGlhbExpc3QoKSB7CiAgICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW1lZGlhbC1saXN0LWJvZHknKTsKICAgIGlmICghdGJvZHkpIHJldHVybjsKICAgIHRib2R5LmlubmVySFRNTCA9ICcnOwogICAgCiAgICBpZiAoY3VycmVudFJlbWVkaWFsU3R1ZGVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGJvZHkuaW5uZXJIVE1MID0gJzx0cj48dGQgY29sc3Bhbj0iNyIgY2xhc3M9InRleHQtY2VudGVyIHB5LTggdGV4dC1ncmF5LTQwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Liq4Lit4Lia4LiL4LmI4Lit4Lih4LmD4LiZ4Lij4Liy4Lii4LiB4Liy4Lij4LiZ4Li14LmJPC90ZD48L3RyPic7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGN1cnJlbnRSZW1lZGlhbFN0dWRlbnRzLmZvckVhY2goc3R1ZGVudCA9PiB7CiAgICAgICAgbGV0IHN0YXR1c0JhZGdlID0gJyc7CiAgICAgICAgaWYgKHN0dWRlbnQuc3RhdHVzID09PSAnY29tcGxldGVkJykgewogICAgICAgICAgICBzdGF0dXNCYWRnZSA9ICc8c3BhbiBjbGFzcz0iYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tNzAwIHB4LTIgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC14cyBmb250LWJvbGQgYm9yZGVyIGJvcmRlci1ncmVlbi0yMDAiPuC4nOC5iOC4suC4meC5geC4peC5ieC4pzwvc3Bhbj4nOwogICAgICAgIH0gZWxzZSBpZiAoc3R1ZGVudC5zdGF0dXMgPT09ICdmYWlsZWQnKSB7CiAgICAgICAgICAgIHN0YXR1c0JhZGdlID0gJzxzcGFuIGNsYXNzPSJiZy1yZWQtMTAwIHRleHQtcmVkLTcwMCBweC0yIHB5LTEgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1ib2xkIGJvcmRlciBib3JkZXItcmVkLTIwMCI+4LiV4LiB4LiL4LmJ4LizPC9zcGFuPic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhdHVzQmFkZ2UgPSAnPHNwYW4gY2xhc3M9ImJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctNzAwIHB4LTIgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC14cyBmb250LWJvbGQgYm9yZGVyIGJvcmRlci15ZWxsb3ctMjAwIj7guKPguK3guKrguK3guJo8L3NwYW4+JzsKICAgICAgICB9CgogICAgICAgIC8vIPCflKUg4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4Liq4Liz4Lir4Lij4Lix4Lia4LmB4Liq4LiU4LiH4LmA4Lil4LiC4Lij4Lit4LiaIPCflKUKICAgICAgICBjb25zdCByb3VuZERpc3BsYXkgPSAoc3R1ZGVudC5zdGF0dXMgPT09ICdwZW5kaW5nJyB8fCBzdHVkZW50LnJvdW5kID09PSAwKSAKICAgICAgICAgICAgPyAnPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAgZm9udC1ib2xkIj4tPC9zcGFuPicgCiAgICAgICAgICAgIDogYDxzcGFuIGNsYXNzPSJpbmxpbmUtZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdy04IGgtOCByb3VuZGVkLWZ1bGwgYmctaW5kaWdvLTEwMCB0ZXh0LWluZGlnby03MDAgZm9udC1ib2xkIGJvcmRlciBib3JkZXItaW5kaWdvLTIwMCI+JHtzdHVkZW50LnJvdW5kfTwvc3Bhbj5gOwoKICAgICAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICAgICAgdHIuY2xhc3NOYW1lID0gImhvdmVyOmJnLWdyYXktNTAgdHJhbnNpdGlvbi1jb2xvcnMgYm9yZGVyLWIgbGFzdDpib3JkZXItMCI7CiAgICAgICAgCiAgICAgICAgdHIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8dGQgY2xhc3M9InB5LTMgcHgtNCB0ZXh0LXhzIGZvbnQtbW9ubyB0ZXh0LWdyYXktNTAwIj4ke3N0dWRlbnQucmVtZWRpYWxRdWl6SWR9PC90ZD4KICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0zIHB4LTQgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTkwMCI+JHtzdHVkZW50Lm5hbWV9PC90ZD4KICAgICAgICAgICAgCiAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMyBweC00IHRleHQtY2VudGVyIj4ke3JvdW5kRGlzcGxheX08L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InB5LTMgcHgtNCB0ZXh0LWdyYXktNjAwIHRleHQteHMiPiR7bmV3IERhdGUoc3R1ZGVudC5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZygndGgtVEgnKX08L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InB5LTMgcHgtNCB0ZXh0LWNlbnRlciI+JHtzdGF0dXNCYWRnZX08L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InB5LTMgcHgtNCB0ZXh0LWNlbnRlciB0ZXh0LXNtIGZvbnQtYm9sZCB0ZXh0LWdyYXktNzAwIj4KICAgICAgICAgICAgICAgICR7c3R1ZGVudC5zdGF0dXMgIT09ICdwZW5kaW5nJyA/IGAke3N0dWRlbnQuc2NvcmV9IC8gJHtzdHVkZW50LnRvdGFsUXVlc3Rpb25zfWAgOiAnLSd9CiAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMyBweC00IHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0idmlld1N0dWRlbnRQcm9ncmVzcygnJHtzdHVkZW50LnJlbWVkaWFsUXVpeklkfScsICcke3N0dWRlbnQubmFtZX0nKSIgY2xhc3M9InRleHQtYmx1ZS02MDAgaG92ZXI6dGV4dC1ibHVlLTgwMCBiZy1ibHVlLTUwIGhvdmVyOmJnLWJsdWUtMTAwIHAtMiByb3VuZGVkIG1yLTIgdHJhbnNpdGlvbi1jb2xvcnMiIHRpdGxlPSLguJTguLnguILguYnguK3guKrguK3guJov4Lic4Lil4Liq4Lit4LiaIj48aSBjbGFzcz0iZmFzIGZhLWV5ZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJkZWxldGVSZW1lZGlhbFF1aXooJyR7c3R1ZGVudC5yZW1lZGlhbFF1aXpJZH0nKSIgY2xhc3M9InRleHQtcmVkLTUwMCBob3Zlcjp0ZXh0LXJlZC03MDAgYmctcmVkLTUwIGhvdmVyOmJnLXJlZC0xMDAgcC0yIHJvdW5kZWQgdHJhbnNpdGlvbi1jb2xvcnMiIHRpdGxlPSLguKXguJrguKPguLLguKLguIHguLLguKMiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgYDsKICAgICAgICB0Ym9keS5hcHBlbmRDaGlsZCh0cik7CiAgICB9KTsKfQoKLy8g4Lib4Lij4Liw4LiB4Liy4Lio4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4LmE4LiU4LmJ4LiX4Lix4LmI4Lin4LiW4Li24LiHCndpbmRvdy5yZW5kZXJSZW1lZGlhbExpc3QgPSByZW5kZXJSZW1lZGlhbExpc3Q7Cgphc3luYyBmdW5jdGlvbiBkZWxldGVSZW1lZGlhbFF1aXoocXVpeklkKSB7CiAgICBpZiAoIWNvbmZpcm0oIuC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4l+C4teC5iOC4iOC4sOC4peC4muC4iuC4uOC4lOC4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oeC4meC4teC5iT8iKSkgcmV0dXJuOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4Lil4Lia4LmA4Lit4LiB4Liq4Liy4Lij4Lit4Lit4LiB4LiI4Liy4LiBIEZpcmVzdG9yZQogICAgICAgIGF3YWl0IGRlbGV0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIHF1aXpJZCkpOwogICAgICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIHJlbWVkaWFsIHF1aXo6ICR7cXVpeklkfWApOwogICAgICAgIAogICAgICAgIC8vIDIuIOC4lOC4tuC4hyBNYXN0ZXIgSUQg4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4LitICjguJfguLXguYjguIHguLPguKXguLHguIfguYDguJvguLTguJTguK3guKLguLnguYgpIOC5gOC4nuC4t+C5iOC4reC5g+C4iuC5ieC4o+C4teC5gOC4n+C4o+C4iuC4guC5ieC4reC4oeC4ueC4pQogICAgICAgIGNvbnN0IG1hc3RlcklkRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW1lZGlhbC1tYXN0ZXItaWQnKTsKICAgICAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVtZWRpYWwtbW9kYWwtdGl0bGUnKTsKICAgICAgICAKICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguKHguLXguITguYjguLLguK3guKLguLnguYjguIjguKPguLTguIfguYTguKvguKEKICAgICAgICBjb25zdCBtYXN0ZXJJZCA9IG1hc3RlcklkRWxlbWVudCA/IG1hc3RlcklkRWxlbWVudC50ZXh0Q29udGVudCA6IG51bGw7CiAgICAgICAgY29uc3QgdG9waWNOYW1lID0gdGl0bGVFbGVtZW50ID8gdGl0bGVFbGVtZW50LnRleHRDb250ZW50IDogIuC4o+C4suC4ouC4iuC4t+C5iOC4reC4quC4reC4muC4i+C5iOC4reC4oSI7CgogICAgICAgIGlmIChtYXN0ZXJJZCkgewogICAgICAgICAgICAgLy8gMy4g4Lij4Li14LmA4Lif4Lij4LiK4LiV4Liy4Lij4Liy4LiHIOC5guC4lOC4ouC4quC5iOC4hyBNYXN0ZXIgSUQg4LiB4Lil4Lix4Lia4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmICiAgICAgICAgICAgICBhd2FpdCBvcGVuUmVtZWRpYWxMaXN0TW9kYWwobWFzdGVySWQsIHRvcGljTmFtZSwgbnVsbCk7IAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICBjb25zb2xlLndhcm4oIuC5hOC4oeC5iOC4nuC4miBNYXN0ZXIgSUQg4Lia4LiZ4Lir4LiZ4LmJ4Liy4LiI4LitIOC4m+C4tOC4lCBNb2RhbCDguYHguJfguJkiKTsKICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW1lZGlhbC1saXN0LW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgcmVtZWRpYWwgcXVpejoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4peC4mjogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfQp9Cgp3aW5kb3cuZGVsZXRlUmVtZWRpYWxRdWl6ID0gZGVsZXRlUmVtZWRpYWxRdWl6OwoKYXN5bmMgZnVuY3Rpb24gcmV2aWV3UmVtZWRpYWxRdWl6KHF1aXpJZCwgc3R1ZGVudE5hbWUpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkbWluLXJldmlldy1tb2RhbCcpOwogICAgY29uc3QgYm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1yZXZpZXctYm9keScpOwogICAgY29uc3QgdGl0bGVOYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1zdHVkZW50LW5hbWUnKTsKICAgIAogICAgLy8g4LmA4Lib4Li04LiUIE1vZGFsCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHRpdGxlTmFtZS50ZXh0Q29udGVudCA9IGDguIHguLPguKXguLHguIfguYLguKvguKXguJTguIrguLjguJTguILguYnguK3guKrguK3guJrguILguK3guIc6ICR7c3R1ZGVudE5hbWV9Li4uYDsKICAgIGJvZHkuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9InRleHQtY2VudGVyIHB5LTEwIj48ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+PC9kaXY+JzsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHF1aXpEb2MgPSBhd2FpdCBnZXREb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWQpKTsKICAgICAgICBpZiAoIXF1aXpEb2MuZXhpc3RzKCkpIHsKICAgICAgICAgICAgYm9keS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtcmVkLTUwMCB0ZXh0LWNlbnRlciI+4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJPC9wPic7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBxdWl6RG9jLmRhdGEoKTsKICAgICAgICBjb25zdCBxdWVzdGlvbkNvdW50ID0gcXVpekRhdGEucXVlc3Rpb25zID8gcXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCA6IDA7CgogICAgICAgIHRpdGxlTmFtZS5pbm5lckhUTUwgPSBg4Lic4Li54LmJ4LmA4Lij4Li14Lii4LiZOiAke3N0dWRlbnROYW1lfSB8IOC4o+C4q+C4seC4qjogJHtxdWl6SWR9IHwg4LiI4Liz4LiZ4Lin4LiZOiAke3F1ZXN0aW9uQ291bnR9IOC4guC5ieC4rWA7CgogICAgICAgIGxldCBodG1sID0gJyc7CiAgICAgICAgCiAgICAgICAgaWYgKHF1ZXN0aW9uQ291bnQgPT09IDApIHsKICAgICAgICAgICAgYm9keS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIgcHktNCI+4LmE4Lih4LmI4Lih4Li14LiE4Liz4LiW4Liy4Lih4LmD4LiZ4LiK4Li44LiU4LiC4LmJ4Lit4Liq4Lit4Lia4LiZ4Li14LmJPC9wPic7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlcjog4LiU4Li24LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiI4Liy4LiB4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBCiAgICAgICAgY29uc3QgZ2V0Q2hvaWNlVGV4dCA9IChjKSA9PiB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgYyA9PT0gJ29iamVjdCcpIHJldHVybiBjLnRleHQgfHwgYy5sYWJlbCB8fCBjLnZhbHVlIHx8IGMuYW5zd2VyIHx8IEpTT04uc3RyaW5naWZ5KGMpOwogICAgICAgICAgICByZXR1cm4gU3RyaW5nKGMpOwogICAgICAgIH07CgogICAgICAgIHF1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKChxLCBpbmRleCkgPT4gewogICAgICAgICAgICAvLyAxLiDguJTguLbguIfguJXguLHguKfguYDguKXguLfguK3guIHguKHguLIKICAgICAgICAgICAgLy8g4LmD4LiK4LmJIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoLi4uKSkg4LmA4Lie4Li34LmI4LitIGNsb25lIG9iamVjdCDguKHguLLguYDguKXguYjguJkg4LmE4Lih4LmI4LmD4Lir4LmJ4LiB4Lij4Liw4LiX4Lia4LiV4Lix4Lin4LiI4Lij4Li04LiHCiAgICAgICAgICAgIGxldCBjaG9pY2VzID0gW107CiAgICAgICAgICAgIGlmIChxLmNob2ljZXMpIGNob2ljZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHEuY2hvaWNlcykpOwogICAgICAgICAgICBlbHNlIGlmIChxLm9wdGlvbnMpIGNob2ljZXMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHEub3B0aW9ucykpOwoKICAgICAgICAgICAgbGV0IGNvcnJlY3RUZXh0ID0gIuC5hOC4oeC5iOC4o+C4sOC4muC4uCAo4Lir4Liy4LmA4LiJ4Lil4Lii4LmE4Lih4LmI4LmA4LiI4LitKSI7CiAgICAgICAgICAgIGxldCBmb3VuZENvcnJlY3RJbmRleCA9IC0xOyAvLyDguYDguIHguYfguJogaW5kZXgg4LiC4Lit4LiH4LiC4LmJ4Lit4LiX4Li14LmI4LiW4Li54LiBCgogICAgICAgICAgICAvLyAtLS0gU3RyYXRlZ3kgMTog4Lir4LiyIEZsYWcg4LmD4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIChpc0NvcnJlY3QgPSB0cnVlKSAtLS0KICAgICAgICAgICAgY2hvaWNlcy5mb3JFYWNoKChjLCBpZHgpID0+IHsKICAgICAgICAgICAgICAgIGxldCBpc0FjY3VyYXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGMgPT09ICdvYmplY3QnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGMuaXNDb3JyZWN0ID09PSB0cnVlIHx8IGMuaXNDb3JyZWN0ID09PSAidHJ1ZSIpIGlzQWNjdXJhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChjLmNvcnJlY3QgPT09IHRydWUgfHwgYy5jb3JyZWN0ID09PSAidHJ1ZSIpIGlzQWNjdXJhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChjLnJpZ2h0ID09PSB0cnVlIHx8IGMucmlnaHQgPT09ICJ0cnVlIikgaXNBY2N1cmF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaXNBY2N1cmF0ZSkgZm91bmRDb3JyZWN0SW5kZXggPSBpZHg7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gLS0tIFN0cmF0ZWd5IDI6IOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC5gOC4iOC4rSDguYPguKvguYnguKvguLLguIjguLLguIEgZmllbGQg4LiZ4Lit4LiBIChxLmFuc3dlciwgcS5jb3JyZWN0QW5zd2VyKSAtLS0KICAgICAgICAgICAgaWYgKGZvdW5kQ29ycmVjdEluZGV4ID09PSAtMSkgewogICAgICAgICAgICAgICAgY29uc3QgZGlyZWN0QW5zID0gcS5hbnN3ZXIgfHwgcS5jb3JyZWN0QW5zd2VyIHx8IHEuc29sdXRpb24gfHwgcS5rZXk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChkaXJlY3RBbnMgIT09IHVuZGVmaW5lZCAmJiBkaXJlY3RBbnMgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyAyLjEg4LiW4LmJ4Liy4LmA4LiJ4Lil4Lii4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiCIChJbmRleCkKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGRpcmVjdEFucykgJiYgY2hvaWNlc1tOdW1iZXIoZGlyZWN0QW5zKV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRDb3JyZWN0SW5kZXggPSBOdW1iZXIoZGlyZWN0QW5zKTsKICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgICAgIC8vIDIuMiDguJbguYnguLLguYDguInguKXguKLguYDguJvguYfguJnguILguYnguK3guITguKfguLLguKHguJXguKPguIfguYYKICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Lil4Lit4LiH4Lin4LiZ4Lir4Liy4Lin4LmI4Liy4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiV4Lij4LiH4LiB4Lix4LiaIGNob2ljZSDguYTguKvguJkKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IGNob2ljZXMuZmluZEluZGV4KGMgPT4gZ2V0Q2hvaWNlVGV4dChjKS50cmltKCkgPT09IFN0cmluZyhkaXJlY3RBbnMpLnRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRDb3JyZWN0SW5kZXggPSBtYXRjaEluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Lir4Liy4LmE4Lih4LmI4LmA4LiI4Lit4LmD4LiZIGNob2ljZSDguYDguKXguKIgKOC4reC4suC4iOC5gOC4m+C5h+C4meC5gOC4leC4tOC4oeC4hOC4sykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RUZXh0ID0gU3RyaW5nKGRpcmVjdEFucyk7IAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0g4Lit4Lix4Lib4LmA4LiU4LiVIHRleHQg4LmA4LiJ4Lil4LiiIOC4luC5ieC4suC5gOC4iOC4rSBpbmRleCAtLS0KICAgICAgICAgICAgaWYgKGZvdW5kQ29ycmVjdEluZGV4ICE9PSAtMSAmJiBjaG9pY2VzW2ZvdW5kQ29ycmVjdEluZGV4XSkgewogICAgICAgICAgICAgICAgY29ycmVjdFRleHQgPSBnZXRDaG9pY2VUZXh0KGNob2ljZXNbZm91bmRDb3JyZWN0SW5kZXhdKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIC0tLSDguKrguKPguYnguLLguIcgSFRNTCDguJXguLHguKfguYDguKXguLfguK3guIEgLS0tCiAgICAgICAgICAgIGxldCBjaG9pY2VzSHRtbCA9ICIiOwogICAgICAgICAgICBpZiAoY2hvaWNlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ID0gY2hvaWNlcy5tYXAoKGMsIGlkeCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBnZXRDaG9pY2VUZXh0KGMpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IChpZHggPT09IGZvdW5kQ29ycmVjdEluZGV4KTsgLy8g4LmA4LiK4LmH4LiE4LiI4Liy4LiBIGluZGV4IOC4l+C4teC5iOC5gOC4o+C4suC4quC4t+C4muC4oeC4suC5hOC4lOC5iQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIHRleHQtc20gcC0yIHJvdW5kZWQgYm9yZGVyICR7aXNDb3JyZWN0ID8gJ2JnLWdyZWVuLTUwIGJvcmRlci1ncmVlbi0yMDAgdGV4dC1ncmVlbi04MDAgZm9udC1ib2xkJyA6ICdiZy1ncmF5LTUwIGJvcmRlci1ncmF5LTEwMCB0ZXh0LWdyYXktNTAwJ30iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7aXNDb3JyZWN0ID8gJ2ZhcyBmYS1jaGVjay1jaXJjbGUgdGV4dC1ncmVlbi01MDAnIDogJ2ZhciBmYS1jaXJjbGUgdGV4dC1ncmF5LTMwMCd9IG1yLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7dGV4dH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgY2hvaWNlc0h0bWwgPSBgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtMiBtYi0zIj4ke2xpc3R9PC9kaXY+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOC5hOC4oeC5iOC4oeC4tSBjaG9pY2UKICAgICAgICAgICAgICAgIGNob2ljZXNIdG1sID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBtYi0zIGJnLWdyYXktNTAgYm9yZGVyLTIgYm9yZGVyLWRhc2hlZCBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyB0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIHRleHQtc20gaXRhbGljIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wZW4tYWx0IG1yLTIiPjwvaT4g4LiC4LmJ4Lit4Liq4Lit4Lia4Lij4Li54Lib4LmB4Lia4Lia4LmA4LiV4Li04Lih4LiE4LizIC8g4Lit4Lix4LiV4LiZ4Lix4LiiCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tIOC4quC4o+C5ieC4suC4h+C4geC4suC4o+C5jOC4lCAtLS0KICAgICAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSBwLTQgcm91bmRlZC1sZyBzaGFkb3ctc20gYm9yZGVyIGJvcmRlci1ibHVlLTEwMCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gbWItNCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWJzb2x1dGUgdG9wLTAgbGVmdC0wIHctMSBoLWZ1bGwgYmctYmx1ZS01MDAiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBsLTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBtYi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwIGZvbnQtYm9sZCBweC0yIHB5LTEgcm91bmRlZCB0ZXh0LXhzIj7guILguYnguK0gJHtpbmRleCArIDF9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktODAwIG1iLTMgdGV4dC1sZyBsZWFkaW5nLXJlbGF4ZWQiPiR7cS5xdWVzdGlvblRleHQgfHwgcS5zdGVtIHx8ICLguYLguIjguJfguKLguYzguILguYnguK3guKrguK3guJoifTwvaDQ+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAke2Nob2ljZXNIdG1sfQoKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMiB0ZXh0LXNtIHRleHQtZ3JlZW4tNzAwIGZvbnQtc2VtaWJvbGQgYmctZ3JlZW4tNTAgaW5saW5lLWJsb2NrIHB4LTMgcHktMSByb3VuZGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEta2V5IG1yLTEiPjwvaT4g4LmA4LiJ4Lil4LiiOiAke2NvcnJlY3RUZXh0fQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0pOwoKICAgICAgICBib2R5LmlubmVySFRNTCA9IGh0bWw7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciByZXZpZXdpbmcgcXVpejoiLCBlcnJvcik7CiAgICAgICAgYm9keS5pbm5lckhUTUwgPSBgPHAgY2xhc3M9InRleHQtcmVkLTUwMCB0ZXh0LWNlbnRlciI+4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUOiAke2Vycm9yLm1lc3NhZ2V9PC9wPmA7CiAgICB9Cn0KCi8vIOC4m+C4o+C4sOC4geC4suC4qCBHbG9iYWwKd2luZG93LnJldmlld1JlbWVkaWFsUXVpeiA9IHJldmlld1JlbWVkaWFsUXVpejsKCmFzeW5jIGZ1bmN0aW9uIHZpZXdTdHVkZW50UHJvZ3Jlc3MocXVpeklkLCBzdHVkZW50TmFtZSkgewogICAgY29uc29sZS5sb2coYE9wZW4gdmlld1N0dWRlbnRQcm9ncmVzczogJHtxdWl6SWR9LCAke3N0dWRlbnROYW1lfWApOwoKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcHJvZ3Jlc3MtbW9kYWwnKTsKICAgIC8vIOC5gOC4iuC5h+C4hOC4p+C5iOC4suC4oeC4tSBNb2RhbCDguKvguKPguLfguK3guYTguKHguYgKICAgIGlmICghbW9kYWwpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvcjog4LmE4Lih4LmI4Lie4LiaIE1vZGFsIElEICdzdHVkZW50LXByb2dyZXNzLW1vZGFsJyIpOwogICAgICAgIGFsZXJ0KCLguYTguKHguYjguJ7guJrguKvguJnguYnguLLguJXguYjguLLguIfguYHguKrguJTguIfguJzguKUgKE1vZGFsIElEIOC5hOC4oeC5iOC4leC4o+C4h+C4geC4seC4mSkiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3Mtc3R1ZGVudC1uYW1lJyk7CiAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzLWNvbnRlbnQtYXJlYScpOwoKICAgIC8vIDEuIOC5gOC4m+C4tOC4lCBNb2RhbCDguYHguKXguLDguYHguKrguJTguIcgTG9hZGluZwogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBpZih0aXRsZSkgdGl0bGUudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiU4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiHOiAke3N0dWRlbnROYW1lfS4uLmA7CiAgICBpZihjb250ZW50KSBjb250ZW50LmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBweS0xMCI+PGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gdGV4dC00eGwgdGV4dC1pbmRpZ28tNTAwIj48L2k+PGJyPuC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lC4uLjwvZGl2Pic7CgogICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiK4LmI4Lin4LiiIFJlbmRlciBNYXRoSmF4ICjguYDguKPguLXguKLguIHguYPguIrguYnguIvguYnguLPguYTguJTguYkpCiAgICBjb25zdCByZW5kZXJNYXRoID0gKCkgPT4gewogICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgewogICAgICAgICAgICAvLyDguKPguK3guIfguKPguLHguJrguJfguLHguYnguIcgTWF0aEpheCB2MyAodHlwZXNldFByb21pc2UpIOC5geC4peC4sCB2MiAoSHViLlF1ZXVlKQogICAgICAgICAgICBpZiAoTWF0aEpheC50eXBlc2V0UHJvbWlzZSkgewogICAgICAgICAgICAgICAgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbY29udGVudF0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnTWF0aEpheCBlcnJvcjonLCBlcnIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChNYXRoSmF4Lkh1YikgewogICAgICAgICAgICAgICAgTWF0aEpheC5IdWIuUXVldWUoWyJUeXBlc2V0IiwgTWF0aEpheC5IdWIsIGNvbnRlbnRdKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH07CgogICAgdHJ5IHsKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICAvLyBTVEVQIDE6IOC4nuC4ouC4suC4ouC4suC4oeC4lOC4tuC4hyAi4Lic4Lil4LiB4Liy4Lij4Liq4Lit4LiaIiAoU3VibWlzc2lvbikKICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgICBsZXQgc3ViRGF0YSA9IG51bGw7CiAgICAgICAgbGV0IHN1YkRvYyA9IGF3YWl0IGdldERvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3F1aXpJZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSkpOwoKICAgICAgICBpZiAoc3ViRG9jLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHN1YkRhdGEgPSBzdWJEb2MuZGF0YSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4peC4reC4hyBRdWVyeSDguKvguLLguJTguYnguKfguKLguIrguLfguYjguK0KICAgICAgICAgICAgY29uc3Qgc3ViUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2ApOwogICAgICAgICAgICBjb25zdCBxID0gcXVlcnkoc3ViUmVmLCB3aGVyZSgic3R1ZGVudE5hbWUiLCAiPT0iLCBzdHVkZW50TmFtZSkpOwogICAgICAgICAgICBjb25zdCBxdWVyeVNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKICAgICAgICAgICAgaWYgKCFxdWVyeVNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgICAgICBzdWJEYXRhID0gcXVlcnlTbmFwc2hvdC5kb2NzWzBdLmRhdGEoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8gU1RFUCAyOiDguJXguLHguJTguKrguLTguJnguYPguIjguKfguYjguLLguIjguLDguYHguKrguJTguIcgIuC4nOC4peC4quC4reC4miIg4Lir4Lij4Li34LitICLguJXguLHguKfguILguYnguK3guKrguK3guJrguYDguJvguKXguYjguLIiCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgCiAgICAgICAgLy8g4LiB4Lij4LiT4Li1IEE6IOC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4hOC4meC4quC4reC4miAtPiDguYPguKvguYnguJTguLbguIfguYLguIjguJfguKLguYzguKHguLLguYHguKrguJTguIcKICAgICAgICBpZiAoIXN1YkRhdGEpIHsKICAgICAgICAgICAgaWYodGl0bGUpIHRpdGxlLnRleHRDb250ZW50ID0gYOC4nOC4ueC5ieC5gOC4o+C4teC4ouC4mTogJHtzdHVkZW50TmFtZX0gKOC4ouC4seC4h+C5hOC4oeC5iOC5gOC4o+C4tOC5iOC4oeC4quC4reC4milgOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgcXVpekRvY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkKTsKICAgICAgICAgICAgY29uc3QgcXVpekRvYyA9IGF3YWl0IGdldERvYyhxdWl6RG9jUmVmKTsKCiAgICAgICAgICAgIGlmICghcXVpekRvYy5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1yZWQtNTAwIHB5LTEwIj7guYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguIrguLjguJTguILguYnguK3guKrguK3guJogKOC4reC4suC4iOC4luC4ueC4geC4peC4muC5hOC4m+C5geC4peC5ieC4pyk8L2Rpdj5gOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBxdWl6RGF0YSA9IHF1aXpEb2MuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBxdWVzdGlvbnMgPSBxdWl6RGF0YS5xdWVzdGlvbnMgfHwgW107CgogICAgICAgICAgICBsZXQgcGVuZGluZ0h0bWwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy15ZWxsb3ctNTAgYm9yZGVyIGJvcmRlci15ZWxsb3ctMjAwIHJvdW5kZWQtbGcgcC00IG1iLTQgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaG91cmdsYXNzLXN0YXJ0IHRleHQteWVsbG93LTYwMCB0ZXh0LXhsIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC15ZWxsb3ctODAwIGZvbnQtYm9sZCI+4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJ4Lii4Lix4LiH4LmE4Lih4LmI4LmE4LiU4LmJ4LiX4Liz4LiC4LmJ4Lit4Liq4Lit4Lia4LiL4LmI4Lit4LihPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQteWVsbG93LTcwMCI+4LiU4LmJ4Liy4LiZ4Lil4LmI4Liy4LiH4LiE4Li34Lit4Lij4Liy4Lii4LiB4Liy4Lij4LiC4LmJ4Lit4Liq4Lit4Lia4LiX4Li14LmI4Lij4Liw4Lia4Lia4LiI4Lix4LiU4LmA4LiV4Lij4Li14Lii4Lih4LmE4Lin4LmJ4LmD4Lir4LmJPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSByb3VuZGVkLWxnIHNoYWRvdyBvdmVyZmxvdy1oaWRkZW4gYm9yZGVyIGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ib3ZlcmZsb3cteC1hdXRvIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGRpdmlkZS15IGRpdmlkZS1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9ImJnLWdyYXktMTAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHgtNCBweS0zIHRleHQtY2VudGVyIHRleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2Ugdy0xNiI+4LiC4LmJ4Lit4LiX4Li14LmIPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweC00IHB5LTMgdGV4dC1sZWZ0IHRleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2UiPuC5guC4iOC4l+C4ouC5jOC4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHgtNCBweS0zIHRleHQtY2VudGVyIHRleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2Ugdy0zMiI+4Liq4LiW4Liy4LiZ4LiwPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keSBjbGFzcz0iYmctd2hpdGUgZGl2aWRlLXkgZGl2aWRlLWdyYXktMjAwIj4KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIHF1ZXN0aW9ucy5mb3JFYWNoKChxLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgbGV0IHFUZXh0ID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0IHx8ICLguITguLPguJbguLLguKHguILguYnguK3guJfguLXguYggIiArIChpbmRleCArIDEpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwZW5kaW5nSHRtbCArPSBgCiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB4LTQgcHktMyB3aGl0ZXNwYWNlLW5vd3JhcCB0ZXh0LXNtIHRleHQtZ3JheS01MDAgdGV4dC1jZW50ZXIgZm9udC1tb25vIj4ke2luZGV4ICsgMX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB4LTQgcHktMyB0ZXh0LXNtIHRleHQtZ3JheS05MDAgZm9udC1tZWRpdW0iPiR7cVRleHR9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweC00IHB5LTMgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImlubGluZS1mbGV4IGl0ZW1zLWNlbnRlciBweC0yLjUgcHktMC41IHJvdW5kZWQtZnVsbCB0ZXh0LXhzIGZvbnQtbWVkaXVtIGJnLWdyYXktMTAwIHRleHQtZ3JheS04MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOC4o+C4reC4geC4suC4o+C4quC4reC4mgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHBlbmRpbmdIdG1sICs9IGA8L3Rib2R5PjwvdGFibGU+PC9kaXY+PC9kaXY+YDsKICAgICAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSBwZW5kaW5nSHRtbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIPCflKUg4LmA4Lij4Li14Lii4LiBIFJlbmRlciBNYXRoSmF4CiAgICAgICAgICAgIHJlbmRlck1hdGgoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgLy8g4LiB4Lij4LiT4Li1IEI6IOC4oeC4teC4nOC4peC4quC4reC4muC5geC4peC5ieC4pyAo4LmB4Liq4LiU4LiH4LiE4Liw4LmB4LiZ4LiZ4LmB4Lil4Liw4LmA4LiJ4Lil4LiiKQogICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogICAgICAgIGlmKHRpdGxlKSB0aXRsZS50ZXh0Q29udGVudCA9IGDguJzguLnguYnguYDguKPguLXguKLguJk6ICR7c3R1ZGVudE5hbWV9IHwg4Lij4Lir4Lix4LiqOiAke3F1aXpJZH1gOwoKICAgICAgICAvLyBTbWFydCBMb29rdXAg4Lir4Liy4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiV4Lit4LiaCiAgICAgICAgbGV0IGRldGFpbHMgPSBzdWJEYXRhLmRldGFpbGVkTGFzdEF0dGVtcHQ7IAogICAgICAgIGlmICghZGV0YWlscyAmJiBzdWJEYXRhLmF0dGVtcHRzICYmIHN1YkRhdGEuYXR0ZW1wdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBkZXRhaWxzID0gc3ViRGF0YS5hdHRlbXB0c1tzdWJEYXRhLmF0dGVtcHRzLmxlbmd0aCAtIDFdLmFuc3dlcnM7IAogICAgICAgIH0KICAgICAgICBpZiAoIWRldGFpbHMgJiYgc3ViRGF0YS5hbnN3ZXJzKSB7CiAgICAgICAgICAgIGRldGFpbHMgPSBzdWJEYXRhLmFuc3dlcnM7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBzY29yZVRvU2hvdyA9IChzdWJEYXRhLnNjb3JlICE9PSB1bmRlZmluZWQpID8gc3ViRGF0YS5zY29yZSA6IChzdWJEYXRhLmxhdGVzdFNjb3JlIHx8IDApOwogICAgICAgIGNvbnN0IHRvdGFsVG9TaG93ID0gc3ViRGF0YS50b3RhbFF1ZXN0aW9uc0NvdW50IHx8IHN1YkRhdGEudG90YWxRdWVzdGlvbnMgfHwgMDsKCiAgICAgICAgaWYgKCFkZXRhaWxzIHx8IGRldGFpbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcHktMTAgdGV4dC1vcmFuZ2UtNTAwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSB0ZXh0LTR4bCBtYi0zIj48L2k+CiAgICAgICAgICAgICAgICAgICAgPHA+4LmE4Lih4LmI4Lie4Lia4Lij4Liy4Lii4Lil4Liw4LmA4Lit4Li14Lii4LiU4Lij4Liy4Lii4LiC4LmJ4LitPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS00MDAgbXQtMiBmb250LWJvbGQiPuC4hOC4sOC5geC4meC4meC4o+C4p+C4oTogJHtzY29yZVRvU2hvd30gLyAke3RvdGFsVG9TaG93fTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGxldCB0YWJsZUh0bWwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXdoaXRlIHJvdW5kZWQtbGcgc2hhZG93IG92ZXJmbG93LWhpZGRlbiBib3JkZXIgYm9yZGVyLWdyYXktMjAwIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCBiZy1ncmF5LTUwIGJvcmRlci1iIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWdyYXktNzAwIj48aSBjbGFzcz0iZmFzIGZhLWhpc3RvcnkgbXItMiI+PC9pPuC4quC4o+C4uOC4m+C4nOC4peC4geC4suC4o+C4quC4reC4muC4peC5iOC4suC4quC4uOC4lDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0icHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIGZvbnQtYm9sZCAke3Njb3JlVG9TaG93ID49ICh0b3RhbFRvU2hvdy8yKSA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi03MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtNzAwJ30iPgogICAgICAgICAgICAgICAgICAgICAgICDguITguLDguYHguJnguJk6ICR7c2NvcmVUb1Nob3d9IC8gJHt0b3RhbFRvU2hvd30KICAgICAgICAgICAgICAgICAgICA8L3NwYW4+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im92ZXJmbG93LXgtYXV0byI+CiAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGRpdmlkZS15IGRpdmlkZS1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZCBjbGFzcz0iYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHgtNCBweS0zIHRleHQtY2VudGVyIHRleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCB1cHBlcmNhc2Ugdy0xNiI+4LiC4LmJ4Lit4LiX4Li14LmIPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB4LTQgcHktMyB0ZXh0LWxlZnQgdGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+4LmC4LiI4LiX4Lii4LmMPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB4LTQgcHktMyB0ZXh0LWxlZnQgdGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNTAwIHVwcGVyY2FzZSI+4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB4LTQgcHktMyB0ZXh0LWNlbnRlciB0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAgdXBwZXJjYXNlIHctMjQiPuC4nOC4peC4peC4seC4nuC4mOC5jDwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgY2xhc3M9ImJnLXdoaXRlIGRpdmlkZS15IGRpdmlkZS1ncmF5LTIwMCI+CiAgICAgICAgYDsKCiAgICAgICAgZGV0YWlscy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gewogICAgICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBpdGVtLmlzQ29ycmVjdDsKICAgICAgICAgICAgbGV0IHFUZXh0ID0gaXRlbS5vcmlnaW5hbFF1ZXN0aW9uVGV4dCB8fCAi4LiE4Liz4LiW4Liy4Lih4LiC4LmJ4Lit4LiX4Li14LmIICIgKyAoaW5kZXggKyAxKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOKdjCDguKXguJrguKrguYjguKfguJnguJfguLXguYjguJXguLHguJTguITguLMgKHN1YnN0cmluZykg4Lit4Lit4LiBIOC5gOC4nuC4o+C4suC4sOC4l+C4s+C5g+C4q+C5iSBMYVRlWCDguJ7guLHguIcKICAgICAgICAgICAgLy8gaWYgKHFUZXh0Lmxlbmd0aCA+IDEwMCkgcVRleHQgPSBxVGV4dC5zdWJzdHJpbmcoMCwgMTAwKSArICIuLi4iOyAKCiAgICAgICAgICAgIGxldCBhbnNUZXh0ID0gaXRlbS5hbnN3ZXJUZXh0IHx8IGl0ZW0uYW5zd2VyOwogICAgICAgICAgICBpZiAoYW5zVGV4dCA9PT0gbnVsbCB8fCBhbnNUZXh0ID09PSB1bmRlZmluZWQgfHwgYW5zVGV4dCA9PT0gIiIpIHsKICAgICAgICAgICAgICAgIGFuc1RleHQgPSAnPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAgaXRhbGljIj7guYTguKHguYjguJXguK3guJo8L3NwYW4+JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGFibGVIdG1sICs9IGAKICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iJHtpc0NvcnJlY3QgPyAnYmctZ3JlZW4tNTAvNDAgaG92ZXI6YmctZ3JlZW4tNTAnIDogJ2JnLXJlZC01MC80MCBob3ZlcjpiZy1yZWQtNTAnfSB0cmFuc2l0aW9uLWNvbG9ycyI+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweC00IHB5LTMgd2hpdGVzcGFjZS1ub3dyYXAgdGV4dC1zbSB0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIGZvbnQtbW9ubyI+JHtpbmRleCArIDF9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB4LTQgcHktMyB0ZXh0LXNtIHRleHQtZ3JheS05MDAgZm9udC1tZWRpdW0iPiR7cVRleHR9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB4LTQgcHktMyB0ZXh0LXNtIHRleHQtZ3JheS02MDAiPiR7YW5zVGV4dH08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHgtNCBweS0zIHdoaXRlc3BhY2Utbm93cmFwIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtpc0NvcnJlY3QgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICc8c3BhbiBjbGFzcz0iaW5saW5lLWZsZXggaXRlbXMtY2VudGVyIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1tZWRpdW0gYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrIG1yLTEiPjwvaT4g4LiW4Li54LiBPC9zcGFuPicgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICc8c3BhbiBjbGFzcz0iaW5saW5lLWZsZXggaXRlbXMtY2VudGVyIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsIHRleHQteHMgZm9udC1tZWRpdW0gYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMgbXItMSI+PC9pPiDguJzguLTguJQ8L3NwYW4+J30KICAgICAgICAgICAgICAgICAgICA8L3RkPgogICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgYDsKICAgICAgICB9KTsKCiAgICAgICAgdGFibGVIdG1sICs9IGA8L3Rib2R5PjwvdGFibGU+PC9kaXY+PC9kaXY+YDsKICAgICAgICAKICAgICAgICAvLyDguKrguKPguLjguJvguITguLDguYHguJnguJnguJfguYnguLLguKLguJXguLLguKPguLLguIcKICAgICAgICBjb25zdCBjb3JyZWN0Q291bnQgPSBkZXRhaWxzLmZpbHRlcihkID0+IGQuaXNDb3JyZWN0KS5sZW5ndGg7CiAgICAgICAgY29uc3Qgd3JvbmdDb3VudCA9IGRldGFpbHMubGVuZ3RoIC0gY29ycmVjdENvdW50OwogICAgICAgIHRhYmxlSHRtbCArPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTQgZ3JpZCBncmlkLWNvbHMtMiBnYXAtNCB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmVlbi01MCBwLTMgcm91bmRlZCBib3JkZXIgYm9yZGVyLWdyZWVuLTIwMCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1ncmVlbi04MDAgdGV4dC14cyB1cHBlcmNhc2UgZm9udC1ib2xkIj7guJXguK3guJrguJbguLnguIE8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1ncmVlbi02MDAiPiR7Y29ycmVjdENvdW50fTwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1yZWQtNTAgcC0zIHJvdW5kZWQgYm9yZGVyIGJvcmRlci1yZWQtMjAwIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXJlZC04MDAgdGV4dC14cyB1cHBlcmNhc2UgZm9udC1ib2xkIj7guJXguK3guJrguJzguLTguJQ8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1yZWQtNjAwIj4ke3dyb25nQ291bnR9PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKCiAgICAgICAgY29udGVudC5pbm5lckhUTUwgPSB0YWJsZUh0bWw7CgogICAgICAgIC8vIPCflKUg4LmA4Lij4Li14Lii4LiBIFJlbmRlciBNYXRoSmF4IOC4quC4s+C4q+C4o+C4seC4muC4leC4suC4o+C4suC4h+C4meC4teC5ieC4lOC5ieC4p+C4ogogICAgICAgIHJlbmRlck1hdGgoKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHZpZXdpbmcgcHJvZ3Jlc3M6IiwgZXJyb3IpOwogICAgICAgIGlmKGNvbnRlbnQpIGNvbnRlbnQuaW5uZXJIVE1MID0gYDxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAgdGV4dC1jZW50ZXIgcHktNCBiZy1yZWQtNTAgcm91bmRlZCBib3JkZXIgYm9yZGVyLXJlZC0yMDAiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4pTogJHtlcnJvci5tZXNzYWdlfTwvcD5gOwogICAgfQp9CgovLyDguJvguKPguLDguIHguLLguKggR2xvYmFsCndpbmRvdy52aWV3U3R1ZGVudFByb2dyZXNzID0gdmlld1N0dWRlbnRQcm9ncmVzczsKCmZ1bmN0aW9uIGRpc3BsYXlSZW1lZGlhbFN0YXJ0U2NyZWVuKHN0dWRlbnROYW1lLCB0b3BpYykgewogICAgICAgICAgICAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguIHguKPguK3guIHguKPguKvguLHguKog4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LmA4LiV4Lij4Li14Lii4Lih4LiV4Lix4LinCiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudE5hbWVTZWxlY3Rpb25WaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgICAgICAgICAgLy8g4LiL4LmI4Lit4LiZIERyb3Bkb3duIOC5geC4peC4sCBMYWJlbCDguYDguJTguLTguKEKICAgICAgICAgICAgY29uc3Qgc2VsZWN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1uYW1lLXNlbGVjdCcpOwogICAgICAgICAgICBjb25zdCBsYWJlbEVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbGFiZWxbZm9yPSJzdHVkZW50LW5hbWUtc2VsZWN0Il0nKTsKICAgICAgICAgICAgaWYoc2VsZWN0RWwpIHNlbGVjdEVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgIGlmKGxhYmVsRWwpIGxhYmVsRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCiAgICAgICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4q+C4seC4p+C4guC5ieC4reC5g+C4q+C5ieC4o+C4ueC5ieC4p+C5iOC4suC5gOC4m+C5h+C4meC4quC4reC4muC4i+C5iOC4reC4oQogICAgICAgICAgICBjb25zdCB0b3BpY0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcXVpei10b3BpYycpOwogICAgICAgICAgICB0b3BpY0VsLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtc20gYmxvY2sgbWItMSI+4Liq4Lit4Lia4LiL4LmI4Lit4Lih4Lij4Liy4Lii4Lia4Li44LiE4LiE4LilPC9zcGFuPgogICAgICAgICAgICAgICAgJHt0b3BpY30KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIC8vIOC4quC4o+C5ieC4suC4hyBFbGVtZW50IOC5geC4quC4lOC4h+C4iuC4t+C5iOC4reC4leC4seC4p+C5g+C4q+C4jeC5iOC5hiAo4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1KQogICAgICAgICAgICBsZXQgbmFtZURpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVtZWRpYWwtbmFtZS1kaXNwbGF5Jyk7CiAgICAgICAgICAgIGlmICghbmFtZURpc3BsYXkpIHsKICAgICAgICAgICAgICAgIG5hbWVEaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBuYW1lRGlzcGxheS5pZCA9ICdyZW1lZGlhbC1uYW1lLWRpc3BsYXknOwogICAgICAgICAgICAgICAgLy8g4LmB4LiX4Lij4LiB4LmE4Lin4LmJ4LiB4LmI4Lit4LiZ4Lib4Li44LmI4Lih4LmA4Lij4Li04LmI4LihCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtcXVpei1idG4nKS5iZWZvcmUobmFtZURpc3BsYXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDguIjguLHguJQgU3R5bGUg4LiB4Liy4Lij4LmB4Liq4LiU4LiH4LiK4Li34LmI4LitCiAgICAgICAgICAgIG5hbWVEaXNwbGF5LmNsYXNzTmFtZSA9ICJ0ZXh0LWNlbnRlciBwLTYgYmctaW5kaWdvLTUwIHJvdW5kZWQteGwgYm9yZGVyLTIgYm9yZGVyLWluZGlnby0xMDAgbXktNiI7CiAgICAgICAgICAgIG5hbWVEaXNwbGF5LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlci1jaXJjbGUgdGV4dC00eGwgdGV4dC1pbmRpZ28tNDAwIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIHRleHQtc20iPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjwvcD4KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtaW5kaWdvLTgwMCI+JHtzdHVkZW50TmFtZX08L2gzPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtNCBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCB0ZXh0LXNtIHB5LTIgcHgtNCByb3VuZGVkLWZ1bGwgaW5saW5lLWJsb2NrIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZsYWciPjwvaT4g4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4LiiOiDguJXguYnguK3guIfguYTguJTguYnguITguLDguYHguJnguJnguYDguJXguYfguKEgMTAwJQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICAvLyDguYDguJvguLTguJTguJvguLjguYjguKHguYPguKvguYnguIHguJTguYDguKPguLTguYjguKHguYTguJTguYnguYDguKXguKIKICAgICAgICAgICAgc3RhcnRRdWl6QnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgfQoKZnVuY3Rpb24gc2V0dXBDcm9wcGVyQnV0dG9ucygpIHsKICAgIC8vIOC4m+C4uOC5iOC4oeC4ouC4geC5gOC4peC4tOC4gQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1jcm9wLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcm9wcGVyLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgaWYgKGNyb3BwZXJJbnN0YW5jZSkgewogICAgICAgICAgICBjcm9wcGVySW5zdGFuY2UuZGVzdHJveSgpOwogICAgICAgICAgICBjcm9wcGVySW5zdGFuY2UgPSBudWxsOwogICAgICAgIH0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FtZXJhLWlucHV0JykudmFsdWUgPSAnJzsKICAgIH0pOwoKICAgIC8vIOC4m+C4uOC5iOC4oeC4ouC4t+C4meC4ouC4seC4mQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tY3JvcC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoIWNyb3BwZXJJbnN0YW5jZSkgcmV0dXJuOwogICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1jcm9wLWJ0bicpOwogICAgICAgIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGNvbmZpcm1CdG4uaW5uZXJIVE1MOwogICAgICAgIGNvbmZpcm1CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIj48L2k+IOC4geC4s+C4peC4seC4h+C4m+C4o+C4sOC4oeC4p+C4peC4nOC4pS4uLic7CiAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7CgogICAgICAgIGNyb3BwZXJJbnN0YW5jZS5nZXRDcm9wcGVkQ2FudmFzKCkudG9CbG9iKGFzeW5jIChibG9iKSA9PiB7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcm9wcGVyLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjcm9wcGVkRmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgImNyb3BwZWRfaW1hZ2UucG5nIiwgeyB0eXBlOiAiaW1hZ2UvcG5nIiB9KTsKICAgICAgICAgICAgYXdhaXQgaGFuZGxlU2NhbkltYWdlRm9yVGV4dChjcm9wcGVkRmlsZSk7CgogICAgICAgICAgICBjb25maXJtQnRuLmlubmVySFRNTCA9IG9yaWdpbmFsVGV4dDsKICAgICAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICBjcm9wcGVySW5zdGFuY2UuZGVzdHJveSgpOwogICAgICAgICAgICBjcm9wcGVySW5zdGFuY2UgPSBudWxsOwogICAgICAgIH0sICdpbWFnZS9wbmcnKTsKICAgIH0pOwp9CgpmdW5jdGlvbiBzdGFydENyb3BwZXIoZmlsZSkgewogICAgLy8gMS4g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LiB4LmI4Lit4LiZ4LmA4Liq4Lih4LitIOC5gOC4nuC4t+C5iOC4reC4quC4o+C5ieC4suC4hyBNb2RhbCDguJbguYnguLLguKHguLHguJnguKvguLLguKLguYTguJsKICAgIGVuc3VyZUNyb3BwZXJNb2RhbEV4aXN0cygpOwoKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nyb3BwZXItbW9kYWwnKTsKICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWFnZS10by1jcm9wJyk7CiAgICAKICAgIC8vIDIuIOC4reC5iOC4suC4meC5hOC4n+C4peC5jAogICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gewogICAgICAgIC8vIOC4leC4reC4meC4meC4teC5iSBpbWFnZUVsZW1lbnQg4LiV4LmJ4Lit4LiH4Lih4Li14Lit4Lii4Li54LmI4LiI4Lij4Li04LiH4LmB4LiZ4LmI4LiZ4Lit4LiZIDEwMCUKICAgICAgICBpbWFnZUVsZW1lbnQuc3JjID0gZS50YXJnZXQucmVzdWx0OyAKICAgICAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICAgICAgaWYgKGNyb3BwZXJJbnN0YW5jZSkgY3JvcHBlckluc3RhbmNlLmRlc3Ryb3koKTsKCiAgICAgICAgY3JvcHBlckluc3RhbmNlID0gbmV3IENyb3BwZXIoaW1hZ2VFbGVtZW50LCB7CiAgICAgICAgICAgIHZpZXdNb2RlOiAxLAogICAgICAgICAgICBkcmFnTW9kZTogJ21vdmUnLAogICAgICAgICAgICBhdXRvQ3JvcEFyZWE6IDAuOCwKICAgICAgICAgICAgcmVzdG9yZTogZmFsc2UsCiAgICAgICAgICAgIGd1aWRlczogdHJ1ZSwKICAgICAgICAgICAgY2VudGVyOiB0cnVlLAogICAgICAgICAgICBoaWdobGlnaHQ6IGZhbHNlLAogICAgICAgICAgICBjcm9wQm94TW92YWJsZTogdHJ1ZSwKICAgICAgICAgICAgY3JvcEJveFJlc2l6YWJsZTogdHJ1ZSwKICAgICAgICAgICAgdG9nZ2xlRHJhZ01vZGVPbkRibGNsaWNrOiBmYWxzZSwKICAgICAgICB9KTsKICAgIH07CiAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKfQoKLy8gRXZlbnQgTGlzdGVuZXJzIOC4q+C4peC4seC4gSAo4Lin4Liy4LiH4LiV4LmI4Lit4LiX4LmJ4Liy4LiiIGNvZGUg4LiZ4Li14LmJ4LmE4LiU4LmJ4LmA4Lil4LiiKQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgY29uc3QgY2FtZXJhSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FtZXJhLWlucHV0Jyk7CiAgICBjb25zdCBjYW1lcmFCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FtZXJhLWNyb3AtYnRuJyk7CiAgICAKICAgIGlmIChjYW1lcmFCdG4gJiYgY2FtZXJhSW5wdXQpIHsKICAgICAgICBjYW1lcmFCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGNhbWVyYUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgICAgIGNhbWVyYUlucHV0LmNsaWNrKCk7CiAgICAgICAgfSk7CgogICAgICAgIGNhbWVyYUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5maWxlcyAmJiBlLnRhcmdldC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBzdGFydENyb3BwZXIoZS50YXJnZXQuZmlsZXNbMF0pOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0pOwoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2NhbkltYWdlRm9yVGV4dChmaWxlKSB7CiAgICBjb25zdCB0ZXh0QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0ZXh0LWNvbnRlbnQtaW5wdXQnKTsKICAgIGNvbnN0IHNjYW5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nhbi10ZXh0LWltYWdlLWJ0bicpOwogICAgCiAgICBpZiAoIWZpbGUpIHJldHVybjsKCiAgICAvLyDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguJfguLPguIfguLLguJkKICAgIHNjYW5CdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgc2NhbkJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4iPjwvaT4g4LiB4Liz4Lil4Lix4LiH4Lit4LmI4Liy4LiZ4Lij4Li54Lib4Lig4Liy4LieLi4uJzsKICAgIHRleHRBcmVhLnBsYWNlaG9sZGVyID0gIkFJIOC4geC4s+C4peC4seC4h+C4nuC4ouC4suC4ouC4suC4oeC4reC5iOC4suC4meC4guC5ieC4reC4hOC4p+C4suC4oeC4iOC4suC4geC4o+C4ueC4m+C4oOC4suC4nuC4guC4reC4h+C4hOC4uOC4kyDguIHguKPguLjguJPguLLguKPguK3guKrguLHguIHguITguKPguLnguYguLi4iOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4LmB4Lib4Lil4LiH4LmE4Lif4Lil4LmM4Lij4Li54Lib4LmA4Lib4LmH4LiZIEJhc2U2NAogICAgICAgIGNvbnN0IGJhc2U2NFN0cmluZyA9IGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiByZXNvbHZlKHJlYWRlci5yZXN1bHQuc3BsaXQoJywnKVsxXSk7CiAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0OwogICAgICAgIH0pOwoKICAgICAgICAvLyAyLiDguYDguJXguKPguLXguKLguKHguITguLPguKrguLHguYjguIfguYPguKvguYkgQUkKICAgICAgICBjb25zdCBwcm9tcHQgPSBgCiAgICAgICAgICAgIOC4oOC4suC4o+C4geC4tOC4iDog4LmB4LiB4Liw4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiI4Liy4LiB4Lij4Li54Lib4Lig4Liy4Lie4LiZ4Li14LmJIChPQ1IpCiAgICAgICAgICAgIOC4hOC4s+C4quC4seC5iOC4hzoKICAgICAgICAgICAgMS4g4Lit4LmI4Liy4LiZ4LiV4Lix4Lin4Lit4Lix4LiB4Lip4Lij4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4Lij4Li54Lib4Lig4Liy4LieIOC5hOC4oeC5iOC4p+C5iOC4suC4iOC4sOC5gOC4m+C5h+C4meC4oOC4suC4qeC4suC5hOC4l+C4ouC4q+C4o+C4t+C4reC4reC4seC4h+C4geC4pOC4qQogICAgICAgICAgICAyLiDguIjguLHguJTguKPguLnguJvguYHguJrguJrguYDguKfguYnguJnguKfguKPguKPguITguYHguKXguLDguJrguKPguKPguJfguLHguJTguYPguKvguYnguYDguKvguKHguLfguK3guJnguJXguYnguJnguInguJrguLHguJrguKHguLLguIHguJfguLXguYjguKrguLjguJQKICAgICAgICAgICAgMy4g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmD4Liq4LmI4LiE4Liz4LiZ4Liz4Lir4LiZ4LmJ4Liy4Lit4Lii4LmI4Liy4LiHICLguJnguLXguYjguITguLfguK3guILguYnguK3guITguKfguLLguKEiIOC5g+C4q+C5ieC4quC5iOC4h+C4hOC4t+C4meC5gOC4ieC4nuC4suC4sOC5gOC4meC4t+C5ieC4reC4q+C4suC5g+C4meC4o+C4ueC4m+C5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgIGA7CgogICAgICAgIC8vIDMuIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5iSBoYW5kbGVBcGlDYWxsICjguKrguYjguIfguYTguJvguYHguJrguJrguYTguKHguYjguKHguLUgU2NoZW1hIOC5gOC4nuC4t+C5iOC4reC4guC4rSBUZXh0IOC4peC5ieC4p+C4meC5hikKICAgICAgICBjb25zdCBwYXJ0cyA9IFsKICAgICAgICAgICAgeyB0ZXh0OiBwcm9tcHQgfSwKICAgICAgICAgICAgeyBpbmxpbmVEYXRhOiB7IG1pbWVUeXBlOiBmaWxlLnR5cGUsIGRhdGE6IGJhc2U2NFN0cmluZyB9IH0KICAgICAgICBdOwoKICAgICAgICAvLyDguYPguIrguYkgZmFsc2Ug4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lic4LilIFF1aXosIOC5geC4peC4sCBudWxsIHNjaGVtYSDguYDguJ7guLfguYjguK3guILguK0gU3RyaW5nCiAgICAgICAgY29uc3QgZXh0cmFjdGVkVGV4dCA9IGF3YWl0IGhhbmRsZUFwaUNhbGwocGFydHMsICJBSSDguIHguLPguKXguLHguIfguKrguYHguIHguJnguILguYnguK3guITguKfguLLguKEuLi4iLCBudWxsLCBudWxsLCBmYWxzZSk7CgogICAgICAgIGlmIChleHRyYWN0ZWRUZXh0KSB7CiAgICAgICAgICAgIC8vIDQuIOC4meC4s+C4guC5ieC4reC4hOC4p+C4suC4oeC4l+C4teC5iOC5hOC4lOC5ieC4oeC4suC5g+C4quC5iOC4peC4h+C5g+C4mSBUZXh0YXJlYSAo4LiV4LmI4Lit4LiI4Liy4LiB4LiC4Lit4LiH4LmA4LiU4Li04Lih4LiW4LmJ4Liy4Lih4Li1KQogICAgICAgICAgICBjb25zdCBjdXJyZW50VGV4dCA9IHRleHRBcmVhLnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgdGV4dEFyZWEudmFsdWUgPSBjdXJyZW50VGV4dCA/IGN1cnJlbnRUZXh0ICsgIlxuXG4iICsgZXh0cmFjdGVkVGV4dCA6IGV4dHJhY3RlZFRleHQ7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKrguYHguIHguJnguILguYnguK3guITguKfguLLguKHguYDguKPguLXguKLguJrguKPguYnguK3guKLguYHguKXguYnguKchIOC4hOC4uOC4k+C4quC4suC4oeC4suC4o+C4luC4leC4o+C4p+C4iOC4quC4reC4muC5geC4peC4sOC5geC4geC5ieC5hOC4guC5hOC4lOC5ieC4geC5iOC4reC4meC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQUkg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lit4LmI4Liy4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmE4LiU4LmJIik7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiT0NSIEVycm9yOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lit4LmI4Liy4LiZ4Lij4Li54Lib4Lig4Liy4LieOiAiICsgZXJyb3IubWVzc2FnZSk7CiAgICB9IGZpbmFsbHkgewogICAgICAgIC8vIOC4hOC4t+C4meC4hOC5iOC4suC4m+C4uOC5iOC4oQogICAgICAgIHNjYW5CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBzY2FuQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLWNhbWVyYSI+PC9pPiDguKrguYHguIHguJnguILguYnguK3guITguKfguLLguKHguIjguLLguIHguKPguLnguJvguKDguLLguJ4nOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuLXRleHQtaW1hZ2UtaW5wdXQnKS52YWx1ZSA9ICcnOyAvLyDguKPguLXguYDguIvguYfguJUgaW5wdXQKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgYXBwID0gaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7CiAgICAgICAgZGIgPSBnZXRGaXJlc3RvcmUoYXBwKTsKICAgICAgICBhdXRoID0gZ2V0QXV0aChhcHApOwogICAgICAgIHNldHVwQXV0aExpc3RlbmVyKCk7CiAgICAgICAgc2V0dXBFdmVudExpc3RlbmVycygpOwogICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7IAogICAgICAgIHJlbmRlclRvcGljQ2hlY2tib3hlcygpOwogICAgICAgIAogICAgICAgIC8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5g+C4meC4leC4reC4meC4l+C5ieC4suC4ouC4guC4reC4hyB0cnkgYmxvY2sgXSAtLS0KICAgICAgICBzZXR1cFN0dWRlbnRQcm9ncmVzc0xpc3RlbmVycygpOwoJCXJlc3VtZUFjdGl2ZUdhbWVTZXNzaW9uKCk7CgkJbGlzdGVuRm9yRmlsZVNob3J0Y3V0cygpOwoJCWxpc3RlbkZvclBhcmFsbGVsVGVzdFNob3J0Y3V0cygpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmlyZWJhc2UgaW5pdGlhbGl6YXRpb24gZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmA4LiK4Li34LmI4Lit4Lih4LiV4LmI4Lit4LiB4Lix4Lia4LiQ4Liy4LiZ4LiC4LmJ4Lit4Lih4Li54Lil4LmE4LiU4LmJIik7CiAgICB9Cn0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlVmVyaWZ5QW5zd2Vyc0luRWRpdG9yKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICBmdW5jdGlvbiBkaXNwbGF5VmVyaWZpY2F0aW9uUmVzdWx0c0luRWRpdG9yKHJlc3VsdHMpIHsKICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvbkRpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5xdWVzdGlvbi1lZGl0b3ItaXRlbVtkYXRhLXEtaW5kZXg9IiR7cmVzLnF1ZXN0aW9uSW5kZXh9Il1gKTsKICAgICAgICAgICAgICAgIGlmICghcXVlc3Rpb25EaXYpIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgb2xkVmVyaWZpY2F0aW9uID0gcXVlc3Rpb25EaXYucXVlcnlTZWxlY3RvcignLnZlcmlmaWNhdGlvbi1yZXN1bHQtZWRpdG9yJyk7CiAgICAgICAgICAgICAgICBpZiAob2xkVmVyaWZpY2F0aW9uKSBvbGRWZXJpZmljYXRpb24ucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAgbGV0IHJlc3VsdEh0bWwgPSAnJzsKCiAgICAgICAgICAgICAgICAvLyDilrzilrzilrwgW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiV4Lij4Lij4LiB4Liw4Liq4Liz4LiE4Lix4LiNOiDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLIgQUkg4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4Liq4Lij4LmJ4Liy4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4Lir4Lih4LmI4Lir4Lij4Li34Lit4LmE4Lih4LmIIOKWvOKWvOKWvAogICAgICAgICAgICAgICAgaWYgKHJlcy5uZXdPcHRpb25zUGF5bG9hZCAmJiByZXMubmV3T3B0aW9uc1BheWxvYWQubmV3T3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld09wdGlvbnMgPSByZXMubmV3T3B0aW9uc1BheWxvYWQubmV3T3B0aW9uczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb3JyZWN0SW5kZXggPSByZXMubmV3T3B0aW9uc1BheWxvYWQubmV3Q29ycmVjdEluZGV4OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uRGl2LmRhdGFzZXQucVR5cGU7CgogICAgICAgICAgICAgICAgICAgIC8vIOC5g+C4iuC5ieC5hOC4lOC5ieC5gOC4ieC4nuC4suC4sOC4geC4seC4miBtdWx0aXBsZV9jaG9pY2UKICAgICAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJykgewogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMS4g4LiE4LmJ4LiZ4Lir4Liy4LiK4LmI4Lit4LiH4LiB4Lij4Lit4LiB4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4LiC4LmJ4Lit4LiZ4Lix4LmJ4LiZCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbklucHV0cyA9IHF1ZXN0aW9uRGl2LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9InRleHQiXScpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMi4g4Lin4LiZ4Lil4Li54Lib4LmA4LiC4Li14Lii4LiZ4LiX4Lix4Lia4LiE4LmI4LiyICh2YWx1ZSkg4LiC4Lit4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmA4LiU4Li04Lih4LiU4LmJ4Lin4Lii4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4Lir4Lih4LmI4LiI4Liy4LiBIEFJCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbklucHV0cy5mb3JFYWNoKChpbnB1dCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld09wdGlvbnNbaV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IG5ld09wdGlvbnNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC4meC4teC5ieC4meC5iOC4suC4iOC4sOC5hOC4oeC5iOC5gOC4geC4tOC4lCDguYHguJXguYjguYPguKrguYjguYTguKfguYnguIHguLHguJnguJ7guKXguLLguJQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9ICItLS0gKEFJIOC5hOC4oeC5iOC5hOC4lOC5ieC4quC4o+C5ieC4suC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC4meC4teC5iSkgLS0tIjsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gMy4g4LiE4LmJ4LiZ4Lir4Liy4Lib4Li44LmI4LihIFJhZGlvIOC4l+C4teC5iOC4leC4o+C4h+C4geC4seC4muC5gOC4ieC4peC4ouC5g+C4q+C4oeC5iCDguYHguKXguYnguKfguKrguLHguYjguIcgJ2NoZWNrZWQnCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvVG9TZWxlY3QgPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yKGBpbnB1dFt0eXBlPSJyYWRpbyJdW3ZhbHVlPSIke25ld0NvcnJlY3RJbmRleH0iXWApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmFkaW9Ub1NlbGVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9Ub1NlbGVjdC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gNC4g4LmB4Liq4LiU4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZ4Liq4Li14LmA4Lir4Lil4Li34Lit4LiHICjguKPguLjguJnguYHguKPguIfguIHguKfguYjguLIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb24tcmVzdWx0LWVkaXRvciBtdC0yIHAtMyBib3JkZXItbC00IGJvcmRlci15ZWxsb3ctNDAwIGJnLXllbGxvdy01MCB0ZXh0LXllbGxvdy04MDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciI+PGkgY2xhc3M9ImZhcyBmYS1tYWdpYy13YW5kLXNwYXJrbGVzIG1yLTIiPjwvaT5BSSDguJXguKPguKfguIjguYTguKHguYjguJ7guJrguITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIchPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPuC4o+C4sOC4muC4muC5hOC4lOC5ieC4quC4o+C5ieC4suC4h+C4iuC4uOC4lOC4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4q+C4oeC5iCDguYHguKXguLDguYHguIHguYnguYTguILguYDguInguKXguKLguYPguKvguYnguJbguLnguIHguJXguYnguK3guIfguK3guLHguJXguYLguJnguKHguLHguJXguLTguYHguKXguYnguKc8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gNS4g4LmE4Liu4LmE4Lil4LiX4LmM4LiB4Liy4Lij4LmM4LiU4LiE4Liz4LiW4Liy4Lih4LiZ4Lix4LmJ4LiZ4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4Liq4Li14LmA4Lir4Lil4Li34Lit4LiH4LiK4Lix4LmI4Lin4LiC4LiT4LiwCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGl2LmNsYXNzTGlzdC5hZGQoJ2JnLXllbGxvdy0yMDAnLCAndHJhbnNpdGlvbi1hbGwnLCAnZHVyYXRpb24tMzAwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EaXYuY2xhc3NMaXN0LnJlbW92ZSgnYmcteWVsbG93LTIwMCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9LCAyNTAwKTsgLy8g4LmB4Liq4LiU4LiH4LmE4Liu4LmE4Lil4LiX4LmMIDIuNSDguKfguLTguJnguLLguJfguLUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguJ7guLTguYjguKEgZWxzZSBpZiDguYDguJ7guLfguYjguK3guYPguKvguYnguJXguKPguKPguIHguLDguYDguJTguLTguKHguKLguLHguIfguJfguLPguIfguLLguJnguYTguJTguYkg4pa84pa84pa8CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFyZXMuaXNDb3JyZWN0ICYmIHJlcy5zdWdnZXN0ZWRBbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgICAvLyAo4LiV4Lij4Lij4LiB4Liw4LmA4LiU4Li04Lih4LiC4Lit4LiH4LiE4Li44LiTOiDguJbguYnguLLguYDguInguKXguKLguJzguLTguJQg4LmB4LiV4LmI4Lih4Li14LmA4LiJ4Lil4Lii4LmD4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4Lit4Li34LmI4LiZKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGF1dG9GaXhNZXNzYWdlID0gcmVzLnN1Z2dlc3RlZEFuc3dlciA/ICcgPHN0cm9uZyBjbGFzcz0idGV4dC1ncmVlbi02MDAiPijguYHguIHguYnguYTguILguK3guLHguJXguYLguJnguKHguLHguJXguLQpPC9zdHJvbmc+JyA6ICcnOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InZlcmlmaWNhdGlvbi1yZXN1bHQtZWRpdG9yIG10LTIgcC0zIGJvcmRlci1sLTQgYm9yZGVyLXJlZC00MDAgYmctcmVkLTUwIHRleHQtcmVkLTgwMCB0ZXh0LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIiPjxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgbXItMiI+PC9pPkFJIOC4leC4o+C4p+C4iOC4nuC4muC4p+C5iOC4suC5gOC4ieC4peC4ouC4reC4suC4iOC5hOC4oeC5iOC4luC4ueC4geC4leC5ieC4reC4hyR7YXV0b0ZpeE1lc3NhZ2V9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guYDguKvguJXguLjguJzguKU6PC9zdHJvbmc+ICR7cmVzLmp1c3RpZmljYXRpb259PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtyZXMuc3VnZ2VzdGVkQW5zd2VyID8gYDxwPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LmB4LiZ4Liw4LiZ4LizOjwvc3Ryb25nPiAke3Jlcy5zdWdnZXN0ZWRBbnN3ZXJ9PC9wPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAo4Liq4LmI4Lin4LiZIGF1dG8tZml4IOC4guC4reC4h+C4hOC4uOC4k+C5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbkRpdi5kYXRhc2V0LnFUeXBlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhpZ2hsaWdodEVsZW1lbnQgPSAoZWwpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFlbCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdiZy1ncmVlbi0yMDAnLCAndHJhbnNpdGlvbi1hbGwnLCAnZHVyYXRpb24tMzAwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyBlbC5jbGFzc0xpc3QucmVtb3ZlKCdiZy1ncmVlbi0yMDAnKTsgfSwgMjUwMCk7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsT3B0aW9uSW5wdXRzID0gQXJyYXkuZnJvbShxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFt0eXBlPSJ0ZXh0Il0nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1Z2dlc3RlZEluZGV4ID0gYWxsT3B0aW9uSW5wdXRzLmZpbmRJbmRleChvcHQgPT4gb3B0LnZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpID09PSByZXMuc3VnZ2VzdGVkQW5zd2VyLnRyaW0oKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Z2dlc3RlZEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaW9Ub1NlbGVjdCA9IHF1ZXN0aW9uRGl2LnF1ZXJ5U2VsZWN0b3IoYGlucHV0W3R5cGU9InJhZGlvIl1bdmFsdWU9IiR7c3VnZ2VzdGVkSW5kZXh9Il1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYWRpb1RvU2VsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaW9Ub1NlbGVjdC5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRFbGVtZW50KHJhZGlvVG9TZWxlY3QuY2xvc2VzdCgnZGl2JykpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlucHV0RmllbGQgPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yKCcuaWRlYWwtYW5zd2VyLWlucHV0LCAuY29ycmVjdC1yZXNwb25zZS1pbnB1dCcpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5wdXRGaWVsZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRGaWVsZC52YWx1ZSA9IHJlcy5zdWdnZXN0ZWRBbnN3ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRFbGVtZW50KGlucHV0RmllbGQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWdnZXN0ZWRWYWx1ZSA9IHJlcy5zdWdnZXN0ZWRBbnN3ZXIudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvVG9TZWxlY3QgPSBxdWVzdGlvbkRpdi5xdWVyeVNlbGVjdG9yKGBpbnB1dFt0eXBlPSJyYWRpbyJdW3ZhbHVlPSIke3N1Z2dlc3RlZFZhbHVlfSJdYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYWRpb1RvU2VsZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpb1RvU2VsZWN0LmNoZWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0RWxlbWVudChyYWRpb1RvU2VsZWN0LmNsb3Nlc3QoJ2RpdicpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgIC8vICjguJXguKPguKPguIHguLDguYDguJTguLTguKE6IOC4luC5ieC4suC4luC4ueC4geC4leC5ieC4reC4hykKICAgICAgICAgICAgICAgICAgICByZXN1bHRIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb24tcmVzdWx0LWVkaXRvciBtdC0yIHRleHQtc20gdGV4dC1ncmVlbi03MDAgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgbXItMiI+PC9pPiBBSSDguKLguLfguJnguKLguLHguJnguKfguYjguLLguYDguInguKXguKLguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIOKWsuKWsuKWsiBb4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiCXSDilrLilrLilrIKCiAgICAgICAgICAgICAgICBxdWVzdGlvbkRpdi5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIHJlc3VsdEh0bWwpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4leC4o+C4p+C4iOC4l+C4suC4meC5gOC4ieC4peC4ouC5gOC4quC4o+C5h+C4iOC4quC4tOC5ieC4mSEiKTsKICAgICAgICB9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVZlcmlmeUFuc3dlcnMoKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIC8qKgogICAgICAgICAqIOC5geC4quC4lOC4h+C4nOC4peC4peC4seC4nuC4mOC5jOC4geC4suC4o+C4leC4o+C4p+C4iOC4l+C4suC4meC4muC4mSBVSQogICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IHJlc3VsdHMgLSDguJzguKXguKXguLHguJ7guJjguYzguJfguLXguYjguYTguJTguYnguIjguLLguIEgQUkg4LiV4Lij4Lin4LiI4LiX4Liy4LiZCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVZlcmlmaWNhdGlvblJlc3VsdHMocmVzdWx0cykgewogICAgICAgICAgICByZXN1bHRzLmZvckVhY2gocmVzID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2RhdGEtcXVlc3Rpb24taW5kZXg9IiR7cmVzLnF1ZXN0aW9uSW5kZXh9Il1gKTsKICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvbkRpdikgewogICAgICAgICAgICAgICAgICAgIC8vIOC4peC4muC4nOC4peC4geC4suC4o+C4leC4o+C4p+C4iOC4l+C4suC4meC5gOC4geC5iOC4suC4reC4reC4geC4geC5iOC4reC4mSAo4LiW4LmJ4Liy4Lih4Li1KQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZlcmlmaWNhdGlvbiA9IHF1ZXN0aW9uRGl2LnF1ZXJ5U2VsZWN0b3IoJy52ZXJpZmljYXRpb24tcmVzdWx0Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFZlcmlmaWNhdGlvbikgb2xkVmVyaWZpY2F0aW9uLnJlbW92ZSgpOwoKICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0SHRtbCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChyZXMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb24tcmVzdWx0IG10LTIgdGV4dC1zbSB0ZXh0LWdyZWVuLTcwMCBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgbXItMiI+PC9pPiBBSSDguKLguLfguJnguKLguLHguJnguKfguYjguLLguYDguInguKXguKLguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdEh0bWwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2ZXJpZmljYXRpb24tcmVzdWx0IG10LTIgcC0zIGJvcmRlci1sLTQgYm9yZGVyLXJlZC00MDAgYmctcmVkLTUwIHRleHQtcmVkLTgwMCB0ZXh0LXNtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIj48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIG1yLTIiPjwvaT5BSSDguJXguKPguKfguIjguJ7guJrguKfguYjguLLguYDguInguKXguKLguK3guLLguIjguYTguKHguYjguJbguLnguIHguJXguYnguK3guIc8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guYDguKvguJXguLjguJzguKU6PC9zdHJvbmc+ICR7cmVzLmp1c3RpZmljYXRpb259PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVzLnN1Z2dlc3RlZEFuc3dlciA/IGA8cD48c3Ryb25nPuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC5geC4meC4sOC4meC4szo8L3N0cm9uZz4gJHtyZXMuc3VnZ2VzdGVkQW5zd2VyfTwvcD5gIDogJyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25EaXYuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCByZXN1bHRIdG1sKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguJXguKPguKfguIjguJfguLLguJnguYDguInguKXguKLguYDguKrguKPguYfguIjguKrguLTguYnguJkhIik7CiAgICAgICAgfQoJCQoJCS8qKgogKiDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguYDguJvguKPguLXguKLguJrguYDguJfguLXguKLguJrguITguLPguJXguK3guJrguJfguLXguYjguYDguJvguYfguJnguJXguLHguKfguYDguKXguILguYLguJTguKLguYDguInguJ7guLLguLAKICogQHBhcmFtIHtzdHJpbmd9IHVzZXJBbnN3ZXIg4LiE4Liz4LiV4Lit4Lia4LiI4Liy4LiB4Lic4Li54LmJ4LmD4LiK4LmJCiAqIEBwYXJhbSB7c3RyaW5nfSBpZGVhbEFuc3dlciDguITguLPguJXguK3guJrguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICogQHJldHVybnMge2Jvb2xlYW59IOC4hOC4t+C4meC4hOC5iOC4siB0cnVlIOC4luC5ieC4suC4leC4seC4p+C5gOC4peC4guC5gOC4l+C4teC4ouC4muC5gOC4l+C5iOC4suC4geC4seC4mQogKi8KZnVuY3Rpb24gY29tcGFyZU51bWVyaWNhbEFuc3dlcnModXNlckFuc3dlciwgaWRlYWxBbnN3ZXIpIHsKICAgIC8vIOC5geC4m+C4peC4hyBjb21tYSDguYDguJvguYfguJkgcGVyaW9kIOC5geC4peC4sOC4leC4seC4lOC4leC4seC4p+C4reC4seC4geC4qeC4o+C4l+C4teC5iOC5hOC4oeC5iOC5g+C4iuC5iOC4leC4seC4p+C5gOC4peC4guC4reC4reC4gSAo4Lii4LiB4LmA4Lin4LmJ4LiZ4LiI4Li44LiU4LiX4Lio4LiZ4Li04Lii4Lih4LmB4Lil4Liw4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lir4Lih4Liy4Lii4Lil4LiaKQogICAgY29uc3QgY2xlYW5Vc2VyU3RyID0gU3RyaW5nKHVzZXJBbnN3ZXIpLnJlcGxhY2UoJywnLCAnLicpLnJlcGxhY2UoL1teXGQuLV0vZywgJycpLnRyaW0oKTsKICAgIGNvbnN0IGNsZWFuSWRlYWxTdHIgPSBTdHJpbmcoaWRlYWxBbnN3ZXIpLnJlcGxhY2UoJywnLCAnLicpLnJlcGxhY2UoL1teXGQuLV0vZywgJycpLnRyaW0oKTsKCiAgICAvLyDguJbguYnguLLguKrguJXguKPguLTguIfguKfguYjguLLguIfguYDguJvguKXguYjguLLguKvguKXguLHguIfguIjguLLguIHguIHguLLguKPguKXguYnguLLguIfguITguYjguLIg4LmD4Lir4LmJ4LiW4Li34Lit4Lin4LmI4Liy4LmE4Lih4LmI4LmD4LiK4LmI4LiV4Lix4Lin4LmA4Lil4LiCCiAgICBpZiAoY2xlYW5Vc2VyU3RyID09PSAnJyB8fCBjbGVhbklkZWFsU3RyID09PSAnJykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBjb25zdCB1c2VyTnVtID0gcGFyc2VGbG9hdChjbGVhblVzZXJTdHIpOwogICAgY29uc3QgaWRlYWxOdW0gPSBwYXJzZUZsb2F0KGNsZWFuSWRlYWxTdHIpOwoKICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4l+C4seC5ieC4h+C4quC4reC4h+C4hOC5iOC4suC5gOC4m+C5h+C4meC4leC4seC4p+C5gOC4peC4guC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgaWYgKGlzTmFOKHVzZXJOdW0pIHx8IGlzTmFOKGlkZWFsTnVtKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyDguYDguJvguKPguLXguKLguJrguYDguJfguLXguKLguJrguJXguLHguKfguYDguKXguILguYLguJTguKLguKLguK3guKHguKPguLHguJrguITguYjguLLguITguKXguLLguJTguYDguITguKXguLfguYjguK3guJnguYDguKXguYfguIHguJnguYnguK3guKIgKEVwc2lsb24pIOC4quC4s+C4q+C4o+C4seC4muC4l+C4qOC4meC4tOC4ouC4oQogICAgcmV0dXJuIE1hdGguYWJzKHVzZXJOdW0gLSBpZGVhbE51bSkgPCAwLjAwMTsKfQoKLyoqCiAqIFvguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYhdIEhlbHBlciDguKrguLPguKvguKPguLHguJrguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguILguYnguK3guITguKfguLLguKHguKHguLXguYHguJnguKfguYLguJnguYnguKHguYDguJvguYfguJnguJXguLHguKfguYDguKXguILguKvguKPguLfguK3guYTguKHguYgKICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBzdHIgLSDguILguYnguK3guITguKfguLLguKHguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguJXguKPguKfguIjguKrguK3guJoKICogQHJldHVybnMge2Jvb2xlYW59CiAqLwpmdW5jdGlvbiBpc1BvdGVudGlhbGx5TnVtZXJpYyhzdHIpIHsKICAgIGlmICh0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJyAmJiB0eXBlb2Ygc3RyICE9PSAnbnVtYmVyJykgcmV0dXJuIGZhbHNlOwogICAgLy8g4LmB4LiX4LiZ4LiX4Li14LmI4LiE4Lit4Lih4Lih4LmI4Liy4LiU4LmJ4Lin4Lii4LiI4Li44LiUIOC5geC4peC4sOC4peC4muC4iuC5iOC4reC4h+C4p+C5iOC4suC4hwogICAgY29uc3QgY2xlYW5lZFN0ciA9IFN0cmluZyhzdHIpLnJlcGxhY2UoJywnLCAnLicpLnRyaW0oKTsKICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5hOC4oeC5iOC5g+C4iuC5iOC4quC4leC4o+C4tOC4h+C4p+C5iOC4suC4hyDguYHguKXguLDguKrguLLguKHguLLguKPguJbguYHguJvguKXguIfguYDguJvguYfguJnguJXguLHguKfguYDguKXguILguJfguLXguYjguKrguKHguJrguLnguKPguJPguYzguYTguJTguYkKICAgIHJldHVybiBjbGVhbmVkU3RyICE9PSAnJyAmJiAhaXNOYU4ocGFyc2VGbG9hdChjbGVhbmVkU3RyKSkgJiYgaXNGaW5pdGUoY2xlYW5lZFN0cik7Cn0KCgphc3luYyBmdW5jdGlvbiBncmFkZVNob3J0QW5zd2VyKHVzZXJBbnN3ZXIsIHF1ZXN0aW9uRGF0YSkgewogICAgY29uc3QgaWRlYWxBbnN3ZXIgPSBxdWVzdGlvbkRhdGEuaWRlYWxBbnN3ZXI7CgogICAgLy8g4LiX4Liz4LiE4Lin4Liy4Lih4Liq4Liw4Lit4Liy4LiU4LiC4LmJ4Lit4Lih4Li54LilICjguJXguLHguJQgJCDguYHguKXguLDguIrguYjguK3guIfguKfguYjguLLguIfguKvguJnguYnguLLguKvguKXguLHguIcpCiAgICBjb25zdCBjbGVhblVzZXJTdHIgPSBTdHJpbmcodXNlckFuc3dlcikucmVwbGFjZSgvXCQvZywgJycpLnRyaW0oKTsKICAgIGNvbnN0IGNsZWFuSWRlYWxTdHIgPSBTdHJpbmcoaWRlYWxBbnN3ZXIpLnJlcGxhY2UoL1wkL2csICcnKS50cmltKCk7CgogICAgLy8gLS0tIOC4guC4seC5ieC4meC4l+C4teC5iCAxOiDguJXguKPguKfguIjguKrguK3guJrguYHguJrguJrguJXguKPguIfguJXguLHguKcgKEV4YWN0IE1hdGNoKSAtLS0KICAgIGlmIChjbGVhblVzZXJTdHIudG9Mb3dlckNhc2UoKSA9PT0gY2xlYW5JZGVhbFN0ci50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgLy8gLS0tIOC4guC4seC5ieC4meC4l+C4teC5iCAyOiDguJXguKPguKfguIjguKrguK3guJrguYDguIrguLTguIfguJXguLHguKfguYDguKXguIIgKE51bWVyaWMgQ2hlY2spIC0tLQogICAgaWYgKGlzUG90ZW50aWFsbHlOdW1lcmljKGNsZWFuVXNlclN0cikgJiYgaXNQb3RlbnRpYWxseU51bWVyaWMoY2xlYW5JZGVhbFN0cikpIHsKICAgICAgICBpZiAoY29tcGFyZU51bWVyaWNhbEFuc3dlcnMoY2xlYW5Vc2VyU3RyLCBjbGVhbklkZWFsU3RyKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIOC4guC4seC5ieC4meC4l+C4teC5iCAzOiAo4Lib4Li04LiU4LiB4Liy4Lij4LmD4LiK4LmJ4LiH4Liy4LiZIEFJKSAtLS0KICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC4leC4o+C4h+C4geC4seC4miAyIOC4guC5ieC4reC4muC4mSDguYPguKvguYnguJbguLfguK3guKfguYjguLIgIuC4nOC4tOC4lCIg4LiX4Lix4LiZ4LiX4Li1CiAgICBjb25zb2xlLmxvZygiRXhhY3QvTnVtZXJpYyBjaGVja3MgZmFpbGVkLiBBSSBncmFkaW5nIGlzIERJU0FCTEVELiIpOwogICAgcmV0dXJuIGZhbHNlOyAKfQoJCQphc3luYyBmdW5jdGlvbiByZXZlYWxBbnN3ZXJGb3JBZG1pbihpbmRleCwgdG90YWwpICB7IC8qIFJlbW92ZWQgKi8gfSAKCQkKLyoqCiAgICAgICAgICog4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4LitIExlYWRlcmJvYXJkIDUg4Lit4Lix4LiZ4LiU4Lix4Lia4LmB4Lij4LiBICjguKrguLPguKvguKPguLHguJogQWRtaW4pIC0g4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4Lit4Lix4Lib4LmA4LiU4LiVCiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IGdhbWVEYXRhIC0g4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiI4Liy4LiBIEZpcmVzdG9yZQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNob3dUb3A1TGVhZGVyYm9hcmRWaWV3KGdhbWVEYXRhKSB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllcnMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmZpbHRlcihwID0+IHAuc3RhdHVzID09PSAnYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwbGF5ZXJzLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTsKICAgICAgICAgICAgY29uc3QgdG9wNSA9IHBsYXllcnMuc2xpY2UoMCwgNSk7CgogICAgICAgICAgICBjb25zdCBsZWFkZXJib2FyZEhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBtYi02Ij7guJXguLLguKPguLLguIfguITguLDguYHguJnguJk8L2gyPgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBzcGFjZS15LTMiPgogICAgICAgICAgICAgICAgICAgICAgICAke3RvcDUubWFwKChwbGF5ZXIsIGluZGV4KSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ibGFjay8yMCBwLTMgcm91bmRlZC1sZyBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgdGV4dC14bCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQiPiR7aW5kZXggKyAxfS4gJHtwbGF5ZXIubmFtZSB8fCBPYmplY3Qua2V5cyhnYW1lRGF0YS5wbGF5ZXJzKS5maW5kKGtleSA9PiBnYW1lRGF0YS5wbGF5ZXJzW2tleV0gPT09IHBsYXllcil9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7cGxheWVyLnNjb3JlfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJnb3RvLW5leHQtcXVlc3Rpb24tYnRuIiBjbGFzcz0iYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwgbXQtOCI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7Z2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggKyAxID09PSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCA/ICfguKrguKPguLjguJvguJzguKXguKrguLjguJTguJfguYnguLLguKInIDogJ+C4guC5ieC4reC4leC5iOC4reC5hOC4myd9IDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gbGVhZGVyYm9hcmRIVE1MOwoKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dvdG8tbmV4dC1xdWVzdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvbGl2ZUdhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggKyAxOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobmV4dEluZGV4IDwgY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVEYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UXVlc3Rpb25JbmRleDogbmV4dEluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkRpc3BsYXllZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25TdGF0dXM6ICdhbnN3ZXJpbmcnCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhnYW1lRGF0YS5wbGF5ZXJzKS5mb3JFYWNoKHBsYXllck5hbWUgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVEYXRhW2BwbGF5ZXJzLiR7cGxheWVyTmFtZX0uYW5zd2VyZWRDdXJyZW50UXVlc3Rpb25gXSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB1cGRhdGVEYXRhKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAncG9kaXVtJyB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKLy8g4LmC4LiE4LmJ4LiU4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHICjguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQpCmZ1bmN0aW9uIHNldHVwQXV0aExpc3RlbmVyKCkgewogICAgb25BdXRoU3RhdGVDaGFuZ2VkKGF1dGgsIGFzeW5jICh1c2VyKSA9PiB7CiAgICAgICAgaWYgKHVzZXIpIHsKICAgICAgICAgICAgdXNlcklkID0gdXNlci51aWQ7CiAgICAgICAgICAgIHVzZXJJZERpc3BsYXkudGV4dENvbnRlbnQgPSB1c2VySWQ7CgogICAgICAgICAgICAvLyAtLS0gW+C4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4gl0gLS0tCiAgICAgICAgICAgIC8vIDEuIOC4reC5iOC4suC4meC4hOC5iOC4suC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4iOC4suC4gSBGaXJlc3RvcmUKICAgICAgICAgICAgY29uc3QgcHJlZnMgPSBhd2FpdCBsb2FkVXNlclByZWZlcmVuY2VzKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiDguJnguLPguITguYjguLLguJfguLXguYjguK3guYjguLLguJnguYTguJTguYnguKHguLLguJXguLHguYnguIfguITguYjguLLguYPguKvguYnguIHguLHguJogRHJvcGRvd24KICAgICAgICAgICAgaWYgKHByZWZzLnByb2plY3RTb3J0T3JkZXIpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXNvcnQtc2VsZWN0JykudmFsdWUgPSBwcmVmcy5wcm9qZWN0U29ydE9yZGVyOwogICAgICAgICAgICB9CgkJCQoJCQlnbG9iYWxEYXNoYm9hcmRTZXR0aW5ncy5wcm9qZWN0VmlldyA9IHByZWZzLnByb2plY3RWaWV3IHx8ICdncmlkJzsKCiAgICAgICAgICAgIC8vIDMuIOC5gOC4o+C4tOC5iOC4oeC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC5guC4m+C4o+C5gOC4iOC4hCAo4LiL4Li24LmI4LiH4LiI4Liw4LmD4LiK4LmJ4LiE4LmI4LiyIERyb3Bkb3duIOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4h+C4leC4seC5ieC4h+C5hOC4mykKICAgICAgICAgICAgaWYgKHVuc3Vic2NyaWJlUHJvamVjdHNMaXN0ZW5lcikgdW5zdWJzY3JpYmVQcm9qZWN0c0xpc3RlbmVyKCk7CiAgICAgICAgICAgIGxpc3RlbkZvclByb2plY3RzKCk7CiAgICAgICAgICAgIGxpc3RlbkZvclN0YXJyZWRRdWl6emVzKCk7CiAgICAgICAgICAgIGxpc3RlbkZvckN1c3RvbU1hdGhUb3BpY3MoKTsKCQkJbGlzdGVuRm9yQmx1ZXByaW50U2hvcnRjdXRzKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXdhaXQgYXV0aGVudGljYXRlVXNlcigpOwogICAgICAgIH0KICAgIH0pOwp9CgovKioKICog4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LiC4Lit4LiH4Lic4Li54LmJ4LmD4LiK4LmJ4Lil4LiH4LmD4LiZIEZpcmVzdG9yZQogKiBAcGFyYW0ge3N0cmluZ30ga2V5IC0g4LiK4Li34LmI4Lit4LiC4Lit4LiH4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIOC5gOC4iuC5iOC4mSAncHJvamVjdFNvcnRPcmRlcicKICogQHBhcmFtIHthbnl9IHZhbHVlIC0g4LiE4LmI4Liy4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBCiAqLwphc3luYyBmdW5jdGlvbiBzYXZlVXNlclByZWZlcmVuY2Uoa2V5LCB2YWx1ZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLyoqCiAqIOC4reC5iOC4suC4meC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4guC4reC4h+C4nOC4ueC5ieC5g+C4iuC5ieC4iOC4suC4gSBGaXJlc3RvcmUKICogQHJldHVybnMge1Byb21pc2U8b2JqZWN0Pn0gLSBQcm9taXNlIOC4l+C4teC5iOC4iOC4sOC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBvYmplY3Qg4LiC4Lit4LiH4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAqLwphc3luYyBmdW5jdGlvbiBsb2FkVXNlclByZWZlcmVuY2VzKCkgewogICAgaWYgKCF1c2VySWQpIHJldHVybiB7fTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJlZlJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS91c2Vycy8ke3VzZXJJZH0vcHJlZmVyZW5jZXMvbWFpbmApOwogICAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MocHJlZlJlZik7CiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgcmV0dXJuIGRvY1NuYXAuZGF0YSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4ge307IC8vIOC4hOC4t+C4meC4hOC5iOC4siBvYmplY3Qg4Lin4LmI4Liy4LiH4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4LmA4LiE4Lii4Lih4Li14LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgdXNlciBwcmVmZXJlbmNlczoiLCBlcnJvcik7CiAgICAgICAgcmV0dXJuIHt9OwogICAgfQp9CgovLyDilrzilrzilrwgQUREIFRIRVNFIE5FVyBGVU5DVElPTlMgVE8gWU9VUiBTQ1JJUFQg4pa84pa84pa8CgovKioKICogUGFyc2VzIGluZGVudGVkIHRleHQgaW50byB0aGUgYmx1ZXByaW50IEpTT04gc3RydWN0dXJlLgogKiBAcGFyYW0ge3N0cmluZ30gdGV4dCAtIFRoZSBpbmRlbnRlZCB0ZXh0IGZyb20gdGhlIHRleHRhcmVhLgogKiBAcmV0dXJucyB7b2JqZWN0fSAtIFRoZSBzdHJ1Y3R1cmVkIGN1cnJpY3VsdW0gZGF0YS4KICovCmZ1bmN0aW9uIHBhcnNlSW5kZW50ZWRCbHVlcHJpbnQodGV4dCkgewogICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpICE9PSAnJyk7CiAgICBjb25zdCBjdXJyaWN1bHVtID0gW107CiAgICBsZXQgY3VycmVudFNhcmEgPSBudWxsOwogICAgbGV0IGN1cnJlbnRNYWluVG9waWMgPSBudWxsOwoKICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7CiAgICAgICAgY29uc3QgaW5kZW50YXRpb24gPSBsaW5lLm1hdGNoKC9eXHMqLylbMF0ubGVuZ3RoOwogICAgICAgIGNvbnN0IGNvbnRlbnQgPSBsaW5lLnRyaW0oKTsKCiAgICAgICAgaWYgKGluZGVudGF0aW9uID09PSAwKSB7IC8vIFRoaXMgaXMgYSBTYXJhCiAgICAgICAgICAgIGN1cnJlbnRTYXJhID0gewogICAgICAgICAgICAgICAgc2FyYTogY29udGVudCwKICAgICAgICAgICAgICAgIG1haW5Ub3BpY3M6IFtdCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGN1cnJpY3VsdW0ucHVzaChjdXJyZW50U2FyYSk7CiAgICAgICAgICAgIGN1cnJlbnRNYWluVG9waWMgPSBudWxsOyAvLyBSZXNldCBtYWluIHRvcGljCiAgICAgICAgfSBlbHNlIGlmIChpbmRlbnRhdGlvbiA+IDAgJiYgaW5kZW50YXRpb24gPCA4ICYmIGN1cnJlbnRTYXJhKSB7IC8vIFRoaXMgaXMgYSBNYWluIFRvcGljIChlLmcuLCA0IHNwYWNlcykKICAgICAgICAgICAgY3VycmVudE1haW5Ub3BpYyA9IHsKICAgICAgICAgICAgICAgIHRvcGljTmFtZTogY29udGVudCwKICAgICAgICAgICAgICAgIHN1YlRvcGljczogW10KICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3VycmVudFNhcmEubWFpblRvcGljcy5wdXNoKGN1cnJlbnRNYWluVG9waWMpOwogICAgICAgIH0gZWxzZSBpZiAoaW5kZW50YXRpb24gPj0gOCAmJiBjdXJyZW50TWFpblRvcGljKSB7IC8vIFRoaXMgaXMgYSBTdWIgVG9waWMgKGUuZy4sIDggc3BhY2VzKQogICAgICAgICAgICBjdXJyZW50TWFpblRvcGljLnN1YlRvcGljcy5wdXNoKGNvbnRlbnQpOwogICAgICAgIH0KICAgIH0pOwoKICAgIHJldHVybiB7IGN1cnJpY3VsdW0gfTsKfQoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVNYW51YWxCbHVlcHJpbnRTYXZlIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWFudWFsQmx1ZXByaW50U2F2ZSgpIHsKICAgIGNvbnN0IHByb2plY3ROYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1icC1wcm9qZWN0LW5hbWUnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCBncmFkZUxldmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1icC1ncmFkZS1sZXZlbCcpLnZhbHVlLnRyaW0oKTsKICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWJwLWNvbnRlbnQnKS52YWx1ZTsKCiAgICBpZiAoIXByb2plY3ROYW1lIHx8ICFncmFkZUxldmVsIHx8ICFjb250ZW50KSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4geC4o+C4reC4geC4guC5ieC4reC4oeC4ueC4peC5g+C4q+C5ieC4hOC4o+C4muC4l+C4uOC4geC4iuC5iOC4reC4hyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBwYXJzZWREYXRhID0gcGFyc2VJbmRlbnRlZEJsdWVwcmludChjb250ZW50KTsKCiAgICBpZiAoIXBhcnNlZERhdGEuY3VycmljdWx1bSB8fCBwYXJzZWREYXRhLmN1cnJpY3VsdW0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4h+C4iOC4suC4geC4guC5ieC4reC4hOC4p+C4suC4oeC4l+C4teC5iOC4m+C5ieC4reC4meC5hOC4lOC5iSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCB0b3BpY3NNYXAgPSB7fTsKICAgIGxldCBvcmRlckluZGV4ID0gMDsgLy8gPDw8IFvguYDguJ7guLTguYjguKFdIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC4meC4seC4muC4peC4s+C4lOC4seC4mgoKICAgIC8vIOC4p+C4meC4peC4ueC4m+C5gOC4nuC4t+C5iOC4reC4quC4o+C5ieC4suC4h+C4guC5ieC4reC4oeC4ueC4peC4nuC4o+C5ieC4reC4oeC5gOC4nuC4tOC5iOC4oSBvcmRlcgogICAgcGFyc2VkRGF0YS5jdXJyaWN1bHVtLmZvckVhY2goc2FyYSA9PiB7CiAgICAgICAgc2FyYS5tYWluVG9waWNzLmZvckVhY2gobWFpblRvcGljID0+IHsKICAgICAgICAgICAgbWFpblRvcGljLnN1YlRvcGljcy5mb3JFYWNoKHN1YlRvcGljID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRvcGljSWQgPSAndG9waWNfJyArIERhdGUubm93KCkgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7CiAgICAgICAgICAgICAgICB0b3BpY3NNYXBbdG9waWNJZF0gPSB7CiAgICAgICAgICAgICAgICAgICAgc2FyYTogc2FyYS5zYXJhLAogICAgICAgICAgICAgICAgICAgIG1haW5Ub3BpYzogbWFpblRvcGljLnRvcGljTmFtZSwKICAgICAgICAgICAgICAgICAgICBzdWJUb3BpYzogc3ViVG9waWMsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAibm90X2dlbmVyYXRlZCIsCiAgICAgICAgICAgICAgICAgICAgbGVzc29uQ29udGVudDogbnVsbCwKICAgICAgICAgICAgICAgICAgICBvcmRlcjogb3JkZXJJbmRleCsrIC8vIDw8PCBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguJ7guLTguYjguKHguKXguLPguJTguLHguJrguYDguILguYnguLLguYTguJvguYPguJnguILguYnguK3guKHguLnguKUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfSk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9qZWN0c1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgKTsKICAgICAgICBhd2FpdCBhZGREb2MocHJvamVjdHNSZWYsIHsKICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLAogICAgICAgICAgICBncmFkZUxldmVsOiBncmFkZUxldmVsLAogICAgICAgICAgICB0b3BpY3M6IHRvcGljc01hcCwgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4Lih4Li1IG9yZGVyIOC5geC4peC5ieC4pwogICAgICAgICAgICBjcmVhdGVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpCiAgICAgICAgfSk7CiAgICAgICAgc2hvd01lc3NhZ2UoYOC4muC4seC4meC4l+C4tuC4geC5guC4m+C4o+C5gOC4iOC4hCAiJHtwcm9qZWN0TmFtZX0iIOC4quC4s+C5gOC4o+C5h+C4iCFgKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWJsdWVwcmludC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgbWFudWFsIGJsdWVwcmludCBwcm9qZWN0OiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4LmC4Lib4Lij4LmA4LiI4LiEIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGhhbmRsZUNsZWFyQWxsTGlua3NGb3JUb3BpYyh0b3BpY0lkKSB7CiAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgICLguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguYnguLLguIfguIHguLLguKPguYDguIrguLfguYjguK3guKHguYLguKLguIfguYHguJrguJrguJfguJTguKrguK3guJrguJfguLHguYnguIfguKvguKHguJTguYPguJnguITguKXguLHguIfguJnguLXguYk/ICjguJXguLHguKfguYHguJrguJrguJfguJTguKrguK3guJrguIjguKPguLTguIfguIjguLDguYTguKHguYjguJbguLnguIHguKXguJopIiwKICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgICAgICAvLyDguKrguLHguYjguIfguK3guLHguJvguYDguJTguJUgZmllbGQgbGlua2VkUXVpeklkcyDguYPguKvguYnguYDguJvguYfguJkgQXJyYXkg4Lin4LmI4Liy4LiHCiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICAgICAgICAgIFtgdG9waWNzLiR7dG9waWNJZH0ubGlua2VkUXVpeklkc2BdOiBbXSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4peC5ieC4suC4h+C4geC4suC4o+C5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgICAgICAgICAgb3BlblRvcGljUXVpekJhbmsodG9waWNJZCk7IC8vIOC4o+C4teC5gOC4n+C4o+C4iuC4q+C4meC5ieC4suC4leC5iOC4suC4h+C4hOC4peC4seC4hwogICAgICAgICAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOyAvLyDguKPguLXguYDguJ/guKPguIrguJvguYnguLLguKLguKrguJbguLLguJnguLDguJfguLXguYjguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGNsZWFyaW5nIGFsbCBsaW5rczoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4LmJ4Liy4LiH4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiHIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICApOwp9CgpmdW5jdGlvbiBzaG93UG9kaXVtVmlldyhwbGF5ZXJzLCBnYW1lTW9kZSA9ICdsaXZlLXJhY2UnLCBnYW1lRGF0YSA9IG51bGwpIHsKICAgIAogICAgY29uc3QgaXNNYXJrZXRNb2RlID0gZ2FtZURhdGE/LmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlOwoKICAgIC8vIOKWvOKWvOKWvCBb4LmB4LiB4LmJ4LmE4LiC4Lil4LmI4Liy4Liq4Li44LiUOiBFeGFtIE1vZGUg4LiV4Lix4LiU4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LmE4Lih4LmI4LiI4Liz4LmA4Lib4LmH4LiZ4Lit4Lit4LiBXSDilrzilrzilrwKICAgIGNvbnN0IHZhcmlhbnRDaGVjayA9IGdhbWVEYXRhPy5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICBpZiAodmFyaWFudENoZWNrID09PSAnZXhhbV9zdHJpY3QnKSB7CiAgICAgICAgY29uc3QgcGxheWVyc0FycmF5ID0gT2JqZWN0LnZhbHVlcyhwbGF5ZXJzIHx8IHt9KTsKICAgICAgICBjb25zdCB0b3RhbFF1ZXN0aW9ucyA9IGdhbWVEYXRhPy5zaHVmZmxlZFF1aXo/LnF1ZXN0aW9ucz8ubGVuZ3RoIHx8IDA7CiAgICAgICAgCiAgICAgICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiK4LmI4Lin4Lii4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiV4Lit4Lia4LiW4Li54LiBIChDaGVjayBBY2N1cmFjeSAxMDAlKQogICAgICAgIGNvbnN0IGdldENvcnJlY3RDb3VudCA9IChwbGF5ZXIpID0+IHsKICAgICAgICAgICAgaWYgKCFwbGF5ZXIuYW5zd2VycykgcmV0dXJuIDA7CiAgICAgICAgICAgIHJldHVybiBwbGF5ZXIuYW5zd2Vycy5maWx0ZXIoYSA9PiBhLmlzQ29ycmVjdCkubGVuZ3RoOwogICAgICAgIH07CgogICAgICAgIC8vIDEuIOC5geC4ouC4geC4geC4peC4uOC5iOC4oSAo4LmA4LiX4Li14Lii4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiW4Li54LiBIOC4geC4seC4miDguIjguLPguJnguKfguJnguILguYnguK3guJfguLHguYnguIfguKvguKHguJQpCiAgICAgICAgY29uc3QgcGVyZmVjdFNjb3JlcnMgPSBwbGF5ZXJzQXJyYXkuZmlsdGVyKHAgPT4gZ2V0Q29ycmVjdENvdW50KHApID09PSB0b3RhbFF1ZXN0aW9ucyk7CiAgICAgICAgY29uc3QgcmVtZWRpYWxTdHVkZW50cyA9IHBsYXllcnNBcnJheS5maWx0ZXIocCA9PiBnZXRDb3JyZWN0Q291bnQocCkgPCB0b3RhbFF1ZXN0aW9ucyk7CiAgICAgICAgCiAgICAgICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4LiE4LmI4Liy4LmA4LiJ4Lil4Li14LmI4Lii4Lir4LmJ4Lit4LiHCiAgICAgICAgY29uc3QgdG90YWxTdW0gPSBwbGF5ZXJzQXJyYXkucmVkdWNlKChzdW0sIHApID0+IHN1bSArIChwLnNjb3JlIHx8IDApLCAwKTsKICAgICAgICBjb25zdCBhdmdTY29yZSA9IHBsYXllcnNBcnJheS5sZW5ndGggPiAwID8gKHRvdGFsU3VtIC8gcGxheWVyc0FycmF5Lmxlbmd0aCkudG9GaXhlZCgyKSA6ICIwLjAwIjsKCiAgICAgICAgLy8gMy4g4Liq4Lij4LmJ4Liy4LiHIEhUTUwKICAgICAgICBjb25zdCBleGFtUmVzdWx0SFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbWluLWgtc2NyZWVuIHctZnVsbCBwLTggYmctZ3JheS05MDAgdGV4dC13aGl0ZSBhbmltYXRlLWZhZGUtaW4iPgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8aDEgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBtYi0yIHRleHQtdHJhbnNwYXJlbnQgYmctY2xpcC10ZXh0IGJnLWdyYWRpZW50LXRvLXIgZnJvbS1ibHVlLTQwMCB0by1wdXJwbGUtNTAwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZsYWctY2hlY2tlcmVkIG1yLTIgdGV4dC13aGl0ZSI+PC9pPiDguIjguJrguIHguLLguKPguKrguK3guJrguIjguKPguLTguIcKICAgICAgICAgICAgICAgIDwvaDE+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQteGwgdGV4dC1ibHVlLTMwMCBtYi04IGJnLWJsdWUtOTAwLzMwIHB4LTYgcHktMiByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci1ibHVlLTUwMC8zMCI+CiAgICAgICAgICAgICAgICAgICAg4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4Lii4LiC4Lit4LiH4Lir4LmJ4Lit4LiHOiA8c3BhbiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHRleHQtd2hpdGUgbWwtMiI+JHthdmdTY29yZX08L3NwYW4+IAogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtOCB3LWZ1bGwgbWF4LXctNXhsIj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmF5LTgwMCBib3JkZXIgYm9yZGVyLWdyZWVuLTUwMC81MCByb3VuZGVkLTJ4bCBwLTYgc2hhZG93LWxnIHNoYWRvdy1ncmVlbi05MDAvMjAgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIGdyb3VwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWJzb2x1dGUgdG9wLTAgcmlnaHQtMCBiZy1ncmVlbi01MDAvMjAgdy0yNCBoLTI0IHJvdW5kZWQtYmwtZnVsbCAtbXItNCAtbXQtNCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBncm91cC1ob3ZlcjpzY2FsZS0xMTAiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTQwMCBtYi00IGZsZXggaXRlbXMtY2VudGVyIHJlbGF0aXZlIHotMTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImJnLWdyZWVuLTUwMC8yMCBwLTIgcm91bmRlZC1sZyBtci0zIj48aSBjbGFzcz0iZmFzIGZhLXN0YXIiPjwvaT48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDguJnguLHguIHguYDguKPguLXguKLguJnguJfguLXguYjguYTguJTguYnguITguLDguYHguJnguJnguYDguJXguYfguKEgKCR7cGVyZmVjdFNjb3JlcnMubGVuZ3RofSkKICAgICAgICAgICAgICAgICAgICAgICAgPC9oMj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LXdyYXAgZ2FwLTIgbWF4LWgtNjAgb3ZlcmZsb3cteS1hdXRvIHByLTIgcmVsYXRpdmUgei0xMCBjdXN0b20tc2Nyb2xsYmFyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cGVyZmVjdFNjb3JlcnMubGVuZ3RoID4gMCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHBlcmZlY3RTY29yZXJzLm1hcChwID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JlZW4tOTAwLzQwIHRleHQtZ3JlZW4tMjAwIHB4LTMgcHktMS41IHJvdW5kZWQtbGcgdGV4dC1zbSBib3JkZXIgYm9yZGVyLWdyZWVuLTcwMCBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXVzZXItZ3JhZHVhdGUgbXItMiB0ZXh0LXhzIG9wYWNpdHktNzAiPjwvaT4gJHtwLm5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmApLmpvaW4oJycpIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJzxkaXYgY2xhc3M9InRleHQtZ3JheS01MDAgdy1mdWxsIHRleHQtY2VudGVyIHB5LTggaXRhbGljIj4tIOC5hOC4oeC5iOC4oeC4teC4nOC4ueC5ieC5hOC4lOC5ieC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oSAtPC9kaXY+J30KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWdyYXktODAwIGJvcmRlciBib3JkZXItcmVkLTUwMC81MCByb3VuZGVkLTJ4bCBwLTYgc2hhZG93LWxnIHNoYWRvdy1yZWQtOTAwLzIwIHJlbGF0aXZlIG92ZXJmbG93LWhpZGRlbiBncm91cCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFic29sdXRlIHRvcC0wIHJpZ2h0LTAgYmctcmVkLTUwMC8yMCB3LTI0IGgtMjQgcm91bmRlZC1ibC1mdWxsIC1tci00IC1tdC00IHRyYW5zaXRpb24tdHJhbnNmb3JtIGdyb3VwLWhvdmVyOnNjYWxlLTExMCI+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXJlZC00MDAgbWItNCBmbGV4IGl0ZW1zLWNlbnRlciByZWxhdGl2ZSB6LTEwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy1yZWQtNTAwLzIwIHAtMiByb3VuZGVkLWxnIG1yLTMiPjxpIGNsYXNzPSJmYXMgZmEtdG9vbHMiPjwvaT48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDguJXguYnguK3guIfguKrguK3guJrguIvguYjguK3guKEgKCR7cmVtZWRpYWxTdHVkZW50cy5sZW5ndGh9KQogICAgICAgICAgICAgICAgICAgICAgICA8L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LXdyYXAgZ2FwLTIgbWF4LWgtNjAgb3ZlcmZsb3cteS1hdXRvIHByLTIgcmVsYXRpdmUgei0xMCBjdXN0b20tc2Nyb2xsYmFyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVtZWRpYWxTdHVkZW50cy5sZW5ndGggPiAwIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gcmVtZWRpYWxTdHVkZW50cy5tYXAocCA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXJlZC05MDAvNDAgdGV4dC1yZWQtMjAwIHB4LTQgcHktMiByb3VuZGVkLWxnIHRleHQtc20gYm9yZGVyIGJvcmRlci1yZWQtNzAwIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctcmVkLTgwMC81MCB0cmFuc2l0aW9uLWNvbG9ycyBjdXJzb3ItZGVmYXVsdCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3AubmFtZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YCkuam9pbignJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICc8ZGl2IGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHctZnVsbCB0ZXh0LWNlbnRlciBweS04IGl0YWxpYyI+LSDguKLguLTguJnguJTguLXguJTguYnguKfguKIhIOC5hOC4oeC5iOC4oeC4teC5g+C4hOC4o+C4leC5ieC4reC4h+C4quC4reC4muC4i+C5iOC4reC4oSAtPC9kaXY+J30KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMTIiPgogICAgICAgICAgICAgICAgICAgICR7KHR5cGVvZiBjdXJyZW50TW9kZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY3VycmVudE1vZGUgPT09ICdhZG1pbicpIAogICAgICAgICAgICAgICAgICAgICAgICA/IGA8YnV0dG9uIGlkPSJleGFtLWNsb3NlLWJ0biIgY2xhc3M9ImJnLWdyYXktNzAwIGhvdmVyOmJnLXJlZC02MDAgdGV4dC13aGl0ZSBweS0zIHB4LTggcm91bmRlZC14bCBmb250LWJvbGQgdHJhbnNpdGlvbi1hbGwgc2hhZG93LWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBvd2VyLW9mZiI+PC9pPiDguIjguJrguYDguIHguKHguYHguKXguLDguIHguKXguLHguJrguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+YCAKICAgICAgICAgICAgICAgICAgICAgICAgOiBgPGJ1dHRvbiBpZD0ic3R1ZGVudC1leGFtLWJhY2stYnRuIiBjbGFzcz0iYmctYmx1ZS02MDAgaG92ZXI6YmctYmx1ZS03MDAgdGV4dC13aGl0ZSBweS0zIHB4LTggcm91bmRlZC14bCBmb250LWJvbGQgdHJhbnNpdGlvbi1hbGwgc2hhZG93LWxnIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWhvbWUiPjwvaT4g4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiBCiAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPmAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKCiAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGV4YW1SZXN1bHRIVE1MOwoKICAgICAgICAvLyA0LiDguKrguLHguYjguIcgVHJpZ2dlciDguKPguLDguJrguJrguIvguYjguK3guKEgJiDguJvguLjguYjguKHguIjguJrguYDguIHguKEKICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRNb2RlICE9PSAndW5kZWZpbmVkJyAmJiBjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4pa84pa84pa8IFvguYHguIHguYnguYTguII6IOC5gOC4nuC4tOC5iOC4oeC4leC4seC4p+C4peC5h+C4reC4hOC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4o+C4seC4meC4i+C5ieC4s10g4pa84pa84pa8CiAgICAgICAgICAgIC8vIOC5gOC4iuC5h+C4hOC4p+C5iOC4suC5gOC4hOC4ouC4quC4seC5iOC4h+C4quC4o+C5ieC4suC4h+C4guC4reC4h+C5gOC4geC4oeC4meC4teC5ieC5hOC4m+C5geC4peC5ieC4p+C4q+C4o+C4t+C4reC4ouC4seC4hyAo4LmD4LiK4LmJIGdsb2JhbCB2YXJpYWJsZSDguKvguKPguLfguK3guYDguIrguYfguITguIjguLLguIEgSUQpCiAgICAgICAgICAgIGlmIChyZW1lZGlhbFN0dWRlbnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4LiV4Lix4Lin4LmB4Lib4LijIEdsb2JhbCDguYTguKfguYnguYDguIrguYfguIQg4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LmD4Lir4LmJ4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmICiAgICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5wcm9jZXNzZWRSZW1lZGlhbEdhbWVzKSB3aW5kb3cucHJvY2Vzc2VkUmVtZWRpYWxHYW1lcyA9IG5ldyBTZXQoKTsKCiAgICAgICAgICAgICAgICAvLyDguJbguYnguLIgSUQg4LmA4LiB4Lih4LiZ4Li14LmJIOC5gOC4hOC4ouC4l+C4s+C5hOC4m+C5geC4peC5ieC4pyAtPiDguYPguKvguYnguILguYnguLLguKHguJfguLHguJnguJfguLUgKOC4q+C4ouC4uOC4lOC4geC4suC4o+C4l+C4s+C4h+C4suC4meC4i+C5ieC4sykKICAgICAgICAgICAgICAgIGlmICghd2luZG93LnByb2Nlc3NlZFJlbWVkaWFsR2FtZXMuaGFzKGN1cnJlbnRMaXZlR2FtZUlkKSkgewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIOC4quC4seC5iOC4h+C4peC5h+C4reC4hOC4l+C4seC4meC4l+C4tSEg4LmA4Lie4Li34LmI4Lit4LiB4Lix4LiZ4LmE4Lih4LmI4LmD4Lir4LmJ4Lij4Lit4Lia4LiX4Li14LmIIDIg4LmB4LiX4Lij4LiB4LmA4LiC4LmJ4Liy4Lih4LiyCiAgICAgICAgICAgICAgICAgICAgd2luZG93LnByb2Nlc3NlZFJlbWVkaWFsR2FtZXMuYWRkKGN1cnJlbnRMaXZlR2FtZUlkKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIuKame+4jyBUcmlnZ2VyaW5nIFJlbWVkaWFsIENyZWF0aW9uIChPbmUtdGltZSBvbmx5KS4uLiIpOwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDimpnvuI8g4Lij4Liw4Lia4Lia4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4Lid4Li24LiB4Lir4Lix4LiU4LiL4LmI4Lit4Lih4LmD4Lir4LmJICR7cmVtZWRpYWxTdHVkZW50cy5sZW5ndGh9IOC4hOC4mS4uLmAsICdpbmZvJyk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZVF1aXpEYXRhID0gewogICAgICAgICAgICAgICAgICAgICAgICAuLi5nYW1lRGF0YS5zaHVmZmxlZFF1aXosCiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBnYW1lRGF0YS5xdWl6SWQsIAogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nczogZ2FtZURhdGEuc2V0dGluZ3MgfHwge30KICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBzdHVkZW50IG9mIHJlbWVkaWFsU3R1ZGVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbGVkQW5zd2VycyA9IChzdHVkZW50LmFuc3dlcnMgfHwgW10pLm1hcChhbnMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uT2JqID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1thbnMucXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbEluZGV4OiBhbnMucXVlc3Rpb25JbmRleCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsUXVlc3Rpb25UZXh0OiBxdWVzdGlvbk9iaiA/IChxdWVzdGlvbk9iai5zdGVtIHx8IHF1ZXN0aW9uT2JqLnF1ZXN0aW9uVGV4dCkgOiAiIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXBhaXJJZCA9IGF3YWl0IGNyZWF0ZVJlbWVkaWFsUXVpekZvclN0dWRlbnQoc291cmNlUXVpekRhdGEsIGRldGFpbGVkQW5zd2Vycywgc3R1ZGVudC5uYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBhaXJJZCkgc3VjY2Vzc0NvdW50Kys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNzQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShg4pyFIOC4quC4o+C5ieC4suC4h+C4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oeC5gOC4quC4o+C5h+C4iOC4quC4tOC5ieC4mSAke3N1Y2Nlc3NDb3VudH0g4Lij4Liy4Lii4LiB4Liy4LijYCwgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCLimqDvuI8gUmVtZWRpYWwgY3JlYXRpb24gc2tpcHBlZCAoQWxyZWFkeSBwcm9jZXNzZWQgZm9yIHRoaXMgZ2FtZSkuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4YW0tY2xvc2UtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgbGV0IGdhbWVSZWY7CiAgICAgICAgICAgICAgICBpZiAoZ2FtZU1vZGUgPT09ICdzeW5jJykgewogICAgICAgICAgICAgICAgICAgIGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZURvYyhnYW1lUmVmKTsKICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1leGFtLWJhY2stYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsgCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm47IAogICAgfQoKICAgIC8vIDEuIOC5geC4m+C4peC4h+C4guC5ieC4reC4oeC4ueC4pSAo4LmA4Lie4Li04LmI4LihIGNvcnJlY3RTdHJlYWsg4LmA4LiC4LmJ4Liy4Lih4Liy4LiU4LmJ4Lin4LiiKQogICAgY29uc3QgcGxheWVyc0FycmF5ID0gT2JqZWN0LmVudHJpZXMocGxheWVycykubWFwKChbbmFtZSwgZGF0YV0pID0+ICh7CiAgICAgICAgbmFtZTogbmFtZSwKICAgICAgICByZWFsU2NvcmU6IGRhdGEucmVhbFNjb3JlIHx8IGRhdGEuc2NvcmUgfHwgMCwgCiAgICAgICAgdG90YWxQb2ludHM6IGRhdGEudG90YWxQb2ludHMgfHwgMCwKICAgICAgICBiYWRnZXM6IGRhdGEuYmFkZ2VzIHx8IFtdLAogICAgICAgIGhhc1BlcmZlY3RTY29yZUJvbnVzOiBkYXRhLmhhc1BlcmZlY3RTY29yZUJvbnVzIHx8IGZhbHNlLAogICAgICAgIGNvcnJlY3RTdHJlYWs6IGRhdGEuY29ycmVjdFN0cmVhayB8fCAwIC8vIFvguYDguJ7guLTguYjguKFdIOC4lOC4tuC4h+C4hOC5iOC4siBTdHJlYWsKICAgIH0pKTsKCiAgICAvLyAyLiDguITguLPguJnguKfguJPguITguYjguLLguKrguLnguIfguKrguLjguJQKICAgIGNvbnN0IG1heFBvaW50cyA9IE1hdGgubWF4KC4uLnBsYXllcnNBcnJheS5tYXAocCA9PiBwLnRvdGFsUG9pbnRzKSwgLUluZmluaXR5KTsKICAgIGNvbnN0IG1heFJhd1Njb3JlID0gTWF0aC5tYXgoLi4ucGxheWVyc0FycmF5Lm1hcChwID0+IHAucmVhbFNjb3JlKSwgLUluZmluaXR5KTsKCiAgICAvLyAzLiDguIjguLHguJTguYDguKPguLXguKLguIcgKFNvcnQpCiAgICBwbGF5ZXJzQXJyYXkuc29ydCgoYSwgYikgPT4gewogICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgY29uc3QgcG9pbnRzRGlmZiA9IGIudG90YWxQb2ludHMgLSBhLnRvdGFsUG9pbnRzOwogICAgICAgICAgICBpZiAocG9pbnRzRGlmZiAhPT0gMCkgcmV0dXJuIHBvaW50c0RpZmY7CiAgICAgICAgICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIucmVhbFNjb3JlIC0gYS5yZWFsU2NvcmU7CiAgICAgICAgICAgIGlmIChzY29yZURpZmYgIT09IDApIHJldHVybiBzY29yZURpZmY7CiAgICAgICAgICAgIHJldHVybiBhLm5hbWUubG9jYWxlQ29tcGFyZShiLm5hbWUsICd0aCcpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0RpZmYgPSBiLnRvdGFsUG9pbnRzIC0gYS50b3RhbFBvaW50czsKICAgICAgICAgICAgaWYgKHBvaW50c0RpZmYgIT09IDApIHJldHVybiBwb2ludHNEaWZmOwogICAgICAgICAgICBjb25zdCBzY29yZURpZmYgPSBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgICAgICBpZiAoc2NvcmVEaWZmICE9PSAwKSByZXR1cm4gc2NvcmVEaWZmOwogICAgICAgICAgICByZXR1cm4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lLCAndGgnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyA0LiDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJrguYHguJrguJogMSwgMSwgMSwgNAogICAgbGV0IGN1cnJlbnRSYW5rID0gMTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGxheWVyc0FycmF5Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgICAgIGNvbnN0IHByZXYgPSBwbGF5ZXJzQXJyYXlbaSAtIDFdOwogICAgICAgICAgICBjb25zdCBjdXJyID0gcGxheWVyc0FycmF5W2ldOwogICAgICAgICAgICBjb25zdCBpc1RpZWQgPSAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cykgJiYgKGN1cnIucmVhbFNjb3JlID09PSBwcmV2LnJlYWxTY29yZSk7CiAgICAgICAgICAgIGlmICghaXNUaWVkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UmFuayA9IGkgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHBsYXllcnNBcnJheVtpXS5kaXNwbGF5UmFuayA9IGN1cnJlbnRSYW5rOwogICAgfQoKICAgIGNvbnN0IHJlbmRlckJhZGdlcyA9IChiYWRnZXMpID0+IHsKICAgICAgICBpZiAoIWJhZGdlcyB8fCBiYWRnZXMubGVuZ3RoID09PSAwKSByZXR1cm4gJyc7CiAgICAgICAgY29uc3QgYmFkZ2VJY29ucyA9IHsgcXVpY2tfdGhpbmtlcjogJ+Kaoe+4jycsIG9uX2ZpcmU6ICfwn5SlJyB9OwogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciBnYXAtMiBteS0xIHRleHQtMnhsIj4ke2JhZGdlcy5tYXAoYiA9PiBiYWRnZUljb25zW2JdIHx8ICcnKS5qb2luKCcnKX08L2Rpdj5gOwogICAgfTsKICAgIAogICAgLy8gSGVscGVyOiDguKrguKPguYnguLLguIcgSFRNTCDguKrguLPguKvguKPguLHguJrguYHguKrguJTguIfguITguLDguYHguJnguJkgKyDguYTguK3guITguK3guJkgKyDguYTguJ8gKOC4quC4s+C4q+C4o+C4seC4muC5geC4l+C5iOC4mSAxLTItMykKICAgIGNvbnN0IHJlbmRlclNjb3JlSFRNTCA9IChwbGF5ZXIpID0+IHsKICAgICAgICBsZXQgYm9udXNJY29uID0gJyc7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBpZiAocGxheWVyLnRvdGFsUG9pbnRzID09PSBtYXhQb2ludHMgJiYgbWF4UG9pbnRzID4gMCkgYm9udXNJY29uICs9ICc8c3BhbiB0aXRsZT0i4LmA4LiI4LmJ4Liy4Lie4LmI4Lit4LiV4Lil4Liy4LiU4Lih4Li34LiUIj7wn5GRPC9zcGFuPiAnOwogICAgICAgICAgICBpZiAocGxheWVyLnJlYWxTY29yZSA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBib251c0ljb24gKz0gJzxzcGFuIHRpdGxlPSLguYDguJfguJ7guKfguLTguIrguLLguIHguLLguKMiPvCfjpM8L3NwYW4+ICc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHBsYXllci5oYXNQZXJmZWN0U2NvcmVCb251cykgYm9udXNJY29uID0gJzxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy0zMDAgbWwtMSI+KzEg4pyoPC9zcGFuPic7CiAgICAgICAgfQoKICAgICAgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguYHguKrguJTguIfguYTguJ8g8J+UpSDguJbguYnguLIgU3RyZWFrID49IDMKICAgICAgICBsZXQgZmlyZUh0bWwgPSAnJzsKICAgICAgICBpZiAocGxheWVyLmNvcnJlY3RTdHJlYWsgPj0gMykgewogICAgICAgICAgICBmaXJlSHRtbCA9IGAgPHNwYW4gY2xhc3M9InRleHQtb3JhbmdlLTQwMCBmb250LWJvbGQgYW5pbWF0ZS1wdWxzZSBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctc20iPvCflKUgeCR7cGxheWVyLmNvcnJlY3RTdHJlYWt9PC9zcGFuPmA7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0Rpc3BsYXkgPSBwbGF5ZXIudG90YWxQb2ludHMgPj0gMCAKICAgICAgICAgICAgICAgID8gYCgrJHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0pYCAKICAgICAgICAgICAgICAgIDogYCgke3BsYXllci50b3RhbFBvaW50cy50b0xvY2FsZVN0cmluZygpfSlgOwogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14bCI+JHtwbGF5ZXIucmVhbFNjb3JlfSDguITguLDguYHguJnguJkgJHtwb2ludHNEaXNwbGF5fTwvcD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0xIj4ke2JvbnVzSWNvbn0ke2ZpcmVIdG1sfTwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIj4ke3BsYXllci50b3RhbFBvaW50cy50b0xvY2FsZVN0cmluZygpfSDguITguLDguYHguJnguJk8L3A+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMSI+JHtib251c0ljb259JHtmaXJlSHRtbH08L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyBIZWxwZXI6IOC4quC4o+C5ieC4suC4hyBIVE1MIOC4quC4s+C4q+C4o+C4seC4muC5hOC4n+C5g+C4meC4o+C4suC4ouC4geC4suC4oyAi4Lit4Lix4LiZ4LiU4Lix4Lia4Lit4Li34LmI4LiZ4LmGIgogICAgY29uc3QgcmVuZGVyRmlyZUZvckxpc3QgPSAoc3RyZWFrKSA9PiB7CiAgICAgICAgIGlmIChzdHJlYWsgPj0gMykgcmV0dXJuIGA8c3BhbiBjbGFzcz0idGV4dC1vcmFuZ2UtNDAwIGZvbnQtYm9sZCBtbC0yIHRleHQtc20gYW5pbWF0ZS1wdWxzZSI+8J+UpSB4JHtzdHJlYWt9PC9zcGFuPmA7CiAgICAgICAgIHJldHVybiAnJzsKICAgIH07CgogICAgY29uc3Qgb3RoZXJQbGF5ZXJzID0gcGxheWVyc0FycmF5LnNsaWNlKDMpOwogICAgY29uc3Qgb3RoZXJQbGF5ZXJzSHRtbCA9IG90aGVyUGxheWVycy5sZW5ndGggPiAwID8gYAogICAgICAgIDxkaXYgY2xhc3M9Im10LTggdy1mdWxsIG1heC13LWxnIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIHRleHQtbGVmdCI+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItMyB0ZXh0LWNlbnRlciI+4Lit4Lix4LiZ4LiU4Lix4Lia4Lit4Li34LmI4LiZ4LmGPC9oMz4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS0yIHRleHQtbGciPgogICAgICAgICAgICAgICAgJHtvdGhlclBsYXllcnMubWFwKChwbGF5ZXIsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4LiV4Lij4Li14Lii4Lih4LmE4Lit4LiE4Lit4LiZ4Lij4Liy4LiH4Lin4Lix4LilCiAgICAgICAgICAgICAgICAgICAgbGV0IGJvbnVzSWNvbiA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci50b3RhbFBvaW50cyA9PT0gbWF4UG9pbnRzICYmIG1heFBvaW50cyA+IDApIGJvbnVzSWNvbiArPSAn8J+RkSAnOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnJlYWxTY29yZSA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBib251c0ljb24gKz0gJ/CfjpMgJzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4hOC4p+C4suC4oeC4hOC4sOC5geC4meC4mQogICAgICAgICAgICAgICAgICAgIGxldCBzY29yZVRleHQgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlVGV4dCA9IGAke3BsYXllci5yZWFsU2NvcmV9IOC4hOC4sOC5geC4meC4mSAoJHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0pYDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzY29yZVRleHQgPSBgJHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0g4LiE4Liw4LmB4LiZ4LiZYDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIGJnLWJsYWNrLzEwIGhvdmVyOmJnLWJsYWNrLzMwIHAtMiByb3VuZGVkLW1kIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTMwMCB3LTggaW5saW5lLWJsb2NrIj4ke3BsYXllci5kaXNwbGF5UmFua30uPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS11c2VyLWNpcmNsZSBtci0yIHRleHQtZ3JheS0zMDAiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPiR7cGxheWVyLm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtyZW5kZXJGaXJlRm9yTGlzdChwbGF5ZXIuY29ycmVjdFN0cmVhayl9IDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQtd2hpdGUgdGV4dC1iYXNlIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7c2NvcmVUZXh0fSAke2JvbnVzSWNvbn0KICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYH0pLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj5gIDogJyc7CgogICAgY29uc3QgcG9kaXVtSFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBtYi04Ij7guKrguKPguLjguJvguJzguKXguIHguLLguKPguYHguILguYjguIfguILguLHguJkhIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5IHRleHQteWVsbG93LTMwMCI+PC9pPjwvaDI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtZW5kIGp1c3RpZnktY2VudGVyIGdhcC00IHctZnVsbCBtYXgtdy0yeGwiPgogICAgICAgICAgICAgICAgJHtwbGF5ZXJzQXJyYXlbMV0gPyBgPGRpdiBjbGFzcz0icG9kaXVtLXN0ZXAgdGV4dC1jZW50ZXIgZmxleC0xIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSI+PGkgY2xhc3M9ImZhcyBmYS11c2VyLWNpcmNsZSB0ZXh0LTZ4bCBtYi0yIHRleHQtZ3JheS0zMDAiPjwvaT48cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtMnhsIHRydW5jYXRlIj4ke3BsYXllcnNBcnJheVsxXS5uYW1lfTwvcD4ke3JlbmRlclNjb3JlSFRNTChwbGF5ZXJzQXJyYXlbMV0pfTxkaXYgY2xhc3M9ImJnLWdyYXktNDAwIHRleHQtZ3JheS05MDAgZm9udC1ib2xkIHAtNCByb3VuZGVkLXQtbGcgbXQtMiBoLTMyIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtNXhsIHNoYWRvdy1sZyBib3JkZXItdC00IGJvcmRlci1ncmF5LTMwMCI+JHtwbGF5ZXJzQXJyYXlbMV0uZGlzcGxheVJhbmt9PC9kaXY+PC9kaXY+YCA6ICc8ZGl2IGNsYXNzPSJmbGV4LTEiPjwvZGl2Pid9CiAgICAgICAgICAgICAgICAke3BsYXllcnNBcnJheVswXSA/IGA8ZGl2IGNsYXNzPSJwb2RpdW0tc3RlcCB0ZXh0LWNlbnRlciBmbGV4LTEgdHJhbnNmb3JtIHRyYW5zaXRpb24gaG92ZXI6c2NhbGUtMTA1IHotMTAiPjxpIGNsYXNzPSJmYXMgZmEtY3Jvd24gdGV4dC02eGwgbWItMiB0ZXh0LXllbGxvdy00MDAgYW5pbWF0ZS1ib3VuY2UiPjwvaT48cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtM3hsIHRydW5jYXRlIj4ke3BsYXllcnNBcnJheVswXS5uYW1lfTwvcD4ke3JlbmRlclNjb3JlSFRNTChwbGF5ZXJzQXJyYXlbMF0pfTxkaXYgY2xhc3M9ImJnLXllbGxvdy01MDAgdGV4dC15ZWxsb3ctOTAwIGZvbnQtYm9sZCBwLTQgcm91bmRlZC10LWxnIG10LTIgaC00OCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LTZ4bCBzaGFkb3cteGwgYm9yZGVyLXQtNCBib3JkZXIteWVsbG93LTMwMCI+JHtwbGF5ZXJzQXJyYXlbMF0uZGlzcGxheVJhbmt9PC9kaXY+PC9kaXY+YCA6ICc8ZGl2IGNsYXNzPSJmbGV4LTEiPjwvZGl2Pid9CiAgICAgICAgICAgICAgICAke3BsYXllcnNBcnJheVsyXSA/IGA8ZGl2IGNsYXNzPSJwb2RpdW0tc3RlcCB0ZXh0LWNlbnRlciBmbGV4LTEgdHJhbnNmb3JtIHRyYW5zaXRpb24gaG92ZXI6c2NhbGUtMTA1Ij48aSBjbGFzcz0iZmFzIGZhLXVzZXItY2lyY2xlIHRleHQtNnhsIG1iLTIgdGV4dC1hbWJlci03MDAiPjwvaT48cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtMnhsIHRydW5jYXRlIj4ke3BsYXllcnNBcnJheVsyXS5uYW1lfTwvcD4ke3JlbmRlclNjb3JlSFRNTChwbGF5ZXJzQXJyYXlbMl0pfTxkaXYgY2xhc3M9ImJnLWFtYmVyLTcwMCB0ZXh0LWFtYmVyLTEwMCBmb250LWJvbGQgcC00IHJvdW5kZWQtdC1sZyBtdC0yIGgtMjQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC00eGwgc2hhZG93LWxnIGJvcmRlci10LTQgYm9yZGVyLWFtYmVyLTYwMCI+JHtwbGF5ZXJzQXJyYXlbMl0uZGlzcGxheVJhbmt9PC9kaXY+PC9kaXY+YCA6ICc8ZGl2IGNsYXNzPSJmbGV4LTEiPjwvZGl2Pid9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAke290aGVyUGxheWVyc0h0bWx9IAogICAgICAgICAgICAke2N1cnJlbnRNb2RlID09PSAnYWRtaW4nID8gYDxidXR0b24gaWQ9ImNsb3NlLWdhbWUtZmluYWwtYnRuIiBjbGFzcz0ibXQtOCBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMiBweC02IHJvdW5kZWQtbGcgaG92ZXI6YmctcmVkLTcwMCI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcy1jaXJjbGUgbXItMiI+PC9pPuC4iOC4muC5gOC4geC4oeC5geC4peC4sOC4geC4peC4seC4muC4q+C4meC5ieC4suC4q+C4peC4seC4gTwvYnV0dG9uPmAgOiBgPGJ1dHRvbiBpZD0ic3R1ZGVudC1iYWNrLXRvLWhvbWUtYnRuIiBjbGFzcz0ibXQtOCBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMiBweC02IHJvdW5kZWQtbGcgaG92ZXI6YmctcmVkLTcwMCI+PGkgY2xhc3M9ImZhcyBmYS10aW1lcy1jaXJjbGUgbXItMiI+PC9pPuC4iOC4muC5gOC4geC4oeC5geC4peC4sOC4geC4peC4seC4muC4q+C4meC5ieC4suC4q+C4peC4seC4gTwvYnV0dG9uPmB9CiAgICAgICAgPC9kaXY+YDsKICAgIAogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IHBvZGl1bUhUTUw7CgogICAgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4nKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWdhbWUtZmluYWwtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGxldCBnYW1lUmVmOwogICAgICAgICAgICBpZiAoZ2FtZU1vZGUgPT09ICdzeW5jJykgewogICAgICAgICAgICAgICAgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCBkZWxldGVEb2MoZ2FtZVJlZik7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWJhY2stdG8taG9tZS1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7IAogICAgICAgIH0pOwogICAgfQp9CgovKioKICog4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4Lit4LiB4Lij4Liy4Lif4Liq4Lij4Li44Lib4Lic4LilIChTeW5jIE1vZGUpIC0g4LmA4Lin4Lit4Lij4LmM4LiK4Lix4LiZ4Lij4Lit4LiH4Lij4Lix4LiaIEV4YW0gTW9kZQogKi8KZnVuY3Rpb24gcmVuZGVyU3luY1N1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbiwgaXNBZG1pbikgewogICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIC8vIFtMb2dpYyDguYDguJTguLTguKFdCiAgICBjb25zdCBpc0Fub255bW91cyA9ICgodmFyaWFudCA9PT0gJ2Fub255bW91cycgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJykgJiYgZ2FtZURhdGEuaXNBbm9ueW1vdXNSZXZlYWxlZCA9PT0gZmFsc2UpOwogICAgY29uc3QgaXNSZXZlYWxBdEVuZE1vZGUgPSAodmFyaWFudCA9PT0gJ3JldmVhbF9hdF9lbmQnIHx8IHZhcmlhbnQgPT09ICdhbm9ueW1vdXNfcmV2ZWFsX2VuZCcpOwoKICAgIC8vIFtMb2dpYyDguYPguKvguKHguYhdIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5gOC4m+C5h+C4meC5guC4q+C4oeC4lCBFeGFtIOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgY29uc3QgaXNFeGFtTW9kZSA9ICh2YXJpYW50ID09PSAnZXhhbV9zdHJpY3QnKTsKCiAgICBjb25zdCBxdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zOwogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgIAogICAgLy8g4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiC4LmA4LiU4Li04LihICsgbWF0Y2hpbmdfaXRlbQogICAgY29uc3QgaXNTaG9ydEFuc3dlclR5cGUgPSAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nKTsKCiAgICAvLyAtLS0gTG9naWMg4LiB4Lij4Liy4Lif4LmB4Liq4LiU4LiH4Lic4LilIC0tLQogICAgbGV0IGNoYXJ0SFRNTCA9ICcnOwogICAgCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIDEuIOC4geC4o+C4k+C4teC5gOC4m+C5h+C4meC5guC4q+C4oeC4lCBFeGFtIE1vZGUgKOC5guC4iuC4p+C5jOC5geC4hOC5iCDguJbguLnguIEgdnMg4Lic4Li04LiUIOC5gOC4quC4oeC4rSkKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgaWYgKGlzRXhhbU1vZGUpIHsKICAgICAgICBsZXQgY29ycmVjdENvdW50ID0gMDsKICAgICAgICBsZXQgaW5jb3JyZWN0Q291bnQgPSAwOwoKICAgICAgICAvLyDguJnguLHguJrguITguLDguYHguJnguJnguK3guKLguYjguLLguIfguYDguJTguLXguKLguKcg4LmE4Lih4LmI4LmA4LiB4LmH4Lia4LiK4Li34LmI4LitICjguYDguJ7guLfguYjguK3guITguKfguLLguKHguYDguJvguYfguJnguKrguYjguKfguJnguJXguLHguKfguJXguLLguKEgY29uY2VwdCBFeGFtKQogICAgICAgIE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmZvckVhY2goKFtuYW1lLCBkYXRhXSkgPT4gewogICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zd2VyT2JqID0gKGRhdGEuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgIT09ICdpbmFjdGl2ZScgJiYgY3VycmVudEFuc3dlck9iaikgewogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXJPYmouaXNDb3JyZWN0KSBjb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgIGVsc2UgaW5jb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBIVE1MIOC4geC4o+C4suC4nyBFeGFtIE1vZGUgKOC5gOC4o+C4teC4ouC4muC4h+C5iOC4suC4oiDguIrguLHguJTguYDguIjguJkpCiAgICAgICAgY2hhcnRIVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctMnhsIGZsZXgganVzdGlmeS1jZW50ZXIgaXRlbXMtZW5kIGdhcC0xMiBteS04IGFuaW1hdGUtZmFkZS1pbiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMyBmbGV4IGZsZXgtY29sIGp1c3RpZnktZW5kIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi0yIHRleHQtZ3JlZW4tMzAwIj4ke2NvcnJlY3RDb3VudH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIHJvdW5kZWQtdC1sZyBiZy1ncmVlbi01MDAgc2hhZG93LVswXzBfMTVweF9yZ2JhKDM0LDE5Nyw5NCwwLjUpXSBmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciByZWxhdGl2ZSB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi01MDAiIAogICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogMTUwcHg7Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jaGVjayB0ZXh0LTV4bCB0ZXh0LXdoaXRlIGRyb3Atc2hhZG93LW1kIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtdC0yIHRleHQtbGcgZm9udC1ib2xkIHRleHQtd2hpdGUiPuC4leC4reC4muC4luC4ueC4gTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMyBmbGV4IGZsZXgtY29sIGp1c3RpZnktZW5kIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi0yIHRleHQtcmVkLTMwMCI+JHtpbmNvcnJlY3RDb3VudH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIHJvdW5kZWQtdC1sZyBiZy1yZWQtNTAwIHNoYWRvdy1bMF8wXzE1cHhfcmdiYSgyMzksNjgsNjgsMC41KV0gZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgcmVsYXRpdmUgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tNTAwIiAKICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJoZWlnaHQ6IDE1MHB4OyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMgdGV4dC01eGwgdGV4dC13aGl0ZSBkcm9wLXNoYWRvdy1tZCI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXQtMiB0ZXh0LWxnIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIj7guJXguK3guJrguJzguLTguJQ8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS00MDAgdGV4dC1zbSBtdC00Ij4q4LmC4Lir4Lih4LiU4Liq4Lit4Lia4LiI4Lij4Li04LiHOiDguIvguYjguK3guJnguKPguLLguKLguIrguLfguYjguK3guJzguLnguYnguJXguK3guJrguYDguJ7guLfguYjguK3guKPguLHguIHguKnguLLguJrguKPguKPguKLguLLguIHguLLguKjguIHguLLguKPguKrguK3guJo8L2Rpdj4KICAgICAgICBgOwoKICAgIH0gCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIDIuIOC4geC4o+C4k+C4teC4m+C4geC4leC4tCAoU2hvcnQgQW5zd2VyIC8gTWF0Y2hpbmcpCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIGVsc2UgaWYgKGlzU2hvcnRBbnN3ZXJUeXBlKSB7CiAgICAgICAgbGV0IGNvcnJlY3RDb3VudCA9IDA7CiAgICAgICAgbGV0IGluY29ycmVjdENvdW50ID0gMDsKICAgICAgICBjb25zdCBjb3JyZWN0TmFtZXMgPSBbXTsKICAgICAgICBjb25zdCBpbmNvcnJlY3REZXRhaWxzID0gW107CgogICAgICAgIE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmZvckVhY2goKFtuYW1lLCBkYXRhXSkgPT4gewogICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zd2VyT2JqID0gKGRhdGEuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzICE9PSAnaW5hY3RpdmUnICYmIGN1cnJlbnRBbnN3ZXJPYmopIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFucyA9IGN1cnJlbnRBbnN3ZXJPYmouYW5zd2VyVGV4dDsgCiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5TmFtZSA9IGlzQW5vbnltb3VzID8gKGdhbWVEYXRhLnBsYXllck5pY2tuYW1lc1tuYW1lXSB8fCAnPz8/JykgOiBuYW1lOwoKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyT2JqLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgIGNvcnJlY3RDb3VudCsrOwogICAgICAgICAgICAgICAgICAgIGNvcnJlY3ROYW1lcy5wdXNoKGRpc3BsYXlOYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaW5jb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3REZXRhaWxzLnB1c2goYDxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy0yMDAgZm9udC1ib2xkIj4ke2Rpc3BsYXlOYW1lfTwvc3Bhbj46ICR7YW5zIHx8ICco4LmE4Lih4LmI4LiV4Lit4LiaKSd9YCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gKOC5g+C4iuC5iSBIVE1MIOC5gOC4lOC4tOC4oeC4guC4reC4h+C4hOC4uOC4kykKICAgICAgICBjaGFydEhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy0yeGwgZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1lbmQgZ2FwLTggbXktOCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTEvMyBmbGV4IGZsZXgtY29sIGp1c3RpZnktZW5kIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTEiPiR7Y29ycmVjdENvdW50fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWJhci1pdGVtIHctZnVsbCByb3VuZGVkLWxnIHRleHQtd2hpdGUgcC00IGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHJlbGF0aXZlIHNoYWRvdy1sZyBib3JkZXItMiBib3JkZXItZ3JlZW4tNDAwIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSIgc3R5bGU9Im1pbi1oZWlnaHQ6IDEyMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiAjMjJjNTVlOyIgZGF0YS10b29sdGlwLXRhcmdldD0idG9vbHRpcC1oaWRkZW4tY29ycmVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtNHhsIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHBvaW50ZXItZXZlbnRzLW5vbmUiPuC4leC4reC4muC4luC4ueC4gTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idG9vbHRpcC1oaWRkZW4tY29ycmVjdCIgY2xhc3M9ImxpdmUtc3VtbWFyeS10b29sdGlwIGFic29sdXRlIGJvdHRvbS1mdWxsIG1iLTIgdy1tYXggbWF4LXcteHMgYmctZ3JheS04MDAgdGV4dC13aGl0ZSB0ZXh0LXNtIHJvdW5kZWQtbGcgc2hhZG93LXhsIHAtMyB6LTIwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmcgY2xhc3M9ImJsb2NrIG1iLTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktNjAwIHBiLTEgdGV4dC1ncmVlbi00MDAiPuC4o+C4suC4ouC4iuC4t+C5iOC4reC4hOC4meC5gOC4geC5iOC4hzo8L3N0cm9uZz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1heC1oLTQwIG92ZXJmbG93LXktYXV0byI+JHtjb3JyZWN0TmFtZXMubGVuZ3RoID4gMCA/IGNvcnJlY3ROYW1lcy5qb2luKCcsICcpIDogJy0nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzMgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWVuZCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0xIj4ke2luY29ycmVjdENvdW50fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWJhci1pdGVtIHctZnVsbCByb3VuZGVkLWxnIHRleHQtd2hpdGUgcC00IGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHJlbGF0aXZlIHNoYWRvdy1sZyBib3JkZXItMiBib3JkZXItcmVkLTQwMCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUiIHN0eWxlPSJtaW4taGVpZ2h0OiAxMjBweDsgYmFja2dyb3VuZC1jb2xvcjogI2VmNDQ0NDsiIGRhdGEtdG9vbHRpcC10YXJnZXQ9InRvb2x0aXAtaGlkZGVuLWluY29ycmVjdCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtNHhsIG1iLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHBvaW50ZXItZXZlbnRzLW5vbmUiPuC4leC4reC4muC4nOC4tOC4lDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idG9vbHRpcC1oaWRkZW4taW5jb3JyZWN0IiBjbGFzcz0ibGl2ZS1zdW1tYXJ5LXRvb2x0aXAgYWJzb2x1dGUgYm90dG9tLWZ1bGwgbWItMiB3LW1heCBtYXgtdy14cyBiZy1ncmF5LTgwMCB0ZXh0LXdoaXRlIHRleHQtc20gcm91bmRlZC1sZyBzaGFkb3cteGwgcC0zIHotMjAgdGV4dC1sZWZ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmcgY2xhc3M9ImJsb2NrIG1iLTIgYm9yZGVyLWIgYm9yZGVyLWdyYXktNjAwIHBiLTEgdGV4dC1yZWQtNDAwIj7guKPguLLguKLguKXguLDguYDguK3guLXguKLguJTguITguJnguJXguK3guJrguJzguLTguJQ6PC9zdHJvbmc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYXgtaC00OCBvdmVyZmxvdy15LWF1dG8gc3BhY2UteS0xIj4ke2luY29ycmVjdERldGFpbHMubGVuZ3RoID4gMCA/IGluY29ycmVjdERldGFpbHMuam9pbignPGJyPicpIDogJy0nfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSAKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gMy4g4LiB4Lij4LiT4Li14Lib4LiB4LiV4Li0IChNdWx0aXBsZSBDaG9pY2UpCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIGVsc2UgewogICAgICAgIGxldCBvcHRpb25zID0gW107CiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgIG9wdGlvbnMgPSBbJ+C5g+C4iuC5iCAvIOC4luC4ueC4gScsICfguYTguKHguYjguYPguIrguYggLyDguJzguLTguJQnXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcHRpb25zID0gcXVlc3Rpb24ub3B0aW9ucyB8fCBbXTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgYW5zd2VyQ291bnRzID0gbmV3IEFycmF5KG9wdGlvbnMubGVuZ3RoKS5maWxsKDApOwogICAgICAgIGNvbnN0IG5hbWVzQnlBbnN3ZXIgPSB7fTsKICAgICAgICBvcHRpb25zLmZvckVhY2goKG9wdCwgaW5kZXgpID0+IHsgbmFtZXNCeUFuc3dlcltpbmRleF0gPSBbXTsgfSk7CgogICAgICAgIE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmZvckVhY2goKFtuYW1lLCBkYXRhXSkgPT4gewogICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zd2VyT2JqID0gKGRhdGEuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgIT09ICdpbmFjdGl2ZScgJiYgY3VycmVudEFuc3dlck9iaiAmJiBjdXJyZW50QW5zd2VyT2JqLmFuc3dlciAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY29uc3QgYW5zd2VySW5kZXggPSBwYXJzZUludChjdXJyZW50QW5zd2VyT2JqLmFuc3dlcik7CiAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGFuc3dlckluZGV4KSAmJiBuYW1lc0J5QW5zd2VyW2Fuc3dlckluZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzcGxheU5hbWUgPSBpc0Fub255bW91cyA/IChnYW1lRGF0YS5wbGF5ZXJOaWNrbmFtZXNbbmFtZV0gfHwgJz8/PycpIDogbmFtZTsKICAgICAgICAgICAgICAgICAgICBuYW1lc0J5QW5zd2VyW2Fuc3dlckluZGV4XS5wdXNoKGRpc3BsYXlOYW1lKTsKICAgICAgICAgICAgICAgICAgICBhbnN3ZXJDb3VudHNbYW5zd2VySW5kZXhdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gKOC5g+C4iuC5iSBIVE1MIOC5gOC4lOC4tOC4oeC4guC4reC4h+C4hOC4uOC4kykKICAgICAgICBjaGFydEhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy0yeGwgZmxleCBqdXN0aWZ5LWFyb3VuZCBpdGVtcy1lbmQgZ2FwLTQgbXktOCI+CiAgICAgICAgICAgICAgICAke2Fuc3dlckNvdW50cy5tYXAoKGNvdW50LCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gbmFtZXNCeUFuc3dlcltpbmRleF0ubGVuZ3RoID4gMCA/IG5hbWVzQnlBbnN3ZXJbaW5kZXhdLmpvaW4oJywgJykgOiAn4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXJDb2xvciA9ICcjNjM2NkYxJzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctMS80IGZsZXggZmxleC1jb2wganVzdGlmeS1lbmQgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTEiPiR7Y291bnR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdW1tYXJ5LWJhci1pdGVtIHctZnVsbCByb3VuZGVkLWxnIHRleHQtd2hpdGUgcC0yIGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGdhcC0xIGN1cnNvci1wb2ludGVyIHJlbGF0aXZlIiBzdHlsZT0ibWluLWhlaWdodDogNjBweDsgYmFja2dyb3VuZC1jb2xvcjogJHtiYXJDb2xvcn07IiBkYXRhLXRvb2x0aXAtdGFyZ2V0PSJ0b29sdGlwLSR7aW5kZXh9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIHNtOnRleHQtc20gZm9udC1zZW1pYm9sZCB0ZXh0LWNlbnRlciBwb2ludGVyLWV2ZW50cy1ub25lIj4ke29wdGlvbnNbaW5kZXhdfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRvb2x0aXAtJHtpbmRleH0iIGNsYXNzPSJsaXZlLXN1bW1hcnktdG9vbHRpcCBhYnNvbHV0ZSBib3R0b20tZnVsbCBtYi0yIHctbWF4IG1heC13LXhzIGJnLWdyYXktODAwIHRleHQtd2hpdGUgdGV4dC1zbSByb3VuZGVkLWxnIHNoYWRvdy1sZyBwLTMgei0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0iYmxvY2sgbWItMSBib3JkZXItYiBib3JkZXItZ3JheS02MDAgcGItMSI+4Lic4Li54LmJ4LiX4Li14LmI4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJOjwvc3Ryb25nPiR7dG9vbHRpcFRleHR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj5gOwogICAgfQoKICAgIC8vIC0tLSDguKrguYjguKfguJnguJvguLjguYjguKHguITguKfguJrguITguLjguKEgQWRtaW4gKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkgLS0tCiAgICBsZXQgYWN0aW9uQnV0dG9uc0hUTUwgPSAnJzsKICAgIGNvbnN0IGlzTGFzdFF1ZXN0aW9uID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDE7CgogICAgaWYgKGlzQWRtaW4pIHsKICAgICAgICBpZiAoaXNSZXZlYWxBdEVuZE1vZGUpIHsKICAgICAgICAgICAgaWYgKGlzTGFzdFF1ZXN0aW9uKSB7CiAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b25zSFRNTCA9IGA8YnV0dG9uIGlkPSJzaG93LWZpbmFsLXJlc3VsdHMtYnRuIiBjbGFzcz0iYmcteWVsbG93LTUwMCBob3ZlcjpiZy15ZWxsb3ctNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQtMnhsIj48aSBjbGFzcz0iZmFzIGZhLWNoYXJ0LWJhciI+PC9pPiDguYDguILguYnguLLguKrguLnguYjguIrguYjguKfguIfguYDguInguKXguKLguITguLPguJXguK3guJogKFJldmlldyk8L2J1dHRvbj5gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uc0hUTUwgPSBgPGJ1dHRvbiBpZD0ibmV4dC1zeW5jLXF1ZXN0aW9uLWJ0biIgY2xhc3M9ImJnLWdyYXktODAwIGhvdmVyOmJnLWJsYWNrIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQtMnhsIj7guILguYnguK3guJXguYjguK3guYTguJsgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCI+PC9pPjwvYnV0dG9uPmA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhY3Rpb25CdXR0b25zSFRNTCA9IGAKICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im9wZW4tc3luYy1zY3JhdGNocGFkLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzMwIGhvdmVyOmJnLXdoaXRlLzUwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCI+PC9pPiDguJfguJTguYDguKXguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InNob3ctcmVzdWx0cy1idG4iIGNsYXNzPSJiZy15ZWxsb3ctNTAwIGhvdmVyOmJnLXllbGxvdy02MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwiPjxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtYmFyIj48L2k+IOC5geC4quC4lOC4h+C4nOC4peC4peC4seC4nuC4mOC5jDwvYnV0dG9uPgogICAgICAgICAgICBgOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGlzUmV2ZWFsQXRFbmRNb2RlKSB7CiAgICAgICAgICAgICBhY3Rpb25CdXR0b25zSFRNTCA9IGA8cCBjbGFzcz0ibXQtOCB0ZXh0LWxnIHRleHQtaW5kaWdvLTIwMCI+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmE4Lib4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibLi4uPC9wPmA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbnNIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQtbGcgdGV4dC1pbmRpZ28tMjAwIj7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYHguKrguJTguIfguJzguKXguKXguLHguJ7guJjguYwuLi48L3A+YDsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgcGluRGlzcGxheUhUTUwgPSBpc0FkbWluID8gYDxkaXYgY2xhc3M9ImFic29sdXRlIHRvcC00IGxlZnQtNCBiZy1ibGFjay8zMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtc20iPlBJTjogPHN0cm9uZyBjbGFzcz0iZm9udC1ib2xkIj4ke2dhbWVEYXRhLnBpbn08L3N0cm9uZz48L2Rpdj5gIDogJyc7CgogICAgY29uc3Qgc3VtbWFyeUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcmVsYXRpdmUiPgogICAgICAgICR7cGluRGlzcGxheUhUTUx9IAogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWNlbnRlciI+JHtxdWVzdGlvbi5xdWVzdGlvblRleHQgfHwgcXVlc3Rpb24uc3RlbSB8fCAnJ308L2gyPgogICAgICAgICAgICAKICAgICAgICAgICAgJHtjaGFydEhUTUx9CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCBtdC00Ij4ke2FjdGlvbkJ1dHRvbnNIVE1MfTwvZGl2PgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIAogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IHN1bW1hcnlIVE1MOwogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKCk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXJzICjguITguIfguYDguJTguLTguKEg4LmB4LiV4LmI4LmA4Lie4Li04LmI4Lih4LiB4Liy4Lij4Lib4LmJ4Lit4LiH4LiB4Lix4LiZIEVycm9yIOC4geC4o+C4k+C4teC4m+C4uOC5iOC4oeC5hOC4oeC5iOC4oeC4tSkKICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctcmVzdWx0cy1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4pSBMZWFkZXJib2FyZCDguJXguLLguKHguJvguIHguJXguLQgKOC5geC4leC5iOC5g+C4meC4guC4seC5ieC4meC4leC4reC4meC4l+C4teC5iCAzIOC5gOC4o+C4suC4iOC4sOC5hOC4m+C5geC4geC5ieC4q+C4meC5ieC4siByZW5kZXJMZWFkZXJib2FyZCDguYPguKvguYnguIvguYjguK3guJnguIrguLfguYjguK3guK3guLXguIHguJfguLUpCiAgICAgICAgICAgIGNvbnN0IGxlYWRlcmJvYXJkRGF0YSA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSkubWFwKHAgPT4gKHsKICAgICAgICAgICAgICAgIG5hbWU6IHAubmFtZSwKICAgICAgICAgICAgICAgIHNjb3JlOiBwLnNjb3JlIHx8IDAsCiAgICAgICAgICAgICAgICB0b3RhbFBvaW50czogcC50b3RhbFBvaW50cyB8fCAwLAogICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiBwLnBvaW50c0xhc3RSb3VuZCB8fCAwLAogICAgICAgICAgICAgICAgYW5zd2VyczogcC5hbnN3ZXJzIHx8IFtdLAogICAgICAgICAgICAgICAgY29ycmVjdFN0cmVhazogcC5jb3JyZWN0U3RyZWFrIHx8IDAgCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAncmVzdWx0cycsIHB1YmxpY0xlYWRlcmJvYXJkOiBsZWFkZXJib2FyZERhdGEgfSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW4tc3luYy1zY3JhdGNocGFkLWJ0bicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIHF1ZXN0aW9uLm9wdGlvbnMgfHwgcXVlc3Rpb24uYWxsUmVzcG9uc2VzIHx8IFtdKTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQtc3luYy1xdWVzdGlvbi1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdxdWVzdGlvbicsIAogICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IG5leHRJbmRleCwgCiAgICAgICAgICAgICAgICBxdWVzdGlvbkRpc3BsYXllZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICAgICAgICAgIHNjb3Jlc0NhbGN1bGF0ZWQ6IGZhbHNlIAogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctZmluYWwtcmVzdWx0cy1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICBjb25zdCBsZWFkZXJib2FyZERhdGEgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLm1hcChwID0+ICh7CiAgICAgICAgICAgICAgICBuYW1lOiBwLm5hbWUsCiAgICAgICAgICAgICAgICBzY29yZTogcC5zY29yZSB8fCAwLAogICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IHAudG90YWxQb2ludHMgfHwgMCwKICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogcC5wb2ludHNMYXN0Um91bmQgfHwgMCwKICAgICAgICAgICAgICAgIGFuc3dlcnM6IHAuYW5zd2VycyB8fCBbXSwKICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IHAuY29ycmVjdFN0cmVhayB8fCAwIAogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgeyAKICAgICAgICAgICAgICAgIHN0YXR1czogJ3Jlc3VsdHMnLCAKICAgICAgICAgICAgICAgIHJldmlld1F1ZXN0aW9uSW5kZXg6IDAsIAogICAgICAgICAgICAgICAgcHVibGljTGVhZGVyYm9hcmQ6IGxlYWRlcmJvYXJkRGF0YQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyQW5vbnltb3VzU3R1ZGVudFJlc3VsdHNWaWV3KGdhbWVEYXRhKSB7CiAgICBjb25zdCBpc0xhc3RRdWVzdGlvbiA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoIC0gMTsKICAgIGxldCBtZXNzYWdlID0gJyc7CiAgICAKICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4quC4luC4suC4meC4sOC4geC4suC4o+C5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4rQogICAgaWYgKGdhbWVEYXRhLmlzQW5vbnltb3VzUmV2ZWFsZWQgPT09IHRydWUpIHsKICAgICAgICAvLyAo4LiB4Lij4LiT4Li1IEFkbWluIOC4geC4lOC5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4reC5geC4peC5ieC4pyAtIOC4i+C4tuC5iOC4h+C4iOC4sOC5gOC4geC4tOC4lOC5gOC4ieC4nuC4suC4sOC4guC5ieC4reC4quC4uOC4lOC4l+C5ieC4suC4oikKICAgICAgICBjb25zdCBteVBsYXllckRhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW2xvY2FsVGVhbVBsYXllcnNbMF1dOwogICAgICAgIGNvbnN0IG15UmVhbE5hbWUgPSBteVBsYXllckRhdGEubmFtZTsKICAgICAgICBjb25zdCBteVNjb3JlID0gbXlQbGF5ZXJEYXRhLnNjb3JlOwogICAgICAgIAogICAgICAgIG1lc3NhZ2UgPSBgCiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC13aGl0ZSBtdC00Ij4ke215UmVhbE5hbWV9ICjguJnguLHguYjguJnguITguLfguK3guITguLjguJMhKTwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCB0ZXh0LXllbGxvdy0zMDAgbXQtMiI+JHtteVNjb3JlfSDguITguLDguYHguJnguJk8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC04IHRleHQteGwgZm9udC1ib2xkIHRleHQteWVsbG93LTMwMCBhbmltYXRlLXB1bHNlIj7guYDguJXguKPguLXguKLguKHguJ7guJrguIHguLHguJrguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKIhPC9wPgogICAgICAgIGA7CiAgICB9IGVsc2UgewogICAgICAgIC8vICjguIHguKPguJPguLXguKLguLHguIfguYTguKHguYjguYDguJvguLTguJTguYDguJzguKLguIrguLfguYjguK0gLSDguJnguLXguYjguITguLfguK3guKvguJnguYnguLLguIjguK3guKvguKXguLHguIHguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguIjguLDguYDguKvguYfguJkpCiAgICAgICAgbWVzc2FnZSA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIj48L2Rpdj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbXQtNCI+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LmB4Lil4LmJ4LinITwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQteGwgdGV4dC1pbmRpZ28tMjAwIj4KICAgICAgICAgICAgICAgICR7aXNMYXN0UXVlc3Rpb24gPyAn4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmB4Liq4LiU4LiH4Lic4Lil4Liq4Lij4Li44Lib4Liq4Li44LiU4LiX4LmJ4Liy4LiiLi4uJyA6ICfguKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYTguJvguILguYnguK3guJXguYjguK3guYTguJsuLi4nfQogICAgICAgICAgICA8L3A+CiAgICAgICAgYDsKICAgIH0KCiAgICAvLyAyLiDguKrguKPguYnguLLguIcgSFRNTCDguJfguLXguYjguYDguKPguLXguKLguJrguIfguYjguLLguKIKICAgIGNvbnN0IHJlc3VsdHNIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAke21lc3NhZ2V9CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IHJlc3VsdHNIVE1MOwp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNob3dTdHVkZW50UmFua2luZ3MoKSB7CiAgICAvLyBJbnNlcnQgdGFibGUgaGVhZGVycyBmb3Igc3R1ZGVudCBsZWFkZXJib2FyZCB2aWV3cwogICAgY29uc3QgcXVpelRhYmxlSGVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtY29udGVudCB0aGVhZCcpOwogICAgaWYgKHF1aXpUYWJsZUhlYWQpIHsKICAgICAgcXVpelRhYmxlSGVhZC5pbm5lckhUTUwgPSBgCiAgICAgICAgPHRyPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgdy0xNiI+4Lit4Lix4LiZ4LiU4Lix4LiaPC90aD4KICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtbGVmdCI+4LiK4Li34LmI4Lit4Lic4Li54LmJ4LiX4LizPC90aD4KICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guITguLDguYHguJnguJk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4quC4luC4suC4meC4sCAo4Lic4LmI4Liy4LiZL+C5hOC4oeC5iOC4nOC5iOC4suC4mSk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4hOC4sOC5geC4meC4mSBQb2ludHM8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij7guYTguK3guITguK3guJnguKPguLLguIfguKfguLHguKU8L3RoPgogICAgICAgIDwvdHI+CiAgICAgIGA7CiAgICB9CiAgICBjb25zdCBwcm9qZWN0VGFibGVIZWFkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N0dWRlbnQtcHJvamVjdC1sZWFkZXJib2FyZC1jb250ZW50IHRoZWFkJyk7CiAgICBpZiAocHJvamVjdFRhYmxlSGVhZCkgewogICAgICBwcm9qZWN0VGFibGVIZWFkLmlubmVySFRNTCA9IGAKICAgICAgICA8dHI+CiAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB3LTE2Ij7guK3guLHguJnguJTguLHguJo8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij7guIrguLfguYjguK3guJzguLnguYnguYDguKXguYjguJk8L3RoPgogICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4hOC4sOC5geC4meC4meC4o+C4p+C4oSAoUG9pbnRzKTwvdGg+CiAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWxlZnQiPuC5hOC4reC4hOC4reC4meC4o+C4suC4h+C4p+C4seC4peC4l+C4teC5iOC5hOC4lOC5ieC4o+C4seC4mjwvdGg+CiAgICAgICAgPC90cj4KICAgICAgYDsKICAgIH0KICAgIAogICAgICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXJhbmtpbmdzLW1vZGFsJyk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgICAgICAgICAgLy8gU2V0dXAgY2xvc2UgYnV0dG9uCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1zdHVkZW50LXJhbmtpbmdzLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAgICAgICAgIC8vIFNldHVwIHRhYnMKICAgICAgICAgICAgY29uc3QgcXVpelRhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtdGFiJyk7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3RUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9qZWN0LWxlYWRlcmJvYXJkLXRhYicpOwogICAgICAgICAgICBjb25zdCBxdWl6Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtY29udGVudCcpOwogICAgICAgICAgICBjb25zdCBwcm9qZWN0Q29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXByb2plY3QtbGVhZGVyYm9hcmQtY29udGVudCcpOwoKICAgICAgICAgICAgcXVpelRhYi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICAgICAgcXVpelRhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2plY3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBxdWl6Q29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHByb2plY3RDb250ZW50LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBwcm9qZWN0VGFiLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBwcm9qZWN0VGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgcXVpelRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHByb2plY3RDb250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgcXVpekNvbnRlbnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBGZXRjaCBhbmQgcmVuZGVyIGRhdGEKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIDEuIEZldGNoIGRhdGEgZm9yIFRISVMgcXVpeiBsZWFkZXJib2FyZAogICAgICAgICAgICAgICAgY29uc3Qgc3VibWlzc2lvbnNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtjdXJyZW50UXVpekRhdGEuaWR9L3N1Ym1pc3Npb25zYCk7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uc1NuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhzdWJtaXNzaW9uc1JlZik7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9ucyA9IHN1Ym1pc3Npb25zU25hcHNob3QuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgICAgICAgICAgcmVuZGVyUXVpekxlYWRlcmJvYXJkKHN1Ym1pc3Npb25zLCBjdXJyZW50UXVpekRhdGEsICdzdHVkZW50LXF1aXotbGVhZGVyYm9hcmQtdGFibGUtYm9keScpOwoKICAgICAgICAgICAgICAgIC8vIDIuIEZldGNoIGRhdGEgZm9yIHRoZSBPVkVSQUxMIHByb2plY3QgbGVhZGVyYm9hcmQKICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0cy8ke2N1cnJlbnRRdWl6RGF0YS5wcm9qZWN0SWR9L3N0dWRlbnRQcm9maWxlc2ApOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvZmlsZXNSZWYpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXMgPSBwcm9maWxlc1NuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuZGF0YSgpKTsKICAgICAgICAgICAgICAgIHJlbmRlckxlYWRlcmJvYXJkKHByb2ZpbGVzLCAnc3R1ZGVudC1wcm9qZWN0LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBmZXRjaGluZyBzdHVkZW50IHJhbmtpbmdzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguYLguKvguKXguJTguILguYnguK3guKHguLnguKXguK3guLHguJnguJTguLHguJrguYTguJTguYkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2F2ZVRvQmFuayhlKSAgeyAvKiBSZW1vdmVkICovIH0gCgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNlbGVjdFByb2plY3RBbmRHZW5lcmF0ZUJsdWVwcmludFF1aXog4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBzZWxlY3RQcm9qZWN0QW5kR2VuZXJhdGVCbHVlcHJpbnRRdWl6KHRvcGljTmFtZSwgbGVzc29uVGV4dCA9IG51bGwsIGJsdWVwcmludFRvcGljSWQgPSBudWxsLCBmb3JjZUFwcFN0eWxlID0gZmFsc2UpIHsKICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gdHJ1ZTsKCiAgICAvLyAtLS0gW1NUQVJUXSDguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICAvLyAxLiDguK3guYjguLLguJkgVVJMIOC4iOC4suC4gSBpbnB1dCBmaWVsZCDguYPguJnguKvguJnguYnguLIgQmx1ZXByaW50IE1hbmFnZXIKICAgIGNvbnN0IHJlZmVyZW5jZUZpbGVVcmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtcmVmZXJlbmNlLWZpbGUtdXJsJyk/LnZhbHVlLnRyaW0oKTsKICAgIGxldCBleHRyYVBhcnRzID0gbnVsbDsgLy8g4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZ4LmA4Lib4LmH4LiZIG51bGwKCiAgICAvLyAyLiDguJbguYnguLLguKHguLUgVVJMIOC5g+C4q+C5ieC4lOC4tuC4h+C5hOC4n+C4peC5jOC5geC4peC4sOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4oeC4ueC4peC4quC4s+C4q+C4o+C4seC4muC4quC5iOC4h+C5g+C4q+C5iSBBSQogICAgaWYgKHJlZmVyZW5jZUZpbGVVcmwpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LiU4Li24LiH4LmE4Lif4Lil4LmMIE8tTkVUIOC4reC5ieC4suC4h+C4reC4tOC4h+C4iOC4suC4geC4peC4tOC4h+C4geC5jC4uLiIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHJlZmVyZW5jZUZpbGUgPSBhd2FpdCBmZXRjaEZpbGVGcm9tVXJsKHJlZmVyZW5jZUZpbGVVcmwsICJyZWZlcmVuY2Vfb25ldC5wZGYiKTsKICAgICAgICAgICAgY29uc3QgcmVmQmFzZTY0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKHJlZmVyZW5jZUZpbGUpOwogICAgICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdC5zcGxpdCgnLCcpWzFdKTsKICAgICAgICAgICAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0OwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC5gOC4leC4o+C4teC4ouC4oeC4guC5ieC4reC4oeC4ueC4peC5hOC4n+C4peC5jOC5g+C4meC4o+C4ueC4m+C5geC4muC4muC4l+C4teC5iCBBUEkg4LiV4LmJ4Lit4LiH4LiB4Liy4LijCiAgICAgICAgICAgIGV4dHJhUGFydHMgPSBbeyBpbmxpbmVEYXRhOiB7IG1pbWVUeXBlOiByZWZlcmVuY2VGaWxlLnR5cGUsIGRhdGE6IHJlZkJhc2U2NCB9IH1dOwogICAgICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBwb3B1cCDguYDguKHguLfguYjguK3guYLguKvguKXguJTguYDguKrguKPguYfguIgKICAgICAgICB9IGNhdGNoIChmaWxlRXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQ291bGQgbm90IGZldGNoIHJlZmVyZW5jZSBmaWxlOiIsIGZpbGVFcnJvcik7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguJTguLbguIfguYTguJ/guKXguYzguK3guYnguLLguIfguK3guLTguIfguYTguJTguYkg4Lij4Liw4Lia4Lia4LiI4Liw4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiV4Liy4Lih4Lib4LiB4LiV4Li0Iik7CiAgICAgICAgfQogICAgfQogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSAtLS0KCiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsKICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LXByb2plY3Qtc2VsZWN0Jyk7CiAgICBjb25zdCBtb2RhbFRpdGxlID0gbW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CiAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1vdmUtcXVpei1idG4nKTsKCiAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC5geC4muC4muC4l+C4lOC4quC4reC4mic7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5geC4peC4sOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4hyc7CiAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsKCiAgICBpZiAoYWxsUHJvamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guKLguLHguIfguYTguKHguYjguKHguLXguYLguJvguKPguYDguIjguITguYPguKvguYnguYDguKXguLfguK3guIE8L29wdGlvbj4nOwogICAgfSBlbHNlIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKwogICAgICAgICAgICBhbGxQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICBjb25zdCBjb25maXJtSGFuZGxlciA9IGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3RJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgaWYgKCFzZWxlY3RlZFByb2plY3RJZCkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LiB4LmI4Lit4LiZIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGF3YWl0IGxvYWRQcm9qZWN0RGV0YWlscyhzZWxlY3RlZFByb2plY3RJZCk7CiAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CiAgICAgICAgCiAgICAgICAgLy8gMy4g4Liq4LmI4LiHIGV4dHJhUGFydHMg4LiX4Li14LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lif4Lil4LmM4LiV4LmI4Lit4LmE4Lib4Lii4Lix4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiW4Lix4LiU4LmE4LibCiAgICAgICAgaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljKHRvcGljTmFtZSwgbGVzc29uVGV4dCwgc2VsZWN0ZWRQcm9qZWN0SWQsIGJsdWVwcmludFRvcGljSWQsIGZvcmNlQXBwU3R5bGUsIGV4dHJhUGFydHMpOwogICAgICAgIAogICAgICAgIGNsZWFudXAoKTsKICAgIH07CiAgICAKICAgIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7CiAgICAgICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguYTguJvguYLguJvguKPguYDguIjguITguK3guLfguYjguJknOwogICAgICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4LiiJzsKICAgICAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybUhhbmRsZXIpOwogICAgICAgIGNhbmNlbEJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFudXApOwogICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtTW92ZVF1aXopOwogICAgfTsKICAgIAogICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1Nb3ZlUXVpeik7CiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybUhhbmRsZXIpOwogICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYW51cCk7Cn0KCmZ1bmN0aW9uIGxpc3RlbkZvclN0YXJyZWRRdWl6emVzKCkgewogICAgaWYgKCF1c2VySWQpIHJldHVybjsKICAgIGNvbnN0IHF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgKTsKICAgIGNvbnN0IHEgPSBxdWVyeShxdWl6emVzUmVmLCB3aGVyZSgiaXNTdGFycmVkIiwgIj09IiwgdHJ1ZSkpOwoKICAgIG9uU25hcHNob3QocSwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgLy8g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiV4Li04LiU4LiU4Liy4Lin4Lil4LiH4LmD4LiZ4LiV4Lix4Lin4LmB4Lib4LijIGdsb2JhbAogICAgICAgIHN0YXJyZWRRdWl6emVzID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSkpOwogICAgICAgIAogICAgICAgIC8vIC0tLSBbIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4leC4reC4meC4meC4teC5ieC4nOC4ueC5ieC5g+C4iuC5ieC4reC4ouC4ueC5iOC5g+C4meC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGlmIChjdXJyZW50UHJvamVjdElkID09PSAnc3RhcnJlZCcpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmD4LiK4LmIIOC5g+C4q+C5ieC4o+C4teC5gOC4n+C4o+C4iuC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lCAocmVuZGVyUXVpenplcykKICAgICAgICAgICAgcmVuZGVyUXVpenplcygpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC5hOC4lOC5ieC4reC4ouC4ueC5iOC5g+C4meC4q+C4meC5ieC4suC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C4lCAo4Lit4Lii4Li54LmI4LiX4Li14LmIIERhc2hib2FyZCkg4LmD4Lir4LmJ4Lij4Li14LmA4Lif4Lij4LiK4Lir4LiZ4LmJ4LiyIERhc2hib2FyZCAocmVuZGVyUHJvamVjdHMpCiAgICAgICAgICAgIHJlbmRlclByb2plY3RzKCk7CiAgICAgICAgfQoKICAgIH0sIChlcnJvcikgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxpc3RlbmluZyBmb3Igc3RhcnJlZCBxdWl6emVzOiIsIGVycm9yKTsKICAgIH0pOwp9CQkJCgkJCi8vIOKWvOKWvOKWvCBTVEFSVDog4Lin4Liy4LiH4LmC4LiE4LmJ4LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAoKLyoqCiAqIFtGaWxlIFNob3J0Y3V0c10g4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LiI4Liy4LiBIEZpcmVzdG9yZQogKi8KZnVuY3Rpb24gbGlzdGVuRm9yRmlsZVNob3J0Y3V0cygpIHsKICAgIGNvbnN0IHNob3J0Y3V0c1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImZpbGVTaG9ydGN1dHNDb25maWciKTsKCiAgICBvblNuYXBzaG90KHNob3J0Y3V0c1JlZiwgKGRvY1NuYXApID0+IHsKICAgICAgICBsZXQgc2hvcnRjdXRzID0gW107CiAgICAgICAgbGV0IHRhYnMgPSBbXTsKICAgICAgICBsZXQgb3JkZXIgPSB7fTsKCiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBzaG9ydGN1dHMgPSBkYXRhLnNob3J0Y3V0cyB8fCBbXTsKICAgICAgICAgICAgdGFicyA9IGRhdGEuZmlsZVNob3J0Y3V0VGFicyB8fCBbXTsgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4l+C5h+C4mgogICAgICAgICAgICBvcmRlciA9IGRhdGEuZmlsZVNob3J0Y3V0T3JkZXIgfHwge307ICAgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4iOC4seC4lOC5gOC4o+C4teC4ouC4hwogICAgICAgIH0KCiAgICAgICAgaWYgKCF0YWJzLmZpbmQodCA9PiB0LmlkID09PSAnYWxsJykpIHsKICAgICAgICAgICAgdGFicy51bnNoaWZ0KHsgaWQ6ICdhbGwnLCBuYW1lOiAn4LmE4Lif4Lil4LmM4LiX4Lix4LmJ4LiH4Lir4Lih4LiUJywgaXNEZWZhdWx0OiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdmaWxlLWRlZmF1bHQtMScpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdmaWxlLWRlZmF1bHQtMScsIG5hbWU6ICfguYTguJ/guKXguYzguKXguLHguJQgMScsIHVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzaG9ydGN1dHMuZmluZChzID0+IHMuaWQgPT09ICdmaWxlLWRlZmF1bHQtMicpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdmaWxlLWRlZmF1bHQtMicsIG5hbWU6ICfguYTguJ/guKXguYzguKXguLHguJQgMicsIHVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGZpbGVTaG9ydGN1dHMgPSBzaG9ydGN1dHM7CiAgICAgICAgZmlsZVNob3J0Y3V0VGFicyA9IHRhYnM7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXSDguK3guLHguJvguYDguJTguJXguJXguLHguKfguYHguJvguKMgR2xvYmFsCiAgICAgICAgZmlsZVNob3J0Y3V0T3JkZXIgPSBvcmRlcjsgLy8gPC0tIFvguYHguIHguYnguYTguIJdIOC4reC4seC4m+C5gOC4lOC4leC4leC4seC4p+C5geC4m+C4oyBHbG9iYWwKCiAgICAgICAgcmVuZGVyRmlsZVNob3J0Y3V0cygpOwoKICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkgewogICAgICAgICAgICByZW5kZXJBZGRpdGlvbmFsRmlsZVNob3J0Y3V0c01vZGFsKCk7IC8vIDwtLSBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguKfguLLguJQgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCBb4LmD4Lir4Lih4LmIXSDguYDguJ7guLTguYjguKHguIrguLjguJTguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKMgRmlsZSBTaG9ydGN1dCBUYWJzIOC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKCmFzeW5jIGZ1bmN0aW9uIHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKSB7CiAgICBjb25zdCBjb25maWdSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJmaWxlU2hvcnRjdXRzQ29uZmlnIik7CiAgICB0cnkgewogICAgICAgIGF3YWl0IHNldERvYyhjb25maWdSZWYsIHsgCiAgICAgICAgICAgIGZpbGVTaG9ydGN1dFRhYnM6IGZpbGVTaG9ydGN1dFRhYnMsCiAgICAgICAgICAgIGZpbGVTaG9ydGN1dE9yZGVyOiBmaWxlU2hvcnRjdXRPcmRlcgogICAgICAgIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgeyBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZmlsZSBzaG9ydGN1dCBjb25maWc6IiwgZXJyb3IpOyB9Cn0KCmZ1bmN0aW9uIHJlbmRlckFkZGl0aW9uYWxGaWxlU2hvcnRjdXRzTW9kYWwoKSB7CiAgICBjb25zdCBuYXZDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC10YWJzLW5hdicpOwogICAgY29uc3QgbGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGlmICghbmF2Q29udGFpbmVyIHx8ICFsaXN0Q29udGFpbmVyKSByZXR1cm47CgogICAgbmF2Q29udGFpbmVyLmlubmVySFRNTCA9IGZpbGVTaG9ydGN1dFRhYnMubWFwKHRhYiA9PiB7CiAgICAgICAgY29uc3QgaXNBY3RpdmUgPSB0YWIuaWQgPT09IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkOwogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0icmVsYXRpdmUgZ3JvdXAgZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS10YWItaWQ9IiR7dGFiLmlkfSIgY2xhc3M9ImZpbGUtc2hvcnRjdXQtdGFiLWJ0biB3aGl0ZXNwYWNlLW5vd3JhcCBweS0zIHB4LTIgYm9yZGVyLWItMiBmb250LW1lZGl1bSB0ZXh0LXNtICR7aXNBY3RpdmUgPyAnYm9yZGVyLWluZGlnby01MDAgdGV4dC1pbmRpZ28tNjAwJyA6ICdib3JkZXItdHJhbnNwYXJlbnQgdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWdyYXktNzAwIGhvdmVyOmJvcmRlci1ncmF5LTMwMCd9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRhYi1uYW1lLWRpc3BsYXkgcG9pbnRlci1ldmVudHMtbm9uZSI+JHt0YWIubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHt0YWIubmFtZX0iIGNsYXNzPSJ0YWItbmFtZS1pbnB1dCBoaWRkZW4gYmctdHJhbnNwYXJlbnQgYm9yZGVyLWItMiBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIHctMzIiPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICR7IXRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXRhYi1pZD0iJHt0YWIuaWR9IiBjbGFzcz0iZGVsZXRlLWZpbGUtc2hvcnRjdXQtdGFiLWJ0biBhYnNvbHV0ZSAtdG9wLTEgLXJpZ2h0LTEgdGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTcwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgY29uc3QgYWN0aXZlVGFiID0gZmlsZVNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gYWN0aXZlRmlsZVNob3J0Y3V0VGFiSWQpOwogICAgbGV0IHNob3J0Y3V0c1RvU2hvdyA9IGFjdGl2ZVRhYj8uaXNEZWZhdWx0ID8gWy4uLmZpbGVTaG9ydGN1dHNdIDogZmlsZVNob3J0Y3V0cy5maWx0ZXIocyA9PiAoYWN0aXZlVGFiPy5zaG9ydGN1dElkcyB8fCBbXSkuaW5jbHVkZXMocy5pZCkpOwogICAgCiAgICBjb25zdCBjdXJyZW50T3JkZXIgPSBmaWxlU2hvcnRjdXRPcmRlclthY3RpdmVGaWxlU2hvcnRjdXRUYWJJZF0gfHwgW107CiAgICBzaG9ydGN1dHNUb1Nob3cuc29ydCgoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGluZGV4QSA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGEuaWQpOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGIuaWQpOwogICAgICAgIHJldHVybiAoaW5kZXhBID09PSAtMSA/IEluZmluaXR5IDogaW5kZXhBKSAtIChpbmRleEIgPT09IC0xID8gSW5maW5pdHkgOiBpbmRleEIpOwogICAgfSk7CgogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzaG9ydGN1dHNUb1Nob3cubWFwKHNob3J0Y3V0ID0+IHsKICAgICAgICBjb25zdCBpY29uID0gc2hvcnRjdXQudXJsID8gJ/Cfk4QnIDogJ/CflJcnOwogICAgICAgIGNvbnN0IG90aGVyVGFicyA9IGZpbGVTaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gIXQuaXNEZWZhdWx0KTsKICAgICAgICBjb25zdCBtb3ZlRHJvcGRvd25IVE1MID0gYWN0aXZlVGFiLmlzRGVmYXVsdCAmJiBvdGhlclRhYnMubGVuZ3RoID4gMCA/IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgaW5saW5lLWJsb2NrIHRleHQtbGVmdCBncm91cC9kcm9wZG93bi1maWxlIj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1tZW51LWJ0biB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS03MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIj48aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLXYiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1kcm9wZG93biBvcmlnaW4tdG9wLXJpZ2h0IGFic29sdXRlIHJpZ2h0LTAgbXQtMiB3LTQ4IHJvdW5kZWQtbWQgc2hhZG93LWxnIGJnLXdoaXRlIHJpbmctMSByaW5nLWJsYWNrIHJpbmctb3BhY2l0eS01IGhpZGRlbiB6LTIwIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJweS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InB4LTQgcHQtMSBwYi0yIHRleHQteHMgdGV4dC1ncmF5LTQwMCI+4LmA4Lie4Li04LmI4Lih4LmE4Lib4Lii4Lix4LiH4LmB4LiX4LmH4LiaOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdGhlclRhYnMubWFwKHRhYiA9PiBgPGEgaHJlZj0iIyIgY2xhc3M9Im1vdmUtZmlsZS1zaG9ydGN1dC1pdGVtIGJsb2NrIHB4LTQgcHktMiB0ZXh0LXNtIHRleHQtZ3JheS03MDAgaG92ZXI6YmctZ3JheS0xMDAiIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkYXRhLXRhcmdldC10YWItaWQ9IiR7dGFiLmlkfSI+JHt0YWIubmFtZX08L2E+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YCA6ICcnOwoKICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9InNob3J0Y3V0LWxpc3QtaXRlbSBwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS01MCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkcmFnZ2FibGU9InRydWUiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtpY29ufSAke3Nob3J0Y3V0Lm5hbWV9PC9wPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLWJsdWUtMjAwIj7guYDguKXguLfguK3guIHguYPguIrguYk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuIGJnLXllbGxvdy0xMDAgdGV4dC15ZWxsb3ctNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmcteWVsbG93LTIwMCI+4LmB4LiB4LmJ4LmE4LiCPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICR7IXNob3J0Y3V0LmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLWhpZGRlbi1maWxlLXNob3J0Y3V0LWJ0biBiZy1yZWQtMTAwIHRleHQtcmVkLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXJlZC0yMDAiPuC4peC4mjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHshYWN0aXZlVGFiLmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0icmVtb3ZlLWZpbGUtc2hvcnRjdXQtZnJvbS10YWItYnRuIHRleHQtcmVkLTUwMCBtbC0yIiB0aXRsZT0i4LiZ4Liz4Lit4Lit4LiB4LiI4Liy4LiB4LmB4LiX4LmH4Lia4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPjwvYnV0dG9uPmAgOiAnJ30KICAgICAgICAgICAgICAgICAgICAgICAgJHttb3ZlRHJvcGRvd25IVE1MfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpIHx8ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5g+C4meC5geC4l+C5h+C4muC4meC4teC5iTwvcD4nOwogICAgCiAgICBzZXR1cEZpbGVTaG9ydGN1dE1vZGFsRXZlbnRMaXN0ZW5lcnMoKTsKfQoKZnVuY3Rpb24gc2V0dXBGaWxlU2hvcnRjdXRNb2RhbEV2ZW50TGlzdGVuZXJzKCkgewogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtc2hvcnRjdXQtdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4ub25jbGljayA9IGUgPT4geyBhY3RpdmVGaWxlU2hvcnRjdXRUYWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOyByZW5kZXJBZGRpdGlvbmFsRmlsZVNob3J0Y3V0c01vZGFsKCk7IH07CiAgICAgICAgYnRuLm9uZGJsY2xpY2sgPSBlID0+IHsKICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcignLnRhYi1uYW1lLWlucHV0Jyk7CiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCcudGFiLW5hbWUtZGlzcGxheScpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgaW5wdXQuZm9jdXMoKTsgaW5wdXQuc2VsZWN0KCk7CiAgICAgICAgfTsKICAgIH0pOwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI2ZpbGUtc2hvcnRjdXQtdGFicy1uYXYgLnRhYi1uYW1lLWlucHV0JykuZm9yRWFjaChpbnB1dCA9PiB7CiAgICAgICAgY29uc3Qgc2F2ZSA9ICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdGFiSWQgPSBpbnB1dC5jbG9zZXN0KCcuZmlsZS1zaG9ydGN1dC10YWItYnRuJykuZGF0YXNldC50YWJJZDsKICAgICAgICAgICAgY29uc3QgdGFiID0gZmlsZVNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFiSWQpOwogICAgICAgICAgICBpZih0YWIpIHsgdGFiLm5hbWUgPSBpbnB1dC52YWx1ZS50cmltKCkgfHwgdGFiLm5hbWU7IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsgfQogICAgICAgIH07CiAgICAgICAgaW5wdXQub25ibHVyID0gc2F2ZTsKICAgICAgICBpbnB1dC5vbmtleWRvd24gPSBlID0+IHsgaWYgKGUua2V5ID09PSAnRW50ZXInKSBpbnB1dC5ibHVyKCk7IH07CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxldGUtZmlsZS1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBjb25zdCB0YWJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYklkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oIuC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC5geC4l+C5h+C4muC4meC4teC5iT8iLCAoKSA9PiB7CiAgICAgICAgICAgIGZpbGVTaG9ydGN1dFRhYnMgPSBmaWxlU2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+IHQuaWQgIT09IHRhYklkKTsKICAgICAgICAgICAgZGVsZXRlIGZpbGVTaG9ydGN1dE9yZGVyW3RhYklkXTsKICAgICAgICAgICAgaWYgKGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID09PSB0YWJJZCkgYWN0aXZlRmlsZVNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKICAgICAgICAgICAgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOwogICAgICAgIH0pOwogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LWl0ZW0nKS5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5vbmNsaWNrID0gZSA9PiB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGNvbnN0IHsgc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0OwogICAgICAgIGNvbnN0IHRhYiA9IGZpbGVTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhcmdldFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5zaG9ydGN1dElkcy5pbmNsdWRlcyhzaG9ydGN1dElkKSkgeyB0YWIuc2hvcnRjdXRJZHMucHVzaChzaG9ydGN1dElkKTsgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOyB9CiAgICB9KTsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZW1vdmUtZmlsZS1zaG9ydGN1dC1mcm9tLXRhYi1idG4nKS5mb3JFYWNoKGJ0biA9PiBidG4ub25jbGljayA9IGUgPT4gewogICAgICAgIGNvbnN0IHNob3J0Y3V0SWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5zaG9ydGN1dElkOwogICAgICAgIGNvbnN0IHRhYiA9IGZpbGVTaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkKTsKICAgICAgICBpZih0YWIgJiYgIXRhYi5pc0RlZmF1bHQpIHsgdGFiLnNob3J0Y3V0SWRzID0gdGFiLnNob3J0Y3V0SWRzLmZpbHRlcihpZCA9PiBpZCAhPT0gc2hvcnRjdXRJZCk7IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsgfQogICAgfSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LW1lbnUtYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLm9uY2xpY2sgPSBlID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIGNvbnN0IGRyb3Bkb3duID0gZS5jdXJyZW50VGFyZ2V0Lm5leHRFbGVtZW50U2libGluZzsKICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1maWxlLXNob3J0Y3V0LWRyb3Bkb3duJykuZm9yRWFjaChkID0+IGQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgIGRyb3Bkb3duLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfSk7CiAgICBjb25zdCBsaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbGlzdCcpOwogICAgbGV0IGRyYWdnZWRJdGVtID0gbnVsbDsKICAgIGxpc3RDb250YWluZXIub25kcmFnc3RhcnQgPSBlID0+IHsKICAgICAgICBkcmFnZ2VkSXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKTsKICAgICAgICBpZihkcmFnZ2VkSXRlbSkgc2V0VGltZW91dCgoKSA9PiBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LTUwJyksIDApOwogICAgfTsKICAgIGxpc3RDb250YWluZXIub25kcmFnZW5kID0gKCkgPT4geyBpZihkcmFnZ2VkSXRlbSkgeyBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7IGRyYWdnZWRJdGVtID0gbnVsbDsgfX07CiAgICBsaXN0Q29udGFpbmVyLm9uZHJhZ292ZXIgPSBlID0+IHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9OwogICAgbGlzdENvbnRhaW5lci5vbmRyb3AgPSBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IGFmdGVyRWxlbWVudCA9IFsuLi5saXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaG9ydGN1dC1saXN0LWl0ZW06bm90KC5vcGFjaXR5LTUwKScpXS5yZWR1Y2UoKGNsb3Nlc3QsIGNoaWxkKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBjaGlsZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGUuY2xpZW50WSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjsKICAgICAgICAgICAgICAgIHJldHVybiAob2Zmc2V0IDwgMCAmJiBvZmZzZXQgPiBjbG9zZXN0Lm9mZnNldCkgPyB7IG9mZnNldDogb2Zmc2V0LCBlbGVtZW50OiBjaGlsZCB9IDogY2xvc2VzdDsKICAgICAgICAgICAgfSwgeyBvZmZzZXQ6IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSB9KS5lbGVtZW50OwogICAgICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHsgbGlzdENvbnRhaW5lci5hcHBlbmRDaGlsZChkcmFnZ2VkSXRlbSk7IH0gCiAgICAgICAgICAgIGVsc2UgeyBsaXN0Q29udGFpbmVyLmluc2VydEJlZm9yZShkcmFnZ2VkSXRlbSwgYWZ0ZXJFbGVtZW50KTsgfQogICAgICAgICAgICBjb25zdCBuZXdPcmRlciA9IFsuLi5saXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKV0ubWFwKGl0ZW0gPT4gaXRlbS5kYXRhc2V0LnNob3J0Y3V0SWQpOwogICAgICAgICAgICBmaWxlU2hvcnRjdXRPcmRlclthY3RpdmVGaWxlU2hvcnRjdXRUYWJJZF0gPSBuZXdPcmRlcjsKICAgICAgICAgICAgc2F2ZUZpbGVTaG9ydGN1dENvbmZpZygpOwogICAgICAgIH0KICAgIH07Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFkZEZpbGVTaG9ydGN1dFRhYigpIHsKICAgIGNvbnN0IG5hbWUgPSBwcm9tcHQoIuC4geC4o+C4uOC4k+C4suC4leC4seC5ieC4h+C4iuC4t+C5iOC4reC5geC4l+C5h+C4muC5g+C4q+C4oeC5iDoiLCAi4LmB4LiX4LmH4Lia4LmD4Lir4Lih4LmIIik7CiAgICBpZiAobmFtZSAmJiBuYW1lLnRyaW0oKSkgewogICAgICAgIGZpbGVTaG9ydGN1dFRhYnMucHVzaCh7IGlkOiBgdGFiXyR7RGF0ZS5ub3coKX1gLCBuYW1lOiBuYW1lLnRyaW0oKSwgc2hvcnRjdXRJZHM6IFtdIH0pOwogICAgICAgIGF3YWl0IHNhdmVGaWxlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gcmVuZGVyRmlsZVNob3J0Y3V0cygpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWNvbnRhaW5lcicpOwogICAgY29uc3QgYWRkaXRpb25hbExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1saXN0Jyk7CiAgICBjb25zdCBsb2FkaW5nTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtc2hvcnRjdXRzLWxvYWRpbmctbXNnJyk7CgogICAgaWYgKGxvYWRpbmdNc2cpIGxvYWRpbmdNc2cuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBpZiAoIWNvbnRhaW5lciB8fCAhYWRkaXRpb25hbExpc3QpIHJldHVybjsKCiAgICBjb25zdCB2aXNpYmxlU2hvcnRjdXRzID0gZmlsZVNob3J0Y3V0cy5zbGljZSgwLCA0KTsKICAgIGNvbnN0IGhpZGRlblNob3J0Y3V0cyA9IGZpbGVTaG9ydGN1dHMuc2xpY2UoNCk7CgogICAgY29udGFpbmVyLmlubmVySFRNTCA9IHZpc2libGVTaG9ydGN1dHMubWFwKHNob3J0Y3V0ID0+IHsKICAgICAgICBjb25zdCBoYXNVcmwgPSBzaG9ydGN1dC51cmwgJiYgc2hvcnRjdXQudXJsLnRyaW0oKSAhPT0gJyc7CiAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lib4Li44LmI4Lih4LiZ4Li14LmJ4LiE4Li34Lit4Lib4Li44LmI4Lih4LiX4Li14LmIICLguJbguLnguIHguYDguKXguLfguK3guIEiIOC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGNvbnN0IGlzQWN0aXZlID0gc2VsZWN0ZWRGaWxlICYmIHNlbGVjdGVkRmlsZS5zaG9ydGN1dElkID09PSBzaG9ydGN1dC5pZDsKCiAgICAgICAgbGV0IGJnQ29sb3JDbGFzcyA9ICdiZy1ncmF5LTIwMCBob3ZlcjpiZy1ncmF5LTMwMCB0ZXh0LWdyYXktNzAwJzsKICAgICAgICBsZXQgaWNvbiA9ICfwn5SXJzsKCiAgICAgICAgaWYgKGlzQWN0aXZlKSB7CiAgICAgICAgICAgIC8vIOC4quC4luC4suC4meC4sDog4Lie4Lij4LmJ4Lit4Lih4LmD4LiK4LmJ4LiH4Liy4LiZICjguKrguLXguYDguILguLXguKLguKcsIOC4oeC4teC5gOC4hOC4o+C4t+C5iOC4reC4h+C4q+C4oeC4suC4ouC4leC4tOC5iuC4geC4luC4ueC4gSkKICAgICAgICAgICAgYmdDb2xvckNsYXNzID0gJ2JnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHJpbmctNCByaW5nLWdyZWVuLTMwMCc7CiAgICAgICAgICAgIGljb24gPSAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUiPjwvaT4nOwogICAgICAgIH0gZWxzZSBpZiAoaGFzVXJsKSB7CiAgICAgICAgICAgIC8vIOC4quC4luC4suC4meC4sDog4Lih4Li14Lil4Li04LiH4LiB4LmMIOC5geC4leC5iOC4ouC4seC4h+C5hOC4oeC5iOC4luC4ueC4geC5gOC4peC4t+C4reC4gSAo4Liq4Li14Lif4LmJ4LiyKQogICAgICAgICAgICBiZ0NvbG9yQ2xhc3MgPSAnYmctYmx1ZS01MDAgaG92ZXI6YmctYmx1ZS02MDAgdGV4dC13aGl0ZSc7CiAgICAgICAgICAgIGljb24gPSAn8J+ThCc7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZWxldGVCdG5IdG1sID0gIXNob3J0Y3V0LmlzRGVmYXVsdCA/IAogICAgICAgICAgICBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1maWxlLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSB0b3AtMSByaWdodC0xIHctNiBoLTYgYmctcmVkLTUwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguKXguJoiPiZ0aW1lczs8L2J1dHRvbj5gIDogJyc7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJmaWxlLXNob3J0Y3V0LWJ0biByb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC02IGgtMjQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSAke2JnQ29sb3JDbGFzc30iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBvaW50ZXItZXZlbnRzLW5vbmUgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC0yeGwiPiR7aWNvbn08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIj4ke3Nob3J0Y3V0Lm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1maWxlLXNob3J0Y3V0LWJ0biBhYnNvbHV0ZSBib3R0b20tMSByaWdodC0xIHctNiBoLTYgYmctd2hpdGUvNTAgdGV4dC1ncmF5LTgwMCByb3VuZGVkLWZ1bGwgdGV4dC14cyBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIj48aSBjbGFzcz0iZmFzIGZhLXBlbiI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHtkZWxldGVCdG5IdG1sfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgfSkuam9pbignJyk7CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCArPSBgCiAgICAgICAgICAgIDxkaXYgaWQ9Im9wZW4tYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4iIGNsYXNzPSJyb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiBob3ZlcjpzY2FsZS0xMDUgaC0yNCBiZy1ncmF5LTEwMCBob3ZlcjpiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNjAwIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZWxsaXBzaXMtaCB0ZXh0LXhsIj48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXQtMiB0ZXh0LXNtIj7guJvguLjguYjguKHguKXguLHguJTguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgYWRkaXRpb25hbExpc3QuaW5uZXJIVE1MID0gaGlkZGVuU2hvcnRjdXRzLm1hcChzaG9ydGN1dCA9PiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtMyBib3JkZXItYiBob3ZlcjpiZy1ncmF5LTEwMCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4iPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtzaG9ydGN1dC51cmwgPyAn8J+ThCcgOiAn8J+Ulyd9ICR7c2hvcnRjdXQubmFtZX08L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLWJsdWUtMjAwIj7guYDguKXguLfguK3guIHguYPguIrguYk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZWRpdC1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctMjAwIj7guYHguIHguYnguYTguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tZmlsZS1zaG9ydGN1dC1idG4gYmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtMjAwIj7guKXguJo8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYCkuam9pbignJyk7CiAgICB9IGVsc2UgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvcD4nOwogICAgfQp9CgovKioKICogW0ZpbGUgU2hvcnRjdXRzXSDguYDguJvguLTguJQgTW9kYWwg4Liq4Liz4Lir4Lij4Lix4Lia4LmB4LiB4LmJ4LmE4LiC4Lir4Lij4Li34Lit4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4Lir4Lih4LmICiAqLwpmdW5jdGlvbiBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKHNob3J0Y3V0SWQgPSBudWxsKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpOwogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1tb2RhbC10aXRsZScpOwogICAgY29uc3QgaWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWlkLWlucHV0Jyk7CiAgICBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1uYW1lLWlucHV0Jyk7CiAgICBjb25zdCB1cmxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LXVybC1pbnB1dCcpOwoKICAgIGlmIChzaG9ydGN1dElkKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXQgPSBmaWxlU2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgICAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4LiB4LmJ4LmE4LiC4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmMJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gc2hvcnRjdXQuaWQ7CiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gc2hvcnRjdXQubmFtZTsKICAgICAgICB1cmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LnVybCB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LmD4Lir4Lih4LmIJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gJyc7IG5hbWVJbnB1dC52YWx1ZSA9ICcnOyB1cmxJbnB1dC52YWx1ZSA9ICcnOwogICAgfQogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCi8qKgogKiBbRmlsZSBTaG9ydGN1dHNdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4h+C4iOC4suC4gSBNb2RhbCDguKXguIcgRmlyZWJhc2UKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVGaWxlU2hvcnRjdXRDaGFuZ2VzKCkgewogICAgY29uc3QgaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC1pZC1pbnB1dCcpLnZhbHVlOwogICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LW5hbWUtaW5wdXQnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCB1cmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS1zaG9ydGN1dC11cmwtaW5wdXQnKS52YWx1ZS50cmltKCk7CgogICAgaWYgKCFuYW1lKSB7IHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguIHguKPguK3guIEgJ+C4iuC4t+C5iOC4reC4m+C4uOC5iOC4oeC4peC4seC4lCciKTsgcmV0dXJuOyB9CgogICAgY29uc3QgbmV3U2hvcnRjdXREYXRhID0gewogICAgICAgIGlkOiBpZCB8fCBgZmlsZS1zaG9ydGN1dF8ke0RhdGUubm93KCl9YCwKICAgICAgICBuYW1lOiBuYW1lLCB1cmw6IHVybCwgaXNEZWZhdWx0OiBpZC5zdGFydHNXaXRoKCdmaWxlLWRlZmF1bHQtJykKICAgIH07CgogICAgbGV0IHVwZGF0ZWRTaG9ydGN1dHM7CiAgICBpZiAoaWQpIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gZmlsZVNob3J0Y3V0cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IG5ld1Nob3J0Y3V0RGF0YSA6IHMpOwogICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gWy4uLmZpbGVTaG9ydGN1dHMsIG5ld1Nob3J0Y3V0RGF0YV07CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZmlsZVNob3J0Y3V0c0NvbmZpZyIpOwogICAgICAgIGF3YWl0IHNldERvYyhwcmVmUmVmLCB7IHNob3J0Y3V0czogdXBkYXRlZFNob3J0Y3V0cyB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWVkaXRvci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZmlsZSBzaG9ydGN1dDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9CgovKioKICogW0ZpbGUgU2hvcnRjdXRzXSDguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguYDguKHguLfguYjguK3guITguKXguLTguIHguJfguLXguYjguJvguLjguYjguKHguKXguLHguJQKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUZpbGVTaG9ydGN1dENsaWNrKHNob3J0Y3V0SWQpIHsKICAgIGNvbnN0IHNob3J0Y3V0ID0gZmlsZVNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk7CiAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CgogICAgLy8g4LiW4LmJ4Liy4Lib4Li44LmI4Lih4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lil4Li04LiH4LiB4LmMIOC5g+C4q+C5ieC5gOC4m+C4tOC4lOC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5geC4geC5ieC5hOC4guC5geC4l+C4mQogICAgaWYgKCFzaG9ydGN1dC51cmwgfHwgc2hvcnRjdXQudXJsLnRyaW0oKSA9PT0gJycpIHsKICAgICAgICBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKHNob3J0Y3V0SWQpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguYLguKvguKXguJTguJrguJnguJvguLjguYjguKHguJfguLXguYjguJbguLnguIHguITguKXguLTguIEKICAgIGNvbnN0IGJ0bkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuZmlsZS1zaG9ydGN1dC1idG5bZGF0YS1pZD0iJHtzaG9ydGN1dElkfSJdYCk7CiAgICBpZiAoYnRuRWxlbWVudCkgewogICAgICAgIGNvbnN0IG9yaWdpbmFsQ29udGVudCA9IGJ0bkVsZW1lbnQuaW5uZXJIVE1MOwogICAgICAgIGJ0bkVsZW1lbnQuaW5uZXJIVE1MID0gYDxzcGFuIGNsYXNzPSJwb2ludGVyLWV2ZW50cy1ub25lIj48aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiI+PC9pPjwvc3Bhbj5gOwogICAgICAgIGJ0bkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlOwogICAgfQogICAgCiAgICAvLyDguJvguLTguJTguIHguLLguKPguYPguIrguYnguIfguLLguJnguJvguLjguYjguKHguK3guLfguYjguJnguIrguLHguYjguKfguITguKPguLLguKcKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWxlLXNob3J0Y3V0LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBpZihidG4uZGF0YXNldC5pZCAhPT0gc2hvcnRjdXRJZCkgYnRuLmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnLCAncG9pbnRlci1ldmVudHMtbm9uZScpOwogICAgfSk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCB1cmxQYXRoID0gbmV3IFVSTChzaG9ydGN1dC51cmwpLnBhdGhuYW1lOwogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gdXJsUGF0aC5zdWJzdHJpbmcodXJsUGF0aC5sYXN0SW5kZXhPZignLycpICsgMSkgfHwgKHNob3J0Y3V0LnVybC5pbmNsdWRlcygnLnR4dCcpID8gJ2ZpbGUudHh0JyA6ICdmaWxlLnBkZicpOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBmZXRjaEZpbGVGcm9tVXJsIOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4pwogICAgICAgIGNvbnN0IGZpbGVPYmplY3QgPSBhd2FpdCBmZXRjaEZpbGVGcm9tVXJsKHNob3J0Y3V0LnVybCwgZmlsZW5hbWUpOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBJRCDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguYDguILguYnguLLguYTguJvguYPguJkgRmlsZSBvYmplY3Qg4LmA4Lie4Li34LmI4Lit4LmD4LiK4LmJ4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Liq4LiW4Liy4LiZ4LiwICJBY3RpdmUiCiAgICAgICAgZmlsZU9iamVjdC5zaG9ydGN1dElkID0gc2hvcnRjdXRJZDsgCgogICAgICAgIC8vICoq4LiI4Li44LiU4LmA4LiK4Li34LmI4Lit4Lih4LiV4LmI4Lit4LiX4Li14LmI4Liq4Liz4LiE4Lix4LiNOioqIOC4meC4syBGaWxlIG9iamVjdCDguYTguJvguYPguKrguYjguYPguJnguJXguLHguKfguYHguJvguKMgYHNlbGVjdGVkRmlsZWAKICAgICAgICAvLyDguYDguKrguKHguLfguK3guJnguKfguYjguLLguJzguLnguYnguYPguIrguYnguYDguJ7guLTguYjguIfguK3guLHguJvguYLguKvguKXguJTguYTguJ/guKXguYzguJnguLXguYnguJTguYnguKfguKLguJXguJnguYDguK3guIcKICAgICAgICBzZWxlY3RlZEZpbGUgPSBmaWxlT2JqZWN0OwogICAgICAgIAogICAgICAgIC8vIOC4reC4seC4m+C5gOC4lOC4lSBVSSDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJTguYDguJ7guLfguYjguK3guYHguKrguJTguIfguKrguJbguLLguJnguLAgIuC4nuC4o+C5ieC4reC4oeC5g+C4iuC5ieC4h+C4suC4mSIgKOC4quC4teC5gOC4guC4teC4ouC4pykKICAgICAgICByZW5kZXJGaWxlU2hvcnRjdXRzKCk7IAogICAgICAgIAogICAgICAgIC8vICoq4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiB4Lil4Liy4LiHKiog4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4Lif4Li14LmA4LiI4Lit4Lij4LmM4LmA4Liq4Lij4Li04Lih4LmB4Lil4Liw4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiCiAgICAgICAgYWN0aXZhdGVGaWxlSW5wdXRBcmVhV2l0aExvYWRlZEZpbGUoKTsKICAgICAgICAKICAgICAgICAvLyDguYDguKXguLfguYjguK3guJnguKvguJnguYnguLLguIjguK3guYTguJvguKLguLHguIfguKrguYjguKfguJkgIuC4iOC4suC4geC5hOC4n+C4peC5jCIg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4Lic4Li54LmJ4LmD4LiK4LmJ4LmA4Lir4LmH4LiZ4Lin4LmI4Liy4Lie4Lij4LmJ4Lit4Lih4LmB4Lil4LmJ4LinCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtaW5wdXQtYXJlYScpLnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6ICdzbW9vdGgnLCBibG9jazogJ2NlbnRlcicgfSk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwcm9jZXNzaW5nIGZpbGUgc2hvcnRjdXQgY2xpY2s6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGDguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguYTguJ/guKXguYzguIjguLLguIHguKXguLTguIfguIHguYw6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICByZW5kZXJGaWxlU2hvcnRjdXRzKCk7IC8vIOC4hOC4t+C4meC4hOC5iOC4siBVSSDguILguK3guIfguJvguLjguYjguKHguYDguJvguYfguJnguJvguIHguJXguLTguKvguLLguIHguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQKICAgIH0gZmluYWxseSB7CiAgICAgICAgLy8g4LmA4Lib4Li04LiU4LiB4Liy4Lij4LmD4LiK4LmJ4LiH4Liy4LiZ4Lib4Li44LmI4Lih4Lit4Li34LmI4LiZ4LiB4Lil4Lix4Lia4Lih4LiyCiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtc2hvcnRjdXQtYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnb3BhY2l0eS01MCcsICdwb2ludGVyLWV2ZW50cy1ub25lJyk7CiAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfQp9CgpmdW5jdGlvbiBwYXJzZVBhZ2VTZWxlY3Rpb24oaW5wdXQsIG1heFBhZ2VzKSB7CiAgICBpZiAoIWlucHV0IHx8IGlucHV0LnRyaW0oKSA9PT0gJycpIHJldHVybiBudWxsOyAvLyBudWxsID0g4LmA4Lit4Liy4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAKICAgIGNvbnN0IHBhZ2VzID0gbmV3IFNldCgpOwogICAgY29uc3QgcGFydHMgPSBpbnB1dC5zcGxpdCgnLCcpOwogICAgCiAgICBwYXJ0cy5mb3JFYWNoKHBhcnQgPT4gewogICAgICAgIHBhcnQgPSBwYXJ0LnRyaW0oKTsKICAgICAgICBpZiAocGFydC5pbmNsdWRlcygnLScpKSB7CiAgICAgICAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IHBhcnQuc3BsaXQoJy0nKS5tYXAoTnVtYmVyKTsKICAgICAgICAgICAgaWYgKCFpc05hTihzdGFydCkgJiYgIWlzTmFOKGVuZCkpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBNYXRoLm1pbihzdGFydCwgZW5kKTsgaSA8PSBNYXRoLm1heChzdGFydCwgZW5kKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPj0gMSAmJiBpIDw9IG1heFBhZ2VzKSBwYWdlcy5hZGQoaSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBudW0gPSBOdW1iZXIocGFydCk7CiAgICAgICAgICAgIGlmICghaXNOYU4obnVtKSAmJiBudW0gPj0gMSAmJiBudW0gPD0gbWF4UGFnZXMpIHsKICAgICAgICAgICAgICAgIHBhZ2VzLmFkZChudW0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgIC8vIOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC4iOC4suC4geC4meC5ieC4reC4ouC5hOC4m+C4oeC4suC4gQogICAgcmV0dXJuIEFycmF5LmZyb20ocGFnZXMpLnNvcnQoKGEsIGIpID0+IGEgLSBiKTsKfQoKLyoqCiAqIFvguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYhdIOC4quC4o+C5ieC4suC4h+C5hOC4n+C4peC5jCBQREYg4LmD4Lir4Lih4LmI4LiX4Li14LmI4Lih4Li14LmA4LiJ4Lie4Liy4Liw4Lir4LiZ4LmJ4Liy4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBIChSZW5kZXIgdG8gSW1hZ2UgLT4gUERGKQogKi8KYXN5bmMgZnVuY3Rpb24gY3JlYXRlUGRmRnJvbVNlbGVjdGVkUGFnZXMoZmlsZSwgc2VsZWN0ZWRQYWdlcykgewogICAgLy8g4LmD4LiK4LmJIGpzUERGIOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C5g+C4meC5guC4m+C4o+C5gOC4iOC4hAogICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOwogICAgCiAgICAvLyDguK3guYjguLLguJnguYTguJ/guKXguYwgUERGIOC4leC5ieC4meC4ieC4muC4seC4mgogICAgY29uc3QgYXJyYXlCdWZmZXIgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7CiAgICBjb25zdCBwZGYgPSBhd2FpdCBwZGZqc0xpYi5nZXREb2N1bWVudChhcnJheUJ1ZmZlcikucHJvbWlzZTsKICAgIAogICAgY29uc3QgbmV3UGRmID0gbmV3IGpzUERGKCk7CiAgICBjb25zdCB0b3RhbFNlbGVjdGVkID0gc2VsZWN0ZWRQYWdlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbFNlbGVjdGVkOyBpKyspIHsKICAgICAgICBjb25zdCBwYWdlTnVtID0gc2VsZWN0ZWRQYWdlc1tpXTsKICAgICAgICAKICAgICAgICAvLyDguYHguIjguYnguIfguKrguJbguLLguJnguLDguIHguLLguKPguJXguLHguJTguJXguYjguK0KICAgICAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CiAgICAgICAgaWYgKGxvYWRlclRleHQpIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4LmA4LiV4Lij4Li14Lii4Lih4Lir4LiZ4LmJ4LiyIFBERjog4Lir4LiZ4LmJ4Liy4LiX4Li14LmIICR7cGFnZU51bX0uLi5gOwoKICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmLmdldFBhZ2UocGFnZU51bSk7CiAgICAgICAgCiAgICAgICAgLy8g4LiB4Liz4Lir4LiZ4LiU4LiE4Li44LiT4Lig4Liy4LieIChTY2FsZSAxLjUgPSDguIrguLHguJTguIHguLPguKXguLHguIfguJTguLUg4LmE4Lih4LmI4LmD4Lir4LiN4LmI4LmA4LiB4Li04LiZ4LmE4Lib4Liq4Liz4Lir4Lij4Lix4LiaIEFJKQogICAgICAgIGNvbnN0IHZpZXdwb3J0ID0gcGFnZS5nZXRWaWV3cG9ydCh7IHNjYWxlOiAxLjUgfSk7CiAgICAgICAgCiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiHIENhbnZhcyDguYDguJ7guLfguYjguK3guKfguLLguJTguKvguJnguYnguLIgUERGIOC5gOC4m+C5h+C4meC4o+C4ueC4m+C4oOC4suC4ngogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gdmlld3BvcnQuaGVpZ2h0OwogICAgICAgIGNhbnZhcy53aWR0aCA9IHZpZXdwb3J0LndpZHRoOwoKICAgICAgICBhd2FpdCBwYWdlLnJlbmRlcih7IGNhbnZhc0NvbnRleHQ6IGNvbnRleHQsIHZpZXdwb3J0OiB2aWV3cG9ydCB9KS5wcm9taXNlOwogICAgICAgIAogICAgICAgIC8vIOC5geC4m+C4peC4h+C5gOC4m+C5h+C4meC4o+C4ueC4m+C4oOC4suC4niBKUEVHICjguILguJnguLLguJTguYDguKXguYfguIHguIHguKfguYjguLIgUE5HKQogICAgICAgIGNvbnN0IGltZ0RhdGEgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgMC44KTsKICAgICAgICAKICAgICAgICAvLyDguYDguJ7guLTguYjguKHguKvguJnguYnguLLguYPguJkgUERGIOC5g+C4q+C4oeC5iAogICAgICAgIGlmIChpID4gMCkgbmV3UGRmLmFkZFBhZ2UoKTsKICAgICAgICAKICAgICAgICAvLyDguITguLPguJnguKfguJPguILguJnguLLguJTguYPguKvguYnguJ7guK3guJTguLXguKvguJnguYnguLIgQTQg4LmD4LiZIFBERiDguYPguKvguKHguYgKICAgICAgICBjb25zdCBwZGZQYWdlV2lkdGggPSBuZXdQZGYuaW50ZXJuYWwucGFnZVNpemUuZ2V0V2lkdGgoKTsKICAgICAgICBjb25zdCBwZGZQYWdlSGVpZ2h0ID0gbmV3UGRmLmludGVybmFsLnBhZ2VTaXplLmdldEhlaWdodCgpOwogICAgICAgIGNvbnN0IGltZ1Byb3BzID0gbmV3UGRmLmdldEltYWdlUHJvcGVydGllcyhpbWdEYXRhKTsKICAgICAgICBjb25zdCByYXRpbyA9IGltZ1Byb3BzLndpZHRoIC8gaW1nUHJvcHMuaGVpZ2h0OwogICAgICAgIGNvbnN0IHBkZlJhdGlvID0gcGRmUGFnZVdpZHRoIC8gcGRmUGFnZUhlaWdodDsKICAgICAgICAKICAgICAgICBsZXQgZmluYWxXLCBmaW5hbEg7CiAgICAgICAgaWYgKHJhdGlvID4gcGRmUmF0aW8pIHsKICAgICAgICAgICAgZmluYWxXID0gcGRmUGFnZVdpZHRoOwogICAgICAgICAgICBmaW5hbEggPSBwZGZQYWdlV2lkdGggLyByYXRpbzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaW5hbEggPSBwZGZQYWdlSGVpZ2h0OwogICAgICAgICAgICBmaW5hbFcgPSBwZGZQYWdlSGVpZ2h0ICogcmF0aW87CiAgICAgICAgfQoKICAgICAgICBuZXdQZGYuYWRkSW1hZ2UoaW1nRGF0YSwgJ0pQRUcnLCAwLCAwLCBmaW5hbFcsIGZpbmFsSCk7CiAgICB9CgogICAgLy8g4LiE4Li34LiZ4LiE4LmI4Liy4LmA4Lib4LmH4LiZIEJhc2U2NCBzdHJpbmcgKOC4leC4seC4lCBwcmVmaXggZGF0YSB1cmkg4Lit4Lit4LiBKQogICAgY29uc3QgcGRmT3V0cHV0ID0gbmV3UGRmLm91dHB1dCgnZGF0YXVyaXN0cmluZycpOwogICAgcmV0dXJuIHBkZk91dHB1dC5zcGxpdCgnLCcpWzFdOwp9Cgphc3luYyBmdW5jdGlvbiBlbnN1cmVHbG9iYWxRdWl6emVzTG9hZGVkKCkgewogICAgaWYgKGFsbFF1aXp6ZXNHbG9iYWwubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybjsgLy8g4LiW4LmJ4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC4geC5h+C5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4owogICAgfQoKICAgIGNvbnNvbGUubG9nKCJHbG9iYWwgcXVpeiBjYWNoZSBpcyBlbXB0eS4gRmV0Y2hpbmcgbm93Li4uIik7CiAgICBzaG93TWVzc2FnZSgi4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiU4LiE4Lil4Lix4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiULi4uIik7IC8vIOC5geC4iOC5ieC4h+C5g+C4q+C5ieC4nOC4ueC5ieC5g+C4iuC5ieC4l+C4o+C4suC4mgogICAgdHJ5IHsKICAgICAgICBjb25zdCBxcyA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCkpOwogICAgICAgIGFsbFF1aXp6ZXNHbG9iYWwgPSBxcy5kb2NzLm1hcChkID0+ICh7IGlkOiBkLmlkLCAuLi5kLmRhdGEoKSB9KSk7CiAgICAgICAgY29uc29sZS5sb2coYExvYWRlZCAke2FsbFF1aXp6ZXNHbG9iYWwubGVuZ3RofSBxdWl6emVzIGludG8gZ2xvYmFsIGNhY2hlLmApOwogICAgICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4LihICLguIHguLPguKXguLHguIfguYLguKvguKXguJQuLi4iIOC5gOC4oeC4t+C5iOC4reC5gOC4quC4o+C5h+C4iAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYXRhbDogQ291bGQgbm90IGZldGNoIGdsb2JhbCBxdWl6emVzLiIsIGVycm9yKTsKICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgLy8g4LmC4Lii4LiZIGVycm9yIOC4reC4reC4geC5hOC4m+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4teC5iOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4o+C4ueC5ieC4p+C5iOC4suC4peC5ieC4oeC5gOC4q+C4peC4pwogICAgICAgIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmC4Lir4Lil4LiU4LiE4Lil4Lix4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LmE4LiU4LmJIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGV4cG9ydFF1aXpBc1dvcmtzaGVldFBERigpIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C5g+C4muC4h+C4suC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBxdWl6RGF0YSA9IGN1cnJlbnRRdWl6RGF0YTsKICAgIGNvbnN0IHdvcmtzaGVldFdpbmRvdyA9IHdpbmRvdy5vcGVuKCcnLCAnX2JsYW5rJyk7CgogICAgY29uc3QgdG9FbmdDaGFyID0gKGluZGV4KSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOyAvLyA2NSDguITguLfguK3guKPguKvguLHguKrguILguK3guIcgJ0EnCgogICAgY29uc3Qgd29ya3NoZWV0SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPuC5geC4muC4muC4l+C4lOC4quC4reC4mjogJHtxdWl6RGF0YS50b3BpY308L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICAKICAgICAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4ID0geyB0ZXg6IHsgaW5saW5lTWF0aDogW1snJCcsICckJ10sIFsnXFxcXCgnLCAnXFxcXCknXV0gfSB9OwogICAgICAgICAgICA8XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzY3JpcHQgaWQ9Ik1hdGhKYXgtc2NyaXB0IiBhc3luYyBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbWF0aGpheEAzL2VzNS90ZXgtbW1sLWNodG1sLmpzIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgICAgIGJvZHkgeyAKICAgICAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ1NhcmFidW4nLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsgLyog4Lib4Lij4Lix4Lia4LiC4LiZ4Liy4LiU4Lit4Lix4LiB4Lip4Lij4LmD4Lir4LmJ4LmA4Lil4LmH4LiB4Lil4LiH4Lit4Li14LiB4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4Lii4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4LiB4Lij4Liw4LiK4Lix4LiaICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAbWVkaWEgcHJpbnQgewogICAgICAgICAgICAgICAgICAgIGJvZHkgeyAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3Q7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5xdWVzdGlvbi1pdGVtIHsgCiAgICAgICAgICAgICAgICAgICAgYnJlYWstaW5zaWRlOiBhdm9pZDsgLyog4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LmE4Lih4LmI4LmD4Lir4LmJ4LiC4LmJ4Lit4Liq4Lit4LiaIDEg4LiC4LmJ4Lit4LiW4Li54LiB4LiV4Lix4LiU4LmB4Lia4LmI4LiH4LiE4Lit4Lil4Lix4Lih4LiZ4LmMICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAuYW5zd2VyLXNwYWNlIHsKICAgICAgICAgICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggZG90dGVkIGJsYWNrOwogICAgICAgICAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDIycHg7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogOHB4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4pa84pa84pa8IENTUyDguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgMiDguITguK3guKXguLHguKHguJnguYwg4pa84pa84pa8ICovCiAgICAgICAgICAgICAgICAucXVpei1jb2x1bW5zIHsKICAgICAgICAgICAgICAgICAgICBjb2x1bW4tY291bnQ6IDI7CiAgICAgICAgICAgICAgICAgICAgY29sdW1uLWdhcDogMnJlbTsgLyog4Lij4Liw4Lii4Liw4Lir4LmI4Liy4LiH4Lij4Liw4Lir4Lin4LmI4Liy4LiH4LiE4Lit4Lil4Lix4Lih4LiZ4LmMICovCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTYgbWF4LXctNXhsIG14LWF1dG8iPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi02Ij4KICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC14bCBmb250LWJvbGQiPuC5geC4muC4muC4l+C4lOC4quC4reC4muC5gOC4o+C4t+C5iOC4reC4hzogJHtxdWl6RGF0YS50b3BpY308L2gxPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gbWItNiB0ZXh0LWJhc2UiPgogICAgICAgICAgICAgICAgPHA+4LiK4Li34LmI4LitLeC4quC4geC4uOC4pTogLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi48L3A+CiAgICAgICAgICAgICAgICA8cD7guYDguKXguILguJfguLXguYg6IC4uLi4uLi4uLi4uLi48L3A+CiAgICAgICAgICAgICAgICA8cD7guITguLDguYHguJnguJk6IC4uLi4uLi4uLi4uLi4uLi4uPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGhyIGNsYXNzPSJtYi00Ij4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1aXotY29sdW1ucyI+CiAgICAgICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHF1ZXN0aW9uQm9keSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHF1aXpEYXRhLnF1aXpUeXBlOwoKICAgICAgICAgICAgICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5gOC4m+C5h+C4mSAxIOC4hOC4reC4peC4seC4oeC4meC5jOC4oOC4suC4ouC5g+C4meC4guC5ieC4rSDguYHguJXguYjguILguYnguK3guKrguK3guJrguYLguJTguKLguKPguKfguKHguYDguJvguYfguJkgMiDguITguK3guKXguLHguKHguJnguYwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uQm9keSA9IGA8ZGl2IGNsYXNzPSJtdC0yIHNwYWNlLXktMSB0ZXh0LWJhc2UiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHt0b0VuZ0NoYXIoaSl9LiAke29wdH08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCc8YnI+Jyl9PC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0ibXQtMiBzcGFjZS15LTEgdGV4dC1iYXNlIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkEuIOC4luC4ueC4gTwvc3Bhbj48YnI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+Qi4g4Lic4Li04LiUPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogLy8g4Liq4Liz4Lir4Lij4Lix4Lia4LiC4LmJ4Lit4LmA4LiC4Li14Lii4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0iYW5zd2VyLXNwYWNlIj48L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyDilrzilrzilrwg4LmA4Lie4Li04LmI4LihIG1iLTUgKG1hcmdpbi1ib3R0b20pIOC5g+C4q+C5ieC5geC4leC5iOC4peC4sOC4guC5ieC4reC5gOC4nuC4t+C5iOC4reC5gOC4p+C5ieC4meC4o+C4sOC4ouC4sOC4q+C5iOC4suC4hyDilrzilrzilrwKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJxdWVzdGlvbi1pdGVtIG1iLTUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbXItMiI+JHtpbmRleCArIDF9LjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3EuaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3F1ZXN0aW9uQm9keX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgoJCQkKCQkJPGRpdiBpZD0iY3JvcHBlci1tb2RhbCIgY2xhc3M9ImZpeGVkIGluc2V0LTAgYmctYmxhY2sgYmctb3BhY2l0eS05MCB6LVs3MF0gaGlkZGVuIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHAtNCI+CiAgICA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSB3LWZ1bGwgbWF4LXctNHhsIGgtWzcwdmhdIGJnLWJsYWNrIj4KICAgICAgICA8aW1nIGlkPSJpbWFnZS10by1jcm9wIiBzcmM9IiIgY2xhc3M9Im1heC13LWZ1bGwgbWF4LWgtZnVsbCBibG9jayI+CiAgICA8L2Rpdj4KICAgIAogICAgPGRpdiBjbGFzcz0iZmxleCBnYXAtNCBtdC00Ij4KICAgICAgICA8YnV0dG9uIGlkPSJjYW5jZWwtY3JvcC1idG4iIGNsYXNzPSJiZy1ncmF5LTUwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyYXktNjAwIGZvbnQtYm9sZCI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiBCiAgICAgICAgPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlybS1jcm9wLWJ0biIgY2xhc3M9ImJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNiByb3VuZGVkLWxnIGhvdmVyOmJnLWdyZWVuLTcwMCBmb250LWJvbGQgc2hhZG93LWxnIHRyYW5zZm9ybSB0cmFuc2l0aW9uIGhvdmVyOnNjYWxlLTEwNSI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY3JvcC1hbHQiPjwvaT4g4LiV4Lix4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJICYg4Liq4LmB4LiB4LiZCiAgICAgICAgPC9idXR0b24+CiAgICA8L2Rpdj4KPC9kaXY+CgkJCQogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwoKICAgIHdvcmtzaGVldFdpbmRvdy5kb2N1bWVudC53cml0ZSh3b3Jrc2hlZXRIdG1sKTsKICAgIHdvcmtzaGVldFdpbmRvdy5kb2N1bWVudC5jbG9zZSgpOwogICAgd29ya3NoZWV0V2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB3b3Jrc2hlZXRXaW5kb3cucHJpbnQoKTsKICAgICAgICB9LCAxNTAwKTsKICAgIH07Cn0KCi8qKgogKiDguKrguKPguYnguLLguIfguKvguJnguYnguLIgSFRNTCDguKrguLPguKvguKPguLHguJrguJ7guLTguKHguJ7guYzguYHguJrguJrguJfguJTguKrguK3guJogKOC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4leC4tOC4p+C4guC5ieC4reC4quC4reC4miDguILguYnguK3guKXguLDguKvguJnguYnguLIpCiAqLwpmdW5jdGlvbiBleHBvcnRRdWl6QXNUdXRvclBERigpIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C5g+C4muC4h+C4suC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBxdWl6RGF0YSA9IGN1cnJlbnRRdWl6RGF0YTsKICAgIGNvbnN0IHdvcmtzaGVldFdpbmRvdyA9IHdpbmRvdy5vcGVuKCcnLCAnX2JsYW5rJyk7CiAgICBjb25zdCB0b0VuZ0NoYXIgPSAoaW5kZXgpID0+IFN0cmluZy5mcm9tQ2hhckNvZGUoNjUgKyBpbmRleCk7CgogICAgY29uc3Qgd29ya3NoZWV0SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPuC5gOC4reC4geC4quC4suC4o+C4leC4tOC4pzogJHtxdWl6RGF0YS50b3BpY308L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXggPSB7IHRleDogeyBpbmxpbmVNYXRoOiBbWyckJywgJyQnXSwgWydcXFxcKCcsICdcXFxcKSddXSB9IH07CiAgICAgICAgICAgIDxcL3NjcmlwdD4KICAgICAgICAgICAgPHNjcmlwdCBpZD0iTWF0aEpheC1zY3JpcHQiIGFzeW5jIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tYXRoamF4QDMvZXM1L3RleC1tbWwtY2h0bWwuanMiPjxcL3NjcmlwdD4KICAgICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2FyYWJ1bicsIHNhbnMtc2VyaWY7IH0KICAgICAgICAgICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4pa84pa84pa8IENTUyDguKrguLPguITguLHguI06IOC4quC4seC5iOC4h+C5g+C4q+C5ieC4guC4tuC5ieC4meC4q+C4meC5ieC4suC5g+C4q+C4oeC5iOC4q+C4peC4seC4h+C4iOC4muC5geC4leC5iOC4peC4sOC4guC5ieC4rSDilrzilrzilrwgKi8KICAgICAgICAgICAgICAgIC5wYWdlLWJyZWFrIHsKICAgICAgICAgICAgICAgICAgICBwYWdlLWJyZWFrLWFmdGVyOiBhbHdheXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAucXVlc3Rpb24tY29udGFpbmVyIHsKICAgICAgICAgICAgICAgICAgICBtaW4taGVpZ2h0OiA5MHZoOyAvKiDguJfguLPguYPguKvguYnguYHguJXguYjguKXguLDguILguYnguK3guYDguJXguYfguKHguKvguJnguYnguLLguIHguKPguLDguJTguLLguKkgKi8KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTYgbWF4LXctNHhsIG14LWF1dG8iPgogICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcXVlc3Rpb25Cb2R5ID0gJyc7CiAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25Cb2R5ID0gYDxkaXYgY2xhc3M9Im10LTQgc3BhY2UteS0zIHRleHQteGwiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke3RvRW5nQ2hhcihpKX0uICR7b3B0fTwvc3Bhbj5gKS5qb2luKCc8YnI+Jyl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkJvZHkgPSBgPGRpdiBjbGFzcz0ibXQtNCBzcGFjZS15LTMgdGV4dC14bCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj5BLiDguJbguLnguIE8L3NwYW4+PGJyPjxzcGFuPkIuIOC4nOC4tOC4lDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25Cb2R5ID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InBhZ2UtYnJlYWsiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1ZXN0aW9uLWNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNTAwIj7guYHguJrguJrguJfguJTguKrguK3guJrguYDguKPguLfguYjguK3guIc6ICR7cXVpekRhdGEudG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCBtdC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIG1yLTMiPiR7aW5kZXggKyAxfS48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCI+JHtxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3EuaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTYiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3F1ZXN0aW9uQm9keX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgPC9ib2R5PgogICAgICAgIDwvaHRtbD4KICAgIGA7CiAgICB3b3Jrc2hlZXRXaW5kb3cuZG9jdW1lbnQud3JpdGUod29ya3NoZWV0SHRtbCk7CiAgICB3b3Jrc2hlZXRXaW5kb3cuZG9jdW1lbnQuY2xvc2UoKTsKICAgIHdvcmtzaGVldFdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgd29ya3NoZWV0V2luZG93LnByaW50KCk7IH0sIDE1MDApOwogICAgfTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVG9nZ2xlU3RhclF1aXoocXVpeklkKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBkaXNwbGF5UXVlc3Rpb25CYW5rKCkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbmstaW5wdXQtYXJlYScpOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+JzsgLy8g4LmB4Liq4LiU4LiH4Liq4LiW4Liy4LiZ4Liw4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiUCgogICAgdHJ5IHsKICAgICAgICBjb25zdCBiYW5rQ29sbGVjdGlvblJlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vdXNlcnMvJHt1c2VySWR9L3F1ZXN0aW9uQmFua2ApOwogICAgICAgIGNvbnN0IHEgPSBxdWVyeShiYW5rQ29sbGVjdGlvblJlZik7IC8vIOC4quC4suC4oeC4suC4o+C4luC5gOC4nuC4tOC5iOC4oSBvcmRlckJ5IOC5hOC4lOC5ieC5g+C4meC4reC4meC4suC4hOC4lQogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgaWYgKHNuYXBzaG90LmVtcHR5KSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC4guC4reC4h+C4hOC4uOC4k+C4ouC4seC4h+C4p+C5iOC4suC4h+C4reC4ouC4ueC5iDwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBsZXQgcXVlc3Rpb25zSFRNTCA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiB7CiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uID0gZG9jLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25JZCA9IGRvYy5pZDsKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQgZ2FwLTMgcC0yIGJvcmRlci1iIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIHZhbHVlPScke0pTT04uc3RyaW5naWZ5KHF1ZXN0aW9uKX0nIGNsYXNzPSJtdC0xIGgtNCB3LTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke3F1ZXN0aW9uLnF1ZXN0aW9uVGV4dCB8fCBxdWVzdGlvbi5zdGVtfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+4LiI4Liy4LiB4LmA4Lij4Li34LmI4Lit4LiHOiAke3F1ZXN0aW9uLm9yaWdpbmFsVG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSkuam9pbignJyk7CgogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im1heC1oLTYwIG92ZXJmbG93LXktYXV0byBib3JkZXIgcm91bmRlZC1sZyBwLTIiPiR7cXVlc3Rpb25zSFRNTH08L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY3JlYXRlLWZyb20tYmFuay1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctcHVycGxlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctcHVycGxlLTcwMCI+CiAgICAgICAgICAgICAgICDguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguIjguLLguIHguILguYnguK3guJfguLXguYjguYDguKXguLfguK3guIEKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgYDsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWF0ZS1mcm9tLWJhbmstYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjcmVhdGVRdWl6RnJvbUJhbmspOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGlzcGxheWluZyBxdWVzdGlvbiBiYW5rOiIsIGVycm9yKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXJlZC01MDAiPuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC5guC4q+C4peC4lOC4hOC4peC4seC4h+C4guC5ieC4reC4quC4reC4muC5hOC4lOC5iTwvcD4nOwogICAgfQp9CgovKioKICog4pyFIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iDog4Liq4Lij4LmJ4Liy4LiH4Lir4LiZ4LmJ4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Lie4Li04Lih4Lie4LmM4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LmA4Lib4LmH4LiZIFBERgogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRXhwb3J0TGVzc29uVG9QREYoKSB7CiAgICBjb25zdCBsZXNzb25Db250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibGVzc29uLXNlY3Rpb25zLWNvbnRhaW5lciIpOwogICAgY29uc3QgbGVzc29uVGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctdGl0bGUnKS50ZXh0Q29udGVudCB8fCAn4Lia4LiX4LmA4Lij4Li14Lii4LiZJzsKCiAgICBpZiAoIWxlc3NvbkNvbnRlbnRFbCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguYDguJnguLfguYnguK3guKvguLLguJrguJfguYDguKPguLXguKLguJnguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC5gOC4m+C4tOC4lOC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5g+C4q+C4oeC5iOC5gOC4nuC4t+C5iOC4reC5gOC4leC4o+C4teC4ouC4oeC4nuC4tOC4oeC4nuC5jAogICAgY29uc3QgcHJpbnRXaW5kb3cgPSB3aW5kb3cub3BlbignJywgJ19ibGFuaycpOwoKICAgIC8vIOC4quC4o+C5ieC4suC4h+C5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4hyBIVE1MIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4muC4q+C4meC5ieC4suC4l+C4teC5iOC4iOC4sOC4nuC4tOC4oeC4nuC5jAogICAgY29uc3QgcHJpbnRIdG1sID0gYAogICAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICAgIDxodG1sIGxhbmc9InRoIj4KICAgICAgICA8aGVhZD4KICAgICAgICAgICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgICAgICAgICA8dGl0bGU+JHtsZXNzb25UaXRsZX08L3RpdGxlPgogICAgICAgICAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48XC9zY3JpcHQ+CiAgICAgICAgICAgIDxsaW5rIGhyZWY9Imh0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9U2FyYWJ1bjp3Z2h0QDQwMDs3MDAmZGlzcGxheT1zd2FwIiByZWw9InN0eWxlc2hlZXQiPgogICAgICAgICAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2ZvbnQtYXdlc29tZS82LjUuMS9jc3MvYWxsLm1pbi5jc3MiPgoKICAgICAgICAgICAgPHNjcmlwdD4KICAgICAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4ID0gewogICAgICAgICAgICAgICAgICAgIHRleDogeyBpbmxpbmVNYXRoOiBbWyckJywgJyQnXSwgWydcXFxcKCcsICdcXFxcKSddXSB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICA8XC9zY3JpcHQ+CiAgICAgICAgICAgIDxzY3JpcHQgaWQ9Ik1hdGhKYXgtc2NyaXB0IiBhc3luYyBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbWF0aGpheEAzL2VzNS90ZXgtbW1sLWNodG1sLmpzIj48XC9zY3JpcHQ+CgogICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6ICdTYXJhYnVuJywgc2Fucy1zZXJpZjsgfQogICAgICAgICAgICAgICAgQG1lZGlhIHByaW50IHsKICAgICAgICAgICAgICAgICAgICBib2R5IHsgLXdlYmtpdC1wcmludC1jb2xvci1hZGp1c3Q6IGV4YWN0OyB9CiAgICAgICAgICAgICAgICAgICAgLm5vLXByaW50IHsgZGlzcGxheTogbm9uZTsgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLyog4LiE4Lix4LiU4Lil4Lit4LiBIFN0eWxlIOC4l+C4teC5iOC4iOC4s+C5gOC4m+C5h+C4meC4oeC4suC4iOC4suC4geC4q+C4meC5ieC4suC4q+C4peC4seC4geC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBQREYg4Liq4Lin4Lii4LiH4Liy4LihICovCiAgICAgICAgICAgICAgICAuYWktY29udGVudCB7IHBhZ2UtYnJlYWstaW5zaWRlOiBhdm9pZDsgfQogICAgICAgICAgICAgICAgLmFpLWNvbnRlbnQgaDEsIC5haS1jb250ZW50IGgyLCAuYWktY29udGVudCBoMywgLmFpLWNvbnRlbnQgaDQgeyBmb250LXdlaWdodDogNzAwOyBjb2xvcjogIzFlM2E4YTsgbWFyZ2luLXRvcDogMS41cmVtOyBtYXJnaW4tYm90dG9tOiAwLjc1cmVtOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCBibG9ja3F1b3RlIHsgYmFja2dyb3VuZC1jb2xvcjogI2VmZjZmZjsgYm9yZGVyLWxlZnQ6IDRweCBzb2xpZCAjM2I4MmY2OyBwYWRkaW5nOiAwLjc1cmVtIDFyZW07IG1hcmdpbjogMXJlbSAwOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCB0YWJsZSB7IHdpZHRoOiAxMDAlOyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCB0aCwgLmFpLWNvbnRlbnQgdGQgeyBib3JkZXI6IDFweCBzb2xpZCAjZTJlOGYwOyBwYWRkaW5nOiAwLjVyZW0gMXJlbTsgfQogICAgICAgICAgICAgICAgLmFpLWNvbnRlbnQgdGggeyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmVmY2U4OyB9CiAgICAgICAgICAgICAgICAuYWktY29udGVudCBzdmcgeyBtYXgtd2lkdGg6IDEwMCU7IGhlaWdodDogYXV0bzsgZGlzcGxheTogYmxvY2s7IG1hcmdpbjogMXJlbSBhdXRvOyB9CiAgICAgICAgICAgICAgICAuc2VjdGlvbi1oZWFkZXIgeyBkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBmb250LXNpemU6IDEuNXJlbTsgZm9udC13ZWlnaHQ6IDcwMDsgbWFyZ2luLWJvdHRvbTogMXJlbTsgY29sb3I6ICMxZTNhOGE7IGJvcmRlci1ib3R0b206IDJweCBzb2xpZCAjZGJlYWZlOyBwYWRkaW5nLWJvdHRvbTogMC41cmVtOyB9CiAgICAgICAgICAgICAgICAuc2VjdGlvbi1oZWFkZXIgaSB7IG1hcmdpbi1yaWdodDogMC43NXJlbTsgY29sb3I6ICMzYjgyZjY7IH0KICAgICAgICAgICAgPC9zdHlsZT4KICAgICAgICA8L2hlYWQ+CiAgICAgICAgPGJvZHkgY2xhc3M9InAtOCBtYXgtdy00eGwgbXgtYXV0byI+CiAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIG1iLTgiPiR7bGVzc29uVGl0bGV9PC9oMT4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWktY29udGVudCI+CiAgICAgICAgICAgICAgICAke2xlc3NvbkNvbnRlbnRFbC5pbm5lckhUTUx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwoKICAgIC8vIOC5gOC4guC4teC4ouC4mSBIVE1MIOC4peC4h+C5g+C4meC4q+C4meC5ieC4suC4leC5iOC4suC4h+C5g+C4q+C4oeC5iAogICAgcHJpbnRXaW5kb3cuZG9jdW1lbnQud3JpdGUocHJpbnRIdG1sKTsKICAgIHByaW50V2luZG93LmRvY3VtZW50LmNsb3NlKCk7CgogICAgLy8g4Lij4Lit4LmD4Lir4LmJ4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4LmB4Lil4LiwIE1hdGhKYXgg4LmC4Lir4Lil4LiU4LmA4Liq4Lij4LmH4LiIIOC5geC4peC5ieC4p+C4hOC5iOC4reC4ouC4quC4seC5iOC4h+C4nuC4tOC4oeC4nuC5jAogICAgcHJpbnRXaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHByaW50V2luZG93LnByaW50KCk7CiAgICAgICAgfSwgMjAwMCk7IC8vIOC4q+C4meC5iOC4p+C4h+C5gOC4p+C4peC4siAyIOC4p+C4tOC4meC4suC4l+C4teC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4quC4ueC4leC4o+C4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jOC5geC4quC4lOC4h+C4nOC4peC4quC4oeC4muC4ueC4o+C4k+C5jAogICAgfTsKfQoKZnVuY3Rpb24gc2hvd0FkbWluTGl2ZVF1ZXN0aW9uVmlldyhxdWVzdGlvbiwgaW5kZXgsIHRvdGFsKSB7CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CgogICAgaWYocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IFsn4LmD4LiK4LmIJywgJ+C5hOC4oeC5iOC5g+C4iuC5iCddIDogcXVlc3Rpb24ub3B0aW9uczsKICAgICAgICBjb25zdCBjb3JyZWN0SW5kZXggPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IChxdWVzdGlvbi5jb3JyZWN0QW5zd2VyID8gMCA6IDEpIDogcXVlc3Rpb24uY29ycmVjdEFuc3dlckluZGV4OwoKICAgICAgICBvcHRpb25zSFRNTCA9IG9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IHJvdW5kZWQtbGcgdGV4dC14bCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciBiZy13aGl0ZS8zMCIgZGF0YS1pcy1jb3JyZWN0PSIke2kgPT09IGNvcnJlY3RJbmRleH0iPgogICAgICAgICAgICAgICAgJHtvcHR9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGApLmpvaW4oJycpOwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvbi5hbGxSZXNwb25zZXMgfHwgW107CiAgICAgICAgb3B0aW9uc0hUTUwgPSBvcHRpb25zLm1hcChvcHQgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGJnLXdoaXRlLzMwIiBkYXRhLWlzLWNvcnJlY3Q9IiR7b3B0ID09PSBxdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2V9Ij4KICAgICAgICAgICAgICAgICR7b3B0fQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKICAgIH0KCiAgICBjb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcXVlc3Rpb24uc3RlbSB8fCBxdWVzdGlvbi5xdWVzdGlvblRleHQ7CiAgICAKICAgIGNvbnN0IGFkbWluUXVlc3Rpb25IVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImxpdmUtZ2FtZS1iZyB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHRleHQtbGciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuPuC4guC5ieC4reC4l+C4teC5iCAke2luZGV4ICsgMX0gLyAke3RvdGFsfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmctd2hpdGUvMjAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LWJhc2UgZm9udC1tb25vIiB0aXRsZT0i4Lij4Lir4Lix4Liq4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmA4LiB4LihIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1rZXkgbXItMiBvcGFjaXR5LTcwIj48L2k+JHtjdXJyZW50TGl2ZUdhbWVQaW59CiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4leC4reC4muC5geC4peC5ieC4pzogPHNwYW4gaWQ9ImFuc3dlci1jb3VudGVyIiBjbGFzcz0iZm9udC1ib2xkIj4wLzA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im1hbmFnZS1wbGF5ZXJzLWJ0biIgY2xhc3M9InRleHQteHMgYmctd2hpdGUvMjAgaG92ZXI6Ymctd2hpdGUvNDAgcHgtMiBweS0xIHJvdW5kZWQtbWQiPuC4iOC4seC4lOC4geC4suC4o+C4nOC4ueC5ieC5gOC4peC5iOC4mTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJlbmQtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIj7guIjguJrguYDguIHguKE8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLXBsYXllci1tYW5hZ2VtZW50IiBjbGFzcz0iaGlkZGVuIHctZnVsbCBtYXgtdy1sZyBteC1hdXRvIGJnLWJsYWNrLzIwIHAtMiByb3VuZGVkLWxnIG10LTIgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBtYi0xIj7guJzguLnguYnguYDguKXguYjguJnguJfguLXguYjguKLguLHguIfguK3guKLguLnguYjguYPguJnguYDguIHguKE8L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLXBsYXllci1saXN0IiBjbGFzcz0iZmxleCBmbGV4LXdyYXAganVzdGlmeS1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi04IHRleHQtY2VudGVyIj4ke3F1ZXN0aW9uRGlzcGxheVRleHR9PC9oMj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy00eGwgZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgJHtvcHRpb25zSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBpZD0iYWRtaW4tYWN0aW9uLWJ1dHRvbnMiIGNsYXNzPSJ0ZXh0LWNlbnRlciBtdC04Ij4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InJldmVhbC1hbnN3ZXItYnRuIiBjbGFzcz0iYmcteWVsbG93LTUwMCBob3ZlcjpiZy15ZWxsb3ctNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQtMnhsIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV5ZSI+PC9pPiDguYDguInguKXguKIKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGFkbWluUXVlc3Rpb25IVE1MOwogICAgCiAgICBpZiAod2luZG93Lk1hdGhKYXggJiYgTWF0aEpheC50eXBlc2V0UHJvbWlzZSkgeyBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtsaXZlR2FtZVZpZXddKTsgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZlYWwtYW5zd2VyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcmV2ZWFsQW5zd2VyRm9yQWRtaW4oaW5kZXgsIHRvdGFsKSk7CiAgICAKICAgIC8vIC0tLSBbU1RBUlRdIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmQtZ2FtZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAvLyDguYDguJ7guLTguYjguKHguIHguLLguKPguKLguLfguJnguKLguLHguJnguIHguYjguK3guJnguIjguJrguYDguIHguKEg4LmA4Lie4Li34LmI4Lit4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LiB4LiU4Lie4Lil4Liy4LiUCiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgJ+C4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4muC5gOC4geC4oeC4meC4teC5ieC4geC5iOC4reC4meC5gOC4p+C4peC4suC4reC4seC4meC4hOC4p+C4oz8nLAogICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC4iOC4suC4geC4geC4suC4o+C4peC4miDguYDguJvguYfguJnguIHguLLguKPguK3guLHguJvguYDguJTguJXguKrguJbguLLguJnguLDguYPguKvguYnguYDguJvguYfguJkgJ3BvZGl1bScKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfSk7CiAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW5hZ2UtcGxheWVycy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZS1wbGF5ZXItbWFuYWdlbWVudCcpLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpOwogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CgovKioKICogW+C5g+C4q+C4oeC5iF0g4LmB4Liq4LiU4LiHIE1vZGFsIOC5g+C4q+C5ieC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4geC5iOC4reC4meC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4iOC4suC4gSBCbHVlcHJpbnQKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljTmFtZSAtIOC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4iOC4sOC5g+C4iuC5ieC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgogKi8KZnVuY3Rpb24gcHJvbXB0Rm9yUHJvamVjdEJlZm9yZUdlbmVyYXRpbmcodG9waWNOYW1lKSB7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotbW9kYWwnKTsgLy8g4LmA4Lij4Liy4LiI4Liw4LmD4LiK4LmJIE1vZGFsIOC4guC4reC4h+C4geC4suC4oyAi4Lii4LmJ4Liy4LiiIiDguKHguLLguJvguKPguLDguKLguLjguIHguJXguYzguYPguIrguYkKICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LXByb2plY3Qtc2VsZWN0Jyk7CiAgICBjb25zdCBtb2RhbFRpdGxlID0gbW9kYWwucXVlcnlTZWxlY3RvcignaDMnKTsKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1tb3ZlLXF1aXotYnRuJyk7CiAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1vdmUtcXVpei1idG4nKTsKCiAgICAvLyAxLiDguYDguJvguKXguLXguYjguKLguJnguILguYnguK3guITguKfguLLguKHguYPguJkgTW9kYWwg4LmD4Lir4LmJ4LmA4Lir4Lih4Liy4Liw4Liq4Lih4LiB4Lix4Lia4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4LiE4Lin4Li04LiLCiAgICBtb2RhbFRpdGxlLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC5geC4muC4muC4l+C4lOC4quC4reC4mic7CiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C5gOC4peC4t+C4reC4geC5geC4peC4sOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4hyc7CiAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsgLy8g4Lib4Li04LiU4Lib4Li44LmI4Lih4LmE4Lin4LmJ4LiB4LmI4Lit4LiZ4LiI4LiZ4LiB4Lin4LmI4Liy4LiI4Liw4LmA4Lil4Li34Lit4LiBCgogICAgLy8gMi4g4LmB4Liq4LiU4LiH4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiE4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Li14LmI4Lih4Li14LmD4LiZ4Lij4Liw4Lia4LiaCiAgICBpZiAoYWxsUHJvamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guKLguLHguIfguYTguKHguYjguKHguLXguYLguJvguKPguYDguIjguITguYPguKvguYnguYDguKXguLfguK3guIE8L29wdGlvbj4nOwogICAgfSBlbHNlIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKwogICAgICAgICAgICBhbGxQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KCiAgICAvLyAzLiDguYHguKrguJTguIcgTW9kYWwKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIDQuIOC4quC4o+C5ieC4suC4hyBFdmVudCBMaXN0ZW5lciDguJfguLXguYjguIjguLDguJfguLPguIfguLLguJnguYHguITguYjguITguKPguLHguYnguIfguYDguJTguLXguKLguKfguKrguLPguKvguKPguLHguJrguJvguLjguYjguKEgIuC4ouC4t+C4meC4ouC4seC4mSIKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4miBjb25maXJtSGFuZGxlciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmNvbnN0IGNvbmZpcm1IYW5kbGVyID0gYXN5bmMgKCkgPT4geyAvLyA8LS0tIOC5gOC4nuC4tOC5iOC4oSBhc3luYyDguYDguILguYnguLLguYTguJsKICAgIGNvbnN0IHNlbGVjdGVkUHJvamVjdElkID0gcHJvamVjdFNlbGVjdC52YWx1ZTsKICAgIGlmICghc2VsZWN0ZWRQcm9qZWN0SWQpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LiB4LmI4Lit4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJkKICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIDEuICjguYDguJ7guLTguYjguKEpIOC5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC5gOC4peC4t+C4reC4gQogICAgYXdhaXQgbG9hZFByb2plY3REZXRhaWxzKHNlbGVjdGVkUHJvamVjdElkKTsKCiAgICAvLyAyLiAo4LmA4Lie4Li04LmI4LihKSDguKrguLHguYjguIfguYPguKvguYnguYDguJvguKXguLXguYjguKLguJnguYTguJvguYHguKrguJTguIfguKvguJnguYnguLIgIuC4o+C4suC4ouC4peC4sOC5gOC4reC4teC4ouC4lOC5guC4m+C4o+C5gOC4iOC4hCIKICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwoKICAgIC8vIDMuIOC5gOC4o+C4tOC5iOC4oeC4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miAo4LiL4Li24LmI4LiH4LiV4Lit4LiZ4LiZ4Li14LmJ4LiI4Liw4LmB4Liq4LiU4LiH4Lic4Lil4LmD4LiZ4Lir4LiZ4LmJ4Liy4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmB4Lil4LmJ4LinKQogICAgaGFuZGxlR2VuZXJhdGVRdWl6RnJvbUJsdWVwcmludFRvcGljKHRvcGljTmFtZSk7CgogICAgLy8gNC4g4LiE4Li34LiZ4LiE4LmI4LiyIE1vZGFsIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4m+C4geC4leC4tAogICAgY2xlYW51cCgpOwp9OwovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LmC4LiE4LmJ4LiU4Liq4Liz4Lir4Lij4Lix4Lia4Lin4Liy4LiH4LiX4Lix4LiaIOKWsuKWsuKWsgoKICAgIC8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4hOC4t+C4meC4hOC5iOC4siBNb2RhbCDguYHguKXguLDguKXguJogRXZlbnQgTGlzdGVuZXIg4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4LiC4Li24LmJ4LiZ4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinCiAgICBjb25zdCBjbGVhbnVwID0gKCkgPT4gewogICAgICAgIG1vZGFsVGl0bGUudGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4Lii4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmE4Lib4LmC4Lib4Lij4LmA4LiI4LiE4Lit4Li34LmI4LiZJzsKICAgICAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4oic7CiAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1IYW5kbGVyKTsKICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKICAgICAgICAvLyAqKuC4quC4s+C4hOC4seC4jToqKiDguITguLfguJnguITguYjguLIgRXZlbnQgTGlzdGVuZXIg4LmA4LiU4Li04Lih4LiC4Lit4LiH4Lib4Li44LmI4LihICLguKLguLfguJnguKLguLHguJkiIOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4l+C4s+C4h+C4suC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oQogICAgICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtTW92ZVF1aXopOwogICAgfTsKICAgIAogICAgLy8gKirguKrguLPguITguLHguI06Kiog4LmA4Lij4Liy4LiV4LmJ4Lit4LiH4Lil4LiaIExpc3RlbmVyIOC5gOC4geC5iOC4suC4guC4reC4h+C4m+C4uOC5iOC4oSAi4Lii4Li34LiZ4Lii4Lix4LiZIiAoY29uZmlybU1vdmVRdWl6KSDguK3guK3guIHguYTguJvguIHguYjguK3guJnguIrguLHguYjguKfguITguKPguLLguKcKICAgIC8vIOC5gOC4nuC4t+C5iOC4reC4m+C5ieC4reC4h+C4geC4seC4meC5hOC4oeC5iOC5g+C4q+C5ieC5guC4hOC5ieC4lOC4l+C4s+C4h+C4suC4meC4i+C5ieC4s+C4i+C5ieC4reC4meC4geC4seC4mQogICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1Nb3ZlUXVpeik7CiAgICAKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBMaXN0ZW5lciDguYPguKvguKHguYjguYDguILguYnguLLguYTguJsKICAgIGNvbmZpcm1CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjb25maXJtSGFuZGxlcik7CiAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gc2hvd1N0dWRlbnRMaXZlUXVlc3Rpb25WaWV3KHF1ZXN0aW9uLCBpbmRleCwgdG90YWwpIHsKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgb3B0aW9uc0hUTUwgPSAnJzsKCiAgICAgICAgICAgIGlmKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScgfHwgcXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJyA/IFsn4LmD4LiK4LmIJywgJ+C5hOC4oeC5iOC5g+C4iuC5iCddIDogcXVlc3Rpb24ub3B0aW9uczsKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gb3B0aW9ucy5tYXAoKG9wdCwgaSkgPT4gYAogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pbmRleD0iJHtpfSIgY2xhc3M9ImxpdmUtYW5zd2VyLWJ0biBwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIHRleHQtY2VudGVyIGJnLXdoaXRlIHRleHQtZ3JheS04MDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1Ij4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvcHR9CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgeyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Liq4LmI4Lin4LiZ4LiZ4Li14LmJCiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zID0gcXVlc3Rpb24uYWxsUmVzcG9uc2VzIHx8IFtdOwogICAgICAgICAgICAgICAgb3B0aW9uc0hUTUwgPSBvcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWluZGV4PSIke2l9IiBjbGFzcz0ibGl2ZS1hbnN3ZXItYnRuIHAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRyYW5zaXRpb24tYWxsIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUiPgogICAgICAgICAgICAgICAgICAgICAgICAke29wdH0KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIGApLmpvaW4oJycpOwoJCQkJfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInKSB7IC8vIDwtLSDguYDguJ7guLTguYjguKHguKrguYjguKfguJnguJnguLXguYkKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSJsaXZlLXNob3J0LWFuc3dlci1pbnB1dCIgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBwLTMgYm9yZGVyIHJvdW5kZWQtbGcgdGV4dC1ncmF5LTgwMCB0ZXh0LWxnIiByb3dzPSIzIiBwbGFjZWhvbGRlcj0i4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTLi4uIj48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJsaXZlLXN1Ym1pdC1zaG9ydC1hbnN3ZXItYnRuIiBjbGFzcz0iYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LXhsIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGFwZXItcGxhbmUgbXItMiI+PC9pPuC4quC5iOC4h+C4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgIH0KCgkJCQljb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcXVlc3Rpb24uc3RlbSB8fCBxdWVzdGlvbi5xdWVzdGlvblRleHQ7IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKICAgIGNvbnN0IHN0dWRlbnRRdWVzdGlvbkhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwiPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyB0ZXh0LWNlbnRlciI+4LiC4LmJ4Lit4LiX4Li14LmIICR7aW5kZXggKyAxfSAvICR7dG90YWx9PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItOCB0ZXh0LWNlbnRlciI+JHtxdWVzdGlvbkRpc3BsYXlUZXh0fTwvaDI+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJsaXZlLW9wdGlvbnMtY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIG1heC13LTR4bCBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAke29wdGlvbnNIVE1MfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBzdHVkZW50UXVlc3Rpb25IVE1MOwoKICAgIAogICAgLy8gVHlwZXNldCBtYXRoIGFmdGVyIGluamVjdGluZyBzdHVkZW50IGxpdmUgcXVlc3Rpb24KICAgIGlmICh3aW5kb3cuTWF0aEpheCAmJiBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKSB7IE1hdGhKYXgudHlwZXNldFByb21pc2UoW2xpdmVHYW1lVmlld10pOyB9CgkKCSAvLyAtLS0gWyDguYDguKPguLTguYjguKEgXSDguYDguJ7guLTguYjguKHguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguILguYnguLLguYTguJsgLS0tCiAgICBjb25zdCBzdWJtaXRTaG9ydEFuc3dlckJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLXN1Ym1pdC1zaG9ydC1hbnN3ZXItYnRuJyk7CiAgICBpZiAoc3VibWl0U2hvcnRBbnN3ZXJCdG4pIHsKICAgICAgICBzdWJtaXRTaG9ydEFuc3dlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgYW5zd2VyVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLXNob3J0LWFuc3dlci1pbnB1dCcpLnZhbHVlOwogICAgICAgICAgICBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlclRleHQsIHF1ZXN0aW9uKTsgLy8g4Liq4LmI4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4Lie4Li04Lih4Lie4LmM4LmE4Lib4LiI4Lix4LiU4LiB4Liy4Lij4LiV4LmI4LitCiAgICAgICAgfSk7CiAgICB9CiAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJQgXSDguYDguJ7guLTguYjguKHguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguYDguILguYnguLLguYTguJsgLS0tCgkKLy8gQWRkIGV2ZW50IGxpc3RlbmVyIGZvciBzdHVkZW50IGFuc3dlcnMKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlLW9wdGlvbnMtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgIGNvbnN0IGJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5saXZlLWFuc3dlci1idG4nKTsKICAgICAgICBpZiAoYnRuKSB7CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckluZGV4ID0gcGFyc2VJbnQoYnRuLmRhdGFzZXQuaW5kZXgpOwogICAgICAgICAgICBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlckluZGV4LCBxdWVzdGlvbik7CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJTguJnguLXguYnguYDguILguYnguLLguYTguJvguYPguJkgPHNjcmlwdD4g4pa84pa84pa8CgovKioKICogW1Nob3J0Y3V0c10g4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiI4Liy4LiBIEZpcmVzdG9yZQogKi8KZnVuY3Rpb24gbGlzdGVuRm9yQmx1ZXByaW50U2hvcnRjdXRzKCkgewogICAgY29uc3Qgc2hvcnRjdXRzUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZGFzaGJvYXJkQ29uZmlnIik7CgogICAgb25TbmFwc2hvdChzaG9ydGN1dHNSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgbGV0IHNob3J0Y3V0cyA9IFtdOwogICAgICAgIGxldCB0YWJzID0gW107CiAgICAgICAgbGV0IG9yZGVyID0ge307CgogICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgc2hvcnRjdXRzID0gZGF0YS5ibHVlcHJpbnRTaG9ydGN1dHMgfHwgW107CiAgICAgICAgICAgIHRhYnMgPSBkYXRhLnNob3J0Y3V0VGFicyB8fCBbXTsKICAgICAgICAgICAgb3JkZXIgPSBkYXRhLnNob3J0Y3V0T3JkZXIgfHwge307CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRhYnMuZmluZCh0ID0+IHQuaWQgPT09ICdhbGwnKSkgewogICAgICAgICAgICB0YWJzLnVuc2hpZnQoeyBpZDogJ2FsbCcsIG5hbWU6ICfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJQnLCBpc0RlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gJ2RlZmF1bHQtMScpKSB7CiAgICAgICAgICAgIHNob3J0Y3V0cy51bnNoaWZ0KHsgaWQ6ICdkZWZhdWx0LTEnLCBuYW1lOiAnQmx1ZXByaW50IDEnLCBibHVlcHJpbnRVcmw6ICcnLCByZWZlcmVuY2VVcmw6ICcnLCBpc0RlZmF1bHQ6IHRydWUgfSk7CiAgICAgICAgfQogICAgICAgIGlmICghc2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSAnZGVmYXVsdC0yJykpIHsKICAgICAgICAgICAgc2hvcnRjdXRzLnVuc2hpZnQoeyBpZDogJ2RlZmF1bHQtMicsIG5hbWU6ICdCbHVlcHJpbnQgMicsIGJsdWVwcmludFVybDogJycsIHJlZmVyZW5jZVVybDogJycsIGlzRGVmYXVsdDogdHJ1ZSB9KTsKICAgICAgICB9CgogICAgICAgIGJsdWVwcmludFNob3J0Y3V0cyA9IHNob3J0Y3V0czsKICAgICAgICBzaG9ydGN1dFRhYnMgPSB0YWJzOwogICAgICAgIHNob3J0Y3V0T3JkZXIgPSBvcmRlcjsKCiAgICAgICAgLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC4geC4peC4seC4muC5gOC4guC5ieC4suC5hOC4myDguYDguJ7guLfguYjguK3guKrguLHguYjguIfguYPguKvguYnguKfguLLguJTguJvguLjguYjguKHguJfguLXguYjguKvguJnguYnguLIgRGFzaGJvYXJkIOC4q+C4peC4seC4geC5gOC4quC4oeC4rSDilrzilrzilrwKICAgICAgICByZW5kZXJCbHVlcHJpbnRTaG9ydGN1dHMoKTsgCiAgICAgICAgLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSDilrLilrLilrIKCiAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7CiAgICAgICAgICAgIHJlbmRlckFkZGl0aW9uYWxTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIH0KICAgIH0pOwp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAoKLyoqCiAqIFtDT1JFXSDguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguKrguLPguKvguKPguLHguJrguKfguLLguJTguKvguJnguYnguLLguJXguYjguLLguIcgTW9kYWwg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICjguYHguJfguYfguJogKyDguKPguLLguKLguIHguLLguKPguJvguLjguYjguKHguKXguLHguJQpCiAqLwpmdW5jdGlvbiByZW5kZXJBZGRpdGlvbmFsU2hvcnRjdXRzTW9kYWwoKSB7CiAgICBjb25zdCBuYXZDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtdGFicy1uYXYnKTsKICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpOwogICAgaWYgKCFuYXZDb250YWluZXIgfHwgIWxpc3RDb250YWluZXIpIHJldHVybjsKCiAgICAvLyAtLS0gMS4g4Lin4Liy4LiU4LmB4LiW4Lia4LmB4LiX4LmH4LiaIChUYWIgTmF2aWdhdGlvbikgLS0tCiAgICBuYXZDb250YWluZXIuaW5uZXJIVE1MID0gc2hvcnRjdXRUYWJzLm1hcCh0YWIgPT4gewogICAgICAgIGNvbnN0IGlzQWN0aXZlID0gdGFiLmlkID09PSBhY3RpdmVTaG9ydGN1dFRhYklkOwogICAgICAgIGNvbnN0IGFjdGl2ZUNsYXNzZXMgPSAnYm9yZGVyLWluZGlnby01MDAgdGV4dC1pbmRpZ28tNjAwJzsKICAgICAgICBjb25zdCBpbmFjdGl2ZUNsYXNzZXMgPSAnYm9yZGVyLXRyYW5zcGFyZW50IHRleHQtZ3JheS01MDAgaG92ZXI6dGV4dC1ncmF5LTcwMCBob3Zlcjpib3JkZXItZ3JheS0zMDAnOwogICAgICAgIAogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIGdyb3VwIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS10YWItaWQ9IiR7dGFiLmlkfSIgY2xhc3M9InNob3J0Y3V0LXRhYi1idG4gd2hpdGVzcGFjZS1ub3dyYXAgcHktMyBweC0yIGJvcmRlci1iLTIgZm9udC1tZWRpdW0gdGV4dC1zbSAke2lzQWN0aXZlID8gYWN0aXZlQ2xhc3NlcyA6IGluYWN0aXZlQ2xhc3Nlc30iPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0YWItbmFtZS1kaXNwbGF5IHBvaW50ZXItZXZlbnRzLW5vbmUiPiR7dGFiLm5hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiB2YWx1ZT0iJHt0YWIubmFtZX0iIGNsYXNzPSJ0YWItbmFtZS1pbnB1dCBoaWRkZW4gYmctdHJhbnNwYXJlbnQgYm9yZGVyLWItMiBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LXNtIGZvbnQtbWVkaXVtIGZvY3VzOm91dGxpbmUtbm9uZSB3LTMyIj4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgJHshdGFiLmlzRGVmYXVsdCA/IGAKICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtdGFiLWlkPSIke3RhYi5pZH0iIGNsYXNzPSJkZWxldGUtc2hvcnRjdXQtdGFiLWJ0biBhYnNvbHV0ZSAtdG9wLTEgLXJpZ2h0LTEgdGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTcwMCBvcGFjaXR5LTAgZ3JvdXAtaG92ZXI6b3BhY2l0eS0xMDAgdHJhbnNpdGlvbi1vcGFjaXR5IHJvdW5kZWQtZnVsbCBiZy13aGl0ZSB0ZXh0LWxnIHctNSBoLTUgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiIHRpdGxlPSLguKXguJrguYHguJfguYfguJrguJnguLXguYkiPgogICAgICAgICAgICAgICAgICAgICAgICAmdGltZXM7CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICBgIDogJyd9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9KS5qb2luKCcnKTsKCiAgICAvLyAtLS0gMi4g4LiB4Lij4Lit4LiH4LmB4Lil4Liw4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiV4Liy4Lih4LmB4LiX4LmH4Lia4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBIC0tLQogICAgY29uc3QgYWN0aXZlVGFiID0gc2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSBhY3RpdmVTaG9ydGN1dFRhYklkKTsKICAgIGxldCBzaG9ydGN1dHNUb1Nob3cgPSBbXTsKCiAgICBpZiAoYWN0aXZlVGFiKSB7CiAgICAgICAgaWYgKGFjdGl2ZVRhYi5pc0RlZmF1bHQpIHsgLy8g4LmB4LiX4LmH4LiaICLguJfguLHguYnguIfguKvguKHguJQiCiAgICAgICAgICAgIHNob3J0Y3V0c1RvU2hvdyA9IFsuLi5ibHVlcHJpbnRTaG9ydGN1dHNdOwogICAgICAgIH0gZWxzZSB7IC8vIOC5geC4l+C5h+C4muC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5gOC4reC4hwogICAgICAgICAgICBjb25zdCBzaG9ydGN1dElkc0luVGFiID0gYWN0aXZlVGFiLnNob3J0Y3V0SWRzIHx8IFtdOwogICAgICAgICAgICBzaG9ydGN1dHNUb1Nob3cgPSBibHVlcHJpbnRTaG9ydGN1dHMuZmlsdGVyKHMgPT4gc2hvcnRjdXRJZHNJblRhYi5pbmNsdWRlcyhzLmlkKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyDguIjguLHguJTguYDguKPguLXguKLguIfguJXguLLguKHguKXguLPguJTguLHguJrguJfguLXguYjguJzguLnguYnguYPguIrguYnguKXguLLguIHguKfguLLguIcKICAgIGNvbnN0IGN1cnJlbnRPcmRlciA9IHNob3J0Y3V0T3JkZXJbYWN0aXZlU2hvcnRjdXRUYWJJZF0gfHwgW107CiAgICBzaG9ydGN1dHNUb1Nob3cuc29ydCgoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGluZGV4QSA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGEuaWQpOwogICAgICAgIGNvbnN0IGluZGV4QiA9IGN1cnJlbnRPcmRlci5pbmRleE9mKGIuaWQpOwogICAgICAgIGlmIChpbmRleEEgPT09IC0xKSByZXR1cm4gMTsKICAgICAgICBpZiAoaW5kZXhCID09PSAtMSkgcmV0dXJuIC0xOwogICAgICAgIHJldHVybiBpbmRleEEgLSBpbmRleEI7CiAgICB9KTsKCiAgICAvLyAtLS0gMy4g4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4Liq4Liz4Lir4Lij4Lix4Lia4Lij4Liy4Lii4LiB4Liy4Lij4Lib4Li44LmI4Lih4Lil4Lix4LiUIC0tLQogICAgbGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBzaG9ydGN1dHNUb1Nob3cubGVuZ3RoID4gMCA/IHNob3J0Y3V0c1RvU2hvdy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGxldCBpY29uID0gJ/Cfp6knOwogICAgICAgIGlmIChzaG9ydGN1dC5ibHVlcHJpbnRVcmwgJiYgc2hvcnRjdXQucmVmZXJlbmNlVXJsKSBpY29uID0gJ/Cfk5cnOwogICAgICAgIGVsc2UgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCkgaWNvbiA9ICfwn5OYJzsKCiAgICAgICAgY29uc3Qgb3RoZXJUYWJzID0gc2hvcnRjdXRUYWJzLmZpbHRlcih0ID0+ICF0LmlzRGVmYXVsdCk7CmNvbnN0IG1vdmVEcm9wZG93bkhUTUwgPSBhY3RpdmVUYWIuaXNEZWZhdWx0ICYmIG90aGVyVGFicy5sZW5ndGggPiAwID8gYAogICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgaW5saW5lLWJsb2NrIHRleHQtbGVmdCBncm91cC9kcm9wZG93biI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibW92ZS1zaG9ydGN1dC1tZW51LWJ0biB0ZXh0LWdyYXktNTAwIGhvdmVyOnRleHQtYmx1ZS03MDAgcC0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIj48aSBjbGFzcz0iZmFzIGZhLWVsbGlwc2lzLXYiPjwvaT48L2J1dHRvbj4KICAgICAgICA8ZGl2IGNsYXNzPSJtb3ZlLXNob3J0Y3V0LWRyb3Bkb3duIG9yaWdpbi10b3AtcmlnaHQgYWJzb2x1dGUgcmlnaHQtMCBtdC0yIHctNDggcm91bmRlZC1tZCBzaGFkb3ctbGcgYmctd2hpdGUgcmluZy0xIHJpbmctYmxhY2sgcmluZy1vcGFjaXR5LTUgaGlkZGVuIHotMjAiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJweS0xIiByb2xlPSJtZW51Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InB4LTQgcHQtMSBwYi0yIHRleHQteHMgdGV4dC1ncmF5LTQwMCI+4LmA4Lie4Li04LmI4Lih4LmE4Lib4Lii4Lix4LiH4LmB4LiX4LmH4LiaOjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtvdGhlclRhYnMubWFwKHRhYiA9PiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSIjIiBjbGFzcz0ibW92ZS1zaG9ydGN1dC1pdGVtIGJsb2NrIHB4LTQgcHktMiB0ZXh0LXNtIHRleHQtZ3JheS03MDAgaG92ZXI6YmctZ3JheS0xMDAiIGRhdGEtc2hvcnRjdXQtaWQ9IiR7c2hvcnRjdXQuaWR9IiBkYXRhLXRhcmdldC10YWItaWQ9IiR7dGFiLmlkfSI+JHt0YWIubmFtZX08L2E+CiAgICAgICAgICAgICAgICAgICAgICAgIGApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGAgOiAnJzsKCiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic2hvcnRjdXQtbGlzdC1pdGVtIHAtMyBib3JkZXItYiBob3ZlcjpiZy1ncmF5LTUwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiIgZGF0YS1zaG9ydGN1dC1pZD0iJHtzaG9ydGN1dC5pZH0iIGRyYWdnYWJsZT0idHJ1ZSI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtYmx1ZS03MDAiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJ1c2UtaGlkZGVuLXNob3J0Y3V0LWJ0biBiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctYmx1ZS0yMDAiPuC5g+C4iuC5ieC4h+C4suC4mTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJlZGl0LWhpZGRlbi1zaG9ydGN1dC1idG4gYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy15ZWxsb3ctMjAwIj7guYHguIHguYnguYTguII8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAkeyFzaG9ydGN1dC5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImRlbGV0ZS1oaWRkZW4tc2hvcnRjdXQtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCI+4Lil4LiaPC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICR7IWFjdGl2ZVRhYi5pc0RlZmF1bHQgPyBgPGJ1dHRvbiBkYXRhLXNob3J0Y3V0LWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InJlbW92ZS1zaG9ydGN1dC1mcm9tLXRhYi1idG4gdGV4dC1yZWQtNTAwIG1sLTIiIHRpdGxlPSLguJnguLPguK3guK3guIHguIjguLLguIHguYHguJfguYfguJrguJnguLXguYkiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIj48L2k+PC9idXR0b24+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICR7bW92ZURyb3Bkb3duSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJykgOiAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguJvguLjguYjguKHguKXguLHguJTguYPguJnguYHguJfguYfguJrguJnguLXguYk8L3A+JzsKICAgIAogICAgLy8gNC4g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4Lie4Li34LmI4Lit4Lic4Li54LiBIEV2ZW50IExpc3RlbmVycyDguYPguKvguYnguIHguLHguJrguJvguLjguYjguKHguYHguKXguLDguKPguLLguKLguIHguLLguKPguJfguLXguYjguKrguKPguYnguLLguIfguILguLbguYnguJnguYPguKvguKHguYgKICAgIHNldHVwU2hvcnRjdXRNb2RhbEV2ZW50TGlzdGVuZXJzKCk7Cn0KCi8qKgogKiDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguJzguLnguIEgRXZlbnQgTGlzdGVuZXIg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Lig4Liy4Lii4LmD4LiZIE1vZGFsCiAqLwpmdW5jdGlvbiBzZXR1cFNob3J0Y3V0TW9kYWxFdmVudExpc3RlbmVycygpIHsKICAgIC8vIOC4quC4peC4seC4muC5geC4l+C5h+C4mgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LXRhYi1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7CiAgICAgICAgICAgIGFjdGl2ZVNob3J0Y3V0VGFiSWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC50YWJJZDsKICAgICAgICAgICAgcmVuZGVyQWRkaXRpb25hbFNob3J0Y3V0c01vZGFsKCk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2RibGNsaWNrJywgZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGUuY3VycmVudFRhcmdldDsKICAgICAgICAgICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1kaXNwbGF5JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy50YWItbmFtZS1pbnB1dCcpOwogICAgICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgaW5wdXQuc2VsZWN0KCk7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyDguJrguLHguJnguJfguLbguIHguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguIrguLfguYjguK3guYHguJfguYfguJoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWItbmFtZS1pbnB1dCcpLmZvckVhY2goaW5wdXQgPT4gewogICAgICAgIGNvbnN0IHNhdmUgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRhYklkID0gaW5wdXQuY2xvc2VzdCgnLnNob3J0Y3V0LXRhYi1idG4nKS5kYXRhc2V0LnRhYklkOwogICAgICAgICAgICBoYW5kbGVSZW5hbWVTaG9ydGN1dFRhYih0YWJJZCwgaW5wdXQudmFsdWUpOwogICAgICAgIH07CiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIHNhdmUpOwogICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHsgaWYgKGUua2V5ID09PSAnRW50ZXInKSBpbnB1dC5ibHVyKCk7IH0pOwogICAgfSk7CiAgICAKICAgIC8vIOC4peC4muC5geC4l+C5h+C4mgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGV0ZS1zaG9ydGN1dC10YWItYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gaGFuZGxlRGVsZXRlU2hvcnRjdXRUYWIoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQudGFiSWQpKTsKICAgIH0pOwoKICAgIC8vIOC4ouC5ieC4suC4ouC4m+C4uOC5iOC4oeC4peC4seC4lOC5hOC4m+C5geC4l+C5h+C4muC4reC4t+C5iOC4mSAo4LmA4Lih4Li34LmI4Lit4LiE4Lil4Li04LiB4LiX4Li14LmI4LiK4Li34LmI4Lit4LmB4LiX4LmH4Lia4LmD4LiZ4LmA4Lih4LiZ4Li5IERyb3Bkb3duKQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtaXRlbScpLmZvckVhY2goaXRlbSA9PiB7CiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIGNvbnN0IHsgc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQgfSA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0OwogICAgICAgICAgICBoYW5kbGVNb3ZlU2hvcnRjdXRUb1RhYihzaG9ydGN1dElkLCB0YXJnZXRUYWJJZCk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgIAogICAgLy8g4LiZ4Liz4Lib4Li44LmI4Lih4Lil4Lix4LiU4Lit4Lit4LiB4LiI4Liy4LiB4LmB4LiX4LmH4Lia4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVtb3ZlLXNob3J0Y3V0LWZyb20tdGFiLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHsKICAgICAgICAgICAgaGFuZGxlUmVtb3ZlU2hvcnRjdXRGcm9tVGFiKGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnNob3J0Y3V0SWQsIGFjdGl2ZVNob3J0Y3V0VGFiSWQpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8g4LiI4Lix4LiU4LiB4Liy4Lij4Lib4Li44LmI4LihICLguYPguIrguYnguIfguLLguJkiLCAi4LmB4LiB4LmJ4LmE4LiCIiwgIuC4peC4miIgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIGNvbnN0IGxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpOwogICAgbGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcudXNlLWhpZGRlbi1zaG9ydGN1dC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgaGFuZGxlU2hvcnRjdXRDbGljayhidG4uZGF0YXNldC5pZCk7CiAgICAgICAgfSk7CiAgICB9KTsKICAgIC8vICjguYLguITguYnguJTguKrguLPguKvguKPguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiH4Lib4Li44LmI4LihIGVkaXQg4LmB4Lil4LiwIGRlbGV0ZSDguJfguLXguYjguYDguKvguKXguLfguK3guYPguJnguKrguYjguKfguJnguJnguLXguYnguIjguLDguJfguLPguIfguLLguJnguJXguLLguKHguJvguIHguJXguLQpCgoKICAgIC8vIOC4iOC4seC4lOC4geC4suC4oyBEcmFnLWFuZC1Ecm9wICjguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBsZXQgZHJhZ2dlZEl0ZW0gPSBudWxsOwogICAgbGlzdENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHsKICAgICAgICBkcmFnZ2VkSXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1saXN0LWl0ZW0nKTsKICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QuYWRkKCdvcGFjaXR5LTUwJyksIDApOwogICAgICAgIH0KICAgIH0pOwogICAgbGlzdENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgKCkgPT4gewogICAgICAgIGlmIChkcmFnZ2VkSXRlbSkgewogICAgICAgICAgICBkcmFnZ2VkSXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7CiAgICAgICAgICAgIGRyYWdnZWRJdGVtID0gbnVsbDsKICAgICAgICB9CiAgICB9KTsKICAgIGxpc3RDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY29uc3QgYWZ0ZXJFbGVtZW50ID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbTpub3QoLm9wYWNpdHktNTApJyldLnJlZHVjZSgoY2xvc2VzdCwgY2hpbGQpID0+IHsKICAgICAgICAgICAgY29uc3QgYm94ID0gY2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IGUuY2xpZW50WSAtIGJveC50b3AgLSBib3guaGVpZ2h0IC8gMjsKICAgICAgICAgICAgcmV0dXJuIChvZmZzZXQgPCAwICYmIG9mZnNldCA+IGNsb3Nlc3Qub2Zmc2V0KSA/IHsgb2Zmc2V0OiBvZmZzZXQsIGVsZW1lbnQ6IGNoaWxkIH0gOiBjbG9zZXN0OwogICAgICAgIH0sIHsgb2Zmc2V0OiBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkgfSkuZWxlbWVudDsKICAgICAgICAKICAgICAgICBpZiAoYWZ0ZXJFbGVtZW50ID09IG51bGwpIHsKICAgICAgICAgICAgbGlzdENvbnRhaW5lci5hcHBlbmRDaGlsZChkcmFnZ2VkSXRlbSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGlzdENvbnRhaW5lci5pbnNlcnRCZWZvcmUoZHJhZ2dlZEl0ZW0sIGFmdGVyRWxlbWVudCk7CiAgICAgICAgfQogICAgfSk7CiAgICBsaXN0Q29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlID0+IHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgaWYgKGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld09yZGVyID0gWy4uLmxpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnNob3J0Y3V0LWxpc3QtaXRlbScpXS5tYXAoaXRlbSA9PiBpdGVtLmRhdGFzZXQuc2hvcnRjdXRJZCk7CiAgICAgICAgICAgIGhhbmRsZVNob3J0Y3V0T3JkZXJDaGFuZ2UoYWN0aXZlU2hvcnRjdXRUYWJJZCwgbmV3T3JkZXIpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCL+C5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iF0gLS0tCiAgICAvLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYDguJ7guLfguYjguK3guYDguJvguLTguJQv4Lib4Li04LiU4LmA4Lih4LiZ4Li5ICLguKLguYnguLLguKIiCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1zaG9ydGN1dC1tZW51LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LmE4Lih4LmI4LmD4Lir4LmJIGV2ZW50IOC4geC4suC4o+C4hOC4peC4tOC4geC4geC4o+C4sOC4iOC4suC4ouC5hOC4m+C4l+C4teC5iOC4reC4t+C5iOC4mQogICAgICAgICAgICBjb25zdCBkcm9wZG93biA9IGUuY3VycmVudFRhcmdldC5uZXh0RWxlbWVudFNpYmxpbmc7CiAgICAgICAgICAgIGNvbnN0IGlzQ3VycmVudGx5SGlkZGVuID0gZHJvcGRvd24uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKTsKCiAgICAgICAgICAgIC8vIOC4m+C4tOC4lOC5gOC4oeC4meC4ueC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguIHguYjguK3guJkKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtZHJvcGRvd24nKS5mb3JFYWNoKGQgPT4gZC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CgogICAgICAgICAgICAvLyDguJbguYnguLLguYDguKHguJnguLnguJfguLXguYjguITguKXguLTguIHguIHguLPguKXguLHguIfguIvguYjguK3guJnguK3guKLguLnguYgg4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4LiC4Li24LmJ4LiZ4Lih4LiyCiAgICAgICAgICAgIGlmIChpc0N1cnJlbnRseUhpZGRlbikgewogICAgICAgICAgICAgICAgZHJvcGRvd24uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwp9CgovLyDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4LiB4Lix4Lia4Lir4LiZ4LmJ4Liy4LmA4Lin4LmH4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOC5gOC4nuC4t+C5iOC4reC4m+C4tOC4lOC5gOC4oeC4meC4ueC5gOC4oeC4t+C5iOC4reC4hOC4peC4tOC4geC4l+C4teC5iOC4muC4o+C4tOC5gOC4p+C4k+C4reC4t+C5iOC4mQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAvLyDguJbguYnguLLguYTguKHguYjguYTguJTguYnguITguKXguLTguIHguJfguLXguYjguJrguKPguLTguYDguKfguJPguYDguKHguJnguLkg4LmD4Lir4LmJ4LiL4LmI4Lit4LiZ4LmA4Lih4LiZ4Li54LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5ncm91cFxcL2Ryb3Bkb3duJykpIHsKICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtc2hvcnRjdXQtZHJvcGRvd24nKS5mb3JFYWNoKGQgPT4gZC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICB9Cn0pOwoKLyoqCiAqIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4muC4seC4meC4l+C4tuC4geC4guC5ieC4reC4oeC4ueC4peC5geC4l+C5h+C4muC5geC4peC4sOC4peC4s+C4lOC4seC4muC4peC4hyBGaXJlc3RvcmUKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVTaG9ydGN1dENvbmZpZygpIHsKICAgIGNvbnN0IGNvbmZpZ1JlZiA9IGRvYyhkYiwgImdsb2JhbFNldHRpbmdzIiwgImRhc2hib2FyZENvbmZpZyIpOwogICAgdHJ5IHsKICAgICAgICBhd2FpdCBzZXREb2MoY29uZmlnUmVmLCB7IAogICAgICAgICAgICBzaG9ydGN1dFRhYnM6IHNob3J0Y3V0VGFicywKICAgICAgICAgICAgc2hvcnRjdXRPcmRlcjogc2hvcnRjdXRPcmRlcgogICAgICAgIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBzaG9ydGN1dCBjb25maWc6IiwgZXJyb3IpOwogICAgfQp9CgovLyDguJ/guLHguIfguIHguYzguIrguLHguJnguIjguLHguJTguIHguLLguKPguYHguJfguYfguJrguYHguKXguLDguJvguLjguYjguKHguKXguLHguJQKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRkU2hvcnRjdXRUYWIoKSB7CiAgICBjb25zdCBuYW1lID0gcHJvbXB0KCLguIHguKPguLjguJPguLLguJXguLHguYnguIfguIrguLfguYjguK3guYHguJfguYfguJrguYPguKvguKHguYg6IiwgIuC5geC4l+C5h+C4muC5g+C4q+C4oeC5iCIpOwogICAgaWYgKCFuYW1lIHx8IG5hbWUudHJpbSgpID09PSAnJykgcmV0dXJuOwogICAgc2hvcnRjdXRUYWJzLnB1c2goeyBpZDogYHRhYl8ke0RhdGUubm93KCl9YCwgbmFtZTogbmFtZS50cmltKCksIHNob3J0Y3V0SWRzOiBbXSB9KTsKICAgIGF3YWl0IHNhdmVTaG9ydGN1dENvbmZpZygpOwp9CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlbmFtZVNob3J0Y3V0VGFiKHRhYklkLCBuZXdOYW1lKSB7CiAgICBjb25zdCB0YWIgPSBzaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHRhYklkKTsKICAgIGlmICh0YWIgJiYgbmV3TmFtZS50cmltKCkgIT09ICcnKSB7CiAgICAgICAgdGFiLm5hbWUgPSBuZXdOYW1lLnRyaW0oKTsKICAgICAgICBhd2FpdCBzYXZlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBoYW5kbGVEZWxldGVTaG9ydGN1dFRhYih0YWJJZCkgewogICAgY29uc3QgdGFiID0gc2hvcnRjdXRUYWJzLmZpbmQodCA9PiB0LmlkID09PSB0YWJJZCk7CiAgICBpZiAodGFiICYmICF0YWIuaXNEZWZhdWx0KSB7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4LiX4LmH4LiaICIke3RhYi5uYW1lfSI/ICjguJvguLjguYjguKHguKXguLHguJTguIjguLDguYTguKHguYjguJbguLnguIHguKXguJopYCwgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBzaG9ydGN1dFRhYnMgPSBzaG9ydGN1dFRhYnMuZmlsdGVyKHQgPT4gdC5pZCAhPT0gdGFiSWQpOwogICAgICAgICAgICBkZWxldGUgc2hvcnRjdXRPcmRlclt0YWJJZF07CiAgICAgICAgICAgIGlmIChhY3RpdmVTaG9ydGN1dFRhYklkID09PSB0YWJJZCkgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyDguIHguKXguLHguJrguYTguJvguYHguJfguYfguJrguKvguKXguLHguIEKICAgICAgICAgICAgYXdhaXQgc2F2ZVNob3J0Y3V0Q29uZmlnKCk7CiAgICAgICAgfSk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlTW92ZVNob3J0Y3V0VG9UYWIoc2hvcnRjdXRJZCwgdGFyZ2V0VGFiSWQpIHsKICAgIGNvbnN0IHRhcmdldFRhYiA9IHNob3J0Y3V0VGFicy5maW5kKHQgPT4gdC5pZCA9PT0gdGFyZ2V0VGFiSWQpOwogICAgaWYgKHRhcmdldFRhYiAmJiAhdGFyZ2V0VGFiLnNob3J0Y3V0SWRzLmluY2x1ZGVzKHNob3J0Y3V0SWQpKSB7CiAgICAgICAgdGFyZ2V0VGFiLnNob3J0Y3V0SWRzLnB1c2goc2hvcnRjdXRJZCk7CiAgICAgICAgYXdhaXQgc2F2ZVNob3J0Y3V0Q29uZmlnKCk7CiAgICB9Cn0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmVtb3ZlU2hvcnRjdXRGcm9tVGFiKHNob3J0Y3V0SWQsIHNvdXJjZVRhYklkKSB7CiAgICBjb25zdCBzb3VyY2VUYWIgPSBzaG9ydGN1dFRhYnMuZmluZCh0ID0+IHQuaWQgPT09IHNvdXJjZVRhYklkKTsKICAgIGlmIChzb3VyY2VUYWIgJiYgIXNvdXJjZVRhYi5pc0RlZmF1bHQpIHsKICAgICAgICBzb3VyY2VUYWIuc2hvcnRjdXRJZHMgPSBzb3VyY2VUYWIuc2hvcnRjdXRJZHMuZmlsdGVyKGlkID0+IGlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICBhd2FpdCBzYXZlU2hvcnRjdXRDb25maWcoKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBoYW5kbGVTaG9ydGN1dE9yZGVyQ2hhbmdlKHRhYklkLCBuZXdPcmRlcikgewogICAgc2hvcnRjdXRPcmRlclt0YWJJZF0gPSBuZXdPcmRlcjsKICAgIGF3YWl0IHNhdmVTaG9ydGN1dENvbmZpZygpOwp9CgovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiK4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKZnVuY3Rpb24gcmVuZGVyQmx1ZXByaW50U2hvcnRjdXRzKCkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zaG9ydGN1dC1jb250YWluZXInKTsKICAgIGNvbnN0IGFkZGl0aW9uYWxMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtc2hvcnRjdXRzLWxpc3QnKTsKICAgIGNvbnN0IGxvYWRpbmdNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXRzLWxvYWRpbmctbXNnJyk7CgogICAgaWYgKGxvYWRpbmdNc2cpIHsKICAgICAgICBsb2FkaW5nTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfQogICAgaWYgKCFjb250YWluZXIgfHwgIWFkZGl0aW9uYWxMaXN0KSByZXR1cm47CgogICAgY29uc3QgdmlzaWJsZVNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5zbGljZSgwLCA0KTsKICAgIGNvbnN0IGhpZGRlblNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5zbGljZSg0KTsKCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdmlzaWJsZVNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgIGxldCBiZ0NvbG9yID0gJ2JnLWdyYXktMjAwIGhvdmVyOmJnLWdyYXktMzAwIHRleHQtZ3JheS03MDAnOwogICAgICAgIGxldCBpY29uID0gJ/Cfp6knOwogICAgICAgIAogICAgICAgIGlmIChzaG9ydGN1dC5ibHVlcHJpbnRVcmwgJiYgc2hvcnRjdXQucmVmZXJlbmNlVXJsKSB7CiAgICAgICAgICAgIGJnQ29sb3IgPSAnYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlJzsKICAgICAgICAgICAgaWNvbiA9ICfwn5OXJzsKICAgICAgICB9IGVsc2UgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCkgewogICAgICAgICAgICBiZ0NvbG9yID0gJ2JnLWJsdWUtNTAwIGhvdmVyOmJnLWJsdWUtNjAwIHRleHQtd2hpdGUnOwogICAgICAgICAgICBpY29uID0gJ/Cfk5gnOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVsZXRlQnRuSHRtbCA9ICFzaG9ydGN1dC5pc0RlZmF1bHQgPyAKICAgICAgICAgICAgYDxidXR0b24gZGF0YS1pZD0iJHtzaG9ydGN1dC5pZH0iIGNsYXNzPSJkZWxldGUtc2hvcnRjdXQtYnRuIGFic29sdXRlIHRvcC0xIHJpZ2h0LTEgdy02IGgtNiBiZy1yZWQtNTAwIHRleHQtd2hpdGUgcm91bmRlZC1mdWxsIHRleHQteHMgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eSIgdGl0bGU9IuC4peC4miI+JnRpbWVzOzwvYnV0dG9uPmAgOiAnJzsKCiAgICAgICAgLy8gKioqIFNUQVJUOiDguYHguIHguYnguYTguILguILguJnguLLguJTguJvguLjguYjguKHguJXguKPguIfguJnguLXguYkgKioqCiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVsYXRpdmUgZ3JvdXAiPgogICAgICAgICAgICAgICAgPGRpdiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InNob3J0Y3V0LWJ0biByb3VuZGVkLTJ4bCBzaGFkb3ctbGcgcC00IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgY3Vyc29yLXBvaW50ZXIgdHJhbnNpdGlvbiB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IGgtMjQgJHtiZ0NvbG9yfSI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InBvaW50ZXItZXZlbnRzLW5vbmUiPiR7aWNvbn0gJHtzaG9ydGN1dC5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtc2hvcnRjdXQtYnRuIGFic29sdXRlIGJvdHRvbS0xIHJpZ2h0LTEgdy02IGgtNiBiZy13aGl0ZS81MCB0ZXh0LWdyYXktODAwIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIG9wYWNpdHktMCBncm91cC1ob3ZlcjpvcGFjaXR5LTEwMCB0cmFuc2l0aW9uLW9wYWNpdHkiIHRpdGxlPSLguYHguIHguYnguYTguIIiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAke2RlbGV0ZUJ0bkh0bWx9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgLy8gKioqIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LiC4LiZ4Liy4LiUICoqKgogICAgfSkuam9pbignJyk7CgogICAgaWYgKGhpZGRlblNob3J0Y3V0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gKioqIFNUQVJUOiDguYHguIHguYnguYTguILguILguJnguLLguJTguJvguLjguYjguKEgIuC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oSIg4LiV4Lij4LiH4LiZ4Li14LmJICoqKgogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgKz0gYAogICAgICAgICAgICA8ZGl2IGlkPSJvcGVuLWFkZGl0aW9uYWwtc2hvcnRjdXRzLWJ0biIgY2xhc3M9InJvdW5kZWQtMnhsIHNoYWRvdy1sZyBwLTQgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIgZm9udC1zZW1pYm9sZCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgaC0yNCBiZy1ncmF5LTEwMCBob3ZlcjpiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNjAwIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZWxsaXBzaXMtaCB0ZXh0LXhsIj48L2k+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibXQtMiB0ZXh0LXNtIj7guJvguLjguYjguKHguKXguLHguJTguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICAgICAgLy8gKioqIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LiC4LiZ4Liy4LiUICoqKgogICAgfQoKICAgIGlmIChoaWRkZW5TaG9ydGN1dHMubGVuZ3RoID4gMCkgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9IGhpZGRlblNob3J0Y3V0cy5tYXAoc2hvcnRjdXQgPT4gewogICAgICAgICAgICBsZXQgaWNvbiA9ICfwn6epJzsKICAgICAgICAgICAgaWYgKHNob3J0Y3V0LmJsdWVwcmludFVybCAmJiBzaG9ydGN1dC5yZWZlcmVuY2VVcmwpIHsKICAgICAgICAgICAgICAgIGljb24gPSAn8J+Tlyc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2hvcnRjdXQuYmx1ZXByaW50VXJsKSB7CiAgICAgICAgICAgICAgICBpY29uID0gJ/Cfk5gnOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTcwMCI+JHtpY29ufSAke3Nob3J0Y3V0Lm5hbWV9PC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9InVzZS1oaWRkZW4tc2hvcnRjdXQtYnRuIGJnLWJsdWUtMTAwIHRleHQtYmx1ZS03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1ibHVlLTIwMCI+4LmD4LiK4LmJ4LiH4Liy4LiZPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3Nob3J0Y3V0LmlkfSIgY2xhc3M9ImVkaXQtaGlkZGVuLXNob3J0Y3V0LWJ0biBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTcwMCB0ZXh0LXNtIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXllbGxvdy0yMDAiPuC5geC4geC5ieC5hOC4gjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICR7IXNob3J0Y3V0LmlzRGVmYXVsdCA/IGA8YnV0dG9uIGRhdGEtaWQ9IiR7c2hvcnRjdXQuaWR9IiBjbGFzcz0iZGVsZXRlLWhpZGRlbi1zaG9ydGN1dC1idG4gYmctcmVkLTEwMCB0ZXh0LXJlZC03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtMjAwIj7guKXguJo8L2J1dHRvbj5gIDogJyd9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSkuam9pbignJyk7CiAgICB9IGVsc2UgewogICAgICAgIGFkZGl0aW9uYWxMaXN0LmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4oeC4teC4m+C4uOC5iOC4oeC4peC4seC4lOC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oTwvcD4nOwogICAgfQp9CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAovKioKICogW0hlbHBlcl0g4LmB4Lib4Lil4LiH4LiK4Li34LmI4Lit4LmE4Lif4Lil4LmM4LmA4Lib4LmH4LiZIE1JTUUgVHlwZSDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICovCmZ1bmN0aW9uIGdldE1pbWVUeXBlRnJvbUZpbGVuYW1lKGZpbGVuYW1lKSB7CiAgICBjb25zdCBleHRlbnNpb24gPSBmaWxlbmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7CiAgICBzd2l0Y2ggKGV4dGVuc2lvbikgewogICAgICAgIGNhc2UgJ3BkZic6CiAgICAgICAgICAgIHJldHVybiAnYXBwbGljYXRpb24vcGRmJzsKICAgICAgICBjYXNlICd0eHQnOgogICAgICAgICAgICByZXR1cm4gJ3RleHQvcGxhaW4nOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIC8vIOC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBwZGYg4LiW4LmJ4Liy4LmE4Lih4LmI4Lij4Li54LmJ4LiI4Lix4LiBIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5guC4reC4geC4suC4quC4l+C4s+C4h+C4suC4meC5hOC4lOC5ieC4oeC4suC4geC4l+C4teC5iOC4quC4uOC4lAogICAgICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL3BkZic7CiAgICB9Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCmZ1bmN0aW9uIG9wZW5TaG9ydGN1dEVkaXRvcihzaG9ydGN1dElkID0gbnVsbCkgewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtZWRpdG9yLW1vZGFsJyk7CiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1tb2RhbC10aXRsZScpOwogICAgY29uc3QgaWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1pZC1pbnB1dCcpOwogICAgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LW5hbWUtaW5wdXQnKTsKICAgIGNvbnN0IGJsdWVwcmludFVybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LWJsdWVwcmludC11cmwtaW5wdXQnKTsKICAgIGNvbnN0IHJlZmVyZW5jZVVybElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LXJlZmVyZW5jZS11cmwtaW5wdXQnKTsKCiAgICBpZiAoc2hvcnRjdXRJZCkgewogICAgICAgIC8vIOC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4ggogICAgICAgIGNvbnN0IHNob3J0Y3V0ID0gYmx1ZXByaW50U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgICAgICBpZiAoIXNob3J0Y3V0KSByZXR1cm47CiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmB4LiB4LmJ4LmE4LiC4Lib4Li44LmI4Lih4Lil4Lix4LiUJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gc2hvcnRjdXQuaWQ7CiAgICAgICAgbmFtZUlucHV0LnZhbHVlID0gc2hvcnRjdXQubmFtZTsKICAgICAgICBibHVlcHJpbnRVcmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LmJsdWVwcmludFVybCB8fCAnJzsKICAgICAgICByZWZlcmVuY2VVcmxJbnB1dC52YWx1ZSA9IHNob3J0Y3V0LnJlZmVyZW5jZVVybCB8fCAnJzsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LmC4Lir4Lih4LiU4LmA4Lie4Li04LmI4Lih4LmD4Lir4Lih4LmICiAgICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmD4Lir4Lih4LmIJzsKICAgICAgICBpZElucHV0LnZhbHVlID0gJyc7IC8vIOC4m+C4peC5iOC4reC4ouC4p+C5iOC4suC4h+C5hOC4p+C5ieC5gOC4nuC4t+C5iOC4reC4quC4o+C5ieC4suC4hyBJRCDguYPguKvguKHguYgKICAgICAgICBuYW1lSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICBibHVlcHJpbnRVcmxJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIHJlZmVyZW5jZVVybElucHV0LnZhbHVlID0gJyc7CiAgICB9CiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKLyoqCiAqIFtTaG9ydGN1dHNdIOC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC5geC4m+C4peC4h+C4iOC4suC4gSBNb2RhbCDguKXguIcgRmlyZWJhc2UKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVTaG9ydGN1dENoYW5nZXMoKSB7CiAgICBjb25zdCBpZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1pZC1pbnB1dCcpLnZhbHVlOwogICAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1uYW1lLWlucHV0JykudmFsdWUudHJpbSgpOwogICAgY29uc3QgYmx1ZXByaW50VXJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LWJsdWVwcmludC11cmwtaW5wdXQnKS52YWx1ZS50cmltKCk7CgogICAgaWYgKCFuYW1lIHx8ICFibHVlcHJpbnRVcmwpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiBICfguIrguLfguYjguK3guJvguLjguYjguKHguKXguLHguJQnIOC5geC4peC4sCAn4Lil4Li04LiH4LiB4LmMIFRlc3QgQmx1ZXByaW50JyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBuZXdTaG9ydGN1dERhdGEgPSB7CiAgICAgICAgaWQ6IGlkIHx8IGBzaG9ydGN1dF8ke0RhdGUubm93KCl9YCwKICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgIGJsdWVwcmludFVybDogYmx1ZXByaW50VXJsLAogICAgICAgIHJlZmVyZW5jZVVybDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3J0Y3V0LXJlZmVyZW5jZS11cmwtaW5wdXQnKS52YWx1ZS50cmltKCksCiAgICAgICAgaXNEZWZhdWx0OiBpZC5zdGFydHNXaXRoKCdkZWZhdWx0LScpCiAgICB9OwoKICAgIGxldCB1cGRhdGVkU2hvcnRjdXRzOwogICAgaWYgKGlkKSB7CiAgICAgICAgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5tYXAocyA9PiBzLmlkID09PSBpZCA/IG5ld1Nob3J0Y3V0RGF0YSA6IHMpOwogICAgfSBlbHNlIHsKICAgICAgICB1cGRhdGVkU2hvcnRjdXRzID0gWy4uLmJsdWVwcmludFNob3J0Y3V0cywgbmV3U2hvcnRjdXREYXRhXTsKICAgIH0KCiAgICB0cnkgewogICAgICAgIC8vIOC5gOC4m+C4peC4teC5iOC4ouC4mSBwYXRoIOC4leC4o+C4h+C4meC4teC5iQogICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBibHVlcHJpbnRTaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvcnRjdXQtZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBzaG9ydGN1dDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVTaG9ydGN1dENsaWNrKHNob3J0Y3V0SWQpIHsKICAgIGNvbnN0IHNob3J0Y3V0ID0gYmx1ZXByaW50U2hvcnRjdXRzLmZpbmQocyA9PiBzLmlkID09PSBzaG9ydGN1dElkKTsKICAgIGlmICghc2hvcnRjdXQgfHwgIXNob3J0Y3V0LmJsdWVwcmludFVybCkgcmV0dXJuOwoKICAgIC8vIOC4i+C5iOC4reC4meC4leC4seC4p+C5gOC4peC4t+C4reC4geC5geC4peC4sOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1vcHRpb25zLWNvbnRhaW5lcicpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tYmx1ZXByaW50LWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKCiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZ2VuZXJhdGlvbi1hcmVhJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGVkLXF1aXotY29udGFpbmVyJykuaW5uZXJIVE1MID0gJyc7CiAgICBsb2FkZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgdHJ5IHsKICAgICAgICBsb2FkZXJUZXh0LnRleHRDb250ZW50ID0gJ+C4geC4s+C4peC4seC4h+C4lOC4tuC4h+C5hOC4n+C4peC5jCBCbHVlcHJpbnQg4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMLi4uJzsKICAgICAgICBjb25zdCBibHVlcHJpbnRGaWxlID0gYXdhaXQgZmV0Y2hGaWxlRnJvbVVybChzaG9ydGN1dC5ibHVlcHJpbnRVcmwsICJibHVlcHJpbnQucGRmIik7CgogICAgICAgIGxldCByZWZlcmVuY2VGaWxlID0gbnVsbDsKICAgICAgICBpZiAoc2hvcnRjdXQucmVmZXJlbmNlVXJsKSB7CiAgICAgICAgICAgIGxvYWRlclRleHQudGV4dENvbnRlbnQgPSAn4LiB4Liz4Lil4Lix4LiH4LiU4Li24LiH4LmE4Lif4Lil4LmM4Lit4LmJ4Liy4LiH4Lit4Li04LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMLi4uJzsKCiAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiZ4Liy4Lih4Liq4LiB4Li44Lil4LiC4Lit4LiHIFVSTCDguYDguJ7guLfguYjguK3guIHguLPguKvguJnguJTguIrguLfguYjguK3guYTguJ/guKXguYzguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlRmlsZW5hbWUgPSBzaG9ydGN1dC5yZWZlcmVuY2VVcmwudG9Mb3dlckNhc2UoKS5lbmRzV2l0aCgnLnR4dCcpIAogICAgICAgICAgICAgICAgPyAicmVmZXJlbmNlLnR4dCIgCiAgICAgICAgICAgICAgICA6ICJyZWZlcmVuY2UucGRmIjsKICAgICAgICAgICAgcmVmZXJlbmNlRmlsZSA9IGF3YWl0IGZldGNoRmlsZUZyb21Vcmwoc2hvcnRjdXQucmVmZXJlbmNlVXJsLCByZWZlcmVuY2VGaWxlbmFtZSk7CiAgICAgICAgICAgIC8vIC0tLSBbRU5EXSDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCiAgICAgICAgfQoKICAgICAgICAvLyDguKrguYjguIcgRmlsZSBvYmplY3Qg4LiX4Li14LmI4LmE4LiU4LmJ4LmE4Lib4LmD4Lir4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4LiaCiAgICAgICAgYXdhaXQgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50V2l0aEZpbGVzKGJsdWVwcmludEZpbGUsIHJlZmVyZW5jZUZpbGUpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcHJvY2Vzc2luZyBzaG9ydGN1dCBjbGljazoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogJHtlcnJvci5tZXNzYWdlfWApOwogICAgICAgIGxvYWRlci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0KfQoKZnVuY3Rpb24gZ2V0RGlyZWN0RG93bmxvYWRVcmwoZHJpdmVVcmwpIHsKICAgIGNvbnN0IGZpbGVJZE1hdGNoID0gZHJpdmVVcmwubWF0Y2goL2ZpbGVcL2RcLyhbYS16QS1aMC05Xy1dKykvKTsKICAgIGlmIChmaWxlSWRNYXRjaCAmJiBmaWxlSWRNYXRjaFsxXSkgewogICAgICAgIHJldHVybiBgaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD0ke2ZpbGVJZE1hdGNoWzFdfWA7CiAgICB9CiAgICByZXR1cm4gZHJpdmVVcmw7IC8vIOC4hOC4t+C4meC4hOC5iOC4siBVUkwg4LmA4LiU4Li04Lih4LiW4LmJ4Liy4LmE4Lih4LmI4LmD4LiK4LmI4Lij4Li54Lib4LmB4Lia4Lia4LiX4Li14LmI4Lij4Li54LmJ4LiI4Lix4LiBCn0KCmFzeW5jIGZ1bmN0aW9uIGZldGNoRmlsZUZyb21VcmwodXJsLCBkZWZhdWx0RmlsZW5hbWUpIHsKICAgIGNvbnN0IGRpcmVjdFVybCA9IGdldERpcmVjdERvd25sb2FkVXJsKHVybCk7CiAgICBjb25zdCBwcm94eVVybCA9IGBodHRwczovL2NvcnNwcm94eS5pby8/JHtlbmNvZGVVUklDb21wb25lbnQoZGlyZWN0VXJsKX1gOwoKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocHJveHlVcmwpOwogICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgIHRocm93IG5ldyBFcnJvcihg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmC4Lir4Lil4LiU4LmE4Lif4Lil4LmM4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmM4LmE4LiU4LmJIChTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfSlgKTsKICAgIH0KCmNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7CgogICAgLy8gLS0tIFtTVEFSVF0g4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQoKICAgIC8vIDEuIOC4reC5iOC4suC4mSA0IGJ5dGUg4LmB4Lij4LiB4LiC4Lit4LiH4LmE4Lif4Lil4LmM4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaICJNYWdpYyBOdW1iZXIiCiAgICBjb25zdCBmaWxlSGVhZGVyID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4Lit4LmI4Liy4LiZ4LmA4Liq4Lij4LmH4LiIIOC5g+C4q+C5ieC4hOC4t+C4meC4hOC5iOC4suC5gOC4m+C5h+C4mSBBcnJheSDguILguK3guIcgYnl0ZQogICAgICAgIHJlYWRlci5vbmxvYWRlbmQgPSAoKSA9PiByZXNvbHZlKG5ldyBVaW50OEFycmF5KHJlYWRlci5yZXN1bHQpKTsKICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsKICAgICAgICAvLyDguKrguLHguYjguIfguYPguKvguYnguK3guYjguLLguJnguILguYnguK3guKHguLnguKXguYHguITguYggNCBieXRlIOC5geC4o+C4geC4guC4reC4h+C5hOC4n+C4peC5jOC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihibG9iLnNsaWNlKDAsIDQpKTsKICAgIH0pOwoKICAgIGxldCBkZXRlcm1pbmVkTWltZVR5cGUgPSAnJzsKICAgIC8vIDIuIOC5geC4m+C4peC4hyBieXRlIOC4l+C4teC5iOC4reC5iOC4suC4meC5hOC4lOC5ieC5gOC4m+C5h+C4meC4guC5ieC4reC4hOC4p+C4suC4oSAoVGV4dCkKICAgIGNvbnN0IGhlYWRlclRleHQgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZmlsZUhlYWRlcik7CgogICAgLy8gMy4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LmE4LiU4LmJ4LiE4Li34LitICIlUERGIiDguKvguKPguLfguK3guYTguKHguYgKICAgIGlmIChoZWFkZXJUZXh0ID09PSAnJVBERicpIHsKICAgICAgICBkZXRlcm1pbmVkTWltZVR5cGUgPSAnYXBwbGljYXRpb24vcGRmJzsKICAgICAgICBjb25zb2xlLmxvZygnRmlsZSBjb250ZW50IGlkZW50aWZpZWQgYXMgUERGIGJ5IGl0cyBtYWdpYyBudW1iZXIuJyk7CiAgICB9IGVsc2UgewogICAgICAgIC8vIDQuIOC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5iCBQREYg4LmD4LiZ4LiB4Lij4LiT4Li14LiZ4Li14LmJ4LmD4Lir4LmJ4LiW4Li34Lit4Lin4LmI4Liy4LmA4Lib4LmH4LiZIFRleHQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgZGV0ZXJtaW5lZE1pbWVUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIGNvbnRlbnQgaXMgbm90IGEgUERGLCBhc3N1bWluZyB0ZXh0L3BsYWluLicpOwogICAgfQogICAgCiAgICAvLyA1LiDguKrguKPguYnguLLguIcgRmlsZSBvYmplY3Qg4LiU4LmJ4Lin4LiiIE1JTUUgdHlwZSDguJfguLXguYjguJXguKPguKfguIjguKrguK3guJrguIjguLLguIHguYDguJnguLfguYnguK3guKvguLLguYTguJ/guKXguYzguYHguKXguYnguKcKICAgIHJldHVybiBuZXcgRmlsZShbYmxvYl0sIGRlZmF1bHRGaWxlbmFtZSwgeyB0eXBlOiBkZXRlcm1pbmVkTWltZVR5cGUgfSk7CiAgICAvLyAtLS0gW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZUZyb21CbHVlcHJpbnRXaXRoRmlsZXMoYmx1ZXByaW50RmlsZSwgcmVmZXJlbmNlRmlsZSA9IG51bGwpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgg4pay4pay4payCgphc3luYyBmdW5jdGlvbiBoYW5kbGVMaXZlQW5zd2VyKGFuc3dlckluZGV4LCBxdWVzdGlvbikgewogICAgLy8g4Lib4Li04LiU4Lib4Li44LmI4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiX4Lix4LiZ4LiX4Li14Lir4Lil4Lix4LiH4LiV4Lit4LiaIOC5gOC4nuC4t+C5iOC4reC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4quC5iOC4h+C4i+C5ieC4swogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpdmUtYW5zd2VyLWJ0biwgI2xpdmUtc3VibWl0LXNob3J0LWFuc3dlci1idG4nKS5mb3JFYWNoKGIgPT4gYi5kaXNhYmxlZCA9IHRydWUpOwoKICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CiAgICBsZXQgdXNlckFuc3dlckZvckRiID0gYW5zd2VySW5kZXg7IC8vIOC4hOC5iOC4suC4l+C4teC5iOC4iOC4sOC4muC4seC4meC4l+C4tuC4geC4peC4hyBEQgoKICAgIC8vIOC4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4miAo4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4Lii4Lix4LiH4LiX4Liz4LiH4Liy4LiZ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicpIHsKICAgICAgICBjb25zdCB1c2VyQW5zd2VyID0gKGFuc3dlckluZGV4IHx8ICcnKS50b1N0cmluZygpOyAKICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKHVzZXJBbnN3ZXIsIHF1ZXN0aW9uKTsKICAgIH0KICAgIGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICBpc0NvcnJlY3QgPSBhbnN3ZXJJbmRleCA9PT0gcXVlc3Rpb24uY29ycmVjdEFuc3dlckluZGV4OwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgIGNvbnN0IGNvcnJlY3RBbnN3ZXJCb29sID0gcXVlc3Rpb24uY29ycmVjdEFuc3dlcjsKICAgICAgICBpc0NvcnJlY3QgPSAoYW5zd2VySW5kZXggPT09IDAgJiYgY29ycmVjdEFuc3dlckJvb2wpIHx8IChhbnN3ZXJJbmRleCA9PT0gMSAmJiAhY29ycmVjdEFuc3dlckJvb2wpOwogICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgIGNvbnN0IHNlbGVjdGVkUmVzcG9uc2UgPSBxdWVzdGlvbi5hbGxSZXNwb25zZXNbYW5zd2VySW5kZXhdOwogICAgICAgIGlzQ29ycmVjdCA9IHNlbGVjdGVkUmVzcG9uc2UgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICB1c2VyQW5zd2VyRm9yRGIgPSBzZWxlY3RlZFJlc3BvbnNlOyAvLyDguKrguLPguKvguKPguLHguJogbWF0Y2hpbmcg4LmD4Lir4LmJ4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBCiAgICB9CgogICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9saXZlR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAKICAgIC8vICoqKiDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguILguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJQgKioqCiAgICAvLyDguYDguKPguLLguIjguLDguYTguKHguYjguITguLPguJnguKfguJPguITguLDguYHguJnguJnguJfguLXguYjguJnguLXguYjguK3guLXguIHguJXguYjguK3guYTguJsKICAgIC8vIOC5geC4leC5iOC4iOC4sOC4quC5iOC4h+C4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4leC4reC4muC5geC4peC4sCAi4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiH4LiI4Liy4LiB4LmA4LiL4Li04Lij4LmM4Lif4LmA4Lin4Lit4Lij4LmMIiDguIHguKXguLHguJrguYTguJvguYHguJfguJkKICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7fTsKICAgIHVwZGF0ZVBheWxvYWRbYHBsYXllcnMuJHtjdXJyZW50U3R1ZGVudE5hbWV9LmFuc3dlcmVkQ3VycmVudFF1ZXN0aW9uYF0gPSB0cnVlOwogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0ubGFzdEFuc3dlckNvcnJlY3RgXSA9IGlzQ29ycmVjdDsKICAgIHVwZGF0ZVBheWxvYWRbYHBsYXllcnMuJHtjdXJyZW50U3R1ZGVudE5hbWV9Lmxhc3RBbnN3ZXJJbmRleGBdID0gKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpID8gbnVsbCA6IGFuc3dlckluZGV4OwogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0ubGFzdEFuc3dlclZhbHVlYF0gPSB1c2VyQW5zd2VyRm9yRGI7CiAgICB1cGRhdGVQYXlsb2FkW2BwbGF5ZXJzLiR7Y3VycmVudFN0dWRlbnROYW1lfS5zdWJtaXR0ZWRBdGBdID0gc2VydmVyVGltZXN0YW1wKCk7IC8vIOC4muC4seC4meC4l+C4tuC4geC5gOC4p+C4peC4suC4l+C4teC5iOC4quC5iOC4h+C4lOC5ieC4p+C4ouC5gOC4p+C4peC4suC5gOC4i+C4tOC4o+C5jOC4n+C5gOC4p+C4reC4o+C5jAogICAgdXBkYXRlUGF5bG9hZFtgcGxheWVycy4ke2N1cnJlbnRTdHVkZW50TmFtZX0uaXNTY29yZWRgXSA9IGZhbHNlOyAvLyDguYDguJ7guLTguYjguKEgRmxhZyDguYDguJ7guLfguYjguK3guJrguK3guIHguKfguYjguLIgIuC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4hOC4tOC4lOC4hOC4sOC5geC4meC4mSIKCiAgICAvLyDguKrguYjguIfguILguYnguK3guKHguLnguKXguIHguKXguLHguJrguYTguJvguJfguLXguYggRmlyZXN0b3JlCiAgICBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgdXBkYXRlUGF5bG9hZCk7CgogICAgLy8g4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4LitICLguKPguK0iIOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oQogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIj7guKrguYjguIfguITguLPguJXguK3guJrguYHguKXguYnguKchPC9oMj4KICAgICAgICA8cCBjbGFzcz0ibXQtOCI+4Lij4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiE4LiZ4Lit4Li34LmI4LiZ4Liq4Lix4LiB4LiE4Lij4Li54LmILi4uPC9wPgogICAgICAgIDxkaXYgY2xhc3M9ImxvYWRlciBtdC00Ij48L2Rpdj4KICAgIDwvZGl2PmA7Cn0KCmZ1bmN0aW9uIHNob3dBZG1pblN1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbikgewogICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgY3VycmVudFF1aXpEYXRhLnF1aXpUeXBlOwogICAgY29uc3Qgb3B0aW9ucyA9IHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnID8gWyfguYPguIrguYgnLCAn4LmE4Lih4LmI4LmD4LiK4LmIJ10gOiAocXVlc3Rpb24ub3B0aW9ucyB8fCBxdWVzdGlvbi5hbGxSZXNwb25zZXMgfHwgW10pOwoKICAgIGNvbnN0IG5hbWVzQnlBbnN3ZXIgPSB7fTsKICAgIGNvbnN0IGFuc3dlckNvdW50cyA9IG5ldyBBcnJheShvcHRpb25zLmxlbmd0aCkuZmlsbCgwKTsKICAgIG9wdGlvbnMuZm9yRWFjaCgob3B0LCBpbmRleCkgPT4gewogICAgICAgIG5hbWVzQnlBbnN3ZXJbaW5kZXhdID0gW107CiAgICB9KTsKCiAgICBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5mb3JFYWNoKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdhY3RpdmUnICYmIGRhdGEubGFzdEFuc3dlckluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc3QgYW5zd2VySW5kZXggPSBkYXRhLmxhc3RBbnN3ZXJJbmRleDsKICAgICAgICAgICAgaWYgKG5hbWVzQnlBbnN3ZXJbYW5zd2VySW5kZXhdKSB7CiAgICAgICAgICAgICAgICBuYW1lc0J5QW5zd2VyW2Fuc3dlckluZGV4XS5wdXNoKG5hbWUpOwogICAgICAgICAgICAgICAgYW5zd2VyQ291bnRzW2Fuc3dlckluZGV4XSsrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CiAgICAKICAgIGNvbnN0IG1heENvdW50ID0gTWF0aC5tYXgoLi4uYW5zd2VyQ291bnRzLCAxKTsKICAgIAogICAgY29uc3Qgc3VtbWFyeUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggZmxleCBmbGV4LWNvbCBoLWZ1bGwgaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIj4ke3F1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0fTwvaDI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctMnhsIGgtNjQgZmxleCBqdXN0aWZ5LWFyb3VuZCBpdGVtcy1lbmQgZ2FwLTQiPgogICAgICAgICAgICAgICAgJHthbnN3ZXJDb3VudHMubWFwKChjb3VudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IG5hbWVzQnlBbnN3ZXJbaW5kZXhdLmxlbmd0aCA+IDAgCiAgICAgICAgICAgICAgICAgICAgICAgID8gbmFtZXNCeUFuc3dlcltpbmRleF0uam9pbignLCAnKSAKICAgICAgICAgICAgICAgICAgICAgICAgOiAn4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJJzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgaXNDb3JyZWN0T3B0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKGluZGV4ID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdFZhbHVlID0gcXVlc3Rpb24uY29ycmVjdEFuc3dlcjsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKGNvcnJlY3RWYWx1ZSAmJiBpbmRleCA9PT0gMCkgfHwgKCFjb3JyZWN0VmFsdWUgJiYgaW5kZXggPT09IDEpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0T3B0aW9uID0gKG9wdGlvbnNbaW5kZXhdID09PSBxdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFyQ29sb3IgPSBpc0NvcnJlY3RPcHRpb24gPyAnIzI2ODkwYycgOiAnI2UyMWIzYyc7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBb4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiC4Lit4LiH4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LiV4Liz4LmB4Lir4LiZ4LmI4LiHIFRvb2x0aXBdIC0tLQogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xLzQgaC1mdWxsIGZsZXggZmxleC1jb2wganVzdGlmeS1lbmQgaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0xIj4ke2NvdW50fTwvc3Bhbj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1bW1hcnktYmFyLWl0ZW0gdy1mdWxsIHJvdW5kZWQtbGcgdGV4dC13aGl0ZSBwLTIgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgZ2FwLTEgY3Vyc29yLXBvaW50ZXIgcmVsYXRpdmUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImhlaWdodDogNjBweDsgYmFja2dyb3VuZC1jb2xvcjogJHtiYXJDb2xvcn07IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtdG9vbHRpcC10YXJnZXQ9InRvb2x0aXAtJHtpbmRleH0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14cyBzbTp0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1jZW50ZXIgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtvcHRpb25zW2luZGV4XX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InRvb2x0aXAtJHtpbmRleH0iIGNsYXNzPSJsaXZlLXN1bW1hcnktdG9vbHRpcCBhYnNvbHV0ZSBib3R0b20tZnVsbCBtYi0yIHctbWF4IG1heC13LXhzIGJnLWdyYXktODAwIHRleHQtd2hpdGUgdGV4dC1zbSByb3VuZGVkLWxnIHNoYWRvdy1sZyBwLTMgei0xMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZyBjbGFzcz0iYmxvY2sgbWItMSBib3JkZXItYiBib3JkZXItZ3JheS02MDAgcGItMSI+4Lic4Li54LmJ4LiX4Li14LmI4LiV4Lit4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiZ4Li14LmJOjwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7dG9vbHRpcFRleHR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00IG10LTgiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ib3Blbi1zY3JhdGNocGFkLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzMwIGhvdmVyOmJnLXdoaXRlLzUwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCI+PC9pPiDguJfguJTguYDguKXguIIKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic2hvdy1sZWFkZXJib2FyZC1idG4iIGNsYXNzPSJiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCI+CiAgICAgICAgICAgICAgICAgICAg4LiW4Lix4LiU4LmE4LibIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT4KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICAKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBzdW1tYXJ5SFRNTDsKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZSgpOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LWxlYWRlcmJvYXJkLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvbGl2ZUdhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHF1ZXN0aW9uU3RhdHVzOiAnbGVhZGVyYm9hcmQnIH0pOwogICAgfSk7CiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLXNjcmF0Y2hwYWQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIG9wdGlvbnMpOwogICAgfSk7Cn0KCiAgICAgICAgLyoqCi8qKgogICAgICAgICAqIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4reC4quC4o+C4uOC4m+C4nOC4peC4q+C4peC4seC4h+C4iOC4muC4guC5ieC4rSAo4Liq4Liz4Lir4Lij4Lix4LiaIFBsYXllcikgLSDguYDguKfguK3guKPguYzguIrguLHguJnguK3guLHguJvguYDguIHguKPguJQKICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gZ2FtZURhdGEgLSDguILguYnguK3guKHguLnguKXguYDguIHguKHguJfguLHguYnguIfguKvguKHguJTguIjguLLguIEgRmlyZXN0b3JlCiAgICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHBsYXllck5hbWUgLSDguIrguLfguYjguK3guILguK3guIfguJzguLnguYnguYDguKXguYjguJnguJvguLHguIjguIjguLjguJrguLHguJkKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBzaG93UGxheWVyU3VtbWFyeVZpZXcoZ2FtZURhdGEsIHBsYXllck5hbWUpIHsKICAgICAgICAgICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICAgICAgICAgIGNvbnN0IG15RGF0YSA9IGdhbWVEYXRhLnBsYXllcnNbcGxheWVyTmFtZV07CgogICAgICAgICAgICAvLyDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJoKICAgICAgICAgICAgY29uc3Qgc29ydGVkUGxheWVycyA9IHBsYXllcnMuZmlsdGVyKHAgPT4gcC5zdGF0dXMgPT09ICdhY3RpdmUnKS5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7CiAgICAgICAgICAgIGNvbnN0IG15UmFuayA9IHNvcnRlZFBsYXllcnMuZmluZEluZGV4KHAgPT4gcCA9PT0gbXlEYXRhKSArIDE7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gbXlEYXRhLmxhc3RBbnN3ZXJDb3JyZWN0ID8gJ+C4luC4ueC4geC4leC5ieC4reC4hyEnIDogJ+C4nOC4tOC4lCc7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdEJveENsYXNzID0gbXlEYXRhLmxhc3RBbnN3ZXJDb3JyZWN0ID8gJ2JnLWdyZWVuLTUwMCcgOiAnYmctcmVkLTUwMCc7CiAgICAgICAgICAgIGNvbnN0IHBvaW50c0dhaW5lZCA9IG15RGF0YS5wb2ludHNMYXN0UXVlc3Rpb24gfHwgMDsKICAgICAgICAgICAgY29uc3QgZ3JhZGllbnRCZyA9ICJiZy1ncmFkaWVudC10by1iciBmcm9tLWluZGlnby02MDAgdG8tcHVycGxlLTcwMCI7CgogICAgICAgICAgICBjb25zdCBzdW1tYXJ5SFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciB0ZXh0LXdoaXRlICR7Z3JhZGllbnRCZ30iPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InB4LTggcHktMiByb3VuZGVkLWxnICR7cmVzdWx0Qm94Q2xhc3N9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCI+JHtyZXN1bHRUZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgbXQtNCI+KyR7cG9pbnRzR2FpbmVkfSDguITguLDguYHguJnguJk8L3A+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LXNtIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTEyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteGwiPuC4leC4reC4meC4meC4teC5ieC4hOC4uOC4k+C4reC4ouC4ueC5iOC4reC4seC4meC4lOC4seC4muC4l+C4teC5iDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNnhsIGZvbnQtYm9sZCI+JHtteVJhbmsgPiAwID8gbXlSYW5rIDogJy0nfTwvcD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTEyIHRleHQtZ3JheS0zMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gc3VtbWFyeUhUTUw7CiAgICAgICAgfQoKZnVuY3Rpb24gY3JlYXRlUXVpekZyb21CYW5rKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gc2hvd0FkbWluTG9iYnlWaWV3KGdhbWVQaW4sIHF1aXpUb3BpYykgewogICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOyAKCiAgICAvLyAtLS0gW1NUQVJUXSDguYHguIHguYnguYTguILguIHguLLguKPguYHguKrguJTguIfguJzguKXguIrguLfguYjguK3guJzguLnguYnguYDguKXguYjguJnguYPguKvguYnguKHguLXguJvguLjguYjguKHguYDguJXguLAgLS0tCiAgICBjb25zdCBsb2JieUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibGl2ZS1nYW1lLWJnIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsIj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgbWItMiI+4LmA4Lij4Li04LmI4Lih4LmA4LiB4LihOiAke3F1aXpUb3BpY308L2gyPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBtYi00Ij7guYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguYDguILguYnguLLguKPguYjguKfguKHguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYk6PC9wPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy13aGl0ZSB0ZXh0LWdyYXktODAwIHJvdW5kZWQtbGcgcC00IG1iLTQiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNnhsIGZvbnQtYm9sZCB0cmFja2luZy13aWRlc3QiPiR7Z2FtZVBpbn08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbWQgYmctd2hpdGUvMjAgcC00IHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItMiI+4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihICg8c3BhbiBpZD0icGxheWVyLWNvdW50Ij4wPC9zcGFuPik8L2gzPgogICAgICAgICAgICAgICAgPGRpdiBpZD0icGxheWVyLWxpc3QtbG9iYnkiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8YnV0dG9uIGlkPSJzdGFydC1nYW1lLWJ0biIgY2xhc3M9Im10LTYgYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCB0cmFuc2l0aW9uLXRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgZGlzYWJsZWQ6YmctZ3JheS00MDAgZGlzYWJsZWQ6Y3Vyc29yLW5vdC1hbGxvd2VkIiBkaXNhYmxlZD4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGxheSI+PC9pPiDguYDguKPguLTguYjguKHguIHguLLguKPguYHguILguYjguIfguILguLHguJkKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4geC5ieC5hOC4giAtLS0KCiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gbG9iYnlIVE1MOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6IOC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4luC4suC4oeC4quC4s+C4q+C4o+C4seC4muC5gOC4geC4oeC4meC4teC5iSIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4OiAwLAogICAgICAgICAgICAgICAgcXVlc3Rpb25EaXNwbGF5ZWRBdDogc2VydmVyVGltZXN0YW1wKCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBmaXJzdFF1ZXN0aW9uID0gY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1swXTsKICAgICAgICAgICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgc2hvd0FkbWluTGl2ZVF1ZXN0aW9uVmlldyhmaXJzdFF1ZXN0aW9uLCAwLCB0b3RhbFF1ZXN0aW9ucyk7CgogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHN0YXJ0aW5nIGdhbWU6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4LmA4Lij4Li04LmI4Lih4LmA4LiB4Lih4LmE4LiU4LmJIik7CiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5RdWl6QmFua01vZGFsKCkgewogIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4seC5ieC4h+C4q+C4oeC4lCAo4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1KQogIGlmIChhbGxRdWl6emVzR2xvYmFsLmxlbmd0aCA9PT0gMCkgewogICAgY29uc3QgcXMgPSBhd2FpdCBnZXREb2NzKGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2ApKTsKICAgIGFsbFF1aXp6ZXNHbG9iYWwgPSBxcy5kb2NzLm1hcChkID0+ICh7IGlkOiBkLmlkLCAuLi5kLmRhdGEoKSB9KSk7CiAgfQogIC8vIOC5geC4quC4lOC4h+C4o+C4suC4ouC4geC4suC4o+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4mSBNb2RhbAogIHJlbmRlclF1aXpCYW5rTGlzdCgnJyk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwp9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclF1aXpCYW5rTGlzdCDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkgLS0tCmZ1bmN0aW9uIHJlbmRlclF1aXpCYW5rTGlzdChmaWx0ZXJUZXh0ID0gJycsIHNlbGVjdGlvbk1vZGUgPSBmYWxzZSkgewogIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotbGlzdCcpOwogIGNvbnN0IHRlcm0gPSBmaWx0ZXJUZXh0LnRvTG93ZXJDYXNlKCkudHJpbSgpOwoKICBjb25zdCByb3dzID0gYWxsUXVpenplc0dsb2JhbAogICAgLm1hcChxID0+ICh7CiAgICAgIC4uLnEsCiAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICB9KSkKICAgIC5maWx0ZXIocSA9PgogICAgICAocS50b3BpYyB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5wcm9qZWN0TmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5pZC50b1N0cmluZygpLmluY2x1ZGVzKHRlcm0pKQogICAgKTsKCQoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1jb3VudCcpLnRleHRDb250ZW50ID0gYCgke3Jvd3MubGVuZ3RofSDguIrguLjguJQpYDsKCiBsaXN0RWwuaW5uZXJIVE1MID0gcm93cy5sZW5ndGgKICA/IHJvd3MubWFwKHEgPT4gewogICAgICAvLyDguIvguYjguK3guJnguJvguLjguYjguKHguYDguITguKPguLfguYjguK3guIfguKHguLfguK3guJfguLHguYnguIfguKvguKHguJTguYDguKHguLfguYjguK3guK3guKLguLnguYjguYPguJkgc2VsZWN0aW9uTW9kZQogICAgICBjb25zdCBhY3Rpb25CdXR0b25zSFRNTCA9ICFzZWxlY3Rpb25Nb2RlID8gYAogICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC1weCBtbC00IHNocmluay0wIj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiB0aXRsZT0i4Lii4LmJ4Liy4Lii4LmE4Lib4LmC4Lib4Lij4LmA4LiI4LiE4Lit4Li34LmI4LiZIiBjbGFzcz0icXVpei1iYW5rLW1vdmUtYnRuIHRleHQtcHVycGxlLTYwMCBob3Zlcjp0ZXh0LXB1cnBsZS04MDAgdGV4dC14bCBwLTIgcm91bmRlZC1mdWxsIGhvdmVyOmJnLWdyYXktMjAwIj48aSBjbGFzcz0iZmFzIGZhLXByb2plY3QtZGlhZ3JhbSBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtxLmlkfSIgdGl0bGU9IuC4leC4seC5ieC4h+C4hOC5iOC4siIgY2xhc3M9InF1aXotYmFuay1zZXR0aW5ncy1idG4gdGV4dC1jeWFuLTYwMCBob3Zlcjp0ZXh0LWN5YW4tODAwIHRleHQteGwgcC0yIHJvdW5kZWQtZnVsbCBob3ZlcjpiZy1ncmF5LTIwMCI+PGkgY2xhc3M9ImZhcyBmYS1jb2cgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIHRpdGxlPSLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguITguLnguYjguILguJnguLLguJkiIGNsYXNzPSJxdWl6LWJhbmstcGFyYWxsZWwtYnRuIHRleHQtdGVhbC02MDAgaG92ZXI6dGV4dC10ZWFsLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtY2xvbmUgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIHRpdGxlPSLguYLguKvguKHguJTguJnguLPguYDguKrguJnguK0iIGNsYXNzPSJxdWl6LWJhbmstcHJlc2VudC1idG4gdGV4dC1pbmRpZ28tNjAwIGhvdmVyOnRleHQtaW5kaWdvLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiB0aXRsZT0i4LiX4LiU4Lil4Lit4LiH4LiX4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIiBjbGFzcz0icXVpei1iYW5rLXRyeS1idG4gdGV4dC1wdXJwbGUtNjAwIGhvdmVyOnRleHQtcHVycGxlLTgwMCB0ZXh0LXhsIHAtMiByb3VuZGVkLWZ1bGwgaG92ZXI6YmctZ3JheS0yMDAiPjxpIGNsYXNzPSJmYXMgZmEtdmlhbCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gZGF0YS1pZD0iJHtxLmlkfSIgZGF0YS10b3BpYz0iJHtxLnRvcGljfSIgdGl0bGU9IuC4peC4miIgY2xhc3M9InF1aXotYmFuay1kZWxldGUtYnRuIHRleHQtcmVkLTYwMCBob3Zlcjp0ZXh0LXJlZC04MDAgdGV4dC14bCBwLTIgcm91bmRlZC1mdWxsIGhvdmVyOmJnLWdyYXktMjAwIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+PC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICAgIGAgOiAnJzsKCiAgICAgIHJldHVybiBgCiAgICAgIDxkaXYgY2xhc3M9InctZnVsbCB0ZXh0LWxlZnQgcC0zIGJvcmRlci1iIGhvdmVyOmJnLWdyYXktMTAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiI+CiAgICAgICAgPGRpdiBkYXRhLWlkPSIke3EuaWR9IiBjbGFzcz0icXVpei1iYW5rLWl0ZW0gZmxleC1ncm93IGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTcwMCI+JHtxLnRvcGljIHx8ICco4LmE4Lih4LmI4Lih4Li14LiK4Li34LmI4LitKSd9CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtbm9ybWFsIHRleHQtZ3JheS01MDAiPigke3EucXVlc3Rpb25zPy5sZW5ndGggfHwgMH0g4LiC4LmJ4LitKTwvc3Bhbj4KICAgICAgICAgIDwvcD4KICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAiPuC5guC4m+C4o+C5gOC4iOC4hDogJHtxLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgZm9udC1tb25vIG10LTEiPlF1aXogSUQ6ICR7cS5pZH08L3A+CiAgICAgICAgPC9kaXY+CiAgICAgICAgJHthY3Rpb25CdXR0b25zSFRNTH0KICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpCiAgOiBgPGRpdiBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC5hOC4oeC5iOC4nuC4muC5geC4muC4muC4l+C4lOC4quC4reC4mjwvZGl2PmA7CgogIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguYDguInguJ7guLLguLDguYDguKHguLfguYjguK3guYTguKHguYjguYTguJTguYnguK3guKLguLnguYjguYPguJkgc2VsZWN0aW9uTW9kZQogIGlmICghc2VsZWN0aW9uTW9kZSkgewogICAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1pdGVtJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgTW9kYWwKICAgICAgICAgIHNob3dRdWl6RGV0YWlsVmlldyhxdWl6SWQpOyAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKHguYDguJ7guLfguYjguK3guYTguJvguKvguJnguYnguLLguKfguLTguYDguITguKPguLLguLDguKvguYzguJzguKUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIAogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguJfguJTguKXguK3guIfguJfguLMiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay10cnktYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gYnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplc0dsb2JhbC5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICAgICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHN0YXJ0QWRtaW5UZXN0KCk7CiAgICAgICAgICAgIH0gZWxzZSB7IHNob3dNZXNzYWdlKCfguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJonKTsgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguITguLnguYjguILguJnguLLguJkiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1wYXJhbGxlbC1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBjb25zdCBxdWl6SWQgPSBidG4uZGF0YXNldC5pZDsKICAgICAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgICAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxGcm9tQmFuayhxdWl6RGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7IHNob3dNZXNzYWdlKCfguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJonKTsgfQogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguJnguLPguYDguKrguJnguK0iCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1wcmVzZW50LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgc3RhcnRQcmVzZW50YXRpb24ocXVpekRhdGEpOwogICAgICAgICAgICB9IGVsc2UgeyBzaG93TWVzc2FnZSgn4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaJyk7IH0KICAgICAgICB9KTsKICAgIH0pOwoKICAgIC8vIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oSAi4Lii4LmJ4Liy4LiiIgogICAgbGlzdEVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5xdWl6LWJhbmstbW92ZS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICBjb25zdCBxdWl6SWQgPSBidG4uZGF0YXNldC5pZDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotYmFuay1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBoYW5kbGVNb3ZlUXVpeihxdWl6SWQpOyAKICAgICAgICB9KTsKICAgIH0pOwoJCgkvLyBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKEgIuC4leC4seC5ieC4h+C4hOC5iOC4siIKICAgIGxpc3RFbC5xdWVyeVNlbGVjdG9yQWxsKCcucXVpei1iYW5rLXNldHRpbmdzLWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1iYW5rLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGhhbmRsZVF1aXpTZXR0aW5ncyhxdWl6SWQpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8gRXZlbnQgTGlzdGVuZXIg4Liq4Liz4Lir4Lij4Lix4Lia4Lib4Li44LmI4LihICLguKXguJoiCiAgICBsaXN0RWwucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1kZWxldGUtYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gYnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gYnRuLmRhdGFzZXQudG9waWM7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke3RvcGljfSI/IOC4geC4suC4o+C4geC4o+C4sOC4l+C4s+C4meC4teC5ieC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4ouC5ieC4reC4meC4geC4peC4seC4muC5hOC4lOC5iWAsCiAgICAgICAgICAgICAgICAoKSA9PiBoYW5kbGVEZWxldGVRdWl6KHF1aXpJZCkKICAgICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0pOwogIH0KfQoKLy8g4LmD4LiZ4LmE4Lif4Lil4LmMIDUwLmh0bWwKLy8gLS0tIOC4meC4s+C5guC4hOC5ieC4lOC4meC4teC5ieC5hOC4m+C4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVDb21wYXJlUmVzdWx0cyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCgphc3luYyBmdW5jdGlvbiBoYW5kbGVDb21wYXJlUmVzdWx0cyhwb3N0VGVzdElkLCBwcmVUZXN0SWQpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tbW9kYWwnKTsKICAgIGNvbnN0IG92ZXJhbGxDb250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1vdmVyYWxsLWNvbnRlbnQnKTsKICAgIGNvbnN0IGluZGl2aWR1YWxDb250ZW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1pbmRpdmlkdWFsLWNvbnRlbnQnKTsKICAgIAogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tb3ZlcmFsbC10YWInKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21wYXJpc29uLWluZGl2aWR1YWwtdGFiJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICBvdmVyYWxsQ29udGVudEVsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgaW5kaXZpZHVhbENvbnRlbnRFbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgb3ZlcmFsbENvbnRlbnRFbC5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CiAgICBpbmRpdmlkdWFsQ29udGVudEVsLmlubmVySFRNTCA9ICcnOwogICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwb3N0VGVzdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcG9zdFRlc3RJZCk7CiAgICAgICAgY29uc3QgcG9zdFRlc3RTbmFwID0gYXdhaXQgZ2V0RG9jKHBvc3RUZXN0UmVmKTsKICAgICAgICBpZiAoIXBvc3RUZXN0U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguILguYnguK3guKrguK3guJrguKvguKXguLHguIfguYDguKPguLXguKLguJkiKTsKICAgICAgICBjb25zdCBwb3N0VGVzdERhdGEgPSBwb3N0VGVzdFNuYXAuZGF0YSgpOwogICAgICAgIGNvbnN0IHRvdGFsUXVlc3Rpb25zID0gcG9zdFRlc3REYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CgogICAgICAgIGNvbnN0IHByZVRlc3RTdWJtaXNzaW9uc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke3ByZVRlc3RJZH0vc3VibWlzc2lvbnNgKTsKICAgICAgICBjb25zdCBwb3N0VGVzdFN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cG9zdFRlc3RJZH0vc3VibWlzc2lvbnNgKTsKICAgICAgICBjb25zdCBbcHJlVGVzdFN1Ym1pc3Npb25zU25hcCwgcG9zdFRlc3RTdWJtaXNzaW9uc1NuYXBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2dldERvY3MocHJlVGVzdFN1Ym1pc3Npb25zUmVmKSwgZ2V0RG9jcyhwb3N0VGVzdFN1Ym1pc3Npb25zUmVmKV0pOwogICAgICAgIGNvbnN0IHByZVRlc3RTdWJtaXNzaW9ucyA9IHByZVRlc3RTdWJtaXNzaW9uc1NuYXAuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgIGNvbnN0IHBvc3RUZXN0U3VibWlzc2lvbnMgPSBwb3N0VGVzdFN1Ym1pc3Npb25zU25hcC5kb2NzLm1hcChkb2MgPT4gZG9jLmRhdGEoKSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcHJlVGVzdFNjb3JlcyA9IHByZVRlc3RTdWJtaXNzaW9ucy5tYXAocyA9PiBzLmxhdGVzdFNjb3JlKTsKICAgICAgICBjb25zdCBwb3N0VGVzdFNjb3JlcyA9IHBvc3RUZXN0U3VibWlzc2lvbnMubWFwKHMgPT4gcy5sYXRlc3RTY29yZSk7CiAgICAgICAgCiAgICAgICAgLy8gLS0tIFNUQVJUOiDguKrguYjguKfguJnguIHguLLguKPguITguLPguJnguKfguJMgWi1TY29yZSDguYHguKXguLAgVC1TY29yZSAtLS0KICAgICAgICBjb25zdCBwcmVUZXN0U3RhdHMgPSBjYWxjdWxhdGVNZWFuQW5kU3RkRGV2KHByZVRlc3RTY29yZXMpOwogICAgICAgIGNvbnN0IHBvc3RUZXN0U3RhdHMgPSBjYWxjdWxhdGVNZWFuQW5kU3RkRGV2KHBvc3RUZXN0U2NvcmVzKTsKICAgICAgICAvLyAtLS0gRU5EOiDguKrguYjguKfguJnguIHguLLguKPguITguLPguJnguKfguJMgLS0tCgogICAgICAgIGNvbnN0IHByZVRlc3RBdmcgPSBwcmVUZXN0U3RhdHMubWVhbjsKICAgICAgICBjb25zdCBwb3N0VGVzdEF2ZyA9IHBvc3RUZXN0U3RhdHMubWVhbjsKICAgICAgICBjb25zdCBpbXByb3ZlbWVudCA9IHBvc3RUZXN0QXZnIC0gcHJlVGVzdEF2ZzsKCiAgICAgICAgbGV0IG92ZXJhbGxIdG1sID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0zIGdhcC00IG1iLTYiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJnLWJsdWUtMTAwIHJvdW5kZWQtbGcgdGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXNtIGZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTgwMCI+4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiICjguIHguYjguK3guJnguYDguKPguLXguKLguJkpPC9wPjxwIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgdGV4dC1ibHVlLTkwMCI+JHtwcmVUZXN0QXZnLnRvRml4ZWQoMil9PC9wPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJnLWdyZWVuLTEwMCByb3VuZGVkLWxnIHRleHQtY2VudGVyIj48cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkIHRleHQtZ3JlZW4tODAwIj7guITguLDguYHguJnguJnguYDguInguKXguLXguYjguKIgKOC4q+C4peC4seC4h+C5gOC4o+C4teC4ouC4mSk8L3A+PHAgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTkwMCI+JHtwb3N0VGVzdEF2Zy50b0ZpeGVkKDIpfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCAke2ltcHJvdmVtZW50ID49IDAgPyAnYmctZW1lcmFsZC0xMDAnIDogJ2JnLXJlZC0xMDAnfSByb3VuZGVkLWxnIHRleHQtY2VudGVyIj48cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkICR7aW1wcm92ZW1lbnQgPj0gMCA/ICd0ZXh0LWVtZXJhbGQtODAwJyA6ICd0ZXh0LXJlZC04MDAnfSI+4Lie4Lix4LiS4LiZ4Liy4LiB4Liy4Lij4LmA4LiJ4Lil4Li14LmI4LiiPC9wPjxwIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgJHtpbXByb3ZlbWVudCA+PSAwID8gJ3RleHQtZW1lcmFsZC05MDAnIDogJ3RleHQtcmVkLTkwMCd9Ij4ke2ltcHJvdmVtZW50ID49IDAgPyAnKycgOiAnJ30ke2ltcHJvdmVtZW50LnRvRml4ZWQoMil9PC9wPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdj48aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbWItMiB0ZXh0LWNlbnRlciI+4LiB4Lij4Liy4Lif4LmA4Lib4Lij4Li14Lii4Lia4LmA4LiX4Li14Lii4Lia4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiPC9oND48Y2FudmFzIGlkPSJjb21wYXJpc29uLWNoYXJ0Ij48L2NhbnZhcz48L2Rpdj5gOwogICAgICAgIG92ZXJhbGxDb250ZW50RWwuaW5uZXJIVE1MID0gb3ZlcmFsbEh0bWw7CiAgICAgICAgCiAgICAgICAgY29uc3QgY3R4ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tY2hhcnQnKS5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGlmIChjaGFydEluc3RhbmNlcy5jb21wYXJpc29uKSBjaGFydEluc3RhbmNlcy5jb21wYXJpc29uLmRlc3Ryb3koKTsKICAgICAgICBjaGFydEluc3RhbmNlcy5jb21wYXJpc29uID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgICAgICB0eXBlOiAnYmFyJywKICAgICAgICAgICAgZGF0YTogeyBsYWJlbHM6IFsn4LiE4Liw4LmB4LiZ4LiZ4LmA4LiJ4Lil4Li14LmI4LiiJ10sIGRhdGFzZXRzOiBbeyBsYWJlbDogJ+C4geC5iOC4reC4meC5gOC4o+C4teC4ouC4mScsIGRhdGE6IFtwcmVUZXN0QXZnXSwgYmFja2dyb3VuZENvbG9yOiAncmdiYSg1OSwgMTMwLCAyNDYsIDAuNyknIH0seyBsYWJlbDogJ+C4q+C4peC4seC4h+C5gOC4o+C4teC4ouC4mScsIGRhdGE6IFtwb3N0VGVzdEF2Z10sIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTYsIDE4NSwgMTI5LCAwLjcpJyB9XSB9LAogICAgICAgICAgICBvcHRpb25zOiB7IHNjYWxlczogeyB5OiB7IGJlZ2luQXRaZXJvOiB0cnVlLCBzdWdnZXN0ZWRNYXg6IHRvdGFsUXVlc3Rpb25zIH0gfSB9CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHN0dWRlbnRzID0gY3VycmVudFByb2plY3REYXRhLnN0dWRlbnRzIHx8IFtdOwogICAgICAgIGNvbnN0IGNvbXBhcmlzb25EYXRhID0gc3R1ZGVudHMubWFwKG5hbWUgPT4gewogICAgICAgICAgICBjb25zdCBwcmVTdWIgPSBwcmVUZXN0U3VibWlzc2lvbnMuZmluZChzID0+IHMuc3R1ZGVudE5hbWUgPT09IG5hbWUpOwogICAgICAgICAgICBjb25zdCBwb3N0U3ViID0gcG9zdFRlc3RTdWJtaXNzaW9ucy5maW5kKHMgPT4gcy5zdHVkZW50TmFtZSA9PT0gbmFtZSk7CiAgICAgICAgICAgIGNvbnN0IHByZVNjb3JlID0gcHJlU3ViID8gcHJlU3ViLmxhdGVzdFNjb3JlIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgcG9zdFNjb3JlID0gcG9zdFN1YiA/IHBvc3RTdWIubGF0ZXN0U2NvcmUgOiBudWxsOwogICAgICAgICAgICBjb25zdCBnYWluID0gKHByZVNjb3JlICE9PSBudWxsICYmIHBvc3RTY29yZSAhPT0gbnVsbCkgPyBwb3N0U2NvcmUgLSBwcmVTY29yZSA6IG51bGw7CgogICAgICAgICAgICAvLyAtLS0gU1RBUlQ6IOC4quC5iOC4p+C4meC4geC4suC4o+C4hOC4s+C4meC4p+C4kyBULVNjb3JlIOC4o+C4suC4ouC4muC4uOC4hOC4hOC4pSAtLS0KICAgICAgICAgICAgY29uc3QgcHJlWiA9IHByZVNjb3JlICE9PSBudWxsID8gY2FsY3VsYXRlWlNjb3JlKHByZVNjb3JlLCBwcmVUZXN0U3RhdHMubWVhbiwgcHJlVGVzdFN0YXRzLnN0ZERldikgOiBudWxsOwogICAgICAgICAgICBjb25zdCBwb3N0WiA9IHBvc3RTY29yZSAhPT0gbnVsbCA/IGNhbGN1bGF0ZVpTY29yZShwb3N0U2NvcmUsIHBvc3RUZXN0U3RhdHMubWVhbiwgcG9zdFRlc3RTdGF0cy5zdGREZXYpIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgcHJlVFNjb3JlID0gcHJlWiAhPT0gbnVsbCA/IGNhbGN1bGF0ZVRTY29yZShwcmVaKSA6IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHBvc3RUU2NvcmUgPSBwb3N0WiAhPT0gbnVsbCA/IGNhbGN1bGF0ZVRTY29yZShwb3N0WikgOiBudWxsOwogICAgICAgICAgICBjb25zdCB0R2FpbiA9IChwcmVUU2NvcmUgIT09IG51bGwgJiYgcG9zdFRTY29yZSAhPT0gbnVsbCkgPyBwb3N0VFNjb3JlIC0gcHJlVFNjb3JlIDogbnVsbDsKICAgICAgICAgICAgLy8gLS0tIEVORDog4Liq4LmI4Lin4LiZ4LiB4Liy4Lij4LiE4Liz4LiZ4Lin4LiTIFQtU2NvcmUgLS0tCgogICAgICAgICAgICByZXR1cm4geyBuYW1lLCBwcmVTY29yZSwgcG9zdFNjb3JlLCBnYWluLCBwcmVUU2NvcmUsIHBvc3RUU2NvcmUsIHRHYWluIH07CiAgICAgICAgfSk7CgogICAgICAgIHJlbmRlckluZGl2aWR1YWxDb21wYXJpc29uVGFibGUoY29tcGFyaXNvbkRhdGEsIGluZGl2aWR1YWxDb250ZW50RWwpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY29tcGFyaW5nIHJlc3VsdHM6IiwgZXJyb3IpOwogICAgICAgIG92ZXJhbGxDb250ZW50RWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LXJlZC01MDAgdGV4dC1jZW50ZXIiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4mjwvcD4nOwogICAgfQp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gPT09IFvguYPguKvguKHguYhdIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4miBCbHVlcHJpbnQgUHJvamVjdCBNYW5hZ2VyID09PQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8qKgogKiBbMV0g4Lia4Lix4LiZ4LiX4Li24LiB4LiC4LmJ4Lit4Lih4Li54Lil4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiBIEJsdWVwcmludCDguKXguIcgRmlyZXN0b3JlIOC5gOC4m+C5h+C4meC5guC4m+C4o+C5gOC4iOC4hOC5g+C4q+C4oeC5iAogKi8KYXN5bmMgZnVuY3Rpb24gc2F2ZUJsdWVwcmludFByb2plY3QoKSAgeyAvKiBSZW1vdmVkICovIH0gCgovKioKICogWzJdIOC5gOC4m+C4tOC4lCBNb2RhbCDguYHguKXguLDguYHguKrguJTguIfguKPguLLguKLguIHguLLguKPguYLguJvguKPguYDguIjguITguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYkKICovCmFzeW5jIGZ1bmN0aW9uIHNob3dCbHVlcHJpbnRQcm9qZWN0cygpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0cy1tb2RhbCcpOwogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LWxpc3QnKTsKICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguLPguKXguLHguIfguYLguKvguKXguJQuLi48L3A+JzsKICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKdHJ5IHsKICAgIGNvbnN0IHByb2plY3RzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0c2ApOwogICAgLy8gdnZ2IOC5geC4geC5ieC5hOC4guC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iSB2dnYKICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhwcm9qZWN0c1JlZik7IAoKICAgICAgICBpZiAoc25hcHNob3QuZW1wdHkpIHsKICAgICAgICAgICAgbGlzdEVsLmlubmVySFRNTCA9ICc8cCBjbGFzcz0icC00IHRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5iTwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKICAgICAgICBwcm9qZWN0cy5zb3J0KChhLCBiKSA9PiBhLnByb2plY3ROYW1lLmxvY2FsZUNvbXBhcmUoYi5wcm9qZWN0TmFtZSwgJ3RoJykpOwoKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gcHJvamVjdHMubWFwKHAgPT4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC10ZWFsLTcwMCI+JHtwLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4ke3AuZ3JhZGVMZXZlbH0gfCAke09iamVjdC5rZXlzKHAudG9waWNzKS5sZW5ndGh9IOC4q+C4seC4p+C4guC5ieC4rTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cC5pZH0iIGNsYXNzPSJvcGVuLWJwLXByb2plY3QtYnRuIGJnLWJsdWUtMTAwIHRleHQtYmx1ZS03MDAgdGV4dC1zbSBweS0xIHB4LTMgcm91bmRlZC1tZCBob3ZlcjpiZy1ibHVlLTIwMCI+4LmA4Lib4Li04LiUPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3AuaWR9IiBjbGFzcz0iZGVsZXRlLWJwLXByb2plY3QtYnRuIGJnLXJlZC0xMDAgdGV4dC1yZWQtNzAwIHRleHQtc20gcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTIwMCBtbC0yIj7guKXguJo8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgKS5qb2luKCcnKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgYmx1ZXByaW50IHByb2plY3RzOiIsIGVycm9yKTsKICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1yZWQtNTAwIj7guYTguKHguYjguKrguLLguKHguLLguKPguJbguYLguKvguKXguJTguKPguLLguKLguIHguLLguKPguYTguJTguYk8L3A+JzsKICAgIH0KfQoKLyoqCiAqIFszXSDguYHguKrguJTguIfguKvguJnguYnguLLguIjguK3guIjguLHguJTguIHguLLguKPguKvguLHguKfguILguYnguK3guILguK3guIfguYLguJvguKPguYDguIjguITguJfguLXguYjguYDguKXguLfguK3guIEKICovCmFzeW5jIGZ1bmN0aW9uIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihwcm9qZWN0SWQpIHsKICAgIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQgPSBwcm9qZWN0SWQ7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXByb2plY3RzLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbAogICAgc2hvd1ZpZXcoJ2FkbWluLWRhc2hib2FyZCcpOyAvLyDguKPguLXguYDguIvguYfguJUgdmlldyDguIHguYjguK3guJkKICAgIHByb2plY3REYXNoYm9hcmRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJkgZGFzaGJvYXJkIOC4q+C4peC4seC4gQoKICAgIGNvbnN0IG1hbmFnZXJWaWV3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpOwogICAgbWFuYWdlclZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtdG9waWMtbGlzdC1jb250YWluZXInKS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgcHJvamVjdElkKTsKICAgICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwoKICAgICAgICBpZiAoIWRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguYLguJvguKPguYDguIjguIQiKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSB7IGlkOiBkb2NTbmFwLmlkLCAuLi5kb2NTbmFwLmRhdGEoKSB9OwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1wcm9qZWN0LXRpdGxlJykudGV4dENvbnRlbnQgPSBwcm9qZWN0RGF0YS5wcm9qZWN0TmFtZTsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtcmVmZXJlbmNlLWZpbGUtdXJsJykudmFsdWUgPSBwcm9qZWN0RGF0YS5yZWZlcmVuY2VGaWxlVXJsIHx8ICcnOwogICAgICAgIHJlbmRlckJsdWVwcmludFRvcGljTWFuYWdlcihwcm9qZWN0RGF0YSk7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGRpc3BsYXlpbmcgYmx1ZXByaW50IHByb2plY3Q6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGVycm9yLm1lc3NhZ2UpOwogICAgICAgIHNob3dWaWV3KCdhZG1pbi1kYXNoYm9hcmQnKTsgLy8g4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiB4LiW4LmJ4LiyIEVycm9yCiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgcmVuZGVyQmx1ZXByaW50VG9waWNNYW5hZ2VyIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZnVuY3Rpb24gcmVuZGVyQmx1ZXByaW50VG9waWNNYW5hZ2VyKHByb2plY3REYXRhKSB7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnAtdG9waWMtbGlzdC1jb250YWluZXInKTsKICAgIGNvbnN0IHRvcGljc01hcCA9IHByb2plY3REYXRhLnRvcGljcyB8fCB7fTsKCiAgICBpZiAoT2JqZWN0LmtleXModG9waWNzTWFwKS5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguKvguLHguKfguILguYnguK3guYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIFsgU1RBUlQ6IOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC4l+C4teC5iOC4quC4s+C4hOC4seC4jeC4l+C4teC5iOC4quC4uOC4lCBdIC0tLQogICAgLy8gMS4g4LmB4Lib4Lil4LiHIE9iamVjdCDguYDguJvguYfguJkgQXJyYXkg4LmB4Lil4Liw4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LiV4Liy4LihICdvcmRlcicg4LiX4Li14LmI4Lia4Lix4LiZ4LiX4Li24LiB4LmE4Lin4LmJCiAgICBjb25zdCBzb3J0ZWRUb3BpY3NBcnJheSA9IE9iamVjdC5lbnRyaWVzKHRvcGljc01hcCkKICAgICAgICAubWFwKChbaWQsIGRhdGFdKSA9PiAoeyBpZCwgLi4uZGF0YSB9KSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gKGEub3JkZXIgPz8gSW5maW5pdHkpIC0gKGIub3JkZXIgPz8gSW5maW5pdHkpKTsKCiAgICAvLyAyLiDguIjguLHguJTguIHguKXguLjguYjguKHguILguYnguK3guKHguLnguKXguYPguKvguKHguYjguIjguLLguIEgQXJyYXkg4LiX4Li14LmI4LmA4Lij4Li14Lii4LiH4Lil4Liz4LiU4Lix4Lia4LmB4Lil4LmJ4LinCiAgICBjb25zdCBncm91cGVkVG9waWNzID0ge307CiAgICBzb3J0ZWRUb3BpY3NBcnJheS5mb3JFYWNoKHRvcGljID0+IHsKICAgICAgICBjb25zdCB7IHNhcmEsIG1haW5Ub3BpYyB9ID0gdG9waWM7CiAgICAgICAgaWYgKCFncm91cGVkVG9waWNzW3NhcmFdKSB7CiAgICAgICAgICAgIGdyb3VwZWRUb3BpY3Nbc2FyYV0gPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKCFncm91cGVkVG9waWNzW3NhcmFdW21haW5Ub3BpY10pIHsKICAgICAgICAgICAgZ3JvdXBlZFRvcGljc1tzYXJhXVttYWluVG9waWNdID0gW107CiAgICAgICAgfQogICAgICAgIGdyb3VwZWRUb3BpY3Nbc2FyYV1bbWFpblRvcGljXS5wdXNoKHRvcGljKTsKICAgIH0pOwogICAgLy8gLS0tIFsgRU5EOiDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguYHguIHguYnguYTguIIgXSAtLS0KCiAgICBsZXQgaHRtbCA9ICcnOwogICAgLy8gMy4g4Lin4LiZ4Lil4Li54Lib4LmB4Liq4LiU4LiH4Lic4Lil4LmC4LiU4LiiICLguYTguKHguYjguYPguIrguYkgLnNvcnQoKSIg4Lit4Li14LiB4LiV4LmI4Lit4LmE4LibIOC5gOC4nuC4t+C5iOC4reC4o+C4seC4geC4qeC4peC4s+C4lOC4seC4muC5gOC4lOC4tOC4oQogICAgZm9yIChjb25zdCBzYXJhIGluIGdyb3VwZWRUb3BpY3MpIHsKICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCBzaGFkb3ctc20gbWItNCI+PGg0IGNsYXNzPSJmb250LWJvbGQgdGV4dC14bCB0ZXh0LWJsdWUtODAwIG1iLTMiPiR7c2FyYX08L2g0PmA7CiAgICAgICAgCiAgICAgICAgZm9yIChjb25zdCBtYWluVG9waWMgaW4gZ3JvdXBlZFRvcGljc1tzYXJhXSkgewogICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJtbC00IG1iLTMiPjxoNSBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWxnIHRleHQtZ3JheS03MDAgbWItMiI+JHttYWluVG9waWN9PC9oNT48ZGl2IGNsYXNzPSJzcGFjZS15LTEgcGwtNCBib3JkZXItbC0yIGJvcmRlci1ncmF5LTIwMCI+YDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4guC5ieC4reC4oeC4ueC4peC5g+C4meC4meC4teC5ieC4iOC4sOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC4luC4ueC4geC4leC5ieC4reC4h+C4reC4ouC4ueC5iOC5geC4peC5ieC4pwogICAgICAgICAgICBncm91cGVkVG9waWNzW3NhcmFdW21haW5Ub3BpY10uZm9yRWFjaCh0b3BpYyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpZCA9IHRvcGljLmlkOwogICAgICAgICAgICAgICAgY29uc3QgbGlua2VkUXVpenplcyA9IHRvcGljLmxpbmtlZFF1aXpJZHMgfHwgW107CiAgICAgICAgICAgICAgICBjb25zdCBpc0xpbmtlZCA9IGxpbmtlZFF1aXp6ZXMubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzTGVzc29uR2VuZXJhdGVkID0gdG9waWMuc3RhdHVzID09PSAnZ2VuZXJhdGVkJzsKCiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzQmFkZ2UgPSAnJzsKICAgICAgICAgICAgICAgIGlmIChpc0xpbmtlZCkgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0JhZGdlID0gYDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiBweS0xIHJvdW5kZWQtZnVsbCBiZy1jeWFuLTIwMCB0ZXh0LWN5YW4tODAwIj7guYDguIrguLfguYjguK3guKHguYLguKLguIfguYHguKXguYnguKcgKCR7bGlua2VkUXVpenplcy5sZW5ndGh9IOC4iuC4uOC4lCk8L3NwYW4+YDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzQmFkZ2UgPSBgPHNwYW4gY2xhc3M9InRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHB5LTEgcm91bmRlZC1mdWxsICR7aXNMZXNzb25HZW5lcmF0ZWQgPyAnYmctZ3JlZW4tMjAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNzAwJ30iPiR7aXNMZXNzb25HZW5lcmF0ZWQgPyAn4Liq4Lij4LmJ4Liy4LiH4LmB4Lil4LmJ4LinJyA6ICfguKLguLHguIfguYTguKHguYjguKrguKPguYnguLLguIcnfTwvc3Bhbj5gOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvbkRlcGVuZGVudEJ0bkRpc2FibGVkID0gIWlzTGVzc29uR2VuZXJhdGVkID8gJ2Rpc2FibGVkIGJnLWdyYXktNDAwIGN1cnNvci1ub3QtYWxsb3dlZCcgOiAnJzsKICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvbkRlcGVuZGVudEJ0blRpdGxlID0gIWlzTGVzc29uR2VuZXJhdGVkID8gJ+C4geC4o+C4uOC4k+C4suC4quC4o+C5ieC4suC4h+C4muC4l+C5gOC4o+C4teC4ouC4meC4geC5iOC4reC4mScgOiAnJzsKCiAgICAgICAgICAgICAgICBsZXQgbGVzc29uQnV0dG9uc0hUTUwgPSBpc0xlc3NvbkdlbmVyYXRlZAogICAgICAgICAgICAgICAgICAgID8gYDxidXR0b24gY2xhc3M9InZpZXctYnAtbGVzc29uLWJ0biB0ZXh0LXdoaXRlIGJnLWJsdWUtNjAwIGhvdmVyOm9wYWNpdHktODAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIj7guJTguLnguJrguJfguYDguKPguLXguKLguJk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJicC1nZW5lcmF0ZS1sZXNzb24tYnRuIHRleHQtd2hpdGUgYmctcHVycGxlLTYwMCBob3ZlcjpvcGFjaXR5LTgwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCI+4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmIPC9idXR0b24+YAogICAgICAgICAgICAgICAgICAgIDogYDxidXR0b24gY2xhc3M9ImJwLWdlbmVyYXRlLWxlc3Nvbi1idG4gdGV4dC13aGl0ZSBiZy10ZWFsLTYwMCBob3ZlcjpvcGFjaXR5LTgwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCI+4Liq4Lij4LmJ4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZPC9idXR0b24+YDsKCiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTIgYm9yZGVyLWIgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIGhvdmVyOmJnLXdoaXRlIiBkYXRhLXRvcGljLWlkPSIke2lkfSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCIgZGF0YS1maWVsZD0ic3ViVG9waWMiPiR7dG9waWMuc3ViVG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNCYWRnZX0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLW9wZW4tdG9waWMtYmFuay1idG4gdGV4dC1wdXJwbGUtNzAwIGJnLXB1cnBsZS0xMDAgaG92ZXI6YmctcHVycGxlLTIwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMSBweC0zIHJvdW5kZWQtbWQiIHRpdGxlPSLguYDguJvguLTguJTguITguKXguLHguIfguYHguJrguJrguJfguJTguKrguK3guJrguJvguKPguLDguIjguLPguKvguLHguKfguILguYnguK0iPjxpIGNsYXNzPSJmYXMgZmEtYm9vay1vcGVuIj48L2k+IOC4hOC4peC4seC4hzwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtY3JlYXRlLXRvcGljLXF1aXotYnRuIHRleHQtaW5kaWdvLTcwMCBiZy1pbmRpZ28tMTAwIGhvdmVyOmJnLWluZGlnby0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiI4Liy4LiB4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4LitIj7guKrguKPguYnguLLguIcgKOC4q+C4seC4p+C4guC5ieC4rSk8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLWNyZWF0ZS1jb250ZW50LXF1aXotYnRuIHRleHQtaW5kaWdvLTcwMCBiZy1pbmRpZ28tMTAwIGhvdmVyOmJnLWluZGlnby0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kICR7bGVzc29uRGVwZW5kZW50QnRuRGlzYWJsZWR9IiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Lix4LmI4Lin4LmE4Lib4LiI4Liy4LiB4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4Lia4LiX4LmA4Lij4Li14Lii4LiZICR7bGVzc29uRGVwZW5kZW50QnRuVGl0bGV9Ij7guKrguKPguYnguLLguIcgKOC5gOC4meC4t+C5ieC4reC4q+C4sik8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtY3JlYXRlLW9uZXQtcXVpei1idG4gdGV4dC13aGl0ZSBiZy1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby03MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lib4Lij4Liw4Lii4Li44LiB4LiV4LmMIChPLU5FVCkg4LiI4Liy4LiB4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4LitIj7guKrguKPguYnguLLguIcgKE8tTkVUKTwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2xlc3NvbkJ1dHRvbnNIVE1MfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnAtZWRpdC10b3BpYy1idG4gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LWJsdWUtNjAwIiB0aXRsZT0i4LmB4LiB4LmJ4LmE4LiCIj48aSBjbGFzcz0iZmFzIGZhLWVkaXQiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJwLWRlbGV0ZS10b3BpYy1idG4gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LXJlZC02MDAiIHRpdGxlPSLguKXguJoiPjxpIGNsYXNzPSJmYXMgZmEtdHJhc2gtYWx0Ij48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGh0bWwgKz0gYDwvZGl2PjwvZGl2PmA7CiAgICAgICAgfQogICAgICAgIGh0bWwgKz0gYDwvZGl2PmA7CiAgICB9CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVlcERlbGV0ZUJsdWVwcmludFByb2plY3QocHJvamVjdElkKSB7CiAgICAvLyAxLiDguJTguLbguIfguILguYnguK3guKHguLnguKXguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guKvguLLguIrguLfguYjguK3guKHguLLguKLguLfguJnguKLguLHguJkKICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBwcm9qZWN0SWQpOwogICAgY29uc3QgcHJvamVjdFNuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC5guC4m+C4o+C5gOC4iOC4hOC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4peC4miIpOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdFNuYXAuZGF0YSgpLnByb2plY3ROYW1lOwoKICAgIC8vIDIuIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4leC5iOC4suC4h+C4ouC4t+C4meC4ouC4seC4meC4l+C4teC5iOC4iuC4seC4lOC5gOC4iOC4meC5geC4peC4sOC4reC4seC4meC4leC4o+C4suC4ogogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiIIDEwMCUg4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmC4Lib4Lij4LmA4LiI4LiEICIke3Byb2plY3ROYW1lfSI/IOC4geC4suC4o+C4geC4o+C4sOC4l+C4s+C4meC4teC5ieC4iOC4sOC4peC4miAi4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIiDguYHguKXguLAgIuC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4h+C4reC4ouC4ueC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCIg4Lit4Lii4LmI4Liy4LiH4LiW4Liy4Lin4LijIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4geC4ueC5ieC4hOC4t+C4meC5hOC4lOC5iSFgLAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4s+C4peC4seC4h+C4peC4muC5guC4m+C4o+C5gOC4iOC4hOC5geC4peC4sOC4guC5ieC4reC4oeC4ueC4peC4l+C4teC5iOC5gOC4geC4teC5iOC4ouC4p+C4guC5ieC4reC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lC4uLiIpOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IHByb2plY3RTbmFwLmRhdGEoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvcGljcyA9IHByb2plY3REYXRhLnRvcGljcyB8fCB7fTsKCiAgICAgICAgICAgICAgICAvLyAzLiDguKPguKfguJrguKPguKfguKEgSUQg4LiC4Lit4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4Lie4Li34LmI4Lit4Liq4Lix4LmI4LiH4Lil4LiaCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRvcGljSWQgaW4gdG9waWNzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVzc29uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzLyR7cHJvamVjdElkfS9sZXNzb25zYCwgdG9waWNJZCk7CiAgICAgICAgICAgICAgICAgICAgYmF0Y2guZGVsZXRlKGxlc3NvblJlZik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNC4g4Lij4Lin4Lia4Lij4Lin4LihIElEIOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC5gOC4iuC4t+C5iOC4reC4oeC5guC4ouC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lCAo4LmD4LiK4LmJIFNldCDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguKXguJrguIvguYnguLMpCiAgICAgICAgICAgICAgICBjb25zdCBhbGxMaW5rZWRRdWl6SWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICAgICAgZm9yIChjb25zdCB0b3BpY0lkIGluIHRvcGljcykgewogICAgICAgICAgICAgICAgICAgIGlmICh0b3BpY3NbdG9waWNJZF0ubGlua2VkUXVpeklkcykgewogICAgICAgICAgICAgICAgICAgICAgICB0b3BpY3NbdG9waWNJZF0ubGlua2VkUXVpeklkcy5mb3JFYWNoKGlkID0+IGFsbExpbmtlZFF1aXpJZHMuYWRkKGlkKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDUuIOC4quC4seC5iOC4h+C4peC4muC5geC4muC4muC4l+C4lOC4quC4reC4muC5geC4leC5iOC4peC4sOC4iuC4uOC4lCAo4LiV4LmJ4Lit4LiH4LiX4Liz4LiZ4Lit4LiBIGJhdGNoIOC5gOC4nuC4o+C4suC4sCBoYW5kbGVEZWxldGVRdWl6IOC4oeC4teC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4i+C4seC4muC4i+C5ieC4reC4meC4guC4reC4h+C4leC4seC4p+C5gOC4reC4hykKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcXVpeklkIG9mIGFsbExpbmtlZFF1aXpJZHMpIHsKICAgICAgICAgICAgICAgICAgICAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguKXguJrguYHguJrguJrguJfguJTguKrguK3guJrguYDguJTguLTguKEg4LmB4LiV4LmI4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4Liq4LiU4LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiX4Li44LiB4LiE4Lij4Lix4LmJ4LiHCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgaGFuZGxlRGVsZXRlUXVpeihxdWl6SWQsIGZhbHNlKTsgCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gNi4g4Liq4Lix4LmI4LiH4Lil4Lia4LiV4Lix4Lin4LmC4Lib4Lij4LmA4LiI4LiEIEJsdWVwcmludCDguYDguK3guIcKICAgICAgICAgICAgICAgIGJhdGNoLmRlbGV0ZShwcm9qZWN0UmVmKTsKCiAgICAgICAgICAgICAgICAvLyA3LiDguKLguLfguJnguKLguLHguJnguIHguLLguKPguKXguJrguJfguLHguYnguIfguKvguKHguJTguYPguJnguITguKPguLHguYnguIfguYDguJTguLXguKLguKcKICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguKXguJrguYLguJvguKPguYDguIjguIQgIiR7cHJvamVjdE5hbWV9IiDguYHguKXguLDguILguYnguK3guKHguLnguKXguJfguLXguYjguYDguIrguLfguYjguK3guKHguYLguKLguIfguJfguLHguYnguIfguKvguKHguJTguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgICAgICAgICBzaG93Qmx1ZXByaW50UHJvamVjdHMoKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiK4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiE4LmD4LiZIE1vZGFsCgogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIGRlZXAgZGVsZXRlOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguKPguYnguLLguKLguYHguKPguIfguKPguLDguKvguKfguYjguLLguIfguIHguLLguKPguKXguJrguILguYnguK3guKHguLnguKUiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpIHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpOwogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLWJhbmstbGlzdCcpOwogICAgY29uc3QgY2xlYXJBbGxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xlYXItYWxsLWxpbmtzLWJ0bicpOyAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguJTguLbguIfguJvguLjguYjguKHguYPguKvguKHguYgKICAgIAogICAgdHJ5IHsKICAgICAgICBhd2FpdCBlbnN1cmVHbG9iYWxRdWl6emVzTG9hZGVkKCk7CgogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBjb25zdCBwcm9qZWN0U25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICBpZiAoIXByb2plY3RTbmFwLmV4aXN0cygpKSByZXR1cm47CiAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBwcm9qZWN0U25hcC5kYXRhKCk7CiAgICAgICAgY29uc3QgdG9waWNEYXRhID0gcHJvamVjdERhdGEudG9waWNzW3RvcGljSWRdOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9waWMtYmFuay1zdWJ0b3BpYy1uYW1lJykudGV4dENvbnRlbnQgPSB0b3BpY0RhdGEuc3ViVG9waWM7CiAgICAgICAgCiAgICAgICAgY29uc3QgbGlua2VkUXVpeklkcyA9IHRvcGljRGF0YS5saW5rZWRRdWl6SWRzIHx8IFtdOwoKICAgICAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguITguKfguJrguITguLjguKHguIHguLLguKPguYHguKrguJTguIfguJzguKXguILguK3guIfguJvguLjguYjguKEgIuC4peC5ieC4suC4h+C4l+C4seC5ieC4h+C4q+C4oeC4lCIKICAgICAgICBjbGVhckFsbEJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCBsaW5rZWRRdWl6SWRzLmxlbmd0aCA9PT0gMCk7CiAgICAgICAgY2xlYXJBbGxCdG4ub25jbGljayA9ICgpID0+IGhhbmRsZUNsZWFyQWxsTGlua3NGb3JUb3BpYyh0b3BpY0lkKTsKCiAgICAgICAgaWYgKGxpbmtlZFF1aXpJZHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGxpc3RFbC5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAgcC04Ij7guITguKXguLHguIfguJnguLXguYnguKLguLHguIfguKfguYjguLLguIfguK3guKLguLnguYg8YnI+4LiE4Lil4Li04LiBICLguYDguKXguLfguK3guIHguIjguLLguIHguITguKXguLHguIfguKPguKfguKEiIOC5gOC4nuC4t+C5iOC4reC5gOC4nuC4tOC5iOC4oeC5geC4muC4muC4l+C4lOC4quC4reC4mjwvcD4nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmtlZFF1aXp6ZXMgPSBhbGxRdWl6emVzR2xvYmFsLmZpbHRlcihxID0+IGxpbmtlZFF1aXpJZHMuaW5jbHVkZXMocS5pZCkpOwogICAgICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gbGlua2VkUXVpenplcy5tYXAocSA9PiBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIGhvdmVyOmJnLWdyYXktNTAiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgZGF0YS1xdWl6LWlkPSIke3EuaWR9IiBjbGFzcz0iYnAtdmlldy1hbmFseXNpcy1idG4gZmxleC1ncm93IGN1cnNvci1wb2ludGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgcG9pbnRlci1ldmVudHMtbm9uZSI+JHtxLnRvcGljfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCBmb250LW1vbm8gcG9pbnRlci1ldmVudHMtbm9uZSI+SUQ6ICR7cS5pZH0gfCAke3EucXVlc3Rpb25zLmxlbmd0aH0g4LiC4LmJ4LitPC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0xIHNocmluay0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC1wcmVzZW50LWJ0biB0ZXh0LXB1cnBsZS04MDAgYmctcHVycGxlLTEwMCBob3ZlcjpiZy1wdXJwbGUtMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IuC4meC4s+C5gOC4quC4meC4rSI+PGkgY2xhc3M9ImZhcyBmYS1jaGFsa2JvYXJkLXRlYWNoZXIiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC10cnktYnRuIHRleHQtdGVhbC04MDAgYmctdGVhbC0xMDAgaG92ZXI6YmctdGVhbC0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4LiX4LiU4Lil4Lit4LiHIj48aSBjbGFzcz0iZmFzIGZhLXZpYWwiPjwvaT48L2J1dHRvbj4KPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGNsYXNzPSJicC1saXZlLWJ0biB0ZXh0LW9yYW5nZS04MDAgYmctb3JhbmdlLTEwMCBob3ZlcjpiZy1vcmFuZ2UtMjAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IuC5geC4guC5iOC4h+C4guC4seC4meC4quC4lCI+PGkgY2xhc3M9ImZhcyBmYS1mbGFnLWNoZWNrZXJlZCI+PC9pPjwvYnV0dG9uPgoKPGJ1dHRvbiBkYXRhLXF1aXotaWQ9IiR7cS5pZH0iIGRhdGEtbW9kZT0ic3luYyIgY2xhc3M9ImJwLWdhbWUtYnRuIHRleHQtd2hpdGUgYmctaW5kaWdvLTYwMCBob3ZlcjpiZy1pbmRpZ28tNzAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweS0xIHB4LTMgcm91bmRlZC1tZCIgdGl0bGU9IlN5bmMgTW9kZSI+CiAgICA8aSBjbGFzcz0iZmFzIGZhLWJvbHQiPjwvaT4gU3luYwo8L2J1dHRvbj4KCjxidXR0b24gZGF0YS10b3BpYy1pZD0iJHt0b3BpY0lkfSIgZGF0YS1xdWl6LWlkPSIke3EuaWR9IiBjbGFzcz0iYnAtdW5saW5rLXF1aXotYnRuIHRleHQtcmVkLTgwMCBiZy1yZWQtMTAwIGhvdmVyOmJnLXJlZC0yMDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB5LTEgcHgtMyByb3VuZGVkLW1kIiB0aXRsZT0i4LiZ4Liz4Lit4Lit4LiB4LiI4Liy4LiB4LiE4Lil4Lix4LiH4LiZ4Li14LmJIj48aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCI+PC9pPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGApLmpvaW4oJycpOwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1mcm9tLWdsb2JhbC1iYW5rLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgIG9wZW5RdWl6U2VsZWN0b3JGb3JCbHVlcHJpbnQodG9waWNJZCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtdG9waWMtYmFuay1idG4nKS5vbmNsaWNrID0gKCkgPT4gbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBzaG93TWVzc2FnZShlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBvcGVuUXVpelNlbGVjdG9yRm9yQmx1ZXByaW50IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSAtLS0KYXN5bmMgZnVuY3Rpb24gb3BlblF1aXpTZWxlY3RvckZvckJsdWVwcmludCh0b3BpY0lkKSB7CiAgICBjb25zdCBnbG9iYWxCYW5rTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1iYW5rLW1vZGFsJyk7CiAgICBjb25zdCB0b3BpY0JhbmtNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BpYy1xdWl6LWJhbmstbW9kYWwnKTsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0gMS4g4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHICLguITguKXguLHguIfguJvguKPguLDguIjguLPguKvguLHguKfguILguYnguK0iIOC4geC5iOC4reC4meC5gOC4quC4oeC4rQogICAgdG9waWNCYW5rTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbGluay1xdWl6LWJ0bicpPy5yZW1vdmUoKTsKCiAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBjb25maXJtQnRuLmlkID0gJ2NvbmZpcm0tbGluay1xdWl6LWJ0bic7CiAgICBjb25maXJtQnRuLmNsYXNzTmFtZSA9ICdiZy1wdXJwbGUtNjAwIHRleHQtd2hpdGUgcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1wdXJwbGUtNzAwIGRpc2FibGVkOmJnLWdyYXktNDAwJzsKICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4LmA4Lie4Li04LmI4Lih4Lij4Liy4Lii4LiB4Liy4Lij4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBJzsKICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlOwoKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgZW5zdXJlR2xvYmFsUXVpenplc0xvYWRlZCgpOwoKICAgICAgICBnbG9iYWxCYW5rTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgcmVuZGVyUXVpekJhbmtMaXN0Rm9yTXVsdGlTZWxlY3QoJycpOwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWxrLXF1aXotc2V0dGluZ3MtYnRuJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICBnbG9iYWxCYW5rTW9kYWwucXVlcnlTZWxlY3RvcignLmZsZXguanVzdGlmeS1iZXR3ZWVuLml0ZW1zLWNlbnRlcicpLmFwcGVuZENoaWxkKGNvbmZpcm1CdG4pOwoKICAgICAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSAyLiDguKrguKPguYnguLLguIfguJ/guLHguIfguIHguYzguIrguLHguJkgY2xlYW51cCDguYPguKvguKHguYjguYPguKvguYnguIHguKXguLHguJrguKHguLLguYDguJvguLTguJTguKvguJnguYnguLLguJXguYjguLLguIfguYDguJTguLTguKEKICAgICAgICBjb25zdCBjbGVhbnVwID0gKHNob3VsZFJlb3BlblRvcGljQmFuayA9IGZhbHNlKSA9PiB7CiAgICAgICAgICAgIGdsb2JhbEJhbmtNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1idG4nKS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgICAgICBjb25maXJtQnRuLnJlbW92ZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiIICjguYDguIrguYjguJkg4LiB4LiU4Lii4LiB4LmA4Lil4Li04LiBKSDguYPguKvguYnguIHguKXguLHguJrguKHguLLguYDguJvguLTguJTguKvguJnguYnguLIgIuC4hOC4peC4seC4h+C4m+C4o+C4sOC4iOC4s+C4q+C4seC4p+C4guC5ieC4rSIg4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiHCiAgICAgICAgICAgIGlmIChzaG91bGRSZW9wZW5Ub3BpY0JhbmspIHsKICAgICAgICAgICAgICAgIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY29uZmlybUJ0bi5vbmNsaWNrID0gYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBzZWxlY3RlZElkcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnF1aXotYmFuay1jaGVja2JveDpjaGVja2VkJykpLm1hcChjYiA9PiBjYi52YWx1ZSk7CiAgICAgICAgICAgIGlmIChzZWxlY3RlZElkcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gKGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKSkuZGF0YSgpOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudExpbmtlZElkcyA9IHByb2plY3REYXRhLnRvcGljc1t0b3BpY0lkXS5saW5rZWRRdWl6SWRzIHx8IFtdOwogICAgICAgICAgICAgICAgY29uc3QgbmV3SWRzID0gWy4uLm5ldyBTZXQoWy4uLmN1cnJlbnRMaW5rZWRJZHMsIC4uLnNlbGVjdGVkSWRzXSldOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICAgICAgICAgIFtgdG9waWNzLiR7dG9waWNJZH0ubGlua2VkUXVpeklkc2BdOiBuZXdJZHMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4nuC4tOC5iOC4oSAke3NlbGVjdGVkSWRzLmxlbmd0aH0g4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lil4LiH4LmD4LiZ4LiE4Lil4Lix4LiH4Liq4Liz4LmA4Lij4LmH4LiIIWApOwogICAgICAgICAgICAgICAgY2xlYW51cCh0cnVlKTsgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJIGNsZWFudXAg4LmB4Lil4Liw4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04LihCiAgICAgICAgICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGxpbmtpbmcgcXVpenplczoiLCBlcnJvcik7IH0KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1iYW5rLWJ0bicpLm9uY2xpY2sgPSAoKSA9PiBjbGVhbnVwKHRydWUpOyAvLyDguIHguJTguKLguIHguYDguKXguLTguIEg4LmD4Lir4LmJIGNsZWFudXAg4LmB4Lil4Liw4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04LihCgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBzaG93TWVzc2FnZShlcnJvci5tZXNzYWdlKTsKICAgICAgICAvLyDguKvguLLguIHguYDguIHguLTguJQgRXJyb3Ig4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04Lih4LiU4LmJ4Lin4LiiCiAgICAgICAgdG9waWNCYW5rTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICB9Cn0KCgpmdW5jdGlvbiBoYW5kbGVDbGVhckxpbmtlZFF1aXoodG9waWNJZCkgewogICAgc2hvd0NvbmZpcm1hdGlvbigi4LiE4Li44LiT4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJ4LmD4LiK4LmI4Lir4Lij4Li34Lit4LmE4Lih4LmIPyIsIGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7CiAgICAgICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9LmxpbmtlZFF1aXpJZGBdOiBkZWxldGVGaWVsZCgpIC8vIOC5g+C4iuC5iSBkZWxldGVGaWVsZCgpIOC5gOC4nuC4t+C5iOC4reC4peC4miBrZXkg4Lit4Lit4LiBCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiK4Lir4LiZ4LmJ4Liy4LiI4LitCiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgY2xlYXJpbmcgbGlua2VkIHF1aXo6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUIik7CiAgICAgICAgfQogICAgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGFkZFRvcGljVG9Qcm9qZWN0KCkgewogICAgY29uc3QgbmV3VG9waWNOYW1lID0gcHJvbXB0KCLguIHguKPguLjguJPguLLguJvguYnguK3guJnguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guKLguYjguK3guKLguYPguKvguKHguYg6Iik7CiAgICBpZiAoIW5ld1RvcGljTmFtZSB8fCBuZXdUb3BpY05hbWUudHJpbSgpID09PSAnJykgcmV0dXJuOwoKICAgIGNvbnN0IG5ld1NhcmEgPSBwcm9tcHQoIuC4reC4ouC4ueC5iOC5g+C4meC4quC4suC4o+C4sOC4geC4suC4o+C5gOC4o+C4teC4ouC4meC4o+C4ueC5ieC5g+C4lDoiLCAi4Liq4Liy4Lij4Liw4LiX4Li14LmIIDEiKTsKICAgIGNvbnN0IG5ld01haW5Ub3BpYyA9IHByb21wdCgi4Lit4Lii4Li54LmI4LmD4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lir4Lil4Lix4LiB4LmD4LiUOiIsICLguKvguLHguKfguILguYnguK3guKvguKXguLHguIHguYPguKvguKHguYgiKTsKCiAgICBjb25zdCBuZXdUb3BpY0lkID0gJ3RvcGljXycgKyBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpOwogICAgY29uc3QgbmV3VG9waWNEYXRhID0gewogICAgICAgIHNhcmE6IG5ld1NhcmEsCiAgICAgICAgbWFpblRvcGljOiBuZXdNYWluVG9waWMsCiAgICAgICAgc3ViVG9waWM6IG5ld1RvcGljTmFtZS50cmltKCksCiAgICAgICAgc3RhdHVzOiAibm90X2dlbmVyYXRlZCIsCiAgICAgICAgbGVzc29uQ29udGVudDogbnVsbAogICAgfTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke25ld1RvcGljSWR9YF06IG5ld1RvcGljRGF0YQogICAgICAgIH0pOwogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsgLy8gUmVmcmVzaAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBhZGRpbmcgdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguJ7guLTguYjguKHguKvguLHguKfguILguYnguK0iKTsKICAgIH0KfQoKLyoqCiAqIFs2XSBDUlVEOiDguYHguIHguYnguYTguILguIrguLfguYjguK3guKvguLHguKfguILguYnguK0KICovCmFzeW5jIGZ1bmN0aW9uIGVkaXRUb3BpY0luUHJvamVjdCh0b3BpY0lkKSB7CiAgICBjb25zdCB0b3BpY0RpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXRvcGljLWlkPSIke3RvcGljSWR9Il1gKTsKICAgIGNvbnN0IHN1YlRvcGljUCA9IHRvcGljRGl2LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWZpZWxkPSJzdWJUb3BpYyJdJyk7CiAgICBjb25zdCBjdXJyZW50TmFtZSA9IHN1YlRvcGljUC50ZXh0Q29udGVudDsKCiAgICBjb25zdCBuZXdOYW1lID0gcHJvbXB0KCLguYHguIHguYnguYTguILguIrguLfguYjguK3guKvguLHguKfguILguYnguK3guKLguYjguK3guKI6IiwgY3VycmVudE5hbWUpOwogICAgaWYgKCFuZXdOYW1lIHx8IG5ld05hbWUudHJpbSgpID09PSAnJyB8fCBuZXdOYW1lLnRyaW0oKSA9PT0gY3VycmVudE5hbWUpIHJldHVybjsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9LnN1YlRvcGljYF06IG5ld05hbWUudHJpbSgpCiAgICAgICAgfSk7CiAgICAgICAgc3ViVG9waWNQLnRleHRDb250ZW50ID0gbmV3TmFtZS50cmltKCk7IC8vIOC4reC4seC4m+C5gOC4lOC4lSBVSSDguJfguLHguJnguJfguLUKICAgICAgICBzaG93TWVzc2FnZSgi4LmB4LiB4LmJ4LmE4LiC4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGVkaXRpbmcgdG9waWM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYHguIHguYnguYTguIIiKTsKICAgIH0KfQoKLyoqCiAqIFs3XSBDUlVEOiDguKXguJrguKvguLHguKfguILguYnguK3guK3guK3guIHguIjguLLguIHguYLguJvguKPguYDguIjguIQKICovCmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVRvcGljRnJvbVByb2plY3QodG9waWNJZCkgewogICAgaWYgKCFjb25maXJtKCLguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguKvguLHguKfguILguYnguK3guJnguLXguYk/IikpIHJldHVybjsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocHJvamVjdFJlZiwgewogICAgICAgICAgICBbYHRvcGljcy4ke3RvcGljSWR9YF06IGRlbGV0ZUZpZWxkKCkgLy8g4LmD4LiK4LmJIGRlbGV0ZUZpZWxkKCkg4LmA4Lie4Li34LmI4Lit4Lil4LiaIGtleSDguK3guK3guIHguIjguLLguIEgbWFwCiAgICAgICAgfSk7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtdG9waWMtaWQ9IiR7dG9waWNJZH0iXWApLnJlbW92ZSgpOyAvLyDguKXguJrguK3guK3guIHguIjguLLguIEgVUkKICAgICAgICBzaG93TWVzc2FnZSgi4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGRlbGV0aW5nIHRvcGljOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4LiaIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVBbmRTYXZlTGVzc29uRm9yQmx1ZXByaW50IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVBbmRTYXZlTGVzc29uRm9yQmx1ZXByaW50KHRvcGljSWQsIHRvcGljTmFtZSwgZ3JhZGVMZXZlbCkgewogICAgaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uKHRvcGljTmFtZSwgZ3JhZGVMZXZlbCk7CgogICAgY29uc3QgY2hlY2tJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsKICAgICAgICBjb25zdCBsZXNzb25Nb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpOwogICAgICAgIGNvbnN0IGlzTW9kYWxIaWRkZW4gPSBsZXNzb25Nb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpOwoKICAgICAgICBpZiAoaXNNb2RhbEhpZGRlbikgewogICAgICAgICAgICBjbGVhckludGVydmFsKGNoZWNrSW50ZXJ2YWwpOwoKaWYgKGN1cnJlbnRBcHBsaWNhdGlvbkRhdGEgJiYgY3VycmVudEFwcGxpY2F0aW9uRGF0YS5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBsZXNzb25Db250ZW50ID0gewogICAgICAgIHBvaW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9pbnRDb250ZW50JykuaW5uZXJIVE1MLAogICAgICAgIG1lbW9yeTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbW9yeUNvbnRlbnQnKS5pbm5lckhUTUwsCiAgICAgICAgYXBwbGljYXRpb25IVE1MOiBnZXRDbGVhbkFwcGxpY2F0aW9uSFRNTCgpLAogICAgICAgIGFwcGxpY2F0aW9uRGF0YTogY3VycmVudEFwcGxpY2F0aW9uRGF0YSwKICAgICAgICBzdW1tYXJ5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3VtbWFyeUNvbnRlbnQnKS5pbm5lckhUTUwsCiAgICB9OwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4Liq4Lij4LmJ4Liy4LiHIFJlZmVyZW5jZSDguYTguJvguKLguLHguIcgMiDguJfguLXguYjguJfguLXguYjguYDguKPguLLguIjguLDguJrguLHguJnguJfguLbguIEKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgY29uc3QgbGVzc29uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzLyR7Y3VycmVudEJsdWVwcmludFByb2plY3RJZH0vbGVzc29uc2AsIHRvcGljSWQpOwoKICAgICAgICAvLyAyLiDguYPguIrguYkgImJhdGNoIiDguYDguJ7guLfguYjguK3guKrguLHguYjguIfguJrguLHguJnguJfguLbguIEgMiDguJfguLXguYjguJ7guKPguYnguK3guKHguIHguLHguJkKICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwoKICAgICAgICAvLyAgICAtIOC4hOC4s+C4quC4seC5iOC4hyBBOiDguJrguLHguJnguJfguLbguIHguILguYnguK3guKHguLnguKXguYPguKvguI3guYggKGxlc3NvbkNvbnRlbnQpIOC5hOC4m+C4l+C4teC5iOC5hOC4n+C4peC5jOC5g+C4q+C4oeC5iOC5g+C4mSBzdWJjb2xsZWN0aW9uICdsZXNzb25zJwogICAgICAgIGJhdGNoLnNldChsZXNzb25SZWYsIHsgY29udGVudDogbGVzc29uQ29udGVudCB9KTsKCiAgICAgICAgLy8gICAgLSDguITguLPguKrguLHguYjguIcgQjog4Lit4Lix4Lib4LmA4LiU4LiV4LmB4LiE4LmI4Liq4LiW4Liy4LiZ4LiwIChzdGF0dXMpIOC5g+C4meC5hOC4n+C4peC5jOC4q+C4peC4seC4geC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4geC4leC5jAogICAgICAgIGJhdGNoLnVwZGF0ZShwcm9qZWN0UmVmLCB7CiAgICAgICAgICAgIFtgdG9waWNzLiR7dG9waWNJZH0uc3RhdHVzYF06ICdnZW5lcmF0ZWQnCiAgICAgICAgfSk7CgogICAgICAgIC8vIDMuIOC4ouC4t+C4meC4ouC4seC4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4l+C4seC5ieC4h+C4q+C4oeC4lAogICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICBjb25zb2xlLmxvZyhg4Lia4Lix4LiZ4LiX4Li24LiB4Lia4LiX4LmA4Lij4Li14Lii4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Lir4Lix4Lin4LiC4LmJ4LitIElEOiAke3RvcGljSWR9IOC4quC4s+C5gOC4o+C5h+C4iGApOwogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIGxlc3NvbiB0byBwcm9qZWN0OiIsIGVycm9yKTsKICAgIH0KfQogICAgICAgIH0KICAgIH0sIDEwMDApOwp9CgpmdW5jdGlvbiBkaXNwbGF5SGFsZk1hcmtSZXN1bHQoc2NvcmUsIHRvdGFsUXVlc3Rpb25zKSB7CiAgICBjb25zdCBpc0Fib3ZlSGFsZiA9IHNjb3JlID49IHRvdGFsUXVlc3Rpb25zIC8gMjsKICAgIGNvbnN0IGJnQ29sb3IgPSBpc0Fib3ZlSGFsZiA/ICdiZy1ncmVlbi0xMDAnIDogJ2JnLXJlZC0xMDAnOwogICAgY29uc3QgaWNvbiA9IGlzQWJvdmVIYWxmID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtNXhsIHRleHQtZ3JlZW4tNTAwIG1iLTQiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtNXhsIHRleHQtcmVkLTUwMCBtYi00Ij48L2k+JzsKICAgIGNvbnN0IHRpdGxlQ29sb3IgPSBpc0Fib3ZlSGFsZiA/ICd0ZXh0LWdyZWVuLTgwMCcgOiAndGV4dC1yZWQtODAwJzsKICAgIGNvbnN0IHRpdGxlVGV4dCA9IGlzQWJvdmVIYWxmID8gJ+C4l+C4s+C4hOC4sOC5geC4meC4meC5hOC4lOC5ieC5gOC4geC4tOC4meC4hOC4o+C4tuC5iOC4hycgOiAn4LiE4Liw4LmB4LiZ4LiZ4Lii4Lix4LiH4LmE4Lih4LmI4LiW4Li24LiH4LiE4Lij4Li24LmI4LiHJzsKICAgIGNvbnN0IG1lc3NhZ2UgPSBpc0Fib3ZlSGFsZiA/ICfguKLguK3guJTguYDguKLguLXguYjguKLguKEhJyA6ICfguKrguLnguYnguYYg4Lil4Lit4LiH4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiH4LiZ4LiwJzsKCiAgICBsZXQgcmVzdWx0SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggJHtiZ0NvbG9yfSByb3VuZGVkLWxnIj4KICAgICAgICAgICAgJHtpY29ufQogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCAke3RpdGxlQ29sb3J9IG1iLTIiPiR7dGl0bGVUZXh0fTwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIj4ke21lc3NhZ2V9PC9wPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IHJlc3VsdEhUTUw7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgc2hvd1JhbmtpbmdzOiBmYWxzZSwgc2hvd0ltcHJvdmVCdXR0b246ICFpc0Fib3ZlSGFsZiB9KTsKfQoJCQpmdW5jdGlvbiBkaXNwbGF5UGVyZmVjdFNjb3JlUmVzdWx0KHNjb3JlLCB0b3RhbFF1ZXN0aW9ucykgewogICAgY29uc3QgaXNQZXJmZWN0ID0gc2NvcmUgPT09IHRvdGFsUXVlc3Rpb25zOwogICAgY29uc3QgYmdDb2xvciA9IGlzUGVyZmVjdCA/ICdiZy15ZWxsb3ctMTAwJyA6ICdiZy1ibHVlLTEwMCc7CiAgICBjb25zdCBpY29uID0gaXNQZXJmZWN0ID8gJzxpIGNsYXNzPSJmYXMgZmEtY3Jvd24gdGV4dC01eGwgdGV4dC15ZWxsb3ctNTAwIG1iLTQiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtYXdhcmQgdGV4dC01eGwgdGV4dC1ibHVlLTUwMCBtYi00Ij48L2k+JzsKICAgIGNvbnN0IHRpdGxlQ29sb3IgPSBpc1BlcmZlY3QgPyAndGV4dC15ZWxsb3ctODAwJyA6ICd0ZXh0LWJsdWUtODAwJzsKICAgIGNvbnN0IHRpdGxlVGV4dCA9IGlzUGVyZmVjdCA/ICfguITguLDguYHguJnguJnguYDguJXguYfguKEhJyA6ICfguKLguLHguIfguYTguKHguYjguYDguJXguYfguKHguJnguLAnOwogICAgY29uc3QgbWVzc2FnZSA9IGlzUGVyZmVjdCA/IGDguKrguLjguJTguKLguK3guJQhIOC4leC4reC4muC4luC4ueC4geC4l+C4uOC4geC4guC5ieC4rWAgOiBg4LmA4LiB4LmI4LiH4Lih4Liy4LiBISDguJ7guKLguLLguKLguLLguKHguK3guLXguIHguJnguLTguJTguYDguJ7guLfguYjguK3guITguLDguYHguJnguJnguYDguJXguYfguKFgOwoKICAgIGxldCByZXN1bHRIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCAke2JnQ29sb3J9IHJvdW5kZWQtbGciPgogICAgICAgICAgICAke2ljb259CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC00eGwgZm9udC1ib2xkICR7dGl0bGVDb2xvcn0gbWItMiI+JHt0aXRsZVRleHR9PC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS03MDAiPiR7bWVzc2FnZX08L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gcmVzdWx0SFRNTDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgCiAgICBzZXR1cFJlc3VsdFNjcmVlbkJhY2tCdXR0b24oeyBzaG93UmFua2luZ3M6IGZhbHNlLCBzY29yZSwgdG90YWxRdWVzdGlvbnMgfSk7Cn0KCmZ1bmN0aW9uIHJlbmRlckluZGl2aWR1YWxDb21wYXJpc29uVGFibGUoZGF0YSwgY29udGFpbmVyKSB7CiAgICAvLyDguYDguKPguLXguKLguIfguKXguLPguJTguLHguJrguJXguLLguKEg4Lie4Lix4LiS4LiZ4Liy4LiB4Liy4LijIFQtU2NvcmUgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIGRhdGEuc29ydCgoYSwgYikgPT4gKGIudEdhaW4gPz8gLUluZmluaXR5KSAtIChhLnRHYWluID8/IC1JbmZpbml0eSkpOwoKICAgIGxldCB0YWJsZUh0bWwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ib3ZlcmZsb3cteC1hdXRvIj4KICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJnLXdoaXRlIHRleHQtc20iPgogICAgICAgICAgICAgICAgPHRoZWFkIGNsYXNzPSJiZy1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgPHRyPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB3LTEyIj7guK3guLHguJnguJTguLHguJo8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWxlZnQiPuC4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4mTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guITguLDguYHguJnguJnguIHguYjguK3guJk8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciI+4LiE4Liw4LmB4LiZ4LiZ4Lir4Lil4Lix4LiHPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4nOC4peC4leC5iOC4suC4hyAo4LiU4Li04LiaKTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj7guJ7guLHguJLguJnguLLguIHguLLguKM8L3RoPgogICAgICAgICAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciI+VC1TY29yZSAo4LiB4LmI4Lit4LiZKTwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj5ULVNjb3JlICjguKvguKXguLHguIcpPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPuC4nuC4seC4kuC4meC4suC4geC4suC4oyAoVCk8L3RoPgogICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgPHRib2R5PgogICAgYDsKCiAgICBpZiAoZGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICB0YWJsZUh0bWwgKz0gJzx0cj48dGQgY29sc3Bhbj0iOSIgY2xhc3M9InRleHQtY2VudGVyIHAtNCB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguJnguLHguIHguYDguKPguLXguKLguJk8L3RkPjwvdHI+JzsKICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5mb3JFYWNoKChzdHVkZW50LCBpbmRleCkgPT4gewogICAgICAgICAgICBsZXQgZ2Fpbkh0bWwgPSAnLSc7CiAgICAgICAgICAgIGxldCBnYWluSWNvbkh0bWwgPSAnJzsKCiAgICAgICAgICAgIGlmIChzdHVkZW50LmdhaW4gIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gc3R1ZGVudC5nYWluID4gMCA/ICd0ZXh0LWdyZWVuLTYwMCcgOiAoc3R1ZGVudC5nYWluIDwgMCA/ICd0ZXh0LXJlZC02MDAnIDogJ3RleHQtZ3JheS01MDAnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSBzdHVkZW50LmdhaW4gPiAwID8gJysnIDogJyc7CiAgICAgICAgICAgICAgICBnYWluSHRtbCA9IGA8c3BhbiBjbGFzcz0iZm9udC1ib2xkICR7Y29sb3J9Ij4ke3NpZ259JHtzdHVkZW50LmdhaW59PC9zcGFuPmA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIC0tLSDguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLI6IOC5hOC4reC4hOC4reC4meC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC4nuC4seC4kuC4meC4suC4geC4suC4oyAtLS0KICAgICAgICAgICAgICAgIGlmIChzdHVkZW50LmdhaW4gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZ2Fpbkljb25IdG1sID0gJzxzcGFuIGNsYXNzPSJ0ZXh0LWdyZWVuLTUwMCIgdGl0bGU9IuC4nuC4seC4kuC4meC4suC4guC4tuC5ieC4mSI+4qyG77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0dWRlbnQuZ2FpbiA8IDApIHsKICAgICAgICAgICAgICAgICAgICBnYWluSWNvbkh0bWwgPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTUwMCIgdGl0bGU9IuC4peC4lOC4peC4hyI+4qyH77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGdhaW5JY29uSHRtbCA9ICc8c3BhbiBjbGFzcz0idGV4dC1ncmF5LTUwMCIgdGl0bGU9IuC4hOC4h+C4l+C4teC5iCI+4oaU77iPPC9zcGFuPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCB0R2Fpbkh0bWwgPSAnLSc7CiAgICAgICAgICAgIGlmIChzdHVkZW50LnRHYWluICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvciA9IHN0dWRlbnQudEdhaW4gPiAwID8gJ3RleHQtZ3JlZW4tNjAwJyA6IChzdHVkZW50LnRHYWluIDwgMCA/ICd0ZXh0LXJlZC02MDAnIDogJ3RleHQtZ3JheS01MDAnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpZ24gPSBzdHVkZW50LnRHYWluID4gMCA/ICcrJyA6ICcnOwogICAgICAgICAgICAgICAgdEdhaW5IdG1sID0gYDxzcGFuIGNsYXNzPSJmb250LWJvbGQgJHtjb2xvcn0iPiR7c2lnbn0ke3N0dWRlbnQudEdhaW4udG9GaXhlZCgyKX08L3NwYW4+YDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGFibGVIdG1sICs9IGAKICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQiPiR7aW5kZXggKyAxfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1sZWZ0Ij4ke3N0dWRlbnQubmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj4ke3N0dWRlbnQucHJlU2NvcmUgPz8gJy0nfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgZm9udC1ib2xkIj4ke3N0dWRlbnQucG9zdFNjb3JlID8/ICctJ308L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIj4ke2dhaW5IdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIgdGV4dC14bCI+JHtnYWluSWNvbkh0bWx9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtMyB0ZXh0LWNlbnRlciB0ZXh0LWJsdWUtNjAwIj4ke3N0dWRlbnQucHJlVFNjb3JlPy50b0ZpeGVkKDIpID8/ICctJ308L3RkPgogICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC0zIHRleHQtY2VudGVyIHRleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCI+JHtzdHVkZW50LnBvc3RUU2NvcmU/LnRvRml4ZWQoMikgPz8gJy0nfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTMgdGV4dC1jZW50ZXIiPiR7dEdhaW5IdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICBgOwogICAgICAgIH0pOwogICAgfQoKICAgIHRhYmxlSHRtbCArPSAnPC90Ym9keT48L3RhYmxlPjwvZGl2Pic7CiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gdGFibGVIdG1sOwp9CgovKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHIE1vZGFsIOC4quC4s+C4q+C4o+C4seC4muC5geC4geC5ieC5hOC4guC4iuC4t+C5iOC4reC5geC4muC4muC4l+C4lOC4quC4reC4mgogKiBAcGFyYW0ge3N0cmluZ30gcXVpeklkIC0gSUQg4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiI4Liw4LmB4LiB4LmJ4LmE4LiCCiAqIEBwYXJhbSB7c3RyaW5nfSB0b3BpYyAtIOC4iuC4t+C5iOC4reC4q+C4seC4p+C4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4mgogKi8KZnVuY3Rpb24gaGFuZGxlUmVuYW1lUXVpeihxdWl6SWQsIHRvcGljKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiBzZXR1cENvbXBhcmlzb25Nb2RhbFRhYnMoKSB7CiAgICBjb25zdCBvdmVyYWxsVGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tb3ZlcmFsbC10YWInKTsKICAgIGNvbnN0IGluZGl2aWR1YWxUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1pbmRpdmlkdWFsLXRhYicpOwogICAgY29uc3Qgb3ZlcmFsbENvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGFyaXNvbi1vdmVyYWxsLWNvbnRlbnQnKTsKICAgIGNvbnN0IGluZGl2aWR1YWxDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24taW5kaXZpZHVhbC1jb250ZW50Jyk7CgogICAgb3ZlcmFsbFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBvdmVyYWxsVGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgIGluZGl2aWR1YWxUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgb3ZlcmFsbENvbnRlbnQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgaW5kaXZpZHVhbENvbnRlbnQuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKCiAgICBpbmRpdmlkdWFsVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGluZGl2aWR1YWxUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgb3ZlcmFsbFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICBpbmRpdmlkdWFsQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBvdmVyYWxsQ29udGVudC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pOwp9CgovLyDguYPguJnguJ/guLHguIfguIHguYzguIrguLHguJkgc2V0dXBFdmVudExpc3RlbmVycygpCi8vIOC5g+C4q+C5ieC5gOC4nuC4tOC5iOC4oeC4geC4suC4o+C5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4myAxIOC4muC4o+C4o+C4l+C4seC4lAovLyAo4Lin4Liy4LiH4LmE4Lin4LmJ4LiV4Lij4LiH4LmE4Lir4LiZ4LiB4LmH4LmE4LiU4LmJ4Lig4Liy4Lii4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMpCnNldHVwQ29tcGFyaXNvbk1vZGFsVGFicygpOwoKCmZ1bmN0aW9uIGxpc3RlbkZvckxpdmVHYW1lVXBkYXRlcygpIHsKICAgIGlmICh1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIpIHVuc3Vic2NyaWJlTGl2ZUdhbWVMaXN0ZW5lcigpOwoKICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvbGl2ZUdhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgdW5zdWJzY3JpYmVMaXZlR2FtZUxpc3RlbmVyID0gb25TbmFwc2hvdChnYW1lUmVmLCAoZG9jU25hcCkgPT4gewogICAgICAgIGlmICghZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAvLyAtLS0gW1NUQVJUXSDguJnguLXguYjguITguLfguK3guKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguILguJfguLHguYnguIfguKvguKHguJQgLS0tCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguKHguKrguLTguYnguJnguKrguLjguJTguKXguIfguYHguKXguYnguKciKTsKCiAgICAgICAgICAgIGlmIChjYW1lRnJvbUJsdWVwcmludCAmJiBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKSB7CiAgICAgICAgICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIoY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRNb2RlID09PSAnYWRtaW4nKSB7CiAgICAgICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdzdHVkZW50Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBkb2NTbmFwLmRhdGEoKTsKCiAgICAgICAgaWYgKGdhbWVEYXRhLnNodWZmbGVkUXVpeikgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXo7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSAmJiBnYW1lRGF0YS5xdWl6SWQpIHsKICAgICAgICAgICAgKGFzeW5jICgpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVpekRvY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZ2FtZURhdGEucXVpeklkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWl6RG9jU25hcCA9IGF3YWl0IGdldERvYyhxdWl6RG9jUmVmKTsKICAgICAgICAgICAgICAgICAgICBpZiAocXVpekRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFF1aXpEYXRhID0geyBpZDogcXVpekRvY1NuYXAuaWQsIC4uLnF1aXpEb2NTbmFwLmRhdGEoKSB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIHF1aXogZm9yIGFkbWluOicsIGUpOyB9CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgfQoKICAgICAgICBzd2l0Y2ggKGdhbWVEYXRhLnN0YXR1cykgewogICAgICAgICAgICBjYXNlICdsb2JieSc6CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJzID0gZ2FtZURhdGEucGxheWVycyA/IE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMpIDogW107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWN0aXZlUGxheWVycyA9IHBsYXllcnMuZmlsdGVyKChbbmFtZSwgZGF0YV0pID0+IGRhdGEuc3RhdHVzID09PSAnYWN0aXZlJyk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckNvdW50RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWNvdW50Jyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGxheWVyQ291bnRFbCkgcGxheWVyQ291bnRFbC50ZXh0Q29udGVudCA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJMaXN0TG9iYnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWxpc3QtbG9iYnknKTsKICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXJMaXN0TG9iYnkpewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJMaXN0TG9iYnkuaW5uZXJIVE1MID0gYWN0aXZlUGxheWVycy5tYXAoKFtuYW1lLCBkYXRhXSkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUvMzAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0biB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQiIHRpdGxlPSLguYDguJXguLDguJzguLnguYnguYDguKXguYjguJnguJnguLXguYnguK3guK3guIEiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0R2FtZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydC1nYW1lLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGFydEdhbWVCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRHYW1lQnRuLmRpc2FibGVkID0gYWN0aXZlUGxheWVycy5sZW5ndGggPT09IDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzaG93VmlldygnbGl2ZS1nYW1lJyk7CiAgICAgICAgICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJsaXZlLWdhbWUtYmcgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCI+4LiE4Li44LiT4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmB4Lil4LmJ4LinITwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIG10LTIiPuC4iuC4t+C5iOC4reC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4rTogPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtjdXJyZW50U3R1ZGVudE5hbWV9PC9zcGFuPjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTgiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5gOC4o+C4tOC5iOC4oeC5gOC4geC4oeC4quC4seC4geC4hOC4o+C4ueC5iC4uLjwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG10LTQiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgJ3F1ZXN0aW9uJzoKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UXVpekRhdGEgJiYgY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9uc1txdWVzdGlvbkluZGV4XSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uRGF0YSA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25TdGF0dXMgPSBnYW1lRGF0YS5xdWVzdGlvblN0YXR1cyB8fCAnYW5zd2VyaW5nJzsKCiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChxdWVzdGlvblN0YXR1cykgewogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzdW1tYXJ5X2NoYXJ0JzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZG1pblN1bW1hcnlWaWV3KGdhbWVEYXRhLCBxdWVzdGlvbkRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93UGxheWVyU3VtbWFyeVZpZXcoZ2FtZURhdGEsIGN1cnJlbnRTdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ2xlYWRlcmJvYXJkJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUb3A1TGVhZGVyYm9hcmRWaWV3KGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnYW5zd2VyaW5nJzoKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ2FkbWluJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwZGF0ZXNNYWRlID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGdhbWVEYXRhLnBsYXllcnMpLmZvckVhY2goKFtwbGF5ZXJOYW1lLCBwbGF5ZXJEYXRhXSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyRGF0YS5zdGF0dXMgPT09ICdhY3RpdmUnICYmIHBsYXllckRhdGEuc3VibWl0dGVkQXQgJiYgIXBsYXllckRhdGEuaXNTY29yZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZXNNYWRlID0gdHJ1ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSBwbGF5ZXJEYXRhLnN1Ym1pdHRlZEF0LnRvRGF0ZSgpIC0gZ2FtZURhdGEucXVlc3Rpb25EaXNwbGF5ZWRBdC50b0RhdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjYWxjdWxhdGVkUG9pbnRzID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyRGF0YS5sYXN0QW5zd2VyQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFBvaW50cyA9IDEwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9udXNQb2ludHMgPSA1MDA7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVMaW1pdCA9IDIwMDAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGltZVJhdGlvID0gdGltZVRha2VuIC8gdGltZUxpbWl0OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lUmF0aW8gPiAxKSB0aW1lUmF0aW8gPSAxOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb2ludHNMb3N0ID0gTWF0aC5yb3VuZCh0aW1lUmF0aW8gKiBib251c1BvaW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsY3VsYXRlZFBvaW50cyA9IG1heFBvaW50cyAtIHBvaW50c0xvc3Q7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2xpdmVHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShwbGF5ZXJSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbYHBsYXllcnMuJHtwbGF5ZXJOYW1lfS5zY29yZWBdOiBpbmNyZW1lbnQoY2FsY3VsYXRlZFBvaW50cyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2BwbGF5ZXJzLiR7cGxheWVyTmFtZX0ucG9pbnRzTGFzdFF1ZXN0aW9uYF06IGNhbGN1bGF0ZWRQb2ludHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW2BwbGF5ZXJzLiR7cGxheWVyTmFtZX0uaXNTY29yZWRgXTogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwZGF0ZXNNYWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLmNvbW1pdCgpLmNhdGNoKGVyciA9PiBjb25zb2xlLmVycm9yKCJFcnJvciBjb21taXR0aW5nIHNjb3JlIHVwZGF0ZXM6IiwgZXJyKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFzdFJlbmRlcmVkQWRtaW5RdWVzdGlvbkluZGV4ICE9PSBxdWVzdGlvbkluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dBZG1pbkxpdmVRdWVzdGlvblZpZXcocXVlc3Rpb25EYXRhLCBxdWVzdGlvbkluZGV4LCBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RSZW5kZXJlZEFkbWluUXVlc3Rpb25JbmRleCA9IHF1ZXN0aW9uSW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbGxQbGF5ZXJzID0gZ2FtZURhdGEucGxheWVycyB8fCB7fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmVQbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhhbGxQbGF5ZXJzKS5maWx0ZXIocCA9PiBwLnN0YXR1cyA9PT0gJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsQWN0aXZlUGxheWVycyA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlcmVkQWN0aXZlUGxheWVycyA9IGFjdGl2ZVBsYXllcnMuZmlsdGVyKHAgPT4gcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSkubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbnN3ZXJDb3VudGVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5zd2VyLWNvdW50ZXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyQ291bnRlckVsKSBhbnN3ZXJDb3VudGVyRWwudGV4dENvbnRlbnQgPSBgJHthbnN3ZXJlZEFjdGl2ZVBsYXllcnN9LyR7dG90YWxBY3RpdmVQbGF5ZXJzfWA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtcGxheWVyLWxpc3QnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXJMaXN0Q29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGF5ZXJMaXN0SHRtbCA9IE9iamVjdC5lbnRyaWVzKGFsbFBsYXllcnMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChbbmFtZSwgZGF0YV0pID0+IGRhdGEuc3RhdHVzID09PSAnYWN0aXZlJykgLy8g4LiB4Lij4Lit4LiH4LmA4LiJ4Lie4Liy4Liw4LiE4LiZ4LiX4Li14LmI4Lii4Lix4LiH4Lit4Lii4Li54LmI4LmD4LiZ4LmA4LiB4LihCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKChbbmFtZSwgZGF0YV0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNBbnN3ZXJlZCA9IGRhdGEuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24gPT09IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmdDb2xvciA9IGhhc0Fuc3dlcmVkID8gJ2JnLWdyZWVuLTUwMCcgOiAnYmctZ3JheS01MDAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC13aGl0ZSB0ZXh0LXNtICR7YmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpY29ufQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+JHtuYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0biB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQiIHRpdGxlPSLguJnguLPguJzguLnguYnguYDguKXguYjguJnguJnguLXguYnguK3guK3guIEiPiZ0aW1lczs8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyTGlzdENvbnRhaW5lci5pbm5lckhUTUwgPSBwbGF5ZXJMaXN0SHRtbCB8fCAnPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTMwMCI+4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmD4LiK4LmJ4LiH4Liy4LiZ4Lit4Lii4Li54LmIPC9wPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBbRU5EXSDguKrguLTguYnguJnguKrguLjguJTguYLguITguYnguJTguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0b3RhbEFjdGl2ZVBsYXllcnMgPiAwICYmIGFuc3dlcmVkQWN0aXZlUGxheWVycyA9PT0gdG90YWxBY3RpdmVQbGF5ZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmVhbEFuc3dlckZvckFkbWluKHF1ZXN0aW9uSW5kZXgsIGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckRhdGEgPSBnYW1lRGF0YS5wbGF5ZXJzW2N1cnJlbnRTdHVkZW50TmFtZV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllckRhdGEgJiYgIXBsYXllckRhdGEuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1N0dWRlbnRMaXZlUXVlc3Rpb25WaWV3KHF1ZXN0aW9uRGF0YSwgcXVlc3Rpb25JbmRleCwgY3VycmVudFF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAncG9kaXVtJzoKICAgICAgICAgICAgICAgIHNob3dQb2RpdW1WaWV3KGdhbWVEYXRhLnBsYXllcnMsICdsaXZlLXJhY2UnKTsKICAgICAgICAgICAgICAgIGJyZWFrOyAgICAgICAKICAgICAgICB9CiAgICB9KTsKfQoJCQovLyDinIUg4LmC4LiE4LmJ4LiU4LmD4Lir4Lih4LmI4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCgovLyAxLiDguYDguJvguKXguLXguYjguKLguJnguIrguLfguYjguK3guJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguYnguKrguLfguYjguK3guITguKfguLLguKHguKvguKHguLLguKLguKHguLLguIHguILguLbguYnguJkKYXN5bmMgZnVuY3Rpb24gb3Blbkdsb2JhbEFjdGl2aXR5TW9kYWwoKSB7CiAgaWYgKGFsbFF1aXp6ZXNHbG9iYWwubGVuZ3RoID09PSAwKSB7CiAgICBjb25zdCBxcyA9IGF3YWl0IGdldERvY3MoY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCkpOwogICAgYWxsUXVpenplc0dsb2JhbCA9IHFzLmRvY3MubWFwKGQgPT4gKHsgaWQ6IGQuaWQsIC4uLmQuZGF0YSgpIH0pKTsKICB9CiAgcmVuZGVyR2xvYmFsQWN0aXZpdHlMaXN0KCcnKTsgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlciDguYPguKvguKHguYgKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2xvYmFsLWFjdGl2aXR5LW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCmZ1bmN0aW9uIHJlbmRlckdsb2JhbEFjdGl2aXR5TGlzdChmaWx0ZXJUZXh0ID0gJycpIHsKICBjb25zdCBsaXN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2xvYmFsLWFjdGl2aXR5LXF1aXotbGlzdCcpOwogIGNvbnN0IHRlcm0gPSBmaWx0ZXJUZXh0LnRvTG93ZXJDYXNlKCkudHJpbSgpOwoKICBjb25zdCByb3dzID0gYWxsUXVpenplc0dsb2JhbAogICAgLm1hcChxID0+ICh7CiAgICAgIC4uLnEsCiAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICB9KSkKICAgIC5maWx0ZXIocSA9PgogICAgICAocS50b3BpYyB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKSB8fAogICAgICAocS5wcm9qZWN0TmFtZSB8fCAnJykudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtKQogICAgKTsKCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1xdWl6LWNvdW50JykudGV4dENvbnRlbnQgPSBgKCR7cm93cy5sZW5ndGh9IOC4iuC4uOC4lClgOwoKICBsaXN0RWwuaW5uZXJIVE1MID0gcm93cy5sZW5ndGgKICAgID8gcm93cy5tYXAocSA9PiBgCiAgICAgICAgPGRpdiBjbGFzcz0icC0zIGJvcmRlci1iIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnYXAtNCBob3ZlcjpiZy1ncmF5LTUwIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtZ3JvdyI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTcwMCI+JHtxLnRvcGljIHx8ICco4LmE4Lih4LmI4Lih4Li14LiK4Li34LmI4LitKSd9CiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gZm9udC1ub3JtYWwgdGV4dC1ncmF5LTUwMCI+KCR7cS5xdWVzdGlvbnM/Lmxlbmd0aCB8fCAwfSDguILguYnguK0pPC9zcGFuPgogICAgICAgICAgICA8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAiPuC5guC4m+C4o+C5gOC4iOC4hDogJHtxLnByb2plY3ROYW1lfTwvcD4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICA8YnV0dG9uIGRhdGEtaWQ9IiR7cS5pZH0iIGRhdGEtbW9kZT0ibGl2ZS1yYWNlIiBjbGFzcz0iZ2FtZS1zdGFydC1idG4gYmctb3JhbmdlLTEwMCB0ZXh0LW9yYW5nZS04MDAgaG92ZXI6Ymctb3JhbmdlLTIwMCBmb250LXNlbWlib2xkIHB5LTIgcHgtMyByb3VuZGVkLWxnIHRleHQtc20iIHRpdGxlPSLguYHguILguYjguIfguILguLHguJnguKrguJQgKExpdmUgUmFjZSkiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mbGFnLWNoZWNrZXJlZCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAKICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWlkPSIke3EuaWR9IiBkYXRhLW1vZGU9InN5bmMiIGNsYXNzPSJnYW1lLXN0YXJ0LWJ0biBiZy1pbmRpZ28tNjAwIHRleHQtd2hpdGUgaG92ZXI6YmctaW5kaWdvLTcwMCBmb250LXNlbWlib2xkIHB5LTIgcHgtMyByb3VuZGVkLWxnIHRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1ib2x0IHBvaW50ZXItZXZlbnRzLW5vbmUiPjwvaT4gU3luYyBNb2RlCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgYCkuam9pbignJykKICAgIDogYDxkaXYgY2xhc3M9InAtNCB0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguJ7guJrguYHguJrguJrguJfguJTguKrguK3guJo8L2Rpdj5gOwp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUtpY2tQbGF5ZXIocGxheWVyTmFtZSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICBhc3luYyBmdW5jdGlvbiBhdXRoZW50aWNhdGVVc2VyKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfX2luaXRpYWxfYXV0aF90b2tlbiAhPT0gJ3VuZGVmaW5lZCcgJiYgX19pbml0aWFsX2F1dGhfdG9rZW4pIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaWduSW5XaXRoQ3VzdG9tVG9rZW4oYXV0aCwgX19pbml0aWFsX2F1dGhfdG9rZW4pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzaWduSW5Bbm9ueW1vdXNseShhdXRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkF1dGhlbnRpY2F0aW9uIGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Liy4Lij4Lii4Li34LiZ4Lii4Lix4LiZ4LiV4Lix4Lin4LiV4LiZ4Lil4LmJ4Lih4LmA4Lir4Lil4LinIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNob3dWaWV3IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSAtLS0KZnVuY3Rpb24gc2hvd1ZpZXcodmlldykgewogICAgLy8gLS0tIDEuIOC4i+C5iOC4reC4mSBWaWV3IOC4q+C4peC4seC4geC4l+C4seC5ieC4h+C4q+C4oeC4lOC4geC5iOC4reC4mSAtLS0KICAgIGFkbWluVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgcHJvamVjdERhc2hib2FyZFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBwcm9qZWN0RGV0YWlsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHF1aXpSZXN1bHRzVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIGxpdmVHYW1lVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4Lie4Li34LmI4Lit4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCBNYW5hZ2VyIOC5gOC4quC4oeC4rQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LW1hbmFnZXItdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIC0tLSAyLiDguIvguYjguK3guJkgVmlldyDguKLguYjguK3guKLguILguK3guIfguJ3guLHguYjguIcgU3R1ZGVudCAtLS0KICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRKb2luR2FtZVZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50TmFtZVNlbGVjdGlvblZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50UXVpekFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRSZWFkaW5nQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgLy8gLS0tIDMuIOC4i+C5iOC4reC4mSBWaWV3IOC4ouC5iOC4reC4ouC4reC4t+C5iOC4meC5hiDguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICBjb25zdCB0ZWFtU2VsZWN0aW9uVmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXRlYW0tc2VsZWN0aW9uLXZpZXcnKTsKICAgIGNvbnN0IHN0dWRlbnRQcm9ncmVzc1ZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9ncmVzcy12aWV3Jyk7CgogICAgaWYgKHRlYW1TZWxlY3Rpb25WaWV3KSB0ZWFtU2VsZWN0aW9uVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIGlmIChzdHVkZW50UHJvZ3Jlc3NWaWV3KSBzdHVkZW50UHJvZ3Jlc3NWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIC0tLSA0LiDguYHguKrguJTguIcgVmlldyDguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguJXguLLguKHguIrguLfguYjguK3guJfguLXguYjguKrguYjguIfguKHguLIgLS0tCiAgICBzd2l0Y2ggKHZpZXcpIHsKICAgICAgICBjYXNlICdhZG1pbi1kYXNoYm9hcmQnOgogICAgICAgICAgICBhZG1pblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHByb2plY3REYXNoYm9hcmRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdwcm9qZWN0LWRldGFpbCc6CiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgcHJvamVjdERldGFpbFZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3F1aXotcmVzdWx0cyc6CiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgcXVpelJlc3VsdHNWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50JzoKICAgICAgICAgICAgc3R1ZGVudFZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbGl2ZS1nYW1lJzoKICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50LXRlYW0tam9pbic6CiAgICAgICAgICAgICBzdHVkZW50Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgIGlmICh0ZWFtU2VsZWN0aW9uVmlldykgdGVhbVNlbGVjdGlvblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzdHVkZW50LXByb2dyZXNzJzoKICAgICAgICAgICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgaWYgKHN0dWRlbnRQcm9ncmVzc1ZpZXcpIHN0dWRlbnRQcm9ncmVzc1ZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBzdHVkZW50Vmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudEluaXRpYWxWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICBicmVhazsKICAgIH0KfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNob3dKb2luR2FtZVZpZXcoKSB7CiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudEpvaW5HYW1lVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICB9CgkJCgkJLy8gLS0tIFsg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIF0gLS0tCgovLyAtLS0gWyDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlU2F2ZVZpc2liaWxpdHlTZXR0aW5ncygpIHsKICAgIGlmICghY3VycmVudFByb2plY3RJZCkgcmV0dXJuOwoKICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBjdXJyZW50UHJvamVjdElkKTsKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsKICAgICAgICAgICAgJ3NldHRpbmdzLnNob3dJblN0dWRlbnREYXNoYm9hcmQnOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvdy1pbi1zdHVkZW50LWRhc2hib2FyZC1jaGVja2JveCcpLmNoZWNrZWQsCiAgICAgICAgICAgICdzZXR0aW5ncy5pc1Bhc3Njb2RlRW5hYmxlZCc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlbmFibGUtcGFzc2NvZGUtY2hlY2tib3gnKS5jaGVja2VkLAogICAgICAgICAgICAnc2V0dGluZ3MucGFzc2NvZGUnOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1wYXNzY29kZS1pbnB1dCcpLnZhbHVlLnRyaW0oKQogICAgICAgIH0pOwogICAgICAgIHNob3dNZXNzYWdlKCLguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguIHguLLguKPguYHguKrguJTguIfguJzguKXguKrguLPguYDguKPguYfguIgiKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHZpc2liaWxpdHkgc2V0dGluZ3M6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIEiKTsKICAgIH0KfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHNldHVwRXZlbnRMaXN0ZW5lcnMoKSB7CgkJCgkJY29uc3Qgc2NhbkltZ0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjYW4tdGV4dC1pbWFnZS1pbnB1dCcpOwogICAgY29uc3Qgc2NhbkltZ0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2FuLXRleHQtaW1hZ2UtYnRuJyk7CgogICAgaWYgKHNjYW5JbWdJbnB1dCAmJiBzY2FuSW1nQnRuKSB7CiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LiB4LiU4Lib4Li44LmI4LihIC0+IOC5g+C4q+C5ieC4hOC4peC4tOC4gSBpbnB1dCBmaWxlCiAgICAgICAgc2NhbkltZ0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHNjYW5JbWdJbnB1dC5jbGljaygpKTsKCiAgICAgICAgLy8g4LmA4Lih4Li34LmI4Lit4LmA4Lil4Li34Lit4LiB4LmE4Lif4Lil4LmM4LmA4Liq4Lij4LmH4LiIIC0+IOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC5geC4geC4mQogICAgICAgIHNjYW5JbWdJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICBpZiAoZS50YXJnZXQuZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaGFuZGxlU2NhbkltYWdlRm9yVGV4dChlLnRhcmdldC5maWxlc1swXSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCQkKCQljb25zdCBhbGxJbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1hbGwtaW4tYnRuJyk7CiAgICBpZiAoYWxsSW5CdG4pIHsKICAgICAgICBhbGxJbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2xpZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLXNsaWRlcicpOwogICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLWFtb3VudC1kaXNwbGF5Jyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoc2xpZGVyKSB7CiAgICAgICAgICAgICAgICAvLyAxLiDguJXguLHguYnguIfguITguYjguLIgU2xpZGVyIOC5g+C4q+C5ieC4quC4uOC4lOC5geC4oeC5h+C4geC4i+C5jAogICAgICAgICAgICAgICAgc2xpZGVyLnZhbHVlID0gc2xpZGVyLm1heDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMi4g4Lit4Lix4Lib4LmA4LiU4LiV4LiV4Lix4Lin4LmA4Lil4LiC4LiX4Li14LmI4LmB4Liq4LiU4LiHCiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheSkgewogICAgICAgICAgICAgICAgICAgIGRpc3BsYXkudGV4dENvbnRlbnQgPSBzbGlkZXIudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lit4Lif4LmA4Lif4LiB4LiV4LmM4LiV4Lix4Lin4LmA4Lil4LiC4LmA4LiU4LmJ4LiH4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4LiiCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheS5jbGFzc0xpc3QucmVtb3ZlKCdzY2FsZS0xMjUnKTsgLy8g4Lij4Li14LmA4LiL4LmH4LiVIGNsYXNzCiAgICAgICAgICAgICAgICAgICAgdm9pZCBkaXNwbGF5Lm9mZnNldFdpZHRoOyAvLyB0cmlnZ2VyIHJlZmxvdwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXkuY2xhc3NMaXN0LmFkZCgndHJhbnNmb3JtJywgJ3RyYW5zaXRpb24tdHJhbnNmb3JtJywgJ3NjYWxlLTEyNScsICd0ZXh0LXJlZC02MDAnKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGRpc3BsYXkuY2xhc3NMaXN0LnJlbW92ZSgnc2NhbGUtMTI1JywgJ3RleHQtcmVkLTYwMCcpLCAyMDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC13YWdlci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXdhZ2VyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgY29uc3Qgd2FnZXJNb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1tb2RhbCcpOwogICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbi13YWdlcicpOwogICAgY29uc3Qgd2FnZXJBbW91bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FnZXItc2xpZGVyJykudmFsdWU7CgogICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4LmA4LiB4LmH4Lia4LmE4Lin4LmJCiAgICBjb25zdCBhbnN3ZXJWYWx1ZSA9IGhpZGRlbklucHV0LmRhdGFzZXQuYW5zd2VyVmFsdWU7CiAgICBjb25zdCBxdWVzdGlvbiA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5xdWVzdGlvbik7CiAgICBjb25zdCBnYW1lRGF0YSA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5nYW1lRGF0YSk7CiAgICBjb25zdCBwbGF5ZXJOYW1lID0gaGlkZGVuSW5wdXQuZGF0YXNldC5wbGF5ZXJOYW1lOwoKICAgIHdhZ2VyTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbAoKICAgIC8vIOC4quC5iOC4h+C4hOC4s+C4leC4reC4miArIOC4iOC4s+C4meC4p+C4meC5gOC4h+C4tOC4meC4l+C4teC5iOC5gOC4lOC4tOC4oeC4nuC4seC4mQogICAgaGFuZGxlU3luY0Fuc3dlclN1Ym1pdChhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJOYW1lLCBmYWxzZSwgd2FnZXJBbW91bnQpOwp9KTsKCQkKCQlkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtuYW1lPSJzeW5jVmFyaWFudCJdJykuZm9yRWFjaChyYWRpbyA9PiB7CiAgICByYWRpby5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgIGNvbnN0IGFub25TZXR0aW5ncyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbm9uLXNldHRpbmdzLWNvbnRhaW5lcicpOwogICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ2Fub255bW91cycpIHsKICAgICAgICAgICAgYW5vblNldHRpbmdzLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFub25TZXR0aW5ncy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9KTsKfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdGltZXItZW5hYmxlLWNoZWNrYm94JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXRpbWVyLWR1cmF0aW9uLWNvbnRhaW5lcicpLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFlLnRhcmdldC5jaGVja2VkKTsKfSk7CgkJCgkJY29uc3QgY2FuY2VsQ29uZmlkZW5jZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtY29uZmlkZW5jZS1idG4nKTsKY29uc3QgY29uZmlkZW5jZU1vZGFsRm9yQ2FuY2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKTsKaWYgKGNhbmNlbENvbmZpZGVuY2VCdG4gJiYgY29uZmlkZW5jZU1vZGFsRm9yQ2FuY2VsKSB7CiAgICBjYW5jZWxDb25maWRlbmNlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbmZpZGVuY2VNb2RhbEZvckNhbmNlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBjb25maWRlbmNlTW9kYWxGb3JDYW5jZWwuZGF0YXNldC5jdXJyZW50TW9kZSA9ICcnOyAvLyDguYDguITguKXguLXguKLguKPguYzguKrguJbguLLguJnguLAKICAgIH0pOwp9CgkJCgkJY29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaW0tb3ZlcmxheScpOwogICAgaWYgKG92ZXJsYXkpIHsKICAgICAgICAvLyDguYPguIrguYkgbW91c2Vkb3duIOC5geC4peC4sCB0b3VjaHN0YXJ0IOC5gOC4nuC4t+C5iOC4reC4iOC4seC4miBFdmVudCDguYPguKvguYnguYDguKPguYfguKfguJfguLXguYjguKrguLjguJTguIHguYjguK3guJnguJfguLXguYjguKHguLHguJnguIjguLDguJfguLDguKXguLgKICAgICAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHdha2VVcFNjcmVlbik7CiAgICAgICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgd2FrZVVwU2NyZWVuKTsKICAgIH0KCQkKLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1icC1yZWZlcmVuY2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICBpZiAoIWN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHJldHVybjsKICAgIGNvbnN0IHVybCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1yZWZlcmVuY2UtZmlsZS11cmwnKS52YWx1ZS50cmltKCk7CiAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICB0cnkgewogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7IHJlZmVyZW5jZUZpbGVVcmw6IHVybCB9KTsKICAgICAgICBzaG93TWVzc2FnZSgi4Lia4Lix4LiZ4LiX4Li24LiB4Lil4Li04LiH4LiB4LmM4LmE4Lif4Lil4LmM4Lit4LmJ4Liy4LiH4Lit4Li04LiH4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyByZWZlcmVuY2UgVVJMOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBIik7CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1wYXJhbGxlbC1zaG9ydGN1dC10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBZGRQYXJhbGxlbFNob3J0Y3V0VGFiKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LWlucHV0LWFyZWEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI29wZW4tYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtYnRuJykpIHsKICAgICAgICBhY3RpdmVQYXJhbGxlbFNob3J0Y3V0VGFiSWQgPSAnYWxsJzsKICAgICAgICByZW5kZXJBZGRpdGlvbmFsUGFyYWxsZWxTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLmdyb3VwXFwvZHJvcGRvd24tcGFyYWxsZWwnKSkgewogICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW92ZS1wYXJhbGxlbC1zaG9ydGN1dC1kcm9wZG93bicpLmZvckVhY2goZCA9PiBkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJLy8g4pa84pa84pa8IOC5g+C4meC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzZXR1cEV2ZW50TGlzdGVuZXJzKCkg4LmD4Lir4LmJ4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibIOKWvOKWvOKWvAoKLy8gLS0tIFtGaWxlIFNob3J0Y3V0IFRhYiBTeXN0ZW1dIC0tLQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLWZpbGUtc2hvcnRjdXQtdGFiLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQWRkRmlsZVNob3J0Y3V0VGFiKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLWlucHV0LWFyZWEnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnI29wZW4tYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4nKSkgewogICAgICAgIGFjdGl2ZUZpbGVTaG9ydGN1dFRhYklkID0gJ2FsbCc7CiAgICAgICAgcmVuZGVyQWRkaXRpb25hbEZpbGVTaG9ydGN1dHNNb2RhbCgpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWFkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmICghZS50YXJnZXQuY2xvc2VzdCgnLmdyb3VwXFwvZHJvcGRvd24tZmlsZScpKSB7IC8vIOC5g+C4iuC5iSBTZWxlY3RvciDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1vdmUtZmlsZS1zaG9ydGN1dC1kcm9wZG93bicpLmZvckVhY2goZCA9PiBkLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1zaG9ydGN1dC10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBZGRTaG9ydGN1dFRhYik7CgkJCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1jb250YWluZXInKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBzaG9ydGN1dEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZWRpdC1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcGFyYWxsZWwtc2hvcnRjdXQtYnRuJyk7CgogICAgaWYgKGVkaXRCdG4pIHsKICAgICAgICBvcGVuUGFyYWxsZWxUZXN0U2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4m+C4uOC5iOC4oeC4peC4seC4lOC4meC4teC5iT9gLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBwYXJhbGxlbFRlc3RTaG9ydGN1dHMuZmlsdGVyKHMgPT4gcy5pZCAhPT0gc2hvcnRjdXRJZCk7CiAgICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHByZWZSZWYsIHsgc2hvcnRjdXRzOiB1cGRhdGVkU2hvcnRjdXRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHNob3J0Y3V0QnRuKSB7CiAgICAgICAgaGFuZGxlUGFyYWxsZWxUZXN0U2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gb3BlblBhcmFsbGVsVGVzdFNob3J0Y3V0RWRpdG9yKG51bGwpKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcGFyYWxsZWwtc2hvcnRjdXQtZWRpdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC1zaG9ydGN1dC1lZGl0b3ItbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNhdmVQYXJhbGxlbFRlc3RTaG9ydGN1dENoYW5nZXMpOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXRlc3QtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjb3Blbi1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKSkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1hZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLXBhcmFsbGVsLXNob3J0Y3V0cy1saXN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1wYXJhbGxlbC1zaG9ydGN1dHMtbW9kYWwnKTsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LWhpZGRlbi1wYXJhbGxlbC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtaGlkZGVuLXBhcmFsbGVsLXNob3J0Y3V0LWJ0bicpOwoKICAgIGlmICh1c2VCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBoYW5kbGVQYXJhbGxlbFRlc3RTaG9ydGN1dENsaWNrKHVzZUJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIG9wZW5QYXJhbGxlbFRlc3RTaG9ydGN1dEVkaXRvcihlZGl0QnRuLmRhdGFzZXQuaWQpOwogICAgfSBlbHNlIGlmIChkZWxldGVCdG4pIHsKICAgICAgICBjb25zdCBzaG9ydGN1dElkID0gZGVsZXRlQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiU4LiZ4Li14LmJP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICBjb25zdCB1cGRhdGVkU2hvcnRjdXRzID0gcGFyYWxsZWxUZXN0U2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJwYXJhbGxlbFRlc3RTaG9ydGN1dHNDb25maWciKTsKICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBzaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgIH0pOwogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXNob3J0Y3V0LWNvbnRhaW5lcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IHNob3J0Y3V0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtZmlsZS1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtZmlsZS1zaG9ydGN1dC1idG4nKTsKCiAgICBpZiAoZWRpdEJ0bikgewogICAgICAgIG9wZW5GaWxlU2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIHNob3dDb25maXJtYXRpb24oYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4m+C4uOC5iOC4oeC4peC4seC4lOC4meC4teC5iT9gLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBmaWxlU2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZmlsZVNob3J0Y3V0c0NvbmZpZyIpOwogICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBzaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAoc2hvcnRjdXRCdG4pIHsKICAgICAgICBoYW5kbGVGaWxlU2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLWZpbGUtc2hvcnRjdXQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKG51bGwpKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZmlsZS1zaG9ydGN1dC1lZGl0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtc2hvcnRjdXQtZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1maWxlLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZUZpbGVTaG9ydGN1dENoYW5nZXMpOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcjb3Blbi1hZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLWJ0bicpKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0KfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtYWRkaXRpb25hbC1maWxlLXNob3J0Y3V0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRpdGlvbmFsLWZpbGUtc2hvcnRjdXRzLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbGlzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZGl0aW9uYWwtZmlsZS1zaG9ydGN1dHMtbW9kYWwnKTsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtaGlkZGVuLWZpbGUtc2hvcnRjdXQtYnRuJyk7CiAgICBjb25zdCBkZWxldGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZGVsZXRlLWhpZGRlbi1maWxlLXNob3J0Y3V0LWJ0bicpOwoKICAgIGlmICh1c2VCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBoYW5kbGVGaWxlU2hvcnRjdXRDbGljayh1c2VCdG4uZGF0YXNldC5pZCk7CiAgICB9IGVsc2UgaWYgKGVkaXRCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBvcGVuRmlsZVNob3J0Y3V0RWRpdG9yKGVkaXRCdG4uZGF0YXNldC5pZCk7CiAgICB9IGVsc2UgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgIGNvbnN0IHNob3J0Y3V0SWQgPSBkZWxldGVCdG4uZGF0YXNldC5pZDsKICAgICAgICBzaG93Q29uZmlybWF0aW9uKGDguITguLjguJPguYHguJnguYjguYPguIjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguJvguLjguYjguKHguKXguLHguJTguJnguLXguYk/YCwgYXN5bmMgKCkgPT4gewogICAgICAgICAgIGNvbnN0IHVwZGF0ZWRTaG9ydGN1dHMgPSBmaWxlU2hvcnRjdXRzLmZpbHRlcihzID0+IHMuaWQgIT09IHNob3J0Y3V0SWQpOwogICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJmaWxlU2hvcnRjdXRzQ29uZmlnIik7CiAgICAgICAgICAgYXdhaXQgc2V0RG9jKHByZWZSZWYsIHsgc2hvcnRjdXRzOiB1cGRhdGVkU2hvcnRjdXRzIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICB9KTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4mSBFdmVudCBMaXN0ZW5lcnMg4pay4pay4payCgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKEgIuC5gOC4nuC4tOC5iOC4oeC5gOC4leC4tOC4oSIg4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiUIE1vZGFsCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtaW5wdXQtYXJlYScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIC8vIOC4m+C4uOC5iOC4oSAi4Lib4Li44LmI4Lih4Lil4Lix4LiU4LmA4Lie4Li04LmI4Lih4LmA4LiV4Li04LihIgogICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJyNvcGVuLWFkZGl0aW9uYWwtc2hvcnRjdXRzLWJ0bicpKSB7CiAgICAgICAgYWN0aXZlU2hvcnRjdXRUYWJJZCA9ICdhbGwnOyAvLyDguKPguLXguYDguIvguYfguJXguYPguKvguYnguYDguJvguLTguJTguJfguLXguYjguYHguJfguYfguJogIuC4l+C4seC5ieC4h+C4q+C4oeC4lCIg4LmA4Liq4Lih4LitCiAgICAgICAgcmVuZGVyQWRkaXRpb25hbFNob3J0Y3V0c01vZGFsKCk7IC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4p+C4suC4lCBNb2RhbCDguYPguKvguKHguYjguILguK3guIfguYDguKPguLIKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0KfSk7CgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJvguLTguJQgKFgpIOC5g+C4mSBNb2RhbApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtYWRkaXRpb25hbC1zaG9ydGN1dHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgovLyDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJXguYjguLLguIfguYYgKOC5g+C4iuC5ieC4h+C4suC4mSwg4LmB4LiB4LmJ4LmE4LiCLCDguKXguJopIOC4l+C4teC5iOC4reC4ouC4ueC5iOC5g+C4mSBNb2RhbApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbGlzdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IHVzZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy51c2UtaGlkZGVuLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LWhpZGRlbi1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtaGlkZGVuLXNob3J0Y3V0LWJ0bicpOwogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkaXRpb25hbC1zaG9ydGN1dHMtbW9kYWwnKTsKCiAgICBpZiAodXNlQnRuKSB7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJkKICAgICAgICBoYW5kbGVTaG9ydGN1dENsaWNrKHVzZUJ0bi5kYXRhc2V0LmlkKTsgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmA4LiU4Li04LihCiAgICB9IGVsc2UgaWYgKGVkaXRCdG4pIHsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsIOC4geC5iOC4reC4mQogICAgICAgIG9wZW5TaG9ydGN1dEVkaXRvcihlZGl0QnRuLmRhdGFzZXQuaWQpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKEKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIGNvbnN0IHNob3J0Y3V0TmFtZSA9IGJsdWVwcmludFNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk/Lm5hbWU7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiUICIke3Nob3J0Y3V0TmFtZX0iP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5maWx0ZXIocyA9PiBzLmlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHByZWZSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICAgICAgICAgIGF3YWl0IHNldERvYyhwcmVmUmVmLCB7IGJsdWVwcmludFNob3J0Y3V0czogdXBkYXRlZFNob3J0Y3V0cyB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgeyBjb25zb2xlLmVycm9yKCJFcnJvciBkZWxldGluZyBzaG9ydGN1dDoiLCBlcnJvcik7IH0KICAgICAgICB9KTsKICAgIH0KfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJQgRXZlbnQgTGlzdGVuZXIg4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKLy8g4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4LiE4Lil4Li04LiB4Lia4LiZIENvbnRhaW5lciDguILguK3guIfguJvguLjguYjguKHguKXguLHguJTguJfguLHguYnguIfguKvguKHguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1zaG9ydGN1dC1jb250YWluZXInKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBzaG9ydGN1dEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGVkaXRCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZWRpdC1zaG9ydGN1dC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc2hvcnRjdXQtYnRuJyk7CgogICAgaWYgKGVkaXRCdG4pIHsKICAgICAgICBvcGVuU2hvcnRjdXRFZGl0b3IoZWRpdEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgY29uc3Qgc2hvcnRjdXRJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIGNvbnN0IHNob3J0Y3V0TmFtZSA9IGJsdWVwcmludFNob3J0Y3V0cy5maW5kKHMgPT4gcy5pZCA9PT0gc2hvcnRjdXRJZCk/Lm5hbWU7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lib4Li44LmI4Lih4Lil4Lix4LiUICIke3Nob3J0Y3V0TmFtZX0iP2AsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXBkYXRlZFNob3J0Y3V0cyA9IGJsdWVwcmludFNob3J0Y3V0cy5maWx0ZXIocyA9PiBzLmlkICE9PSBzaG9ydGN1dElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vICoqKiDguYHguIHguYnguYTguIIgcGF0aCDguYPguKvguYnguYDguJvguYfguJnguJXguLPguYHguKvguJnguYjguIfguKrguLLguJjguLLguKPguJPguLDguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKioqCiAgICAgICAgICAgICAgICBjb25zdCBwcmVmUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZGFzaGJvYXJkQ29uZmlnIik7CiAgICAgICAgICAgICAgICBhd2FpdCBzZXREb2MocHJlZlJlZiwgeyBibHVlcHJpbnRTaG9ydGN1dHM6IHVwZGF0ZWRTaG9ydGN1dHMgfSwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgc2hvcnRjdXQ6IiwgZXJyb3IpOyB9CiAgICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKHNob3J0Y3V0QnRuKSB7CiAgICAgICAgaGFuZGxlU2hvcnRjdXRDbGljayhzaG9ydGN1dEJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7CgovLyDguJvguLjguYjguKHguYDguJ7guLTguYjguKHguJfguLLguIfguKXguLHguJTguYPguKvguKHguYgKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1zaG9ydGN1dC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IG9wZW5TaG9ydGN1dEVkaXRvcihudWxsKSk7CgovLyDguJvguLjguYjguKHguYPguJkgTW9kYWwg4LmB4LiB4LmJ4LmE4LiCCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtc2hvcnRjdXQtZWRpdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG9ydGN1dC1lZGl0b3ItbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXNob3J0Y3V0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZVNob3J0Y3V0Q2hhbmdlcyk7CgovLyDguYHguIHguYnguYTguIIgRXZlbnQg4LiC4Lit4LiH4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguJXguLLguKEgQmx1ZXByaW50IiDguYPguKvguYnguKPguK3guIfguKPguLHguJrguYTguJ/guKXguYzguJfguLXguYjguK3guLHguJvguYLguKvguKXguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tYmx1ZXByaW50LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgY29uc3QgYmx1ZXByaW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXVwbG9hZC1pbnB1dCcpOwogICAgY29uc3QgcmVmZXJlbmNlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVmZXJlbmNlLXBkZi11cGxvYWQnKTsKICAgIGlmIChibHVlcHJpbnRJbnB1dC5maWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgYXdhaXQgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50V2l0aEZpbGVzKGJsdWVwcmludElucHV0LmZpbGVzWzBdLCByZWZlcmVuY2VJbnB1dC5maWxlc1swXSB8fCBudWxsKTsKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC4reC4seC4m+C5guC4q+C4peC4lOC5hOC4n+C4peC5jCBCbHVlcHJpbnQg4Lir4Lij4Li34Lit4LmD4LiK4LmJ4Lib4Li44LmI4Lih4Lil4Lix4LiUIik7CiAgICB9Cn0pOwoKLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oSDilrLilrLilrIKCQkKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWMtcXVpei1iYW5rLW1vZGFsIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWMtcXVpei1iYW5rLW1vZGFsIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvcGljLXF1aXotYmFuay1tb2RhbCcpOwoKICAgIC8vIOC4lOC4tuC4h+C4leC4seC4p+C5geC4m+C4o+C4m+C4uOC5iOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4l+C4teC5iOC4reC4ouC4ueC5iOC5g+C4mSBNb2RhbCDguJnguLXguYkKICAgIGNvbnN0IHZpZXdBbmFseXNpc0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC12aWV3LWFuYWx5c2lzLWJ0bicpOwogICAgY29uc3QgdW5saW5rQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLXVubGluay1xdWl6LWJ0bicpOwogICAgY29uc3QgcHJlc2VudEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC1wcmVzZW50LWJ0bicpOwogICAgY29uc3QgdHJ5QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLXRyeS1idG4nKTsKICAgIGNvbnN0IGxpdmVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtbGl2ZS1idG4nKTsKICAgIGNvbnN0IGdhbWVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtZ2FtZS1idG4nKTsKCiAgICAvLyAtLS0gTG9naWMg4LiB4Liy4Lij4LiX4Liz4LiH4Liy4LiZ4LiC4Lit4LiH4Lib4Li44LmI4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQoKICAgIGlmICh2aWV3QW5hbHlzaXNCdG4pIHsKICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIg4LiB4LmI4Lit4LiZ4LmE4Lib4Lir4LiZ4LmJ4Liy4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lic4LilCiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAKICAgICAgICAKICAgICAgICBjb25zdCBxdWl6SWQgPSB2aWV3QW5hbHlzaXNCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgc2hvd1F1aXpEZXRhaWxWaWV3KHF1aXpJZCk7CiAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgfQogICAgZWxzZSBpZiAodW5saW5rQnRuKSB7CiAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4Lii4Li34LiZ4Lii4Lix4LiZ4LiB4LmI4Lit4LiZ4Lil4LiaCiAgICAgICAgY29uc3QgdG9waWNJZCA9IHVubGlua0J0bi5kYXRhc2V0LnRvcGljSWQ7CiAgICAgICAgY29uc3QgcXVpeklkVG9SZW1vdmUgPSB1bmxpbmtCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWRUb1JlbW92ZSk7CiAgICAgICAgY29uc3QgcXVpelRvcGljID0gcXVpekRhdGEgPyBxdWl6RGF0YS50b3BpYyA6ICfguKPguLLguKLguIHguLLguKPguJnguLXguYknOwoKICAgICAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4LiZ4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke3F1aXpUb3BpY30iIOC4reC4reC4geC4iOC4suC4geC4hOC4peC4seC4h+C4meC4teC5iT9gLAogICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvYmx1ZXByaW50UHJvamVjdHNgLCBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgICAgICAvLyDguYPguIrguYkgYXJyYXlSZW1vdmUg4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4Lib4Lil4Lit4LiU4Lig4Lix4Lii4LmB4Lil4Liw4LmB4Lih4LmI4LiZ4Lii4LizCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgW2B0b3BpY3MuJHt0b3BpY0lkfS5saW5rZWRRdWl6SWRzYF06IGFycmF5UmVtb3ZlKHF1aXpJZFRvUmVtb3ZlKQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguJnguLPguYHguJrguJrguJfguJTguKrguK3guJrguK3guK3guIHguIjguLLguIHguITguKXguLHguIfguJnguLXguYnguYHguKXguYnguKciKTsKICAgICAgICAgICAgICAgICAgICBvcGVuVG9waWNRdWl6QmFuayh0b3BpY0lkKTsgLy8g4Lij4Li14LmA4Lif4Lij4LiKIE1vZGFsCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOyAvLyDguKPguLXguYDguJ/guKPguIrguKvguJnguYnguLLguKvguKXguLHguIEKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IAogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVubGlua2luZyBxdWl6OiIsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiZ4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lit4Lit4LiBIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfSAKICAgIGVsc2UgaWYgKHByZXNlbnRCdG4pIHsKICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IHRydWU7IC8vIOC4leC4seC5ieC4h+C4hOC5iOC4siAi4LiE4Lin4Liy4Lih4LiI4LizIgogICAgICAgIGNvbnN0IHF1aXpJZCA9IHByZXNlbnRCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSk7CiAgICAgICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJXguYjguLLguIcKICAgICAgICB9CiAgICB9IAogICAgZWxzZSBpZiAodHJ5QnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBjb25zdCBxdWl6SWQgPSB0cnlCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzR2xvYmFsLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsKICAgICAgICAgICAgc3RhcnRBZG1pblRlc3QoKTsKICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgICAgIH0KICAgIH0gCiAgICBlbHNlIGlmIChsaXZlQnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBoYW5kbGVTdGFydExpdmVSYWNlKGxpdmVCdG4uZGF0YXNldC5xdWl6SWQpOwogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJXguYjguLLguIcKICAgIH0gCiAgICBlbHNlIGlmIChnYW1lQnRuKSB7CiAgICAgICAgY2FtZUZyb21CbHVlcHJpbnQgPSB0cnVlOyAvLyDguJXguLHguYnguIfguITguYjguLIgIuC4hOC4p+C4suC4oeC4iOC4syIKICAgICAgICBjb25zdCBxdWl6SWQgPSBnYW1lQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IG1vZGUgPSBnYW1lQnRuLmRhdGFzZXQubW9kZTsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgICAgIHNob3dHYW1lU3RhcnRDb25maXJtYXRpb25Nb2RhbChxdWl6SWQsIG1vZGUsIHF1aXpEYXRhLnRvcGljKTsKICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hwogICAgICAgIH0KICAgIH0KfSk7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWNyZWF0ZS1ibHVlcHJpbnQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFudWFsLWJsdWVwcmludC1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgLy8gQ2xlYXIgcHJldmlvdXMgaW5wdXQKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtcHJvamVjdC1uYW1lJykudmFsdWUgPSAnJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYnAtZ3JhZGUtbGV2ZWwnKS52YWx1ZSA9ICcnOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbnVhbC1icC1jb250ZW50JykudmFsdWUgPSAnJzsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLW1hbnVhbC1icC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYW51YWwtYmx1ZXByaW50LW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbWFudWFsLWJwLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlTWFudWFsQmx1ZXByaW50U2F2ZSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1icC1zZXR0aW5ncy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtc2V0dGluZ3MtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtYnAtc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTYXZlQmx1ZXByaW50UGFnZVNldHRpbmdzKTsKCQkKCQkvLyDguYPguJnguJ/guLHguIfguIHguYzguIrguLHguJkgc2V0dXBFdmVudExpc3RlbmVycygpCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlbkJsdWVwcmludFF1aXpTZXR0aW5ncyk7CgkJCgkJLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQoKLy8gLi4uICjguYLguITguYnguJQgRXZlbnQgTGlzdGVuZXIg4LmA4LiU4Li04LihKSAuLi4KCi8vID09PSBb4LmD4Lir4Lih4LmIXSBCbHVlcHJpbnQgUHJvamVjdCBNYW5hZ2VyIExpc3RlbmVycyA9PT0KCi8vIDEuIOC4m+C4uOC5iOC4oSAi4Lia4Lix4LiZ4LiX4Li24LiBIiDguKvguKXguLHguIfguIjguLLguIHguKfguLTguYDguITguKPguLLguLDguKvguYwgQmx1ZXByaW50CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLWJsdWVwcmludC1hcy1wcm9qZWN0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2F2ZUJsdWVwcmludFByb2plY3QpOwoKLy8gMi4g4Lib4Li44LmI4Lih4LmA4Lib4Li04LiUIE1vZGFsIOC4o+C4suC4ouC4geC4suC4o+C5guC4m+C4o+C5gOC4iOC4hApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1ibHVlcHJpbnQtcHJvamVjdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93Qmx1ZXByaW50UHJvamVjdHMpOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLWJsdWVwcmludC1wcm9qZWN0cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtcHJvamVjdHMtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgovLyAzLiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYPguJkgTW9kYWwg4Lij4Liy4Lii4LiB4Liy4Lij4LmC4Lib4Lij4LmA4LiI4LiEIChPcGVuL0RlbGV0ZSkKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1wcm9qZWN0LWxpc3QnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBvcGVuQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLm9wZW4tYnAtcHJvamVjdC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtYnAtcHJvamVjdC1idG4nKTsKICAgIAogICAgaWYgKG9wZW5CdG4pIHsKICAgICAgICBkaXNwbGF5Qmx1ZXByaW50UHJvamVjdE1hbmFnZXIob3BlbkJ0bi5kYXRhc2V0LmlkKTsKICAgIH0gZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgLy8gLS0tIFsg4LiI4Li44LiU4LmB4LiB4LmJ4LmE4LiC4LiX4Li14LmI4Liq4Liz4LiE4Lix4LiNIF0gLS0tCiAgICAgICAgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiI4Liy4LiB4LiB4Liy4Lij4Lil4Lia4LiY4Lij4Lij4Lih4LiU4LiyIOC4oeC4suC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4peC4muC5geC4muC4muC4peC5ieC4suC4h+C4muC4suC4h+C4l+C4teC5iOC5gOC4o+C4suC4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4mQogICAgICAgIGhhbmRsZURlZXBEZWxldGVCbHVlcHJpbnRQcm9qZWN0KGRlbGV0ZUJ0bi5kYXRhc2V0LmlkKTsKICAgIH0KfSk7CgovLyA0LiDguJvguLjguYjguKEgIuC4geC4peC4seC4miIg4LiI4Liy4LiB4Lir4LiZ4LmJ4LiyIE1hbmFnZXIKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stdG8tZGFzaGJvYXJkLWZyb20tYnAtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkID0gbnVsbDsKICAgIGN1cnJlbnRQcm9qZWN0SWQgPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXByb2plY3QtbWFuYWdlci12aWV3JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7Cn0pOwoKLy8gNS4g4Lib4Li44LmI4LihICLguYDguJ7guLTguYjguKHguKvguLHguKfguILguYnguK0iIOC5g+C4meC4q+C4meC5ieC4siBNYW5hZ2VyCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicC1hZGQtdG9waWMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhZGRUb3BpY1RvUHJvamVjdCk7CgovLyA2LiDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguYPguJnguKPguLLguKLguIHguLLguKPguKvguLHguKfguILguYnguK0gKEdlbmVyYXRlL0VkaXQvRGVsZXRlKQovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4LiaIGV2ZW50IGxpc3RlbmVyIOC4guC4reC4hyBicC10b3BpYy1saXN0LWNvbnRhaW5lciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CgovLyAtLS0g4Lin4Liy4LiH4LiX4Lix4LiaIEV2ZW50IExpc3RlbmVyIOC4guC4reC4hyBicC10b3BpYy1saXN0LWNvbnRhaW5lciDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJogZXZlbnQgbGlzdGVuZXIg4LiC4Lit4LiHIGJwLXRvcGljLWxpc3QtY29udGFpbmVyIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JwLXRvcGljLWxpc3QtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4gewogICAgY29uc3QgdG9waWNSb3cgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS10b3BpYy1pZF0nKTsKICAgIGlmICghdG9waWNSb3cpIHJldHVybjsKICAgIGNvbnN0IHRvcGljSWQgPSB0b3BpY1Jvdy5kYXRhc2V0LnRvcGljSWQ7CgogICAgY29uc3Qgb25ldFF1aXpCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtY3JlYXRlLW9uZXQtcXVpei1idG4nKTsKICAgIGNvbnN0IGNvbnRlbnRRdWl6QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLWNyZWF0ZS1jb250ZW50LXF1aXotYnRuJyk7CiAgICBjb25zdCB0b3BpY1F1aXpCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtY3JlYXRlLXRvcGljLXF1aXotYnRuJyk7CiAgICBjb25zdCBvcGVuVG9waWNCYW5rQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLW9wZW4tdG9waWMtYmFuay1idG4nKTsKICAgIGNvbnN0IHZpZXdCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcudmlldy1icC1sZXNzb24tYnRuJyk7CiAgICBjb25zdCBnZW5lcmF0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5icC1nZW5lcmF0ZS1sZXNzb24tYnRuJyk7CiAgICBjb25zdCBlZGl0QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmJwLWVkaXQtdG9waWMtYnRuJyk7CiAgICBjb25zdCBkZWxldGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuYnAtZGVsZXRlLXRvcGljLWJ0bicpOwoKICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4gjog4Liq4Lij4LmJ4Liy4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiU4Li24LiH4Lir4Lix4Lin4LiC4LmJ4Lit4LmB4Lia4Lia4LmA4LiV4LmH4LihIC0tLQogICAgY29uc3QgZ2V0RnVsbFRvcGljTmFtZSA9IChyb3dFbGVtZW50KSA9PiB7CiAgICAgICAgY29uc3Qgc3ViVG9waWNUZXh0ID0gcm93RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1maWVsZD0ic3ViVG9waWMiXScpLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAvLyDguYTguJXguYjguKPguLDguJTguLHguJogRE9NIOC4guC4tuC5ieC4meC5hOC4m+C4q+C4siBoNSDguJfguLXguYjguYDguJvguYfguJnguKvguLHguKfguILguYnguK3guKvguKXguLHguIEKICAgICAgICBjb25zdCBtYWluVG9waWNFbGVtZW50ID0gcm93RWxlbWVudC5jbG9zZXN0KCcuc3BhY2UteS0xLnBsLTQnKS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nOwogICAgICAgIGNvbnN0IG1haW5Ub3BpY1RleHQgPSBtYWluVG9waWNFbGVtZW50ID8gbWFpblRvcGljRWxlbWVudC50ZXh0Q29udGVudC50cmltKCkgOiAnJzsKICAgICAgICAKICAgICAgICAvLyDguKPguKfguKHguKvguLHguKfguILguYnguK3guKvguKXguLHguIHguYHguKXguLDguKvguLHguKfguILguYnguK3guKLguYjguK3guKLguYDguILguYnguLLguJTguYnguKfguKLguIHguLHguJkKICAgICAgICByZXR1cm4gYCR7bWFpblRvcGljVGV4dH06ICR7c3ViVG9waWNUZXh0fWA7CiAgICB9OwogICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4giAtLS0KCiAgICBpZiAob3BlblRvcGljQmFua0J0bikgewogICAgICAgIG9wZW5Ub3BpY1F1aXpCYW5rKHRvcGljSWQpOwogICAgfQogICAgZWxzZSBpZiAob25ldFF1aXpCdG4pIHsKICAgICAgICBjb25zdCBmdWxsVG9waWNOYW1lID0gZ2V0RnVsbFRvcGljTmFtZSh0b3BpY1Jvdyk7CiAgICAgICAgc2VsZWN0UHJvamVjdEFuZEdlbmVyYXRlQmx1ZXByaW50UXVpeihmdWxsVG9waWNOYW1lLCBudWxsLCB0b3BpY0lkLCB0cnVlKTsKICAgIH0KICAgIGVsc2UgaWYgKGNvbnRlbnRRdWl6QnRuKSB7CiAgICAgICAgY29uc3QgZnVsbFRvcGljTmFtZSA9IGdldEZ1bGxUb3BpY05hbWUodG9waWNSb3cpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGxlc3NvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0cy8ke2N1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWR9L2xlc3NvbnNgLCB0b3BpY0lkKTsKICAgICAgICAgICAgY29uc3QgbGVzc29uU25hcCA9IGF3YWl0IGdldERvYyhsZXNzb25SZWYpOwogICAgICAgICAgICBpZiAobGVzc29uU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgY29uc3QgbGVzc29uID0gbGVzc29uU25hcC5kYXRhKCkuY29udGVudDsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGV4dHJhY3RUZXh0ID0gKGh0bWwpID0+IHsgaWYgKCFodG1sKSByZXR1cm4gJyc7IHRlbXBEaXYuaW5uZXJIVE1MID0gaHRtbDsgcmV0dXJuIHRlbXBEaXYudGV4dENvbnRlbnQgfHwgdGVtcERpdi5pbm5lclRleHQgfHwgJyc7IH07CiAgICAgICAgICAgICAgICBjb25zdCBsZXNzb25UZXh0ID0gYCR7ZXh0cmFjdFRleHQobGVzc29uLnBvaW50KX0gJHtleHRyYWN0VGV4dChsZXNzb24ubWVtb3J5KX0gJHtleHRyYWN0VGV4dChsZXNzb24uc3VtbWFyeSl9YC50cmltKCk7CiAgICAgICAgICAgICAgICBzZWxlY3RQcm9qZWN0QW5kR2VuZXJhdGVCbHVlcHJpbnRRdWl6KGZ1bGxUb3BpY05hbWUsIGxlc3NvblRleHQsIHRvcGljSWQsIGZhbHNlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYDguJnguLfguYnguK3guKvguLLguJrguJfguYDguKPguLXguKLguJnguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7IAogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwcmVwYXJpbmcgY29udGVudCBxdWl6OiIsIGVycm9yKTsgCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmICh0b3BpY1F1aXpCdG4pIHsKICAgICAgICBjb25zdCBmdWxsVG9waWNOYW1lID0gZ2V0RnVsbFRvcGljTmFtZSh0b3BpY1Jvdyk7CiAgICAgICAgc2VsZWN0UHJvamVjdEFuZEdlbmVyYXRlQmx1ZXByaW50UXVpeihmdWxsVG9waWNOYW1lLCBudWxsLCB0b3BpY0lkLCBmYWxzZSk7CiAgICB9CiAgICBlbHNlIGlmICh2aWV3QnRuKSB7CiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0c2AsIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICAgICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdERhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgdG9waWNEYXRhID0gcHJvamVjdERhdGEudG9waWNzW3RvcGljSWRdOwogICAgICAgICAgICBpZiAodG9waWNEYXRhICYmIHRvcGljRGF0YS5zdGF0dXMgPT09ICdnZW5lcmF0ZWQnKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlc3NvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9ibHVlcHJpbnRQcm9qZWN0cy8ke2N1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWR9L2xlc3NvbnNgLCB0b3BpY0lkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBsZXNzb25TbmFwID0gYXdhaXQgZ2V0RG9jKGxlc3NvblJlZik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxlc3NvblNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGVzc29uQ29udGVudCA9IGxlc3NvblNuYXAuZGF0YSgpLmNvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy10aXRsZScpLnRleHRDb250ZW50ID0gYOC4muC4l+C5gOC4o+C4teC4ouC4meC5gOC4o+C4t+C5iOC4reC4hzogJHtnZXRGdWxsVG9waWNOYW1lKHRvcGljUm93KX1gOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9pbnRDb250ZW50JykuaW5uZXJIVE1MID0gbGVzc29uQ29udGVudC5wb2ludDsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lbW9yeUNvbnRlbnQnKS5pbm5lckhUTUwgPSBsZXNzb25Db250ZW50Lm1lbW9yeTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1bW1hcnlDb250ZW50JykuaW5uZXJIVE1MID0gbGVzc29uQ29udGVudC5zdW1tYXJ5OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhcHBsaWNhdGlvbkNvbnRlbnRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHBsaWNhdGlvbkNvbnRlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlc3NvbkNvbnRlbnQuYXBwbGljYXRpb25EYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXBwbGljYXRpb25EYXRhID0gbGVzc29uQ29udGVudC5hcHBsaWNhdGlvbkRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbkNvbnRlbnRFbC5pbm5lckhUTUwgPSBjdXJyZW50QXBwbGljYXRpb25EYXRhLm1hcCgocSwgaW5kZXgpID0+IGA8ZGl2IGNsYXNzPSJhcHBsaWNhdGlvbi1xdWVzdGlvbiBtYi00Ij48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtpbmRleCArIDF9LiAke21hcmtlZC5wYXJzZUlubGluZShxLnF1ZXN0aW9uKX08L3A+PGRpdiBjbGFzcz0iYXBwbGljYXRpb24tb3B0aW9ucyBtdC0yIiBpZD0icSR7aW5kZXh9LW9wdGlvbnMiPiR7cS5vcHRpb25zLm1hcCgob3B0LCBvcHRJbmRleCkgPT4gYDxidXR0b24gY2xhc3M9InctZnVsbCB0ZXh0LWxlZnQgcC0yIGJvcmRlciByb3VuZGVkLW1kIG10LTEgaG92ZXI6YmctZ3JheS0xMDAiIG9uY2xpY2s9ImNoZWNrQW5zd2VyKCR7aW5kZXh9LCAke29wdEluZGV4fSkiPiR7U3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIG9wdEluZGV4KX0uICR7bWFya2VkLnBhcnNlSW5saW5lKG9wdCl9PC9idXR0b24+YCkuam9pbignJyl9PC9kaXY+PC9kaXY+YCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXBwbGljYXRpb25EYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbkNvbnRlbnRFbC5pbm5lckhUTUwgPSBsZXNzb25Db250ZW50LmFwcGxpY2F0aW9uSFRNTCB8fCBsZXNzb25Db250ZW50LmFwcGxpY2F0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tbG9hZGVyJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tc2VjdGlvbnMtY29udGFpbmVyJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tdmlldy1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lk1hdGhKYXgpIHsgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi12aWV3LWNvbnRlbnQnKV0pOyB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC4muC4l+C5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5iSAo4Lit4Liy4LiI4LiW4Li54LiB4Lil4Lia4LmE4Lib4LmB4Lil4LmJ4LinKSIpOyB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChmZXRjaEVycm9yKSB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGZldGNoaW5nIGxlc3NvbiBjb250ZW50OiIsIGZldGNoRXJyb3IpOyBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lia4LiX4LmA4Lij4Li14Lii4LiZIik7IH0KICAgICAgICAgICAgfSBlbHNlIHsgc2hvd01lc3NhZ2UoIuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4muC4l+C5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5hOC4p+C5iSwg4LiB4Lij4Li44LiT4Liy4LiB4LiUICfguKrguKPguYnguLLguIfguYPguKvguKHguYgnIik7IH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChnZW5lcmF0ZUJ0bikgewogICAgICAgIGNvbnN0IGZ1bGxUb3BpY05hbWUgPSBnZXRGdWxsVG9waWNOYW1lKHRvcGljUm93KTsKICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL2JsdWVwcmludFByb2plY3RzYCwgY3VycmVudEJsdWVwcmludFByb2plY3RJZCk7CiAgICAgICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICBnZW5lcmF0ZUFuZFNhdmVMZXNzb25Gb3JCbHVlcHJpbnQodG9waWNJZCwgZnVsbFRvcGljTmFtZSwgcHJvamVjdERhdGEuZ3JhZGVMZXZlbCk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgIGVkaXRUb3BpY0luUHJvamVjdCh0b3BpY0lkKTsKICAgIH0KICAgIGVsc2UgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgIGRlbGV0ZVRvcGljRnJvbVByb2plY3QodG9waWNJZCk7CiAgICB9Cn0pOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaXgtbGVzc29uLWxhdGV4LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRml4TGVzc29uTGF0ZXgpOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVzc29uLXRvLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUV4cG9ydExlc3NvblRvUERGKTsKCQkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtbGVzc29uLXZpZXctYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXZpZXctbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CgkJCmNvbnN0IGJ1bGtDb25maWRlbmNlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVsay1jb25maWRlbmNlLXNjb3JpbmctY2hlY2tib3gnKTsKY29uc3QgYnVsa0NvbmZpZGVuY2VNb2RlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstY29uZmlkZW5jZS1tb2RlLWNvbnRhaW5lcicpOwpidWxrQ29uZmlkZW5jZUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgIGJ1bGtDb25maWRlbmNlTW9kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhYnVsa0NvbmZpZGVuY2VDaGVja2JveC5jaGVja2VkKTsKfSk7CgovLyBMb2dpYyDguKrguLPguKvguKPguLHguJrguKvguJnguYnguLLguJXguLHguYnguIfguITguYjguLLguKvguKXguLHguIEKY29uc3QgY29uZmlkZW5jZUNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2Utc2NvcmluZy1jaGVja2JveCcpOwpjb25zdCBjb25maWRlbmNlTW9kZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maWRlbmNlLW1vZGUtY29udGFpbmVyJyk7CmNvbmZpZGVuY2VDaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7CiAgICBjb25maWRlbmNlTW9kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhY29uZmlkZW5jZUNoZWNrYm94LmNoZWNrZWQpOwp9KTsKCi8vIExvZ2ljIOC4quC4s+C4q+C4o+C4seC4miBNb2RhbApjb25zdCBtb2RhbENvbmZpZGVuY2VDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jb25maWRlbmNlLXNjb3JpbmctY2hlY2tib3gnKTsKY29uc3QgbW9kYWxDb25maWRlbmNlTW9kZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jb25maWRlbmNlLW1vZGUtY29udGFpbmVyJyk7Cm1vZGFsQ29uZmlkZW5jZUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgIG1vZGFsQ29uZmlkZW5jZU1vZGVDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJywgIW1vZGFsQ29uZmlkZW5jZUNoZWNrYm94LmNoZWNrZWQpOwp9KTsKCi8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgkJCgkJLy8g4pa84pa84pa8IFtTVEFSVF0g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVycyDguKrguLPguKvguKPguLHguJogQ29uZmlkZW5jZSBNb2RhbCDilrzilrzilrwKY29uc3QgY29uZmlkZW5jZU1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKTsKY29uc3QgaGFuZGxlQ29uZmlkZW5jZUNob2ljZSA9IGFzeW5jIChpc0NvbmZpZGVudCkgPT4gewogICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1tb2RhbCcpOwogICAgY29uc3QgbW9kZSA9IG1vZGFsLmRhdGFzZXQuY3VycmVudE1vZGU7IC8vIOC4reC5iOC4suC4meC5guC4q+C4oeC4lOC4m+C4seC4iOC4iOC4uOC4muC4seC4mQogICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbicpOwogICAgCiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsIOC4geC5iOC4reC4mQoKICAgIGlmIChtb2RlID09PSAndGltZWQnKSB7CiAgICAgICAgLy8gPT09IExvZ2ljIOC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC4iOC4seC4muC5gOC4p+C4peC4suC4o+C4suC4ouC4guC5ieC4rSA9PT0KICAgICAgICBjb25zdCBhbnN3ZXJWYWx1ZSA9IGhpZGRlbklucHV0LnZhbHVlOwogICAgICAgIGNvbnN0IGFuc3dlckRhdGEgPSB7CiAgICAgICAgICAgIGFuc3dlcjogYW5zd2VyVmFsdWUsCiAgICAgICAgICAgIHdhc0NvbmZpZGVudDogaXNDb25maWRlbnQKICAgICAgICB9OwogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4mwogICAgICAgIHByb2NlZWRUb05leHRRdWVzdGlvbihhbnN3ZXJEYXRhKTsKCiAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdzeW5jJykgewogICAgICAgIC8vID09PSBMb2dpYyDguKrguLPguKvguKPguLHguJogU3luYyBNb2RlICjguYLguITguYnguJTguYDguJTguLTguKHguJfguLXguYjguYHguIHguYnguYTguILguYTguJvguITguKPguLHguYnguIfguIHguYjguK3guJkpID09PQogICAgICAgIGNvbnN0IGFuc3dlclZhbHVlID0gaGlkZGVuSW5wdXQuZGF0YXNldC5hbnN3ZXJWYWx1ZTsKICAgICAgICBjb25zdCBxdWVzdGlvbiA9IEpTT04ucGFyc2UoaGlkZGVuSW5wdXQuZGF0YXNldC5xdWVzdGlvbik7CiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBKU09OLnBhcnNlKGhpZGRlbklucHV0LmRhdGFzZXQuZ2FtZURhdGEpOwogICAgICAgIGNvbnN0IHBsYXllck5hbWUgPSBoaWRkZW5JbnB1dC5kYXRhc2V0LnBsYXllck5hbWU7CgogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5g+C4mSBTeW5jIE1vZGUKICAgICAgICBoYW5kbGVTeW5jQW5zd2VyU3VibWl0KGFuc3dlclZhbHVlLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllck5hbWUsIGlzQ29uZmlkZW50KTsKICAgIH0KICAgIAogICAgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4Liy4LmC4Lir4Lih4LiU4Lir4Lil4Lix4LiH4LiI4Liy4LiB4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiICiAgICBtb2RhbC5kYXRhc2V0LmN1cnJlbnRNb2RlID0gJyc7IAp9OwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tY29uZmlkZW50JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVDb25maWRlbmNlQ2hvaWNlKHRydWUpKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbm90LWNvbmZpZGVudCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gaGFuZGxlQ29uZmlkZW5jZUNob2ljZShmYWxzZSkpOwovLyDilrLilrLilrIgW0VORF0g4Liq4Li04LmJ4LiZ4Liq4Li44LiUIEV2ZW50IExpc3RlbmVycyDguKrguLPguKvguKPguLHguJogQ29uZmlkZW5jZSBNb2RhbCDilrLilrLilrIKCQkKCQlsaXZlR2FtZVZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LmA4Lib4LmH4LiZ4Lib4Li44LmI4Lih4Lil4Lia4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiC4Lit4LiHIFN5bmMgTW9kZSDguKvguKPguLfguK3guYTguKHguYgKICAgIGNvbnN0IGtpY2tCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcua2ljay1wbGF5ZXItYnRuLXN5bmMnKTsKICAgIGlmIChraWNrQnRuKSB7CiAgICAgICAgY29uc3QgcGxheWVyTmFtZSA9IGtpY2tCdG4uZGF0YXNldC5wbGF5ZXJOYW1lOwogICAgICAgIGlmIChwbGF5ZXJOYW1lKSB7CiAgICAgICAgICAgIGhhbmRsZUtpY2tQbGF5ZXJTeW5jKHBsYXllck5hbWUpOwogICAgICAgIH0KICAgIH0KfSk7CgkJCgkJLy8g4pa84pa84pa8IOC4p+C4suC4h+C5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5hOC4p+C5ieC4muC4meC4quC4uOC4lOC4guC4reC4h+C4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzZXR1cEV2ZW50TGlzdGVuZXJzIOKWvOKWvOKWvApjb25zdCBjb25maXJtR2FtZVN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tZ2FtZS1zdGFydC1idG4nKTsKY29uc3QgY2FuY2VsR2FtZVN0YXJ0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1nYW1lLXN0YXJ0LWJ0bicpOwoKY2FuY2VsR2FtZVN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tZ2FtZS1zdGFydC1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKCmNvbmZpcm1HYW1lU3RhcnRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBjb25zdCBxdWl6SWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1zdGFydC1xdWl6LWlkJykudmFsdWU7CiAgICBjb25zdCBnYW1lTW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lLXN0YXJ0LW1vZGUnKS52YWx1ZTsKICAgIGNvbnN0IHNob3VsZFNhdmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1nYW1lLXJlc3VsdHMtY2hlY2tib3gnKS5jaGVja2VkOwoKICAgIC8vIOC4i+C5iOC4reC4mSBNb2RhbCDguIHguYjguK3guJnguYDguKPguLTguYjguKHguYDguIHguKEKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWdhbWUtc3RhcnQtbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYDguKPguLTguYjguKHguYDguIHguKHguJXguLLguKEgbW9kZSDguJfguLXguYjguYDguIHguYfguJrguYTguKfguYkKICAgIHN3aXRjaChnYW1lTW9kZSkgewogICAgICAgIGNhc2UgJ2xpdmUtcmFjZSc6CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkLCBzaG91bGRTYXZlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndGVhbSc6CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0VGVhbVF1aXoocXVpeklkLCBzaG91bGRTYXZlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnZ3JvdXAnOgogICAgICAgICAgICBoYW5kbGVTdGFydEdyb3VwTW9kZShxdWl6SWQsIHNob3VsZFNhdmUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzeW5jJzoKICAgICAgICAgICAgLy8gLS0tIFsg4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCiAgICAgICAgICAgIC8vIDEuIOC4reC5iOC4suC4meC4hOC5iOC4suC4iOC4suC4gSBSYWRpbyBCdXR0b24KICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRWYXJpYW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ic3luY1ZhcmlhbnQiXTpjaGVja2VkJykudmFsdWUgfHwgJ2NsYXNzaWMnOwogICAgICAgICAgICAvLyAyLiDguKrguYjguIfguITguYjguLIgdmFyaWFudCDguYTguJvguJTguYnguKfguKIKICAgICAgICAgICAgaGFuZGxlU3RhcnRTeW5jTW9kZShxdWl6SWQsIHNob3VsZFNhdmUsIHNlbGVjdGVkVmFyaWFudCk7IAogICAgICAgICAgICAvLyAtLS0gWyDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KICAgICAgICAgICAgYnJlYWs7CiAgICB9Cn0pOwoJCQoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdqb2luLWdyb3VwLWFjdGl2aXR5LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlSm9pbkdyb3VwQWN0aXZpdHkpOwoKbGl2ZUdhbWVWaWV3LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGNvbnN0IGJhckl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcuc3VtbWFyeS1iYXItaXRlbScpOwoKICAgIC8vIOC4i+C5iOC4reC4mSBUb29sdGlwIOC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguIHguYjguK3guJkKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5saXZlLXN1bW1hcnktdG9vbHRpcC52aXNpYmxlJykuZm9yRWFjaCh2aXNpYmxlVG9vbHRpcCA9PiB7CiAgICAgICAgLy8g4LiW4LmJ4LiyIHRvb2x0aXAg4LiX4Li14LmI4LmB4Liq4LiU4LiH4Lit4Lii4Li54LmI4LmE4Lih4LmI4LmD4LiK4LmI4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4Lii4LiC4Lit4LiHIGJhciDguJfguLXguYjguYDguJ7guLTguYjguIfguITguKXguLTguIEg4LmD4Lir4LmJ4LiL4LmI4Lit4LiZ4Lih4Lix4LiZ4LmE4LibCiAgICAgICAgaWYgKCFiYXJJdGVtIHx8IHZpc2libGVUb29sdGlwLmlkICE9PSBiYXJJdGVtLmRhdGFzZXQudG9vbHRpcFRhcmdldCkgewogICAgICAgICAgICB2aXNpYmxlVG9vbHRpcC5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiE4Lil4Li04LiB4LiX4Li14LmI4LmB4LiX4LmI4LiH4LiB4Lij4Liy4LifIOC4geC5h+C5hOC4oeC5iOC4leC5ieC4reC4h+C4l+C4s+C4reC4sOC5hOC4o+C4leC5iOC4rQogICAgaWYgKCFiYXJJdGVtKSB7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4q+C4siBJRCDguILguK3guIcgdG9vbHRpcCDguYDguJvguYnguLLguKvguKHguLLguKLguIjguLLguIEgZGF0YSBhdHRyaWJ1dGUKICAgIGNvbnN0IHRvb2x0aXBJZCA9IGJhckl0ZW0uZGF0YXNldC50b29sdGlwVGFyZ2V0OwogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRvb2x0aXBJZCk7CgogICAgaWYgKHRvb2x0aXApIHsKICAgICAgICAvLyDguKrguKXguLHguJrguIHguLLguKPguYHguKrguJTguIfguJzguKXguILguK3guIcgdG9vbHRpcCDguJfguLXguYjguJbguLnguIHguITguKXguLTguIEKICAgICAgICB0b29sdGlwLmNsYXNzTGlzdC50b2dnbGUoJ3Zpc2libGUnKTsKICAgIH0KfSk7CgkJCgkJICAgICAgICBsaXZlR2FtZVZpZXcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJvguLjguYjguKHguJfguLXguYjguJbguLnguIHguITguKXguLTguIHguITguLfguK3guJvguLjguYjguKEgIuC5gOC4leC4sCIg4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2tpY2stcGxheWVyLWJ0bicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJOYW1lID0gZS50YXJnZXQuZGF0YXNldC5wbGF5ZXJOYW1lOwogICAgICAgICAgICAgICAgaWYgKHBsYXllck5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVLaWNrUGxheWVyKHBsYXllck5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtdGl0bGUnKS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXByb2plY3QtbmFtZS1idG4nKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXByb2plY3QtbmFtZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVNhdmVQcm9qZWN0TmFtZSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXRpdGxlJykuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7IGlmIChlLmtleSA9PT0gJ0VudGVyJykgeyBlLnByZXZlbnREZWZhdWx0KCk7IGUudGFyZ2V0LmJsdXIoKTsgaGFuZGxlU2F2ZVByb2plY3ROYW1lKCk7IH0gfSk7CgkJCgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWxrLXF1aXotc2V0dGluZ3MtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtYnVsay1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstcXVpei1zZXR0aW5ncy1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tYnVsay1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQnVsa1VwZGF0ZVF1aXpTZXR0aW5ncyk7CgkJCiAgICAgICAgICAgIC8vIE5ldyB1bmlmaWVkIG1vZGUgc3dpdGNoZXIKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGUtc3dpdGNoZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVNb2RlU3dpdGNoKTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1cGRhdGUtb2xkLXF1aXp6ZXMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVVcGRhdGVPbGRRdWl6emVzKTsJCQkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc2V0LXByb2plY3Qtb3JkZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVSZXNldFByb2plY3RPcmRlcik7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXZpc2liaWxpdHktc2V0dGluZ3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTYXZlVmlzaWJpbGl0eVNldHRpbmdzKTsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZC1jdXN0b20tbWF0aC10b3BpYy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUFkZEN1c3RvbU1hdGhUb3BpYyk7CgkJCQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0LWFsbC10b3BpY3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVTZWxlY3RBbGxUb3BpY3MpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVzZWxlY3QtYWxsLXRvcGljcy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZURlc2VsZWN0QWxsVG9waWNzKTsKCi8vIC0tLSDguKfguLLguIfguJfguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiHIGJhY2stdG8tZGFzaGJvYXJkLWJ0biDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQgLS0tCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWRhc2hib2FyZC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4nuC4tOC5iOC4oeC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5gOC4nuC4t+C5iOC4reC4leC4o+C4p+C4iOC4quC4reC4miAi4LiE4Lin4Liy4Lih4LiI4LizIgogICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICAvLyDguJbguYnguLLguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4siBCbHVlcHJpbnQgTWFuYWdlcgogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOyAvLyDguKXguYnguLLguIfguITguKfguLLguKHguIjguLPguJfguLTguYnguIcKICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4Lih4Liy4LiI4Liy4LiBIEJsdWVwcmludCDguYPguKvguYnguJfguLPguIfguLLguJnguJXguLLguKHguJvguIHguJXguLQKICAgICAgICBjdXJyZW50UHJvamVjdElkID0gbnVsbDsKICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSBudWxsOwogICAgICAgIGlmICh1bnN1YnNjcmliZVN0dWRlbnRzTGlzdGVuZXIpIHVuc3Vic2NyaWJlU3R1ZGVudHNMaXN0ZW5lcigpOwogICAgICAgIGlmICh1bnN1YnNjcmliZVF1aXp6ZXNMaXN0ZW5lcikgdW5zdWJzY3JpYmVRdWl6emVzTGlzdGVuZXIoKTsKICAgICAgICBpZiAodW5zdWJzY3JpYmVTdHVkZW50UHJvZmlsZXNMaXN0ZW5lcikgdW5zdWJzY3JpYmVTdHVkZW50UHJvZmlsZXNMaXN0ZW5lcigpOwogICAgICAgIHNob3dWaWV3KCdhZG1pbi1kYXNoYm9hcmQnKTsKICAgIH0KfSk7Ci8vIC0tLSDguKfguLLguIfguJfguLHguJogRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiHIGJhY2stdG8tcHJvamVjdC1idG4g4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by1wcm9qZWN0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiC4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaICLguITguKfguLLguKHguIjguLMiCiAgICBpZiAoY2FtZUZyb21CbHVlcHJpbnQgJiYgY3VycmVudEJsdWVwcmludFByb2plY3RJZCkgewogICAgICAgIC8vIOC4luC5ieC4suC4oeC4suC4iOC4suC4gSBCbHVlcHJpbnQg4LmD4Lir4LmJ4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4LiyIEJsdWVwcmludCBNYW5hZ2VyCiAgICAgICAgZGlzcGxheUJsdWVwcmludFByb2plY3RNYW5hZ2VyKGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpOwogICAgICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gZmFsc2U7IC8vIOC4peC5ieC4suC4h+C4hOC4p+C4suC4oeC4iOC4s+C4l+C4tOC5ieC4hwogICAgfSBlbHNlIHsKICAgICAgICAvLyDguJbguYnguLLguYTguKHguYjguYTguJTguYnguKHguLLguIjguLLguIEgQmx1ZXByaW50IOC5g+C4q+C5ieC4l+C4s+C4h+C4suC4meC4leC4suC4oeC4m+C4geC4leC4tAogICAgICAgIGlmICh1bnN1YnNjcmliZVN1Ym1pc3Npb25zTGlzdGVuZXIpIHVuc3Vic2NyaWJlU3VibWlzc2lvbnNMaXN0ZW5lcigpOwogICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgfQp9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWRhc2hib2FyZC1mcm9tLXJlc3VsdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBzaG93VmlldygnYWRtaW4tZGFzaGJvYXJkJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTW9kYWxzCiAgICAgICAgICAgIC8vIC0tLSDguKfguLLguIfguJfguLHguJrguJrguKPguKPguJfguLHguJTguYDguJTguLTguKEgLS0tCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1jbG9zZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIC8vIDEuIOC4i+C5iOC4reC4meC4q+C4meC5ieC4suC4leC5iOC4suC4hyBQb3AtdXAgKOC4l+C4s+C4h+C4suC4meC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAvLyAyLiDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguKHguLUgIuC4hOC4s+C4quC4seC5iOC4h+C4nuC4tOC5gOC4qOC4qSIg4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiX4Liz4LiV4LmI4Lit4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICBpZiAodHlwZW9mIG1vZGFsQ29uZmlybUFjdGlvbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIG1vZGFsQ29uZmlybUFjdGlvbigpOyAvLyAzLiDguJbguYnguLLguKHguLUg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4LiE4Liz4Liq4Lix4LmI4LiH4LiZ4Lix4LmJ4LiZIQogICAgICAgIG1vZGFsQ29uZmlybUFjdGlvbiA9IG51bGw7IC8vIDQuIOC4peC5ieC4suC4h+C4hOC4s+C4quC4seC5iOC4h+C4l+C4tOC5ieC4hyDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguJfguLPguIfguLLguJnguIvguYnguLPguYPguJnguITguKPguLHguYnguIfguJXguYjguK3guYTguJsKICAgIH0KfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjcmVhdGUtcHJvamVjdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGNyZWF0ZVByb2plY3RNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtY3JlYXRlLXByb2plY3QtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBjcmVhdGVQcm9qZWN0TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWRtaW4gUGFzc3dvcmQgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1hZG1pbi1sb2dpbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGFkbWluUGFzc3dvcmRNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWFkbWluLWxvZ2luLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQWRtaW5Mb2dpbik7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZG1pbi1wYXNzd29yZC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGlmIChlLmtleSA9PT0gJ0VudGVyJykgaGFuZGxlQWRtaW5Mb2dpbigpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIENvbmZpcm1hdGlvbiBNb2RhbAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLWRlbGV0ZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjYW5jZWxBY3Rpb24gPT09ICdmdW5jdGlvbicpIHsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oSAyIOC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgICAgICAgICAgICAgIGNhbmNlbEFjdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICBjYW5jZWxBY3Rpb24gPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1kZWxldGUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY29uZmlybUFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1BY3Rpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbmZpcm1hdGlvbk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgY29uZmlybUFjdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICBjYW5jZWxBY3Rpb24gPSBudWxsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gTW9kYWwgTGlzdGVuZXJzCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcmVuYW1lLXF1aXotYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiByZW5hbWVRdWl6TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1yZW5hbWUtcXVpei1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1SZW5hbWVRdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1tb3ZlLXF1aXotYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBtb3ZlUXVpek1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbW92ZS1xdWl6LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybU1vdmVRdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gcXVpelNldHRpbmdzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1xdWl6LXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybVF1aXpTZXR0aW5ncyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1zdGF0dXMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBxdWl6U3RhdHVzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1xdWl6LXN0YXR1cy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1RdWl6U3RhdHVzKTsKCQkJCgkJCS8vIOKWvOKWvOKWvCDguJnguLPguYLguITguYnguJTguJfguLXguYjguJbguLLguKHguKHguLLguKfguLLguIfguJXguYjguK3guJfguYnguLLguKLguJXguKPguIfguJnguLXguYnguYTguJTguYnguYDguKXguKLguITguKPguLHguJog4pa84pa84pa8CmNvbnN0IGV4cG9ydFBkZk1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1wZGYtbW9kYWwnKTsKLy8g4Lib4Li44LmI4Lih4Lii4LiB4LmA4Lil4Li04LiBCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZXhwb3J0LXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGV4cG9ydFBkZk1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKLy8g4Lib4Li44LmI4LihIEV4cG9ydCDguYHguJrguJrguIHguKPguLDguIrguLHguJogKDIg4LiE4Lit4Lil4Lix4Lih4LiZ4LmMKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LWNvbXBhY3QtcGRmLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBhY3Rpb25UYXJnZXRJZCk7CiAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsgLy8g4LiV4Lix4LmJ4LiH4LiE4LmI4LiyIHF1aXog4LiX4Li14LmI4LiI4LiwIGV4cG9ydAogICAgICAgIGV4cG9ydFF1aXpBc1dvcmtzaGVldFBERigpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYDguJTguLTguKEKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgfQogICAgZXhwb3J0UGRmTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwovLyDguJvguLjguYjguKEgRXhwb3J0IOC5geC4muC4muC4leC4tOC4pyAo4LiC4LmJ4Lit4Lil4Liw4Lir4LiZ4LmJ4LiyKQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LXR1dG9yLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gYWN0aW9uVGFyZ2V0SWQpOwogICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgY3VycmVudFF1aXpEYXRhID0gcXVpekRhdGE7IC8vIOC4leC4seC5ieC4h+C4hOC5iOC4siBxdWl6IOC4l+C4teC5iOC4iOC4sCBleHBvcnQKICAgICAgICBleHBvcnRRdWl6QXNUdXRvclBERigpOyAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgfQogICAgZXhwb3J0UGRmTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7Cn0pOwoJCQkKLy8g4pyFIOC5guC4hOC5ieC4lOC5g+C4q+C4oeC5iOC4l+C4teC5iOC5geC4geC5ieC5hOC4guC5geC4peC5ieC4pwoKLy8gMS4g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Lib4Li44LmI4Lih4Lir4LiZ4LmJ4LiyIERhc2hib2FyZCDguKvguKXguLHguIHguYPguKvguYnguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKY29uc3Qgb3Blbkdsb2JhbEFjdGl2aXR5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW4tZ2xvYmFsLWxpdmUtYnRuJyk7Cm9wZW5HbG9iYWxBY3Rpdml0eUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1wbGF5LWNpcmNsZSBtci0yIj48L2k+4LmA4Lij4Li04LmI4Lih4LiB4Li04LiI4LiB4Lij4Lij4LihJzsgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiK4Li34LmI4Lit4Lib4Li44LmI4LihCm9wZW5HbG9iYWxBY3Rpdml0eUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9wZW5HbG9iYWxBY3Rpdml0eU1vZGFsKTsgLy8g4LmA4Lij4Li14Lii4LiB4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmICgovLyAyLiBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguJvguLjguYjguKHguJvguLTguJTguYHguKXguLDguIrguYjguK3guIfguITguYnguJnguKvguLLguYPguJkgTW9kYWwg4LmD4Lir4Lih4LmICmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtZ2xvYmFsLWFjdGl2aXR5LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1hY3Rpdml0eS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9KTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1xdWl6LXNlYXJjaC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgIHJlbmRlckdsb2JhbEFjdGl2aXR5TGlzdChlLnRhcmdldC52YWx1ZSk7Cn0pOwoKLy8g4pyFIOC5guC4hOC5ieC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4guC5geC4peC5ieC4pwovLyAzLiBFdmVudCBMaXN0ZW5lciDguKvguKXguLHguIHguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguYLguKvguKHguJTguYDguIHguKHguJfguLHguYnguIfguKvguKHguJQKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1hY3Rpdml0eS1xdWl6LWxpc3QnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBjb25zdCBnYW1lQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmdhbWUtc3RhcnQtYnRuJyk7CiAgICBpZiAoIWdhbWVCdG4pIHJldHVybjsgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmE4LiU4LmJ4LiE4Lil4Li04LiB4LiX4Li14LmI4Lib4Li44LmI4LihIOC5g+C4q+C5ieC4q+C4ouC4uOC4lOC4l+C4s+C4h+C4suC4mQoKICAgIGNvbnN0IHF1aXpJZCA9IGdhbWVCdG4uZGF0YXNldC5pZDsKICAgIGNvbnN0IGdhbWVNb2RlID0gZ2FtZUJ0bi5kYXRhc2V0Lm1vZGU7CiAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CgogICAgaWYgKHF1aXpEYXRhKSB7CiAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHICLguYDguKPguLTguYjguKHguIHguLTguIjguIHguKPguKPguKEiIOC4geC5iOC4reC4meC5gOC4quC4oeC4rQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnbG9iYWwtYWN0aXZpdHktbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICAgICAgLy8gLS0tIFsg4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCiAgICAgICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lib4Li44LmI4Lih4LiX4Li14LmI4LiB4LiU4LiE4Li34LitICdsaXZlLXJhY2UnIOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgIGlmIChnYW1lTW9kZSA9PT0gJ2xpdmUtcmFjZScpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmD4LiK4LmIOiDguYPguKvguYnguYDguKPguLTguYjguKHguYDguIHguKHguKrguJTguJfguLHguJnguJfguLUg4LmC4LiU4Lii4LmE4Lih4LmI4LiW4Liy4Lih4LmA4Lij4Li34LmI4Lit4LiH4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liw4LmB4LiZ4LiZCiAgICAgICAgICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguJbguYnguLLguYDguJvguYfguJnguYLguKvguKHguJTguK3guLfguYjguJkgKFRlYW0sIEdyb3VwLCBTeW5jKTog4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4Lii4Li34LiZ4Lii4Lix4LiZ4LiV4Liy4Lih4Lib4LiB4LiV4Li0CiAgICAgICAgICAgIHNob3dHYW1lU3RhcnRDb25maXJtYXRpb25Nb2RhbChxdWl6SWQsIGdhbWVNb2RlLCBxdWl6RGF0YS50b3BpYyk7CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgfQp9KTsKICAgICAgICAgICAgLy8gU2VhcmNoIGFuZCBTb3J0IExpc3RlbmVycwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1zZWFyY2gtaW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHJlbmRlclByb2plY3RzKTsKICAgICAgICAgICAgLy8g4LmD4LiZ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHNldHVwRXZlbnRMaXN0ZW5lcnMoKQovLyDguYLguITguYnguJTguYPguKvguKHguYgKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3Qtc29ydC1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBuZXdTb3J0VmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1zb3J0LXNlbGVjdCcpLnZhbHVlOwogICAgY29uc3Qgc2V0dGluZ3NSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgIHRyeSB7CiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiV4LiE4LmI4Liy4LmD4LiZIEZpcmVzdG9yZQogICAgICAgIGF3YWl0IHNldERvYyhzZXR0aW5nc1JlZiwgeyBwcm9qZWN0U29ydDogbmV3U29ydFZhbHVlIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgLy8g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmA4Lij4Li14Lii4LiBIHJlbmRlclByb2plY3RzKCkg4LiX4Li14LmI4LiZ4Li14LmI4LmB4Lil4LmJ4LinIOC5gOC4nuC4o+C4suC4sCBvblNuYXBzaG90IOC4iOC4sOC4l+C4s+C4h+C4suC4meC5g+C4q+C5ieC5gOC4reC4hwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBzb3J0IHByZWZlcmVuY2U6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIHguIHguLLguKPguIjguLHguJTguYDguKPguLXguKLguIciKTsKICAgIH0KfSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXNlYXJjaC1pbnB1dCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgcmVuZGVyUXVpenplcyk7CgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ3JpZC12aWV3LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFZpZXcgPSAnZ3JpZCc7CiAgICBzYXZlVXNlclByZWZlcmVuY2UoJ3Byb2plY3RWaWV3JywgJ2dyaWQnKTsgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICByZW5kZXJQcm9qZWN0cygpOyAvLyDguKfguLLguJTguKvguJnguYnguLLguIjguK3guYPguKvguKHguYgKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlzdC12aWV3LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucHJvamVjdFZpZXcgPSAnbGlzdCc7CiAgICBzYXZlVXNlclByZWZlcmVuY2UoJ3Byb2plY3RWaWV3JywgJ2xpc3QnKTsgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4LiyCiAgICByZW5kZXJQcm9qZWN0cygpOyAvLyDguKfguLLguJTguKvguJnguYnguLLguIjguK3guYPguKvguKHguYgKfSk7Ci8vIOKWsuKWsuKWsiDguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKEg4pay4pay4payCgogICAgICAgICAgICAvLyBQcm9qZWN0IERldGFpbCBUYWJzCiAgICAgICAgICAgIG1hbmFnZVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFByb2plY3RUYWIoJ21hbmFnZScpKTsKICAgICAgICAgICAgcmVzdWx0c1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFByb2plY3RUYWIoJ3Jlc3VsdHMnKSk7CiAgICAgICAgICAgIGxlYWRlcmJvYXJkVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc3dpdGNoUHJvamVjdFRhYignbGVhZGVyYm9hcmQnKSk7CgogICAgICAgICAgICAvLyBRdWl6IFJlc3VsdHMgVGFicwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl0aWNzLXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2FuYWx5dGljcycpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3Jlcy10YWItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzd2l0Y2hRdWl6RGV0YWlsVGFiKCdzY29yZXMnKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZWFkZXJib2FyZC1xdWl6LXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2xlYWRlcmJvYXJkLXF1aXonKSk7CgkJCQoJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmVoYXZpb3ItbG9nLXRhYi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2JlaGF2aW9yLWxvZycpKTsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQoJCQkKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emUtc3RyZW5ndGhzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQW5hbHl6ZUNsYXNzKTsKICAgICAgICAgICAgZ2VuZXJhdGVXb3Jrc2hlZXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBnZW5lcmF0ZVdvcmtzaGVldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gU1RBUlQ6IOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC4n+C4teC5gOC4iOC4reC4o+C5jCAi4Liq4Lij4LmJ4Liy4LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMIiAtLS0KICAgICAgICAgICAgY29uc3QgbGlua1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaW5rLXRhYicpOwogICAgICAgICAgICBjb25zdCBsaW5rSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpbmstaW5wdXQtYXJlYScpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIOKWvOKWvOKWvCBb4Lib4Lij4Liw4LiB4Liy4Lio4LiV4Lix4Lin4LmB4Lib4LijIFVJIOC5g+C4q+C4oeC5iF0g4pa84pa84pa8IC0tLQogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRUYWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXRhYicpOwogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRJbnB1dEFyZWEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LWlucHV0LWFyZWEnKTsKICAgICAgICAgICAgLy8gLS0tIOKWsuKWsuKWsiBb4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4Lib4Lij4Liw4LiB4Liy4Lio4LiV4Lix4Lin4LmB4Lib4LijXSDilrLilrLilrIgLS0tCgkJCQogICAgICAgICAgICAvLyAtLS0g4pa84pa84pa8IFtTVEFSVCBPRiBGSVhdIOC4m+C4o+C4sOC4geC4suC4qOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4miAi4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZIiAtLS0KCQkJY29uc3QgcGFyYWxsZWxUZXN0VGFiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhcmFsbGVsLXRlc3QtdGFiJyk7CiAgICAgICAgICAgIGNvbnN0IHBhcmFsbGVsVGVzdElucHV0QXJlYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LWlucHV0LWFyZWEnKTsKICAgICAgICAgICAgLy8gLS0tIFtFTkQgT0YgRklYXSAtLS0KCiAgICAgICAgICAgIC8vIEdlbmVyYXRpb24gVGFicwogICAgICAgICAgICB0b3BpY1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIC8vIERlYWN0aXZhdGUgb3RoZXJzCiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdGV4dFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAvLyBIaWRlIG90aGVycwogICAgICAgICAgICAgICAgdG9waWNJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZmlsZVRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICBmaWxlVGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgdGV4dFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIHBhbmVsCiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlcnMKICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgdGV4dElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtJbnB1dEFyZWEpIGxpbmtJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdElucHV0QXJlYSkgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDilrzilrzilrwgW0ZJWF0gSGlkZSBwYXJhbGxlbCBwYW5lbAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHdvcmtzaGVldFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICB3b3Jrc2hlZXRUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVycwogICAgICAgICAgICAgICAgdG9waWNUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIGJsdWVwcmludFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdFRhYikgcGFyYWxsZWxUZXN0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOyAvLyDilrzilrzilrwgW0ZJWF0gRGVhY3RpdmF0ZSBwYXJhbGxlbCB0YWIKCiAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXJzCiAgICAgICAgICAgICAgICB0b3BpY0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludElucHV0QXJlYSkgYmx1ZXByaW50SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0SW5wdXRBcmVhKSBwYXJhbGxlbFRlc3RJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBIaWRlIHBhcmFsbGVsIHBhbmVsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY29uc3QgYmFua1RhYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXRhYicpOwogICAgICAgICAgICBjb25zdCBiYW5rSW5wdXRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbmstaW5wdXQtYXJlYScpOwoKICAgICAgICAgICAgaWYoYmFua1RhYikgewogICAgICAgICAgICAgICAgYmFua1RhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVyIHRhYnMKICAgICAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGZpbGVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50VGFiKSBibHVlcHJpbnRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBEZWFjdGl2YXRlIHBhcmFsbGVsIHRhYgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICAgICAgYmFua1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlciBpbnB1dCBhcmVhcwogICAgICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RJbnB1dEFyZWEpIHBhcmFsbGVsVGVzdElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4pa84pa84pa8IFtGSVhdIEhpZGUgcGFyYWxsZWwgcGFuZWwKCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIGlucHV0IGFyZWEgYW5kIGxvYWQgdGhlIHF1ZXN0aW9ucwogICAgICAgICAgICAgICAgICAgIGJhbmtJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheVF1ZXN0aW9uQmFuaygpOyAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZihsaW5rVGFiKSB7CiAgICAgICAgICAgICAgICBsaW5rVGFiLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIEFjdGl2YXRlIHRoaXMgdGFiCiAgICAgICAgICAgICAgICAgICAgbGlua1RhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVycwogICAgICAgICAgICAgICAgICAgIHRvcGljVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHRleHRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50VGFiKSBibHVlcHJpbnRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7IC8vIOKWvOKWvOKWvCBbRklYXSBEZWFjdGl2YXRlIHBhcmFsbGVsIHRhYgoKICAgICAgICAgICAgICAgICAgICAvLyBTaG93IHRoaXMgcGFuZWwKICAgICAgICAgICAgICAgICAgICBsaW5rSW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXJzCiAgICAgICAgICAgICAgICAgICAgdG9waWNJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBmaWxlSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihibHVlcHJpbnRJbnB1dEFyZWEpIGJsdWVwcmludElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RJbnB1dEFyZWEpIHBhcmFsbGVsVGVzdElucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4pa84pa84pa8IFtGSVhdIEhpZGUgcGFyYWxsZWwgcGFuZWwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tbGluay1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUdlbmVyYXRlRnJvbUxpbmspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBFTkQ6IOC5guC4hOC5ieC4lOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC4n+C4teC5gOC4iOC4reC4o+C5jCAi4Liq4Lij4LmJ4Liy4LiH4LiI4Liy4LiB4Lil4Li04LiH4LiB4LmMIiAtLS0KCiAgICAgICAgICAgIC8vIC0tLSDilrzilrzilrwgW+C5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguKrguLPguKvguKPguLHguJrguYHguJfguYfguJogQmx1ZXByaW50IOC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lF0g4pa84pa84pa8IC0tLQogICAgICAgICAgICBpZihibHVlcHJpbnRUYWIpIHsKICAgICAgICAgICAgICAgIGJsdWVwcmludFRhYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBBY3RpdmF0ZSB0aGlzIHRhYgogICAgICAgICAgICAgICAgICAgIGJsdWVwcmludFRhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAvLyBEZWFjdGl2YXRlIG90aGVyIHRhYnMKICAgICAgICAgICAgICAgICAgICB0b3BpY1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGZpbGVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtUYWIpIGxpbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmFua1RhYikgYmFua1RhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBpZihwYXJhbGxlbFRlc3RUYWIpIHBhcmFsbGVsVGVzdFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsgLy8g4pa84pa84pa8IFtGSVhdIERlYWN0aXZhdGUgcGFyYWxsZWwgdGFiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGlzIGlucHV0IGFyZWEKICAgICAgICAgICAgICAgICAgICBibHVlcHJpbnRJbnB1dEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gSGlkZSBvdGhlciBpbnB1dCBhcmVhcwogICAgICAgICAgICAgICAgICAgIHRvcGljSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHRleHRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgZmlsZUlucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB3b3Jrc2hlZXRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYobGlua0lucHV0QXJlYSkgbGlua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZihiYW5rSW5wdXRBcmVhKSBiYW5rSW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmKHBhcmFsbGVsVGVzdElucHV0QXJlYSkgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDilrzilrzilrwgW0ZJWF0gSGlkZSBwYXJhbGxlbCBwYW5lbAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCQkJCgkJCS8vIC0tLSDilrzilrzilrwgW1NUQVJUIE9GIEZJWF0g4LmB4LiB4LmJ4LmE4LiCIEV2ZW50IExpc3RlbmVyIOC4guC4reC4hyAi4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZIiAtLS0KICAgICAgICAgICAgaWYocGFyYWxsZWxUZXN0VGFiKSB7CiAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RUYWIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gQWN0aXZhdGUgdGhpcyB0YWIKICAgICAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RUYWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gRGVhY3RpdmF0ZSBvdGhlciB0YWJzCiAgICAgICAgICAgICAgICAgICAgdG9waWNUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICAgICAgdGV4dFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBmaWxlVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIHdvcmtzaGVldFRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICBpZihsaW5rVGFiKSBsaW5rVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGJsdWVwcmludFRhYikgYmx1ZXByaW50VGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAgICAgICAgIGlmKGJhbmtUYWIpIGJhbmtUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CgogICAgICAgICAgICAgICAgICAgIC8vIFNob3cgdGhpcyBpbnB1dCBhcmVhCiAgICAgICAgICAgICAgICAgICAgcGFyYWxsZWxUZXN0SW5wdXRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIC8vIEhpZGUgb3RoZXIgaW5wdXQgYXJlYXMKICAgICAgICAgICAgICAgICAgICB0b3BpY0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICB0ZXh0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGZpbGVJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgd29ya3NoZWV0SW5wdXRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmKGxpbmtJbnB1dEFyZWEpIGxpbmtJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmx1ZXByaW50SW5wdXRBcmVhKSBibHVlcHJpbnRJbnB1dEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYoYmFua0lucHV0QXJlYSkgYmFua0lucHV0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBbRU5EIE9GIEZJWF0gLS0tCgogICAgICAgICAgICBjb25zdCBibHVlcHJpbnRVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdXBsb2FkLWlucHV0Jyk7CiAgICAgICAgICAgIGNvbnN0IGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWJsdWVwcmludC1idG4nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChibHVlcHJpbnRVcGxvYWRJbnB1dCkgewovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgYmx1ZXByaW50VXBsb2FkSW5wdXQg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApjb25zdCBibHVlcHJpbnRVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdXBsb2FkLWlucHV0Jyk7CmNvbnN0IGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWJsdWVwcmludC1idG4nKTsKY29uc3QgYmx1ZXByaW50T3B0aW9uc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtb3B0aW9ucy1jb250YWluZXInKTsKY29uc3Qgc2VwYXJhdGVDb250ZW50Q2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1jaGVja2JveCcpOwpjb25zdCB0b3BpY3NMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC10b3BpY3MtbGlzdC1jb250YWluZXInKTsKY29uc3QgdG9waWNzTGlzdERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdG9waWNzLWxpc3QnKTsKCmlmIChibHVlcHJpbnRVcGxvYWRJbnB1dCkgewogICAgYmx1ZXByaW50VXBsb2FkSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGV2ZW50KSA9PiB7CiAgICAgICAgLy8g4LiL4LmI4Lit4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmA4LiB4LmI4Liy4LmA4Lih4Li34LmI4Lit4Lih4Li14LiB4Liy4Lij4Lit4Lix4Lib4LmC4Lir4Lil4LiU4LmE4Lif4Lil4LmM4LmD4Lir4Lih4LmICiAgICAgICAgYmx1ZXByaW50T3B0aW9uc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHNlcGFyYXRlQ29udGVudENoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTsKICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSB0cnVlOwoKICAgICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICAgIGlmIChmaWxlKSB7CiAgICAgICAgICAgIC8vIOC5gOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIOC5gOC4o+C4tOC5iOC4oeC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4q+C4seC4p+C4guC5ieC4reC4iOC4suC4geC5hOC4n+C4peC5jCBQREYKICAgICAgICAgICAgICAgIGNvbnN0IHBkZlRleHQgPSBhd2FpdCBleHRyYWN0VGV4dEZyb21QZGYoZmlsZSk7CiAgICAgICAgICAgICAgICBhd2FpdCBhbmFseXplQmx1ZXByaW50Rm9yVG9waWNzKHBkZlRleHQpOyAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYgKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoJ+C5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4reC5iOC4suC4meC5hOC4n+C4peC5jCBQREYg4LmA4Lie4Li34LmI4Lit4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4LmE4LiU4LmJJyk7CiAgICAgICAgICAgICAgICBibHVlcHJpbnRPcHRpb25zQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7Cn0KCi8vIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4miBDaGVja2JveCAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lii4LiB4LiV4Liy4Lih4LmA4LiZ4Li34LmJ4Lit4Lir4LiyIgppZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3gpIHsKICAgIHNlcGFyYXRlQ29udGVudENoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGV2ZW50LnRhcmdldC5jaGVja2VkOwogICAgICAgIC8vIOC5geC4quC4lOC4hy/guIvguYjguK3guJnguKPguLLguKLguIHguLLguKPguKvguLHguKfguILguYnguK0KICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsICFpc0NoZWNrZWQpOwogICAgICAgIC8vIOC4m+C4tOC4lC/guYDguJvguLTguJTguJvguLjguYjguKHguKrguKPguYnguLLguIfguKvguKXguLHguIEKICAgICAgICBnZW5lcmF0ZUZyb21CbHVlcHJpbnRCdG4uZGlzYWJsZWQgPSBpc0NoZWNrZWQ7CiAgICB9KTsKfQoKLy8gRXZlbnQgTGlzdGVuZXIgKERlbGVnYXRpb24pIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC5gOC4peC4t+C4reC4geC4q+C4seC4p+C4guC5ieC4rQppZiAodG9waWNzTGlzdERpdikgewovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgdG9waWNzTGlzdERpdiDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmlmICh0b3BpY3NMaXN0RGl2KSB7CiAgICB0b3BpY3NMaXN0RGl2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7CiAgICAgICAgY29uc3QgcXVpekJ0biA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcudG9waWMtc2VsZWN0aW9uLWJ0bicpOwogICAgICAgIGNvbnN0IGNvbnRlbnRCdG4gPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmdlbmVyYXRlLWNvbnRlbnQtYnRuJyk7CgogICAgICAgIGlmIChxdWl6QnRuKSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4m+C4uOC5iOC4oSAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIgogICAgICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKHF1aXpCdG4uZGF0YXNldC50b3BpYyk7CiAgICAgICAgICAgIGdlbmVyYXRlUXVpekZvclNpbmdsZVRvcGljKHRvcGljKTsKICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnRCdG4pIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LiE4Lil4Li04LiB4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYDguJnguLfguYnguK3guKvguLLguKrguLPguKvguKPguLHguJrguKrguK3guJkiCiAgICAgICAgICAgIGNvbnN0IHRvcGljID0gdW5lc2NhcGUoY29udGVudEJ0bi5kYXRhc2V0LnRvcGljKTsKICAgICAgICAgICAgaGFuZGxlR2VuZXJhdGVUZWFjaGluZ0NvbnRlbnQodG9waWMpOwogICAgICAgIH0KICAgIH0pOwp9Ci8vIOKWsuKWsuKWsiBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C4p+C4suC4h+C4l+C4seC4miDilrLilrLilrIKfQovLyDilrLilrLilrIgRU5EOiDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguKfguLLguIfguJfguLHguJog4pay4pay4payCiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICAgICAgaWYgKGdlbmVyYXRlRnJvbUJsdWVwcmludEJ0bikgewogICAgICAgICAgICAgICAgZ2VuZXJhdGVGcm9tQmx1ZXByaW50QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyAtLS0g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguILguK3guIcgQmx1ZXByaW50XSDilrLilrLilrIgLS0tCgkJCQoJCQkvLyA9PT0g4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUID09PQogICAgICAgICAgICBjb25zdCBwYXJhbGxlbFRlc3RVcGxvYWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXJhbGxlbC10ZXN0LXVwbG9hZC1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBnZW5lcmF0ZUZyb21QYXJhbGxlbFRlc3RCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1wYXJhbGxlbC10ZXN0LWJ0bicpOwoKICAgICAgICAgICAgaWYgKHBhcmFsbGVsVGVzdFVwbG9hZElucHV0KSB7CiAgICAgICAgICAgICAgICBwYXJhbGxlbFRlc3RVcGxvYWRJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyDguYDguJvguLTguJQv4Lib4Li04LiU4Lib4Li44LmI4Lih4LiV4Liy4Lih4LiB4Liy4Lij4LmA4Lil4Li34Lit4LiB4LmE4Lif4Lil4LmMCiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhdGVGcm9tUGFyYWxsZWxUZXN0QnRuLmRpc2FibGVkID0gZXZlbnQudGFyZ2V0LmZpbGVzLmxlbmd0aCA9PT0gMDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZ2VuZXJhdGVGcm9tUGFyYWxsZWxUZXN0QnRuKSB7CiAgICAgICAgICAgICAgICBnZW5lcmF0ZUZyb21QYXJhbGxlbFRlc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmC4LiU4Lii4LmE4Lih4LmI4Liq4LmI4LiH4LiE4LmI4Liy4LmD4LiU4LmGIOC5gOC4guC5ieC4suC5hOC4mwogICAgICAgICAgICAgICAgICAgIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxUZXN0KCk7IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFN0dWRlbnQgZmxvdyBidXR0b25zCiAgICAgICAgICAgIGxvYWRRdWl6QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlTG9hZFF1aXopOwovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4LiaIGV2ZW50IGxpc3RlbmVyIOC4guC4reC4h+C4m+C4uOC5iOC4oSBzdGFydFF1aXpCdG4g4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiU4LmJ4Lin4Lii4LmC4LiE4LmJ4LiU4LiZ4Li14LmJIOKWvOKWvOKWvApzdGFydFF1aXpCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAvLyAtLS0gW+C4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4gl0gLS0tCiAgICAvLyDguYDguIrguYfguITguIHguYjguK3guJnguKfguYjguLLguKHguLXguIrguLfguYjguK3guK3guKLguLnguYjguYHguKXguYnguKfguKvguKPguLfguK3guKLguLHguIcgKOC4luC5ieC4suC4oeC4suC4iOC4suC4geC5guC4q+C4oeC4lOC4quC4reC4muC4i+C5iOC4reC4oSDguIjguLDguKHguLXguIrguLfguYjguK3guK3guKLguLnguYjguYHguKXguYnguKcpCiAgICAvLyDguJbguYnguLLguKLguLHguIfguYTguKHguYjguKHguLUg4LiE4LmI4Lit4Lii4LmE4Lib4LiU4Li24LiH4LiI4Liy4LiBIERyb3Bkb3duCiAgICBpZiAoIWN1cnJlbnRTdHVkZW50TmFtZSkgewogICAgICAgIGNvbnN0IHN0dWRlbnROYW1lU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtbmFtZS1zZWxlY3QnKTsKICAgICAgICBjdXJyZW50U3R1ZGVudE5hbWUgPSBzdHVkZW50TmFtZVNlbGVjdC52YWx1ZTsKICAgIH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICBpZiAoIWN1cnJlbnRTdHVkZW50TmFtZSkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguIrguLfguYjguK3guILguK3guIfguITguLjguJMiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBxdWl6SWQgPSBjdXJyZW50UXVpekRhdGEuaWQ7CiAgICAgICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2AsIGN1cnJlbnRTdHVkZW50TmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Lin4LmI4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4Liq4LmI4LiH4LmA4LiB4LmI4Liy4Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgY29uc3Qgc3VibWlzc2lvblNuYXAgPSBhd2FpdCBnZXREb2Moc3VibWlzc2lvblJlZik7CgogICAgICAgIGlmICghc3VibWlzc2lvblNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgLy8gMi4g4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4LmA4LiE4Lii4Liq4LmI4LiH4LmA4Lil4LiiIOC5g+C4q+C5ieC4quC4o+C5ieC4suC4h+C5gOC4reC4geC4quC4suC4o+C5g+C4q+C4oeC5iOC4nuC4o+C5ieC4reC4oSBhdHRlbXB0czogW10KICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHN1Ym1pc3Npb25SZWYsIHsKICAgICAgICAgICAgICAgIHN0dWRlbnROYW1lOiBjdXJyZW50U3R1ZGVudE5hbWUsCiAgICAgICAgICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICAgIGJlaGF2aW9yTG9nOiBbXSwKICAgICAgICAgICAgICAgIGF0dGVtcHRzOiBbXQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyAzLiDguJbguYnguLLguYDguITguKLguKrguYjguIfguYHguKXguYnguKcg4LmD4Lir4LmJ4Lit4Lix4Lib4LmA4LiU4LiV4LmB4LiE4LmI4LmA4Lin4Lil4Liy4LiX4Li14LmI4LmA4Lij4Li04LmI4Lih4Lil4LmI4Liy4Liq4Li44LiUIOC5guC4lOC4ouC5hOC4oeC5iOC5hOC4m+C4ouC4uOC5iOC4h+C4geC4seC4miBhcnJheSAnYXR0ZW1wdHMnCiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgICAgICBzdGFydGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gY3JlYXRlL3VwZGF0ZSBzdWJtaXNzaW9uIHJlY29yZDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4o+C4tOC5iOC4oeC4l+C4s+C4guC5ieC4reC4quC4reC4miDguIHguKPguLjguJPguLLguKXguK3guIfguYPguKvguKHguYjguK3guLXguIHguITguKPguLHguYnguIciKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiV4LmJ4Lit4LiZ4Lij4Lix4Lia4LiC4Lit4LiH4LmC4Lir4Lih4LiU4LiL4LmI4Lit4LihICjguJbguYnguLLguKHguLUpIOC5gOC4nuC4t+C5iOC4reC4hOC4p+C4suC4oeC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ogogICAgY29uc3Qgd2VsY29tZU1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW1lZGlhbC1uYW1lLWRpc3BsYXknKTsKICAgIGlmKHdlbGNvbWVNc2cpIHdlbGNvbWVNc2cucmVtb3ZlKCk7CgogICAgc3R1ZGVudE5hbWVTZWxlY3Rpb25WaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICBkaXNwbGF5UXVpekZvclN0dWRlbnQoY3VycmVudFF1aXpEYXRhKTsKfSk7CiAgICAgICAgICAgIC8vIE5FVzogTGl2ZSBHYW1lIExpc3RlbmVycwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnam9pbi1saXZlLWdhbWUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93Sm9pbkdhbWVWaWV3KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tam9pbi1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlSm9pbkxpdmVHYW1lKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhY2stdG8tc3R1ZGVudC1pbml0aWFsLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2hvd1ZpZXcoJ3N0dWRlbnQnKSk7CgoKICAgICAgICAgICAgLy8gPT09IFNUQVJUOiDguK3guLHguJvguYDguJTguJXguKrguYjguKfguJkgRXZlbnQgTGlzdGVuZXJzIOC4guC4reC4h+C4m+C4uOC5iOC4oSBFeHBvcnQg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUID09PQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIGZvciBTY29yZXMgVGFibGUgZmlsZW5hbWUKICAgICAgICAgICAgY29uc3QgZ2V0UmVzdWx0c0ZpbGVuYW1lID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcXVpelRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtcXVpei10aXRsZScpLnRleHRDb250ZW50LnJlcGxhY2UoL1teYS16MC05XS9naSwgJ18nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGByZXN1bHRzXyR7cXVpelRpdGxlIHx8ICdxdWl6J31gOwogICAgICAgICAgICB9OwoJCQkKCQkJLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4iuC5iOC4reC4h+C4hOC5ieC4meC4q+C4suC4q+C4seC4p+C4guC5ieC4reC4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jAogICAgICAgICAgICAvLyDilrzilrzilrwg4LiZ4Liz4LmC4LiE4LmJ4LiU4Lia4Lil4LmH4Lit4LiB4LiZ4Li14LmJ4LmE4Lib4LmB4LiX4LiZ4LiX4Li14LmI4LiC4Lit4LiH4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvApjb25zdCB0b3BpY1NlYXJjaElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdGgtdG9waWMtc2VhcmNoLWlucHV0Jyk7CmlmICh0b3BpY1NlYXJjaElucHV0KSB7CiAgICB0b3BpY1NlYXJjaElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICBjb25zdCBzZWFyY2hUZXJtID0gZS50YXJnZXQudmFsdWUudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgY29uc3QgY2hlY2tib3hDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CiAgICAgICAgCiAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiI4Lix4LiU4LiB4Liy4Lij4LmB4LiV4LmI4Lil4Liw4Lir4Lih4Lin4LiU4Lir4Lih4Li54LmICiAgICAgICAgY29uc3QgY2F0ZWdvcmllcyA9IGNoZWNrYm94Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy50b3BpYy1jYXRlZ29yeScpOwogICAgICAgIGNhdGVnb3JpZXMuZm9yRWFjaChjYXRlZ29yeSA9PiB7CiAgICAgICAgICAgIGxldCBjYXRlZ29yeUhhc1Zpc2libGVUb3BpYyA9IGZhbHNlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiI4Lix4LiU4LiB4Liy4Lij4LmB4LiV4LmI4Lil4LiwICLguJrguKPguKPguJfguLHguJQiIOC4guC4reC4h+C4q+C4seC4p+C4guC5ieC4rQogICAgICAgICAgICBjb25zdCB0b3BpY1Jvd3MgPSBjYXRlZ29yeS5xdWVyeVNlbGVjdG9yQWxsKCcudG9waWMtcm93Jyk7CiAgICAgICAgICAgIHRvcGljUm93cy5mb3JFYWNoKHJvdyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0b3BpY05hbWUgPSByb3cucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtZGlzcGxheScpLnRleHRDb250ZW50LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmICh0b3BpY05hbWUuaW5jbHVkZXMoc2VhcmNoVGVybSkpIHsKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgLy8g4LmB4Liq4LiU4LiH4LiX4Lix4LmJ4LiH4Lia4Lij4Lij4LiX4Lix4LiUCiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlIYXNWaXNpYmxlVG9waWMgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByb3cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgLy8g4LiL4LmI4Lit4LiZ4LiX4Lix4LmJ4LiH4Lia4Lij4Lij4LiX4Lix4LiUCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8g4LiL4LmI4Lit4LiZL+C5geC4quC4lOC4h+C4iuC4t+C5iOC4reC4q+C4oeC4p+C4lOC4q+C4oeC4ueC5iAogICAgICAgICAgICBpZiAoY2F0ZWdvcnlIYXNWaXNpYmxlVG9waWMpIHsKICAgICAgICAgICAgICAgIGNhdGVnb3J5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2F0ZWdvcnkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSk7Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C5geC4l+C4meC4l+C4teC5iCDilrLilrLilrIKCiAgICAgICAgICAgIC8vIEV4cG9ydCBidXR0b25zIGZvciBTY29yZXMgVGFibGUgKENIQU5HRUQpCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtaW1hZ2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzSW1hZ2UoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1wZGYtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzUERGKCdyZXN1bHRzLXRhYmxlJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC13b3JkLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZXhwb3J0VGFibGVBc1dvcmQoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJywgZ2V0UmVzdWx0c0ZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1leGNlbC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGV4cG9ydFRhYmxlQXNFeGNlbCgncmVzdWx0cy10YWJsZScsIGdldFJlc3VsdHNGaWxlbmFtZSgpKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIZWxwZXIgZnVuY3Rpb24gZm9yIExlYWRlcmJvYXJkIFRhYmxlIGZpbGVuYW1lCiAgICAgICAgICAgIGNvbnN0IGdldExlYWRlcmJvYXJkRmlsZW5hbWUgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBxdWl6VGl0bGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy1xdWl6LXRpdGxlJykudGV4dENvbnRlbnQucmVwbGFjZSgvW15hLXowLTldL2dpLCAnXycpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYGxlYWRlcmJvYXJkXyR7cXVpelRpdGxlIHx8ICdxdWl6J31gOwogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRXhwb3J0IGJ1dHRvbnMgZm9yIExlYWRlcmJvYXJkIFRhYmxlIChORVcpCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVhZGVyYm9hcmQtaW1hZ2UtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzSW1hZ2UoJ3F1aXotbGVhZGVyYm9hcmQtdGFibGUtY29udGFpbmVyJywgZ2V0TGVhZGVyYm9hcmRGaWxlbmFtZSgpKSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVhZGVyYm9hcmQtcGRmLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZXhwb3J0VGFibGVBc1BERigncXVpei1sZWFkZXJib2FyZC10YWJsZScsIGdldExlYWRlcmJvYXJkRmlsZW5hbWUoKSkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LWxlYWRlcmJvYXJkLXdvcmQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBleHBvcnRUYWJsZUFzV29yZCgncXVpei1sZWFkZXJib2FyZC10YWJsZS1jb250YWluZXInLCBnZXRMZWFkZXJib2FyZEZpbGVuYW1lKCkpKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cG9ydC1sZWFkZXJib2FyZC1leGNlbC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IGV4cG9ydFRhYmxlQXNFeGNlbCgncXVpei1sZWFkZXJib2FyZC10YWJsZScsIGdldExlYWRlcmJvYXJkRmlsZW5hbWUoKSkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gPT09IEVORDog4Lit4Lix4Lib4LmA4LiU4LiV4Liq4LmI4Lin4LiZIEV2ZW50IExpc3RlbmVycyDguILguK3guIfguJvguLjguYjguKEgRXhwb3J0IOC4l+C4seC5ieC4h+C4q+C4oeC4lCA9PT0KCgoKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4miBldmVudCBsaXN0ZW5lciDguILguK3guIcgcHJvamVjdFF1aXp6ZXNMaXN0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKcHJvamVjdFF1aXp6ZXNMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHsKICAgIC8vIDEuIOC4m+C4o+C4sOC4geC4suC4qOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lAogICAgY29uc3QgbWFpbkNhcmQgPSBlLnRhcmdldC5jbG9zZXN0KCcucXVpei1yZXN1bHQtY2FyZCcpOwogICAgY29uc3QgcG9zdFRlc3RCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtcG9zdC10ZXN0LWJ0bicpOwogICAgY29uc3QgY29tcGFyZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5jb21wYXJlLXJlc3VsdHMtYnRuJyk7CiAgICBjb25zdCBsZXNzb25CdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtbGVzc29uLWJ0bicpOwogICAgY29uc3Qgc3RhckJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zdGFyLXF1aXotYnRuJyk7CiAgICBjb25zdCBjb3B5QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmNvcHktcXVpei1pZC1saXN0LWJ0bicpOwogICAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5lZGl0LXF1aXotYnRuJyk7CiAgICBjb25zdCBzZXR0aW5nc0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5xdWl6LXNldHRpbmdzLWJ0bicpOwogICAgY29uc3QgZHVwbGljYXRlQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmR1cGxpY2F0ZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcmVuYW1lQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnJlbmFtZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcGFyYWxsZWxCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcucGFyYWxsZWwtcXVpei1idG4nKTsKICAgIGNvbnN0IG1vdmVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcubW92ZS1xdWl6LWJ0bicpOwogICAgY29uc3QgcGFpckJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wYWlyLXF1aXotYnRuJyk7CiAgICBjb25zdCB1bnBhaXJCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcudW5wYWlyLXF1aXotYnRuJyk7CiAgICBjb25zdCBwcmVzZW50QnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLnN0YXJ0LXByZXNlbnRhdGlvbi1saXN0LWJ0bicpOwogICAgY29uc3QgdHJ5UXVpekJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5hZG1pbi10cnktcXVpei1saXN0LWJ0bicpOwogICAgY29uc3QgZXhwb3J0UGRmQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmV4cG9ydC1wZGYtbGlzdC1idG4nKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcXVpei1idG4nKTsKICAgIGNvbnN0IHN0YXR1c0J0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5xdWl6LXN0YXR1cy1idG4nKTsKICAgIGNvbnN0IHRvZ2dsZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy50b2dnbGUtYWN0aW9ucy1idG4nKTsKICAgIGNvbnN0IGVhc3lCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtZWFzeS12ZXJzaW9uLWJ0bicpOwoJY29uc3QgZWFzeVBhcmFsbGVsQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmdlbmVyYXRlLWVhc3ktcGFyYWxsZWwtYnRuJyk7CiAgICAKICAgIC8vIOC4m+C4uOC5iOC4oeC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC5gOC4geC4oQogICAgY29uc3QgZ2FtZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zdGFydC1nYW1lLWJ0bicpOwogICAgY29uc3QgbGl2ZVJhY2VCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcuc3RhcnQtbGl2ZS1yYWNlLWJ0bicpOwoKICAgIC8vIDIuIOC4leC4o+C4o+C4geC4sOC4geC4suC4o+C4l+C4s+C4h+C4suC4meC4guC4reC4h+C4m+C4uOC5iOC4oQogICAgaWYgKGdhbWVCdG4pIHsKICAgICAgICAvLyAtLS0gW1NUQVJUXSDguIjguLjguJTguJfguLXguYjguYHguIHguYnguYTguIIgLS0tCiAgICAgICAgY29uc3QgcXVpeklkID0gZ2FtZUJ0bi5kYXRhc2V0LnF1aXpJZDsgLy8g4LmB4LiB4LmJ4LiI4Liy4LiBIC5pZCDguYDguJvguYfguJkgLnF1aXpJZAogICAgICAgIGNvbnN0IG1vZGUgPSBnYW1lQnRuLmRhdGFzZXQubW9kZTsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC4tOC5ieC4meC4quC4uOC4lOC4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICBpZiAocXVpekRhdGEpIHsKICAgICAgICAgICAgc2hvd0dhbWVTdGFydENvbmZpcm1hdGlvbk1vZGFsKHF1aXpJZCwgbW9kZSwgcXVpekRhdGEudG9waWMpOwogICAgICAgIH0KICAgIH0gCmVsc2UgaWYgKGxpdmVSYWNlQnRuKSB7CiAgICBjb25zdCBxdWl6SWQgPSBsaXZlUmFjZUJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgIC8vIOC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5gOC4o+C4tOC5iOC4oeC5gOC4geC4oeC4quC4lOC5guC4lOC4ouC4leC4o+C4hyDguYTguKHguYjguJXguYnguK3guIfguYHguKrguJTguIfguJvguYrguK3guJvguK3guLHguJsKICAgIGhhbmRsZVN0YXJ0TGl2ZVJhY2UocXVpeklkKTsKfQogICAgZWxzZSBpZiAodG9nZ2xlQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gdG9nZ2xlQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBhY3Rpb25zLWNvbnRhaW5lci0ke3F1aXpJZH1gKTsKICAgICAgICBpZiAoY29udGFpbmVyKSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChwb3N0VGVzdEJ0bikgewogICAgICAgIGNvbnN0IHF1aXpJZCA9IHBvc3RUZXN0QnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICBpZiAocXVpekRhdGEpIHsgaGFuZGxlR2VuZXJhdGVQYXJhbGxlbFBvc3RUZXN0KHF1aXpEYXRhKTsgfQogICAgfQogICAgZWxzZSBpZiAoY29tcGFyZUJ0bikgewogICAgICAgIGhhbmRsZUNvbXBhcmVSZXN1bHRzKGNvbXBhcmVCdG4uZGF0YXNldC5xdWl6SWQsIGNvbXBhcmVCdG4uZGF0YXNldC5wcmVUZXN0SWQpOwogICAgfQogICAgZWxzZSBpZiAobGVzc29uQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gbGVzc29uQnRuLmRhdGFzZXQucXVpeklkOwogICAgICAgIGNvbnN0IHF1aXpEYXRhID0gYWxsUXVpenplcy5maW5kKHEgPT4gcS5pZCA9PT0gcXVpeklkKTsKICAgICAgICBpZiAocXVpekRhdGEgJiYgcXVpekRhdGEubGVzc29uUGxhbikgewogICAgICAgICAgICBkaXNwbGF5TGVzc29uUGxhbihxdWl6RGF0YS5sZXNzb25QbGFuLCBxdWl6RGF0YSk7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oJ+C5geC4quC4lOC4h+C5geC4nOC4meC4geC4suC4o+C4quC4reC4meC4l+C4teC5iOC4muC4seC4meC4l+C4tuC4geC5hOC4p+C5ieC5geC4peC5ieC4pyDguKvguLLguIHguJXguYnguK3guIfguIHguLLguKPguKrguKPguYnguLLguIfguYPguKvguKHguYjguYDguJnguLfguYjguK3guIfguIjguLLguIHguKHguLXguJzguLnguYnguKrguK3guJrguYDguJ7guLTguYjguKEg4LiB4Lij4Li44LiT4Liy4LiB4LiUICLguKrguKPguYnguLLguIfguYPguKvguKHguYgiJywgKCkgPT4gaGFuZGxlR2VuZXJhdGVMZXNzb25QbGFuKHF1aXpJZCkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWF0aW9uLW1vZGFsJykucXVlcnlTZWxlY3RvcignaDMnKS50ZXh0Q29udGVudCA9ICfguYHguJzguJnguIHguLLguKPguKrguK3guJknOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1kZWxldGUtYnRuJykudGV4dENvbnRlbnQgPSAn4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmIJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoYW5kbGVHZW5lcmF0ZUxlc3NvblBsYW4ocXVpeklkKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIGlmIChzdGFyQnRuKSB7IGhhbmRsZVRvZ2dsZVN0YXJRdWl6KHN0YXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChjb3B5QnRuKSB7IGNvcHlUZXh0VG9DbGlwYm9hcmQoY29weUJ0bi5kYXRhc2V0LnF1aXpJZCwgIuC4hOC4seC4lOC4peC4reC4geC4o+C4q+C4seC4quC5geC4peC5ieC4pyEiKTsgfQogICAgZWxzZSBpZiAoZWRpdEJ0bikgeyBoYW5kbGVPcGVuUXVpekVkaXRvcihlZGl0QnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAoc2V0dGluZ3NCdG4pIHsgaGFuZGxlUXVpelNldHRpbmdzKHNldHRpbmdzQnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAoZHVwbGljYXRlQnRuKSB7IGhhbmRsZUR1cGxpY2F0ZVF1aXooZHVwbGljYXRlQnRuLmRhdGFzZXQucXVpeklkKTsgfQogICAgZWxzZSBpZiAocmVuYW1lQnRuKSB7IGhhbmRsZVJlbmFtZVF1aXoocmVuYW1lQnRuLmRhdGFzZXQucXVpeklkLCByZW5hbWVCdG4uZGF0YXNldC50b3BpYyk7IH0KICAgIGVsc2UgaWYgKHBhcmFsbGVsQnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gcGFyYWxsZWxCdG4uZGF0YXNldC5xdWl6SWQ7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpOwogICAgICAgIGlmIChxdWl6RGF0YSkgeyBoYW5kbGVHZW5lcmF0ZVBhcmFsbGVsRnJvbUJhbmsocXVpekRhdGEpOyB9CiAgICB9CiAgICBlbHNlIGlmIChtb3ZlQnRuKSB7IGhhbmRsZU1vdmVRdWl6KG1vdmVCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChwYWlyQnRuKSB7IGhhbmRsZU1hbnVhbFF1aXpQYWlyaW5nKHBhaXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmICh1bnBhaXJCdG4pIHsgaGFuZGxlVW5wYWlyUXVpeih1bnBhaXJCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChwcmVzZW50QnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gcHJlc2VudEJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSk7CiAgICB9CiAgICBlbHNlIGlmICh0cnlRdWl6QnRuKSB7CiAgICAgICAgY29uc3QgcXVpeklkID0gdHJ5UXVpekJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBjb25zdCBxdWl6RGF0YSA9IGFsbFF1aXp6ZXMuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICAgICAgaWYgKHF1aXpEYXRhKSB7IGN1cnJlbnRRdWl6RGF0YSA9IHF1aXpEYXRhOyBzdGFydEFkbWluVGVzdCgpOyB9CiAgICB9CiAgICBlbHNlIGlmIChleHBvcnRQZGZCdG4pIHsKICAgICAgICBhY3Rpb25UYXJnZXRJZCA9IGV4cG9ydFBkZkJ0bi5kYXRhc2V0LnF1aXpJZDsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwb3J0LXBkZi1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQogICAgZWxzZSBpZiAoZGVsZXRlQnRuKSB7CiAgICAgICAgc2hvd0NvbmZpcm1hdGlvbihg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaICIke2RlbGV0ZUJ0bi5kYXRhc2V0LnRvcGljfSI/IOC4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lOC4iOC4sOC4luC4ueC4geC4peC4muC4reC4ouC5iOC4suC4h+C4luC4suC4p+C4o2AsICgpID0+IGhhbmRsZURlbGV0ZVF1aXooZGVsZXRlQnRuLmRhdGFzZXQucXVpeklkKSk7CiAgICB9CiAgICBlbHNlIGlmIChzdGF0dXNCdG4pIHsgaGFuZGxlUXVpelN0YXR1cyhzdGF0dXNCdG4uZGF0YXNldC5xdWl6SWQpOyB9CiAgICBlbHNlIGlmIChlYXN5QnRuKSB7CiAgICAgICAgaGFuZGxlR2VuZXJhdGVFYXN5VmVyc2lvblF1aXooZWFzeUJ0bi5kYXRhc2V0LnF1aXpJZCk7CiAgICB9CgkKCWVsc2UgaWYgKGVhc3lQYXJhbGxlbEJ0bikgewogICAgaGFuZGxlR2VuZXJhdGVFYXN5UGFyYWxsZWxRdWl6KGVhc3lQYXJhbGxlbEJ0bi5kYXRhc2V0LnF1aXpJZCk7Cn0KCQogICAgZWxzZSBpZiAobWFpbkNhcmQpIHsgc2hvd1F1aXpEZXRhaWxWaWV3KG1haW5DYXJkLmRhdGFzZXQucXVpeklkKTsgfQp9KTsKCiAgICAvLyBTdHVkZW50OiDguJvguLjguYjguKHguYPguJnguKvguJnguYnguLLguYDguKXguLfguK3guIHguJzguLnguYnguYDguKXguYjguJkKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtdGVhbS1zZWxlY3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBzaG93Vmlldygnc3R1ZGVudCcpKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLXRlYW0tcGxheWVycy1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1BbmRTdGFydFRlYW1RdWl6KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotbGVhZGVyYm9hcmQtdGFibGUnKS5xdWVyeVNlbGVjdG9yKCd0aGVhZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlciA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5zb3J0YWJsZS1oZWFkZXInKTsKICAgICAgICAgICAgICAgIGlmICghaGVhZGVyIHx8ICFoZWFkZXIuZGF0YXNldC5zb3J0KSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3QgbmV3U29ydEJ5ID0gaGVhZGVyLmRhdGFzZXQuc29ydDsKICAgICAgICAgICAgICAgIGlmIChxdWl6TGVhZGVyYm9hcmRTb3J0QnkgPT09IG5ld1NvcnRCeSkgewogICAgICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4q+C4seC4p+C4guC5ieC4reC5gOC4lOC4tOC4oSDguYPguKvguYnguKrguKXguLHguJrguJfguLTguKjguJfguLLguIcKICAgICAgICAgICAgICAgICAgICBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPSBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gJ2Rlc2MnIDogJ2FzYyc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4hOC4peC4tOC4geC4q+C4seC4p+C4guC5ieC4reC5g+C4q+C4oeC5iAogICAgICAgICAgICAgICAgICAgIHF1aXpMZWFkZXJib2FyZFNvcnRCeSA9IG5ld1NvcnRCeTsKICAgICAgICAgICAgICAgICAgICAvLyDguJXguLHguYnguIfguITguYjguLLguJfguLTguKjguJfguLLguIfguYDguKPguLTguYjguKHguJXguYnguJnguKrguLPguKvguKPguLHguJrguYHguJXguYjguKXguLDguJvguKPguLDguYDguKDguJfguILguYnguK3guKHguLnguKUKICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0QmFzZWRTb3J0ID0gWydzdHVkZW50TmFtZSddOwogICAgICAgICAgICAgICAgICAgIHF1aXpMZWFkZXJib2FyZFNvcnRPcmRlciA9IHRleHRCYXNlZFNvcnQuaW5jbHVkZXMobmV3U29ydEJ5KSA/ICdhc2MnIDogJ2Rlc2MnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4Lin4Liy4LiU4LiV4Liy4Lij4Liy4LiH4LmD4Lir4Lih4LmI4LiU4LmJ4Lin4Lii4LiC4LmJ4Lit4Lih4Li54Lil4Lil4LmI4Liy4Liq4Li44LiU4LmB4Lil4Liw4LiB4Liy4Lij4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LmD4Lir4Lih4LmICiAgICAgICAgICAgICAgICByZW5kZXJRdWl6TGVhZGVyYm9hcmQoY3VycmVudFN1Ym1pc3Npb25zLCBjdXJyZW50UXVpekRhdGEsICdxdWl6LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBQcmVzZW50YXRpb24gTW9kZSBMaXN0ZW5lcnMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXByZXNlbnRhdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlUHJlc2VudGF0aW9uKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXYtcXVlc3Rpb24tYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByZXNlbnRhdGlvblNsaWRlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZS0tOwogICAgICAgICAgICAgICAgICAgIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dC1xdWVzdGlvbi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zICYmIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSA8IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSsrOwogICAgICAgICAgICAgICAgICAgIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGN1cnJlbnRQcmVzZW50YXRpb25TbGlkZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyBIYW5kbGUgZXhpdGluZyBmdWxsc2NyZWVuIHdpdGggRVNDIGtleQogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIHByZXNlbnRhdGlvbk1vZGFsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU3R1ZGVudCBEZWxldGlvbiBMaXN0ZW5lcnMKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1hbGwtc3R1ZGVudHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVEZWxldGVBbGxTdHVkZW50cyk7CiAgICAgICAgICAgIHN0dWRlbnRMaXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc3R1ZGVudC1idG4nKTsKICAgICAgICAgICAgICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGRlbGV0ZUJ0bi5kYXRhc2V0LnN0dWRlbnROYW1lOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZURlbGV0ZVN0dWRlbnQoc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSDguYLguITguYnguJTguYPguKvguKHguYjguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguYDguKXguLfguK3guIHguYTguJ/guKXguYzguYHguKXguLDguITguKXguLTguIHguJvguLjguYjguKEgLS0tCgogICAgICAgICAgICAvLyAxLiDguYDguJ7guLTguYjguKEgTGlzdGVuZXIg4LmD4Lir4LmJ4LiB4Lix4Lia4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiIOC5g+C4q+C4oeC5iOC4guC4reC4h+C5gOC4o+C4sgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlR2VuZXJhdGVGcm9tRmlsZUNsaWNrKTsKCiAgICAgICAgICAgIC8vIDIuIOC5gOC4m+C4peC4teC5iOC4ouC4mSBMaXN0ZW5lciDguILguK3guIfguIrguYjguK3guIfguYDguKXguLfguK3guIHguYTguJ/guKXguYwg4LmD4Lir4LmJ4LiX4Liz4LiH4Liy4LiZ4LmB4LiE4LmI4LmA4LiB4LmH4Lia4LmE4Lif4Lil4LmM4LmB4Lil4Liw4LmA4Lib4Li04LiUL+C4m+C4tOC4lOC4m+C4uOC5iOC4oQovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4miBFdmVudCBMaXN0ZW5lciDguILguK3guIcgZmlsZVVwbG9hZElucHV0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lOC4lOC5ieC4p+C4ouC5guC4hOC5ieC4lOC4meC4teC5iSDilrzilrzilrwKZmlsZVVwbG9hZElucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChldmVudCkgPT4gewogICAgY29uc3QgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgIGNvbnN0IGdlbmVyYXRlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tZmlsZS1idG4nKTsKICAgIGNvbnN0IHRvcGljc0xpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10b3BpY3MtbGlzdC1jb250YWluZXInKTsKICAgIGNvbnN0IHNlcGFyYXRlQ29udGVudENoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlcGFyYXRlLWJ5LWNvbnRlbnQtZnJvbS1maWxlLWNoZWNrYm94Jyk7CiAgICAKICAgIC8vIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4leC4seC4p+C5geC4m+C4o+C4iuC5iOC4reC4h+C5gOC4peC4t+C4reC4geC4q+C4meC5ieC4sgogICAgY29uc3QgcGFnZVNlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BkZi1wYWdlLXNlbGVjdG9yJyk7CgogICAgaWYgKGZpbGUpIHsKICAgICAgICBzZWxlY3RlZEZpbGUgPSBmaWxlOwogICAgICAgIAogICAgICAgIC8vIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4luC5ieC4suC5gOC4m+C5h+C4mSBQREYg4LmD4Lir4LmJ4LmC4LiK4Lin4LmM4LiK4LmI4Lit4LiH4LmA4Lil4Li34Lit4LiB4Lir4LiZ4LmJ4LiyCiAgICAgICAgaWYgKGZpbGUudHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHsKICAgICAgICAgICAgcGFnZVNlbGVjdG9yLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhZ2VTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BkZi1wYWdlLXJhbmdlJykudmFsdWUgPSAnJzsgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmM4LiE4LmI4LiyCiAgICAgICAgfQoKICAgICAgICBpZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3guY2hlY2tlZCkgewogICAgICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIGFuYWx5emVGaWxlRm9yVG9waWNzKGZpbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRvcGljc0xpc3RDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3RlZEZpbGUgPSBudWxsOwogICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHBhZ2VTZWxlY3Rvci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiL4LmI4Lit4LiZ4LmA4Lih4Li34LmI4Lit4LmE4Lih4LmI4Lih4Li14LmE4Lif4Lil4LmMCiAgICB9Cn0pOwoKLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5g+C4q+C5ieC4geC4seC4miBDaGVja2JveApkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1mcm9tLWZpbGUtY2hlY2tib3gnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXZlbnQpID0+IHsKICAgIGNvbnN0IGlzQ2hlY2tlZCA9IGV2ZW50LnRhcmdldC5jaGVja2VkOwogICAgY29uc3QgZ2VuZXJhdGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpOwogICAgY29uc3QgdG9waWNzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXRvcGljcy1saXN0LWNvbnRhaW5lcicpOwoKICAgIGlmIChpc0NoZWNrZWQpIHsKICAgICAgICAvLyDguJbguYnguLLguJzguLnguYnguYPguIrguYnguJXguLTguYrguIEgY2hlY2tib3gKICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7IC8vIOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gQogICAgICAgIGlmIChzZWxlY3RlZEZpbGUpIHsKICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4Lih4Li14LmE4Lif4Lil4LmM4Lit4Lix4Lib4LmC4Lir4Lil4LiU4Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinIOC5g+C4q+C5ieC5gOC4o+C4tOC5iOC4oeC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4l+C4seC4meC4l+C4tQogICAgICAgICAgICBhbmFseXplRmlsZUZvclRvcGljcyhzZWxlY3RlZEZpbGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC5hOC4n+C4peC5jCDguYPguKvguYnguYHguKrguJTguIfguILguYnguK3guITguKfguLLguKHguKPguK0KICAgICAgICAgICAgdG9waWNzTGlzdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdG9waWNzLWxpc3QnKS5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtZ3JheS00MDAgdGV4dC1jZW50ZXIiPuC4geC4o+C4uOC4k+C4suC4reC4seC4m+C5guC4q+C4peC4lOC5hOC4n+C4peC5jOC5gOC4nuC4t+C5iOC4reC5gOC4o+C4tOC5iOC4oeC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jC4uLjwvcD4nOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4Lic4Li54LmJ4LmD4LiK4LmJ4LmA4Lit4Liy4LiV4Li04LmK4LiB4Lit4Lit4LiBCiAgICAgICAgdG9waWNzTGlzdENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZ4Lij4Liy4Lii4LiB4Liy4Lij4Lir4Lix4Lin4LiC4LmJ4LitCiAgICAgICAgZ2VuZXJhdGVCdG4uZGlzYWJsZWQgPSAhc2VsZWN0ZWRGaWxlOyAvLyDguYDguJvguLTguJTguJvguLjguYjguKHguKrguKPguYnguLLguIfguKvguKXguLHguIEgKOC4luC5ieC4suC4oeC4teC5hOC4n+C4peC5jCkKICAgIH0KfSk7CgovLyDguYLguITguYnguJTguJfguLXguYjguYHguIHguYnguYTguILguYHguKXguYnguKcKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdG9waWNzLWxpc3QtY29udGFpbmVyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHsKICAgIGNvbnN0IHF1aXpCdG4gPSBldmVudC50YXJnZXQuY2xvc2VzdCgnLmZpbGUtdG9waWMtc2VsZWN0aW9uLWJ0bicpOwogICAgY29uc3QgY29udGVudEJ0biA9IGV2ZW50LnRhcmdldC5jbG9zZXN0KCcuZ2VuZXJhdGUtY29udGVudC1idG4nKTsKCiAgICBpZiAocXVpekJ0bikgewogICAgICAgIGNvbnN0IHRvcGljID0gdW5lc2NhcGUocXVpekJ0bi5kYXRhc2V0LnRvcGljKTsKICAgICAgICBnZW5lcmF0ZUh5YnJpZFF1aXpGb3JUb3BpYyh0b3BpYyk7CgogICAgfSBlbHNlIGlmIChjb250ZW50QnRuKSB7CiAgICAgICAgLy8gLS0tIOC4meC4teC5iOC4hOC4t+C4reC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giAtLS0KICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKGNvbnRlbnRCdG4uZGF0YXNldC50b3BpYyk7CiAgICAgICAgLy8g4LiU4Li24LiH4LiE4LmI4Liy4Lij4Liw4LiU4Lix4Lia4LiK4Lix4LmJ4LiZL+C4hOC4p+C4suC4oeC4ouC4suC4geC4iOC4suC4gSBkcm9wZG93biDguJfguLXguYjguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcKICAgICAgICBjb25zdCBncmFkZUxldmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpZmZpY3VsdHktbGV2ZWwtc2VsZWN0JykudmFsdWU7CiAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiX4Li14LmI4Liq4Lij4LmJ4Liy4LiH4Lia4LiX4LmA4Lij4Li14Lii4LiZ4LmA4LiV4LmH4Lih4Lij4Li54Lib4LmB4Lia4LiaIDQg4Liq4LmI4Lin4LiZCiAgICAgICAgaGFuZGxlR2VuZXJhdGVBbmRTaG93TGVzc29uKHRvcGljLCBncmFkZUxldmVsKTsKICAgIH0KfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItbW9kZS1zZWxlY3QnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItZHVyYXRpb24tY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbkxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLWR1cmF0aW9uLWxhYmVsJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLWR1cmF0aW9uLWlucHV0Jyk7CiAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgPT09ICdub25lJykgewogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZS50YXJnZXQudmFsdWUgPT09ICd3aG9sZV9xdWl6JykgewogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbkxhYmVsLnRleHRDb250ZW50ID0gJ+C4o+C4sOC4ouC4sOC5gOC4p+C4peC4siAo4LiZ4Liy4LiX4Li1KTonOwogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbklucHV0LnZhbHVlID0gJzEwJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBwZXJfcXVlc3Rpb24KICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25MYWJlbC50ZXh0Q29udGVudCA9ICfguKPguLDguKLguLDguYDguKfguKXguLIgKOC4p+C4tOC4meC4suC4l+C4tSk6JzsKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25JbnB1dC52YWx1ZSA9ICczMCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFF1aXogVHlwZSBTZWxlY3RvciBMaXN0ZW5lcgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei10eXBlLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBudW1DaG9pY2VzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1jaG9pY2VzLWNvbnRhaW5lcicpOwogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IGUudGFyZ2V0LnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3QgbnVtUXVlc3Rpb25zTGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsYWJlbFtmb3I9Im51bS1xdWVzdGlvbnMiXScpOwogICAgICAgICAgICAgICAgY29uc3QgcGFzc2luZ1Njb3JlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc2luZy1zY29yZS1pbnB1dCcpOwogICAgICAgICAgICAgICAgY29uc3QgbnVtUXVlc3Rpb25zSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbWF0Y2hpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgbnVtUXVlc3Rpb25zTGFiZWwudGV4dENvbnRlbnQgPSAn4LiI4Liz4LiZ4Lin4LiZ4LiE4Li54LmIOic7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG51bVF1ZXN0aW9uc0xhYmVsLnRleHRDb250ZW50ID0gJ+C4iOC4s+C4meC4p+C4meC4guC5ieC4rTonOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCB0eXBlID09PSAnZmlsbF9pbl93aXRoX2Nob2ljZXMnIHx8IHR5cGUgPT09ICdtaXhlZCcpIHsKICAgICAgICAgICAgICAgICAgICBudW1DaG9pY2VzQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBudW1DaG9pY2VzQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBVcGRhdGUgbWF4IGZvciBwYXNzaW5nIHNjb3JlCiAgICAgICAgICAgICAgICBwYXNzaW5nU2NvcmVJbnB1dC5tYXggPSBudW1RdWVzdGlvbnNJbnB1dC52YWx1ZTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzaW5nLXNjb3JlLWlucHV0JykubWF4ID0gZS50YXJnZXQudmFsdWU7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIC8vIE1vZGFsIFRpbWVyIFNldHRpbmdzIExpc3RlbmVyCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1tb2RlLXNlbGVjdCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbkNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1kdXJhdGlvbi1jb250YWluZXInKTsKICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uTGFiZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24tbGFiZWwnKTsKICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24taW5wdXQnKTsKICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25Db250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC52YWx1ZSA9PT0gJ3dob2xlX3F1aXonKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uTGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguJnguLLguJfguLUpOic7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gcGVyX3F1ZXN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uTGFiZWwudGV4dENvbnRlbnQgPSAn4Lij4Liw4Lii4Liw4LmA4Lin4Lil4LiyICjguKfguLTguJnguLLguJfguLUpOic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCQkJCgkJCS8vIEV2ZW50IExpc3RlbmVycyBmb3IgUXVpeiBFZGl0b3IgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1xdWl6LWVkaXRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLXF1aXotZWRpdHMtYnRuLWZvb3RlcicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZWRpdG9yLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwoJCQkKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmeS1hbnN3ZXJzLWVkaXRvci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZVZlcmlmeUFuc3dlcnNJbkVkaXRvcik7CgkJCQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1xdWl6LWVkaXRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJOiDguKrguLHguYjguIfguYPguKvguYnguKvguJnguYnguLLguJXguYjguLLguIfguYHguIHguYnguYTguILguKvguLLguKLguYTguJvguIHguYjguK3guJkKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWVkaXRvci1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgICAgICAgICAgICAgIC8vIOC4iOC4suC4geC4meC4seC5ieC4meC4hOC5iOC4reC4ouC5gOC4o+C4teC4ouC4geC4q+C4meC5ieC4suC4leC5iOC4suC4h+C4ouC4t+C4meC4ouC4seC4meC4leC4suC4oeC4m+C4geC4leC4tAogICAgICAgICAgICAgICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICAgICAgICAgICAgICAn4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiC4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiI4Liw4LiX4Liz4LmD4Lir4LmJ4Lic4Lil4LiB4Liy4Lij4Liq4Lit4Lia4LmA4LiB4LmI4Liy4LmE4Lih4LmI4Liq4Lit4LiU4LiE4Lil4LmJ4Lit4LiH4LiB4Lix4Lia4LiE4Liz4LiW4Liy4Lih4LmB4Lil4Liw4LmA4LiJ4Lil4Lii4LiK4Li44LiU4LmD4Lir4Lih4LmIIOC4i+C4tuC5iOC4h+C4reC4suC4iOC4l+C4s+C5g+C4q+C5ieC4geC4suC4o+C5geC4quC4lOC4h+C4nOC4peC4hOC4sOC5geC4meC4meC5gOC4geC5iOC4suC5gOC4geC4tOC4lOC4hOC4p+C4suC4oeC4quC4seC4muC4quC4meC5hOC4lOC5iSDguITguLjguJPguJXguYnguK3guIfguIHguLLguKPguJrguLHguJnguJfguLbguIHguIHguLLguKPguYDguJvguKXguLXguYjguKLguJnguYHguJvguKXguIfguKvguKPguLfguK3guYTguKHguYg/JywKICAgICAgICAgICAgICAgICAgICBoYW5kbGVTYXZlQ2hhbmdlcwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB9KTsKCQkJCgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvLWZpeC1sYXRleC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUF1dG9GaXhMYXRleCk7CgkJCQoJCQkvLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmE4LiU4LmJ4LmA4Lil4LiiIOKWvOKWvOKWvAogICAgICAgICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1lZGl0b3ItcXVlc3Rpb25zLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoZWRpdG9yQ29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICBlZGl0b3JDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDEuIOC4leC4o+C4p+C4iOC4quC4reC4muC4m+C4uOC5iOC4oSAi4Liq4Lij4LmJ4Liy4LiH4LmC4LiI4LiX4Lii4LmM4LmD4Lir4Lih4LmIIgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlZ2VuZXJhdGVCdG4gPSBlLnRhcmdldC5jbG9zZXN0KCcucmVnZW5lcmF0ZS1xdWVzdGlvbi1lZGl0b3ItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlZ2VuZXJhdGVCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25JdGVtID0gcmVnZW5lcmF0ZUJ0bi5jbG9zZXN0KCcucXVlc3Rpb24tZWRpdG9yLWl0ZW0nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBwYXJzZUludChxdWVzdGlvbkl0ZW0uZGF0YXNldC5xSW5kZXgsIDEwKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlUmVnZW5lcmF0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lib4Li44LmI4LihICLguKXguJrguITguLPguJbguLLguKEiCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmRlbGV0ZS1xdWVzdGlvbi1lZGl0b3ItYnRuJyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvbkl0ZW0gPSBkZWxldGVCdG4uY2xvc2VzdCgnLnF1ZXN0aW9uLWVkaXRvci1pdGVtJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQocXVlc3Rpb25JdGVtLmRhdGFzZXQucUluZGV4LCAxMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZURlbGV0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIDMuIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdIOC4leC4o+C4p+C4iOC4quC4reC4muC4m+C4uOC5iOC4oSAi4LmA4Lie4Li04LmI4Lih4LiE4Liz4LiW4Liy4LihIgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJyNhZGQtcXVlc3Rpb24tZWRpdG9yLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGlmIChhZGRCdG4pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQWRkUXVlc3Rpb25JbkVkaXRvcigpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC5geC4peC5ieC4pyDguK3guK3guIHguIjguLLguIHguJ/guLHguIfguIHguYzguIrguLHguJkKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vICjguKrguYjguKfguJnguJvguLjguYjguKEgJ2FpLWZpeC1xdWVzdGlvbi1idG4nIOC4luC4ueC4geC4iOC4seC4lOC4geC4suC4o+C5guC4lOC4oiAuZm9yRWFjaCDguJTguYnguLLguJnguKXguYjguLLguIfguK3guKLguLnguYjguYHguKXguYnguKcg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Lii4Li44LmI4LiHKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gMS4gRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4Lib4Li44LmI4LihICLguITguKXguLHguIfguYHguJrguJrguJfguJTguKrguK3guJoiIOC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1xdWl6LWJhbmstYnRuJykKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb3BlblF1aXpCYW5rTW9kYWwpOwoKICAgICAgICAgICAgLy8gMi4gRXZlbnQgTGlzdGVuZXIg4LmD4Lir4LmJ4Lib4Li44LmI4Lih4Lib4Li04LiUIChYKSDguILguK3guIcgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtcXVpei1iYW5rLWJ0bicpCiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWJhbmstbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyAzLiBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguIrguYjguK3guIfguITguYnguJnguKvguLLguILguK3guIcgTW9kYWwg4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotc2VhcmNoLWlucHV0JykKICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHJlbmRlclF1aXpCYW5rTGlzdChlLnRhcmdldC52YWx1ZSkpOwkKCi8vIOKWvOKWvOKWvCDguJnguLPguYLguITguYnguJTguJrguKXguYfguK3guIHguJnguLXguYnguYTguJvguYHguJfguJnguJfguLXguYjguILguK3guIfguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmNvbnN0IG1hdGhUb3BpY3NDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0aC10b3BpY3MtY2hlY2tib3gtY29udGFpbmVyJyk7CmlmIChtYXRoVG9waWNzQ29udGFpbmVyKSB7CiAgICBsZXQgY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciA9IG51bGw7IC8vIOC4leC4seC4p+C5geC4m+C4o+C4quC4s+C4q+C4o+C4seC4muC5gOC4iuC5h+C4hOC4p+C5iOC4suC4oeC4teC4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4geC4s+C4peC4seC4h+C5geC4geC5ieC5hOC4guC4reC4ouC4ueC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAoKICAgIG1hdGhUb3BpY3NDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0OwogICAgICAgIAogICAgICAgIC8vIC0tLSDguIjguLHguJTguIHguLLguKPguIHguLLguKPguITguKXguLTguIHguJvguLjguYjguKHguJXguYjguLLguIfguYYgLS0tCiAgICAgICAgY29uc3QgZWRpdEJ0biA9IHRhcmdldC5jbG9zZXN0KCcuZWRpdC1jdXN0b20tdG9waWMtYnRuJyk7CiAgICAgICAgY29uc3QgZGVsZXRlQnRuID0gdGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtY3VzdG9tLXRvcGljLWJ0bicpOwogICAgICAgIGNvbnN0IHNhdmVCdG4gPSB0YXJnZXQuY2xvc2VzdCgnLnNhdmUtY3VzdG9tLXRvcGljLWJ0bicpOwogICAgICAgIGNvbnN0IGNhbmNlbEJ0biA9IHRhcmdldC5jbG9zZXN0KCcuY2FuY2VsLWVkaXQtdG9waWMtYnRuJyk7CgogICAgICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gZGVsZXRlQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgICAgIGNvbnN0IHRvcGljTmFtZSA9IGRlbGV0ZUJ0bi5jbG9zZXN0KCcuZ3JvdXAnKS5xdWVyeVNlbGVjdG9yKCcudG9waWMtbmFtZS1kaXNwbGF5JykudGV4dENvbnRlbnQ7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lir4Lix4Lin4LiC4LmJ4LitICIke3RvcGljTmFtZX0iP2AsCiAgICAgICAgICAgICAgICAoKSA9PiBoYW5kbGVEZWxldGVDdXN0b21Ub3BpYyh0b3BpY0lkKQogICAgICAgICAgICApOwogICAgICAgIH0gZWxzZSBpZiAoZWRpdEJ0bikgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4teC4reC4seC4meC4reC4t+C5iOC4meC4l+C4teC5iOC4geC4s+C4peC4seC4h+C5geC4geC5iSDguYPguKvguYnguKLguIHguYDguKXguLTguIHguIHguYjguK3guJkKICAgICAgICAgICAgaWYgKGN1cnJlbnRseUVkaXRpbmdDb250YWluZXIpIHsKICAgICAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUoY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4guC4reC4seC4meC4l+C4teC5iOC5gOC4nuC4tOC5iOC4h+C4hOC4peC4tOC4gQogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IGVkaXRCdG4uY2xvc2VzdCgnW2RhdGEtdG9waWMtY29udGFpbmVyLWlkXScpOwogICAgICAgICAgICBjdXJyZW50bHlFZGl0aW5nQ29udGFpbmVyID0gdG9waWNDb250YWluZXI7CiAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUodG9waWNDb250YWluZXIsIHRydWUpOwoKICAgICAgICB9IGVsc2UgaWYgKHNhdmVCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0lkID0gc2F2ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IHNhdmVCdG4uY2xvc2VzdCgnW2RhdGEtdG9waWMtY29udGFpbmVyLWlkXScpOwogICAgICAgICAgICBjb25zdCBuZXdOYW1lID0gdG9waWNDb250YWluZXIucXVlcnlTZWxlY3RvcignLnRvcGljLW5hbWUtaW5wdXQnKS52YWx1ZTsKICAgICAgICAgICAgaGFuZGxlVXBkYXRlQ3VzdG9tVG9waWModG9waWNJZCwgbmV3TmFtZSk7CiAgICAgICAgICAgIGN1cnJlbnRseUVkaXRpbmdDb250YWluZXIgPSBudWxsOyAvLyDguK3guK3guIHguIjguLLguIHguYLguKvguKHguJTguYHguIHguYnguYTguIIKCiAgICAgICAgfSBlbHNlIGlmIChjYW5jZWxCdG4pIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0b3BpY0NvbnRhaW5lciA9IGNhbmNlbEJ0bi5jbG9zZXN0KCdbZGF0YS10b3BpYy1jb250YWluZXItaWRdJyk7CiAgICAgICAgICAgIHRvZ2dsZVRvcGljRWRpdE1vZGUodG9waWNDb250YWluZXIsIGZhbHNlKTsKICAgICAgICAgICAgY3VycmVudGx5RWRpdGluZ0NvbnRhaW5lciA9IG51bGw7IC8vIOC4reC4reC4geC4iOC4suC4geC5guC4q+C4oeC4lOC5geC4geC5ieC5hOC4ggogICAgICAgIH0KICAgIH0pOwoJCgkvLyBFdmVudCBMaXN0ZW5lcnMg4Liq4Liz4Lir4Lij4Lix4LiaIE1vZGFsIOC5geC4nOC4meC4geC4suC4o+C4quC4reC4mQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtbGVzc29uLXBsYW4tbW9kYWwtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1sZXNzb24tcGxhbi1tb2RhbC1mb290ZXItYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtbGVzc29uLXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUV4cG9ydExlc3NvblBERik7fQoKICAvLyBFdmVudCBMaXN0ZW5lcnMg4Liq4Liz4Lir4Lij4Lix4LiaIE1vZGFsIOC5gOC4m+C4o+C4teC4ouC4muC5gOC4l+C4teC4ouC4muC4nOC4pQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWNvbXBhcmlzb24tbW9kYWwtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBhcmlzb24tbW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLWNvbXBhcmlzb24tbW9kYWwtZm9vdGVyLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21wYXJpc29uLW1vZGFsJykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9KTsKCnNldHVwQ29tcGFyaXNvbk1vZGFsVGFicygpOwoKZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncHJhY3RpY2UtdG9waWMtYnRuJykpIHsKICAgICAgICBjb25zdCB0b3BpYyA9IHVuZXNjYXBlKGV2ZW50LnRhcmdldC5kYXRhc2V0LnRvcGljKTsKICAgICAgICBzdGFydFNraWxsUHJhY3RpY2UodG9waWMpOyAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJnguKvguKXguLHguIHguJfguLXguYjguIjguLDguKrguKPguYnguLLguIfguYPguJnguILguLHguYnguJnguJXguK3guJnguJfguLXguYggMgogICAgfQp9KTsKCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZXMtdGFiLWNvbnRlbnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAvLyAxLiDguJvguLjguYjguKHguKXguJogKERlbGV0ZSkKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtc3VibWlzc2lvbi1idG4nKTsKICAgIGlmIChkZWxldGVCdG4pIHsKICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGRlbGV0ZUJ0bi5kYXRhc2V0LnN0dWRlbnROYW1lOwogICAgICAgIGhhbmRsZURlbGV0ZVN1Ym1pc3Npb24oc3R1ZGVudE5hbWUpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAyLiDguJvguLjguYjguKHguYHguIHguYnguYTguILguITguLDguYHguJnguJkgKEVkaXQgUG9pbnRzKSAtIFvguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguKHguYhdCiAgICBjb25zdCBlZGl0UG9pbnRzQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmVkaXQtcG9pbnRzLWJ0bicpOwogICAgaWYgKGVkaXRQb2ludHNCdG4pIHsKICAgICAgICBjb25zdCBzdHVkZW50TmFtZSA9IGVkaXRQb2ludHNCdG4uZGF0YXNldC5zdHVkZW50TmFtZTsKICAgICAgICBjb25zdCBjdXJyZW50UG9pbnRzID0gZWRpdFBvaW50c0J0bi5kYXRhc2V0LmN1cnJlbnRQb2ludHM7CiAgICAgICAgCiAgICAgICAgLy8g4LmB4Liq4LiU4LiHIFBvcHVwIOC5g+C4q+C5ieC4geC4o+C4reC4geC4hOC4sOC5geC4meC4meC5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IG5ld1BvaW50c1N0ciA9IHByb21wdChg4LmB4LiB4LmJ4LmE4LiC4LiE4Liw4LmB4LiZ4LiZIFBvaW50cyDguILguK3guIcgIiR7c3R1ZGVudE5hbWV9IlxuKOC5g+C4quC5iOC4hOC5iOC4suC5gOC4lOC4tOC4oeC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C4peC4h+C5hOC4mylgLCBjdXJyZW50UG9pbnRzKTsKICAgICAgICAKICAgICAgICBpZiAobmV3UG9pbnRzU3RyICE9PSBudWxsICYmIG5ld1BvaW50c1N0ci50cmltKCkgIT09ICcnKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld1BvaW50cyA9IHBhcnNlSW50KG5ld1BvaW50c1N0ciwgMTApOwogICAgICAgICAgICBpZiAoIWlzTmFOKG5ld1BvaW50cykpIHsKICAgICAgICAgICAgICAgIGhhbmRsZU1hbnVhbEVkaXRQb2ludHMoc3R1ZGVudE5hbWUsIG5ld1BvaW50cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhbGVydCgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiB4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0pOwoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLXBpbi1tb2RhbC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bpbi1lbnRyeS1tb2RhbCcpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSk7CgogICAgLy8g4Lib4Li44LmI4Lih4LiV4Lix4Lin4LmA4Lil4LiCIDAtOQogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBpbi1rZXknKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBoYW5kbGVQaW5LZXlQcmVzcyhidG4uZGF0YXNldC52YWwpOwogICAgICAgIH0pOwogICAgfSk7CgogICAgLy8g4Lib4Li44LmI4Lih4Lil4LiaIChCYWNrc3BhY2UpCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGluLWJhY2tzcGFjZS1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaGFuZGxlUGluS2V5UHJlc3MoJ2JhY2tzcGFjZScpOwogICAgfSk7CgkKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3RhcnRHcm91cE1vZGUocXVpeklkLCBzaG91bGRTYXZlID0gZmFsc2UpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIC0tLSBbIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQphc3luYyBmdW5jdGlvbiBzaG93U3R1ZGVudFByb2dyZXNzVmlldygpIHsKICAgICAgICAgICAgc3R1ZGVudEluaXRpYWxWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wcm9ncmVzcy12aWV3JykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgICAgICAgICBjb25zdCBwcm9qZWN0U2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzLXByb2plY3Qtc2VsZWN0Jyk7CiAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3Mtc3R1ZGVudC1zZWxlY3QnKTsKICAgICAgICAgICAgY29uc3QgY29udGVudERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXByb2dyZXNzLWNvbnRlbnQnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guJTguLnguILguYnguK3guKHguLnguKU8L3A+JzsKICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLSDguYDguKXguLfguK3guIHguIrguLfguYjguK0gLS08L29wdGlvbj4nOwogICAgICAgICAgICBzdHVkZW50U2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIHByb2plY3RTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+4LiB4Liz4Lil4Lix4LiH4LmC4Lir4Lil4LiULi4uPC9vcHRpb24+JzsKICAgICAgICAgICAgaWYgKGFsbFByb2plY3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdHNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCk7CiAgICAgICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocHJvamVjdHNSZWYpOwogICAgICAgICAgICAgICAgYWxsUHJvamVjdHMgPSBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEoKSB9KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHZpc2libGVQcm9qZWN0cyA9IGFsbFByb2plY3RzLmZpbHRlcihwID0+IHAuc2V0dGluZ3M/LnNob3dJblN0dWRlbnREYXNoYm9hcmQgIT09IGZhbHNlKTsKICAgICAgICAgICAgdmlzaWJsZVByb2plY3RzLnNvcnQoKGEsIGIpID0+IGEucHJvamVjdE5hbWUubG9jYWxlQ29tcGFyZShiLnByb2plY3ROYW1lLCAndGgnKSk7CgogICAgICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC5gOC4peC4t+C4reC4geC5guC4m+C4o+C5gOC4iOC4hCAtLTwvb3B0aW9uPicgKyAKICAgICAgICAgICAgICAgIHZpc2libGVQcm9qZWN0cy5tYXAocCA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtwLmlkfSI+JHtwLnByb2plY3ROYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwoKICAgICAgICAgICAgcHJvamVjdFNlbGVjdC5vbmNoYW5nZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIC0tLSBbU1RBUlRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzU3R1ZGVudCA9IHN0dWRlbnRTZWxlY3QudmFsdWU7IC8vIDEuIOC4iOC4s+C4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC5gOC4peC4t+C4reC4geC5hOC4p+C5ieC4geC5iOC4reC4meC4q+C4meC5ieC4sgogICAgICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KCiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3RJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgICAgICAgICBzdHVkZW50U2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4LitIC0tPC9vcHRpb24+JzsKICAgICAgICAgICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguIrguLfguYjguK3guILguK3guIfguITguLjguJM8L3A+JzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFzZWxlY3RlZFByb2plY3RJZCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3QgPSBhbGxQcm9qZWN0cy5maW5kKHAgPT4gcC5pZCA9PT0gc2VsZWN0ZWRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgaWYgKCFwcm9qZWN0IHx8ICFwcm9qZWN0LnN0dWRlbnRzKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHBvcHVsYXRlU3R1ZGVudERyb3Bkb3duID0gKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4LitIC0tPC9vcHRpb24+JyArIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdC5zdHVkZW50cy5tYXAobmFtZSA9PiBgPG9wdGlvbiB2YWx1ZT0iJHtuYW1lfSI+JHtuYW1lfTwvb3B0aW9uPmApLmpvaW4oJycpOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gW1NUQVJUXSDguKrguYjguKfguJnguYHguIHguYnguYTguILguYPguKvguKHguYggLS0tCiAgICAgICAgICAgICAgICAgICAgLy8gMi4g4Lie4Lii4Liy4Lii4Liy4Lih4LmA4Lil4Li34Lit4LiB4LiK4Li34LmI4Lit4LmA4LiU4Li04Lih4LmD4LiZ4LmC4Lib4Lij4LmA4LiI4LiE4LmD4Lir4Lih4LmI4LmD4Lir4LmJ4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3T3B0aW9ucyA9IEFycmF5LmZyb20oc3R1ZGVudFNlbGVjdC5vcHRpb25zKS5tYXAob3B0ID0+IG9wdC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzU3R1ZGVudCAmJiBuZXdPcHRpb25zLmluY2x1ZGVzKHByZXZpb3VzU3R1ZGVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC52YWx1ZSA9IHByZXZpb3VzU3R1ZGVudDsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnY2hhbmdlJykpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvamVjdC5zdHVkZW50cy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFNlbGVjdC52YWx1ZSA9IHByb2plY3Quc3R1ZGVudHNbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRTZWxlY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2NoYW5nZScpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIFtFTkRdIOC4quC5iOC4p+C4meC5geC4geC5ieC5hOC4guC5g+C4q+C4oeC5iCAtLS0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gKOC4quC5iOC4p+C4mSBwYXNzY29kZSDguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4LiB4LmJ4LmE4LiCKQogICAgICAgICAgICAgICAgaWYgKHByb2plY3Quc2V0dGluZ3M/LmlzUGFzc2NvZGVFbmFibGVkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oJ2F1dGhlZF9wcm9qZWN0XycgKyBzZWxlY3RlZFByb2plY3RJZCkgPT09ICd0cnVlJykgewogICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVN0dWRlbnREcm9wZG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3Njb2RlTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1wYXNzY29kZS1tb2RhbCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1wYXNzY29kZS1idG4nKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjYW5jZWxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsLXBhc3Njb2RlLWJ0bicpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhc3Njb2RlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC1wYXNzY29kZS1pbnB1dCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3Njb2RlLWVycm9yLW1zZycpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzY29kZS1wcm9tcHQtbWVzc2FnZScpLnRleHRDb250ZW50ID0gYOC4quC4s+C4q+C4o+C4seC4muC5guC4m+C4o+C5gOC4iOC4hDogJHtwcm9qZWN0LnByb2plY3ROYW1lfWA7CiAgICAgICAgICAgICAgICAgICAgcGFzc2NvZGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICAgICAgICAgIGVycm9yTXNnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFuZGxlQ29uZmlybSA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50ZXJlZFBhc3Njb2RlID0gcGFzc2NvZGVJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnRlcmVkUGFzc2NvZGUgPT09IHByb2plY3Quc2V0dGluZ3MucGFzc2NvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2F1dGhlZF9wcm9qZWN0XycgKyBzZWxlY3RlZFByb2plY3RJZCwgJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZVN0dWRlbnREcm9wZG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNvbmZpcm0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JNc2cuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdG4ub25jbGljayA9IGhhbmRsZUNvbmZpcm07CiAgICAgICAgICAgICAgICAgICAgY2FuY2VsQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3Njb2RlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2plY3RTZWxlY3QudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNvbmZpcm0pOwogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlU3R1ZGVudERyb3Bkb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBzdHVkZW50U2VsZWN0Lm9uY2hhbmdlID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0SWQgPSBwcm9qZWN0U2VsZWN0LnZhbHVlOwogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRTdHVkZW50TmFtZSA9IHN0dWRlbnRTZWxlY3QudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRQcm9qZWN0SWQgJiYgc2VsZWN0ZWRTdHVkZW50TmFtZSkgewogICAgICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRQcm9ncmVzc0Rhc2hib2FyZChzZWxlY3RlZFByb2plY3RJZCwgc2VsZWN0ZWRTdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfQoJCQoKLy8gW0FVVE8tSU5KRUNURUQgSEVMUEVSUyAtIFNBRkVUWSBORVRdCndpbmRvdy5pc1F1aXpBY3RpdmUgPSBmYWxzZTsKd2luZG93LmNoZWF0QXR0ZW1wdHMgPSAwOwoKaWYgKHR5cGVvZiB3aW5kb3cucmVxdWVzdFdha2VMb2NrICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cucmVxdWVzdFdha2VMb2NrID0gYXN5bmMgZnVuY3Rpb24oKSB7CiAgICAgICAgdHJ5IHsgaWYgKCd3YWtlTG9jaycgaW4gbmF2aWdhdG9yKSB7IGF3YWl0IG5hdmlnYXRvci53YWtlTG9jay5yZXF1ZXN0KCdzY3JlZW4nKTsgfSB9IGNhdGNoKGUpe30KICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgZG9jRWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgaWYgKGRvY0VsLnJlcXVlc3RGdWxsc2NyZWVuKSBkb2NFbC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgIGVsc2UgaWYgKGRvY0VsLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKSBkb2NFbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICAgIGVsc2UgaWYgKGRvY0VsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIGRvY0VsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuaGFuZGxlRnVsbHNjcmVlbkNoYW5nZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgd2luZG93LmhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAod2luZG93LmlzUXVpekFjdGl2ZSAmJiAhZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsgCiAgICAgICAgICAgIGFsZXJ0KCLimqDvuI8g4LiE4Liz4LmA4LiV4Li34Lit4LiZOiDguIHguKPguLjguJPguLLguIHguKXguLHguJrguYDguILguYnguLLguKrguLnguYjguYLguKvguKHguJTguYDguJXguYfguKHguIjguK0hIik7IAogICAgICAgICAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuKCk7IAogICAgICAgICAgICB3aW5kb3cuY2hlYXRBdHRlbXB0cysrOwogICAgICAgIH0KICAgIH07Cn0KaWYgKHR5cGVvZiB3aW5kb3cuaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJykgewogICAgd2luZG93LmhhbmRsZVZpc2liaWxpdHlDaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgICBpZiAod2luZG93LmlzUXVpekFjdGl2ZSAmJiBkb2N1bWVudC5oaWRkZW4pIHsgCiAgICAgICAgICAgIGFsZXJ0KCLimqDvuI8g4LiE4Liz4LmA4LiV4Li34Lit4LiZOiDguKvguYnguLLguKHguKrguKXguLHguJrguKvguJnguYnguLLguIjguK3guKPguLDguKvguKfguYjguLLguIfguKrguK3guJohIik7CiAgICAgICAgICAgIHdpbmRvdy5jaGVhdEF0dGVtcHRzKys7CiAgICAgICAgfQogICAgfTsKfQppZiAodHlwZW9mIHdpbmRvdy5yZXNldERpbVRpbWVyICE9PSAnZnVuY3Rpb24nKSB7CiAgICB3aW5kb3cucmVzZXREaW1UaW1lciA9IGZ1bmN0aW9uKCkgeyAKICAgICAgICAvLyBQbGFjZWhvbGRlciBmb3IgZGltIHRpbWVyIGxvZ2ljCiAgICB9Owp9CiAgICAgICAgICAgIAphc3luYyBmdW5jdGlvbiBjb25maXJtQW5kSm9pblN5bmNHYW1lKCkgewoKICAgICAgICAvLyBbRk9SQ0UgSU5KRUNURUQgQU5USS1DSEVBVF0KICAgICAgICBjb25zb2xlLmxvZygiQW50aS1DaGVhdCBNb2R1bGUgTG9hZGVkIGZvciBTeW5jIEdhbWUiKTsKICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRNb2RlID09PSAndW5kZWZpbmVkJyB8fCBjdXJyZW50TW9kZSAhPT0gJ2FkbWluLXRlc3RpbmcnKSB7CiAgICAgICAgICAgIHdpbmRvdy5pc1F1aXpBY3RpdmUgPSB0cnVlOyAKICAgICAgICAgICAgd2luZG93LmNoZWF0QXR0ZW1wdHMgPSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0V2FrZUxvY2soKTsgLy8g4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiI4Lit4LiU4Lix4LiaCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCB3aW5kb3cuaGFuZGxlRnVsbHNjcmVlbkNoYW5nZSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgd2luZG93LmhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB3aW5kb3cuZW50ZXJGdWxsc2NyZWVuKCk7IC8vIOC4quC4seC5iOC4h+C5g+C4q+C5ieC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5gOC4leC5h+C4oeC4iOC4reC4l+C4seC4meC4l+C4tQogICAgICAgIAogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHdpbmRvdy5yZXNldERpbVRpbWVyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB3aW5kb3cucmVzZXREaW1UaW1lcik7CiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHdpbmRvdy5yZXNldERpbVRpbWVyKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgd2luZG93LnJlc2V0RGltVGltZXIpOwogICAgICAgICAgICAgICAgd2luZG93LnJlc2V0RGltVGltZXIoKTsgCiAgICAgICAgICAgIH0gY2F0Y2goZSkgeyBjb25zb2xlLndhcm4oIkFudGktY2hlYXQgYWN0aXZhdGlvbiB3YXJuaW5nOiIsIGUpOyB9CiAgICAgICAgfQogICAgICAgICAgICAKCgogICAgLy8g4Lil4LmJ4Liy4LiH4LiE4LmI4Liy4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiHIChTZXNzaW9uKSDguYDguJ7guLfguYjguK3guITguKfguLLguKHguKrguLDguK3guLLguJQKICAgIGxhc3RTZWVuUXVlc3Rpb25JbmRleCA9IC0xOwogICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgncG9sbFVzZWRUaGlzVHVybicpOwogICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnb25TZWNvbmRDaGFuY2UnKTsKICAgIE9iamVjdC5rZXlzKHNlc3Npb25TdG9yYWdlKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgaWYgKGtleS5zdGFydHNXaXRoKCdmcmVlTWFya2V0RW50cnlVc2VkX3EnKSB8fCBrZXkuc3RhcnRzV2l0aCgncG93ZXJ1cFVzZWRfcScpIHx8IGtleS5zdGFydHNXaXRoKCdoaWRkZW5PcHRpb25zX3EnKSkgeyAKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIOC5g+C4iuC5ieC4o+C4suC4ouC4iuC4t+C5iOC4reC4iOC4suC4geC4leC4seC4p+C5geC4m+C4o+C4l+C4teC5iOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC5hOC4p+C5ieC5geC4peC5ieC4pwogICAgY29uc3Qgc2VsZWN0ZWRQbGF5ZXJzID0gWy4uLm9yZGVyZWRQbGF5ZXJTZWxlY3Rpb25dOwoKICAgIGlmIChzZWxlY3RlZFBsYXllcnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4nOC4ueC5ieC5gOC4peC5iOC4meC4reC4ouC5iOC4suC4h+C4meC5ieC4reC4oiAxIOC4hOC4mSIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBsb2NhbFRlYW1QbGF5ZXJzID0gc2VsZWN0ZWRQbGF5ZXJzOyAvLyDguKXguLPguJTguLHguJrguIHguLLguKPguYDguKXguYjguJnguIjguLDguJXguLLguKHguJnguLXguYnguYDguKXguKIKICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gMDsKICAgIGNhY2hlZFBsYXllckRhdGEgPSB7fTsgCgogICAgdHJ5IHsKICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwogICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IHNlcnZlclRpbWVzdGFtcCgpOwoKICAgICAgICAvLyDguKfguJnguKXguLnguJvguYDguIrguYfguITguJzguLnguYnguYDguKXguYjguJnguJfguLXguKXguLDguITguJkgKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkKICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygc2VsZWN0ZWRQbGF5ZXJzKSB7CiAgICAgICAgICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIG5hbWUpOwogICAgICAgICAgICBjb25zdCBwbGF5ZXJTbmFwID0gYXdhaXQgZ2V0RG9jKHBsYXllclJlZik7CgogICAgICAgICAgICBpZiAocGxheWVyU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHBsYXllclJlZiwgeyBzdGF0dXM6ICdhY3RpdmUnIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgbmV3UGxheWVyRGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgICAgIHNjb3JlOiAwLAogICAgICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzOiAwLAogICAgICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogMCwKICAgICAgICAgICAgICAgICAgICBwb3dlcnVwczogewogICAgICAgICAgICAgICAgICAgICAgICBmaWZ0eUZpZnR5OiAwLCBzZWNvbmRDaGFuY2U6IDAsIGJ1eVRpbWU6IDAsIHBvbGw6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIHdhZ2VyTXVsdGlwbGllcjogMCwgZm9yY2VDb25maWRlbnQ6IDAsIGN1dE9uZTogMCwgaW5zdXJhbmNlOiAwLCBzdHJhdGVneVNjYW46IDAsIGppbng6IDAsIHJldmVhbE9wdGlvbnM6IDAKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGFuc3dlcmVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLAogICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IFtdLAogICAgICAgICAgICAgICAgICAgIGpvaW5lZEF0OiB0aW1lc3RhbXAsCiAgICAgICAgICAgICAgICAgICAgaXNKaW54ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIGlzRm9yY2VkQ29uZmlkZW50OiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB0aW1lQm9udXNUaGlzUXVlc3Rpb246IDAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBiYXRjaC5zZXQocGxheWVyUmVmLCBuZXdQbGF5ZXJEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CgogICAgICAgIHNob3dWaWV3KCdsaXZlLWdhbWUnKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3R1ZGVudC10ZWFtLXNlbGVjdGlvbi12aWV3JykuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgY3VycmVudFN0dWRlbnROYW1lID0gc2VsZWN0ZWRQbGF5ZXJzWzBdOyAvLyDguITguJnguYHguKPguIHguJfguLXguYjguYDguKXguLfguK3guIHguITguLfguK3guITguJnguYDguKXguYjguJnguITguJnguYHguKPguIEKICAgICAgICAKICAgICAgICBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKTsgCgogICAgICAgIGNvbnN0IGdhbWVTdGF0ZSA9IHsKICAgICAgICAgICAgZ2FtZUlkOiBjdXJyZW50TGl2ZUdhbWVJZCwKICAgICAgICAgICAgbW9kZTogJ3N5bmMnLAogICAgICAgICAgICBwbGF5ZXJzOiBsb2NhbFRlYW1QbGF5ZXJzLAogICAgICAgICAgICB0dXJuSW5kZXg6IDAKICAgICAgICB9OwogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJywgSlNPTi5zdHJpbmdpZnkoZ2FtZVN0YXRlKSk7CgkJCgkJLy9hYWFhCgoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyBzeW5jIGdhbWU6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguILguYnguLLguKPguYjguKfguKE6ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmVzdW1lQWN0aXZlR2FtZVNlc3Npb24oKSB7CiAgICBjb25zdCBzYXZlZFNlc3Npb24gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicpOwogICAgaWYgKCFzYXZlZFNlc3Npb24pIHsKICAgICAgICByZXR1cm47IC8vIOC5hOC4oeC5iOC4oeC4teC5gOC4geC4oeC4l+C4teC5iOC4hOC5ieC4suC4h+C4reC4ouC4ueC5iAogICAgfQoKICAgIGNvbnN0IGdhbWVTdGF0ZSA9IEpTT04ucGFyc2Uoc2F2ZWRTZXNzaW9uKTsKICAgIAogICAgLy8g4LiU4Li24LiH4LiE4LmI4Liy4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LmE4Lib4LmE4LiU4LmJ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Lit4Lit4LiB4Lih4LiyCiAgICBjb25zdCB7IGdhbWVJZCwgbW9kZSwgcm9sZSwgcGxheWVycywgdHVybkluZGV4IH0gPSBnYW1lU3RhdGU7CgogICAgdHJ5IHsKICAgICAgICAvLyAtLS0gWyDwn5qAIFNUQVJUOiBMb2dpYyDguYPguKvguKHguYjguKrguLPguKvguKPguLHguJogQWRtaW4gXSAtLS0KICAgICAgICBpZiAocm9sZSA9PT0gJ2FkbWluJyAmJiBtb2RlID09PSAnc3luYycpIHsKICAgICAgICAgICAgLy8g4LiZ4Li14LmI4LiE4Li34LitIEFkbWluIOC4l+C4teC5iOC4geC4lOC4o+C4teC5gOC4n+C4o+C4iuC5g+C4meC5guC4q+C4oeC4lCBTeW5jCiAgICAgICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgZ2FtZUlkKTsKICAgICAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZ2FtZVJlZik7CiAgICAgICAgICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ3BvZGl1bScgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYOC4geC4s+C4peC4seC4h+C4geC4peC4seC4muC5gOC4guC5ieC4suC4quC4ueC5iOC5gOC4geC4oSAoQWRtaW4pIChJRDogJHtnYW1lSWR9KWApOwoKICAgICAgICAgICAgY3VycmVudE1vZGUgPSAnYWRtaW4nOyAvLyA8LS0g4Lia4Lij4Lij4LiX4Lix4LiU4Liq4Liz4LiE4Lix4LiN4LiX4Li14LmI4LiC4Liy4LiU4LmE4LibIQoKICAgICAgICAgICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lSWQ7CiAgICAgICAgICAgIGN1cnJlbnRRdWl6RGF0YSA9IGdhbWVTbmFwLmRhdGEoKS5zaHVmZmxlZFF1aXo7IAogICAgICAgICAgICBzaG93VmlldygnbGl2ZS1nYW1lJyk7CiAgICAgICAgICAgIGxpc3RlbkZvclN5bmNHYW1lVXBkYXRlcygpOyAvLyDguJXguK3guJnguJnguLXguYnguIjguLDguYDguKPguLXguKLguIEgdXBkYXRlQWRtaW5TeW5jVmlldyDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQKCiAgICAgICAgfSAKICAgICAgICAvLyAtLS0gWyDwn5qAIEVORDogTG9naWMg4LmD4Lir4Lih4LmI4Liq4Liz4Lir4Lij4Lix4LiaIEFkbWluIF0gLS0tCiAgICAgICAgCiAgICAgICAgZWxzZSBpZiAobW9kZSA9PT0gJ3N5bmMnICYmIHBsYXllcnMpIHsKICAgICAgICAgICAgLy8gKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkg4LiZ4Li14LmI4LiE4Li34LitIFBsYXllciDguJfguLXguYjguIHguJTguKPguLXguYDguJ/guKPguIrguYPguJnguYLguKvguKHguJQgU3luYwogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGdhbWVJZCk7CiAgICAgICAgICAgIGNvbnN0IGdhbWVTbmFwID0gYXdhaXQgZ2V0RG9jKGdhbWVSZWYpOwogICAgICAgICAgICBpZiAoIWdhbWVTbmFwLmV4aXN0cygpIHx8IGdhbWVTbmFwLmRhdGEoKS5zdGF0dXMgPT09ICdwb2RpdW0nIHx8IGdhbWVTbmFwLmRhdGEoKS5zdGF0dXMgPT09ICdmaW5pc2hlZCcpIHsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJyk7IHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY29uc29sZS5sb2coYOC4geC4s+C4peC4seC4h+C4geC4peC4seC4muC5gOC4guC5ieC4suC4quC4ueC5iOC5gOC4geC4oSAoUGxheWVyKSAoSUQ6ICR7Z2FtZUlkfSlgKTsKICAgICAgICAgICAgY3VycmVudExpdmVHYW1lSWQgPSBnYW1lSWQ7CiAgICAgICAgICAgIGN1cnJlbnRTdHVkZW50TmFtZSA9IHBsYXllcnNbMF07CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDilrzilrzilrwgWyBTVEFSVDog4LiZ4Li14LmI4LiE4Li34Lit4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0g4pa84pa84pa8CiAgICAgICAgICAgIGxvY2FsVGVhbVBsYXllcnMgPSBwbGF5ZXJzOyAvLyA8LS0g4Lia4Lij4Lij4LiX4Lix4LiU4Liq4Liz4LiE4Lix4LiN4LiX4Li14LmI4LiC4Liy4LiU4LmE4LibIQogICAgICAgICAgICAvLyDilrLilrLilrIgWyBFTkQ6IOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIOKWsuKWsuKWsgogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOwogICAgICAgICAgICBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKTsKCiAgICAgICAgfSBlbHNlIGlmICgobW9kZSA9PT0gJ3RlYW0nIHx8IG1vZGUgPT09ICdncm91cCcpICYmIHBsYXllcnMpIHsKICAgICAgICAgICAgLy8gKOC5guC4hOC5ieC4lOC5gOC4lOC4tOC4oSkg4LiZ4Li14LmI4LiE4Li34LitIFBsYXllciDguJfguLXguYjguIHguJTguKPguLXguYDguJ/guKPguIrguYPguJnguYLguKvguKHguJQgVGVhbS9Hcm91cAogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3RlYW1RdWl6emVzYCwgZ2FtZUlkKTsKICAgICAgICAgICAgY29uc3QgZ2FtZVNuYXAgPSBhd2FpdCBnZXREb2MoZ2FtZVJlZik7CiAgICAgICAgICAgIGlmICghZ2FtZVNuYXAuZXhpc3RzKCkgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ3BvZGl1bScgfHwgZ2FtZVNuYXAuZGF0YSgpLnN0YXR1cyA9PT0gJ2ZpbmlzaGVkJykgewogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zb2xlLmxvZyhg4LiB4Liz4Lil4Lix4LiH4LiB4Lil4Lix4Lia4LmA4LiC4LmJ4Liy4Liq4Li54LmI4LmA4LiB4LihICR7bW9kZX0gKFBsYXllcikgKElEOiAke2dhbWVJZH0pYCk7CiAgICAgICAgICAgIGN1cnJlbnRUZWFtUXVpeklkID0gZ2FtZUlkOwogICAgICAgICAgICBsb2NhbFRlYW1QbGF5ZXJzID0gcGxheWVyczsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsUXVlc3Rpb25JbmRleCA9IGdhbWVTdGF0ZS5xdWVzdGlvbkluZGV4IHx8IDA7CiAgICAgICAgICAgIGxvY2FsUGxheWVySW5kZXggPSBnYW1lU3RhdGUucGxheWVySW5kZXggfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdhbWVEYXRhID0gZ2FtZVNuYXAuZGF0YSgpOwogICAgICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgICAgICAgICBjb25zdCBxdWl6U25hcCA9IGF3YWl0IGdldERvYyhxdWl6UmVmKTsKICAgICAgICAgICAgaWYocXVpelNuYXAuZXhpc3RzKCkpIHsKICAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXooeyBpZDogcXVpelNuYXAuaWQsIC4uLnF1aXpTbmFwLmRhdGEoKSB9KTsKICAgICAgICAgICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICBpZiAobW9kZSA9PT0gJ2dyb3VwJykgewogICAgICAgICAgICAgICAgICAgIHJlbmRlckdyb3VwTW9kZVF1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJUZWFtUXVpelF1ZXN0aW9uKCk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIGxpc3RlbkZvclRlYW1RdWl6VXBkYXRlcygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcmVzdW1lIGdhbWUgc2Vzc2lvbjoiLCBlcnJvcik7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVXNlUG93ZXJ1cChwbGF5ZXJOYW1lLCBpdGVtSWQsIHF1ZXN0aW9uLCBnYW1lRGF0YSwgcGxheWVyRGF0YSkgewogICAgY29uc3QgcUluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICBjb25zdCBmbGFnTmFtZSA9IGBwb3dlcnVwVXNlZF9xJHtxSW5kZXh9X3Ake3BsYXllck5hbWV9YDsKICAgIGNvbnN0IHBvd2VydXBVc2VkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZSk7CgogICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4Liy4Lij4LiB4LiU4LiL4LmJ4LizCiAgICBpZiAocG93ZXJ1cFVzZWQgJiYgaXRlbUlkICE9PSAnYnV5VGltZScgJiYgaXRlbUlkICE9PSAnc3RyYXRlZ3lTY2FuJykgeyAKICAgICAgICBzaG93TWVzc2FnZSgi4LiE4Li44LiT4Liq4Liy4Lih4Liy4Lij4LiW4LmD4LiK4LmJ4LiV4Lix4Lin4LiK4LmI4Lin4Lii4LmE4LiU4LmJ4LmA4Lie4Li14Lii4LiHIDEg4LiE4Lij4Lix4LmJ4LiH4LiV4LmI4LitIDEg4LiC4LmJ4Lit4LiE4Lij4Lix4LiaIik7CiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHVzZS1wb3dlcnVwLSR7aXRlbUlkfWApOwogICAgICAgIGlmKGJ0bikgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC4geC4o+C4k+C4teC4nuC4tOC5gOC4qOC4qTog4LiE4Li54LiT4LmA4LiU4Li04Lih4Lie4Lix4LiZICjguJfguLPguIfguLLguJnguYPguJnguYDguITguKPguLfguYjguK3guIcpCiAgICBpZiAoaXRlbUlkID09PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oZmxhZ05hbWUsIGl0ZW1JZCk7CiAgICAgICAgcGxheVN5c3RlbVNvdW5kKCdwb3dlcnVwJyk7IC8vIFvguYDguJ7guLTguYjguKFdIOC5gOC4quC4teC4ouC4h+C5g+C4iuC5ieC5hOC4reC5gOC4l+C4oQogICAgICAgIHJlbmRlclN0dWRlbnRTeW5jUXVlc3Rpb25WaWV3KGdhbWVEYXRhKTsKICAgICAgICByZXR1cm47IAogICAgfQoKICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIHBsYXllck5hbWUpOwogICAgCiAgICB0cnkgewogICAgICAgIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHsKICAgICAgICAgICAgY29uc3QgcGxheWVyRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHBsYXllclJlZik7CiAgICAgICAgICAgIGlmICghcGxheWVyRG9jLmV4aXN0cygpKSB0aHJvdyAi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZIjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXJEYXRhID0gcGxheWVyRG9jLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcGxheWVyUG93ZXJ1cHMgPSBjdXJyZW50UGxheWVyRGF0YS5wb3dlcnVwcyB8fCB7fTsKICAgICAgICAgICAgY29uc3QgY3VycmVudEl0ZW1Db3VudCA9IHBsYXllclBvd2VydXBzW2l0ZW1JZF0gfHwgMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyZW50SXRlbUNvdW50IDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93ICLguITguLjguJPguYTguKHguYjguKHguLXguYTguK3guYDguJfguKHguJnguLXguYnguYPguJnguITguKXguLHguIcgKOC4geC4o+C4uOC4k+C4suC4peC4reC4h+C4o+C4teC5gOC4n+C4o+C4iuC4q+C4meC5ieC4suC4iOC4rSkiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB1cGRhdGVQYXlsb2FkID0ge307CiAgICAgICAgICAgIHVwZGF0ZVBheWxvYWRbYHBvd2VydXBzLiR7aXRlbUlkfWBdID0gaW5jcmVtZW50KC0xKTsgCgogICAgICAgICAgICAvLyDguKPguLXguYDguIvguYfguJUgU3RyZWFrIOC5gOC4oeC4t+C5iOC4reC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSAo4Lii4LiB4LmA4Lin4LmJ4LiZ4LmA4LiU4Li04Lih4Lie4Lix4LiZKQogICAgICAgICAgICBpZiAoaXRlbUlkICE9PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgICAgICAgICAgdXBkYXRlUGF5bG9hZFsnY29ycmVjdFN0cmVhayddID0gMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGl0ZW1JZCA9PT0gJ2J1eVRpbWUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBiYXNlRHVyYXRpb25NcyA9IChnYW1lRGF0YS50aW1lckR1cmF0aW9uIHx8IDI0MCkgKiAxMDAwOwogICAgICAgICAgICAgICAgY29uc3QgdGltZUJvbnVzTXMgPSBiYXNlRHVyYXRpb25NcyAqIDAuMjU7CiAgICAgICAgICAgICAgICB1cGRhdGVQYXlsb2FkW2B0aW1lQm9udXNUaGlzUXVlc3Rpb25gXSA9IGluY3JlbWVudCh0aW1lQm9udXNNcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyYW5zYWN0aW9uLnVwZGF0ZShwbGF5ZXJSZWYsIHVwZGF0ZVBheWxvYWQpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoaXRlbUlkID09PSAncG9sbCcpIHsKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgncG9sbFVzZWRUaGlzVHVybicsICd0cnVlJyk7CiAgICAgICAgfQogICAgICAgIGlmIChpdGVtSWQgIT09ICdidXlUaW1lJyAmJiBpdGVtSWQgIT09ICdzdHJhdGVneVNjYW4nKSB7IAogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGZsYWdOYW1lLCBpdGVtSWQpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguYDguKXguYjguJnguYDguKrguLXguKLguIfguYDguKHguLfguYjguK3guYPguIrguYnguKrguLPguYDguKPguYfguIgKICAgICAgICBwbGF5U3lzdGVtU291bmQoJ3Bvd2VydXAnKTsKCiAgICAgICAgYXBwbHlQb3dlcnVwRWZmZWN0KHBsYXllck5hbWUsIGl0ZW1JZCwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsKICAgICAgICAKICAgICAgICBpZiAoaXRlbUlkID09PSAnY3V0T25lJyB8fCBpdGVtSWQgPT09ICdmaWZ0eUZpZnR5JyB8fCBpdGVtSWQgPT09ICdpbnN1cmFuY2UnIHx8IGl0ZW1JZCA9PT0gJ3JldmVhbE9wdGlvbnMnKSB7CiAgICAgICAgICAgICByZW5kZXJTdHVkZW50U3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbUlkICE9PSAnd2FnZXJNdWx0aXBsaWVyJyAmJiBwbGF5ZXJEYXRhLmNvcnJlY3RTdHJlYWsgPiAwKSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguITguLjguJPguYPguIrguYnguJXguLHguKfguIrguYjguKfguKIgIiR7aXRlbUlkfSIhIENvbWJvIOC4luC4ueC4geC4o+C4teC5gOC4i+C5h+C4leC5gOC4m+C5h+C4mSAwYCk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiUG93ZXJ1cCB1c2UgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSh0eXBlb2YgZXJyb3IgPT09ICdzdHJpbmcnID8gZXJyb3IgOiAi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmD4LiK4LmJ4LiV4Lix4Lin4LiK4LmI4Lin4LiiIik7CiAgICAgICAgY29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHVzZS1wb3dlcnVwLSR7aXRlbUlkfWApOwogICAgICAgIGlmKGJ0bikgYnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGdldENhY2hlZE90aGVyUGxheWVycyhnYW1lRGF0YSwgbXlOYW1lKSB7CiAgICBjb25zdCBjdXJyZW50USA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgCiAgICAvLyAxLiDguYDguIrguYfguITguKfguYjguLLguYDguKPguLLguKHguLXguILguYnguK3guKHguLnguKXguILguK3guIcgIuC4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4mSIg4Lit4Lii4Li54LmI4LmB4Lil4LmJ4Lin4Lir4Lij4Li34Lit4Lii4Lix4LiHPwogICAgaWYgKGNhY2hlZE90aGVyUGxheWVyc0ZvclF1ZXN0aW9uICYmIGNhY2hlZFF1ZXN0aW9uSW5kZXhGb3JQbGF5ZXJzID09PSBjdXJyZW50USkgewogICAgICAgIGNvbnNvbGUubG9nKCLguYPguIrguYnguILguYnguK3guKHguLnguKXguYDguJ7guLfguYjguK3guJnguIjguLLguIEgQ2FjaGUgKOC4m+C4o+C4sOC4q+C4ouC4seC4lOC5gOC4meC5h+C4lSkiKTsKICAgICAgICByZXR1cm4gY2FjaGVkT3RoZXJQbGF5ZXJzRm9yUXVlc3Rpb247CiAgICB9CgogICAgLy8gMi4g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li1ICjguKvguKPguLfguK3guYDguJvguYfguJnguILguYnguK3guYPguKvguKHguYgpIOC5g+C4q+C5ieC5hOC4m+C5guC4q+C4peC4lOC4iOC4suC4gSBGaXJlYmFzZQogICAgY29uc29sZS5sb2coIuC5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4peC5gOC4nuC4t+C5iOC4reC4meC5g+C4q+C4oeC5iOC4iOC4suC4gSBTZXJ2ZXIuLi4iKTsKICAgIGNvbnN0IHBsYXllcnNDb2xSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCk7CiAgICAvLyDguJTguLbguIfguYDguInguJ7guLLguLDguITguJnguJfguLXguYjguKrguJbguLLguJnguLAgYWN0aXZlCiAgICBjb25zdCBxUXVlcnkgPSBxdWVyeShwbGF5ZXJzQ29sUmVmLCB3aGVyZSgic3RhdHVzIiwgIj09IiwgImFjdGl2ZSIpKTsKICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxUXVlcnkpOwogICAgCiAgICBjb25zdCBwbGF5ZXJzID0gW107CiAgICBzbmFwc2hvdC5mb3JFYWNoKGRvYyA9PiB7CiAgICAgICAgY29uc3QgcCA9IGRvYy5kYXRhKCk7CiAgICAgICAgLy8g4LmA4LiB4LmH4Lia4LiX4Li44LiB4LiE4LiZICjguKPguKfguKHguJXguLHguKfguYDguK3guIfguJTguYnguKfguKLguIHguYfguYTguJTguYkg4LmA4LiU4Li14LmL4Lii4Lin4LmE4Lib4LiB4Lij4Lit4LiH4Lit4Lit4LiB4LiX4Li14Lir4Lil4Lix4LiHKQogICAgICAgIHBsYXllcnMucHVzaChwKTsKICAgIH0pOwoKICAgIC8vIDMuIOC4muC4seC4meC4l+C4tuC4geC4peC4hyBDYWNoZSDguYTguKfguYnguYPguIrguYnguITguKPguLHguYnguIfguKvguJnguYnguLIKICAgIGNhY2hlZE90aGVyUGxheWVyc0ZvclF1ZXN0aW9uID0gcGxheWVyczsKICAgIGNhY2hlZFF1ZXN0aW9uSW5kZXhGb3JQbGF5ZXJzID0gY3VycmVudFE7CiAgICAKICAgIHJldHVybiBwbGF5ZXJzOwp9Cgphc3luYyBmdW5jdGlvbiBhcHBseVBvd2VydXBFZmZlY3QocGxheWVyTmFtZSwgaXRlbUlkLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllckRhdGEpIHsKICAgIGNvbnN0IHEgPSBxdWVzdGlvbjsKICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgCiAgICAvLyDguYDguKPguLLguJXguLHguJTguKrguYjguKfguJkgZ2V0Q2FjaGVkT3RoZXJQbGF5ZXJzIOC4l+C4tOC5ieC4h+C5hOC4m+C5gOC4peC4oiDguYDguJ7guKPguLLguLDguYTguK3guYDguJfguKHguJfguLXguYjguYDguKvguKXguLfguK3guK3guKLguLnguYjguYTguKHguYjguIjguLPguYDguJvguYfguJnguJXguYnguK3guIfguYPguIrguYnguILguYnguK3guKHguLnguKXguYDguJ7guLfguYjguK3guJkKICAgIC8vICjguIrguYjguKfguKLguJvguKPguLDguKvguKLguLHguJQgUmVhZHMg4LmE4LiU4LmJIDEwMCUpCgogICAgc3dpdGNoKGl0ZW1JZCkgewogICAgICAgIC8vIC0tLSAxLiDguJvguLjguYjguKHguJfguLXguYjguKHguLXguYPguKvguYnguIHguJTguJ/guKPguLXguKvguJnguYnguLLguIjguK0gKOC4leC5ieC4reC4h+C5gOC4geC5h+C4muC5hOC4p+C5iSkgLS0tCiAgICAgICAgY2FzZSAnd2FnZXJNdWx0aXBsaWVyJzogCiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLwn5KwIOC5guC4q+C4oeC4lOC5gOC4lOC4tOC4oeC4nuC4seC4meC4l+C4s+C4h+C4suC4mSEg4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4Lia4LmA4Lie4Li34LmI4Lit4LmA4Lib4Li04LiU4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiH4LmA4LiU4Li04Lih4Lie4Lix4LiZIik7IAogICAgICAgICAgICBicmVhazsKCiAgICAgICAgLy8gLS0tIDIuIOC5hOC4reC5gOC4l+C4oeC4l+C4teC5iOC4i+C4t+C5ieC4reC4iOC4suC4geC4leC4peC4suC4lOC4oeC4t+C4lCAtLS0KICAgICAgICBjYXNlICdzZWNvbmRDaGFuY2UnOiAKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIvCflIEg4LmC4Lit4LiB4Liy4Liq4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4Liq4Lit4LiH4LiX4Liz4LiH4Liy4LiZISDguKvguLLguIHguJXguK3guJrguJzguLTguJQg4LiE4Li44LiT4LiI4Liw4LmE4LiU4LmJ4LmA4Lil4Li34Lit4LiB4LmD4Lir4Lih4LmI4LiX4Lix4LiZ4LiX4Li1IDEg4LiE4Lij4Lix4LmJ4LiHIik7IAogICAgICAgICAgICBicmVhazsgCgogICAgICAgIGNhc2UgJ2J1eVRpbWUnOgogICAgICAgICAgICAvLyDguITguLPguJnguKfguJPguYDguKfguKXguLLguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguYnguJTguLkgKOC5geC4leC5iCBMb2dpYyDguYDguJ7guLTguYjguKHguIjguKPguLTguIfguK3guKLguLnguYjguJfguLXguYggaGFuZGxlVXNlUG93ZXJ1cCDguYHguKXguYnguKcpCiAgICAgICAgICAgIGNvbnN0IHRpbWVCb251cyA9IChnYW1lRGF0YS50aW1lckR1cmF0aW9uIHx8IDI0MCkgKiAwLjI1OwogICAgICAgICAgICBzaG93TWVzc2FnZShg4o+zIOC4i+C4t+C5ieC4reC5gOC4p+C4peC4suC4quC4s+C5gOC4o+C5h+C4iCEg4LmE4LiU4LmJ4LmA4Lie4Li04LmI4LihICR7dGltZUJvbnVzfSDguKfguLTguJnguLLguJfguLVgKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgJ2N1dE9uZSc6CiAgICAgICAgY2FzZSAnZmlmdHlGaWZ0eSc6CiAgICAgICAgICAgICAvLyBMb2dpYyDguKrguLPguKvguKPguLHguJrguIHguLLguKPguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIEKICAgICAgICAgICAgIGNvbnN0IGFsbEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubGl2ZS1hbnN3ZXItYnRuJyk7CiAgICAgICAgICAgICBpZiAoYWxsQnV0dG9ucy5sZW5ndGggPT09IDApIHsgc2hvd01lc3NhZ2UoIuKdjCDguYTguK3guYDguJfguKHguJnguLXguYnguYPguIrguYnguYTguJTguYnguYDguInguJ7guLLguLDguIHguLHguJrguILguYnguK3guKrguK3guJrguYHguJrguJrguJXguLHguKfguYDguKXguLfguK3guIHguYDguJfguYjguLLguJnguLHguYnguJnguITguKPguLHguJoiKTsgcmV0dXJuOyB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGNvbnN0IGhpZGRlbkZsYWcgPSBgaGlkZGVuT3B0aW9uc19xJHtxSW5kZXh9X3Ake3BsYXllck5hbWV9YDsKICAgICAgICAgICAgIGNvbnN0IHByZXZIaWRkZW4gPSBKU09OLnBhcnNlKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oaGlkZGVuRmxhZykgfHwgJ1tdJyk7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIGxldCBjb3JySWR4OwogICAgICAgICAgICAgLy8g4LmA4LiK4LmH4LiE4Lib4Lij4Liw4LmA4Lig4LiX4LiE4Liz4LiW4Liy4Lih4LmA4Lie4Li34LmI4Lit4Lir4Liy4LiC4LmJ4Lit4LiW4Li54LiBCiAgICAgICAgICAgICBjb25zdCBxVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgICAgICAgICAgIGlmIChxVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7IAogICAgICAgICAgICAgICAgIGNvcnJJZHggPSAoU3RyaW5nKHEuY29ycmVjdEFuc3dlcikudG9Mb3dlckNhc2UoKSA9PT0gJ3RydWUnKSA/IDAgOiAxOyAKICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgIGNvcnJJZHggPSBxLmNvcnJlY3RBbnN3ZXJJbmRleDsgCiAgICAgICAgICAgICB9CgogICAgICAgICAgICAgLy8g4Lir4Liy4Lib4Li44LmI4Lih4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LiC4LmJ4Lit4Lic4Li04LiUIOC5geC4peC4sOC4ouC4seC4h+C5hOC4oeC5iOC4luC4ueC4geC4i+C5iOC4reC4mQogICAgICAgICAgICAgY29uc3QgYmFkQnRucyA9IEFycmF5LmZyb20oYWxsQnV0dG9ucykuZmlsdGVyKGJ0biA9PiBwYXJzZUludChidG4uZGF0YXNldC52YWx1ZSkgIT09IGNvcnJJZHggJiYgIXByZXZIaWRkZW4uaW5jbHVkZXMoYnRuLmRhdGFzZXQudmFsdWUpKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKGJhZEJ0bnMubGVuZ3RoID09PSAwKSB7IHNob3dNZXNzYWdlKCLguYTguKHguYjguYDguKvguKXguLfguK3guJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguYPguKvguYnguJXguLHguJTguYHguKXguYnguKfguITguKPguLHguJohIik7IHJldHVybjsgfQogICAgICAgICAgICAgCiAgICAgICAgICAgICBzaHVmZmxlQXJyYXkoYmFkQnRucyk7IC8vIOC4quC4uOC5iOC4oeC4guC5ieC4reC4nOC4tOC4lOC4l+C4teC5iOC4iOC4sOC4leC4seC4lAogICAgICAgICAgICAgCiAgICAgICAgICAgICBjb25zdCBjb3VudCA9IGl0ZW1JZCA9PT0gJ2N1dE9uZScgPyAxIDogMjsKICAgICAgICAgICAgIGNvbnN0IGl0ZW1zVG9IaWRlID0gW107CgogICAgICAgICAgICAgLy8g4Lil4Li54Lib4LiL4LmI4Lit4LiZ4Lib4Li44LmI4Lih4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZCiAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgaWYoYmFkQnRuc1tpXSkgewogICAgICAgICAgICAgICAgICAgICBiYWRCdG5zW2ldLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguJvguLjguYjguKHguJfguLHguJnguJfguLUKICAgICAgICAgICAgICAgICAgICAgaXRlbXNUb0hpZGUucHVzaChiYWRCdG5zW2ldLmRhdGFzZXQudmFsdWUpOyAKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICAKICAgICAgICAgICAgIC8vIOC4muC4seC4meC4l+C4tuC4geC4peC4hyBzZXNzaW9uU3RvcmFnZSDguYDguJ7guLfguYjguK3guYPguKvguYnguITguIfguKrguJbguLLguJnguLDguYTguKfguYnguJbguYnguLLguKPguLXguYDguJ/guKPguIoKICAgICAgICAgICAgIGNvbnN0IG5ld0hpZGRlbiA9IFsuLi5wcmV2SGlkZGVuLCAuLi5pdGVtc1RvSGlkZV07CiAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGhpZGRlbkZsYWcsIEpTT04uc3RyaW5naWZ5KG5ld0hpZGRlbikpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICBzaG93TWVzc2FnZShpdGVtSWQgPT09ICdjdXRPbmUnID8gIuKaoe+4jyDguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguK3guK3guIHguYTguJsgMSDguILguYnguK3guYHguKXguYnguKchIiA6ICLimqHvuI8gNTA6NTAg4LiX4Liz4LiH4Liy4LiZISDguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJzguLTguJTguK3guK3guIHguYTguJvguYHguKXguYnguKchIik7CiAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgIAogICAgICAgIGRlZmF1bHQ6IAogICAgICAgICAgICAvLyDguIHguKPguJPguLXguYDguJzguLfguYjguK3guYTguKfguYnguKrguLPguKvguKPguLHguJrguYTguK3guYDguJfguKHguK3guLfguYjguJnguYYg4LmD4LiZ4Lit4LiZ4Liy4LiE4LiVCiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguYPguIrguYnguYTguK3guYDguJfguKEgJHtpdGVtSWR9IOC5geC4peC5ieC4pyFgKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRm9yY2VDb25maWRlbnQodGFyZ2V0TmFtZSwgZGlzcGxheU5hbWUpIHsKICAgIGlmICghY3VycmVudExpdmVHYW1lSWQgfHwgIXRhcmdldE5hbWUpIHJldHVybjsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgdGFyZ2V0TmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHBsYXllclJlZiwgeyBpc0ZvcmNlZENvbmZpZGVudDogdHJ1ZSB9KTsKICAgICAgICBzaG93TWVzc2FnZShg4LmD4LiK4LmJICLguJrguLHguIfguITguLHguJrguKHguLHguYjguJnguYPguIgiIOC4geC4seC4miAke2Rpc3BsYXlOYW1lfSDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBhcHBseSBmb3JjZUNvbmZpZGVudDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSIpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVSZWZ1bmRQb3dlcnVwKHBsYXllck5hbWUsIGl0ZW1JZCkgewogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgcGxheWVyTmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHt9OwogICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4leC4seC4lCBwcmVmaXgg4Lit4Lit4LiBCiAgICAgICAgdXBkYXRlUGF5bG9hZFtgcG93ZXJ1cHMuJHtpdGVtSWR9YF0gPSBpbmNyZW1lbnQoMSk7IAogICAgICAgIAogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwbGF5ZXJSZWYsIHVwZGF0ZVBheWxvYWQpOwogICAgICAgIGNvbnNvbGUubG9nKGBSZWZ1bmRlZCAke2l0ZW1JZH0gdG8gJHtwbGF5ZXJOYW1lfWApOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gcmVmdW5kIHBvd2VydXA6IiwgZXJyb3IpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVBcHBseUppbngodGFyZ2V0TmFtZSwgZGlzcGxheU5hbWUpIHsKICAgIGlmICghY3VycmVudExpdmVHYW1lSWQgfHwgIXRhcmdldE5hbWUpIHJldHVybjsKICAgIAogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LiV4LmJ4Lit4LiH4LiK4Li14LmJ4LmE4Lib4LiX4Li14LmIIHBsYXllcnMgc3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgdGFyZ2V0TmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4Lih4Li1IHByZWZpeCBwbGF5ZXJzLnRhcmdldE5hbWUg4LmB4Lil4LmJ4LinCiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHBsYXllclJlZiwgeyBpc0ppbnhlZDogdHJ1ZSB9KTsKICAgICAgICAKICAgICAgICBzaG93TWVzc2FnZShg4LmD4LiK4LmJICLguITguLPguKrguLLguJsiIOC4geC4seC4miAke2Rpc3BsYXlOYW1lfSDguKrguLPguYDguKPguYfguIghYCk7CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBhcHBseSBqaW54OiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmD4LiK4LmJ4LmE4Lit4LmA4LiX4LihIik7CiAgICB9Cn0KCmZ1bmN0aW9uIGFjdGl2YXRlRmlsZUlucHV0QXJlYVdpdGhMb2FkZWRGaWxlKCkgewogICAgY29uc3QgZ2VuZXJhdGVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1maWxlLWJ0bicpOwogICAgY29uc3QgdG9waWNzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmaWxlLXRvcGljcy1saXN0LWNvbnRhaW5lcicpOwogICAgY29uc3Qgc2VwYXJhdGVDb250ZW50Q2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VwYXJhdGUtYnktY29udGVudC1mcm9tLWZpbGUtY2hlY2tib3gnKTsKCiAgICAvLyDguJXguKPguKPguIHguLDguJnguLXguYnguIjguLDguJfguLPguIfguLLguJnguYDguKvguKHguLfguK3guJnguIHguLHguJrguIHguLLguKPguK3guLHguJvguYLguKvguKXguJTguYTguJ/guKXguYzguJvguIHguJXguLTguJfguLjguIHguJvguKPguLDguIHguLLguKMKICAgIGlmIChzZWxlY3RlZEZpbGUpIHsKICAgICAgICBpZiAoc2VwYXJhdGVDb250ZW50Q2hlY2tib3guY2hlY2tlZCkgewogICAgICAgICAgICBnZW5lcmF0ZUJ0bi5kaXNhYmxlZCA9IHRydWU7IC8vIOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4quC4o+C5ieC4suC4h+C4q+C4peC4seC4gSDguYDguJ7guLfguYjguK3guYPguKvguYnguJzguLnguYnguYPguIrguYnguYDguKXguLfguK3guIHguKvguLHguKfguILguYnguK3guIHguYjguK3guJkKICAgICAgICAgICAgYW5hbHl6ZUZpbGVGb3JUb3BpY3Moc2VsZWN0ZWRGaWxlKTsgLy8g4LmA4Lij4Li04LmI4Lih4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LiX4Li14LmI4LmC4Lir4Lil4LiU4Lih4LiyCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2VuZXJhdGVCdG4uZGlzYWJsZWQgPSBmYWxzZTsgLy8g4LmA4Lib4Li04LiU4Lib4Li44LmI4Lih4Liq4Lij4LmJ4Liy4LiH4Lir4Lil4Lix4LiB4LmD4Lir4LmJ4Lie4Lij4LmJ4Lit4Lih4LmD4LiK4LmJ4LiH4Liy4LiZCiAgICAgICAgICAgIHRvcGljc0xpc3RDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4quC5iOC4p+C4meC5gOC4peC4t+C4reC4geC4q+C4seC4p+C4guC5ieC4rQogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LmE4Lif4Lil4LmMIOC5g+C4q+C5ieC4m+C4tOC4lOC4m+C4uOC5iOC4oeC5geC4peC4sOC4i+C5iOC4reC4meC4l+C4uOC4geC4reC4ouC5iOC4suC4hwogICAgICAgIGdlbmVyYXRlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICB0b3BpY3NMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVLaWNrUGxheWVyU3luYyhwbGF5ZXJOYW1lKSB7CiAgICBpZiAoIWN1cnJlbnRMaXZlR2FtZUlkIHx8ICFwbGF5ZXJOYW1lKSByZXR1cm47CgogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmA4Lib4LmJ4Liy4Lir4Lih4Liy4Lii4LmA4Lib4LmH4LiZIFBsYXllciBTdWJjb2xsZWN0aW9uCiAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgIAogICAgdHJ5IHsKICAgICAgICAvLyDguYDguJvguKXguLXguYjguKLguJnguKrguJbguLLguJnguLDguYPguJnguYTguJ/guKXguYzguKLguYjguK3guKIKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocGxheWVyUmVmLCB7IHN0YXR1czogJ2luYWN0aXZlJyB9KTsKICAgICAgICAvLyDguYTguKHguYjguJXguYnguK3guIfguJfguLPguK3guLDguYTguKPguJXguYjguK0gb25TbmFwc2hvdCDguILguK3guIcgQWRtaW4g4LiI4Liw4LiV4Lij4Lin4LiI4LiI4Lix4Lia4LmB4Lil4Liw4Lil4Lia4LiK4Li34LmI4Lit4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4Lit4LiHCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBraWNrIHBsYXllciAke3BsYXllck5hbWV9OmAsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiZ4Liz4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4Lit4Lit4LiBIik7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIHJlbmRlclN0dWRlbnRQcm9ncmVzc0Rhc2hib2FyZChwcm9qZWN0SWQsIHN0dWRlbnROYW1lKSB7CiAgICBjb25zdCBjb250ZW50RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcHJvZ3Jlc3MtY29udGVudCcpOwogICAgY29udGVudERpdi5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2Pic7CgogICAgdHJ5IHsKICAgICAgICAvLyDguJTguLbguIfguYHguJrguJrguJfguJTguKrguK3guJrguJfguLHguYnguIfguKvguKHguJTguYPguJnguYLguJvguKPguYDguIjguIQKICAgICAgICBjb25zdCBxdWl6emVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHF1aXp6ZXNSZWYsIHdoZXJlKCJwcm9qZWN0SWQiLCAiPT0iLCBwcm9qZWN0SWQpKTsKICAgICAgICBjb25zdCBxdWl6emVzU25hcCA9IGF3YWl0IGdldERvY3MocSk7CiAgICAgICAgY29uc3QgcXVpenplc0luUHJvamVjdCA9IHF1aXp6ZXNTbmFwLmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKCiAgICAgICAgLy8g4LiU4Li24LiH4Lic4Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJCiAgICAgICAgY29uc3Qgc3VibWlzc2lvblByb21pc2VzID0gcXVpenplc0luUHJvamVjdC5tYXAocXVpeiA9PiAKICAgICAgICAgICAgZ2V0RG9jKGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpei5pZH0vc3VibWlzc2lvbnNgLCBzdHVkZW50TmFtZSkpCiAgICAgICAgKTsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uU25hcHMgPSBhd2FpdCBQcm9taXNlLmFsbChzdWJtaXNzaW9uUHJvbWlzZXMpOwogICAgICAgIAogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25zID0gc3VibWlzc2lvblNuYXBzCiAgICAgICAgICAgIC5maWx0ZXIoc25hcCA9PiBzbmFwLmV4aXN0cygpKQogICAgICAgICAgICAubWFwKHNuYXAgPT4gKHsgcXVpeklkOiBzbmFwLnJlZi5wYXJlbnQucGFyZW50LmlkLCAuLi5zbmFwLmRhdGEoKSB9KSk7CiAgICAgICAgICAgIAogICAgICAgIGlmIChzdWJtaXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4muC5g+C4meC5guC4m+C4o+C5gOC4iOC4hOC4meC4teC5iTwvcD4nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDguKrguKPguYnguLLguIcgSFRNTCDguYHguKrguJTguIfguJzguKUKICAgICAgICBsZXQgaHRtbCA9ICc8ZGl2IGNsYXNzPSJzcGFjZS15LTQiPic7CiAgICAgICAgc3VibWlzc2lvbnMuZm9yRWFjaChzdWIgPT4gewogICAgICAgICAgICBjb25zdCBxdWl6ID0gcXVpenplc0luUHJvamVjdC5maW5kKHF6ID0+IHF6LmlkID09PSBzdWIucXVpeklkKTsKICAgICAgICAgICAgY29uc3QgZGlzcGxheVNldHRpbmcgPSBxdWl6LnNldHRpbmdzPy5yZXN1bHRzRGlzcGxheSB8fCAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJzsKICAgICAgICAgICAgY29uc3QgcGFzc2luZ1Njb3JlID0gcXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IDA7CiAgICAgICAgICAgIGNvbnN0IGlzUGFzcyA9IHN1Yi5iZXN0U2NvcmUgPj0gcGFzc2luZ1Njb3JlOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIFsgU1RBUlQ6IOC4meC4teC5iOC4hOC4t+C4reC4leC4o+C4o+C4geC4sOC5g+C4q+C4oeC5iOC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4siBdIC0tLQogICAgICAgICAgICBsZXQgc2NvcmVIdG1sID0gJyc7CiAgICAgICAgICAgIGxldCBjYXJkQmdDb2xvciA9ICdiZy1ncmF5LTUwJzsgLy8g4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCgogICAgICAgICAgICBzd2l0Y2goZGlzcGxheVNldHRpbmcpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3dfcmVzdWx0c19hbmRfYW5zd2Vycyc6CiAgICAgICAgICAgICAgICBjYXNlICdzaG93X3Jlc3VsdHNfb25seSc6CiAgICAgICAgICAgICAgICAgICAgY2FyZEJnQ29sb3IgPSBpc1Bhc3MgPyAnYmctZ3JlZW4tNTAnIDogJ2JnLXJlZC01MCc7CiAgICAgICAgICAgICAgICAgICAgc2NvcmVIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgJHtpc1Bhc3MgPyAndGV4dC1ncmVlbi03MDAnIDogJ3RleHQtcmVkLTcwMCd9Ij4ke3N1Yi5iZXN0U2NvcmV9IC8gJHtzdWIudG90YWxRdWVzdGlvbnN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcHktMC41IHJvdW5kZWQtZnVsbCAke2lzUGFzcyA/ICdiZy1ncmVlbi0yMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0yMDAgdGV4dC1yZWQtODAwJ30iPiR7aXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJ308L3A+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3dfcGFzc19mYWlsX29ubHknOgogICAgICAgICAgICAgICAgICAgIGNhcmRCZ0NvbG9yID0gaXNQYXNzID8gJ2JnLWdyZWVuLTUwJyA6ICdiZy1yZWQtNTAnOwogICAgICAgICAgICAgICAgICAgIHNjb3JlSHRtbCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteGwgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1mdWxsICR7aXNQYXNzID8gJ2JnLWdyZWVuLTIwMCB0ZXh0LWdyZWVuLTgwMCcgOiAnYmctcmVkLTIwMCB0ZXh0LXJlZC04MDAnfSI+JHtpc1Bhc3MgPyAn4Lic4LmI4Liy4LiZJyA6ICfguYTguKHguYjguJzguYjguLLguJknfTwvcD4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnbWFudWFsX3JlbGVhc2UnOgogICAgICAgICAgICAgICAgICAgIGNhcmRCZ0NvbG9yID0gJ2JnLXllbGxvdy01MCc7CiAgICAgICAgICAgICAgICAgICAgc2NvcmVIdG1sID0gYAogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSBmb250LXNlbWlib2xkIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgYmcteWVsbG93LTIwMCB0ZXh0LXllbGxvdy04MDAiPuC4o+C4reC4m+C4o+C4sOC4geC4suC4qOC4nOC4pTwvcD4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIC0tLSBbIEVORDog4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiV4Lij4Lij4LiB4Liw4LmD4Lir4Lih4LmIIF0gLS0tCgogICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InAtNCBib3JkZXIgcm91bmRlZC1sZyBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgJHtjYXJkQmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIj4ke3F1aXoudG9waWN9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNjAwIj7guJfguLPguYTguJsgJHtzdWIuYXR0ZW1wdHMubGVuZ3RofSDguITguKPguLHguYnguIcgfCDguKrguYjguIfguKXguYjguLLguKrguLjguJQ6ICR7bmV3IERhdGUoc3ViLmxhdGVzdFN1Ym1pdHRlZEF0KS50b0xvY2FsZURhdGVTdHJpbmcoJ3RoLVRIJyl9PC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAke3Njb3JlSHRtbH0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0pOwogICAgICAgIGh0bWwgKz0gJzwvZGl2Pic7CiAgICAgICAgY29udGVudERpdi5pbm5lckhUTUwgPSBodG1sOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgcmVuZGVyaW5nIHN0dWRlbnQgcHJvZ3Jlc3M6IiwgZXJyb3IpOwogICAgICAgIGNvbnRlbnREaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXJlZC01MDAiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5guC4q+C4peC4lOC4guC5ieC4reC4oeC4ueC4pTwvcD4nOwogICAgfQp9CgpmdW5jdGlvbiByZW5kZXJRdWl6QmFua0xpc3RGb3JNdWx0aVNlbGVjdChmaWx0ZXJUZXh0ID0gJycpIHsKICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYW5rLXF1aXotbGlzdCcpOwogICAgY29uc3QgdGVybSA9IGZpbHRlclRleHQudG9Mb3dlckNhc2UoKS50cmltKCk7CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4hOC4ouC4ouC5iOC4reC5hOC4p+C5iTog4LiB4Liy4Lij4LmA4LiV4Lij4Li14Lii4Lih4LiC4LmJ4Lit4Lih4Li54LilIC0tLQogICAgLy8gMS4g4Lin4LiZ4Lil4Li54Lib4LmD4LiZIGFsbFF1aXp6ZXNHbG9iYWwg4LmA4Lie4Li34LmI4Lit4LmA4Lie4Li04LmI4Lih4LiC4LmJ4Lit4Lih4Li54LilICLguIrguLfguYjguK3guYLguJvguKPguYDguIjguIQiIOC5gOC4guC5ieC4suC5hOC4m+C5g+C4meC5geC4leC5iOC4peC4sCBvYmplY3QKICAgIGNvbnN0IHJvd3MgPSBhbGxRdWl6emVzR2xvYmFsCiAgICAgICAgLm1hcChxID0+ICh7CiAgICAgICAgICAgIC4uLnEsCiAgICAgICAgICAgIHByb2plY3ROYW1lOiAoYWxsUHJvamVjdHMuZmluZChwID0+IHAuaWQgPT09IHEucHJvamVjdElkKT8ucHJvamVjdE5hbWUpIHx8ICdOL0EnCiAgICAgICAgfSkpCiAgICAgICAgLy8gMi4g4LiB4Lij4Lit4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiV4Liy4Lih4LiE4Liz4LiE4LmJ4LiZ4Lir4LiyICjguITguYnguJnguIjguLLguIEg4LiK4Li34LmI4Lit4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaLCDguIrguLfguYjguK3guYLguJvguKPguYDguIjguIQsIOC4q+C4o+C4t+C4reC4o+C4q+C4seC4qiBJRCkKICAgICAgICAuZmlsdGVyKHEgPT4KICAgICAgICAgICAgKHEudG9waWMgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHwKICAgICAgICAgICAgKHEucHJvamVjdE5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkgfHwKICAgICAgICAgICAgKHEuaWQudG9TdHJpbmcoKS5pbmNsdWRlcyh0ZXJtKSkKICAgICAgICApOwogICAgLy8gLS0tIOC4quC4tOC5ieC4meC4quC4uOC4lOC4quC5iOC4p+C4meC4l+C4teC5iOC5gOC4hOC4ouC4ouC5iOC4reC5hOC4p+C5iSAtLS0KCiAgICAvLyAzLiDguKrguKPguYnguLLguIcgSFRNTCDguYLguJTguKLguYPguIrguYnguILguYnguK3guKHguLnguKXguJfguLXguYjguIHguKPguK3guIfguYHguKXguYnguKcKICAgIGxpc3RFbC5pbm5lckhUTUwgPSByb3dzLmxlbmd0aCA/IHJvd3MubWFwKHEgPT4gYAogICAgICAgIDxsYWJlbCBjbGFzcz0idy1mdWxsIHRleHQtbGVmdCBwLTMgYm9yZGVyLWIgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQgY3Vyc29yLXBvaW50ZXIiPgogICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIHZhbHVlPSIke3EuaWR9IiBjbGFzcz0icXVpei1iYW5rLWNoZWNrYm94IGgtNSB3LTUgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1wdXJwbGUtNjAwIGZvY3VzOnJpbmctcHVycGxlLTUwMCI+CiAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tNzAwIj4ke3EudG9waWMgfHwgJyjguYTguKHguYjguKHguLXguIrguLfguYjguK0pJ308L3A+CiAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+4LmC4Lib4Lij4LmA4LiI4LiEOiAke3EucHJvamVjdE5hbWV9IHwgSUQ6ICR7cS5pZH08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvbGFiZWw+CiAgICBgKS5qb2luKCcnKSA6IGA8ZGl2IGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lie4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaPC9kaXY+YDsKICAgIAogICAgLy8gNC4g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5gOC4nuC4t+C5iOC4reC5gOC4m+C4tOC4lC/guJvguLTguJTguJvguLjguYjguKEgIuC4ouC4t+C4meC4ouC4seC4mSIg4LmA4Lih4Li34LmI4Lit4Lih4Li14LiB4Liy4Lij4LmA4Lil4Li34Lit4LiBCiAgICBsaXN0RWwub25jaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgY29uc3QgaGFzU2VsZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnF1aXotYmFuay1jaGVja2JveDpjaGVja2VkJyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbGluay1xdWl6LWJ0bicpLmRpc2FibGVkID0gIWhhc1NlbGVjdGlvbjsKICAgIH07Cn0KCmZ1bmN0aW9uIHNldHVwU3R1ZGVudFByb2dyZXNzTGlzdGVuZXJzKCkgewogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZpZXctbXktcHJvZ3Jlc3MtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93U3R1ZGVudFByb2dyZXNzVmlldyk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by1zdHVkZW50LWhvbWUtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtcHJvZ3Jlc3MtdmlldycpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWluaXRpYWwtdmlldycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfSk7Cn0KCi8qKgogKiBb4LiJ4Lia4Lix4Lia4LmA4LiV4LmH4LihXSDguYDguKPguLTguYjguKHguIHguKPguLDguJrguKfguJnguIHguLLguKPguJ3guLbguIHguJ3guJnguJfguLHguIHguKnguLAg4LmC4LiU4Lii4LmB4Lib4Lil4LiH4LiE4Liz4LiW4Liy4Lih4LiU4Li04Lia4LmA4Lib4LmH4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lih4Liy4LiV4Lij4LiQ4Liy4LiZ4LiB4LmI4Lit4LiZCiAqIEBwYXJhbSB7c3RyaW5nfSByYXdRdWVzdGlvblRleHQgLSDguJvguKPguLDguYLguKLguITguITguLPguJbguLLguKHguYDguJXguYfguKHguYYg4LiX4Li14LmI4Lih4Liy4LiI4Liy4LiB4Lib4Li44LmI4LihICLguJ3guLbguIHguJ3guJnguYDguKPguLfguYjguK3guIfguJnguLXguYnguYDguJ7guLTguYjguKHguYDguJXguLTguKEiCiAqLwphc3luYyBmdW5jdGlvbiBzdGFydFNraWxsUHJhY3RpY2UocmF3UXVlc3Rpb25UZXh0KSB7CiAgICAvLyAxLiDguYHguKrguJTguIfguKrguJbguLLguJnguLDguIHguLPguKXguLHguIfguYLguKvguKXguJTguYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguYDguKvguYfguJkKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguIvguYjguK3guJnguKvguJnguYnguLLguJzguKXguKrguK3guJrguYDguJTguLTguKEKICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2PgogICAgICAgICAgICA8cCBjbGFzcz0ibXQtNCB0ZXh0LWdyYXktNjAwIj7guIHguLPguKXguLHguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguKvguLHguKfguILguYnguK3guYHguKXguLDguYDguJXguKPguLXguKLguKHguIrguLjguJTguYHguJrguJrguJ3guLbguIHguJ7guLTguYDguKjguKkuLi48L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMi4gKirguILguLHguYnguJnguJXguK3guJnguYPguKvguKHguYjguJfguLXguYjguKrguLPguITguLHguI3guJfguLXguYjguKrguLjguJQqKjog4LmA4Lij4Li14Lii4LiBIEFJIOC5gOC4nuC4t+C5iOC4reC5geC4m+C4peC4h+C4hOC4s+C4luC4suC4oeC4lOC4tOC4muC5g+C4q+C5ieC5gOC4m+C5h+C4meC4q+C4seC4p+C4guC5ieC4reC4oeC4suC4leC4o+C4kOC4suC4mQogICAgICAgIGNvbnN0IHN0YW5kYXJkVG9waWMgPSBhd2FpdCBnZXRTdGFuZGFyZGl6ZWRUb3BpYyhyYXdRdWVzdGlvblRleHQpOwogICAgICAgIGNvbnNvbGUubG9nKGDguITguLPguJbguLLguKHguJTguLTguJo6ICIke3Jhd1F1ZXN0aW9uVGV4dH0iIC0+IOC4q+C4seC4p+C4guC5ieC4reC4oeC4suC4leC4o+C4kOC4suC4mTogIiR7c3RhbmRhcmRUb3BpY30iYCk7CiAgICAgICAgCiAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiVIFVJIOC5g+C4q+C5ieC5geC4quC4lOC4h+C4q+C4seC4p+C4guC5ieC4reC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C5geC4geC5iOC4meC4seC4geC5gOC4o+C4teC4ouC4mQogICAgICAgIHN0dWRlbnRRdWl6QXJlYS5xdWVyeVNlbGVjdG9yKCdwJykudGV4dENvbnRlbnQgPSBg4LiB4Liz4Lil4Lix4LiH4LmA4LiV4Lij4Li14Lii4Lih4LiK4Li44LiU4LmB4Lia4Lia4Lid4Li24LiB4Lie4Li04LmA4Lio4Lip4Liq4Liz4Lir4Lij4Lix4Lia4Lir4Lix4Lin4LiC4LmJ4LitOiAiJHtzdGFuZGFyZFRvcGljfSIuLi5gOwoKICAgICAgICAvLyAzLiDguITguYnguJnguKvguLLguITguLPguJbguLLguKHguYPguJkgIuC4hOC4peC4seC4h+C5geC4muC4muC4neC4tuC4geC4neC4mSIg4LiU4LmJ4Lin4LiiICLguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkiIOC4l+C4teC5iOC5hOC4lOC5ieC4oeC4sgogICAgICAgIGNvbnN0IHByYWN0aWNlQmFua1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJhY3RpY2VCYW5rYCk7CiAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHByYWN0aWNlQmFua1JlZiwgd2hlcmUoInRvcGljIiwgIj09Iiwgc3RhbmRhcmRUb3BpYykpOwogICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0RG9jcyhxKTsKCiAgICAgICAgLy8gNC4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiE4Liz4LiW4Liy4Lih4LmD4LiZ4LiE4Lil4Lix4LiH4LmA4Lie4Li14Lii4LiH4Lie4Lit4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgaWYgKHNuYXBzaG90LmRvY3MubGVuZ3RoID49IDMpIHsKICAgICAgICAgICAgLy8gNC4xIC0tPiDguIHguKPguJPguLXguYDguIjguK0gKENhY2hlIEhpdCk6IOC5g+C4iuC5ieC4hOC4s+C4luC4suC4oeC4iOC4suC4geC4hOC4peC4seC4hwogICAgICAgICAgICBjb25zb2xlLmxvZyhg4Lie4Lia4LiC4LmJ4Lit4Liq4Lit4LiaICR7c25hcHNob3QuZG9jcy5sZW5ndGh9IOC4guC5ieC4reC5g+C4meC4hOC4peC4seC4h+C4quC4s+C4q+C4o+C4seC4muC4q+C4seC4p+C4guC5ieC4rSAiJHtzdGFuZGFyZFRvcGljfSIuIOC4geC4s+C4peC4seC4h+C4quC4uOC5iOC4oeC5gOC4peC4t+C4reC4geC4oeC4suC5g+C4iuC5ieC4h+C4suC4mS4uLmApOwogICAgICAgICAgICAKICAgICAgICAgICAgbGV0IHF1ZXN0aW9uc0Zyb21CYW5rID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+IGRvYy5kYXRhKCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2h1ZmZsZUFycmF5KHF1ZXN0aW9uc0Zyb21CYW5rKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRyaWxsRGF0YSA9IHsKICAgICAgICAgICAgICAgIHRvcGljOiBzdGFuZGFyZFRvcGljLAogICAgICAgICAgICAgICAgcXVlc3Rpb25zOiBxdWVzdGlvbnNGcm9tQmFuay5zbGljZSgwLCAzKSAvLyDguYDguKXguLfguK3guIHguKHguLIgMyDguILguYnguK0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGRpc3BsYXlTa2lsbFByYWN0aWNlRHJpbGwoZHJpbGxEYXRhKTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gNC4yIC0tPiDguIHguKPguJPguLXguYTguKHguYjguYDguIjguK0gKENhY2hlIE1pc3MpOiDguYDguKPguLXguKLguIEgQUkg4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDguYTguKHguYjguJ7guJrguILguYnguK3guKrguK3guJrguYPguJnguITguKXguLHguIfguKrguLPguKvguKPguLHguJrguKvguLHguKfguILguYnguK0gIiR7c3RhbmRhcmRUb3BpY30iLiDguIHguLPguKXguLHguIfguYDguKPguLXguKLguIEgQUkg4Liq4Lij4LmJ4Liy4LiH4LmD4Lir4Lih4LmILi4uYCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkcmlsbERhdGEgPSBhd2FpdCBnZW5lcmF0ZVByYWN0aWNlUXVlc3Rpb25zKHN0YW5kYXJkVG9waWMpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gKirguILguLHguYnguJnguJXguK3guJnguKrguLPguITguLHguI06Kiog4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmI4Lil4LiH4LiE4Lil4Lix4LiH4LiU4LmJ4Lin4LiiICLguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkiCiAgICAgICAgICAgIGF3YWl0IHNhdmVEcmlsbFRvUHJhY3RpY2VCYW5rKGRyaWxsRGF0YSwgc3RhbmRhcmRUb3BpYyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBkaXNwbGF5U2tpbGxQcmFjdGljZURyaWxsKGRyaWxsRGF0YSk7CiAgICAgICAgfQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi4Lil4LmJ4Lih4LmA4Lir4Lil4Lin4LmD4LiZ4LiB4Liy4Lij4LmA4Lij4Li04LmI4Lih4LmC4Lir4Lih4LiU4Lid4Li24LiB4Lid4LiZ4LiX4Lix4LiB4Lip4LiwOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LiC4Lit4Lit4Lig4Lix4LiiLCDguYTguKHguYjguKrguLLguKHguLLguKPguJbguKrguKPguYnguLLguIfguIrguLjguJTguYHguJrguJrguJ3guLbguIHguYTguJTguYnguYPguJnguILguJPguLDguJnguLXguYkg4LiB4Lij4Li44LiT4Liy4Lil4Lit4LiH4LmD4Lir4Lih4LmI4Lig4Liy4Lii4Lir4Lil4Lix4LiHIik7CiAgICAgICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgfQp9CgovKioKICog4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiW4Liy4Lih4LiI4Liy4LiB4LiK4Li44LiU4LmB4Lia4Lia4Lid4Li24LiB4LiX4Li14LmIIEFJIOC4quC4o+C5ieC4suC4h+C4peC4h+C5g+C4mSBQcmFjdGljZSBCYW5rCiAqIEBwYXJhbSB7b2JqZWN0fSBkcmlsbERhdGEgLSDguILguYnguK3guKHguLnguKXguIrguLjguJTguYHguJrguJrguJ3guLbguIHguJfguLXguYjguYTguJTguYnguIjguLLguIEgQUkKICovCmFzeW5jIGZ1bmN0aW9uIHNhdmVEcmlsbFRvUHJhY3RpY2VCYW5rKGRyaWxsRGF0YSwgc3RhbmRhcmRUb3BpYykgeyAvLyA8LS0tIOC5gOC4nuC4tOC5iOC4oSBzdGFuZGFyZFRvcGljIOC4leC4o+C4h+C4meC4teC5iQogICAgY29uc3QgcHJhY3RpY2VCYW5rUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcmFjdGljZUJhbmtgKTsKICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CgogICAgZHJpbGxEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgIGNvbnN0IG5ld1F1ZXN0aW9uRG9jID0gZG9jKHByYWN0aWNlQmFua1JlZik7CiAgICAgICAgYmF0Y2guc2V0KG5ld1F1ZXN0aW9uRG9jLCB7CiAgICAgICAgICAgIHRvcGljOiBzdGFuZGFyZFRvcGljLCAvLyA8LS0tIOC4leC4reC4meC4meC4teC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4o+C4ueC5ieC4iOC4seC4geC5geC4peC5ieC4pwogICAgICAgICAgICBxdWVzdGlvblRleHQ6IHEucXVlc3Rpb25UZXh0LAogICAgICAgICAgICBvcHRpb25zOiBxLm9wdGlvbnMsCiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJJbmRleDogcS5jb3JyZWN0QW5zd2VySW5kZXgsCiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2VydmVyVGltZXN0YW1wKCkKICAgICAgICB9KTsKICAgIH0pOwoKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CiAgICAgICAgY29uc29sZS5sb2coYOC4muC4seC4meC4l+C4tuC4geC4hOC4s+C4luC4suC4oeC5g+C4q+C4oeC5iCAke2RyaWxsRGF0YS5xdWVzdGlvbnMubGVuZ3RofSDguILguYnguK3guKXguIcgUHJhY3RpY2UgQmFuayDguKrguLPguYDguKPguYfguIhgKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHF1ZXN0aW9ucyB0byBwcmFjdGljZSBiYW5rOiIsIGVycm9yKTsKICAgIH0KfQoKLyoqCiAqIOC5gOC4o+C4teC4ouC4gSBBSSDguYDguJ7guLfguYjguK3guYHguJvguKXguIfguJvguKPguLDguYLguKLguITguITguLPguJbguLLguKHguYPguKvguYnguYDguJvguYfguJnguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkgKFN0YW5kYXJkaXplZCBUb3BpYykKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXN0aW9uVGV4dCAtIOC4m+C4o+C4sOC5guC4ouC4hOC4hOC4s+C4luC4suC4oeC5gOC4leC5h+C4oeC5hgogKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSDguKvguLHguKfguILguYnguK3guKHguLLguJXguKPguJDguLLguJkg4LmA4LiK4LmI4LiZICLguIHguLLguKPguKvguLLguKPguJfguKjguJnguLTguKLguKEiCiAqLwphc3luYyBmdW5jdGlvbiBnZXRTdGFuZGFyZGl6ZWRUb3BpYyhxdWVzdGlvblRleHQpIHsKICAgIGNvbnN0IHByb21wdCA9IGAKICAgICAgICDguITguLjguJPguITguLfguK3guJzguLnguYnguYDguIrguLXguYjguKLguKfguIrguLLguI3guJTguYnguLLguJnguKvguKXguLHguIHguKrguLnguJXguKPguITguJPguLTguJXguKjguLLguKrguJXguKPguYwKICAgICAgICDguKfguLTguYDguITguKPguLLguLDguKvguYzguITguLPguJbguLLguKHguJXguYjguK3guYTguJvguJnguLXguYkg4LmB4Lil4Liw4Liq4Lij4Li44Lib4LmD4Lir4LmJ4LmA4Lib4LmH4LiZICLguKvguLHguKfguILguYnguK0iIOC4l+C4suC4h+C4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jOC4l+C4teC5iOC4quC4seC5ieC4meC5geC4peC4sOC5gOC4m+C5h+C4meC4oeC4suC4leC4o+C4kOC4suC4meC4l+C4teC5iOC4quC4uOC4lAoKICAgICAgICDguJXguLHguKfguK3guKLguYjguLLguIc6CiAgICAgICAgLSDguITguLPguJbguLLguKE6ICLguJzguKXguKXguLHguJ7guJjguYzguILguK3guIcgJDEyLjUgXFxkaXYgMC41JCDguITguLfguK3guYDguJfguYjguLLguYPguJQiIC0+IOC4q+C4seC4p+C4guC5ieC4rTogIuC4geC4suC4o+C4q+C4suC4o+C4l+C4qOC4meC4tOC4ouC4oSIKICAgICAgICAtIOC4hOC4s+C4luC4suC4oTogIuC4iOC4h+C4q+C4siDguIQu4LijLuC4mS4g4LiC4Lit4LiHIDEyIOC5geC4peC4sCAxOCIgLT4g4Lir4Lix4Lin4LiC4LmJ4LitOiAi4LiB4Liy4Lij4Lir4LiyIOC4hC7guKMu4LiZLiIKICAgICAgICAtIOC4hOC4s+C4luC4suC4oTogIiRcXGZyYWN7MX17Mn0gKyBcXGZyYWN7MX17NH0kIOC4oeC4teC4hOC5iOC4suC5gOC4l+C5iOC4suC5g+C4lCIgLT4g4Lir4Lix4Lin4LiC4LmJ4LitOiAi4LiB4Liy4Lij4Lia4Lin4LiB4LmA4Lio4Lip4Liq4LmI4Lin4LiZIgoKICAgICAgICDguITguLPguJbguLLguKHguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYw6ICIke3F1ZXN0aW9uVGV4dH0iCgogICAgICAgIOC5g+C4q+C5ieC4leC4reC4muC4geC4peC4seC4muC4oeC4suC5gOC4m+C5h+C4mSBKU09OIG9iamVjdCDguJfguLXguYjguKHguLUga2V5ICJzdGFuZGFyZFRvcGljIiDguYDguJfguYjguLLguJnguLHguYnguJkKICAgIGA7CiAgICBjb25zdCBzY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHN0YW5kYXJkVG9waWM6IHsgdHlwZTogIlNUUklORyIgfSB9LCByZXF1aXJlZDogWyJzdGFuZGFyZFRvcGljIl0gfTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShwcm9tcHQsIHNjaGVtYSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5zdGFuZGFyZFRvcGljOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gZ2V0IHN0YW5kYXJkaXplZCB0b3BpYzoiLCBlcnJvcik7CiAgICAgICAgLy8g4Lir4Liy4LiB4Lil4LmJ4Lih4LmA4Lir4Lil4LinIOC5g+C4q+C5ieC5g+C4iuC5ieC4hOC4s+C4luC4suC4oeC5gOC4lOC4tOC4oeC5gOC4m+C5h+C4meC4q+C4seC4p+C4guC5ieC4reC5hOC4m+C4geC5iOC4reC4mSAoRmFsbGJhY2spCiAgICAgICAgcmV0dXJuIHF1ZXN0aW9uVGV4dDsKICAgIH0KfQoKLyoqCiAqIFvguYDguKfguK3guKPguYzguIrguLHguJnguYHguIHguYnguYTguILguKXguYjguLLguKrguLjguJQgLSDguYTguKHguYjguJXguYnguK3guIfguKLguLfguJnguKLguLHguJldCiAqIOC4iOC4seC4lOC4geC4suC4o+C4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4ieC4muC4seC4muC4h+C5iOC4suC4oiDguYLguJTguKLguYHguKrguJTguIfguKrguJbguLLguJnguLDguYPguJnguKvguJnguYnguLIgIuC4nOC4peC4peC4seC4nuC4mOC5jCIg4LiX4Lix4LiZ4LiX4Li1CiAqIEBwYXJhbSB7c3RyaW5nfSBvcmlnaW5hbFF1aXpJZCAtIElEIOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4leC5ieC4meC4ieC4muC4seC4mgogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVFYXN5VmVyc2lvblF1aXoob3JpZ2luYWxRdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlRWFzeVBhcmFsbGVsUXVpeihvcmlnaW5hbFF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKLyoqCiAqIOC5gOC4o+C4teC4ouC4geC5g+C4iuC5iSBBSSDguYDguJ7guLfguYjguK3guKrguKPguYnguLLguIfguIrguLjguJTguITguLPguJbguLLguKHguKrguLPguKvguKPguLHguJrguJ3guLbguIHguJ3guJkgKERyaWxsIFNldCkKICogQHBhcmFtIHtzdHJpbmd9IHRvcGljIC0g4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4LijCiAqIEByZXR1cm5zIHtQcm9taXNlPG9iamVjdD59IOC4guC5ieC4reC4oeC4ueC4peC4iuC4uOC4lOC5geC4muC4muC4neC4tuC4geC4l+C4teC5iCBBSSDguKrguKPguYnguLLguIcKICovCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUHJhY3RpY2VRdWVzdGlvbnModG9waWMpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8Ci8qKgogKiDguYHguKrguJTguIcgTW9kYWwg4LmB4Lic4LiZ4LiB4Liy4Lij4Liq4Lit4LiZ4LiI4Liy4LiB4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinCiAqIEBwYXJhbSB7b2JqZWN0fSBsZXNzb25QbGFuIOC4guC5ieC4reC4oeC4ueC4peC5geC4nOC4meC4geC4suC4o+C4quC4reC4mQogKiBAcGFyYW0ge29iamVjdH0gcXVpekRhdGEg4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCiAqLwpmdW5jdGlvbiBkaXNwbGF5TGVzc29uUGxhbihsZXNzb25QbGFuLCBxdWl6RGF0YSkgewogICAgY29uc3QgbGVzc29uSHRtbCA9IGAKICAgICAgICA8aDMgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIG1iLTQgdGV4dC1ncmF5LTgwMCI+4LmB4Lic4LiZ4LiB4Liy4Lij4Liq4Lit4LiZ4LmB4LiZ4Liw4LiZ4Liz4Liq4Liz4Lir4Lij4Lix4Lia4LmA4Lij4Li34LmI4Lit4LiHOiAke3F1aXpEYXRhLnRvcGljfTwvaDM+CiAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS02IHRleHQtbGVmdCB0ZXh0LWJhc2UiPgogICAgICAgICAgICA8ZGl2PjxoNCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXJlZC04MDAgYm9yZGVyLWIgcGItMSBtYi0yIj7guIjguLjguJTguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKLguLHguIfguYTguKHguYjguYDguILguYnguLLguYPguIggKExlYXJuaW5nIEdhcHMpPC9oND48dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSB0ZXh0LXJlZC05MDAiPiR7bGVzc29uUGxhbi5sZWFybmluZ0dhcHMubWFwKGdhcCA9PiBgPGxpPiR7Z2FwfTwvbGk+YCkuam9pbignJyl9PC91bD48L2Rpdj4KICAgICAgICAgICAgPGRpdj48aDQgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTgwMCBib3JkZXItYiBwYi0xIG1iLTIiPuC5geC4meC4p+C4l+C4suC4h+C4geC4suC4o+C4quC4reC4meC5geC4peC4sOC5gOC4meC4t+C5ieC4reC4q+C4suC4l+C4muC4l+C4p+C4mTwvaDQ+PHAgY2xhc3M9InRleHQtZ3JheS03MDAgd2hpdGVzcGFjZS1wcmUtd3JhcCI+JHtsZXNzb25QbGFuLnRlYWNoaW5nQ29udGVudH08L3A+PC9kaXY+CiAgICAgICAgICAgIDxkaXY+PGg0IGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JlZW4tODAwIGJvcmRlci1iIHBiLTEgbWItMiI+4LmC4LiI4LiX4Lii4LmM4LiV4Lix4Lin4Lit4Lii4LmI4Liy4LiH4Liq4Liz4Lir4Lij4Lix4Lia4Lid4Li24LiB4Lid4LiZPC9oND48ZGl2IGNsYXNzPSJzcGFjZS15LTMiPiR7bGVzc29uUGxhbi5wcmFjdGljZVByb2JsZW1zLm1hcChwID0+IGA8ZGl2IGNsYXNzPSJib3JkZXItbC00IGJvcmRlci1ncmVlbi0yMDAgcGwtMyI+PHA+PHN0cm9uZz7guYLguIjguJfguKLguYw6PC9zdHJvbmc+ICR7cC5xdWVzdGlvbn08L3A+PHA+PHN0cm9uZz7guYDguInguKXguKI6PC9zdHJvbmc+ICR7cC5zb2x1dGlvbn08L3A+PC9kaXY+YCkuam9pbignJyl9PC9kaXY+PC9kaXY+CiAgICAgICAgPC9kaXY+YDsKICAgIAogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1wbGFuLXRpdGxlJykudGV4dENvbnRlbnQgPSBg4LmB4Lic4LiZ4LiB4Liy4Lij4Liq4Lit4LiZOiAke3F1aXpEYXRhLnRvcGljfWA7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tY29udGVudCcpLmlubmVySFRNTCA9IGxlc3Nvbkh0bWw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsJCiAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoKTsKfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKLyoqCiAqIOC5geC4quC4lOC4h+C4nOC4peC4q+C4meC5ieC4suC4iOC4reC5guC4q+C4oeC4lOC4neC4tuC4geC4neC4meC4l+C4seC4geC4qeC4sOC4l+C4teC4peC4sOC4guC5ieC4rQogKiBAcGFyYW0ge29iamVjdH0gZHJpbGxEYXRhIC0g4LiC4LmJ4Lit4Lih4Li54Lil4LiK4Li44LiU4LmB4Lia4Lia4Lid4Li24LiB4LiI4Liy4LiBIEFJCiAqLwpmdW5jdGlvbiBkaXNwbGF5U2tpbGxQcmFjdGljZURyaWxsKGRyaWxsRGF0YSkgewogICAgbGV0IGN1cnJlbnREcmlsbEluZGV4ID0gMDsKICAgIGNvbnN0IHF1ZXN0aW9ucyA9IGRyaWxsRGF0YS5xdWVzdGlvbnM7CgogICAgY29uc3QgcmVuZGVyRHJpbGxRdWVzdGlvbiA9ICgpID0+IHsKICAgICAgICBjb25zdCBxID0gcXVlc3Rpb25zW2N1cnJlbnREcmlsbEluZGV4XTsKICAgICAgICBjb25zdCBodG1sID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTQiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCB0ZXh0LWNlbnRlciI+4Lid4Li24LiB4Lid4LiZ4LiC4LmJ4Lit4LiX4Li14LmIICR7Y3VycmVudERyaWxsSW5kZXggKyAxfSAvICR7cXVlc3Rpb25zLmxlbmd0aH08L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJteS00IHAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCBtYi0zIj4ke3EucXVlc3Rpb25UZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJkcmlsbC1vcHRpb25zIiBjbGFzcz0ic3BhY2UteS0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iZHJpbGxfb3B0XyR7aX0iIG5hbWU9ImRyaWxsX2Fuc3dlciIgdmFsdWU9IiR7aX0iIGNsYXNzPSJtci0yIGFjY2VudC1pbmRpZ28tNjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJkcmlsbF9vcHRfJHtpfSI+JHtvcHR9PC9sYWJlbD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBpZD0iZHJpbGwtZmVlZGJhY2siIGNsYXNzPSJoaWRkZW4gbXktNCBwLTMgcm91bmRlZC1sZyI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgbXQtNCI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iaGludC1idG4iIGNsYXNzPSJiZy1ncmF5LTIwMCB0ZXh0LWdyYXktNzAwIHB5LTIgcHgtNCByb3VuZGVkLWxnIGhvdmVyOmJnLWdyYXktMzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1saWdodGJ1bGIiPjwvaT4g4LiC4Lit4LiE4Liz4LmD4Lia4LmJCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iY2hlY2stYW5zd2VyLWJ0biIgY2xhc3M9ImJnLWJsdWUtNjAwIHRleHQtd2hpdGUgcHktMiBweC01IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1ibHVlLTcwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4leC4o+C4p+C4iOC4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im5leHQtZHJpbGwtYnRuIiBjbGFzcz0iaGlkZGVuIGJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctZ3JlZW4tNzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAg4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgOwogICAgICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFF1aXpBcmVhXSk7CgogICAgICAgIC8vIC0tLSDguYDguJ7guLTguYjguKEgRXZlbnQgTGlzdGVuZXJzIOC4quC4s+C4q+C4o+C4seC4muC4m+C4uOC5iOC4oeC5g+C4meC5guC4q+C4oeC4lOC4neC4tuC4geC4neC4mSAtLS0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGludC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgIGNvbnN0IGhpbnQgPSBhd2FpdCBnZXRIaW50Rm9yUXVlc3Rpb24ocS5xdWVzdGlvblRleHQpOwogICAgICAgICAgICAgc2hvd01lc3NhZ2UoaGludCk7IC8vIOC5g+C4iuC5iSBtb2RhbCDguYDguJTguLTguKHguYHguKrguJTguIfguITguLPguYPguJrguYkKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoZWNrLWFuc3dlci1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgdXNlckFuc3dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ImRyaWxsX2Fuc3dlciJdOmNoZWNrZWQnKTsKICAgICAgICAgICAgaWYgKCF1c2VyQW5zd2VyKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4Lia4LiB4LmI4Lit4LiZ4LiE4Lij4Lix4LiaIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGZlZWRiYWNrRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZHJpbGwtZmVlZGJhY2snKTsKICAgICAgICAgICAgY29uc3QgaXNDb3JyZWN0ID0gcGFyc2VJbnQodXNlckFuc3dlci52YWx1ZSkgPT09IHEuY29ycmVjdEFuc3dlckluZGV4OwoKICAgICAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgZmVlZGJhY2tFbC5jbGFzc05hbWUgPSAnbXktNCBwLTMgcm91bmRlZC1sZyBiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnOwogICAgICAgICAgICAgICAgZmVlZGJhY2tFbC5pbm5lckhUTUwgPSBgPHN0cm9uZz48aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPiDguJbguLnguIHguJXguYnguK3guIfguITguKPguLHguJohPC9zdHJvbmc+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZlZWRiYWNrRWwuY2xhc3NOYW1lID0gJ215LTQgcC0zIHJvdW5kZWQtbGcgYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAnOwogICAgICAgICAgICAgICAgZmVlZGJhY2tFbC5pbm5lckhUTUwgPSBgPHN0cm9uZz48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPiDguKLguLHguIfguYTguKHguYjguJbguLnguIHguJnguLA8L3N0cm9uZz5gOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZlZWRiYWNrRWwuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgkJCWlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbZmVlZGJhY2tFbF0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LiL4LmI4Lit4LiZL+C5geC4quC4lOC4h+C4m+C4uOC5iOC4oQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hlY2stYW5zd2VyLWJ0bicpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGludC1idG4nKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQtZHJpbGwtYnRuJykuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LWRyaWxsLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBjdXJyZW50RHJpbGxJbmRleCsrOwogICAgICAgICAgICBpZiAoY3VycmVudERyaWxsSW5kZXggPCBxdWVzdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICByZW5kZXJEcmlsbFF1ZXN0aW9uKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguIjguJrguIHguLLguKPguJ3guLbguIHguJ3guJkKICAgICAgICAgICAgICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC04IGJnLWluZGlnby0xMDAgcm91bmRlZC1sZyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYXdhcmQgdGV4dC01eGwgdGV4dC1pbmRpZ28tNTAwIG1iLTQiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQiPuC4neC4tuC4geC4neC4meC4quC4s+C5gOC4o+C5h+C4iCE8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMiI+4Lii4Lit4LiU4LmA4Lii4Li14LmI4Lii4Lih4Lih4Liy4LiBISDguKvguJnguLnguYTguJTguYnguJfguJrguJfguKfguJnguYHguKXguLDguJ3guLbguIHguJ3guJnguYDguJ7guLTguYjguKHguYDguJXguLTguKHguYHguKXguYnguKc8YnI+4LiB4Lil4Lix4Lia4LmE4Lib4LiX4Li14LmI4Lir4LiZ4LmJ4Liy4Lic4Lil4Liq4Lit4Lia4LmA4Lie4Li34LmI4Lit4Lid4Li24LiB4Lid4LiZ4Lir4Lix4Lin4LiC4LmJ4Lit4Lit4Li34LmI4LiZ4LiV4LmI4Lit4LmE4LiU4LmJ4LmA4Lil4LiiPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJiYWNrLXRvLXJlc3VsdHMtYnRuIiBjbGFzcz0ibXQtNCBiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTIgcHgtNSByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQiPuC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4suC4nOC4peC4quC4reC4mjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLXJlc3VsdHMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH07CgogICAgcmVuZGVyRHJpbGxRdWVzdGlvbigpOyAvLyDguYDguKPguLTguYjguKHguYHguKrguJTguIfguJzguKXguILguYnguK3guYHguKPguIEKfQoKLyoqCiAqIOC5gOC4o+C4teC4ouC4gSBBSSDguYDguJ7guLfguYjguK3guKrguKPguYnguLLguIfguITguLPguYPguJrguYnguKrguLPguKvguKPguLHguJrguYLguIjguJfguKLguYwKICogQHBhcmFtIHtzdHJpbmd9IHF1ZXN0aW9uVGV4dCAtIOC5guC4iOC4l+C4ouC5jOC4hOC4s+C4luC4suC4oeC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4hOC4s+C5g+C4muC5iQogKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSDguITguLPguYPguJrguYnguIjguLLguIEgQUkKICovCmFzeW5jIGZ1bmN0aW9uIGdldEhpbnRGb3JRdWVzdGlvbihxdWVzdGlvblRleHQpIHsKICAgIGNvbnN0IHByb21wdCA9IGDguKrguLPguKvguKPguLHguJrguYLguIjguJfguKLguYzguITguJPguLTguJXguKjguLLguKrguJXguKPguYzguJfguLXguYjguKfguYjguLIgIiR7cXVlc3Rpb25UZXh0fSIsIOC4iuC5iOC4p+C4ouC5g+C4q+C5ieC4hOC4s+C5g+C4muC5ieC4quC4seC5ieC4meC5hiAxLTIg4Lib4Lij4Liw4LmC4Lii4LiE4LmA4Lie4Li34LmI4Lit4LmB4LiZ4Liw4LmB4LiZ4Lin4LiX4Liy4LiH4LiB4Liy4Lij4LiE4Li04LiUIOC5guC4lOC4ouC4q+C5ieC4suC4oeC5gOC4ieC4peC4ouC4hOC4s+C4leC4reC4muC5guC4lOC4ouC4leC4o+C4h+C5gOC4lOC5h+C4lOC4guC4suC4lGA7CiAgICBjb25zdCBzY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IGhpbnQ6IHsgdHlwZTogIlNUUklORyIgfSB9LCByZXF1aXJlZDogWyJoaW50Il0gfTsKICAgIAogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpOwogICAgICAgIHJldHVybiByZXN1bHQuaGludDsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGdldCBoaW50OiIsIGVycm9yKTsKICAgICAgICByZXR1cm4gIuC4guC4reC4reC4oOC4seC4oiwg4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LmD4Lia4LmJ4LmE4LiU4LmJ4LmD4LiZ4LiC4LiT4Liw4LiZ4Li14LmJIjsKICAgIH0KfQoJCQoJCS8qKgogKiDguJTguLbguIfguILguYnguK3guITguKfguLLguKHguJfguLHguYnguIfguKvguKHguJTguIjguLLguIHguYTguJ/guKXguYwgUERGCiAqIEBwYXJhbSB7RmlsZX0gZmlsZSAtIOC5hOC4n+C4peC5jCBQREYg4LiX4Li14LmI4Lic4Li54LmJ4LmD4LiK4LmJ4Lit4Lix4Lib4LmC4Lir4Lil4LiUCiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IC0gUHJvbWlzZSDguJfguLXguYjguIjguLAgcmVzb2x2ZSDguYDguJvguYfguJnguILguYnguK3guITguKfguLLguKHguJfguLHguYnguIfguKvguKHguJTguYPguJnguYTguJ/guKXguYwKICovCmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RUZXh0RnJvbVBkZihmaWxlKSB7CiAgICAvLyDguJXguLHguYnguIfguITguYjguLIgd29ya2VyIHNvdXJjZSDguKrguLPguKvguKPguLHguJogcGRmLmpzCiAgICBwZGZqc0xpYi5HbG9iYWxXb3JrZXJPcHRpb25zLndvcmtlclNyYyA9IGBodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9wZGYuanMvMi4xMS4zMzgvcGRmLndvcmtlci5taW4uanNgOwoKICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgZmlsZS5hcnJheUJ1ZmZlcigpOwogICAgY29uc3QgcGRmID0gYXdhaXQgcGRmanNMaWIuZ2V0RG9jdW1lbnQoYXJyYXlCdWZmZXIpLnByb21pc2U7CiAgICBjb25zdCBudW1QYWdlcyA9IHBkZi5udW1QYWdlczsKICAgIGxldCBmdWxsVGV4dCA9ICcnOwoKICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IG51bVBhZ2VzOyBpKyspIHsKICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgcGRmLmdldFBhZ2UoaSk7CiAgICAgICAgY29uc3QgdGV4dENvbnRlbnQgPSBhd2FpdCBwYWdlLmdldFRleHRDb250ZW50KCk7CiAgICAgICAgY29uc3QgcGFnZVRleHQgPSB0ZXh0Q29udGVudC5pdGVtcy5tYXAoaXRlbSA9PiBpdGVtLnN0cikuam9pbignICcpOwogICAgICAgIGZ1bGxUZXh0ICs9IHBhZ2VUZXh0ICsgJ1xuXG4nOyAvLyDguYDguJ7guLTguYjguKHguIHguLLguKPguYDguKfguYnguJnguJrguKPguKPguJfguLHguJTguKPguLDguKvguKfguYjguLLguIfguKvguJnguYnguLIKICAgIH0KCiAgICByZXR1cm4gZnVsbFRleHQ7Cn0KCi8vIOKWvOKWvOKWvCBTVEFSVDog4LmC4LiE4LmJ4LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4Liq4Liz4Lir4Lij4Lix4LiaICLguKrguKPguYnguLLguIfguYHguKLguIHguJXguLLguKHguYDguJnguLfguYnguK3guKvguLIiIOKWvOKWvOKWvAoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4Lir4Lix4Lin4LiC4LmJ4Lit4LiX4Li14LmI4LiU4Li24LiH4Lih4Liy4LiI4Liy4LiBIEJsdWVwcmludApsZXQgZXh0cmFjdGVkQmx1ZXByaW50VG9waWNzID0gW107CgovLyDilrzilrzilrwg4LiE4Lix4LiU4Lil4Lit4LiB4LmC4LiE4LmJ4LiU4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiZ4Li14LmJ4LmE4Lib4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGFuYWx5emVCbHVlcHJpbnRGb3JUb3BpY3Mg4LmA4LiU4Li04LihIOKWvOKWvOKWvAoKYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZUJsdWVwcmludEZvclRvcGljcyhwZGZUZXh0KSB7CiAgICBjb25zdCBvcHRpb25zQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWVwcmludC1vcHRpb25zLWNvbnRhaW5lcicpOwogICAgY29uc3QgdG9waWNzTGlzdERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdibHVlcHJpbnQtdG9waWNzLWxpc3QnKTsKICAgIGNvbnN0IHNhdmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1ibHVlcHJpbnQtYXMtcHJvamVjdC1idG4nKTsKICAgIAogICAgb3B0aW9uc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHRvcGljc0xpc3REaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIGl0YWxpYyI+QUkg4LiB4Liz4Lil4Lix4LiH4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiBIEJsdWVwcmludC4uLjwvcD4nOwogICAgc2F2ZUJ0bi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHByb21wdCA9IGDguKfguLTguYDguITguKPguLLguLDguKvguYzguILguYnguK3guITguKfguLLguKEgVGVzdCBCbHVlcHJpbnQg4Lin4Li04LiK4Liy4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmM4LiZ4Li14LmJOiAiJHtwZGZUZXh0fSIuIOC4oOC4suC4o+C4geC4tOC4iOC4hOC4t+C4rTogMS7guKPguLDguJrguLjguKPguLDguJTguLHguJrguIrguLHguYnguJkgMi7guKrguIHguLHguJTguYLguITguKPguIfguKrguKPguYnguLLguIfguYDguJnguLfguYnguK3guKvguLLguJfguLHguYnguIfguKvguKHguJTguK3guK3guIHguKHguLLguYPguJnguKPguLnguJvguYHguJrguJogbmVzdGVkIEpTT04g4LiX4Li14LmI4LiK4Lix4LiU4LmA4LiI4LiZIDMu4LmB4LiB4LmJ4LmE4LiC4LiE4Liz4Lig4Liy4Lip4Liy4LmE4LiX4Lii4LiX4Li14LmI4Lic4Li04LiU4LmA4Lie4Li14LmJ4Lii4LiZIDQu4Liq4Lij4Li44Lib4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4Lit4Lii4LmI4Lit4Lii4LmD4Lir4LmJ4Liq4Lix4LmJ4LiZ4LiB4Lij4Liw4LiK4Lix4LiaLiBKU09OIG91dHB1dCDguJXguYnguK3guIfguKHguLXguYLguITguKPguIfguKrguKPguYnguLLguIc6IHsgZ3JhZGVMZXZlbDogc3RyaW5nLCBjdXJyaWN1bHVtOiBbIHsgc2FyYTogc3RyaW5nLCBtYWluVG9waWNzOiBbIHsgdG9waWNOYW1lOiBzdHJpbmcsIHN1YlRvcGljczogW3N0cmluZ10gfSBdIH0gXSB9LiDguJXguLHguKfguK3guKLguYjguLLguIc6ICfguKrguLLguKPguLDguJfguLXguYggMTog4LiI4Liz4LiZ4Lin4LiZ4LmB4Lil4Liw4Lie4Li14LiK4LiE4LiT4Li04LiVJyDguITguLfguK0gJ3NhcmEnLiAn4LmA4Lin4Lil4LiyJyDguITguLfguK0gJ3RvcGljTmFtZScuICfguIHguLLguKPguK3guYjguLLguJnguJXguLLguKPguLLguIfguYDguKfguKXguLInIOC4hOC4t+C4rSAnc3ViVG9waWMnYDsKICAgICAgICAKICAgICAgICBjb25zdCBzY2hlbWEgPSB7CiAgICAgICAgICAgIHR5cGU6ICJPQkpFQ1QiLAogICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAiZ3JhZGVMZXZlbCI6IHsgInR5cGUiOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgImN1cnJpY3VsdW0iOiB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogIkFSUkFZIiwKICAgICAgICAgICAgICAgICAgICBpdGVtczogewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInNhcmEiOiB7ICJ0eXBlIjogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJtYWluVG9waWNzIjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJBUlJBWSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0b3BpY05hbWUiOiB7ICJ0eXBlIjogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzdWJUb3BpY3MiOiB7ICJ0eXBlIjogIkFSUkFZIiwgIml0ZW1zIjogeyAidHlwZSI6ICJTVFJJTkciIH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJ0b3BpY05hbWUiLCAic3ViVG9waWNzIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbInNhcmEiLCAibWFpblRvcGljcyJdCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICByZXF1aXJlZDogWyJncmFkZUxldmVsIiwgImN1cnJpY3VsdW0iXQogICAgICAgIH07CgogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShwcm9tcHQsIHNjaGVtYSk7CiAgICAgICAgCiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuY3VycmljdWx1bSkgewogICAgICAgICAgICBleHRyYWN0ZWRCbHVlcHJpbnREYXRhID0gcmVzdWx0OyAvLyDguYDguIHguYfguJrguILguYnguK3guKHguLnguKXguJfguLXguYjguKfguLTguYDguITguKPguLLguLDguKvguYzguYTguJTguYkKICAgICAgICAgICAgcmVuZGVyQmx1ZXByaW50VG9waWNzKHJlc3VsdCk7IAogICAgICAgICAgICBzYXZlQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyAvLyDguYHguKrguJTguIfguJvguLjguYjguKHguJrguLHguJnguJfguLbguIEKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFJIOC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC5geC4ouC4geC5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4h+C4q+C4seC4p+C4guC5ieC4reC5hOC4lOC5iSIpOwogICAgICAgIH0KCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGFuYWx5emluZyBibHVlcHJpbnQgdG9waWNzOiIsIGVycm9yKTsKICAgICAgICB0b3BpY3NMaXN0RGl2LmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1yZWQtNTAwIj7guYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYzguKvguLHguKfguILguYnguK08L3A+JzsKICAgIH0KfSAvLyA8LS0g4Lib4Li14LiB4LiB4Liy4LiV4Lix4Lin4LiZ4Li14LmJ4LiE4Li34Lit4LiV4Lix4Lin4LiX4Li14LmI4LiZ4LmI4Liy4LiI4Liw4Lir4Liy4Lii4LmE4Lib4LiE4Lij4Lix4LiaIOC4l+C4s+C5g+C4q+C5ieC5gOC4geC4tOC4lCBFcnJvcgoKZnVuY3Rpb24gcmVuZGVyQmx1ZXByaW50VG9waWNzKGJsdWVwcmludERhdGEpIHsKICAgIGNvbnN0IHRvcGljc0xpc3REaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmx1ZXByaW50LXRvcGljcy1saXN0Jyk7CiAgICBjb25zdCBncmFkZUxldmVsID0gYmx1ZXByaW50RGF0YS5ncmFkZUxldmVsOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oeC4geC4suC4o+C5geC4quC4lOC4h+C4o+C4sOC4lOC4seC4muC4iuC4seC5ieC4meC4l+C4teC5iOC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC5hOC4lOC5iQogICAgY29uc3QgZ3JhZGVMZXZlbEhlYWRlciA9IGA8aDMgY2xhc3M9InRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgdGV4dC1sZyB0ZXh0LWdyYXktNzAwIG1iLTQiPuC4o+C4sOC4lOC4seC4muC4iuC4seC5ieC4meC4l+C4teC5iOC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC5hOC4lOC5iTogJHtncmFkZUxldmVsfTwvaDM+YDsKICAgIGxldCBjb250ZW50SHRtbCA9ICcnOwoKICAgIGJsdWVwcmludERhdGEuY3VycmljdWx1bS5mb3JFYWNoKHNhcmEgPT4gewogICAgICAgIGNvbnRlbnRIdG1sICs9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0icC00IGJvcmRlciByb3VuZGVkLWxnIGJnLWdyYXktNTAgc2hhZG93LXNtIG1iLTQiPgogICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJmb250LWJvbGQgdGV4dC14bCB0ZXh0LWJsdWUtODAwIG1iLTMiPiR7c2FyYS5zYXJhfTwvaDQ+YDsKCiAgICAgICAgc2FyYS5tYWluVG9waWNzLmZvckVhY2gobWFpblRvcGljID0+IHsKICAgICAgICAgICAgY29udGVudEh0bWwgKz0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWwtNCBtYi0zIj4KICAgICAgICAgICAgICAgICAgICA8aDUgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1sZyB0ZXh0LWdyYXktNzAwIG1iLTIiPiR7bWFpblRvcGljLnRvcGljTmFtZX08L2g1PgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktMSBwbC00IGJvcmRlci1sLTIgYm9yZGVyLWdyYXktMjAwIj5gOwoKICAgICAgICAgICAgbWFpblRvcGljLnN1YlRvcGljcy5mb3JFYWNoKHN1YlRvcGljID0+IHsKICAgICAgICAgICAgICAgIC8vICoqKiDguIjguLjguJTguKrguLPguITguLHguI0gKioqCiAgICAgICAgICAgICAgICAvLyDguYDguKPguLLguIjguLDguYPguKrguYggb25jbGljayDguYDguJ7guLfguYjguK3guYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJkgIuC4leC4seC4p+C4geC4peC4suC4hyIg4LiX4Li14LmI4LiI4Liw4Liq4Lij4LmJ4Liy4LiH4LmD4LiZIFN0ZXAgNQogICAgICAgICAgICAgICAgLy8g4Lie4Lij4LmJ4Lit4Lih4Liq4LmI4LiHICLguKvguLHguKfguILguYnguK3guKLguYjguK3guKIiIOC5geC4peC4sCAi4Lij4Liw4LiU4Lix4Lia4LiK4Lix4LmJ4LiZIiDguYTguJvguJTguYnguKfguKIKY29udGVudEh0bWwgKz0gYAogICAgPGRpdiBjbGFzcz0icC0yIHJvdW5kZWQtbWQgaG92ZXI6YmctZ3JheS0xMDAgZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBpdGVtcy1zdGFydCBzbTppdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC0yIj4KCiAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCBmbGV4LWdyb3cgY3Vyc29yLXBvaW50ZXIiIG9uY2xpY2s9ImhhbmRsZUdlbmVyYXRlQW5kU2hvd0xlc3NvbignJHtzdWJUb3BpYy5yZXBsYWNlKC8nL2csICJcXCciKX0nLCAnJHtncmFkZUxldmVsLnJlcGxhY2UoLycvZywgIlxcJyIpfScpIj4KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1ib29rLW9wZW4gdGV4dC1ibHVlLTUwMCBtci0yIj48L2k+ICR7c3ViVG9waWN9CiAgICAgICAgPC9wPgoKICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBmbGV4LXNocmluay0wIj4KPGJ1dHRvbiBjbGFzcz0idGV4dC1pbmRpZ28tODAwIGJnLWluZGlnby0xMDAgaG92ZXI6YmctaW5kaWdvLTIwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMS41IHB4LTMgcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMS41IgogICAgICAgIG9uY2xpY2s9ImhhbmRsZUdlbmVyYXRlUXVpekZyb21CbHVlcHJpbnRUb3BpYygnJHtzdWJUb3BpYy5yZXBsYWNlKC8nL2csICJcXCciKX0nKSI+CiAgICA8aSBjbGFzcz0iZmFzIGZhLWZpbGUtYWx0Ij48L2k+4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCjwvYnV0dG9uPgogICAgICAgIDwvZGl2PgoKICAgIDwvZGl2PgpgOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbnRlbnRIdG1sICs9IGA8L2Rpdj48L2Rpdj5gOwogICAgICAgIH0pOwogICAgICAgIGNvbnRlbnRIdG1sICs9IGA8L2Rpdj5gOwogICAgfSk7CiAgICAKICAgIHRvcGljc0xpc3REaXYuaW5uZXJIVE1MID0gZ3JhZGVMZXZlbEhlYWRlciArIGNvbnRlbnRIdG1sOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZVRlYWNoaW5nQ29udGVudChzZWxlY3RlZFRvcGljKSAgeyAvKiBSZW1vdmVkICovIH0gCgovKioKICog4LmB4Liq4LiU4LiH4Lic4Lil4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lit4LiZ4LiX4Li14LmIIEFJIOC4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4meC5g+C4mSBNb2RhbAogKiBAcGFyYW0ge29iamVjdH0gY29udGVudCAtIOC4guC5ieC4reC4oeC4ueC4peC5gOC4meC4t+C5ieC4reC4q+C4suC4l+C4teC5iOC5hOC4lOC5ieC4iOC4suC4gSBBSQogKiBAcGFyYW0ge3N0cmluZ30gdG9waWMgLSDguIrguLfguYjguK3guKvguLHguKfguILguYnguK0KICovCmZ1bmN0aW9uIGRpc3BsYXlUZWFjaGluZ0NvbnRlbnQoY29udGVudCwgdG9waWMpIHsKICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGVzc29uLXBsYW4tY29udGVudCcpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlc3Nvbi1wbGFuLXRpdGxlJykudGV4dENvbnRlbnQgPSBg4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lit4LiZOiAke3RvcGljfWA7CgogICAgY29uc3QgaHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTggdGV4dC1sZWZ0IHRleHQtYmFzZSI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRlbnQtc2VjdGlvbiI+CiAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtaW5kaWdvLTgwMCBtYi0yIGJvcmRlci1iLTIgYm9yZGVyLWluZGlnby0yMDAgcGItMiI+8J+OryDguKrguKPguLjguJvguYHguJnguKfguITguLTguJTguKvguKXguLHguIEgKEtleSBDb25jZXB0cyk8L2gyPgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgdGV4dC1ncmF5LTgwMCBzcGFjZS15LTEgcGwtMiI+JHtjb250ZW50LmtleUNvbmNlcHRzLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9PC91bD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24iPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXJlZC04MDAgbWItMiBib3JkZXItYi0yIGJvcmRlci1yZWQtMjAwIHBiLTIiPuKaoO+4jyDguIjguLjguJTguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKHguLHguIHguJzguLTguJTguJ7guKXguLLguJQ8L2gyPgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgdGV4dC1ncmF5LTgwMCBzcGFjZS15LTEgcGwtMiI+JHtjb250ZW50LmNvbW1vbk1pc3Rha2VzLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9PC91bD4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250ZW50LXNlY3Rpb24iPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTgwMCBtYi0yIGJvcmRlci1iLTIgYm9yZGVyLWdyZWVuLTIwMCBwYi0yIj7inI3vuI8g4LmC4LiI4LiX4Lii4LmM4LiV4Lix4Lin4Lit4Lii4LmI4Liy4LiH4Lie4Lij4LmJ4Lit4Lih4Lin4Li04LiY4Li14LiX4LizPC9oMj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiI+JHtjb250ZW50LnN0ZXBCeVN0ZXBFeGFtcGxlcy5tYXAocCA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC0zIGJnLWdyZWVuLTUwIHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1ncmVlbi0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPuC5guC4iOC4l+C4ouC5jDo8L3N0cm9uZz4gJHtwLnF1ZXN0aW9ufTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPGhyIGNsYXNzPSJteS0yIGJvcmRlci1kYXNoZWQiPgogICAgICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPuC4p+C4tOC4mOC4teC4l+C4szo8L3N0cm9uZz48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IndoaXRlc3BhY2UtcHJlLXdyYXAgcGwtMiI+JHtwLnNvbHV0aW9ufTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYCkuam9pbignJyl9PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIj4KICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1ibHVlLTgwMCBtYi0yIGJvcmRlci1iLTIgYm9yZGVyLWJsdWUtMjAwIHBiLTIiPvCfkanigI3wn4+rIOC4hOC4s+C5geC4meC4sOC4meC4s+C4quC4s+C4q+C4o+C4seC4muC4hOC4o+C4uTwvaDI+CiAgICAgICAgICAgICAgICA8dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSB0ZXh0LWdyYXktODAwIHNwYWNlLXktMSBwbC0yIj4ke2NvbnRlbnQudGVhY2hlclRpcHMubWFwKGl0ZW0gPT4gYDxsaT4ke2l0ZW19PC9saT5gKS5qb2luKCcnKX08L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgY29udGVudENvbnRhaW5lci5pbm5lckhUTUwgPSBodG1sOwogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtjb250ZW50Q29udGFpbmVyXSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUXVpekZvclNpbmdsZVRvcGljKHNlbGVjdGVkVG9waWMpIHsKICAgIGNvbnNvbGUubG9nKGDguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguKrguLPguKvguKPguLHguJrguJXguLTguKfguYDguInguJ7guLLguLDguYDguKPguLfguYjguK3guIc6ICIke3NlbGVjdGVkVG9waWN9ImApOwoKICAgIGNvbnN0IHJlZmVyZW5jZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZmVyZW5jZS1wZGYtdXBsb2FkJyk7CiAgICBjb25zdCByZWZlcmVuY2VGaWxlID0gcmVmZXJlbmNlSW5wdXQuZmlsZXMubGVuZ3RoID4gMCA/IHJlZmVyZW5jZUlucHV0LmZpbGVzWzBdIDogbnVsbDsKICAgIGxldCByZWZlcmVuY2VQYXJ0cyA9IG51bGw7CgogICAgaWYgKHJlZmVyZW5jZUZpbGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCByZWZSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgICByZWZSZWFkZXIucmVhZEFzRGF0YVVSTChyZWZlcmVuY2VGaWxlKTsKICAgICAgICAgICAgY29uc3QgcmVmQmFzZTY0ID0gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgcmVmUmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVmUmVhZGVyLnJlc3VsdC5zcGxpdCgnLCcpWzFdKTsKICAgICAgICAgICAgICAgIHJlZlJlYWRlci5vbmVycm9yID0gKGVycm9yKSA9PiByZWplY3QoZXJyb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmVmZXJlbmNlUGFydHMgPSBbCiAgICAgICAgICAgICAgICB7IGlubGluZURhdGE6IHsgbWltZVR5cGU6IHJlZmVyZW5jZUZpbGUudHlwZSwgZGF0YTogcmVmQmFzZTY0IH0gfQogICAgICAgICAgICBdOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHJlYWRpbmcgcmVmZXJlbmNlIGZpbGUgZm9yIHNpbmdsZSB0b3BpYzoiLCBlcnJvcik7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguK3guYjguLLguJnguYTguJ/guKXguYzguK3guYnguLLguIfguK3guLTguIciKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguJ7guLTguYjguKEgdHJ1ZSDguYDguJvguYfguJkgcGFyYW1ldGVyIOC4quC4uOC4lOC4l+C5ieC4suC4ouC5gOC4nuC4t+C5iOC4reC4muC4seC4h+C4hOC4seC4muC5g+C4iuC5ieC4quC5hOC4leC4peC5jOC5guC4iOC4l+C4ouC5jOC4m+C4o+C4sOC4ouC4uOC4geC4leC5jAogICAgZ2VuZXJhdGVRdWl6KHNlbGVjdGVkVG9waWMsIG51bGwsIG51bGwsIHJlZmVyZW5jZVBhcnRzLCB0cnVlLCBudWxsLCBudWxsLCB0cnVlKTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVGcm9tQmx1ZXByaW50KHByZWJ1aWx0UGFydHMgPSBudWxsKSAgeyAvKiBSZW1vdmVkICovIH0gCgovLyDilrzilrzilrwg4LmA4Lie4Li04LmI4Lih4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmI4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZ4Liq4LmI4Lin4LiZIDxzY3JpcHQ+IOKWvOKWvOKWvAoKZnVuY3Rpb24gcHJvY2VlZFRvTmV4dFF1ZXN0aW9uKGFuc3dlckRhdGEpIHsKICAgIC8vIDEuIOC5gOC4geC5h+C4muC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4quC4oeC4muC4ueC4o+C4k+C5jOC5geC4peC5ieC4pwogICAgc3R1ZGVudEFuc3dlcnNQZXJRdWVzdGlvbi5wdXNoKGFuc3dlckRhdGEpOwogICAgCiAgICAvLyAyLiDguYDguKXguLfguYjguK3guJnguYTguJvguKLguLHguIfguITguLPguJbguLLguKHguILguYnguK3guJbguLHguJTguYTguJsKICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4Kys7CgogICAgLy8gMy4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiX4Liz4LiE4Lij4Lia4LiX4Li44LiB4LiC4LmJ4Lit4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICBpZiAoY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zLmxlbmd0aCkgewogICAgICAgIC8vIOC4luC5ieC4suC4hOC4o+C4muC5geC4peC5ieC4pyDguYPguKvguYnguKrguKPguLjguJvguJzguKUKICAgICAgICBmaW5hbGl6ZVBlclF1ZXN0aW9uUXVpeigpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyDguJbguYnguLLguKLguLHguIfguYTguKHguYjguITguKPguJog4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4LiC4LmJ4Lit4LiW4Lix4LiU4LmE4LibCiAgICAgICAgcmVuZGVyUGVyUXVlc3Rpb25WaWV3KCk7CiAgICB9Cn0KCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4o+C5ieC4suC4hyBIVE1MIOC5geC4quC4lOC4h+C5gOC4h+C4tOC4meC4geC4reC4h+C4geC4peC4suC4hwpmdW5jdGlvbiBnZXRDZW50cmFsUG90SFRNTChnYW1lRGF0YSkgewogICAgLy8g4pa84pa84pa8IFvguYHguIHguYnguYTguIJdIOC4luC5ieC4suC5gOC4m+C5h+C4meC5guC4q+C4oeC4lOC4quC4reC4muC4iOC4o+C4tOC4hyAoZXhhbV9zdHJpY3QpIOC5g+C4q+C5ieC4i+C5iOC4reC4meC4l+C4seC4meC4l+C4tSDilrzilrzilrwKICAgIGlmIChnYW1lRGF0YS5nYW1lVmFyaWFudCA9PT0gJ2V4YW1fc3RyaWN0JykgcmV0dXJuICcnOwogICAgLy8g4pay4pay4payCgogICAgY29uc3QgcG90VmFsdWUgPSBnYW1lRGF0YS5jZW50cmFsUG90IHx8IDA7CiAgICBjb25zdCBpc01hcmtldE1vZGUgPSBnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyDguJbguYnguLLguYTguKHguYjguYTguJTguYnguYDguJvguLTguJTguYLguKvguKHguJTguJXguKXguLLguJTguKHguLfguJQg4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmB4Liq4LiU4LiHCiAgICBpZiAoIWlzTWFya2V0TW9kZSkgcmV0dXJuICcnOwoKICAgIC8vIOC4luC5ieC4suC4geC4reC4h+C4geC4peC4suC4h+C5gOC4m+C5h+C4mSAwIOC5geC4quC4lOC4h+C5geC4muC4muC5gOC4o+C4teC4ouC4muC5hgogICAgaWYgKHBvdFZhbHVlID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYmctYmxhY2svMjAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHRleHQtZ3JheS0zMDAgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNhY2stZG9sbGFyIj48L2k+CiAgICAgICAgICAgICAgICA8c3Bhbj7guIHguK3guIfguIHguKXguLLguIc6IDA8L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgLy8g4LiW4LmJ4Liy4Lih4Li14LmA4LiH4Li04LiZ4LmD4LiZ4LiB4Lit4LiH4LiB4Lil4Liy4LiHIOC5g+C4q+C5ieC5geC4quC4lOC4h+C5geC4muC4muC4quC4teC4l+C4reC4h+C5geC4peC4sOC4oeC4tSBBbmltYXRpb24KICAgIHJldHVybiBgCiAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYmctZ3JhZGllbnQtdG8tciBmcm9tLXllbGxvdy01MDAgdG8tYW1iZXItNjAwIHRleHQtd2hpdGUgcHgtNCBweS0xIHJvdW5kZWQtZnVsbCBib3JkZXItMiBib3JkZXIteWVsbG93LTIwMCBzaGFkb3ctbGcgc2hhZG93LXllbGxvdy01MDAvNTAgYW5pbWF0ZS1wdWxzZSB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IHRyYW5zaXRpb24tdHJhbnNmb3JtIGN1cnNvci1oZWxwIiB0aXRsZT0i4LmA4LiH4Li04LiZ4Lij4Liy4LiH4Lin4Lix4Lil4Liq4LmI4Lin4LiZ4LmA4LiB4Li04LiZ4LiI4Liy4LiB4Lij4Lit4Lia4LiX4Li14LmI4LmB4Lil4LmJ4LinIOC4iOC4sOC4luC4ueC4geC4meC4s+C4oeC4suC4q+C4suC4o+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C5ieC4nOC4ueC5ieC4iuC4meC4sOC5g+C4meC4o+C4reC4muC4meC4teC5iSEiPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNhY2stZG9sbGFyIHRleHQteGwgYW5pbWF0ZS1ib3VuY2UiPjwvaT4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWxnIGRyb3Atc2hhZG93LW1kIj7guIHguK3guIfguIHguKXguLLguIc6ICR7cG90VmFsdWUudG9Mb2NhbGVTdHJpbmcoKX08L3NwYW4+CiAgICAgICAgPC9kaXY+CiAgICBgOwp9CgpmdW5jdGlvbiByZW5kZXJBZG1pblN5bmNEYXNoYm9hcmQoZ2FtZURhdGEsIGlzQWRtaW4sIHF1ZXN0aW9uSW5kZXhUb1Nob3cpIHsKCmNvbnN0IHZhcmlhbnRDaGVjayA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIGlmICh2YXJpYW50Q2hlY2sgPT09ICdleGFtX3N0cmljdCcpIHsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGl2ZS1nYW1lLXZpZXcnKTsgCiAgICAgICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKCiAgICAgICAgY29uc3QgcGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICAgICAgY29uc3QgdG90YWxQbGF5ZXJzID0gcGxheWVycy5sZW5ndGg7CiAgICAgICAgCiAgICAgICAgLy8gMS4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04LiaIChTY29yZSAtIOC4iOC4s+C4meC4p+C4meC4guC5ieC4reC4l+C4teC5iOC4luC4ueC4gSkKICAgICAgICBjb25zdCBzY29yZXMgPSBwbGF5ZXJzLm1hcChwID0+IHAuc2NvcmUgfHwgMCk7CiAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBzY29yZXMubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnNjb3JlcykgOiAwOwogICAgICAgIGNvbnN0IG1pblNjb3JlID0gc2NvcmVzLmxlbmd0aCA+IDAgPyBNYXRoLm1pbiguLi5zY29yZXMpIDogMDsKICAgICAgICAKICAgICAgICBjb25zdCBtYXhDb3VudCA9IHBsYXllcnMuZmlsdGVyKHAgPT4gKHAuc2NvcmUgfHwgMCkgPT09IG1heFNjb3JlKS5sZW5ndGg7CiAgICAgICAgY29uc3QgbWluQ291bnQgPSBwbGF5ZXJzLmZpbHRlcihwID0+IChwLnNjb3JlIHx8IDApID09PSBtaW5TY29yZSkubGVuZ3RoOwoKICAgICAgICAvLyAyLiDguITguLPguJnguKfguJMgUG9pbnRzICjguITguLDguYHguJnguJnguKPguKfguKHguIjguLLguIHguKPguLDguJrguJrguYDguIHguKEpCiAgICAgICAgY29uc3QgYWxsUG9pbnRzID0gcGxheWVycy5tYXAocCA9PiBwLnRvdGFsUG9pbnRzIHx8IDApOwogICAgICAgIGNvbnN0IG1heFBvaW50cyA9IGFsbFBvaW50cy5sZW5ndGggPiAwID8gTWF0aC5tYXgoLi4uYWxsUG9pbnRzKSA6IDA7CiAgICAgICAgY29uc3QgbWluUG9pbnRzID0gYWxsUG9pbnRzLmxlbmd0aCA+IDAgPyBNYXRoLm1pbiguLi5hbGxQb2ludHMpIDogMDsKCiAgICAgICAgY29uc3QgbWF4UG9pbnRzQ291bnQgPSBwbGF5ZXJzLmZpbHRlcihwID0+IChwLnRvdGFsUG9pbnRzIHx8IDApID09PSBtYXhQb2ludHMpLmxlbmd0aDsKICAgICAgICBjb25zdCBtaW5Qb2ludHNDb3VudCA9IHBsYXllcnMuZmlsdGVyKHAgPT4gKHAudG90YWxQb2ludHMgfHwgMCkgPT09IG1pblBvaW50cykubGVuZ3RoOwoKICAgICAgICAvLyAzLiDguITguLPguJnguKfguJPguITguJnguYTguJTguYnguYDguJXguYfguKEKICAgICAgICBjb25zdCBjdXJyZW50UUlkeCA9IChnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCAhPT0gdW5kZWZpbmVkKSA/IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4IDogLTE7CiAgICAgICAgY29uc3QgcGVyZmVjdFNjb3JlcnNDb3VudCA9IHBsYXllcnMuZmlsdGVyKHAgPT4gewogICAgICAgICAgICBpZiAoIXAuYW5zd2VycyB8fCBwLmFuc3dlcnMubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGN1cnJlbnRRSWR4OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFucyA9IHAuYW5zd2Vycy5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBpKTsKICAgICAgICAgICAgICAgIGlmICghYW5zIHx8ICFhbnMuaXNDb3JyZWN0KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSkubGVuZ3RoOwoKICAgICAgICAvLyDguJvguLjguYjguKHguITguKfguJrguITguLjguKEKICAgICAgICBsZXQgYWRtaW5Db250cm9scyA9ICcnOwogICAgICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgICAgICBjb25zdCB0b3RhbFF1ZXN0aW9ucyA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoOwogICAgICAgICAgICAgY29uc3QgaXNMYXN0UXVlc3Rpb24gPSAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggKyAxKSA+PSB0b3RhbFF1ZXN0aW9uczsKCiAgICAgICAgICAgICBpZiAoaXNMYXN0UXVlc3Rpb24pIHsKICAgICAgICAgICAgICAgICBhZG1pbkNvbnRyb2xzID0gYAogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImV4YW0tZmluaXNoLWJ0biIgY2xhc3M9ImJnLXJlZC02MDAgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LXhsIHNoYWRvdy1sZyB0cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1IHRyYW5zaXRpb24tYWxsIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mbGFnLWNoZWNrZXJlZCBtci0yIj48L2k+IOC4iOC4muC4geC4suC4o+C4quC4reC4muC5geC4peC4sOC4quC4o+C4uOC4m+C4nOC4pQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIGFkbWluQ29udHJvbHMgPSBgCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZXhhbS1uZXh0LWJ0biIgY2xhc3M9ImJnLWJsdWUtNjAwIGhvdmVyOmJnLWJsdWUtNzAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgc2hhZG93LWxnIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgdHJhbnNpdGlvbi1hbGwiPgogICAgICAgICAgICAgICAgICAgICAgICDguILguYnguK3guJXguYjguK3guYTguJsgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCBtbC0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+YDsKICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IGRhc2hib2FyZEhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCB3LWZ1bGwgcC04IGJnLWdyYXktOTAwIHRleHQtd2hpdGUgYW5pbWF0ZS1mYWRlLWluIG92ZXJmbG93LXktYXV0byI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciB3LWZ1bGwgbWF4LXctNXhsIG1iLTYgYm9yZGVyLWIgYm9yZGVyLWdyYXktNzAwIHBiLTQiPgogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIHRleHQtZ3JheS0yMDAiPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoYXJ0LXBpZSBtci0yIHRleHQtYmx1ZS00MDAiPjwvaT4g4Liq4Lij4Li44Lib4Liq4LiW4Liy4LiZ4LiB4Liy4Lij4LiT4LmM4Liq4Lit4Lia4LiI4Lij4Li04LiHCiAgICAgICAgICAgICAgICAgICAgPC9oMj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmF5LTgwMCBweC00IHB5LTIgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWdyYXktNjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS00MDAgdGV4dC1zbSI+4Lic4Li54LmJ4LmA4LiC4LmJ4Liy4Liq4Lit4Lia4LiX4Lix4LmJ4LiH4Lir4Lih4LiUOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtbC0yIHRleHQtd2hpdGUiPiR7dG90YWxQbGF5ZXJzfSDguITguJk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0zIGdhcC02IHctZnVsbCBtYXgtdy01eGwgbWItNiI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JhZGllbnQtdG8tYnIgZnJvbS1ncmF5LTgwMCB0by1ncmF5LTkwMCBwLTYgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci15ZWxsb3ctNTAwLzUwIHNoYWRvdy1sZyBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSB0b3AtMCByaWdodC0wIGJnLXllbGxvdy01MDAvMjAgcC0yIHJvdW5kZWQtYmwteGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cm9waHkgdGV4dC15ZWxsb3ctNTAwIHRleHQteGwiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LWJhc2UgbWItMSB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIiPuC4hOC4sOC5geC4meC4meC4quC4ueC4h+C4quC4uOC4lDwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNXhsIGZvbnQtYmxhY2sgdGV4dC15ZWxsb3ctNDAwIG1iLTEgZmlsdGVyIGRyb3Atc2hhZG93LW1kIj4ke21heFNjb3JlfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgYmctZ3JheS04MDAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLWdyYXktNzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIOC4iOC4s+C4meC4p+C4mSA8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctMjAwIGZvbnQtYm9sZCI+JHttYXhDb3VudH08L3NwYW4+IOC4hOC4mQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmFkaWVudC10by1iciBmcm9tLWdyYXktODAwIHRvLWdyYXktOTAwIHAtNiByb3VuZGVkLTJ4bCBib3JkZXIgYm9yZGVyLWdyZWVuLTUwMC81MCBzaGFkb3ctbGcgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYWJzb2x1dGUgdG9wLTAgcmlnaHQtMCBiZy1ncmVlbi01MDAvMjAgcC0yIHJvdW5kZWQtYmwteGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zdGFyIHRleHQtZ3JlZW4tNTAwIHRleHQteGwiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LWJhc2UgbWItMSB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIiPuC4l+C4s+C5hOC4lOC5ieC5gOC4leC5h+C4oSAo4LiW4Li24LiH4LiC4LmJ4Lit4LiZ4Li14LmJKTwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNXhsIGZvbnQtYmxhY2sgdGV4dC1ncmVlbi00MDAgbWItMSBmaWx0ZXIgZHJvcC1zaGFkb3ctbWQiPiR7cGVyZmVjdFNjb3JlcnNDb3VudH08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIGJnLWdyYXktODAwIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci1ncmF5LTcwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDguIjguLLguIEgPHNwYW4gY2xhc3M9InRleHQtd2hpdGUgZm9udC1ib2xkIj4ke3RvdGFsUGxheWVyc308L3NwYW4+IOC4hOC4mQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JhZGllbnQtdG8tYnIgZnJvbS1ncmF5LTgwMCB0by1ncmF5LTkwMCBwLTYgcm91bmRlZC0yeGwgYm9yZGVyIGJvcmRlci1yZWQtNTAwLzUwIHNoYWRvdy1sZyBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSB0b3AtMCByaWdodC0wIGJnLXJlZC01MDAvMjAgcC0yIHJvdW5kZWQtYmwteGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1kb3duIHRleHQtcmVkLTUwMCB0ZXh0LXhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtZ3JheS00MDAgdGV4dC1iYXNlIG1iLTEgdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVyIj7guITguLDguYHguJnguJnguJXguYjguLPguKrguLjguJQ8L2gzPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LTV4bCBmb250LWJsYWNrIHRleHQtcmVkLTQwMCBtYi0xIGZpbHRlciBkcm9wLXNoYWRvdy1tZCI+JHttaW5TY29yZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIGJnLWdyYXktODAwIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci1ncmF5LTcwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICDguIjguLPguJnguKfguJkgPHNwYW4gY2xhc3M9InRleHQtcmVkLTIwMCBmb250LWJvbGQiPiR7bWluQ291bnR9PC9zcGFuPiDguITguJkKICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC02IHctZnVsbCBtYXgtdy00eGwgbWItOCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JhZGllbnQtdG8tYnIgZnJvbS1ncmF5LTgwMCB0by1ncmF5LTkwMCBwLTUgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLWJsdWUtNTAwLzQwIHNoYWRvdy1tZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcHgtOCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gZ3JvdXAgaG92ZXI6Ym9yZGVyLWJsdWUtNDAwIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LXNtIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciBtYi0xIj5Ub3RhbCBQb2ludHMg4Liq4Li54LiH4Liq4Li44LiUPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNHhsIGZvbnQtYmxhY2sgdGV4dC1ibHVlLTQwMCBmaWx0ZXIgZHJvcC1zaGFkb3ctc20iPiR7bWF4UG9pbnRzLnRvTG9jYWxlU3RyaW5nKCl9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ibHVlLTUwMC8xMCBwLTMgcm91bmRlZC1mdWxsIG1iLTEgaW5saW5lLWJsb2NrIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWdlbSB0ZXh0LWJsdWUtNDAwIHRleHQtMnhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj7guIjguLPguJnguKfguJkgPHNwYW4gY2xhc3M9InRleHQtYmx1ZS0yMDAgZm9udC1ib2xkIj4ke21heFBvaW50c0NvdW50fTwvc3Bhbj4g4LiE4LiZPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmFkaWVudC10by1iciBmcm9tLWdyYXktODAwIHRvLWdyYXktOTAwIHAtNSByb3VuZGVkLXhsIGJvcmRlciBib3JkZXItcHVycGxlLTUwMC80MCBzaGFkb3ctbWQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHB4LTggcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIGdyb3VwIGhvdmVyOmJvcmRlci1wdXJwbGUtNDAwIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LXNtIHVwcGVyY2FzZSB0cmFja2luZy13aWRlciBtYi0xIj5Ub3RhbCBQb2ludHMg4LiV4LmI4Liz4Liq4Li44LiUPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNHhsIGZvbnQtYmxhY2sgdGV4dC1wdXJwbGUtNDAwIGZpbHRlciBkcm9wLXNoYWRvdy1zbSI+JHttaW5Qb2ludHMudG9Mb2NhbGVTdHJpbmcoKX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1wdXJwbGUtNTAwLzEwIHAtMyByb3VuZGVkLWZ1bGwgbWItMSBpbmxpbmUtYmxvY2siPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtbGF5ZXItZ3JvdXAgdGV4dC1wdXJwbGUtNDAwIHRleHQtMnhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj7guIjguLPguJnguKfguJkgPHNwYW4gY2xhc3M9InRleHQtcHVycGxlLTIwMCBmb250LWJvbGQiPiR7bWluUG9pbnRzQ291bnR9PC9zcGFuPiDguITguJk8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC00IHBiLTgiPgogICAgICAgICAgICAgICAgICAgICR7YWRtaW5Db250cm9sc30KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtc20gZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgbXQtMiBiZy1ibGFjay8yMCBweC00IHB5LTIgcm91bmRlZC1mdWxsIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS11c2VyLXNlY3JldCI+PC9pPiAKICAgICAgICAgICAgICAgICAgICAgICAg4Lij4Liw4Lia4Lia4LiL4LmI4Lit4LiZ4Lij4Liy4Lii4LiK4Li34LmI4Lit4LmA4Lie4Li34LmI4Lit4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LmB4Lij4LiH4LiB4LiU4LiU4Lix4LiZ4Lij4Liw4Lir4Lin4LmI4Liy4LiH4LiB4Liy4Lij4Liq4Lit4LiaCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKCiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGRhc2hib2FyZEhUTUw7CgogICAgICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4YW0tbmV4dC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggKyAxOwogICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IAogICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywgCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IG5leHRJbmRleCwKICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbkRpc3BsYXllZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgICAgICAgICAgICAgICAgICBzY29yZXNDYWxjdWxhdGVkOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhhbS1maW5pc2gtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmV0dXJuOyAKICAgIH0KCiAgICBjb25zdCBwbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KTsKICAgIGNvbnN0IHRvdGFsUGxheWVycyA9IHBsYXllcnMubGVuZ3RoOwogICAgY29uc3QgY3VycmVudFF1ZXN0aW9uSW5kZXggPSBxdWVzdGlvbkluZGV4VG9TaG93OyAKCiAgICBjb25zdCB2YXJpYW50ID0gZ2FtZURhdGEuZ2FtZVZhcmlhbnQgfHwgJ2NsYXNzaWMnOwogICAgCiAgICBjb25zdCBpc0Fub255bW91c01vZGUgPSAodmFyaWFudCA9PT0gJ2Fub255bW91cycgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBpc1JldmVhbEF0RW5kTW9kZSA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBpc1JldmVhbGVkID0gKGdhbWVEYXRhLmlzQW5vbnltb3VzUmV2ZWFsZWQgPT09IHRydWUpOwogICAgY29uc3QgaXNDb21wZXRpdGlvbk1vZGUgPSAodmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJyk7CgogICAgY29uc3QgcXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uczsKICAgIGNvbnN0IGN1cnJlbnRRdWVzdGlvbiA9IHF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF07IAogICAgY29uc3QgdG9DaGFyID0gKGluZGV4KSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOwogICAgCiAgICAvLyAxLiDguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJkg4LmB4Lil4Liw4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmD4Lir4Lih4LmICiAgICBjb25zdCBwbGF5ZXJzV2l0aFNjb3JlcyA9IHBsYXllcnMubWFwKHAgPT4gewogICAgICAgIGNvbnN0IGFuc3dlcnNUb0NvbnNpZGVyID0gKHAuYW5zd2VycyB8fCBbXSkuZmlsdGVyKGFucyA9PiB7CiAgICAgICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFucy5xdWVzdGlvbkluZGV4IDw9IGN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOyAKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBsZXQgcmVhbFNjb3JlID0gMDsKICAgICAgICBsZXQgcG9pbnRzID0gMDsKCiAgICAgICAgaWYgKGlzUmV2ZWFsQXRFbmRNb2RlKSB7CiAgICAgICAgICAgIHJlYWxTY29yZSA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbHRlcihhID0+IGEuaXNDb3JyZWN0KS5sZW5ndGg7CiAgICAgICAgICAgIHBvaW50cyA9IGFuc3dlcnNUb0NvbnNpZGVyLnJlZHVjZSgoc3VtLCBhKSA9PiBzdW0gKyAoYS5wb2ludHNBd2FyZGVkIHx8IDApLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWFsU2NvcmUgPSBwLnNjb3JlIHx8IDA7CiAgICAgICAgICAgIHBvaW50cyA9IHAudG90YWxQb2ludHMgfHwgMDsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIFNUQVJUXSDguIHguLLguKPguITguLPguJnguKfguJMgU3RyZWFrIOC5geC4muC4muC5gOC4guC5ieC4oeC4h+C4p+C4lCAtLS0KICAgICAgICBsZXQgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgCiAgICAgICAgLy8g4Lin4LiZ4Lil4Li54Lib4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiV4Lix4LmJ4LiH4LmB4LiV4LmI4LiC4LmJ4LitIDAg4LiI4LiZ4LiW4Li24LiH4LiC4LmJ4Lit4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gY3VycmVudFF1ZXN0aW9uSW5kZXg7IGkrKykgewogICAgICAgICAgICAvLyDguKvguLLguITguLPguJXguK3guJrguILguK3guIfguILguYnguK3guJfguLXguYggaQogICAgICAgICAgICBjb25zdCBhbnMgPSBhbnN3ZXJzVG9Db25zaWRlci5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbnMpIHsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4oeC4teC4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgY29uc3QgaXNDb21ib0JyZWFrZXIgPSAoYW5zLnBvd2VydXBVc2VkICYmIGFucy5wb3dlcnVwVXNlZCAhPT0gJ3dhZ2VyTXVsdGlwbGllcicpIHx8IGFucy51c2VkQnV5VGltZTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbWJvQnJlYWtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBkeW5hbWljU3RyZWFrID0gMDsgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhaysrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7IC8vIOC4leC4reC4muC4nOC4tOC4lCA9IOC4o+C4teC5gOC4i+C5h+C4lQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gW+C5gOC4nuC4tOC5iOC4oeC5g+C4q+C4oeC5iF0g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiE4Liz4LiV4Lit4Lia4LmD4LiZ4LiC4LmJ4Lit4LiX4Li14LmIIGkgKOC4q+C4oeC4lOC5gOC4p+C4peC4si/guYTguKHguYjguYTguJTguYnguJXguK3guJopCiAgICAgICAgICAgICAgICAvLyDguYPguKvguYnguJbguLfguK3guKfguYjguLLguJzguLTguJQg4LmB4Lil4Liw4Lij4Li14LmA4LiL4LmH4LiVIFN0cmVhayDguJfguLHguJnguJfguLUKICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIEVORF0gLS0tCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgLi4ucCwgCiAgICAgICAgICAgIHJlYWxTY29yZTogcmVhbFNjb3JlLAogICAgICAgICAgICB0b3RhbFBvaW50czogcG9pbnRzLAogICAgICAgICAgICBhbnN3ZXJzOiBhbnN3ZXJzVG9Db25zaWRlciwKICAgICAgICAgICAgY29ycmVjdFN0cmVhazogZHluYW1pY1N0cmVhayAvLyDguYPguIrguYnguITguYjguLLguJfguLXguYjguITguLPguJnguKfguJPguYPguKvguKHguYjguJnguLXguYkKICAgICAgICB9OwogICAgfSk7CgogICAgY29uc3QgbWF4UG9pbnRzID0gTWF0aC5tYXgoLi4ucGxheWVyc1dpdGhTY29yZXMubWFwKHAgPT4gcC50b3RhbFBvaW50cyksIC1JbmZpbml0eSk7CiAgICBjb25zdCBtYXhSYXdTY29yZSA9IE1hdGgubWF4KC4uLnBsYXllcnNXaXRoU2NvcmVzLm1hcChwID0+IHAucmVhbFNjb3JlKSwgLUluZmluaXR5KTsKCiAgICBjb25zdCBpc01hcmtldE1vZGUgPSBnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyAyLiDguIjguLHguJTguYDguKPguLXguKLguIcgKFNvcnRpbmcpCiAgICBjb25zdCBzb3J0ZWRQbGF5ZXJzID0gWy4uLnBsYXllcnNXaXRoU2NvcmVzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJoKICAgIGxldCBjdXJyZW50UmFuayA9IDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZFBsYXllcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgY29uc3QgcHJldiA9IHNvcnRlZFBsYXllcnNbaSAtIDFdOwogICAgICAgICAgICBjb25zdCBjdXJyID0gc29ydGVkUGxheWVyc1tpXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBpc1RpZWQgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICAgICAgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWlzVGllZCkgewogICAgICAgICAgICAgICAgY3VycmVudFJhbmsgPSBpICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzb3J0ZWRQbGF5ZXJzW2ldLmRpc3BsYXlSYW5rID0gY3VycmVudFJhbms7CiAgICB9CiAgICAKICAgIC8vIOC4quC5iOC4p+C4meC5geC4quC4lOC4h+C5gOC4ieC4peC4ogogICAgbGV0IGN1cnJlbnRBbnN3ZXJEaXNwbGF5SFRNTCA9ICcnOwogICAgY29uc3Qgc2hvdWxkU2hvd0Fuc3dlciA9ICFpc0NvbXBldGl0aW9uTW9kZSAmJiAhKGlzQW5vbnltb3VzTW9kZSAmJiBnYW1lRGF0YS5zaG93QW5zd2VySW5Bbm9ueW1vdXMgPT09IGZhbHNlKTsKCiAgICBpZiAoY3VycmVudFF1ZXN0aW9uICYmIHNob3VsZFNob3dBbnN3ZXIpIHsKICAgICAgICBsZXQgY29ycmVjdEFuc3dlclRleHQgPSAnJzsKICAgICAgICBsZXQgY29ycmVjdEFuc3dlckxhYmVsID0gJyc7CiAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gY3VycmVudFF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAgICAgCiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScgJiYgY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMpIHsKICAgICAgICAgICAgY29uc3QgaWR4ID0gY3VycmVudFF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXJJbmRleDsKICAgICAgICAgICAgY29ycmVjdEFuc3dlclRleHQgPSBjdXJyZW50UXVlc3Rpb24ub3B0aW9uc1tpZHhdOwogICAgICAgICAgICBjb3JyZWN0QW5zd2VyTGFiZWwgPSB0b0NoYXIoaWR4KSArICcuJzsKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgIGNvbnN0IGlzVHJ1ZSA9IChTdHJpbmcoY3VycmVudFF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXIpLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJyk7CiAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJUZXh0ID0gaXNUcnVlID8gJ+C5g+C4iuC5iCAvIOC4luC4ueC4gScgOiAn4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUJzsKICAgICAgICAgICAgY29ycmVjdEFuc3dlckxhYmVsID0gaXNUcnVlID8gJ+C4gS4nIDogJ+C4gi4nOwogICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgY29ycmVjdEFuc3dlclRleHQgPSBjdXJyZW50UXVlc3Rpb24uY29ycmVjdFJlc3BvbnNlIHx8ICctJzsKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgICAgICBjb3JyZWN0QW5zd2VyVGV4dCA9IGN1cnJlbnRRdWVzdGlvbi5pZGVhbEFuc3dlciB8fCAnLSc7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29ycmVjdEFuc3dlclRleHQpIHsKICAgICBjdXJyZW50QW5zd2VyRGlzcGxheUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbXktNCBweS00IGJnLWJsYWNrLzIwIHJvdW5kZWQtbGcgc2hhZG93LWlubmVyIHJlbGF0aXZlIGdyb3VwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy0xMS8xMiBteC1hdXRvIiBzdHlsZT0iYm9yZGVyLXRvcDogMnB4IGRhc2hlZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMyk7Ij48L2Rpdj4KCiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIHRleHQteWVsbG93LTMwMCBtdC0zIGZvbnQtc2VtaWJvbGQiPgogICAgICAgICAgICAgICAg4LmA4LiJ4Lil4Lii4LiE4Liz4LiV4Lit4Lia4LiC4LmJ4Lit4LiX4Li14LmIICR7Y3VycmVudFF1ZXN0aW9uSW5kZXggKyAxfToKICAgICAgICAgICAgPC9wPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgZ2FwLTMgbXQtMSI+CiAgICAgICAgICAgICAgICA8cCBpZD0ibWFpbi1jb3JyZWN0LWFuc3dlci1kaXNwbGF5IiBjbGFzcz0idGV4dC00eGwgZm9udC1ib2xkIHRleHQtd2hpdGUiPgogICAgICAgICAgICAgICAgICAgICR7Y29ycmVjdEFuc3dlckxhYmVsfSAke2NvcnJlY3RBbnN3ZXJUZXh0fQogICAgICAgICAgICAgICAgPC9wPgoKICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImVkaXQtYW5zd2VyLWRhc2hib2FyZC1idG4iIGNsYXNzPSJiZy1ncmF5LTcwMCBob3ZlcjpiZy15ZWxsb3ctNTAwIGhvdmVyOnRleHQtYmxhY2sgdGV4dC1ncmF5LTMwMCBwLTIgcm91bmRlZC1mdWxsIHRyYW5zaXRpb24tYWxsIHNoYWRvdy1sZyBib3JkZXIgYm9yZGVyLWdyYXktNTAwIiB0aXRsZT0i4LmA4LiJ4Lil4Lii4Lic4Li04LiUPyDguYHguIHguYnguYTguILguJfguLHguJnguJfguLUiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtd3JlbmNoIj48L2k+CiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LTExLzEyIG14LWF1dG8gbXQtMyIgc3R5bGU9ImJvcmRlci10b3A6IDJweCBkYXNoZWQgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjMpOyI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwp9CiAgICB9CgogICAgY29uc3Qgc2NvcmVzSHRtbCA9IHNvcnRlZFBsYXllcnMubWFwKChwLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IHJlYWxTY29yZVNvRmFyID0gcC5yZWFsU2NvcmU7CiAgICAgICAgY29uc3QgcG9pbnRzVmFsdWUgPSBwLnRvdGFsUG9pbnRzOwogICAgICAgIGNvbnN0IGN1cnJlbnRUdXJuQW5zd2VyID0gKHAuYW5zd2VycyB8fCBbXSkuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IHF1ZXN0aW9uSW5kZXhUb1Nob3cpOwogICAgICAgIGNvbnN0IHRvdGFsQW5zd2Vyc1NvRmFyID0gcC5hbnN3ZXJzLmxlbmd0aDsKCiAgICAgICAgLy8gLS0tIDEuIOC4m+C5ieC4suC4oiBQb3QgQm9udXMgKOC4m+C4o+C4seC4muC5g+C4q+C5ieC5gOC4lOC5iOC4meC4guC4tuC5ieC4mSkgLS0tCiAgICAgICAgbGV0IHBvdEJvbnVzSFRNTCA9ICcnOwogICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlciAmJiBjdXJyZW50VHVybkFuc3dlci5wb3RCb251cyA+IDApIHsKICAgICAgICAgICAgcG90Qm9udXNIVE1MID0gYDxkaXYgY2xhc3M9InRleHQtWzEwcHhdIGJnLXllbGxvdy0zMDAgdGV4dC1ibGFjayBweC0xLjUgcm91bmRlZC1mdWxsIGZvbnQtYm9sZCBpbmxpbmUtYmxvY2sgYm9yZGVyIGJvcmRlci15ZWxsb3ctNTAwIHNoYWRvdy1zbSBtdC0wLjUiIHRpdGxlPSLguKrguYjguKfguJnguYHguJrguYjguIfguIjguLLguIHguIHguK3guIfguIHguKXguLLguIciPiske2N1cnJlbnRUdXJuQW5zd2VyLnBvdEJvbnVzfSBQb3Q8L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIDIuIOC5hOC4reC4hOC4reC4meC4quC4luC4suC4meC4sCAtLS0KICAgICAgICBsZXQgdHVyblN0YXR1c0ljb25zSFRNTCA9ICcnOwogICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlcikgewogICAgICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIud2FzRm9yY2VkKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmC4LiU4LiZ4Lia4Lix4LiH4LiE4Lix4Lia4Lih4Lix4LmI4LiZ4LmD4LiIIj7wn5G7PC9zcGFuPic7CiAgICAgICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlci53YXNKaW54ZWQpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYLguJTguJnguITguLPguKrguLLguJsiPvCfmIg8L3NwYW4+JzsKICAgICAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyLnVzZWRCdXlUaW1lKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9ICc8c3BhbiB0aXRsZT0i4LmD4LiK4LmJ4LmA4Lin4Lil4LiyIj7ij7M8L3NwYW4+JzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBjdXJyZW50VHVybkFuc3dlci5wb3dlcnVwVXNlZDsKICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGljb25zID0geyAncG9sbCc6ICfwn5OKJywgJ2N1dE9uZSc6ICfinILvuI8nLCAnaW5zdXJhbmNlJzogJ/Cfm6HvuI8nLCAnZmlmdHlGaWZ0eSc6ICfwn4yXJywgJ3dhZ2VyTXVsdGlwbGllcic6ICfwn5KwJywgJ3NlY29uZENoYW5jZSc6ICfwn5SBJywgJ3JldmVhbE9wdGlvbnMnOiAn8J+Rge+4jycgfTsKICAgICAgICAgICAgICAgIGlmIChpY29uc1tpdGVtXSkgdHVyblN0YXR1c0ljb25zSFRNTCArPSBgPHNwYW4gdGl0bGU9IuC5g+C4iuC5ieC5hOC4reC5gOC4l+C4oSI+JHtpY29uc1tpdGVtXX08L3NwYW4+YDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV0IHN0YXR1c0ljb25IVE1MID0gJyc7IAogICAgICAgIGNvbnN0IGN1cnJlbnRTdHJlYWsgPSBwLmNvcnJlY3RTdHJlYWsgfHwgMDsgCiAgICAgICAgY29uc3QgdHVyblVzZWRCdXlUaW1lID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIudXNlZEJ1eVRpbWU7CiAgICAgICAgY29uc3QgdHVyblVzZWRJdGVtID0gY3VycmVudFR1cm5BbnN3ZXIgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgJiYgY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQgIT09ICd3YWdlck11bHRpcGxpZXInOwoKICAgICAgICAvLyDguYTguK3guITguK3guJnguYTguJ8gKEZpcmUpCiAgICAgICAgbGV0IGZpcmVJY29uSFRNTCA9ICcnOwogICAgICAgIGlmICghaXNDb21wZXRpdGlvbk1vZGUgJiYgY3VycmVudFN0cmVhayA+PSAzICYmICF0dXJuVXNlZEJ1eVRpbWUgJiYgIXR1cm5Vc2VkSXRlbSkgewogICAgICAgICAgICBmaXJlSWNvbkhUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQtb3JhbmdlLTUwMCBhbmltYXRlLXB1bHNlIGZvbnQtYm9sZCB0ZXh0LXhzIG1sLTEgd2hpdGVzcGFjZS1ub3dyYXAgZHJvcC1zaGFkb3ctc20gZmlsdGVyIj7wn5SleCR7Y3VycmVudFN0cmVha308L3NwYW4+YDsKICAgICAgICB9CgogICAgICAgIC8vIOC5hOC4reC4hOC4reC4meC4oeC4h+C4geC4uOC4ji/guJTguLLguKcKICAgICAgICBpZiAoIWlzQ29tcGV0aXRpb25Nb2RlICYmIHRvdGFsQW5zd2Vyc1NvRmFyID4gMCkgewogICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAocG9pbnRzVmFsdWUgPT09IG1heFBvaW50cyAmJiBtYXhQb2ludHMgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTQwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiIHRpdGxlPSLguYDguIjguYnguLLguJ7guYjguK3guJXguKXguLLguJTguKHguLfguJQiPvCfkZE8L3NwYW4+JzsKICAgICAgICAgICAgICAgIGlmIChyZWFsU2NvcmVTb0ZhciA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtYmx1ZS0zMDAgbWwtMSB0ZXh0LWxnIGRyb3Atc2hhZG93LW1kIiB0aXRsZT0i4LmA4LiX4Lie4Lin4Li04LiK4Liy4LiB4Liy4LijIj7wn46TPC9zcGFuPic7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgIGNvbnN0IGlzUGVyZmVjdFNvRmFyID0gKHAucmVhbFNjb3JlID09PSAocXVlc3Rpb25JbmRleFRvU2hvdyArIDEpKTsKICAgICAgICAgICAgICAgaWYgKGlzUGVyZmVjdFNvRmFyKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTQwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiPuKtkDwvc3Bhbj4nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChzdGF0dXNJY29uSFRNTCA9PT0gJycgJiYgcG9pbnRzVmFsdWUgPCAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTUwMCBtbC0xIHRleHQtbGcgZHJvcC1zaGFkb3ctbWQiPuKaoO+4jzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAtLS0gMy4g4LiB4Liz4Lir4LiZ4LiU4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmB4Lia4Lia4LmA4LiC4LmJ4LihIChWaXZpZCBDb2xvcnMpIC0tLQogICAgICAgIGxldCBoaWdobGlnaHRDbGFzcyA9ICdiZy13aGl0ZSBib3JkZXItbC00IGJvcmRlci1ncmF5LTMwMCB0ZXh0LWdyYXktODAwJzsgLy8g4Liq4Li14LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZICjguILguLLguKcpCiAgICAgICAgbGV0IHN1YlRleHRDb2xvciA9ICd0ZXh0LWdyYXktNTAwJzsgLy8g4Liq4Li14LiC4Lit4LiH4LiK4Li34LmI4Lit4Lij4Lit4LiHIChOaWNrbmFtZSkKICAgICAgICBsZXQgaXNXYWdlckZhaWwgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFpc0NvbXBldGl0aW9uTW9kZSkgeyAKICAgICAgICAgICAgY29uc3QgbGF0ZXN0QW5zd2VyID0gKHAuYW5zd2VycyB8fCBbXSkuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IGN1cnJlbnRRdWVzdGlvbkluZGV4KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChsYXRlc3RBbnN3ZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IGxhdGVzdEFuc3dlci5pc0NvcnJlY3Q7CiAgICAgICAgICAgICAgICBjb25zdCBpc0NvbmZpZGVudCA9IChsYXRlc3RBbnN3ZXIud2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IGxhdGVzdEFuc3dlci53YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gbGF0ZXN0QW5zd2VyLnBvd2VydXBVc2VkOwoKICAgICAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7IAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguJTguLTguKHguJ7guLHguJnguJbguLnguIE6IOC4quC4teC5gOC4q+C4peC4t+C4reC4h+C4l+C4reC4h+C5gOC4guC5ieC4oSAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LiU4LizKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy15ZWxsb3ctNDAwIGJvcmRlci1sLTQgYm9yZGVyLXllbGxvdy02MDAgdGV4dC1ibGFjayBmb250LWJvbGQgc2hhZG93LW1kJzsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LXllbGxvdy05MDAvNzAnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguJTguLTguKHguJ7guLHguJnguJzguLTguJQ6IOC4quC4teC5geC4lOC4h+C4quC4lCAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LiC4Liy4LinKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy1yZWQtNjAwIGJvcmRlci1sLTQgYm9yZGVyLXJlZC04MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgc2hhZG93LW1kJzsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LXJlZC0yMDAnOwogICAgICAgICAgICAgICAgICAgICAgICBpc1dhZ2VyRmFpbCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXNDb25maWRlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiW4Li54LiBK+C4oeC4seC5iOC4meC5g+C4iDog4Liq4Li14LmA4LiC4Li14Lii4Lin4LmA4LiC4LmJ4LihICjguJXguLHguKfguKvguJnguLHguIfguKrguLfguK3guILguLLguKcpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLWdyZWVuLTYwMCBib3JkZXItbC00IGJvcmRlci1ncmVlbi04MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgc2hhZG93LW1kJzsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViVGV4dENvbG9yID0gJ3RleHQtZ3JlZW4tMjAwJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyDguJbguLnguIHguYDguInguKLguYY6IOC4quC4teC5gOC4guC4teC4ouC4p+C4reC5iOC4reC4mSAo4LiV4Lix4Lin4Lir4LiZ4Lix4LiH4Liq4Li34Lit4LmA4LiC4Li14Lii4Lin4LmA4LiC4LmJ4LihKQogICAgICAgICAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy1ncmVlbi0yMDAgYm9yZGVyLWwtNCBib3JkZXItZ3JlZW4tNTAwIHRleHQtZ3JlZW4tOTAwJzsKICAgICAgICAgICAgICAgICAgICAgICAgc3ViVGV4dENvbG9yID0gJ3RleHQtZ3JlZW4tNzAwJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbmZpZGVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyDguJzguLTguJQr4Lih4Lix4LmI4LiZ4LmD4LiIOiDguKrguLXguKrguYnguKHguYHguJTguIfguYDguILguYnguKEgKOC4leC4seC4p+C4q+C4meC4seC4h+C4quC4t+C4reC4guC4suC4pykKICAgICAgICAgICAgICAgICAgICAgICAgaGlnaGxpZ2h0Q2xhc3MgPSAnYmctb3JhbmdlLTYwMCBib3JkZXItbC00IGJvcmRlci1vcmFuZ2UtODAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHNoYWRvdy1tZCc7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlRleHRDb2xvciA9ICd0ZXh0LW9yYW5nZS0yMDAnOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4nOC4tOC4lOC5gOC4ieC4ouC5hjog4Liq4Li14LmB4LiU4LiH4Lit4LmI4Lit4LiZICjguJXguLHguKfguKvguJnguLHguIfguKrguLfguK3guYHguJTguIfguYDguILguYnguKEpCiAgICAgICAgICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLXJlZC0xMDAgYm9yZGVyLWwtNCBib3JkZXItcmVkLTQwMCB0ZXh0LXJlZC05MDAnOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJUZXh0Q29sb3IgPSAndGV4dC1yZWQtNzAwJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguYTguKHguYjguJXguK3guJov4Lir4Lih4LiU4LmA4Lin4Lil4LiyOiDguKrguLXguYDguJfguLIgKOC4leC4seC4p+C4q+C4meC4seC4h+C4quC4t+C4reC5gOC4l+C4suC5gOC4guC5ieC4oSkKICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gJ2JnLWdyYXktMTAwIGJvcmRlci1sLTQgYm9yZGVyLWdyYXktNDAwIHRleHQtZ3JheS01MDAnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIC0tLSA0LiDguIjguLHguJTguIHguLLguKPguIrguLfguYjguK0gKE5hbWUgRGlzcGxheSkgLS0tCiAgICAgICAgY29uc3QgcmVhbE5hbWUgPSBwLm5hbWU7CiAgICAgICAgY29uc3Qgbmlja25hbWUgPSBnYW1lRGF0YS5wbGF5ZXJOaWNrbmFtZXNbcC5uYW1lXSB8fCAnPz8/JzsKICAgICAgICBsZXQgbmFtZVRvU2hvdyA9IHJlYWxOYW1lOwogICAgICAgIGxldCBzdWJOYW1lVG9TaG93ID0gJyc7CgogICAgICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgICAgIGlmIChpc0Fub255bW91c01vZGUgJiYgIWlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgIG5hbWVUb1Nob3cgPSBuaWNrbmFtZTsKICAgICAgICAgICAgICAgIHN1Yk5hbWVUb1Nob3cgPSBgKCR7bmlja25hbWV9KWA7IAogICAgICAgICAgICAgICAgaWYoaXNXYWdlckZhaWwpIHN1Yk5hbWVUb1Nob3cgKz0gYCBbJHtyZWFsTmFtZX1dYDsgCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBbm9ueW1vdXNNb2RlICYmIGlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgIHN1Yk5hbWVUb1Nob3cgPSBgKCR7bmlja25hbWV9KWA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLS0tIDUuIOC4iOC4seC4lOC4geC4suC4o+C4hOC4sOC5geC4meC4mSAoU2NvcmUgRGlzcGxheSkgLS0tCiAgICAgICAgY29uc3QgcG9pbnRzRGlzcGxheSA9IHBvaW50c1ZhbHVlID49IDAgPyBgKyR7KHBvaW50c1ZhbHVlKS50b0xvY2FsZVN0cmluZygpfWAgOiBgJHsocG9pbnRzVmFsdWUpLnRvTG9jYWxlU3RyaW5nKCl9YDsKICAgICAgICAKICAgICAgICBjb25zdCBzY29yZUJsb2NrSFRNTCA9ICFpc0NvbXBldGl0aW9uTW9kZSA/IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1yaWdodCBmbGV4LXNocmluay0wIG1sLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1ib2xkIHRleHQtbGcgbGVhZGluZy1ub25lIj4ke3JlYWxTY29yZVNvRmFyfTwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC14cyBvcGFjaXR5LTkwIGZvbnQtbWVkaXVtIG10LTAuNSI+KCR7cG9pbnRzRGlzcGxheX0gUCk8L2Rpdj4KICAgICAgICAgICAgICAgICR7cG90Qm9udXNIVE1MfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICBgIDogJyc7CgogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBwLTIuNSBtYi0yIHJvdW5kZWQtbGcgc2hhZG93LXNtIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTMwMCAke2hpZ2hsaWdodENsYXNzfSI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIG92ZXJmbG93LWhpZGRlbiI+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1zaHJpbmstMCB3LTcgaC03IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtZnVsbCBiZy1ibGFjay8yMCBmb250LWJvbGQgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cC5kaXNwbGF5UmFua30KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBtaW4tdy0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXNtIHNtOnRleHQtYmFzZSB0cnVuY2F0ZSBibG9jayIgdGl0bGU9IiR7bmFtZVRvU2hvd30iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7bmFtZVRvU2hvd30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7c3RhdHVzSWNvbkhUTUx9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2ZpcmVJY29uSFRNTH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSB0ZXh0LXhzICR7c3ViVGV4dENvbG9yfSB0cnVuY2F0ZSBmb250LW5vcm1hbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3N1Yk5hbWVUb1Nob3cgPyBgPHNwYW4gY2xhc3M9Im1yLTEiPiR7c3ViTmFtZVRvU2hvd308L3NwYW4+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0dXJuU3RhdHVzSWNvbnNIVE1MfQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICR7c2NvcmVCbG9ja0hUTUx9CgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgY29uc3QgcGVyUXVlc3Rpb25IdG1sID0gcXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICBpZiAoKGlzUmV2ZWFsQXRFbmRNb2RlICYmIGluZGV4ID4gY3VycmVudFF1ZXN0aW9uSW5kZXgpIHx8IGlzQ29tcGV0aXRpb25Nb2RlKSB7IHJldHVybiAnJzsgfQogICAgICAgIGNvbnN0IGNvcnJlY3RDb3VudCA9IHBsYXllcnNXaXRoU2NvcmVzLmZpbHRlcihwID0+IHAuYW5zd2VycyAmJiBwLmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSW5kZXggPT09IGluZGV4ICYmIGFucy5pc0NvcnJlY3QpKS5sZW5ndGg7CiAgICAgICAgY29uc3QgaXNDdXJyZW50UXVlc3Rpb24gPSAoaW5kZXggPT09IGN1cnJlbnRRdWVzdGlvbkluZGV4KTsgCiAgICAgICAgY29uc3QgY2FyZENsYXNzZXMgPSBpc0N1cnJlbnRRdWVzdGlvbiAKICAgICAgICAgICAgPyAncC0yIHJvdW5kZWQtbWQgYmcteWVsbG93LTQwMCB0ZXh0LWJsYWNrIHJpbmctMiByaW5nLXllbGxvdy0yMDAgc2hhZG93LWxnJyAKICAgICAgICAgICAgOiAncC0yIGJnLWJsYWNrLzEwIHJvdW5kZWQtbWQnOwogICAgICAgIHJldHVybiBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9IiR7Y2FyZENsYXNzZXN9Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtc20iPuC4guC5ieC4rSAke2luZGV4ICsgMX06PC9wPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMiPiR7Y29ycmVjdENvdW50fSAvICR7dG90YWxQbGF5ZXJzfSDguITguJkg4LiV4Lit4Lia4LiW4Li54LiBPC9wPgogICAgICAgICAgICA8L2Rpdj5gOwogICAgfSkuam9pbignJyk7CgogICAgbGV0IGNvbnRyb2xCdXR0b25IdG1sID0gJyc7CiAgICBsZXQgYWRtaW5IZWFkZXJDb250cm9scyA9ICcnOwogICAgCiAgICBpZiAoaXNBZG1pbikgewogICAgICAgIGNvbnN0IGlzQ2xhc3NpY0xhc3QgPSAodmFyaWFudCA9PT0gJ2NsYXNzaWMnICYmIGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKTsKICAgICAgICBjb25zdCBpc1JldmVhbExhc3QgPSAoaXNSZXZlYWxBdEVuZE1vZGUgJiYgZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSk7CiAgICAgICAgY29uc3QgaXNDb21wZXRpdGlvbkxhc3QgPSAodmFyaWFudCA9PT0gJ2NvbXBldGl0aW9uJyAmJiBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSk7CiAgICAgICAgY29uc3QgaXNBbm9ueW1vdXNMYXN0ID0gKGlzQW5vbnltb3VzTW9kZSAmJiAhaXNSZXZlYWxBdEVuZE1vZGUgJiYgZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpOwogICAgICAgIAogICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICBpZiAoaXNSZXZlYWxMYXN0KSB7CiAgICAgICAgICAgICAgICBpZiAoaXNBbm9ueW1vdXNNb2RlICYmICFpc1JldmVhbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGRpdiBjbGFzcz0iZmxleCBnYXAtNCI+PGJ1dHRvbiBpZD0icmV2ZWFsLW5hbWVzLWJ0biIgY2xhc3M9InctMS8yIGJnLXllbGxvdy01MDAgaG92ZXI6YmcteWVsbG93LTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj48aSBjbGFzcz0iZmFzIGZhLWV5ZSI+PC9pPiDguYDguJvguLTguJTguYDguJzguKLguIrguLfguYjguK3guIjguKPguLTguIc8L2J1dHRvbj48YnV0dG9uIGlkPSJuZXh0LXN5bmMtcXVlc3Rpb24tYnRuIiBjbGFzcz0idy0xLzIgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LiU4Li5IFBvZGl1bSA8aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSI+PC9pPjwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnRyb2xCdXR0b25IdG1sID0gYDxidXR0b24gaWQ9Im5leHQtc3luYy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LiU4Li5IFBvZGl1bSA8aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSI+PC9pPjwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb250cm9sQnV0dG9uSHRtbCA9IGA8YnV0dG9uIGlkPSJuZXh0LXJldmlldy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC02IHJvdW5kZWQtbGcgdGV4dC14bCI+4LmA4LiJ4Lil4Lii4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT48L2J1dHRvbj5gOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChpc0NsYXNzaWNMYXN0IHx8IGlzQ29tcGV0aXRpb25MYXN0IHx8IGlzQW5vbnltb3VzTGFzdCkgeyAKICAgICAgICAgICAgIGlmIChpc0Fub255bW91c01vZGUgJiYgIWlzUmV2ZWFsZWQpIHsKICAgICAgICAgICAgICAgICBjb250cm9sQnV0dG9uSHRtbCA9IGA8ZGl2IGNsYXNzPSJmbGV4IGdhcC00Ij48YnV0dG9uIGlkPSJyZXZlYWwtbmFtZXMtYnRuIiBjbGFzcz0idy0xLzIgYmcteWVsbG93LTUwMCBob3ZlcjpiZy15ZWxsb3ctNjAwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtNiByb3VuZGVkLWxnIHRleHQteGwiPjxpIGNsYXNzPSJmYXMgZmEtZXllIj48L2k+IOC5gOC4m+C4tOC4lOC5gOC4nOC4ouC4iuC4t+C5iOC4reC4iOC4o+C4tOC4hzwvYnV0dG9uPjxidXR0b24gaWQ9Im5leHQtc3luYy1xdWVzdGlvbi1idG4iIGNsYXNzPSJ3LTEvMiBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guJTguLkgUG9kaXVtIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5Ij48L2k+PC9idXR0b24+PC9kaXY+YDsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGJ1dHRvbiBpZD0ibmV4dC1zeW5jLXF1ZXN0aW9uLWJ0biIgY2xhc3M9InctZnVsbCBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guJTguLkgUG9kaXVtIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5Ij48L2k+PC9idXR0b24+YDsKICAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgY29udHJvbEJ1dHRvbkh0bWwgPSBgPGJ1dHRvbiBpZD0ibmV4dC1zeW5jLXF1ZXN0aW9uLWJ0biIgY2xhc3M9InctZnVsbCBiZy1ncmF5LTgwMCBob3ZlcjpiZy1ibGFjayB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTYgcm91bmRlZC1sZyB0ZXh0LXhsIj7guILguYnguK3guJXguYjguK3guYTguJsgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCI+PC9pPjwvYnV0dG9uPmA7CiAgICAgICAgfQogICAgICAgIGFkbWluSGVhZGVyQ29udHJvbHMgPSBgPGJ1dHRvbiBpZD0iZW5kLXN5bmMtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIHNocmluay0wIj7guIjguJrguYDguIHguKE8L2J1dHRvbj5gOwogICAgfQoKICAgIGNvbnN0IHN1bW1hcnlDb2x1bW5IVE1MID0gKGlzQ29tcGV0aXRpb25Nb2RlIHx8IChpc0Fub255bW91c01vZGUgJiYgIWdhbWVEYXRhLnNob3dBbnN3ZXJJbkFub255bW91cykpID8gJycgOiBgPGRpdiBjbGFzcz0ibWQ6Y29sLXNwYW4tMiI+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4Lij4Liy4Lii4LiC4LmJ4LitPC9oND48ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0yIHNtOmdyaWQtY29scy0zIGxnOmdyaWQtY29scy00IGdhcC0yIj4ke3BlclF1ZXN0aW9uSHRtbH08L2Rpdj48L2Rpdj5gOwogICAgY29uc3Qgc2NvcmVDb2x1bW5DbGFzcyA9IChpc0NvbXBldGl0aW9uTW9kZSB8fCAoaXNBbm9ueW1vdXNNb2RlICYmICFnYW1lRGF0YS5zaG93QW5zd2VySW5Bbm9ueW1vdXMpKSA/ICdtZDpjb2wtc3Bhbi0zJyA6ICdtZDpjb2wtc3Bhbi0xJzsKICAgIAogICAgY29uc3QgcG90SFRNTCA9IGdldENlbnRyYWxQb3RIVE1MKGdhbWVEYXRhKTsgCgogICAgY29uc3QgZGFzaGJvYXJkSHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTYgZmxleCBmbGV4LWNvbCBoLWZ1bGwiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgbWItMiI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQiPkRhc2hib2FyZDogJHtnYW1lRGF0YS5zaHVmZmxlZFF1aXoudG9waWN9PC9oMj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iYmctd2hpdGUvMjAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LWJhc2UgZm9udC1tb25vIiB0aXRsZT0i4Lij4Lir4Lix4Liq4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LmA4LiB4LihIj4KICAgICAgICAgICAgICAgICAgICAgICAgUElOOiA8c3Ryb25nIGNsYXNzPSJmb250LWJvbGQiPiR7Z2FtZURhdGEucGlufTwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAke3BvdEhUTUx9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICR7YWRtaW5IZWFkZXJDb250cm9sc30KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICR7Y3VycmVudEFuc3dlckRpc3BsYXlIVE1MfQogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMyBnYXAtNiBmbGV4LWdyb3cgb3ZlcmZsb3cteS1hdXRvIHByLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iJHtzY29yZUNvbHVtbkNsYXNzfSI+PGg0IGNsYXNzPSJmb250LWJvbGQgbWItMiI+4Liq4Lij4Li44Lib4LiE4Liw4LmB4LiZ4LiZICjguKPguLLguKLguJrguLjguITguITguKUpPC9oND48ZGl2IGNsYXNzPSJzcGFjZS15LTEgdGV4dC1sZyI+JHtzY29yZXNIdG1sIHx8ICc8cCBjbGFzcz0idGV4dC1zbSI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14Lic4Li54LmJ4LmA4Lil4LmI4LiZPC9wPid9PC9kaXY+PC9kaXY+CiAgICAgICAgICAgICAgICAke3N1bW1hcnlDb2x1bW5IVE1MfQogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICR7aXNBZG1pbiA/IGA8ZGl2IGNsYXNzPSJtdC00IHB0LTQgYm9yZGVyLXQgYm9yZGVyLXdoaXRlLzIwIj4ke2NvbnRyb2xCdXR0b25IdG1sfTwvZGl2PmAgOiAnJ30KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGRhc2hib2FyZEh0bWw7CiAgICAKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgewogICAgICAgIGNvbnN0IGFuc3dlckRpc3BsYXlFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tY29ycmVjdC1hbnN3ZXItZGlzcGxheScpOwogICAgICAgIGlmIChhbnN3ZXJEaXNwbGF5RWxlbWVudCkgeyBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFthbnN3ZXJEaXNwbGF5RWxlbWVudF0pOyB9CiAgICB9CgogICAgaWYgKGlzQWRtaW4pIHsKICAgICAgICBjb25zdCBuZXh0U3luY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXN5bmMtcXVlc3Rpb24tYnRuJyk7CiAgICAgICAgaWYgKG5leHRTeW5jQnRuKSB7CiAgICAgICAgICAgIG5leHRTeW5jQnRuLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIGNvbnN0IG5leHRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ICsgMTsKICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsUSA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoOwoKICAgICAgICAgICAgICAgIGlmICghaXNSZXZlYWxBdEVuZE1vZGUgJiYgbmV4dEluZGV4IDwgdG90YWxRKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4OiBuZXh0SW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uRGlzcGxheWVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgICAgICAgICAgICAgICAgICAgICBzY29yZXNDYWxjdWxhdGVkOiBmYWxzZSAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7IAogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgY29uc3QgbmV4dFJldmlld0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXJldmlldy1xdWVzdGlvbi1idG4nKTsKICAgICAgICBpZiAobmV4dFJldmlld0J0bikgewogICAgICAgICAgICBuZXh0UmV2aWV3QnRuLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IAogICAgICAgICAgICAgICAgICAgIHJldmlld1F1ZXN0aW9uSW5kZXg6IGluY3JlbWVudCgxKSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JldmVhbC1uYW1lcy1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpLCB7IGlzQW5vbnltb3VzUmV2ZWFsZWQ6IHRydWUgfSk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgZW5kQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuZC1zeW5jLWdhbWUtYnRuJyk7CiAgICAgICAgaWYgKGVuZEJ0bikgewogICAgICAgICAgICBlbmRCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oICfguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguIjguJrguYDguIHguKHguJnguLXguYnguIHguYjguK3guJnguYDguKfguKXguLLguK3guLHguJnguITguKfguKM/JywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgkKCWNvbnN0IGVkaXRBbnNEYXNoQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkaXQtYW5zd2VyLWRhc2hib2FyZC1idG4nKTsKICAgICAgICBpZiAoZWRpdEFuc0Rhc2hCdG4pIHsKICAgICAgICAgICAgZWRpdEFuc0Rhc2hCdG4ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRRID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1tnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICBjb25zdCBxVHlwZSA9IGN1cnJlbnRRLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAgICAgICAgICAgICBjb25zdCBpc1Nob3J0QW5zd2VyID0gKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpOwoKICAgICAgICAgICAgICAgIGlmIChpc1Nob3J0QW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LiB4Lij4LiT4Li14LmA4LiV4Li04Lih4LiE4LizOiAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld0NvcnJlY3RUZXh0ID0gcHJvbXB0KGDguYDguInguKXguKLguJvguLHguIjguIjguLjguJrguLHguJnguITguLfguK0gIiR7Y3VycmVudFEuaWRlYWxBbnN3ZXJ9IlxuXG7guIHguKPguLjguJPguLLguIHguKPguK3guIEgIuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyIg4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4LijOmApOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXdDb3JyZWN0VGV4dCAhPT0gbnVsbCAmJiBuZXdDb3JyZWN0VGV4dC50cmltKCkgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVtZXJnZW5jeUFuc3dlckZpeChuZXdDb3JyZWN0VGV4dC50cmltKCksIGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC4iuC5ieC4reC4ouC4quC5jDogKOC5geC4geC5ieC5hOC4guC4guC5ieC4reC4hOC4p+C4suC4oSArIOC4quC4ueC4leC4o+C4hOC4s+C4meC4p+C4kykKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb3JyZWN0U3RyID0gcHJvbXB0KCLguYDguInguKXguKLguJzguLTguJTguYPguIrguYjguYTguKvguKE/IOC4geC4o+C4uOC4k+C4suC4o+C4sOC4muC4uOC4leC4seC4p+C5gOC4peC4giBJbmRleCDguILguK3guIfguILguYnguK3guJfguLXguYjguJbguLnguIHguIjguKPguLTguIcgKDE94LiBLCAyPeC4giwgMz3guIQsIDQ94LiHKToiKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiAobmV3Q29ycmVjdFN0ciAhPT0gbnVsbCAmJiBuZXdDb3JyZWN0U3RyLnRyaW0oKSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5wdXRWYWwgPSBwYXJzZUludChuZXdDb3JyZWN0U3RyLnRyaW0oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTmFOKGlucHV0VmFsKSAmJiBpbnB1dFZhbCA+PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguYHguJvguKXguIfguIjguLLguIEgMS1iYXNlZCAo4Lih4LiZ4Li44Lip4Lii4LmMKSDguYDguJvguYfguJkgMC1iYXNlZCAo4LiE4Lit4Lih4Lie4Li04Lin4LmA4LiV4Lit4Lij4LmMKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LmA4LiK4LmI4LiZIOC4geC4o+C4reC4gSAxICjguIEpIC0+IOC4quC5iOC4h+C5hOC4myAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguIHguKPguK3guIEgMiAo4LiCKSAtPiDguKrguYjguIfguYTguJsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxJbmRleCA9IGlucHV0VmFsIC0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVtZXJnZW5jeUFuc3dlckZpeChmaW5hbEluZGV4LCBnYW1lRGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydCgi4LiB4Lij4Li44LiT4Liy4LiB4Lij4Lit4LiB4LmA4Lib4LmH4LiZ4LiV4Lix4Lin4LmA4Lil4LiC4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHICjguYDguIrguYjguJkgMSwgMiwgMywgNCkiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CgkKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVQYXJhbGxlbEZyb21CYW5rKG9yaWdpbmFsUXVpekRhdGEpIHsKICAgIGNvbnN0IHJlc3VsdHNDb250ZW50Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtdGFiLWNvbnRlbnQnKTsKICAgIGNvbnN0IHF1aXp6ZXNMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2plY3QtcXVpenplcy1saXN0Jyk7CiAgICAKICAgIHF1aXp6ZXNMaXN0Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIGNvbnN0IGxvYWRlckh0bWwgPSBgCiAgICAgICAgPGRpdiBpZD0idGVtcC1sb2FkZXItcmVzdWx0cyIgY2xhc3M9InRleHQtY2VudGVyIHB5LTE2Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIG14LWF1dG8iPjwvZGl2PgogICAgICAgICAgICA8cCBpZD0idGVtcC1sb2FkZXItdGV4dC1yZXN1bHRzIiBjbGFzcz0ibXQtNCB0ZXh0LWdyYXktNjAwIj7guIHguLPguKXguLHguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguILguYnguK3guKrguK3guJogIiR7b3JpZ2luYWxRdWl6RGF0YS50b3BpY30iLi4uPC9wPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHJlc3VsdHNDb250ZW50Q29udGFpbmVyLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgbG9hZGVySHRtbCk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbXAtbG9hZGVyLXRleHQtcmVzdWx0cycpOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxUZXN0VGV4dCA9IG9yaWdpbmFsUXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgbGV0IHF1ZXN0aW9uU3RyaW5nID0gYCR7aW5kZXggKyAxfS4gJHtxLnF1ZXN0aW9uVGV4dCB8fCBxLnN0ZW19XG5gOwogICAgICAgICAgICBpZiAocS5vcHRpb25zKSB7CiAgICAgICAgICAgICAgICBxdWVzdGlvblN0cmluZyArPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAgICAtICR7aSA9PT0gcS5jb3JyZWN0QW5zd2VySW5kZXggPyAnWypdJyA6ICcnfSAke29wdH1gKS5qb2luKCdcbicpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHEuaWRlYWxBbnN3ZXIpIHsKICAgICAgICAgICAgICAgIHF1ZXN0aW9uU3RyaW5nICs9IGAgICAtIOC4hOC4s+C4leC4reC4mjogJHtxLmlkZWFsQW5zd2VyfWA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uU3RyaW5nOwogICAgICAgIH0pLmpvaW4oJ1xuXG4nKTsKCiAgICAgICAgbG9hZGVyVGV4dC50ZXh0Q29udGVudCA9ICfguKfguLTguYDguITguKPguLLguLDguKvguYzguKrguLPguYDguKPguYfguIghIOC4geC4s+C4peC4seC4h+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4hOC4ueC5iOC4guC4meC4suC4mS4uLic7CgogICAgICAgIGNvbnN0IHByb21wdCA9IGAKICAgICAgICAgICAg4LiE4Li44LiT4LiE4Li34Lit4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiN4LiU4LmJ4Liy4LiZ4LiB4Liy4Lij4Lin4Lix4LiU4Lic4Lil4LmB4Lil4Liw4Lib4Lij4Liw4LmA4Lih4Li04LiZ4Lic4Lil4LiX4Liy4LiH4LiB4Liy4Lij4Lio4Li24LiB4Lip4LiyCiAgICAgICAgICAgIOC4meC4teC5iOC4hOC4t+C4reC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4leC5ieC4meC4ieC4muC4seC4muC4iuC4uOC4lOC4q+C4meC4tuC5iOC4h+C5g+C4meC4q+C4seC4p+C4guC5ieC4rSAiJHtvcmlnaW5hbFF1aXpEYXRhLnRvcGljfSI6CiAgICAgICAgICAgIC0tLQogICAgICAgICAgICAke29yaWdpbmFsVGVzdFRleHR9CiAgICAgICAgICAgIC0tLQogICAgICAgICAgICDguKDguLLguKPguIHguLTguIjguILguK3guIfguITguLjguJPguITguLfguK06CiAgICAgICAgICAgIDEuICDguKfguLTguYDguITguKPguLLguLDguKvguYzguILguYnguK3guKrguK3guJrguJXguYnguJnguInguJrguLHguJrguJnguLXguYnguYDguJ7guLfguYjguK3guJfguLPguITguKfguLLguKHguYDguILguYnguLLguYPguIjguILguK3guJrguYDguILguJXguYDguJnguLfguYnguK3guKvguLIsIOC4o+C4ueC4m+C5geC4muC4muC4hOC4s+C4luC4suC4oSwg4LmB4Lil4Liw4Lij4Liw4LiU4Lix4Lia4LiE4Lin4Liy4Lih4Lii4Liy4LiBCiAgICAgICAgICAgIDIuICDguKrguKPguYnguLLguIcgIuC5geC4muC4muC4l+C4lOC4quC4reC4muC4hOC4ueC5iOC4guC4meC4suC4mSIgKFBhcmFsbGVsIFRlc3QpIOC4guC4tuC5ieC4meC4oeC4siAxIOC4iuC4uOC4lCDguIvguLbguYjguIfguJXguYnguK3guIfguKfguLHguJTguITguKfguLLguKHguKPguLnguYnguYPguJnguYDguKPguLfguYjguK3guIfguYDguJTguLXguKLguKfguIHguLHguJnguYHguKXguLDguKHguLXguKPguLDguJTguLHguJrguITguKfguLLguKHguKLguLLguIHguYDguJfguYjguLLguIHguLHguJkKICAgICAgICAgICAgMy4gICoq4Lir4LmJ4Liy4Lih4LiE4Lix4LiU4Lil4Lit4LiB4LmC4LiI4LiX4Lii4LmMLCDguJXguLHguKfguYDguKXguIIsIOC4q+C4o+C4t+C4reC4quC4luC4suC4meC4geC4suC4o+C4k+C5jOC5gOC4lOC4tOC4oeC4oeC4suC5guC4lOC4ouC5gOC4lOC5h+C4lOC4guC4suC4lCoqIOC4leC5ieC4reC4h+C4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4meC4oeC4suC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5g+C4q+C5ieC4oeC4teC4hOC4p+C4suC4oSAi4Liq4Lih4Lih4Li54LilIiDguIHguLHguJkKICAgICAgICAgICAgNC4gIOC4iOC4s+C4meC4p+C4meC4guC5ieC4reC5geC4peC4sOC4m+C4o+C4sOC5gOC4oOC4l+C4guC4reC4h+C4hOC4s+C4luC4suC4oeC4leC5ieC4reC4h+C4leC4o+C4h+C4geC4seC4muC4leC5ieC4meC4ieC4muC4seC4muC4l+C4uOC4geC4m+C4o+C4sOC4geC4suC4owogICAgICAgICAgICA1LiAg4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LmA4Lib4LmH4LiZ4Lig4Liy4Lip4Liy4LmE4LiX4Lii4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgICAgICR7c2ltcGxlTWF0aFByb21wdH0KICAgICAgICBgOwogICAgICAgIGNvbnN0IG1peGVkUXVlc3Rpb25TY2hlbWEgPSB7IHR5cGU6ICJPQkpFQ1QiLCBwcm9wZXJ0aWVzOiB7IHF1ZXN0aW9uVGV4dDogeyAidHlwZSI6ICJTVFJJTkciIH0sIHF1ZXN0aW9uVHlwZTogeyAidHlwZSI6ICJTVFJJTkciLCAiZW51bSI6IFsibXVsdGlwbGVfY2hvaWNlIiwgInNob3J0X2Fuc3dlciIsICJ0cnVlX2ZhbHNlIiwgIm1hdGNoaW5nX2l0ZW0iXSB9LCBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0sIGNvcnJlY3RBbnN3ZXI6IHsgdHlwZTogIkJPT0xFQU4iIH0sIHN0ZW06IHsgdHlwZTogIlNUUklORyIgfSwgY29ycmVjdFJlc3BvbnNlOiB7IHR5cGU6ICJTVFJJTkciIH0sIGFsbFJlc3BvbnNlczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sICBpbWFnZUNvZGU6IHsgdHlwZTogIlNUUklORyIgfSB9LCByZXF1aXJlZDogWyJxdWVzdGlvblR5cGUiXSB9OwogICAgICAgIGNvbnN0IGZpbmFsU2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyB0b3BpYzogeyB0eXBlOiAiU1RSSU5HIiB9LCBxdWVzdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IG1peGVkUXVlc3Rpb25TY2hlbWEgfSB9LCByZXF1aXJlZDogWyJ0b3BpYyIsICJxdWVzdGlvbnMiXSB9OwoKICAgICAgICBjb25zdCBuZXdRdWl6RGF0YUZyb21BSSA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShwcm9tcHQsIGZpbmFsU2NoZW1hKTsKCiAgICAgICAgLy8gdnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dgogICAgICAgIC8vIC0tLSDguIjguLjguJTguYHguIHguYnguYTguII6IOC5gOC4nuC4tOC5iOC4oSBJRCDguYPguKvguYnguIHguLHguJrguJfguLjguIHguITguLPguJbguLLguKHguIHguYjguK3guJnguJrguLHguJnguJfguLbguIEgLS0tCiAgICAgICAgY29uc3QgcXVlc3Rpb25zV2l0aElkcyA9IG5ld1F1aXpEYXRhRnJvbUFJLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiAoewogICAgICAgICAgICAuLi5xLCAvLyDguITguLHguJTguKXguK3guIHguILguYnguK3guKHguLnguKXguITguLPguJbguLLguKHguYDguJTguLTguKHguIjguLLguIEgQUkg4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgICAgIGlkOiBgcV8ke0RhdGUubm93KCl9XyR7aW5kZXh9YCAvLyDguYDguJ7guLTguYjguKEgcHJvcGVydHkgJ2lkJyDguJfguLXguYjguYTguKHguYjguIvguYnguLPguIHguLHguJnguYDguILguYnguLLguYTguJsKICAgICAgICB9KSk7CiAgICAgICAgLy8gXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXl5eXgoKICAgICAgICBjb25zdCBuZXdUb3BpYyA9IGAo4LiE4Li54LmI4LiC4LiZ4Liy4LiZKSAke29yaWdpbmFsUXVpekRhdGEudG9waWN9YDsKCiAgICAgICAgY29uc3QgZGF0YVRvU2F2ZSA9IHsKICAgICAgICAgICAgdG9waWM6IG5ld1RvcGljLCAKICAgICAgICAgICAgcXVlc3Rpb25zOiBxdWVzdGlvbnNXaXRoSWRzLCAvLyA8LS0g4LmD4LiK4LmJ4LiV4Lix4Lin4LmB4Lib4Lij4LmD4Lir4Lih4LmI4LiX4Li14LmI4Lih4Li1IElEIOC5geC4peC5ieC4pwogICAgICAgICAgICBxdWl6VHlwZTogb3JpZ2luYWxRdWl6RGF0YS5xdWl6VHlwZSwKICAgICAgICAgICAgcHJvamVjdElkOiBjdXJyZW50UHJvamVjdElkLAogICAgICAgICAgICBjcmVhdGVkQnk6IHVzZXJJZCwKICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZScsCiAgICAgICAgICAgIHNldHRpbmdzOiBvcmlnaW5hbFF1aXpEYXRhLnNldHRpbmdzLCAKICAgICAgICAgICAgcXVpek1vZGU6ICdzdGFuZGFyZCcsCiAgICAgICAgICAgIHBhaXJlZFF1aXpJZDogbnVsbCwKICAgICAgICAgICAgbGVzc29uUGxhbjogbnVsbAogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiHIElEIOC5g+C4q+C4oeC5iOC5geC4muC4muC4quC4uOC5iOC4oSA0IOC4q+C4peC4seC4gSDguYHguKXguLDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguYTguKHguYjguIvguYnguLPguIHguLHguJrguILguK3guIfguYDguJTguLTguKEKbGV0IG5ld1F1aXpJZDsKd2hpbGUgKHRydWUpIHsKICAgIG5ld1F1aXpJZCA9IE1hdGguZmxvb3IoMTAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwKS50b1N0cmluZygpOwogICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBnZXREb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBuZXdRdWl6SWQpKTsKICAgIGlmICghZXhpc3RpbmcuZXhpc3RzKCkpIGJyZWFrOwp9Ci8vIOC4muC4seC4meC4l+C4tuC4geC5geC4muC4muC4l+C4lOC4quC4reC4muC4lOC5ieC4p+C4oiBJRCA0IOC4q+C4peC4seC4geC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4mQphd2FpdCBzZXREb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBuZXdRdWl6SWQpLCBkYXRhVG9TYXZlKTsKICAgICAgICBzaG93TWVzc2FnZSgi4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiE4Li54LmI4LiC4LiZ4Liy4LiZ4Liq4Liz4LmA4Lij4LmH4LiI4LmB4Lil4LmJ4LinISIpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZ2VuZXJhdGluZyBwYXJhbGxlbCB0ZXN0IGZyb20gYmFuazoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoYOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogJHtlcnJvci5tZXNzYWdlfWApOwogICAgfSBmaW5hbGx5IHsKICAgICAgICBjb25zdCB0ZW1wTG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbXAtbG9hZGVyLXJlc3VsdHMnKTsKICAgICAgICBpZiAodGVtcExvYWRlcikgewogICAgICAgICAgICB0ZW1wTG9hZGVyLnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgICBxdWl6emVzTGlzdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIH0KfQoKLy8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguJfguLHguYnguIfguKvguKHguJQg4pa84pa84pa8CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlUGFyYWxsZWxQb3N0VGVzdChvcmlnaW5hbFByZVRlc3RRdWl6RGF0YSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVQYXJhbGxlbFRlc3Qoc2hvcnRjdXRGaWxlID0gbnVsbCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoJCQoJCWFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlZ2VuZXJhdGVRdWVzdGlvbkluRWRpdG9yKGluZGV4KSB7CiAgICBpZiAoY3VycmVudEVkaXRpbmdRdWl6RGF0YSA9PT0gbnVsbCkgcmV0dXJuOwoKICAgIC8vIOC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lOC5g+C4meC4guC5ieC4reC4l+C4teC5iOC4geC4s+C4peC4seC4h+C4iOC4sOC4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgY29uc3QgcXVlc3Rpb25JdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnF1ZXN0aW9uLWVkaXRvci1pdGVtW2RhdGEtcS1pbmRleD0iJHtpbmRleH0iXWApOwogICAgaWYgKHF1ZXN0aW9uSXRlbSkgewogICAgICAgIHF1ZXN0aW9uSXRlbS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgaC0zMiI+PGRpdiBjbGFzcz0ibG9hZGVyIj48L2Rpdj48L2Rpdj4nOwogICAgfQoKICAgIGNvbnN0IG9yaWdpbmFsUXVlc3Rpb24gPSBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF07CiAgICBjb25zdCBxdWl6VG9waWMgPSBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnRvcGljOwogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gb3JpZ2luYWxRdWVzdGlvbi5xdWVzdGlvblR5cGU7CgogICAgLy8g4LmA4LiV4Lij4Li14Lii4LihIFByb21wdCDguYHguKXguLAgU2NoZW1hIOC4quC4s+C4q+C4o+C4seC4muC5gOC4o+C4teC4ouC4gSBBSQogICAgY29uc3QgbWNxU2NoZW1hID0geyB0eXBlOiAiT0JKRUNUIiwgcHJvcGVydGllczogeyBxdWVzdGlvblRleHQ6IHsgdHlwZTogIlNUUklORyIgfSwgb3B0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sIGNvcnJlY3RBbnN3ZXJJbmRleDogeyB0eXBlOiAiTlVNQkVSIiB9IH0sIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJvcHRpb25zIiwgImNvcnJlY3RBbnN3ZXJJbmRleCJdIH07CiAgICBjb25zdCBzaG9ydEFuc3dlclNjaGVtYSA9IHsgdHlwZTogIk9CSkVDVCIsIHByb3BlcnRpZXM6IHsgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciIH0sIGlkZWFsQW5zd2VyOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwgcmVxdWlyZWQ6IFsicXVlc3Rpb25UZXh0IiwgImlkZWFsQW5zd2VyIl0gfTsKICAgIAogICAgbGV0IHNjaGVtYTsKICAgIGxldCB0eXBlRGVzY3JpcHRpb24gPSAiIjsKICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnKSB7CiAgICAgICAgc2NoZW1hID0gbWNxU2NoZW1hOwogICAgICAgIHR5cGVEZXNjcmlwdGlvbiA9ICLguYHguJrguJrguJvguKPguJnguLHguKIgNCDguJXguLHguKfguYDguKXguLfguK3guIEiOwogICAgfSBlbHNlIHsKICAgICAgICBzY2hlbWEgPSBzaG9ydEFuc3dlclNjaGVtYTsKICAgICAgICB0eXBlRGVzY3JpcHRpb24gPSAi4LmB4Lia4Lia4LmA4LiV4Li04Lih4LiE4Liz4LiV4Lit4LiaIjsKICAgIH0KCiAgICBjb25zdCBwcm9tcHQgPSBg4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmIIDEg4LiC4LmJ4LitIOC5g+C4meC4q+C4seC4p+C4guC5ieC4rSAiJHtxdWl6VG9waWN9IiDguYPguKvguYnguYDguJvguYfguJnguITguLPguJbguLLguKHguJvguKPguLDguYDguKDguJcgIiR7dHlwZURlc2NyaXB0aW9ufSIg4LmC4LiU4Lii4LmD4Lir4LmJ4Lih4Li14LmA4LiZ4Li34LmJ4Lit4Lir4Liy4LmD4LiB4Lil4LmJ4LmA4LiE4Li14Lii4LiH4LmB4LiV4LmI4LmE4Lih4LmI4LiL4LmJ4Liz4LiB4Lix4Lia4LiE4Liz4LiW4Liy4Lih4LmA4LiU4Li04Lih4LiZ4Li14LmJOiAiJHtvcmlnaW5hbFF1ZXN0aW9uLnF1ZXN0aW9uVGV4dCB8fCBvcmlnaW5hbFF1ZXN0aW9uLnN0ZW19Ii4gJHtzaW1wbGVNYXRoUHJvbXB0fWA7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBuZXdRdWVzdGlvbkRhdGEgPSBhd2FpdCBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4oeC4t+C5iOC4reC5hOC4lOC5ieC5guC4iOC4l+C4ouC5jOC5g+C4q+C4oeC5iOC4oeC4suC5geC4peC5ieC4pyDguYPguKvguYnguK3guLHguJvguYDguJTguJXguILguYnguK3guKHguLnguKXguYPguJkgU3RhdGUKICAgICAgICBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF0gPSB7IC4uLm9yaWdpbmFsUXVlc3Rpb24sIC4uLm5ld1F1ZXN0aW9uRGF0YSB9OwoKICAgICAgICAvLyDguKfguLLguJTguKvguJnguYnguLLguJXguYjguLLguIfguYHguIHguYnguYTguILguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJTguJ7guKPguYnguK3guKHguYLguIjguJfguKLguYzguJfguLXguYjguYDguJ7guLTguYjguIfguKrguKPguYnguLLguIcKICAgICAgICByZW5kZXJRdWl6RWRpdG9yKGN1cnJlbnRFZGl0aW5nUXVpekRhdGEpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciByZWdlbmVyYXRpbmcgcXVlc3Rpb24gaW4gZWRpdG9yOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4LmC4LiI4LiX4Lii4LmM4LmD4Lir4Lih4LmIIik7CiAgICAgICAgCiAgICAgICAgLy8g4Lir4Liy4LiB4Lil4LmJ4Lih4LmA4Lir4Lil4LinIOC5g+C4q+C5ieC4p+C4suC4lOC4q+C4meC5ieC4suC4iOC4reC5gOC4lOC4tOC4oeC4geC4peC4seC4muC4oeC4sgogICAgICAgIHJlbmRlclF1aXpFZGl0b3IoY3VycmVudEVkaXRpbmdRdWl6RGF0YSk7CiAgICB9Cn0KICAgICAgICAKICAgICAgIGZ1bmN0aW9uIGhhbmRsZU1vZGVTd2l0Y2goKSB7CiAgICAgICAgICAgIGNvbnN0IHN3aXRjaGVyQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGUtc3dpdGNoZXItYnRuJyk7CiAgICAgICAgICAgIGlmIChjdXJyZW50TW9kZSA9PT0gJ3N0dWRlbnQnKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0g4LmC4LiE4LmJ4LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIC0tLQogICAgICAgICAgICAgICAgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiI4Liy4LiB4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiV4LmI4Liy4LiHIGxvZ2luIOC5gOC4m+C5h+C4meC4quC4peC4seC4muC5guC4q+C4oeC4lOC4l+C4seC4meC4l+C4tQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAxLiDguYDguJvguKXguLXguYjguKLguJnguKrguJbguLLguJnguLDguYDguJvguYfguJkgYWRtaW4KICAgICAgICAgICAgICAgIGN1cnJlbnRNb2RlID0gJ2FkbWluJzsKCiAgICAgICAgICAgICAgICAvLyAyLiDguK3guLHguJvguYDguJTguJXguYTguK3guITguK3guJnguYHguKXguLDguILguYnguK3guITguKfguLLguKHguILguK3guIfguJvguLjguYjguKEKICAgICAgICAgICAgICAgIHN3aXRjaGVyQnRuLmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLXVzZXItZ3JhZHVhdGUgZmEtbGciPjwvaT5gOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4udGl0bGUgPSAi4Liq4Lil4Lix4Lia4LmE4Lib4LmC4Lir4Lih4LiU4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMy4g4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4LiyIGRhc2hib2FyZCDguILguK3guIcgYWRtaW4KICAgICAgICAgICAgICAgIHNob3dWaWV3KCdhZG1pbi1kYXNoYm9hcmQnKTsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiBpbiBhZG1pbiBtb2RlLCBzd2l0Y2ggYmFjayB0byBzdHVkZW50CiAgICAgICAgICAgICAgICBjdXJyZW50TW9kZSA9ICdzdHVkZW50JzsKICAgICAgICAgICAgICAgIHN3aXRjaGVyQnRuLmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLXVzZXItc2hpZWxkIGZhLWxnIj48L2k+YDsKICAgICAgICAgICAgICAgIHN3aXRjaGVyQnRuLnRpdGxlID0gIuC4quC4peC4seC4muC5hOC4m+C5guC4q+C4oeC4lOC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oSI7CiAgICAgICAgICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVBZG1pbkxvZ2luKCkgewogICAgICAgICAgICBjb25zdCBwYXNzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW4tcGFzc3dvcmQtaW5wdXQnKTsKICAgICAgICAgICAgY29uc3QgZXJyb3JNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFzc3dvcmQtZXJyb3ItbXNnJyk7CiAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGUsIG5vbi1zZWN1cmUgcGFzc3dvcmQuIEluIGEgcmVhbCBhcHAsIHVzZSBhIHByb3BlciBhdXRoIHN5c3RlbS4KICAgICAgICAgICAgaWYgKHBhc3NJbnB1dC52YWx1ZSA9PT0gJzI3NDExNDcyJykgewogICAgICAgICAgICAgICAgYWRtaW5QYXNzd29yZE1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgcGFzc0lucHV0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICBlcnJvck1zZy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVXBkYXRlIG1vZGUgYW5kIGJ1dHRvbgogICAgICAgICAgICAgICAgY3VycmVudE1vZGUgPSAnYWRtaW4nOwogICAgICAgICAgICAgICAgY29uc3Qgc3dpdGNoZXJCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kZS1zd2l0Y2hlci1idG4nKTsKICAgICAgICAgICAgICAgIHN3aXRjaGVyQnRuLmlubmVySFRNTCA9IGA8aSBjbGFzcz0iZmFzIGZhLXVzZXItZ3JhZHVhdGUgZmEtbGciPjwvaT5gOwogICAgICAgICAgICAgICAgc3dpdGNoZXJCdG4udGl0bGUgPSAi4Liq4Lil4Lix4Lia4LmE4Lib4LmC4Lir4Lih4LiU4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZIjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ2FkbWluLWRhc2hib2FyZCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXJyb3JNc2cuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBwYXNzSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gc3dpdGNoUHJvamVjdFRhYih0YWJOYW1lKSB7CiAgICAgICAgICAgIFsnbWFuYWdlJywgJ3Jlc3VsdHMnLCAnbGVhZGVyYm9hcmQnXS5mb3JFYWNoKG5hbWUgPT4gewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7bmFtZX0tdGFiYCkuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtuYW1lfS10YWItY29udGVudGApLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7dGFiTmFtZX0tdGFiYCkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RhYk5hbWV9LXRhYi1jb250ZW50YCkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0g4LmB4LiB4LmJ4LmE4LiC4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHN3aXRjaFF1aXpEZXRhaWxUYWIgLS0tCmZ1bmN0aW9uIHN3aXRjaFF1aXpEZXRhaWxUYWIodGFiTmFtZSkgewogICAgY29uc3QgdGFicyA9IHsKICAgICAgICAnYW5hbHl0aWNzJzogeyBidG46ICdhbmFseXRpY3MtdGFiLWJ0bicsIGNvbnRlbnQ6ICdhbmFseXRpY3MtdGFiLWNvbnRlbnQnIH0sCiAgICAgICAgJ3Njb3Jlcyc6IHsgYnRuOiAnc2NvcmVzLXRhYi1idG4nLCBjb250ZW50OiAnc2NvcmVzLXRhYi1jb250ZW50JyB9LAogICAgICAgICdsZWFkZXJib2FyZC1xdWl6JzogeyBidG46ICdsZWFkZXJib2FyZC1xdWl6LXRhYi1idG4nLCBjb250ZW50OiAnbGVhZGVyYm9hcmQtcXVpei10YWItY29udGVudCcgfSwKICAgICAgICAnYmVoYXZpb3ItbG9nJzogeyBidG46ICdiZWhhdmlvci1sb2ctdGFiLWJ0bicsIGNvbnRlbnQ6ICdiZWhhdmlvci1sb2ctdGFiLWNvbnRlbnQnIH0gLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgfTsKCiAgICBmb3IgKGNvbnN0IGtleSBpbiB0YWJzKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFic1trZXldLmJ0bikuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFic1trZXldLmNvbnRlbnQpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfQoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYnNbdGFiTmFtZV0uYnRuKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYnNbdGFiTmFtZV0uY29udGVudCkuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7Cn0KCmZ1bmN0aW9uIHNob3dNZXNzYWdlKG1lc3NhZ2UsIG9uQ29uZmlybSA9IG51bGwpIHsKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4m+C4peC4teC5iOC4ouC4meC4iOC4suC4gSAudGV4dENvbnRlbnQg4LmA4Lib4LmH4LiZIC5pbm5lckhUTUwgCiAgICAvLyDguYHguKXguLAgLnJlcGxhY2UoL1xuL2csICc8YnI+Jykg4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4Lij4Lit4LiH4Lij4Lix4Lia4LiB4Liy4Lij4LiC4Li24LmJ4LiZ4Lia4Lij4Lij4LiX4Lix4LiU4LmD4Lir4Lih4LmICiAgICBtb2RhbE1lc3NhZ2UuaW5uZXJIVE1MID0gbWVzc2FnZS5yZXBsYWNlKC9cbi9nLCAnPGJyPicpOwogICAgCiAgICBtb2RhbENvbmZpcm1BY3Rpb24gPSBvbkNvbmZpcm07IAogICAgbWVzc2FnZU1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwp9CgogICAgICAgIGZ1bmN0aW9uIHNob3dDb25maXJtYXRpb24obWVzc2FnZSwgb25Db25maXJtLCBvbkNhbmNlbCA9IG51bGwpIHsgLy8gPC0tIOC5geC4geC5ieC5hOC4guC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5iQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWF0aW9uLW1lc3NhZ2UnKS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtYXRpb24tbW9kYWwnKS5xdWVyeVNlbGVjdG9yKCdoMycpLnRleHRDb250ZW50ID0gJ+C4ouC4t+C4meC4ouC4seC4meC4geC4suC4o+C4geC4o+C4sOC4l+C4syc7CiAgICAgICAgICAgIGNvbmZpcm1BY3Rpb24gPSBvbkNvbmZpcm07CiAgICAgICAgICAgIGNhbmNlbEFjdGlvbiA9IG9uQ2FuY2VsOyAvLyA8LS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJCiAgICAgICAgICAgIGNvbmZpcm1hdGlvbk1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0KICAgICAgICAKZnVuY3Rpb24gbGlzdGVuRm9yUHJvamVjdHMoKSB7CiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzUmVmID0gZG9jKGRiLCAiZ2xvYmFsU2V0dGluZ3MiLCAiZGFzaGJvYXJkQ29uZmlnIik7CiAgICAgICAgICAgIG9uU25hcHNob3Qoc2V0dGluZ3NSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzRGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICAgICAgICAgIGdsb2JhbERhc2hib2FyZFNldHRpbmdzLnByb2plY3RTb3J0ID0gc2V0dGluZ3NEYXRhLnByb2plY3RTb3J0IHx8ICdkYXRlX2Rlc2MnOwogICAgICAgICAgICAgICAgICAgIGdsb2JhbERhc2hib2FyZFNldHRpbmdzLnBpbm5lZFByb2plY3RzID0gc2V0dGluZ3NEYXRhLnBpbm5lZFByb2plY3RzIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIGdsb2JhbERhc2hib2FyZFNldHRpbmdzLnByb2plY3RPcmRlciA9IHNldHRpbmdzRGF0YS5wcm9qZWN0T3JkZXIgfHwgW107IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhbGxQcm9qZWN0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgcmVuZGVyUHJvamVjdHMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjb25zdCBwcm9qZWN0c1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgKTsKICAgICAgICAgICAgdW5zdWJzY3JpYmVQcm9qZWN0c0xpc3RlbmVyID0gb25TbmFwc2hvdChwcm9qZWN0c1JlZiwgKHNuYXBzaG90KSA9PiB7CiAgICAgICAgICAgICAgICBhbGxQcm9qZWN0cyA9IHNuYXBzaG90LmRvY3MubWFwKGRvYyA9PiAoeyBpZDogZG9jLmlkLCAuLi5kb2MuZGF0YSgpIH0pKTsKICAgICAgICAgICAgICAgIHJlbmRlclByb2plY3RzKCk7CiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgbGlzdGVuaW5nIGZvciBwcm9qZWN0czoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmC4Lir4Lil4LiU4LmC4Lib4Lij4LmA4LiI4LiEIik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCmZ1bmN0aW9uIHNob3dDb2xvclBhbGV0dGUoYnV0dG9uLCBwcm9qZWN0SWQpIHsKICAgICAgICAgICAgLy8g4Lil4LiaIFBhbGV0dGUg4LmA4LiB4LmI4LiyICjguJbguYnguLLguKHguLUpCiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb2xvci1wYWxldHRlLXBvcHVwJykuZm9yRWFjaChwID0+IHAucmVtb3ZlKCkpOwoKICAgICAgICAgICAgY29uc3QgY29sb3JzID0gWycjRkZGRkZGJywgJyNGRUUyRTInLCAnI0ZFRjNDNycsICcjRDFGQUU1JywgJyNEQkVBRkUnLCAnI0UwRTdGRicsICcjRjNFOEZGJywgJyNGQ0U3RjMnLCAnI0U1RTdFQiddOwogICAgICAgICAgICBjb25zdCBwYWxldHRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHBhbGV0dGUuY2xhc3NOYW1lID0gJ2NvbG9yLXBhbGV0dGUtcG9wdXAgYWJzb2x1dGUgei0xMCBiZy13aGl0ZSBwLTIgcm91bmRlZC1sZyBzaGFkb3ctbGcgZmxleCBnYXAtMic7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb2xvcnMuZm9yRWFjaChjb2xvciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzd2F0Y2ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIHN3YXRjaC5jbGFzc05hbWUgPSAndy02IGgtNiByb3VuZGVkLWZ1bGwgY3Vyc29yLXBvaW50ZXIgYm9yZGVyLTIgaG92ZXI6Ym9yZGVyLWJsdWUtNTAwJzsKICAgICAgICAgICAgICAgIHN3YXRjaC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjsKICAgICAgICAgICAgICAgIHN3YXRjaC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVQcm9qZWN0Q29sb3JDaGFuZ2UocHJvamVjdElkLCBjb2xvcik7CiAgICAgICAgICAgICAgICAgICAgcGFsZXR0ZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcGFsZXR0ZS5hcHBlbmRDaGlsZChzd2F0Y2gpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGFsZXR0ZSk7CiAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBidXR0b24uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIHBhbGV0dGUuc3R5bGUudG9wID0gYCR7cmVjdC5ib3R0b20gKyB3aW5kb3cuc2Nyb2xsWX1weGA7CiAgICAgICAgICAgIHBhbGV0dGUuc3R5bGUubGVmdCA9IGAke3JlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYIC0gKHBhbGV0dGUub2Zmc2V0V2lkdGggLyAyKX1weGA7CiAgICAgICAgfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBoYW5kbGVQcm9qZWN0Q29sb3JDaGFuZ2UocHJvamVjdElkLCBjb2xvcikgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgcHJvamVjdElkKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7IGNvbG9yOiBjb2xvciB9KTsKICAgICAgICAgICAgICAgIC8vIG9uU25hcHNob3Qg4LiI4LiwIHJlLXJlbmRlciDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIHByb2plY3QgY29sb3I6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC4quC4tSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAphc3luYyBmdW5jdGlvbiByZW5kZXJQcm9qZWN0cygpICB7IC8qIFJlbW92ZWQgKi8gfSAKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1jcmVhdGUtcHJvamVjdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdE5hbWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LW5hbWUtaW5wdXQnKTsKICAgICAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0TmFtZUlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCFwcm9qZWN0TmFtZSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5g+C4quC5iOC4iuC4t+C5iOC4reC5guC4m+C4o+C5gOC4iOC4hCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBuZXdQcm9qZWN0UmVmID0gZG9jKGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgKSk7CiAgICAgICAgICAgICAgICBhd2FpdCBzZXREb2MobmV3UHJvamVjdFJlZiwgewogICAgICAgICAgICAgICAgICAgIHByb2plY3ROYW1lOiBwcm9qZWN0TmFtZSwKICAgICAgICAgICAgICAgICAgICBzdHVkZW50czogW10sCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IHsKICAgIHJlc3VsdHNEaXNwbGF5OiAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJywKICAgIHNodWZmbGVTZXR0aW5nOiAnbm9uZScsCiAgICBkZWZhdWx0TnVtUXVlc3Rpb25zOiA1LAogICAgZGVmYXVsdE51bUNob2ljZXM6IDQsCiAgICBkZWZhdWx0UGFzc2luZ1Njb3JlOiAzLAogICAgdGltZXJNb2RlOiAnbm9uZScsCiAgICB0aW1lckR1cmF0aW9uOiAxMCwKICAgIHNob3dJblN0dWRlbnREYXNoYm9hcmQ6IGZhbHNlIC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKfSwKICAgICAgICAgICAgICAgICAgICBjcmVhdGVkQnk6IHVzZXJJZCwgLy8gS2VlcCB0cmFjayBvZiB3aG8gY3JlYXRlZCBpdAogICAgICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHByb2plY3ROYW1lSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgIGNyZWF0ZVByb2plY3RNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKrguKPguYnguLLguIfguYLguJvguKPguYDguIjguITguKrguLPguYDguKPguYfguIghIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjcmVhdGluZyBwcm9qZWN0OiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKrguLLguKHguLLguKPguJbguKrguKPguYnguLLguIfguYLguJvguKPguYDguIjguITguYTguJTguYkiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyDguYLguITguYnguJTguYPguKvguKHguYjguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKOC4p+C4suC4h+C4l+C4seC4muC4guC4reC4h+C5gOC4lOC4tOC4oSkKLy8g4LmC4LiE4LmJ4LiU4LmD4Lir4Lih4LmIICjguKfguLLguIfguJfguLHguJogZXZlbnQgbGlzdGVuZXIg4LiC4Lit4LiHIHByb2plY3RMaXN0IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCkKcHJvamVjdExpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZSkgPT4gewogICAgY29uc3QgY2FyZENvbnRlbnQgPSBlLnRhcmdldC5jbG9zZXN0KCcucHJvamVjdC1jYXJkLWNvbnRlbnQnKTsKICAgIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcHJvamVjdC1idG4nKTsKICAgIGNvbnN0IHBpbkJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5waW4tcHJvamVjdC1idG4nKTsKCWNvbnN0IGNvbG9yQnRuID0gZS50YXJnZXQuY2xvc2VzdCgnLmNvbG9yLXBhbGV0dGUtYnRuJyk7IC8vIDwtLSDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYkKCiAgICBpZiAocGluQnRuKSB7CiAgICAgICAgY29uc3QgcHJvamVjdElkID0gcGluQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgY29uc3Qgc2V0dGluZ3NSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICBjb25zdCBjdXJyZW50UGlubmVkID0gZ2xvYmFsRGFzaGJvYXJkU2V0dGluZ3MucGlubmVkUHJvamVjdHM7CiAgICAgICAgbGV0IG5ld1Bpbm5lZElkczsKICAgICAgICAKICAgICAgICBpZiAoY3VycmVudFBpbm5lZC5pbmNsdWRlcyhwcm9qZWN0SWQpKSB7CiAgICAgICAgICAgIG5ld1Bpbm5lZElkcyA9IGN1cnJlbnRQaW5uZWQuZmlsdGVyKGlkID0+IGlkICE9PSBwcm9qZWN0SWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld1Bpbm5lZElkcyA9IFsuLi5jdXJyZW50UGlubmVkLCBwcm9qZWN0SWRdOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0cnkgewogICAgICAgICAgICBhd2FpdCBzZXREb2Moc2V0dGluZ3NSZWYsIHsgcGlubmVkUHJvamVjdHM6IG5ld1Bpbm5lZElkcyB9LCB7IG1lcmdlOiB0cnVlIH0pOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVwZGF0aW5nIHBpbiBzdGF0dXM6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lib4Lix4LiB4Lir4Lih4Li44LiUIik7CiAgICAgICAgfQoJCQoJCX0gZWxzZSBpZiAoY29sb3JCdG4pIHsgLy8gPC0tIOC5gOC4nuC4tOC5iOC4oeC4muC4peC5h+C4reC4geC4meC4teC5ieC4l+C4seC5ieC4h+C4q+C4oeC4lAogICAgICAgIGNvbnN0IHByb2plY3RJZCA9IGNvbG9yQnRuLmRhdGFzZXQuaWQ7CiAgICAgICAgc2hvd0NvbG9yUGFsZXR0ZShjb2xvckJ0biwgcHJvamVjdElkKTsKICAgICAgICAgICAgCiAgICB9IGVsc2UgaWYgKGNhcmRDb250ZW50KSB7CiAgICAgICAgY29uc3QgcHJvamVjdElkID0gY2FyZENvbnRlbnQuZGF0YXNldC5pZDsKICAgICAgICBpZiAocHJvamVjdElkID09PSAnc3RhcnJlZC1wcm9qZWN0JykgewogICAgICAgICAgICBzaG93U3RhcnJlZFByb2plY3RWaWV3KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3VycmVudFByb2plY3RJZCA9IHByb2plY3RJZDsKICAgICAgICAgICAgYXdhaXQgbG9hZFByb2plY3REZXRhaWxzKGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgICAgICBzaG93VmlldygncHJvamVjdC1kZXRhaWwnKTsKICAgICAgICB9CiAgICB9IGVsc2UgaWYgKGRlbGV0ZUJ0bikgewogICAgICAgIGNvbnN0IHByb2plY3RJZCA9IGRlbGV0ZUJ0bi5kYXRhc2V0LmlkOwogICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gZGVsZXRlQnRuLmRhdGFzZXQubmFtZTsKICAgICAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LmC4Lib4Lij4LmA4LiI4LiEICIke3Byb2plY3ROYW1lfSI/IOC4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lOC4iOC4sOC4luC4ueC4geC4peC4muC4reC4ouC5iOC4suC4h+C4luC4suC4p+C4o2AsCiAgICAgICAgICAgICgpID0+IGhhbmRsZURlbGV0ZVByb2plY3QocHJvamVjdElkKQogICAgICAgICk7CiAgICB9Cn0pOwoJCQoJCS8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQovKioKICog4LmB4Liq4LiU4LiH4Lic4Lil4Lib4Lij4Liw4Lin4Lix4LiV4Li04Lie4Lik4LiV4Li04LiB4Lij4Lij4Lih4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmD4LiZ4LmB4LiX4LmH4LiaCiAqIEBwYXJhbSB7QXJyYXl9IHN1Ym1pc3Npb25zIOC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4l+C4seC5ieC4h+C4q+C4oeC4lOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5iQogKi8KZnVuY3Rpb24gcmVuZGVyQmVoYXZpb3JMb2coc3VibWlzc2lvbnMpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiZWhhdmlvci1sb2ctY29udGFpbmVyJyk7CiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwoKICAgIC8vIOC4geC4o+C4reC4h+C5gOC4ieC4nuC4suC4sOC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4oeC4teC4m+C4o+C4sOC4p+C4seC4leC4tOC4nuC4pOC4leC4tOC4geC4o+C4o+C4oQogICAgY29uc3Qgc3VibWlzc2lvbnNXaXRoTG9ncyA9IHN1Ym1pc3Npb25zLmZpbHRlcihzdWIgPT4gc3ViLmJlaGF2aW9yTG9nICYmIHN1Yi5iZWhhdmlvckxvZy5sZW5ndGggPiAwKTsKCiAgICBpZiAoc3VibWlzc2lvbnNXaXRoTG9ncy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LWdyYXktNTAwIj7guYTguKHguYjguJ7guJrguJvguKPguLDguKfguLHguJXguLTguIHguLLguKPguK3guK3guIHguIjguLLguIHguKvguJnguYnguLLguIjguK3guILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IGh0bWwgPSAnJzsKICAgIHN1Ym1pc3Npb25zV2l0aExvZ3MuZm9yRWFjaChzdWIgPT4gewogICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctd2hpdGUiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tODAwIj4ke3N1Yi5zdHVkZW50TmFtZX08L3A+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIHBsLTQgYm9yZGVyLWwtMiBib3JkZXItZ3JheS0yMDAgc3BhY2UteS0yIj4KICAgICAgICBgOwogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4h+C4peC4s+C4lOC4seC4muC5gOC4q+C4leC4uOC4geC4suC4o+C4k+C5jOC4iOC4suC4geC4peC5iOC4suC4quC4uOC4lOC5hOC4m+C5gOC4geC5iOC4suC4quC4uOC4lAogICAgICAgIHN1Yi5iZWhhdmlvckxvZy5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLnRpbWVzdGFtcCkgLSBuZXcgRGF0ZShhLnRpbWVzdGFtcCkpLmZvckVhY2gobG9nID0+IHsKICAgICAgICAgICAgY29uc3QgZXZlbnRUaW1lID0gbmV3IERhdGUobG9nLnRpbWVzdGFtcCkudG9Mb2NhbGVTdHJpbmcoJ3RoLVRIJywgewogICAgICAgICAgICAgICAgZGF0ZVN0eWxlOiAnc2hvcnQnLAogICAgICAgICAgICAgICAgdGltZVN0eWxlOiAnbWVkaXVtJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS03MDAiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUgdGV4dC15ZWxsb3ctNTAwIG1yLTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPuC4reC4reC4geC4iOC4suC4geC4q+C4meC5ieC4suC4iOC4rSAo4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmIICR7bG9nLmF0dGVtcHROdW1iZXJ9KTwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgbWwtMiI+JHtldmVudFRpbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgfSk7CgogICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9KTsKCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKfQoJCgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHNhdmVQcm9qZWN0T3JkZXIobmV3T3JkZXIpIHsKICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3NSZWYgPSBkb2MoZGIsICJnbG9iYWxTZXR0aW5ncyIsICJkYXNoYm9hcmRDb25maWciKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IHNldERvYyhzZXR0aW5nc1JlZiwgeyBwcm9qZWN0T3JkZXI6IG5ld09yZGVyIH0sIHsgbWVyZ2U6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAvLyDguYTguKHguYjguJXguYnguK3guIfguJfguLPguK3guLDguYTguKPguJXguYjguK0gVUkg4LiI4Liw4Lit4Lix4Lib4LmA4LiU4LiV4LmA4Lit4LiH4LmD4LiZ4LiE4Lij4Lix4LmJ4LiH4LiW4Lix4LiU4LmE4Lib4LiX4Li14LmIIHJlLXJlbmRlcgogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHByb2plY3Qgb3JkZXI6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4geC4peC4s+C4lOC4seC4miIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoJCQphc3luYyBmdW5jdGlvbiBsb2dCZWhhdmlvckV2ZW50KGV2ZW50VHlwZSwgZGV0YWlscyA9IHt9KSB7CiAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSB8fCAhY3VycmVudFF1aXpEYXRhLmlkIHx8ICFjdXJyZW50U3R1ZGVudE5hbWUpIHsKICAgICAgICBjb25zb2xlLndhcm4oIuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC4muC4seC4meC4l+C4tuC4geC4nuC4pOC4leC4tOC4geC4o+C4o+C4oeC5hOC4lOC5iTog4LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lih4LmI4LiE4Lij4Lia4LiW4LmJ4Lin4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke2N1cnJlbnRRdWl6RGF0YS5pZH0vc3VibWlzc2lvbnNgLCBjdXJyZW50U3R1ZGVudE5hbWUpOwoKICAgIGNvbnN0IGxvZ0VudHJ5ID0gewogICAgICAgIGV2ZW50OiBldmVudFR5cGUsCiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgLi4uZGV0YWlscwogICAgfTsKCiAgICB0cnkgewogICAgICAgIC8vIOC4nuC4ouC4suC4ouC4suC4oeC4reC4seC4m+C5gOC4lOC4leC5gOC4reC4geC4quC4suC4o+C4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgIGJlaGF2aW9yTG9nOiBhcnJheVVuaW9uKGxvZ0VudHJ5KQogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKGDguK3guLHguJvguYDguJTguJXguJ7guKTguJXguLTguIHguKPguKPguKHguKrguLPguKvguKPguLHguJogJHtjdXJyZW50U3R1ZGVudE5hbWV9IOC4quC4s+C5gOC4o+C5h+C4iGApOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgLy8g4Lir4Liy4LiB4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiUICjguYDguIrguYjguJkg4Lir4Liy4LmA4Lit4LiB4Liq4Liy4Lij4LmE4Lih4LmI4LmA4LiI4LitKSDguYPguKvguYnguJrguLHguJnguJfguLbguIHguYTguKfguYnguYPguJkgY29uc29sZSDguYHguJXguYjguYTguKHguYjguJXguYnguK3guIfguJfguLPguK3guLDguYTguKPguIHguLHguJogVUkKICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ25vdC1mb3VuZCcpIHsKICAgICAgICAgICAgLy8g4LiZ4Li14LmI4LiE4Li34Lit4LiI4Li44LiU4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHOiDguYDguKHguLfguYjguK3guKvguLLguYDguK3guIHguKrguLLguKPguYTguKHguYjguYDguIjguK0g4LiB4LmH4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LiX4Liz4Lit4Liw4LmE4Lij4LmA4Lil4LiiCiAgICAgICAgICAgIC8vIOC5gOC4nuC4o+C4suC4sOC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC5g+C4q+C5ieC4muC4seC4meC4l+C4tuC4geC4nuC4pOC4leC4tOC4geC4o+C4o+C4oeC5hOC4lOC5iQogICAgICAgICAgICBjb25zb2xlLndhcm4oYOC5hOC4oeC5iOC4nuC4muC5gOC4reC4geC4quC4suC4o+C4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4guC4reC4hyAke2N1cnJlbnRTdHVkZW50TmFtZX0g4LiI4Li24LiH4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lia4Lix4LiZ4LiX4Li24LiBIGJlaGF2aW9yIGxvZyDguYTguJTguYkgKOC4meC4teC5iOC4hOC4t+C4reC5gOC4q+C4leC4uOC4geC4suC4o+C4k+C5jOC4m+C4geC4leC4tClgKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDguKvguLLguIHguYDguJvguYfguJnguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguK3guLfguYjguJnguYYKICAgICAgICAgICAgY29uc29sZS5lcnJvcigi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4Lie4Lik4LiV4Li04LiB4Lij4Lij4LihOiIsIGVycm9yKTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIGdldFNjb3JlVGllcihzY29yZSwgbWF4U2NvcmUpIHsKICAgIGlmIChtYXhTY29yZSA9PT0gMCkgewogICAgICAgIGlmIChzY29yZSA9PT0gMCkgcmV0dXJuIHsgdGV4dDogJyjguKPguK3guITguLDguYHguJnguJkpJywgaWNvbjogJ+KPsycgfTsKICAgICAgICByZXR1cm4geyB0ZXh0OiAnKOC4nuC4ouC4suC4ouC4suC4oeC4reC4ouC4ueC5iCknLCBpY29uOiAn8J+YpScgfTsgLy8g4LiB4Lij4LiT4Li14LiV4Li04LiU4Lil4LiaCiAgICB9CiAgICAvLyAo4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4Lir4Liy4Lij4LiU4LmJ4Lin4Lii4Lio4Li54LiZ4Lii4LmM4LiW4LmJ4LiyIG1heFNjb3JlIOC5gOC4m+C5h+C4mSAwKQogICAgY29uc3Qgc2NvcmVSYXRpbyA9IHNjb3JlIC8gKG1heFNjb3JlID09PSAwID8gMSA6IG1heFNjb3JlKTsKCiAgICBpZiAoc2NvcmVSYXRpbyA9PT0gMSkgewogICAgICAgIHJldHVybiB7IHRleHQ6ICco4LiZ4Liz4LmC4LiU4LmI4LiHKScsIGljb246ICfwn5GRJyB9OwogICAgfQogICAgaWYgKHNjb3JlUmF0aW8gPj0gMC43KSB7CiAgICAgICAgcmV0dXJuIHsgdGV4dDogJyjguJXguLLguKHguKHguLLguJXguLTguJTguYYpJywgaWNvbjogJ/CflKUnIH07CiAgICB9CiAgICBpZiAoc2NvcmVSYXRpbyA+PSAwLjQpIHsKICAgICAgICByZXR1cm4geyB0ZXh0OiAnKOC4geC4s+C4peC4seC4h+C5hOC4peC5iOC4leC4suC4oSknLCBpY29uOiAn8J+PgycgfTsKICAgIH0KICAgIHJldHVybiB7IHRleHQ6ICco4Lie4Lii4Liy4Lii4Liy4Lih4Lit4Lii4Li54LmIKScsIGljb246ICfwn5ilJyB9Owp9CgpmdW5jdGlvbiBjYWxjdWxhdGVNZWFuQW5kU3RkRGV2KHNjb3JlcykgewogICAgaWYgKHNjb3Jlcy5sZW5ndGggPT09IDApIHJldHVybiB7IG1lYW46IDAsIHN0ZERldjogMCB9OwogICAgY29uc3QgbWVhbiA9IHNjb3Jlcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHNjb3Jlcy5sZW5ndGg7CiAgICBpZiAoc2NvcmVzLmxlbmd0aCA9PT0gMSkgcmV0dXJuIHsgbWVhbjogbWVhbiwgc3RkRGV2OiAwIH07IC8vIFMuRC4g4LiC4Lit4LiH4LiC4LmJ4Lit4Lih4Li54LilIDEg4LiV4Lix4Lin4LmA4Lib4LmH4LiZIDAKICAgIGNvbnN0IHN0ZERldiA9IE1hdGguc3FydChzY29yZXMubWFwKHggPT4gTWF0aC5wb3coeCAtIG1lYW4sIDIpKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIChzY29yZXMubGVuZ3RoIC0gMSkpOwogICAgcmV0dXJuIHsgbWVhbiwgc3RkRGV2IH07Cn0KCi8qKgogKiDguITguLPguJnguKfguJMgWi1TY29yZQogKiBAcGFyYW0ge251bWJlcn0gc2NvcmUgLSDguITguLDguYHguJnguJnguJTguLTguJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJkKICogQHBhcmFtIHtudW1iZXJ9IG1lYW4gLSDguITguYjguLLguYDguInguKXguLXguYjguKLguILguK3guIfguIHguKXguLjguYjguKEKICogQHBhcmFtIHtudW1iZXJ9IHN0ZERldiAtIOC4quC5iOC4p+C4meC5gOC4muC4teC5iOC4ouC4h+C5gOC4muC4meC4oeC4suC4leC4o+C4kOC4suC4meC4guC4reC4h+C4geC4peC4uOC5iOC4oQogKiBAcmV0dXJucyB7bnVtYmVyfG51bGx9IOC4hOC5iOC4siBaLVNjb3JlIOC4q+C4o+C4t+C4rSBudWxsIOC4luC5ieC4suC4hOC4s+C4meC4p+C4k+C5hOC4oeC5iOC5hOC4lOC5iQogKi8KZnVuY3Rpb24gY2FsY3VsYXRlWlNjb3JlKHNjb3JlLCBtZWFuLCBzdGREZXYpIHsKICAgIGlmIChzdGREZXYgPT09IDApIHJldHVybiAwOyAvLyDguJbguYnguLLguJfguLjguIHguITguJnguYTguJTguYnguITguLDguYHguJnguJnguYDguJfguYjguLLguIHguLHguJkgWi1zY29yZSDguITguLfguK0gMAogICAgcmV0dXJuIChzY29yZSAtIG1lYW4pIC8gc3RkRGV2Owp9CgovKioKICog4LiE4Liz4LiZ4Lin4LiTIFQtU2NvcmUKICogQHBhcmFtIHtudW1iZXJ9IHpTY29yZSAtIOC4hOC5iOC4siBaLVNjb3JlCiAqIEByZXR1cm5zIHtudW1iZXJ9IOC4hOC5iOC4siBULVNjb3JlCiAqLwpmdW5jdGlvbiBjYWxjdWxhdGVUU2NvcmUoelNjb3JlKSB7CiAgICByZXR1cm4gKDEwICogelNjb3JlKSArIDUwOwp9CgpmdW5jdGlvbiBzaG93U3RhcnJlZFByb2plY3RWaWV3KCkgewogICAgICAgICAgICBjdXJyZW50UHJvamVjdElkID0gJ3N0YXJyZWQnOyAvLyDguJXguLHguYnguIcgSUQg4Lie4Li04LmA4Lio4LipCiAgICAgICAgICAgIGN1cnJlbnRQcm9qZWN0RGF0YSA9IG51bGw7IC8vIOC5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC5guC4m+C4o+C5gOC4iOC4hOC4iOC4o+C4tOC4h+C5hgoKICAgICAgICAgICAgLy8g4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4Lir4Lix4Lin4LiC4LmJ4Lit4LmB4Lil4Liw4LmB4Liq4LiU4LiHIHZpZXcKICAgICAgICAgICAgcHJvamVjdFRpdGxlLnRleHRDb250ZW50ID0gJ+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC4leC4tOC4lOC4lOC4suC4pyc7CiAgICAgICAgICAgIHByb2plY3RJZERpc3BsYXkudGV4dENvbnRlbnQgPSAncGlubmVkLWl0ZW1zJzsKICAgICAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CgogICAgICAgICAgICAvLyDguIvguYjguK3guJnguYHguJfguYfguJrguJfguLXguYjguYTguKHguYjguYDguIHguLXguYjguKLguKfguILguYnguK3guIcKICAgICAgICAgICAgbWFuYWdlVGFiLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBsZWFkZXJib2FyZFRhYi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4muC4seC4h+C4hOC4seC4muC5g+C4q+C5ieC5hOC4m+C4l+C4teC5iOC5geC4l+C5h+C4miAi4Lic4Lil4Lil4Lix4Lie4LiY4LmMIiAo4LiL4Li24LmI4LiH4LiB4LmH4LiE4Li34Lit4Lij4Liy4Lii4LiB4Liy4Lij4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaKQogICAgICAgICAgICBzd2l0Y2hQcm9qZWN0VGFiKCdyZXN1bHRzJyk7CgkJCXJlbmRlclF1aXp6ZXMoKTsgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4Lin4Liy4LiU4Lij4Liy4Lii4LiB4Liy4Lij4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmD4Lir4Lih4LmI4LiU4LmJ4Lin4Lii4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHCiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gWyDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KYXN5bmMgZnVuY3Rpb24gbG9hZFByb2plY3REZXRhaWxzKHByb2plY3RJZCkgewogICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHByb2plY3RJZCk7CiAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3RSZWYpOwogICAgaWYgKGRvY1NuYXAuZXhpc3RzKCkpIHsKICAgICAgICBtYW5hZ2VUYWIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgbGVhZGVyYm9hcmRUYWIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgY3VycmVudFByb2plY3REYXRhID0gZG9jU25hcC5kYXRhKCk7CiAgICAgICAgcHJvamVjdFRpdGxlLnRleHRDb250ZW50ID0gY3VycmVudFByb2plY3REYXRhLnByb2plY3ROYW1lOwogICAgICAgIHByb2plY3RJZERpc3BsYXkudGV4dENvbnRlbnQgPSBwcm9qZWN0SWQ7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBjdXJyZW50UHJvamVjdERhdGEuc2V0dGluZ3MgfHwge307CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NodWZmbGUtc2V0dGluZy1zZWxlY3QnKS52YWx1ZSA9IHNldHRpbmdzLnNodWZmbGVTZXR0aW5nIHx8ICdub25lJzsKICAgICAgICAKICAgICAgICBjb25zdCBzaG93SW5EYXNoYm9hcmRDaGVja2JveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LWluLXN0dWRlbnQtZGFzaGJvYXJkLWNoZWNrYm94Jyk7CiAgICAgICAgc2hvd0luRGFzaGJvYXJkQ2hlY2tib3guY2hlY2tlZCA9IHNldHRpbmdzLnNob3dJblN0dWRlbnREYXNoYm9hcmQgIT09IGZhbHNlOwoKICAgICAgICBjb25zdCBlbmFibGVQYXNzY29kZUNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VuYWJsZS1wYXNzY29kZS1jaGVja2JveCcpOwogICAgICAgIGNvbnN0IHBhc3Njb2RlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Bhc3Njb2RlLWlucHV0LWNvbnRhaW5lcicpOwogICAgICAgIGNvbnN0IHBhc3Njb2RlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvamVjdC1wYXNzY29kZS1pbnB1dCcpOwoKICAgICAgICBjb25zdCBpc1Bhc3Njb2RlRW5hYmxlZCA9IHNldHRpbmdzLmlzUGFzc2NvZGVFbmFibGVkIHx8IGZhbHNlOwogICAgICAgIGVuYWJsZVBhc3Njb2RlQ2hlY2tib3guY2hlY2tlZCA9IGlzUGFzc2NvZGVFbmFibGVkOwogICAgICAgIHBhc3Njb2RlSW5wdXQudmFsdWUgPSBzZXR0aW5ncy5wYXNzY29kZSB8fCAnJzsKICAgICAgICBwYXNzY29kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhaXNQYXNzY29kZUVuYWJsZWQpOwoKICAgICAgICBlbmFibGVQYXNzY29kZUNoZWNrYm94Lm9uY2hhbmdlID0gKCkgPT4gewogICAgICAgICAgICBwYXNzY29kZUNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nLCAhZW5hYmxlUGFzc2NvZGVDaGVja2JveC5jaGVja2VkKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKHguJrguKPguKPguJfguLHguJTguJnguLXguYnguYDguILguYnguLLguYTguJvguYDguJ7guLfguYjguK3guYLguKvguKXguJTguITguYjguLLguJfguLXguYjguJrguLHguJnguJfguLbguIHguYTguKfguYkg4pa84pa84pa8CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2Utc2NvcmluZy1jaGVja2JveCcpLmNoZWNrZWQgPSBzZXR0aW5ncy5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCB8fCBmYWxzZTsKCiAgICAgICAgaWYgKHVuc3Vic2NyaWJlU3R1ZGVudHNMaXN0ZW5lcikgdW5zdWJzY3JpYmVTdHVkZW50c0xpc3RlbmVyKCk7CiAgICAgICAgaWYgKHVuc3Vic2NyaWJlUXVpenplc0xpc3RlbmVyKSB1bnN1YnNjcmliZVF1aXp6ZXNMaXN0ZW5lcigpOwogICAgICAgIGlmICh1bnN1YnNjcmliZVN0dWRlbnRQcm9maWxlc0xpc3RlbmVyKSB1bnN1YnNjcmliZVN0dWRlbnRQcm9maWxlc0xpc3RlbmVyKCk7CiAgICAgICAgbGlzdGVuRm9yU3R1ZGVudHMocHJvamVjdElkKTsKICAgICAgICBsaXN0ZW5Gb3JQcm9qZWN0UXVpenplcyhwcm9qZWN0SWQpOwogICAgICAgIGxpc3RlbkZvclN0dWRlbnRQcm9maWxlcyhwcm9qZWN0SWQpOwogICAgfSBlbHNlIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LmC4Lib4Lij4LmA4LiI4LiEIik7CiAgICAgICAgc2hvd1ZpZXcoJ2FkbWluLWRhc2hib2FyZCcpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVSZXNldFByb2plY3RPcmRlcigpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVRvZ2dsZVBpblByb2plY3QocHJvamVjdElkKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZURlbGV0ZVByb2plY3QocHJvamVjdElkKSAgeyAvKiBSZW1vdmVkICovIH0gCiAgICAgICAgCiAgICAgICAgLy8gLS0tIFNldHRpbmdzICYgU3R1ZGVudCBNYW5hZ2VtZW50IGluIFByb2plY3QgLS0tCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXZlLXNldHRpbmdzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgaWYgKCFjdXJyZW50UHJvamVjdElkKSByZXR1cm47CiAgICBjb25zdCBzZXR0aW5ncyA9IHsKICAgICAgICBkZWZhdWx0TnVtUXVlc3Rpb25zOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtLXF1ZXN0aW9ucycpLnZhbHVlKSwKICAgICAgICBkZWZhdWx0TnVtQ2hvaWNlczogcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1jaG9pY2VzJykudmFsdWUpLAogICAgICAgIGRlZmF1bHRQYXNzaW5nU2NvcmU6IHBhcnNlSW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXNzaW5nLXNjb3JlLWlucHV0JykudmFsdWUpLAogICAgICAgIHJlc3VsdHNEaXNwbGF5OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy1kaXNwbGF5LXNlbGVjdCcpLnZhbHVlLAogICAgICAgIHNodWZmbGVTZXR0aW5nOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2h1ZmZsZS1zZXR0aW5nLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIHRpbWVyTW9kZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLW1vZGUtc2VsZWN0JykudmFsdWUsCiAgICAgICAgdGltZXJEdXJhdGlvbjogcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVyLWR1cmF0aW9uLWlucHV0JykudmFsdWUpLAogICAgICAgIC8vIOKWvOKWvOKWvCDguYDguJ7guLTguYjguKEgcHJvcGVydHkg4LiZ4Li14LmJ4LmA4LiC4LmJ4Liy4LmE4LibIOKWvOKWvOKWvAogICAgICAgIGlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLWNoZWNrYm94JykuY2hlY2tlZCwKCQljb25maWRlbmNlTW9kZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kZS1zZWxlY3QnKS52YWx1ZQogICAgfTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwcm9qZWN0UmVmLCB7IHNldHRpbmdzIH0pOwogICAgICAgIHNob3dNZXNzYWdlKCLguJrguLHguJnguJfguLbguIHguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguYHguKXguYnguKciKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc2F2aW5nIHNldHRpbmdzOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LmE4LiU4LmJIik7CiAgICB9Cn0pOwoKICAgICAgICBmdW5jdGlvbiBsaXN0ZW5Gb3JTdHVkZW50cyhwcm9qZWN0SWQpIHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHByb2plY3RJZCk7CiAgICAgICAgICAgIHVuc3Vic2NyaWJlU3R1ZGVudHNMaXN0ZW5lciA9IG9uU25hcHNob3QocHJvamVjdFJlZiwgKGRvYykgPT4gewogICAgICAgICAgICAgICAgaWYgKGRvYy5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gZG9jLmRhdGEoKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvamVjdERhdGEgPSBwcm9qZWN0RGF0YTsgCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudExpc3QocHJvamVjdERhdGEuc3R1ZGVudHMgfHwgW10pOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJTdHVkZW50TGlzdChzdHVkZW50cykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXN0dWRlbnQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGlmICghY3VycmVudFByb2plY3RJZCkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBzdHVkZW50TmFtZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0dWRlbnQtbmFtZS1pbnB1dCcpOwogICAgICAgICAgICBjb25zdCBzdHVkZW50TmFtZXNUZXh0ID0gc3R1ZGVudE5hbWVJbnB1dC52YWx1ZS50cmltKCk7CiAgICAgICAgICAgIGlmICghc3R1ZGVudE5hbWVzVGV4dCkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5g+C4quC5iOC4iuC4t+C5iOC4reC4meC4seC4geC5gOC4o+C4teC4ouC4mSIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBuZXdTdHVkZW50cyA9IHN0dWRlbnROYW1lc1RleHQuc3BsaXQoJ1xuJykubWFwKG5hbWUgPT4gbmFtZS50cmltKCkpLmZpbHRlcihuYW1lID0+IG5hbWUpOwogICAgICAgICAgICBpZiAobmV3U3R1ZGVudHMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIGN1cnJlbnRQcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgY29uc3QgZG9jU25hcCA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICAgICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFN0dWRlbnRzID0gZG9jU25hcC5kYXRhKCkuc3R1ZGVudHMgfHwgW107CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0dWRlbnRzID0gWy4uLm5ldyBTZXQoWy4uLmN1cnJlbnRTdHVkZW50cywgLi4ubmV3U3R1ZGVudHNdKV07CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHByb2plY3RSZWYsIHsgc3R1ZGVudHM6IHVwZGF0ZWRTdHVkZW50cyB9KTsKICAgICAgICAgICAgICAgICAgICBzdHVkZW50TmFtZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBhZGRpbmcgc3R1ZGVudHM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4quC4suC4oeC4suC4o+C4luC5gOC4nuC4tOC5iOC4oeC4meC4seC4geC5gOC4o+C4teC4ouC4meC5hOC4lOC5iSIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgkJCgkJLy8g4pa84pa84pa8IOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKLyoqCiAqIOC4iOC4seC4lOC4geC4suC4o+C4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iOC5geC4muC4muC4l+C4lOC4quC4reC4muC4lOC5ieC4p+C4ouC4leC4meC5gOC4reC4hwogKiBAcGFyYW0ge3N0cmluZ30gZmlyc3RRdWl6SWQgLSBJRCDguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJrguYHguKPguIHguJfguLXguYjguJzguLnguYnguYPguIrguYnguIHguJTguJvguLjguYjguKEKICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1hbnVhbFF1aXpQYWlyaW5nKGZpcnN0UXVpeklkKSB7CiAgICBjb25zdCBwYWlyaW5nTW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LW1vZGFsJyk7IC8vIOC5gOC4o+C4suC4iOC4sOC5g+C4iuC5iSBNb2RhbCDguYDguJTguLTguKEKICAgIGNvbnN0IHByb2plY3RTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW92ZS1xdWl6LXByb2plY3Qtc2VsZWN0Jyk7CiAgICBjb25zdCBtb2RhbFRpdGxlID0gcGFpcmluZ01vZGFsLnF1ZXJ5U2VsZWN0b3IoJ2gzJyk7CiAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbW92ZS1xdWl6LWJ0bicpOwogICAgY29uc3QgY2FuY2VsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbC1tb3ZlLXF1aXotYnRuJyk7CgogICAgLy8gMS4g4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LmD4LiZIE1vZGFsIOC5g+C4q+C5ieC5gOC4q+C4oeC4suC4sOC4quC4oeC4geC4seC4muC4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iAogICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguIjguLHguJrguITguLnguYjguYDguJ7guLfguYjguK3guYDguJvguKPguLXguKLguJrguYDguJfguLXguKLguJrguJzguKUnOwogICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj7guIHguLPguKXguLHguIfguYLguKvguKXguJTguKPguLLguKLguIHguLLguKMuLi48L29wdGlvbj4nOwogICAgY29uZmlybUJ0bi50ZXh0Q29udGVudCA9ICfguKLguLfguJnguKLguLHguJnguIHguLLguKPguIjguLHguJrguITguLnguYgnOwogICAgcGFpcmluZ01vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIDIuIOC5geC4quC4lOC4h+C4o+C4suC4ouC4geC4suC4o+C5geC4muC4muC4l+C4lOC4quC4reC4muC4reC4t+C5iOC4meC5hiDguJfguLHguYnguIfguKvguKHguJTguYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYkgKOC4ouC4geC5gOC4p+C5ieC4meC4leC4seC4p+C5gOC4reC4hykKICAgIGNvbnN0IHBvdGVudGlhbFBhaXJzID0gYWxsUXVpenplcy5maWx0ZXIocSA9PiBxLmlkICE9PSBmaXJzdFF1aXpJZCk7CgogICAgaWYgKHBvdGVudGlhbFBhaXJzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHByb2plY3RTZWxlY3QuaW5uZXJIVE1MID0gJzxvcHRpb24gdmFsdWU9IiI+4LmE4Lih4LmI4Lih4Li14LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lit4Li34LmI4LiZ4LmD4Lir4LmJ4LiI4Lix4Lia4LiE4Li54LmIPC9vcHRpb24+JzsKICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJvamVjdFNlbGVjdC5pbm5lckhUTUwgPSAnPG9wdGlvbiB2YWx1ZT0iIj4tLSDguYDguKXguLfguK3guIHguYHguJrguJrguJfguJTguKrguK3guJrguJfguLXguYjguIjguLDguYDguJvguKPguLXguKLguJrguYDguJfguLXguKLguJogLS08L29wdGlvbj4nICsKICAgICAgICAgICAgcG90ZW50aWFsUGFpcnMubWFwKHAgPT4gYDxvcHRpb24gdmFsdWU9IiR7cC5pZH0iPiR7cC50b3BpY308L29wdGlvbj5gKS5qb2luKCcnKTsKICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICB9CgogICAgLy8gMy4g4Liq4Lij4LmJ4Liy4LiHIEV2ZW50IExpc3RlbmVyIOC4quC4s+C4q+C4o+C4seC4muC4geC4suC4o+C4ouC4t+C4meC4ouC4seC4mSAo4LiX4Liz4LiH4Liy4LiZ4LmB4LiE4LmI4LiE4Lij4Lix4LmJ4LiH4LmA4LiU4Li14Lii4LinKQogICAgY29uc3QgY29uZmlybVBhaXJpbmdIYW5kbGVyID0gYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IHNlY29uZFF1aXpJZCA9IHByb2plY3RTZWxlY3QudmFsdWU7CiAgICAgICAgaWYgKCFzZWNvbmRRdWl6SWQpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4geC4s+C4peC4seC4h+C4iOC4seC4muC4hOC4ueC5iC4uLic7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGZpcnN0UXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgZmlyc3RRdWl6SWQpOwogICAgICAgICAgICBjb25zdCBzZWNvbmRRdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBzZWNvbmRRdWl6SWQpOwoKICAgICAgICAgICAgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmI4LmB4Lia4Lia4Liq4Lit4LiH4LiX4Liy4LiHIChUd28td2F5IGJpbmRpbmcpCiAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShmaXJzdFF1aXpSZWYsIHsgcGFpcmVkUXVpeklkOiBzZWNvbmRRdWl6SWQgfSk7CiAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShzZWNvbmRRdWl6UmVmLCB7IHBhaXJlZFF1aXpJZDogZmlyc3RRdWl6SWQgfSk7CiAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4iOC4seC4muC4hOC4ueC5iOC5geC4muC4muC4l+C4lOC4quC4reC4muC4quC4s+C5gOC4o+C5h+C4iCEiKTsKICAgICAgICAgICAgcGFpcmluZ01vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBwYWlyaW5nIHF1aXp6ZXM6IiwgZXJyb3IpOwogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmIIik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8g4LiE4Li34LiZ4LiE4LmI4LiyIE1vZGFsIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4m+C4geC4leC4tOC4quC4s+C4q+C4o+C4seC4muC4geC4suC4o+C5g+C4iuC5ieC4h+C4suC4mSAi4Lii4LmJ4Liy4LiiIiDguYPguJnguITguKPguLHguYnguIfguJXguYjguK3guYTguJsKICAgICAgICAgICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguYTguJvguYLguJvguKPguYDguIjguITguK3guLfguYjguJknOwogICAgICAgICAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ+C4ouC5ieC4suC4oic7CiAgICAgICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgLy8g4Lil4LiaIExpc3RlbmVyIOC4l+C4teC5iOC4quC4o+C5ieC4suC4h+C4guC4tuC5ieC4meC4iuC4seC5iOC4p+C4hOC4o+C4suC4p+C4reC4reC4gQogICAgICAgICAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybVBhaXJpbmdIYW5kbGVyKTsKICAgICAgICAgICAgY2FuY2VsQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xlYW51cCk7CiAgICAgICAgfQogICAgfTsKICAgIAogICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Li34LiZ4LiE4LmI4LiyIE1vZGFsIOC5gOC4oeC4t+C5iOC4reC4geC4lOC4ouC4geC5gOC4peC4tOC4gQogICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHsKICAgICAgICBwYWlyaW5nTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgbW9kYWxUaXRsZS50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguYTguJvguYLguJvguKPguYDguIjguITguK3guLfguYjguJknOwogICAgICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4LiiJzsKICAgICAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybVBhaXJpbmdIYW5kbGVyKTsKICAgICAgICBjYW5jZWxCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKICAgIH07CgogICAgY29uZmlybUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1QYWlyaW5nSGFuZGxlcik7CiAgICBjYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbGVhbnVwKTsKfQovLyDilrLilrLilrIg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LmD4Lir4Lih4LmIIOKWsuKWsuKWsgoKICAgICAgICBmdW5jdGlvbiBoYW5kbGVEZWxldGVTdHVkZW50KHN0dWRlbnROYW1lKSB7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiK4Li34LmI4LitICIke3N0dWRlbnROYW1lfSI/IOC4guC5ieC4reC4oeC4ueC4peC4hOC4sOC5geC4meC4meC5geC4peC4sOC4m+C5ieC4suC4ouC4o+C4suC4h+C4p+C4seC4peC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4hOC4meC4meC4teC5ieC4iOC4sOC4luC4ueC4geC4peC4muC5hOC4m+C4lOC5ieC4p+C4omAsCiAgICAgICAgICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50UHJvamVjdElkIHx8ICFjdXJyZW50UHJvamVjdERhdGEpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCB1cGRhdGVkU3R1ZGVudHMgPSBjdXJyZW50UHJvamVjdERhdGEuc3R1ZGVudHMuZmlsdGVyKHMgPT4gcyAhPT0gc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBjdXJyZW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudFByb2ZpbGVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHMvJHtjdXJyZW50UHJvamVjdElkfS9zdHVkZW50UHJvZmlsZXNgLCBzdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwogICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocHJvamVjdFJlZiwgeyBzdHVkZW50czogdXBkYXRlZFN0dWRlbnRzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC5kZWxldGUoc3R1ZGVudFByb2ZpbGVSZWYpOyAvLyBBbHNvIGRlbGV0ZSB0aGVpciBwcm9maWxlIGZvciB0aGUgbGVhZGVyYm9hcmQKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CgogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGRlbGV0aW5nIHN0dWRlbnQ6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4Lia4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRGVsZXRlQWxsU3R1ZGVudHMoKSB7CiAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmD4LiZ4LmC4Lib4Lij4LmA4LiI4LiE4LiZ4Li14LmJPyDguIHguLLguKPguIHguKPguLDguJfguLPguJnguLXguYnguYTguKHguYjguKrguLLguKHguLLguKPguJbguKLguYnguK3guJnguIHguKXguLHguJrguYTguJTguYlgLAogICAgICAgICAgICAgICAgYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICghY3VycmVudFByb2plY3RJZCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBjdXJyZW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzLyR7Y3VycmVudFByb2plY3RJZH0vc3R1ZGVudFByb2ZpbGVzYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVzU25hcHNob3QgPSBhd2FpdCBnZXREb2NzKHByb2ZpbGVzUmVmKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShwcm9qZWN0UmVmLCB7IHN0dWRlbnRzOiBbXSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvZmlsZXNTbmFwc2hvdC5mb3JFYWNoKGRvYyA9PiBiYXRjaC5kZWxldGUoZG9jLnJlZikpOwogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBiYXRjaC5jb21taXQoKTsKCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgYWxsIHN0dWRlbnRzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4peC4muC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4seC5ieC4h+C4q+C4oeC4lCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgovLyDilrzilrzilrwgU1RBUlQ6IOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lOC4quC4s+C4q+C4o+C4seC4muC4n+C4teC5gOC4iOC4reC4o+C5jCAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lii4LiB4LmA4LiZ4Li34LmJ4Lit4Lir4Liy4LiI4Liy4LiB4LmE4Lif4Lil4LmMIiDilrzilrzilrwKCi8vIDEuIOC4quC4o+C5ieC4suC4h+C4leC4seC4p+C5geC4m+C4o+C4quC5iOC4p+C4meC4geC4peC4suC4h+C5gOC4nuC4t+C5iOC4reC5gOC4geC5h+C4muC4guC5ieC4reC4oeC4ueC4peC5hOC4n+C4peC5jOC5hOC4p+C5ieC5g+C4iuC5ieC4i+C5ieC4swpsZXQgZXh0cmFjdGVkRmlsZVRvcGljcyA9IFtdOwpsZXQgZmlsZURhdGFCYXNlNjQgPSBudWxsOwpsZXQgZmlsZU1pbWVUeXBlID0gbnVsbDsKCgovLyDilrzilrzilrwgU1RBUlQ6IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBhbmFseXplRmlsZUZvclRvcGljcyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8Ci8qKgogKiDguILguLHguYnguJnguJXguK3guJnguJfguLXguYggMTog4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmE4Lif4Lil4LmMICjguKPguKfguKHguJbguLbguIfguYTguJ/guKXguYzguKrguYHguIHguJkpIOC5gOC4nuC4t+C5iOC4reC4lOC4tuC4h+C4q+C4seC4p+C4guC5ieC4reC4reC4reC4geC4oeC4sgogKiBAcGFyYW0ge0ZpbGV9IGZpbGUgLSDguYTguJ/guKXguYzguJfguLXguYjguJzguLnguYnguYPguIrguYnguK3guLHguJvguYLguKvguKXguJQKICovCmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVGaWxlRm9yVG9waWNzKGZpbGUpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIHJlbmRlckZpbGVUb3BpY3MoKSB7CiAgICBjb25zdCB0b3BpY3NMaXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGUtdG9waWNzLWxpc3QnKTsKICAgIGlmIChleHRyYWN0ZWRGaWxlVG9waWNzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHRvcGljc0xpc3REaXYuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIj7guYTguKHguYjguJ7guJrguKvguLHguKfguILguYnguK3guJfguLXguYjguIrguLHguJTguYDguIjguJnguYPguJnguYTguJ/guKXguYzguJnguLXguYk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8g4Liq4Lij4LmJ4Liy4LiHIEhUTUwg4LiX4Li14LmI4Lih4Li14LiX4Lix4LmJ4LiH4Lib4Li44LmI4LihICLguKrguKPguYnguLLguIfguYDguJnguLfguYnguK3guKvguLIiIOC5geC4peC4sCAi4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIgogICAgdG9waWNzTGlzdERpdi5pbm5lckhUTUwgPSBleHRyYWN0ZWRGaWxlVG9waWNzLm1hcCh0b3BpYyA9PiBgCiAgICAgICAgPGRpdiBjbGFzcz0icC0yIHJvdW5kZWQtbWQgYmctZ3JheS01MCBib3JkZXIgYm9yZGVyLWdyYXktMjAwIGZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnYXAtMiI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAgZmxleC1ncm93IHRleHQtbGVmdCI+JHt0b3BpY308L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ2VuZXJhdGUtY29udGVudC1idG4gdGV4dC1ibHVlLTgwMCBiZy1ibHVlLTEwMCBob3ZlcjpiZy1ibHVlLTIwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMS41IHB4LTMgcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMS41IiBkYXRhLXRvcGljPSIke2VzY2FwZSh0b3BpYyl9Ij4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoYWxrYm9hcmQtdGVhY2hlciI+PC9pPuC4quC4o+C5ieC4suC4h+C5gOC4meC4t+C5ieC4reC4q+C4suC4quC4s+C4q+C4o+C4seC4muC4quC4reC4mQogICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJmaWxlLXRvcGljLXNlbGVjdGlvbi1idG4gdGV4dC1pbmRpZ28tODAwIGJnLWluZGlnby0xMDAgaG92ZXI6YmctaW5kaWdvLTIwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMS41IHB4LTMgcm91bmRlZC1tZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMS41IiBkYXRhLXRvcGljPSIke2VzY2FwZSh0b3BpYyl9Ij4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZpbGUtYWx0Ij48L2k+4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgKS5qb2luKCcnKTsKfQoKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVIeWJyaWRRdWl6Rm9yVG9waWMoc2VsZWN0ZWRUb3BpYykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2VuZXJhdGVGcm9tRmlsZUNsaWNrKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gYXV0b0Zvcm1hdE1hdGgodGV4dCkgewogICAgaWYgKHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJyB8fCAhdGV4dCkgewogICAgICAgIHJldHVybiB0ZXh0OwogICAgfQoKICAgIC8vIFJlZ2V4IOC4meC4teC5ieC4iOC4sOC4oeC4reC4h+C4q+C4suC4meC4tOC4nuC4iOC4meC5jOC4l+C4teC5iOC4nuC4muC4muC5iOC4reC4ouC5hiDguYDguIrguYjguJkgIuC4leC4seC4p+C5gOC4peC4giBcdGltZXMg4LiV4Lix4Lin4LmA4Lil4LiCIiwgIuC4leC4seC4p+C5gOC4peC4gl7guJXguLHguKfguYDguKXguIIiLCDguKvguKPguLfguK3guITguLPguKrguLHguYjguIcgTGFUZVggCiAgICAvLyDguYLguJTguKLguIjguLDguJfguLPguIfguLLguJnguYDguInguJ7guLLguLDguIHguLHguJrguKrguYjguKfguJnguJfguLXguYjguKLguLHguIfguYTguKHguYjguYTguJTguYnguJbguLnguIHguITguKPguK3guJrguJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKIgJCDguK3guKLguLnguYjguYHguKXguYnguKcKICAgIGNvbnN0IG1hdGhQYXR0ZXJuID0gLygoPzwhXCQpXGIoXGQrKFwuXGQrKT9ccyooXFx0aW1lc3xcXGRpdilccypcZCsoXC5cZCspP3woXGQrXHMqXF5ccypcez9cZCtcfT8pfChcXGZyYWN8XFxzcXJ0fFxccG18XFxnZXF8XFxsZXF8XFxuZXEpKVxiKD8hXCQpKS9nOwoKICAgIGxldCBmb3JtYXR0ZWRUZXh0ID0gdGV4dC5yZXBsYWNlKG1hdGhQYXR0ZXJuLCAobWF0Y2gpID0+IHsKICAgICAgICAvLyDguITguKPguK3guJrguJnguLTguJ7guIjguJnguYzguJfguLXguYjguKvguLLguYDguIjguK3guJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKIgJAogICAgICAgIHJldHVybiBgJCR7bWF0Y2gudHJpbSgpfSRgOwogICAgfSk7CgogICAgcmV0dXJuIGZvcm1hdHRlZFRleHQ7Cn0KCiAgICAgICAgZnVuY3Rpb24gc2FuaXRpemVRdWl6RGF0YShxdWl6RGF0YSkgewogICAgaWYgKCFxdWl6RGF0YSB8fCAhcXVpekRhdGEucXVlc3Rpb25zKSByZXR1cm4gcXVpekRhdGE7CgogICAgY29uc3Qgc2FuaXRpemVUZXh0ID0gKHRleHQpID0+IHsKICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ICE9PSAnc3RyaW5nJykgcmV0dXJuIHRleHQ7CiAgICAgICAgICAgIGxldCBzID0gdGV4dDsKCiAgICAgICAgICAgIC8vIDEuIOC5geC4m+C4peC4h+C4p+C4h+C5gOC4peC5h+C4miBcKCAuLi4gXCkg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZICQgLi4uICQgKOC4guC4reC4h+C5gOC4lOC4tOC4oSkKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFxcKC9nLCAnJCcpLnJlcGxhY2UoL1xcXCkvZywgJyQnKTsKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFxcWy9nLCAnJCQnKS5yZXBsYWNlKC9cXFxdL2csICckJCcpOwoKICAgICAgICAgICAgLy8gMi4g4LmB4LiB4LmJ4LmE4LiCIGltZXMg4LmA4Lib4LmH4LiZIHRpbWVzICjguILguK3guIfguYDguJTguLTguKHguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcg4LmB4LiV4LmI4Lit4Liy4LiI4LmE4Lih4LmI4LiE4Lij4Lit4Lia4LiE4Lil4Li44LihKQogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9pbWVzXGIvZywgJ1xcdGltZXMnKTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDilrzilrzilrwgW+C5gOC4nuC4tOC5iOC4oeC4iuC4uOC4lOC4hOC4s+C4quC4seC5iOC4h+C4i+C5iOC4reC4oeC5geC4i+C4oeC4hOC4s+C4quC4seC5iOC4hyBMYVRlWCDguJfguLXguYggQmFja3NsYXNoIOC4q+C4suC4ouC5hOC4m10g4pa84pa84pa8CiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UoL1xcP3RleHRcYi9nLCAnXFx0ZXh0Jyk7ICAgLy8g4LmB4LiB4LmJIGV4dCAtPiBcdGV4dAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9zcXJ0XGIvZywgJ1xcc3FydCcpOyAgIC8vIOC5geC4geC5iSBzcXJ0IC0+IFxzcXJ0CiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UoL1xcP2ZyYWNcYi9nLCAnXFxmcmFjJyk7ICAgLy8g4LmB4LiB4LmJIGZyYWMgLT4gXGZyYWMKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/Y2RvdFxiL2csICdcXGNkb3QnKTsgICAvLyDguYHguIHguYkgY2RvdCAtPiBcY2RvdAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9waVxiL2csICdcXHBpJyk7ICAgICAgIC8vIOC5geC4geC5iSBwaSAtPiBccGkKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/ZGl2XGIvZywgJ1xcZGl2Jyk7ICAgICAvLyDguYHguIHguYkgZGl2IC0+IFxkaXYKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/bGVxXGIvZywgJ1xcbGVxJyk7ICAgICAvLyDguYHguIHguYkgbGVxIC0+IFxsZXEKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/Z2VxXGIvZywgJ1xcZ2VxJyk7ICAgICAvLyDguYHguIHguYkgZ2VxIC0+IFxnZXEKICAgICAgICAgICAgcyA9IHMucmVwbGFjZSgvXFw/YXBwcm94XGIvZywgJ1xcYXBwcm94Jyk7IC8vIOC5geC4geC5iSBhcHByb3ggLT4gXGFwcHJveAogICAgICAgICAgICBzID0gcy5yZXBsYWNlKC9cXD9uZVxiL2csICdcXG5lJyk7ICAgICAgIC8vIOC5geC4geC5iSBuZSAtPiBcbmUKICAgICAgICAgICAgLy8g4pay4pay4payCgogICAgICAgICAgICAvLyAzLiBBdXRvIEZvcm1hdCAo4LiI4Lix4Lia4LiV4Lix4Lin4LmA4Lil4LiCL+C4quC4ueC4leC4o+C4l+C4teC5iOC4peC4reC4ouC5hiDguKHguLLguYPguKrguYggJCDguYPguKvguYkpCiAgICAgICAgICAgIGNvbnN0IG1hdGhQYXR0ZXJuID0gLygoPzwhXCQpXGIoXGQrKFwuXGQrKT9ccyooXFx0aW1lc3xcXGRpdnxcXGNkb3QpXHMqXGQrKFwuXGQrKT98KFxcZnJhY1x7Lis/XH1cey4rP1x9KXwoXFxzcXJ0XHsuKz9cfSl8KFxcdGV4dFx7Lis/XH0pfChcXHBtfFxcZ2VxfFxcbGVxfFxcbmVxKSlcYig/IVwkKSkvZzsKICAgICAgICAgICAgCiAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UobWF0aFBhdHRlcm4sIChtYXRjaCkgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGAkJHttYXRjaC50cmltKCl9JGA7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfTsKCiAgICBpZiAocXVpekRhdGEudG9waWMpIHsKICAgICAgICBxdWl6RGF0YS50b3BpYyA9IHNhbml0aXplVGV4dChxdWl6RGF0YS50b3BpYyk7CiAgICB9CgogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgcS5xdWVzdGlvblRleHQgPSBzYW5pdGl6ZVRleHQocS5xdWVzdGlvblRleHQpOwogICAgICAgIHEuc3RlbSA9IHNhbml0aXplVGV4dChxLnN0ZW0pOwogICAgICAgIAogICAgICAgIGlmIChxLm9wdGlvbnMpIHsKICAgICAgICAgICAgcS5vcHRpb25zID0gcS5vcHRpb25zLm1hcChvcHQgPT4gc2FuaXRpemVUZXh0KG9wdCkpOwogICAgICAgIH0gCiAgICAgICAgCiAgICAgICAgaWYgKHEuY29ycmVjdFJlc3BvbnNlKSB7CiAgICAgICAgICAgIHEuY29ycmVjdFJlc3BvbnNlID0gc2FuaXRpemVUZXh0KHEuY29ycmVjdFJlc3BvbnNlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHEuYWxsUmVzcG9uc2VzKSB7CiAgICAgICAgICAgIHEuYWxsUmVzcG9uc2VzID0gcS5hbGxSZXNwb25zZXMubWFwKHJlc3AgPT4gc2FuaXRpemVUZXh0KHJlc3ApKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHEuaWRlYWxBbnN3ZXIpIHsKICAgICAgICAgICAgIHEuaWRlYWxBbnN3ZXIgPSBzYW5pdGl6ZVRleHQocS5pZGVhbEFuc3dlcik7CiAgICAgICAgfQogICAgfSk7CgogICAgcmV0dXJuIHF1aXpEYXRhOwp9CgogICAgICAgIC8vIC0tLSBRdWl6IEdlbmVyYXRpb24gKEFkbWluKSAtLS0KICAgICAgICBjb25zdCBzaW1wbGVNYXRoUHJvbXB0ID0gIuC4geC4juC5gOC4q+C4peC5h+C4gTog4LiZ4Li04Lie4LiI4LiZ4LmM4LiX4Liy4LiH4LiE4LiT4Li04LiV4Lio4Liy4Liq4LiV4Lij4LmM4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiV4LmJ4Lit4LiH4Lit4Lii4Li54LmI4LmD4LiZ4Lij4Li54Lib4LmB4Lia4LiaIExhVGVYIOC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyDguYHguKXguLDguJXguYnguK3guIfguJbguLnguIHguKvguYjguK3guKvguLjguYnguKHguJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKLguJTguK3guKXguKXguLLguKPguYwgKCQpIOC5gOC4nuC4teC4ouC4h+C4hOC4ueC5iOC5gOC4lOC4teC4ouC4pyI7Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVHZW5lcmF0ZUZyb21MaW5rKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gZXh0cmFjdFRleHRGcm9tSHRtbChodG1sU3RyaW5nKSB7CiAgICBjb25zdCBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGh0bWxTdHJpbmcsICd0ZXh0L2h0bWwnKTsKICAgIAogICAgLy8g4Lil4Lia4LmB4LiX4LmH4LiB4LiX4Li14LmI4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lit4Lit4LiB4LmE4Lib4LiB4LmI4Lit4LiZIOC5gOC4iuC5iOC4mSBzY3JpcHQsIHN0eWxlLCBuYXYsIGZvb3RlcgogICAgZG9jLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NjcmlwdCwgc3R5bGUsIG5hdiwgZm9vdGVyLCBoZWFkZXIsIGFzaWRlJykuZm9yRWFjaChlbCA9PiBlbC5yZW1vdmUoKSk7CiAgICAKICAgIC8vIOC4lOC4tuC4h+C4guC5ieC4reC4hOC4p+C4suC4oeC4iOC4suC4gSBib2R5CiAgICByZXR1cm4gZG9jLmJvZHkudGV4dENvbnRlbnQgfHwgIiI7Cn0KCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXRvcGljLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgLy8g4LiU4Li24LiH4LiE4LmI4Liy4LiI4Liy4LiB4LiK4LmI4Lit4LiH4Lir4Lix4Lin4LiC4LmJ4Lit4Lir4Lil4Lix4LiB4LmA4Lie4Li14Lii4LiH4Lit4Lii4LmI4Liy4LiH4LmA4LiU4Li14Lii4LinCiAgICBjb25zdCB0b3BpYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BpYy1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKCiAgICAvLyDguYTguKHguYjguJXguYnguK3guIfguKHguLXguIHguLLguKPguJXguKPguKfguIjguKrguK3guJrguYDguIfguLfguYjguK3guJnguYTguILguYPguJTguYYg4LiX4Li14LmI4LiZ4Li14LmICiAgICAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVRdWl6IOC5guC4lOC4ouC4leC4o+C4hwogICAgLy8g4Lir4Liy4LiBICd0b3BpYycg4LmA4Lib4LmH4LiZ4LiE4LmI4Liy4Lin4LmI4Liy4LiHICgnJykg4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIGdlbmVyYXRlUXVpeiDguJfguLXguYjguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcKICAgIC8vIOC4iOC4sOC4iOC4seC4lOC4geC4suC4o+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4miAi4LiE4Lin4Liy4Lih4Lij4Li54LmJ4LiX4Lix4LmI4Lin4LmE4LibIiDguYPguKvguYnguYDguK3guIcKICAgIGdlbmVyYXRlUXVpeih0b3BpYywgbnVsbCk7Cn0pOwoKICAgIC8vIOKWvOKWvOKWvC0tLSDguKfguLLguIfguYLguITguYnguJTguYPguKvguKHguYjguJXguYjguK3guJfguYnguLLguKLguJXguKPguIfguJnguLXguYnguYTguJTguYnguYDguKXguKIgLS0t4pa84pa84pa8CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS10ZXh0LWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbnN0IHRleHRDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RleHQtY29udGVudC1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICAgICAgICBpZiAoIXRleHRDb250ZW50KSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguKfguLLguIfguYDguJnguLfguYnguK3guKvguLLguJfguLXguYjguJXguYnguK3guIfguIHguLLguKPguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCB0b3BpYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b3BpYy1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICAgICAgICBnZW5lcmF0ZVF1aXoodG9waWMsIHRleHRDb250ZW50KTsKICAgIH0pOwoJCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgZ2VuZXJhdGVRdWl6IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCDilrzilrzilrwKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVRdWl6KHRvcGljLCB0ZXh0Q29udGVudCwgc2luZ2xlUXVlc3Rpb25JbmRleCA9IG51bGwsIGV4dHJhUGFydHMgPSBudWxsLCBmcm9tQmx1ZXByaW50UGFnZSA9IGZhbHNlLCBmb3JjZWRQcm9qZWN0SWQgPSBudWxsLCBibHVlcHJpbnRUb3BpY0lkID0gbnVsbCwgZm9yY2VBcHBsaWNhdGlvblN0eWxlID0gZmFsc2UpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUXVpekZyb21GaWxlKG1pbWVUeXBlLCBiYXNlNjREYXRhKSB7CiAgICAgICAgY29uc3QgdG9waWMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZS10b3BpYy1pbnB1dCcpLnZhbHVlLnRyaW0oKTsKICAgICAgICBjb25zdCBxdWl6VHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXR5cGUtc2VsZWN0JykudmFsdWU7CiAgICAgICAgY29uc3QgbnVtUXVlc3Rpb25zID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1xdWVzdGlvbnMnKS52YWx1ZSkgfHwgNTsKICAgICAgICBjb25zdCBudW1DaG9pY2VzID0gcGFyc2VJbnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bS1jaG9pY2VzJykudmFsdWUpIHx8IDQ7CiAgICAgICAgY29uc3QgaW5jbHVkZUltYWdlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbmNsdWRlLWltYWdlcy1jaGVja2JveCcpLmNoZWNrZWQ7CiAgICAgICAgY29uc3QgaXNOb3JtYWxUb3BpYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmb3JjZS1tYXRoLWNoZWNrYm94JykuY2hlY2tlZDsKICAgICAgICBjb25zdCBzdWJqZWN0UHJlZml4ID0gaXNOb3JtYWxUb3BpYyA/ICIiIDogIuC4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jCI7CiAgICAgICAgCiAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Liq4LiW4Liy4LiZ4LiwIE9yaWdpbmFsIE1vZGUKICAgICAgICBjb25zdCBpc09yaWdpbmFsTW9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmlnaW5hbC1tb2RlLWNoZWNrYm94JykuY2hlY2tlZDsKICAgICAgICBjb25zdCBibHVlcHJpbnRUb3BpY0lkID0gbnVsbDsgCiAgICAgICAgY29uc3QgZm9yY2VkUHJvamVjdElkID0gY3VycmVudFByb2plY3RJZDsKCiAgICAgICAgbGV0IHByb21wdCA9ICIiOwogICAgICAgIGxldCBmaW5hbFNjaGVtYTsgCiAgICAgICAgbGV0IGxvYWRpbmdNZXNzYWdlID0gIuC4geC4s+C4peC4seC4h+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC5hOC4n+C4peC5jC4uLiI7CgogICAgICAgIGNvbnN0IHNpbXBsZU1hdGhQcm9tcHQgPSBgCiAgICAgICAgLSDguKvguLLguIHguYDguJvguYfguJnguYLguIjguJfguKLguYzguITguJPguLTguJXguKjguLLguKrguJXguKPguYwg4LmD4Lir4LmJ4LmD4LiK4LmJIExhVGVYIOC5g+C4meC4geC4suC4o+C5gOC4guC4teC4ouC4meC4quC4oeC4geC4suC4o+C4l+C4suC4h+C4hOC4k+C4tOC4leC4qOC4suC4quC4leC4o+C5jCDguYLguJTguKLguITguKPguK3guJrguJTguYnguKfguKLguYDguITguKPguLfguYjguK3guIfguKvguKHguLLguKIgJCAo4LmA4LiK4LmI4LiZICR4XjIgKyAyeCArIDEgPSAwJCkKICAgICAgICBgOwoKICAgICAgICBpZiAoaXNPcmlnaW5hbE1vZGUpIHsKICAgICAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgICAgIC8vIPCfmoAg4LmC4Lir4Lih4LiUIDE6IE9SSUdJTkFMIE1PREUgKOC4m+C4o+C4seC4muC4m+C4o+C4uOC4h+C4geC4suC4o+C5geC4geC4sOC4leC4seC4p+C5gOC4peC4t+C4reC4gSkKICAgICAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgICAgIGxvYWRpbmdNZXNzYWdlID0gIuC4geC4s+C4peC4seC4h+C4luC4reC4lOC4o+C4q+C4seC4quC4guC5ieC4reC4quC4reC4muC5geC4peC4sOC5geC4ouC4geC4leC4seC4p+C5gOC4peC4t+C4reC4gSAoT3JpZ2luYWwgTW9kZSkuLi4iOwogICAgICAgICAgICBwcm9tcHQgPSBgCiAgICAgICAgICAgIOC4muC4l+C4muC4suC4lzog4LiE4Li44LiT4LiE4Li34Lit4LmA4LiE4Lij4Li34LmI4Lit4LiH4Lih4Li34Lit4LiW4Lit4LiU4Lij4Lir4Lix4Liq4LiC4LmJ4Lit4Liq4Lit4LiaIChFeGFtIFBhcnNlcikg4LiX4Li14LmI4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiN4LiB4Liy4Lij4LmB4Lii4LiB4LmB4Lii4Liw4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiHCiAgICAgICAgICAgIOC4oOC4suC4o+C4geC4tOC4iDog4LiW4Lit4LiU4LiE4Lin4Liy4Lih4LiC4LmJ4Lit4Liq4Lit4Lia4LiI4Liy4LiB4LmE4Lif4Lil4LmM4LmD4Lir4LmJ4Lit4Lii4Li54LmI4LmD4LiZ4Lij4Li54Lib4LmB4Lia4LiaIEpTT04g4LmC4LiU4Lii4Lij4Lix4LiB4Lip4LiyICLguIjguLPguJnguKfguJnguILguYnguK0iIOC4leC4suC4oeC4leC5ieC4meC4ieC4muC4seC4mgogICAgICAgICAgICAKICAgICAgICAgICAg4LiE4Liz4Liq4Lix4LmI4LiH4Liq4Liz4LiE4Lix4LiNIChTdHJpY3QgUGFyc2luZyBSdWxlcyk6CiAgICAgICAgICAgIDEuICoqQ2xlYW4gRXh0cmFjdGlvbiAo4LiV4Lix4LiU4LmA4Lil4LiC4LiC4LmJ4LitKToqKiDguITguLHguJTguKXguK3guIHguYLguIjguJfguKLguYzguK3guK3guIHguKHguLIg4LmB4LiV4LmI4LiV4Lix4LiU4LmA4Lil4LiC4LiC4LmJ4LitICgxLiwgMi4sICgzKSkg4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LmC4LiI4LiX4Lii4LmMCiAgICAgICAgICAgIDIuICoqT3B0aW9uIEV4dHJhY3Rpb24gKOC4quC4s+C4hOC4seC4jeC4oeC4suC4gSk6KiogLSDguKvguLLguIHguJ7guJrguILguYnguK3guITguKfguLLguKHguJfguLXguYjguKHguLXguKXguLHguIHguKnguJPguLDguYDguJvguYfguJnguJXguLHguKfguYDguKXguLfguK3guIEg4LmA4LiK4LmI4LiZIOC4gS4sIOC4gi4sIOC4hC4sIOC4hy4g4Lir4Lij4Li34LitIGEpLCBiKSwgYyksIGQpIOC4q+C4o+C4t+C4rSAxKSwgMiksIDMpLCA0KSDguJfguLXguYjguK3guKLguLnguYjguJXguYjguK3guJfguYnguLLguKLguYLguIjguJfguKLguYwKICAgICAgICAgICAgICAgLSAqKuC4q+C5ieC4suC4oSoqIOC4meC4s+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5gOC4q+C4peC5iOC4suC4meC4seC5ieC4meC5hOC4m+C4o+C4p+C4oeC5g+C4mSAicXVlc3Rpb25UZXh0IiDguYDguJTguYfguJTguILguLLguJQKICAgICAgICAgICAgICAgLSAqKuC4leC5ieC4reC4hyoqIOC5geC4ouC4geC4guC5ieC4reC4hOC4p+C4suC4oeC5gOC4q+C4peC5iOC4suC4meC4seC5ieC4meC4reC4reC4geC4oeC4suC5g+C4quC5iOC5g+C4mSBBcnJheSDguIrguLfguYjguK0gIm9wdGlvbnMiCiAgICAgICAgICAgICAgIC0g4LiV4LmJ4Lit4LiH4Lij4Liw4Lia4Li4ICJxdWVzdGlvblR5cGUiIOC5gOC4m+C5h+C4mSAibXVsdGlwbGVfY2hvaWNlIgogICAgICAgICAgICAzLiAqKkF1dG8tU29sdmU6KiogLSDguKvguLLguIHguYPguJnguYTguJ/guKXguYzguYTguKHguYjguKHguLXguYDguInguKXguKLguKPguLDguJrguLjguYTguKfguYkg4LmD4Lir4LmJ4LiE4Li44LiTICoq4LiE4Li04LiU4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmA4Lit4LiHKiog4LmB4Lil4LmJ4Lin4LmD4Liq4LmIIGluZGV4ICgwLTMpIOC5g+C4mSAiY29ycmVjdEFuc3dlckluZGV4IgogICAgICAgICAgICAgICAtIOC4q+C5ieC4suC4oeC4quC5iOC4h+C4hOC5iOC4siBudWxsIOC4oeC4suC5g+C4mSBjb3JyZWN0QW5zd2VySW5kZXgKICAgICAgICAgICAgNC4gKirguIjguLPguJnguKfguJnguILguYnguK06Kiog4LiV4LmJ4Lit4LiH4LiE4Lij4Lia4LiV4Liy4Lih4LmE4Lif4Lil4LmM4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaIChWZXJiYXRpbSBjb3VudCkKICAgICAgICAgICAgCiAgICAgICAgICAgICR7c2ltcGxlTWF0aFByb21wdH0KICAgICAgICAgICAgYDsKCiAgICAgICAgICAgIGZpbmFsU2NoZW1hID0gewogICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgdG9waWM6IHsgdHlwZTogIlNUUklORyIsIGRlc2NyaXB0aW9uOiAi4Lir4Lix4Lin4LiC4LmJ4Lit4LiI4Liy4LiB4LmE4Lif4Lil4LmMIiB9LAogICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uczogewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiQVJSQVkiLAogICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciLCBkZXNjcmlwdGlvbjogIuC5guC4iOC4l+C4ouC5jCAo4LmE4Lih4LmI4Lij4Lin4Lih4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBKSIgfSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UeXBlOiB7IHR5cGU6ICJTVFJJTkciLCAiZW51bSI6IFsibXVsdGlwbGVfY2hvaWNlIiwgInNob3J0X2Fuc3dlciIsICJ0cnVlX2ZhbHNlIiwgIm1hdGNoaW5nX2l0ZW0iLCAiZmlsbF9pbl93aXRoX2Nob2ljZXMiLCAiZmlsbF9pbl9ub19jaG9pY2VzIl0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0sIGRlc2NyaXB0aW9uOiAi4Lij4Liy4Lii4LiB4Liy4Lij4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Li14LmI4LmB4Lii4LiB4Lit4Lit4LiB4Lih4Liy4LiI4Liy4LiB4LmC4LiI4LiX4Lii4LmMICjguJXguYnguK3guIfguKHguLXguK3guKLguYjguLLguIfguJnguYnguK3guKIgMiDguILguYnguK3guJbguYnguLLguYDguJvguYfguJnguJvguKPguJnguLHguKIpIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXJJbmRleDogeyB0eXBlOiAiTlVNQkVSIiwgZGVzY3JpcHRpb246ICLguJTguLHguIrguJnguLXguILguYnguK3guJfguLXguYjguJbguLnguIEgKDAsIDEsIDIsIDMuLi4pIOC4leC5ieC4reC4h+C4oeC4teC4hOC5iOC4suC5gOC4quC4oeC4rSIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZGVhbEFuc3dlcjogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RBbnN3ZXI6IHsgdHlwZTogIkJPT0xFQU4iIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlbTogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RSZXNwb25zZTogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsbFJlc3BvbnNlczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9IH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1hZ2VDb2RlOiB7IHR5cGU6ICJTVFJJTkciIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJxdWVzdGlvblRleHQiLCAicXVlc3Rpb25UeXBlIl0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJ0b3BpYyIsICJxdWVzdGlvbnMiXQogICAgICAgICAgICB9OwoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgLy8g8J+agCDguYLguKvguKHguJQgMjogTk9STUFMIE1PREUgKER5bmFtaWMgU2NoZW1hKQogICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgbG9hZGluZ01lc3NhZ2UgPSBg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4LiaICR7cXVpelR5cGV9IOC4iOC4s+C4meC4p+C4mSAke251bVF1ZXN0aW9uc30g4LiC4LmJ4LitLi4uYDsKICAgICAgICAgICAgY29uc3QgdG9waWNJbnN0cnVjdGlvbiA9IHRvcGljID8gYOC4q+C4seC4p+C4guC5ieC4reC4q+C4peC4seC4gTogIiR7dG9waWN9ImAgOiBg4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lir4Lix4Lin4LiC4LmJ4Lit4Liq4Liz4LiE4Lix4LiN4LiI4Liy4LiB4LmE4Lif4Lil4LmMYDsKCiAgICAgICAgICAgIGxldCBzcGVjaWZpY0l0ZW1TY2hlbWE7CgogICAgICAgICAgICBpZiAocXVpelR5cGUuaW5jbHVkZXMoJ211bHRpcGxlJykgfHwgcXVpelR5cGUuaW5jbHVkZXMoJ+C4m+C4o+C4meC4seC4oicpKSB7CiAgICAgICAgICAgICAgICBzcGVjaWZpY0l0ZW1TY2hlbWEgPSB7CiAgICAgICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllczogewogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblRleHQ6IHsgdHlwZTogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UeXBlOiB7IHR5cGU6ICJTVFJJTkciLCAiZW51bSI6IFsibXVsdGlwbGVfY2hvaWNlIl0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogeyB0eXBlOiAiU1RSSU5HIiB9LCBkZXNjcmlwdGlvbjogYOC4leC4seC4p+C5gOC4peC4t+C4reC4gSAke251bUNob2ljZXN9IOC4guC5ieC4rWAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJxdWVzdGlvblR5cGUiLCAib3B0aW9ucyIsICJjb3JyZWN0QW5zd2VySW5kZXgiXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIGlmIChxdWl6VHlwZS5pbmNsdWRlcygndHJ1ZScpIHx8IHF1aXpUeXBlLmluY2x1ZGVzKCfguJbguLnguIHguJzguLTguJQnKSkgewogICAgICAgICAgICAgICAgc3BlY2lmaWNJdGVtU2NoZW1hID0gewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICJPQkpFQ1QiLAogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb25UZXh0OiB7IHR5cGU6ICJTVFJJTkciIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVHlwZTogeyB0eXBlOiAiU1RSSU5HIiwgImVudW0iOiBbInRydWVfZmFsc2UiXSB9LAogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0QW5zd2VyOiB7IHR5cGU6ICJCT09MRUFOIiB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJxdWVzdGlvblRleHQiLCAicXVlc3Rpb25UeXBlIiwgImNvcnJlY3RBbnN3ZXIiXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIGlmIChxdWl6VHlwZS5pbmNsdWRlcygnbWF0Y2gnKSB8fCBxdWl6VHlwZS5pbmNsdWRlcygn4LiI4Lix4Lia4LiE4Li54LmIJykpIHsKICAgICAgICAgICAgICAgIHNwZWNpZmljSXRlbVNjaGVtYSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGU6IHsgdHlwZTogIlNUUklORyIsICJlbnVtIjogWyJtYXRjaGluZ19pdGVtIl0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RlbTogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0UmVzcG9uc2U6IHsgdHlwZTogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgYWxsUmVzcG9uc2VzOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsicXVlc3Rpb25UZXh0IiwgInF1ZXN0aW9uVHlwZSIsICJzdGVtIiwgImNvcnJlY3RSZXNwb25zZSIsICJhbGxSZXNwb25zZXMiXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNwZWNpZmljSXRlbVNjaGVtYSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBxdWVzdGlvblR5cGU6IHsgdHlwZTogIlNUUklORyIsICJlbnVtIjogWyJtdWx0aXBsZV9jaG9pY2UiLCAic2hvcnRfYW5zd2VyIiwgInRydWVfZmFsc2UiLCAibWF0Y2hpbmdfaXRlbSJdIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LAogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0QW5zd2VySW5kZXg6IHsgdHlwZTogIk5VTUJFUiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgaWRlYWxBbnN3ZXI6IHsgdHlwZTogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdEFuc3dlcjogeyB0eXBlOiAiQk9PTEVBTiIgfSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RlbTogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0UmVzcG9uc2U6IHsgdHlwZTogIlNUUklORyIgfQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFsicXVlc3Rpb25UZXh0IiwgInF1ZXN0aW9uVHlwZSJdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaW5jbHVkZUltYWdlcykgewogICAgICAgICAgICAgICAgc3BlY2lmaWNJdGVtU2NoZW1hLnByb3BlcnRpZXMuaW1hZ2VDb2RlID0geyB0eXBlOiAiU1RSSU5HIiwgZGVzY3JpcHRpb246ICJTVkcgQ29kZSDguJbguYnguLLguIjguLPguYDguJvguYfguJkiIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZpbmFsU2NoZW1hID0gewogICAgICAgICAgICAgICAgdHlwZTogIk9CSkVDVCIsCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgdG9waWM6IHsgdHlwZTogIlNUUklORyIgfSwKICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIkFSUkFZIiwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXM6IHNwZWNpZmljSXRlbVNjaGVtYQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICByZXF1aXJlZDogWyJ0b3BpYyIsICJxdWVzdGlvbnMiXQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcHJvbXB0ID0gYAogICAgICAgICAgICDguJrguJfguJrguLLguJc6IOC4hOC4uOC4k+C4hOC4t+C4reC4hOC4o+C4ueC4nOC4ueC5ieC5gOC4iuC4teC5iOC4ouC4p+C4iuC4suC4jeC4p+C4tOC4iuC4siR7c3ViamVjdFByZWZpeH0KICAgICAgICAgICAg4LiH4Liy4LiZOiDguKrguKPguYnguLLguIfguYHguJrguJrguJfguJTguKrguK3guJrguJvguKPguLDguYDguKDguJcgIiR7cXVpelR5cGV9IiDguIjguLPguJnguKfguJkgJHtudW1RdWVzdGlvbnN9IOC4guC5ieC4rQogICAgICAgICAgICDguK3guYnguLLguIfguK3guLTguIfguYDguJnguLfguYnguK3guKvguLLguIjguLLguIE6IOC5hOC4n+C4peC5jOC4l+C4teC5iOC5geC4meC4muC4oeC4sgogICAgICAgICAgICAke3RvcGljSW5zdHJ1Y3Rpb259CiAgICAgICAgICAgIAogICAgICAgICAgICDguILguYnguK3guIHguLPguKvguJnguJQ6CiAgICAgICAgICAgIC0g4Liq4Lij4LmJ4Liy4LiH4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiX4LmJ4Liy4LiX4Liy4LiiCiAgICAgICAgICAgIC0g4LiW4LmJ4Liy4LmA4Lib4LmH4LiZ4Lib4Lij4LiZ4Lix4LiiIOC4guC4reC4leC4seC4p+C5gOC4peC4t+C4reC4gSAke251bUNob2ljZXN9IOC4leC4seC4pwogICAgICAgICAgICAtIOC4oOC4suC4qeC4sjog4LmE4LiX4LiiCiAgICAgICAgICAgICR7c2ltcGxlTWF0aFByb21wdH0KICAgICAgICAgICAgJHtpbmNsdWRlSW1hZ2VzID8gJy0g4Lir4Liy4LiB4LiC4LmJ4Lit4LmE4Lir4LiZ4LiV4LmJ4Lit4LiH4LmD4LiK4LmJ4Lij4Li54Lib4Lib4Lij4Liw4LiB4Lit4LiaIOC5g+C4q+C5ieC4quC4o+C5ieC4suC4hyBTVkcgY29kZSDguYPguKrguYjguYPguJkgaW1hZ2VDb2RlJyA6ICcnfQogICAgICAgICAgICBgOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgYXBpUGF5bG9hZCA9IFsKICAgICAgICAgICAgeyB0ZXh0OiBwcm9tcHQgfSwKICAgICAgICAgICAgeyBpbmxpbmVEYXRhOiB7IG1pbWVUeXBlOiBtaW1lVHlwZSwgZGF0YTogYmFzZTY0RGF0YSB9IH0KICAgICAgICBdOwoKICAgICAgICAvLyDguK3guKLguYjguLLguKXguLfguKHguYDguIrguYfguITguIrguLfguYjguK3guYLguKHguYDguJTguKXguYPguJkgaGFuZGxlQXBpQ2FsbCDguYPguKvguYnguYDguJvguYfguJkgZ2VtaW5pLTEuNS1mbGFzaCDguYDguJ7guLfguYjguK3guYDguKXguLXguYjguKLguIcgUXVvdGEgRXJyb3IKICAgICAgICBhd2FpdCBoYW5kbGVBcGlDYWxsKGFwaVBheWxvYWQsIGxvYWRpbmdNZXNzYWdlLCBmaW5hbFNjaGVtYSwgbnVsbCwgdHJ1ZSwgZm9yY2VkUHJvamVjdElkLCBibHVlcHJpbnRUb3BpY0lkKTsKICAgIH0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFwaUNhbGwocHJvbXB0T3JQYXJ0cywgbG9hZGluZ01lc3NhZ2UsIHNjaGVtYSwgc2luZ2xlUXVlc3Rpb25JbmRleCA9IG51bGwsIHNob3VsZERpc3BsYXlRdWl6ID0gdHJ1ZSwgZm9yY2VkUHJvamVjdElkID0gbnVsbCwgYmx1ZXByaW50VG9waWNJZCA9IG51bGwpIHsKICAgIGNvbnN0IHF1aXpHZW5BcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZ2VuZXJhdGlvbi1hcmVhJyk7CiAgICBjb25zdCBsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGVyJyk7CiAgICBjb25zdCBsb2FkZXJUZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRlci10ZXh0Jyk7CiAgICBjb25zdCBnZW5RdWl6Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlZC1xdWl6LWNvbnRhaW5lcicpOwoKICAgIHF1aXpHZW5BcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgaWYgKHNpbmdsZVF1ZXN0aW9uSW5kZXggPT09IG51bGwgJiYgc2hvdWxkRGlzcGxheVF1aXopIHsKICAgICAgICBnZW5RdWl6Q29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgfQogICAgbG9hZGVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgbG9hZGVyVGV4dC50ZXh0Q29udGVudCA9IGxvYWRpbmdNZXNzYWdlOwoKICAgIC8vIOC4m+C4tOC4lOC4m+C4uOC5iOC4oeC4leC5iOC4suC4h+C5hiDguIrguLHguYjguKfguITguKPguLLguKcKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXRvcGljLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXRleHQtYnRuJykuZGlzYWJsZWQgPSB0cnVlOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tbGluay1idG4nKS5kaXNhYmxlZCA9IHRydWU7CiAgICBjb25zdCBmaWxlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWZyb20tZmlsZS1idG4nKTsKICAgIGlmIChmaWxlQnRuKSBmaWxlQnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgIGNvbnN0IGJsdWVwcmludEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLWJsdWVwcmludC1idG4nKTsKICAgIGlmIChibHVlcHJpbnRCdG4pIGJsdWVwcmludEJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBjb25zdCBwYXJhbGxlbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXBhcmFsbGVsLXRlc3QtYnRuJyk7CiAgICBpZiAocGFyYWxsZWxCdG4pIHBhcmFsbGVsQnRuLmRpc2FibGVkID0gdHJ1ZTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHBhcnRzID0gQXJyYXkuaXNBcnJheShwcm9tcHRPclBhcnRzKSA/IHByb21wdE9yUGFydHMgOiBbeyB0ZXh0OiBwcm9tcHRPclBhcnRzIH1dOwogICAgICAgIGNvbnN0IHBheWxvYWQgPSB7IGNvbnRlbnRzOiBbeyByb2xlOiAidXNlciIsIHBhcnRzOiBwYXJ0cyB9XSB9OwoKICAgICAgICBpZiAoc2NoZW1hKSB7CiAgICAgICAgICAgIHBheWxvYWQuZ2VuZXJhdGlvbkNvbmZpZyA9IHsKICAgICAgICAgICAgICAgIHJlc3BvbnNlTWltZVR5cGU6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgICAgIHJlc3BvbnNlU2NoZW1hOiBzY2hlbWEKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGFwaUtleSA9ICJBSXphU3lENHR1NlZqbjFCaEx4NHBZWFdFdEF3YWxXQ1AySU15RlkiOyAKICAgICAgICBjb25zdCBhcGlVcmwgPSBgaHR0cHM6Ly9nZW5lcmF0aXZlbGFuZ3VhZ2UuZ29vZ2xlYXBpcy5jb20vdjFiZXRhL21vZGVscy9nZW1pbmktMi41LWZsYXNoLXByZXZpZXctMDktMjAyNTpnZW5lcmF0ZUNvbnRlbnQ/a2V5PSR7YXBpS2V5fWA7CiAgICAgICAgCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhcGlVcmwsIHsgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LCBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSB9KTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIGNvbnN0IGVycm9yQm9keSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQVBJIEVycm9yIFJlc3BvbnNlOiIsIGVycm9yQm9keSk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQVBJIGNhbGwgZmFpbGVkIHdpdGggc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgICAgIAogICAgICAgIGlmICghcmVzdWx0LmNhbmRpZGF0ZXMgfHwgcmVzdWx0LmNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGxldCBkZXRhaWxlZEVycm9yID0gIkFJIGRpZCBub3QgcmV0dXJuIGFueSBjb250ZW50LiI7CiAgICAgICAgICAgIGlmIChyZXN1bHQucHJvbXB0RmVlZGJhY2s/LmJsb2NrUmVhc29uKSB7CiAgICAgICAgICAgICAgICBkZXRhaWxlZEVycm9yID0gYENvbnRlbnQgd2FzIGJsb2NrZWQgYnkgc2FmZXR5IGZpbHRlcnMuIFJlYXNvbjogJHtyZXN1bHQucHJvbXB0RmVlZGJhY2suYmxvY2tSZWFzb259LmA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihkZXRhaWxlZEVycm9yLCBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7IAogICAgICAgIH0KCiAgICAgICAgY29uc3QgcmF3VGV4dCA9IHJlc3VsdC5jYW5kaWRhdGVzWzBdLmNvbnRlbnQucGFydHNbMF0udGV4dDsKCiAgICAgICAgaWYgKHNjaGVtYSkgewogICAgICAgICAgICBsZXQganNvblRleHQgPSByYXdUZXh0OwogICAgICAgICAgICBpZiAoanNvblRleHQuc3RhcnRzV2l0aCgiYGBganNvbiIpKSB7CiAgICAgICAgICAgICAgICBqc29uVGV4dCA9IGpzb25UZXh0LnN1YnN0cmluZyg3LCBqc29uVGV4dC5sZW5ndGggLSAzKS50cmltKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoanNvblRleHQuc3RhcnRzV2l0aCgiYGBgIikpIHsKICAgICAgICAgICAgICAgIGpzb25UZXh0ID0ganNvblRleHQuc3Vic3RyaW5nKDMsIGpzb25UZXh0Lmxlbmd0aCAtIDMpLnRyaW0oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgcGFyc2VkRGF0YSA9IEpTT04ucGFyc2UoanNvblRleHQpOwoKICAgICAgICAgICAgLy8g4pa84pa84pa8IFvguIjguLjguJTguJfguLXguYjguYHguIHguYnguYTguIJdIOC4iOC4seC4lOC4geC4suC4o+C4hOC4s+C4luC4suC4oeC5geC4muC4muC4iOC4seC4muC4hOC4ueC5iCAoTWF0Y2hpbmcpIOC5g+C4q+C5ieC5g+C4iuC5ieC4leC4seC4p+C5gOC4peC4t+C4reC4geC4o+C5iOC4p+C4oeC4geC4seC4mSDilrzilrzilrwKICAgICAgICAgICAgaWYgKHBhcnNlZERhdGEucXVlc3Rpb25zICYmIEFycmF5LmlzQXJyYXkocGFyc2VkRGF0YS5xdWVzdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAvLyAxLiDguKvguLLguILguYnguK3guJfguLXguYjguYDguJvguYfguJnguYHguJrguJrguIjguLHguJrguITguLnguYgKICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoaW5nUXMgPSBwYXJzZWREYXRhLnF1ZXN0aW9ucy5maWx0ZXIocSA9PiBxLnF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKG1hdGNoaW5nUXMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICAgIC8vIDIuIOC4o+C4p+C4muC4o+C4p+C4oSAi4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHIiAoY29ycmVjdFJlc3BvbnNlKSDguIjguLLguIHguJfguLjguIHguILguYnguK3guKHguLLguYTguKfguYnguYPguJnguIHguK3guIfguIHguKXguLLguIcKICAgICAgICAgICAgICAgICAgICAvLyAo4LiB4Lij4Lit4LiH4LiE4LmI4Liy4Lin4LmI4Liy4LiH4LiX4Li04LmJ4LiH4LmE4LibIOC5gOC4nuC4t+C5iOC4reC4hOC4p+C4suC4oeC4iuC4seC4p+C4o+C5jCkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFyZWRQb29sID0gbWF0Y2hpbmdRcy5tYXAocSA9PiBxLmNvcnJlY3RSZXNwb25zZSkuZmlsdGVyKGFucyA9PiBhbnMgJiYgYW5zLnRyaW0oKSAhPT0gIiIpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDMuIOC4quC4uOC5iOC4oeC4peC4s+C4lOC4seC4muC4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4meC4geC4reC4h+C4geC4peC4suC4hyDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguYDguKPguLXguKLguIfguJXguLLguKHguILguYnguK0gKDEtPkEsIDItPkIpCiAgICAgICAgICAgICAgICAgICAgLy8gKOC5g+C4iuC5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBzaHVmZmxlQXJyYXkg4LiX4Li14LmI4Lih4Li14Lit4Lii4Li54LmI4LmB4Lil4LmJ4LinKQogICAgICAgICAgICAgICAgICAgIHNodWZmbGVBcnJheShzaGFyZWRQb29sKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gNC4g4Lii4Lix4LiU4LiB4Lit4LiH4LiB4Lil4Liy4LiH4LiB4Lil4Lix4Lia4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZICdhbGxSZXNwb25zZXMnIOC4guC4reC4h+C4l+C4uOC4geC4guC5ieC4rQogICAgICAgICAgICAgICAgICAgIG1hdGNoaW5nUXMuZm9yRWFjaChxID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcS5hbGxSZXNwb25zZXMgPSBbLi4uc2hhcmVkUG9vbF07IC8vIENvcHkgYXJyYXkg4LmE4Lib4LmD4Liq4LmICiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk1hdGNoaW5nIG9wdGlvbnMgc3luY2VkOiIsIHNoYXJlZFBvb2wpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOKWsuKWsuKWsiBb4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiCXSDilrLilrLilrIKCiAgICAgICAgICAgIGlmIChzaG91bGREaXNwbGF5UXVpeikgewogICAgICAgICAgICAgICAgaWYgKHNpbmdsZVF1ZXN0aW9uSW5kZXggIT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAvLyDguIHguKPguJPguLXguKrguKPguYnguLLguIfguYPguKvguKHguYjguKPguLLguKLguILguYnguK0gKFJlZ2VuZXJhdGUgc2luZ2xlIHF1ZXN0aW9uKQogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RWRpdGluZ1F1aXpEYXRhICYmIGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguILguYnguK3guJfguLXguYjguKrguKPguYnguLLguIfguYPguKvguKHguYjguYDguJvguYfguJkgbWF0Y2hpbmcg4LmA4Lij4Liy4LiV4LmJ4Lit4LiH4Lij4Liw4Lin4Lix4LiH4LmE4Lih4LmI4LmD4Lir4LmJ4Lih4Lix4LiZ4Lir4Lil4Li44LiU4LiB4Lil4Li44LmI4LihCiAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguYHguJXguYjguYPguJkgZWRpdG9yIOC4oeC4seC4geC5geC4geC5ieC4l+C4teC4peC4sOC4guC5ieC4rSDguIHguLLguKPguJTguLbguIcgcG9vbCDguYDguJTguLTguKHguKHguLLguYPguIrguYnguK3guLLguIjguIvguLHguJrguIvguYnguK3guJkgCiAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguJrguLfguYnguK3guIfguJXguYnguJnguYPguKvguYnguYPguIrguYnguILguYnguK3guKHguLnguKXguYPguKvguKHguYjguYTguJvguIHguYjguK3guJkg4Lir4Lij4Li34Lit4LiW4LmJ4Liy4LmA4Lib4LmH4LiZ4LmE4Lib4LmE4LiU4LmJ4LiE4Lin4Lij4Lit4LmI4Liy4LiZIHBvb2wg4LiI4Liy4LiB4LiC4LmJ4Lit4Lit4Li34LmI4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAvLyAo4LmD4LiZ4LiX4Li14LmI4LiZ4Li14LmJ4Lib4Lil4LmI4Lit4Lii4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4Lir4LiZ4LmJ4Liy4LiX4Li14LmI4LiC4Lit4LiHIEVkaXRvciBsb2dpYykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRRdWl6RGF0YSA9IHBhcnNlZERhdGE7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheUdlbmVyYXRlZFF1aXooY3VycmVudFF1aXpEYXRhLCBmb3JjZWRQcm9qZWN0SWQsIGJsdWVwcmludFRvcGljSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBwYXJzZWREYXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByYXdUZXh0OwogICAgICAgIH0KCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluIGhhbmRsZUFwaUNhbGw6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKGDguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKrguKPguYnguLLguIc6ICR7ZXJyb3IubWVzc2FnZX1gKTsKICAgICAgICBpZiAoc2hvdWxkRGlzcGxheVF1aXopIHsKICAgICAgICAgICAgZ2VuUXVpekNvbnRhaW5lci5pbm5lckhUTUwgPSBgPHAgY2xhc3M9InRleHQtcmVkLTUwMCB0ZXh0LWNlbnRlciI+4LiC4Lit4Lit4Lig4Lix4LiiLCDguYTguKHguYjguKrguLLguKHguLLguKPguJbguKrguKPguYnguLLguIfguYTguJTguYk8L3A+YDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICB9IGZpbmFsbHkgewogICAgICAgIGxvYWRlci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS10b3BpYy1idG4nKS5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZS1mcm9tLXRleHQtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGUtZnJvbS1saW5rLWJ0bicpLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgaWYgKGZpbGVCdG4pIGZpbGVCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBpZiAoYmx1ZXByaW50QnRuKSBibHVlcHJpbnRCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICBpZiAocGFyYWxsZWxCdG4pIHBhcmFsbGVsQnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICB9Cn0KCiAgICAgICAgZnVuY3Rpb24gZXhpdEZ1bGxzY3JlZW4oKSB7CiAgICAgICAgICAgIGlmIChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKS5jYXRjaChlcnIgPT4gY29uc29sZS5lcnJvcihlcnIpKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikgeyAvKiBTYWZhcmkgKi8KICAgICAgICAgICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbikgeyAvKiBJRTExICovCiAgICAgICAgICAgICAgICBkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgpmdW5jdGlvbiBlbnRlckZ1bGxzY3JlZW4oKSB7CiAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OyAvLyDguJXguLHguKfguYHguJfguJnguILguK3guIfguJfguLHguYnguIfguKvguJnguYnguLLguYDguKfguYfguJoKICAgIGlmIChlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKSB7CiAgICAgICAgZWxlbS5yZXF1ZXN0RnVsbHNjcmVlbigpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGF0dGVtcHRpbmcgdG8gZW5hYmxlIGZ1bGwtc2NyZWVuIG1vZGU6ICR7ZXJyLm1lc3NhZ2V9ICgke2Vyci5uYW1lfSlgKTsKICAgICAgICB9KTsKICAgIH0gZWxzZSBpZiAoZWxlbS53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgeyAvKiBTYWZhcmkgKi8KICAgICAgICBlbGVtLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICB9IGVsc2UgaWYgKGVsZW0ubXNSZXF1ZXN0RnVsbHNjcmVlbikgeyAvKiBJRTExICovCiAgICAgICAgZWxlbS5tc1JlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICB9Cn0KCi8qKgogKiDguJ/guLHguIfguIHguYzguIrguLHguJnguIHguKXguLLguIfguKrguLPguKvguKPguLHguJrguIjguLHguJTguIHguLLguKPguIHguLLguKPguK3guK3guIHguIjguLLguIHguIjguK0gKOC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4meC4seC4muC4i+C5ieC4s+C4i+C5ieC4reC4mSkKICovCmZ1bmN0aW9uIGhhbmRsZUNoZWF0aW5nRXZlbnQoKSB7CiAgICAvLyDguJbguYnguLLguIHguLPguKXguLHguIfguK3guKLguLnguYjguYPguJnguIrguYjguKfguIcgQ29vbGRvd24g4LmD4Lir4LmJ4LmA4Lih4Li04LiZ4Lit4Li14LmA4Lin4LiZ4LiV4LmM4LiZ4Li14LmJ4LmE4Lib4LmA4Lil4LiiCiAgICBpZiAoY2hlYXREZXRlY3Rpb25UaW1lb3V0KSByZXR1cm47CgogICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4LmD4LiK4LmI4LiK4LmI4Lin4LiHIENvb2xkb3duIOC5g+C4q+C5ieC5gOC4o+C4tOC5iOC4oeC4l+C4s+C4h+C4suC4mQogICAgY2hlYXRBdHRlbXB0cysrOwogICAgbG9nQmVoYXZpb3JFdmVudCgnc2NyZWVuX2V4aXQnLCB7IGF0dGVtcHROdW1iZXI6IGNoZWF0QXR0ZW1wdHMgfSk7CgogICAgaWYgKGNoZWF0QXR0ZW1wdHMgPj0gbWF4Q2hlYXRBdHRlbXB0cykgewogICAgICAgIGlzUXVpekFjdGl2ZSA9IGZhbHNlOwogICAgICAgIHNob3dNZXNzYWdlKGDguJXguKPguKfguIjguJ7guJrguIHguLLguKPguK3guK3guIHguIjguLLguIHguKvguJnguYnguLLguIjguK3guITguKPguJogJHttYXhDaGVhdEF0dGVtcHRzfSDguITguKPguLHguYnguIcg4Lij4Liw4Lia4Lia4LmE4LiU4LmJ4LiX4Liz4LiB4Liy4Lij4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiT4Lit4Lix4LiV4LmC4LiZ4Lih4Lix4LiV4Li0YCk7CgogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1mb3JtJykpIHsKICAgICAgICAgICAgaGFuZGxlU3VibWl0UXVpeihudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaW5hbGl6ZVBlclF1ZXN0aW9uUXVpeigpOwogICAgICAgIH0KICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UpOwogICAgfSBlbHNlIHsKICAgICAgICBzaG93TWVzc2FnZSgKICAgICAgICAgICAgYOC4hOC4s+C5gOC4leC4t+C4reC4mSAoJHtjaGVhdEF0dGVtcHRzfS8ke21heENoZWF0QXR0ZW1wdHN9KTog4LiB4Lij4Li44LiT4Liy4Lit4Lii4LmI4Liy4Lit4Lit4LiB4LiI4Liy4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4Lij4Liw4Lir4Lin4LmI4Liy4LiH4LiX4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaYCwKICAgICAgICAgICAgZW50ZXJGdWxsc2NyZWVuIAogICAgICAgICk7CiAgICB9CgogICAgLy8g4LmA4Lij4Li04LmI4LihIENvb2xkb3duOiDguJXguLHguYnguIfguYDguKfguKXguLIgNTAwIOC4oeC4tOC4peC4peC4tOC4p+C4tOC4meC4suC4l+C4tSAoMC41IOC4p+C4tOC4meC4suC4l+C4tSkKICAgIC8vIOC5g+C4meC4iuC5iOC4p+C4h+C5gOC4p+C4peC4suC4meC4teC5iSDguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguIjguLDguYTguKHguYjguJfguLPguIfguLLguJnguK3guLXguIEKICAgIGNoZWF0RGV0ZWN0aW9uVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGNoZWF0RGV0ZWN0aW9uVGltZW91dCA9IG51bGw7IC8vIOC5gOC4oeC4t+C5iOC4reC4hOC4o+C4muC5gOC4p+C4peC4siDguYPguKvguYnguYDguITguKXguLXguKLguKPguYwgQ29vbGRvd24KICAgIH0sIDUwMCk7Cn0KCmZ1bmN0aW9uIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UoKSB7CiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJyB8fCAhaXNRdWl6QWN0aXZlKSByZXR1cm47CiAgICBpZiAoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09PSAnaGlkZGVuJykgewogICAgICAgIGhhbmRsZUNoZWF0aW5nRXZlbnQoKTsKICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlID09PSAndmlzaWJsZScpIHsKICAgICAgICBjb25zb2xlLmxvZygi4LiB4Lil4Lix4Lia4LmA4LiC4LmJ4Liy4Liq4Li54LmI4Lir4LiZ4LmJ4Liy4LiI4Lit4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmB4Lil4LmJ4LinLCDguIHguLPguKXguLHguIfguKPguLXguYDguIvguYfguJXguKPguLDguJrguJrguJvguYnguK3guIfguIHguLHguJkuLi4iKTsKICAgICAgICByZXF1ZXN0V2FrZUxvY2soKTsKICAgICAgICByZXNldERpbVRpbWVyKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIGhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UoKSB7CiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJyB8fCAhaXNRdWl6QWN0aXZlKSByZXR1cm47CiAgICBpZiAoIWRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSB7CiAgICAgICAgaGFuZGxlQ2hlYXRpbmdFdmVudCgpOwogICAgfQp9CgpmdW5jdGlvbiBkaXNwbGF5R2VuZXJhdGVkUXVpeihxdWl6RGF0YSwgZm9yY2VkUHJvamVjdElkID0gbnVsbCwgYmx1ZXByaW50VG9waWNJZCA9IG51bGwpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnZW5lcmF0ZWQtcXVpei1jb250YWluZXInKTsKICAgIGxldCBodG1sID0gYDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItMyIgY29udGVudGVkaXRhYmxlPSJ0cnVlIiBpZD0iZWRpdGFibGUtcXVpei10b3BpYyI+JHtxdWl6RGF0YS50b3BpY308L2gzPmA7CiAgICAKICAgIHF1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKChxLCBpbmRleCkgPT4gewogICAgICAgIGlmICghcS5pZCkgeyBxLmlkID0gYHFfJHtEYXRlLm5vdygpfV8ke2luZGV4fWA7IH0KICAgICAgICAKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAKICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgcmVsYXRpdmUgZ3JvdXAiIGRhdGEtcXVlc3Rpb24taW5kZXg9IiR7aW5kZXh9Ij4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFic29sdXRlIHRvcC0yIHJpZ2h0LTIgb3BhY2l0eS0wIGdyb3VwLWhvdmVyOm9wYWNpdHktMTAwIHRyYW5zaXRpb24tb3BhY2l0eSBmbGV4IGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLWluZGV4PSIke2luZGV4fSIgY2xhc3M9ImVkaXQtcXVlc3Rpb24tYnRuIHRleHQtYmx1ZS02MDAgaG92ZXI6dGV4dC1ibHVlLTgwMCBwLTEiIHRpdGxlPSLguYHguIHguYnguYTguILguILguYnguK3guJnguLXguYkiPjxpIGNsYXNzPSJmYXMgZmEtcGVuIj48L2k+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1pbmRleD0iJHtpbmRleH0iIGNsYXNzPSJyZWdlbmVyYXRlLXF1ZXN0aW9uLWJ0biB0ZXh0LWdyZWVuLTYwMCBob3Zlcjp0ZXh0LWdyZWVuLTgwMCBwLTEiIHRpdGxlPSLguKrguKPguYnguLLguIfguILguYnguK3guJnguLXguYnguYPguKvguKHguYgiPjxpIGNsYXNzPSJmYXMgZmEtc3luYy1hbHQiPjwvaT48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CgogICAgICAgIC8vIOC4quC5iOC4p+C4meC5geC4quC4lOC4h+C5guC4iOC4l+C4ouC5jAogICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICBodG1sICs9IGA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCIgaWQ9InEtdGV4dC0ke2luZGV4fSI+JHtpbmRleCArIDF9LiAke3Euc3RlbX08L3A+YDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBodG1sICs9IGA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCIgaWQ9InEtdGV4dC0ke2luZGV4fSI+JHtpbmRleCArIDF9LiAke3EucXVlc3Rpb25UZXh0fTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgaWYgKHEuaW1hZ2VDb2RlKSB7CiAgICAgICAgICAgIGh0bWwgKz0gYDxkaXYgaWQ9InEtaW1hZ2UtY29udGFpbmVyLSR7aW5kZXh9IiBjbGFzcz0ibXktNCBmbGV4IGp1c3RpZnktY2VudGVyIj4ke3EuaW1hZ2VDb2RlfTwvZGl2PmA7CiAgICAgICAgfQoKICAgICAgICAvLyAtLS0gW0xvZ2ljIOC5g+C4q+C4oeC5iDog4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmA4Lie4Li34LmI4Lit4LmA4Lil4Li34Lit4LiB4Lin4Li04LiY4Li14LmB4Liq4LiU4LiH4Lic4Lil4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHXSAtLS0KICAgICAgICAKICAgICAgICAvLyDguIHguKPguJPguLXguJfguLXguYggMTog4Lih4Li14LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIChPcHRpb25zKSAtPiDguYHguKrguJTguIfguYHguJrguJrguJvguKPguJnguLHguKIKICAgICAgICBpZiAocS5vcHRpb25zICYmIEFycmF5LmlzQXJyYXkocS5vcHRpb25zKSAmJiBxLm9wdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBodG1sICs9IGA8dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSBtdC0yIHNwYWNlLXktMSB0ZXh0LXNtIiBpZD0icS1vcHRpb25zLSR7aW5kZXh9Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICR7cS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgPGxpIGNsYXNzPSIke2kgPT09IHEuY29ycmVjdEFuc3dlckluZGV4ID8gJ3RleHQtZ3JlZW4tNjAwIGZvbnQtYm9sZCcgOiAnJ30iPiR7b3B0fTwvbGk+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgIDwvdWw+YDsKICAgICAgICAKICAgICAgICAvLyDguIHguKPguJPguLXguJfguLXguYggMjog4LmA4Lib4LmH4LiZ4LiI4Lix4Lia4LiE4Li54LmIIC0+IOC5geC4quC4lOC4h+C4hOC4s+C4leC4reC4muC4hOC4ueC5iOC4geC4seC4mQogICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScgfHwgcS5jb3JyZWN0UmVzcG9uc2UpIHsKICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibXQtMiBwLTIgYmctZ3JlZW4tMTAwIHRleHQtc20iPjxzdHJvbmcgY2xhc3M9InRleHQtZ3JheS03MDAiPuC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hzo8L3N0cm9uZz4gPHNwYW4gaWQ9InEtY29ycmVjdC0ke2luZGV4fSI+JHtxLmNvcnJlY3RSZXNwb25zZX08L3NwYW4+PC9kaXY+YDsKICAgICAgICAKICAgICAgICAvLyDguIHguKPguJPguLXguJfguLXguYggMzog4LmA4Lib4LmH4LiZIFRydWUvRmFsc2UKICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnIHx8IHR5cGVvZiBxLmNvcnJlY3RBbnN3ZXIgPT09ICdib29sZWFuJykgewogICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibXQtMiBzcGFjZS15LTEgdGV4dC1zbSI+CiAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iJHtxLmNvcnJlY3RBbnN3ZXIgPT09IHRydWUgPyAndGV4dC1ncmVlbi02MDAgZm9udC1ib2xkJyA6ICcnfSI+4LmD4LiK4LmIPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9IiR7cS5jb3JyZWN0QW5zd2VyID09PSBmYWxzZSA/ICd0ZXh0LWdyZWVuLTYwMCBmb250LWJvbGQnIDogJyd9Ij7guYTguKHguYjguYPguIrguYg8L3A+CiAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgCiAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmIIDQ6IChGYWxsYmFjaykg4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li14LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIOC5geC4leC5iOC4oeC4tSBpZGVhbEFuc3dlciAtPiDguYHguKrguJTguIfguYHguJrguJrguYDguJXguLTguKHguITguLMKICAgICAgICB9IGVsc2UgaWYgKHEuaWRlYWxBbnN3ZXIpIHsKICAgICAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibXQtMiBwLTIgYmctZ3JheS0xMDAgdGV4dC1zbSI+PHN0cm9uZyBjbGFzcz0idGV4dC1ncmF5LTcwMCI+4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiE4Liy4LiU4Lir4Lin4Lix4LiHOjwvc3Ryb25nPiA8c3BhbiBpZD0icS1pZGVhbC0ke2luZGV4fSI+JHtxLmlkZWFsQW5zd2VyfTwvc3Bhbj48L2Rpdj5gOwogICAgICAgIAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC5hOC4oeC5iOC5gOC4guC5ieC4suC4nuC4p+C4geC4iOC4o+C4tOC4h+C5hiAo4LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lih4LmI4LiE4Lij4LiaKQogICAgICAgICAgICAgaHRtbCArPSBgPHAgY2xhc3M9InRleHQtcmVkLTUwMCB0ZXh0LXNtIj7guILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6IOC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5gOC4ieC4peC4ouC4q+C4o+C4t+C4reC4leC4seC4p+C5gOC4peC4t+C4reC4gTwvcD5gOwogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgIH0pOwoKICAgIGh0bWwgKz0gYDxkaXYgaWQ9ImdlbmVyYXRlZC1xdWl6LWFjdGlvbnMiIGNsYXNzPSJtdC00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBteS0zIj4KICAgICAgICAgICAgPGlucHV0IGlkPSJwcmUtdGVzdC1jaGVja2JveCIgdHlwZT0iY2hlY2tib3giIGNsYXNzPSJoLTQgdy00IHRleHQtaW5kaWdvLTYwMCBib3JkZXItZ3JheS0zMDAgcm91bmRlZCBmb2N1czpyaW5nLWluZGlnby01MDAiPgogICAgICAgICAgICA8bGFiZWwgZm9yPSJwcmUtdGVzdC1jaGVja2JveCIgY2xhc3M9Im1sLTIgYmxvY2sgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktOTAwIj7guJrguLHguJnguJfguLbguIHguYDguJvguYfguJnguYHguJrguJrguJfguJTguKrguK3guJrguIHguYjguK3guJnguYDguKPguLXguKLguJkgKFByZS10ZXN0KTwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGJ1dHRvbiBpZD0idmVyaWZ5LWFuc3dlcnMtYnRuIiBjbGFzcz0idy1mdWxsIGJnLXllbGxvdy01MDAgdGV4dC13aGl0ZSBweS0yIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLXllbGxvdy02MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbWItMiI+PGkgY2xhc3M9ImZhcyBmYS1jaGVjay1kb3VibGUgbXItMiI+PC9pPuC4leC4o+C4p+C4iOC4l+C4suC4meC4hOC4p+C4suC4oeC4luC4ueC4geC4leC5ieC4reC4h+C4guC4reC4h+C5gOC4ieC4peC4oiAoQUkpPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iZXhwb3J0LXdvcmtzaGVldC1wZGYtYnRuIiBjbGFzcz0idy1mdWxsIGJnLXJlZC02MDAgdGV4dC13aGl0ZSBweS0yIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLXJlZC03MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbWItMiI+PGkgY2xhc3M9ImZhcyBmYS1maWxlLXBkZiBtci0yIj48L2k+RXhwb3J0IOC5gOC4m+C5h+C4meC5g+C4muC4h+C4suC4mSAoUERGKTwvYnV0dG9uPgogICAgICAgIDxidXR0b24gaWQ9InNhdmUtcXVpei1idG4iIGNsYXNzPSJ3LWZ1bGwgYmctZ3JlZW4tNjAwIHRleHQtd2hpdGUgcHktMiBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1ncmVlbi03MDAiPjxpIGNsYXNzPSJmYXMgZmEtc2F2ZSBtci0yIj48L2k+4Lia4Lix4LiZ4LiX4Li24LiB4LmB4Lil4Liw4Liq4Lij4LmJ4Liy4LiH4Lij4Lir4Lix4LiqPC9idXR0b24+CiAgICA8L2Rpdj5gOwogICAgCiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gaHRtbDsKICAgIAogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmVkaXQtcXVlc3Rpb24tYnRuJykuZm9yRWFjaChidG4gPT4gYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRWRpdFF1ZXN0aW9uKSk7CiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucmVnZW5lcmF0ZS1xdWVzdGlvbi1idG4nKS5mb3JFYWNoKGJ0biA9PiBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVSZWdlbmVyYXRlUXVlc3Rpb24pKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdleHBvcnQtd29ya3NoZWV0LXBkZi1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGV4cG9ydFF1aXpBc1dvcmtzaGVldFBERik7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZ5LWFuc3dlcnMtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVWZXJpZnlBbnN3ZXJzKTsKCiAgICBjb25zdCBzYXZlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NhdmUtcXVpei1idG4nKTsKICAgIGlmIChzYXZlQnV0dG9uKSB7CiAgICAgICAgY29uc3QgcHJvamVjdElkRm9yU2F2ZSA9IGZvcmNlZFByb2plY3RJZCB8fCBjdXJyZW50UHJvamVjdElkOyAKICAgICAgICBzYXZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gc2F2ZVF1aXoocHJvamVjdElkRm9yU2F2ZSwgYmx1ZXByaW50VG9waWNJZCkpOwogICAgfQoKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgd2luZG93Lk1hdGhKYXgudHlwZXNldFByb21pc2UoW2NvbnRhaW5lcl0pOwp9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlUmVnZW5lcmF0ZVF1ZXN0aW9uKGUpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pbmRleDsKICAgICAgICAgICAgY29uc3QgdG9waWMgPSBjdXJyZW50UXVpekRhdGEudG9waWM7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguITguLPguJbguLLguKHguILguYnguK0gJHtwYXJzZUludChpbmRleCkgKyAxfSDguYPguKvguKHguYguLi5gKTsKICAgICAgICAgICAgZ2VuZXJhdGVRdWl6KHRvcGljLCBudWxsLCBwYXJzZUludChpbmRleCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFNWRyBEcmFnIGFuZCBEcm9wIEZ1bmN0aW9ucyAoTW91c2UgJiBUb3VjaCkgLS0tCiAgICAgICAgZnVuY3Rpb24gZ2V0UG9pbnRlclBvc2l0aW9uKHN2ZywgZXZ0KSB7CiAgICAgICAgICAgIGNvbnN0IENUTSA9IHN2Zy5nZXRTY3JlZW5DVE0oKTsKICAgICAgICAgICAgbGV0IGNsaWVudFgsIGNsaWVudFk7CgogICAgICAgICAgICAvLyBDaGVjayBmb3IgdG91Y2ggZXZlbnQKICAgICAgICAgICAgaWYgKGV2dC50b3VjaGVzICYmIGV2dC50b3VjaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNsaWVudFggPSBldnQudG91Y2hlc1swXS5jbGllbnRYOwogICAgICAgICAgICAgICAgY2xpZW50WSA9IGV2dC50b3VjaGVzWzBdLmNsaWVudFk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBGYWxsYmFjayB0byBtb3VzZSBldmVudAogICAgICAgICAgICAgICAgY2xpZW50WCA9IGV2dC5jbGllbnRYOwogICAgICAgICAgICAgICAgY2xpZW50WSA9IGV2dC5jbGllbnRZOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgeDogKGNsaWVudFggLSBDVE0uZSkgLyBDVE0uYSwKICAgICAgICAgICAgICAgIHk6IChjbGllbnRZIC0gQ1RNLmYpIC8gQ1RNLmQKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHN0YXJ0RHJhZyhldnQpIHsKICAgICAgICAgICAgLy8gUHJldmVudCBkZWZhdWx0IHRvdWNoIGFjdGlvbnMgbGlrZSBzY3JvbGxpbmcKICAgICAgICAgICAgaWYgKGV2dC50eXBlID09PSAndG91Y2hzdGFydCcpIHsKICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGV2dC50YXJnZXQuY2xvc2VzdCgnLmRyYWdnYWJsZS10ZXh0Jyk7CiAgICAgICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgICAgIGRyYWdnZWRTdmdFbGVtZW50ID0gdGFyZ2V0OwogICAgICAgICAgICAgICAgY29uc3Qgc3ZnID0gZHJhZ2dlZFN2Z0VsZW1lbnQub3duZXJTVkdFbGVtZW50OwogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlclBvcyA9IGdldFBvaW50ZXJQb3NpdGlvbihzdmcsIGV2dCk7CgogICAgICAgICAgICAgICAgc3ZnT2Zmc2V0LnggPSBwb2ludGVyUG9zLnggLSBwYXJzZUZsb2F0KGRyYWdnZWRTdmdFbGVtZW50LmdldEF0dHJpYnV0ZU5TKG51bGwsICJ4IikpOwogICAgICAgICAgICAgICAgc3ZnT2Zmc2V0LnkgPSBwb2ludGVyUG9zLnkgLSBwYXJzZUZsb2F0KGRyYWdnZWRTdmdFbGVtZW50LmdldEF0dHJpYnV0ZU5TKG51bGwsICJ5IikpOwogICAgICAgICAgICB9CiAgICAgICAgfQoJCQovKioKICog4LiE4Liz4LiZ4Lin4LiT4LiE4LmI4Liy4LiE4Lin4Liy4Lih4Lii4Liy4LiBIChwKSwg4LiE4LmI4Liy4Lit4Liz4LiZ4Liy4LiI4LiI4Liz4LmB4LiZ4LiBIChyKSwg4LmB4Lil4Liw4Lij4Liy4Lii4LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmD4LiZ4LiB4Lil4Li44LmI4Lih4LiV4LmI4Liy4LiH4LmGCiAqIEBwYXJhbSB7b2JqZWN0fSBxdWl6RGF0YSDguILguYnguK3guKHguLnguKXguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJoKICogQHBhcmFtIHtBcnJheX0gc3VibWlzc2lvbnMg4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li44LiB4LiE4LiZCiAqIEByZXR1cm5zIHtvYmplY3R9IOC4reC5h+C4reC4muC5gOC4iOC4geC4leC5jOC4l+C4teC5iOC5gOC4geC5h+C4muC4l+C4seC5ieC4h+C4quC4luC4tOC4leC4tOC4o+C4suC4ouC4guC5ieC4rSAocGVyUXVlc3Rpb25TdGF0cykg4LmB4Lil4Liw4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Lil4Li44LmI4Lih4Lig4Liy4Lie4Lij4Lin4LihIChvdmVyYWxsR3JvdXBzKQogKi8KZnVuY3Rpb24gY2FsY3VsYXRlSXRlbUFuYWx5c2lzKHF1aXpEYXRhLCBzdWJtaXNzaW9ucykgewogICAgY29uc3QgYW5hbHlzaXNSZXN1bHRzID0ge307CiAgICBpZiAoc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgcmV0dXJuIHsgcGVyUXVlc3Rpb25TdGF0czoge30sIG92ZXJhbGxHcm91cHM6IG51bGwgfTsgLy8g4LmB4LiB4LmJ4LmE4LiCIHJldHVybiDguITguYjguLLguKfguYjguLLguIcKCiAgICBjb25zdCBzb3J0ZWRTdWJtaXNzaW9ucyA9IFsuLi5zdWJtaXNzaW9uc10uc29ydCgoYSwgYikgPT4gewogICAgLy8gMS4g4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LiE4Liw4LmB4LiZ4LiZ4Lil4LmI4Liy4Liq4Li44LiUICjguKHguLLguIHguYTguJvguJnguYnguK3guKIpCiAgICBjb25zdCBzY29yZURpZmYgPSBiLmxhdGVzdFNjb3JlIC0gYS5sYXRlc3RTY29yZTsKICAgIGlmIChzY29yZURpZmYgIT09IDApIHJldHVybiBzY29yZURpZmY7CgogICAgLy8gMi4g4LiW4LmJ4Liy4LiE4Liw4LmB4LiZ4LiZ4LmA4LiX4LmI4Liy4LiB4Lix4LiZIOC5g+C4q+C5ieC5gOC4o+C4teC4ouC4h+C4leC4suC4oeC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4l+C4syAo4LiZ4LmJ4Lit4Lii4LmE4Lib4Lih4Liy4LiBKQogICAgY29uc3QgYXR0ZW1wdHNBID0gYS5hdHRlbXB0cz8ubGVuZ3RoIHx8IDE7CiAgICBjb25zdCBhdHRlbXB0c0IgPSBiLmF0dGVtcHRzPy5sZW5ndGggfHwgMTsKICAgIGNvbnN0IGF0dGVtcHREaWZmID0gYXR0ZW1wdHNBIC0gYXR0ZW1wdHNCOwogICAgaWYgKGF0dGVtcHREaWZmICE9PSAwKSByZXR1cm4gYXR0ZW1wdERpZmY7CgogICAgLy8gMy4g4LiW4LmJ4Liy4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LmA4LiX4LmI4Liy4LiB4Lix4LiZIOC5g+C4q+C5ieC5gOC4o+C4teC4ouC4h+C4leC4suC4oeC5gOC4p+C4peC4suC4l+C4teC5iOC4quC5iOC4hyAo4LiB4LmI4Lit4LiZ4LmE4Lib4Lir4Lil4Lix4LiHKQogICAgY29uc3QgdGltZUEgPSBuZXcgRGF0ZShhLmxhdGVzdFN1Ym1pdHRlZEF0KTsKICAgIGNvbnN0IHRpbWVCID0gbmV3IERhdGUoYi5sYXRlc3RTdWJtaXR0ZWRBdCk7CiAgICBjb25zdCB0aW1lRGlmZiA9IHRpbWVBIC0gdGltZUI7CiAgICBpZiAodGltZURpZmYgIT09IDApIHJldHVybiB0aW1lRGlmZjsKCiAgICAvLyA0LiDguJbguYnguLLguYDguKfguKXguLLguKrguYjguIfguYDguJfguYjguLLguIHguLHguJkg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LiK4Li34LmI4LitICjguIEt4LiuKQogICAgcmV0dXJuIGEuc3R1ZGVudE5hbWUubG9jYWxlQ29tcGFyZShiLnN0dWRlbnROYW1lLCAndGgnKTsKfSk7CiAgICBjb25zdCB0b3RhbFN0dWRlbnRzID0gc29ydGVkU3VibWlzc2lvbnMubGVuZ3RoOwoKICAgIGNvbnN0IGdyb3VwU2l6ZSA9IE1hdGgubWF4KDEsIE1hdGguZmxvb3IodG90YWxTdHVkZW50cyAqIDAuMzMpKTsKICAgIGlmIChncm91cFNpemUgPT09IDApIHJldHVybiB7IHBlclF1ZXN0aW9uU3RhdHM6IHt9LCBvdmVyYWxsR3JvdXBzOiBudWxsIH07IC8vIOC5geC4geC5ieC5hOC4giByZXR1cm4g4LiE4LmI4Liy4Lin4LmI4Liy4LiHCgogICAgY29uc3QgdXBwZXJHcm91cCA9IHNvcnRlZFN1Ym1pc3Npb25zLnNsaWNlKDAsIGdyb3VwU2l6ZSk7CiAgICBjb25zdCBsb3dlckdyb3VwID0gc29ydGVkU3VibWlzc2lvbnMuc2xpY2UoLWdyb3VwU2l6ZSk7CgogICAgLy8gW+C5gOC4nuC4tOC5iOC4oeC4quC5iOC4p+C4meC4meC4teC5iV0g4Liq4Lij4LmJ4Liy4LiH4Lij4Liy4Lii4LiK4Li34LmI4Lit4LiB4Lil4Li44LmI4Lih4Lig4Liy4Lie4Lij4Lin4LihCiAgICBjb25zdCBvdmVyYWxsVXBwZXJHcm91cE5hbWVzID0gdXBwZXJHcm91cC5tYXAoc3ViID0+IHN1Yi5zdHVkZW50TmFtZSk7CiAgICBjb25zdCBvdmVyYWxsTG93ZXJHcm91cE5hbWVzID0gbG93ZXJHcm91cC5tYXAoc3ViID0+IHN1Yi5zdHVkZW50TmFtZSk7CgogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2goKHF1ZXN0aW9uLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IHF1ZXN0aW9uVGV4dCA9IHF1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0OwogICAgICAgIGxldCB0b3RhbENvcnJlY3QgPSAwOwogICAgICAgIGxldCB1cHBlckNvcnJlY3QgPSAwOwogICAgICAgIGxldCBsb3dlckNvcnJlY3QgPSAwOwoKICAgICAgICBjb25zdCB1cHBlckdyb3VwUmVzcG9uZGVycyA9IFtdOwogICAgICAgIGNvbnN0IGxvd2VyR3JvdXBSZXNwb25kZXJzID0gW107CgogICAgICAgIHVwcGVyR3JvdXAuZm9yRWFjaChzdWIgPT4gewogICAgICAgICAgICBjb25zdCBsYXRlc3RBdHRlbXB0ID0gc3ViLmF0dGVtcHRzW3N1Yi5hdHRlbXB0cy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgY29uc3QgYW5zd2VySXRlbSA9IGxhdGVzdEF0dGVtcHQuYW5zd2Vycy5maW5kKGFucyA9PiBhbnMub3JpZ2luYWxRdWVzdGlvblRleHQgPT09IHF1ZXN0aW9uVGV4dCk7CiAgICAgICAgICAgIHVwcGVyR3JvdXBSZXNwb25kZXJzLnB1c2goeyBuYW1lOiBzdWIuc3R1ZGVudE5hbWUsIGlzQ29ycmVjdDogYW5zd2VySXRlbSA/IGFuc3dlckl0ZW0uaXNDb3JyZWN0IDogZmFsc2UgfSk7CiAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtICYmIGFuc3dlckl0ZW0uaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICB1cHBlckNvcnJlY3QrKzsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBsb3dlckdyb3VwLmZvckVhY2goc3ViID0+IHsKICAgICAgICAgICAgY29uc3QgbGF0ZXN0QXR0ZW1wdCA9IHN1Yi5hdHRlbXB0c1tzdWIuYXR0ZW1wdHMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckl0ZW0gPSBsYXRlc3RBdHRlbXB0LmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0ID09PSBxdWVzdGlvblRleHQpOwogICAgICAgICAgICBsb3dlckdyb3VwUmVzcG9uZGVycy5wdXNoKHsgbmFtZTogc3ViLnN0dWRlbnROYW1lLCBpc0NvcnJlY3Q6IGFuc3dlckl0ZW0gPyBhbnN3ZXJJdGVtLmlzQ29ycmVjdCA6IGZhbHNlIH0pOwogICAgICAgICAgICBpZiAoYW5zd2VySXRlbSAmJiBhbnN3ZXJJdGVtLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgbG93ZXJDb3JyZWN0Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBjb25zdCBhbnN3ZXJJdGVtID0gbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZpbmQoYW5zID0+IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCA9PT0gcXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgaWYgKGFuc3dlckl0ZW0gJiYgYW5zd2VySXRlbS5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIHRvdGFsQ29ycmVjdCsrOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHBfdmFsdWUgPSB0b3RhbFN0dWRlbnRzID4gMCA/ICh0b3RhbENvcnJlY3QgLyB0b3RhbFN0dWRlbnRzKSA6IDA7CiAgICAgICAgY29uc3Qgcl92YWx1ZSA9IGdyb3VwU2l6ZSA+IDAgPyAodXBwZXJDb3JyZWN0IC8gZ3JvdXBTaXplKSAtIChsb3dlckNvcnJlY3QgLyBncm91cFNpemUpIDogMDsKICAgICAgICAKICAgICAgICBhbmFseXNpc1Jlc3VsdHNbaW5kZXhdID0geyAKICAgICAgICAgICAgcDogcF92YWx1ZSwgCiAgICAgICAgICAgIHI6IHJfdmFsdWUsCiAgICAgICAgICAgIHVwcGVyR3JvdXBSZXNwb25kZXJzOiB1cHBlckdyb3VwUmVzcG9uZGVycywKICAgICAgICAgICAgbG93ZXJHcm91cFJlc3BvbmRlcnM6IGxvd2VyR3JvdXBSZXNwb25kZXJzCiAgICAgICAgfTsKICAgIH0pOwoKICAgIC8vIFvguYHguIHguYnguYTguILguKrguYjguKfguJnguJnguLXguYldIOC5gOC4m+C4peC4teC5iOC4ouC4meC4o+C4ueC4m+C5geC4muC4muC4geC4suC4oyByZXR1cm4g4LiC4LmJ4Lit4Lih4Li54LilCiAgICByZXR1cm4gewogICAgICAgIHBlclF1ZXN0aW9uU3RhdHM6IGFuYWx5c2lzUmVzdWx0cywKICAgICAgICBvdmVyYWxsR3JvdXBzOiB7CiAgICAgICAgICAgIHVwcGVyR3JvdXBOYW1lczogb3ZlcmFsbFVwcGVyR3JvdXBOYW1lcywKICAgICAgICAgICAgbG93ZXJHcm91cE5hbWVzOiBvdmVyYWxsTG93ZXJHcm91cE5hbWVzCiAgICAgICAgfQogICAgfTsKfQoKICAgICAgICBmdW5jdGlvbiBkcmFnKGV2dCkgewogICAgICAgICAgICBpZiAoZHJhZ2dlZFN2Z0VsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3ZnID0gZHJhZ2dlZFN2Z0VsZW1lbnQub3duZXJTVkdFbGVtZW50OwogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRlclBvcyA9IGdldFBvaW50ZXJQb3NpdGlvbihzdmcsIGV2dCk7CiAgICAgICAgICAgICAgICBjb25zdCB2aWV3Qm94ID0gc3ZnLnZpZXdCb3guYmFzZVZhbDsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcHJvcG9zZWQgbmV3IGNvb3JkaW5hdGVzCiAgICAgICAgICAgICAgICBsZXQgbmV3WCA9IHBvaW50ZXJQb3MueCAtIHN2Z09mZnNldC54OwogICAgICAgICAgICAgICAgbGV0IG5ld1kgPSBwb2ludGVyUG9zLnkgLSBzdmdPZmZzZXQueTsKCiAgICAgICAgICAgICAgICAvLyBHZXQgdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgdGV4dCBlbGVtZW50IGl0c2VsZiB0byBwcmV2ZW50IGl0IGZyb20gZ29pbmcgcGFydGlhbGx5IG9mZi1zY3JlZW4KICAgICAgICAgICAgICAgIGNvbnN0IHRleHRCQm94ID0gZHJhZ2dlZFN2Z0VsZW1lbnQuZ2V0QkJveCgpOwoKICAgICAgICAgICAgICAgIC8vIENsYW1wIGNvb3JkaW5hdGVzIHdpdGhpbiB0aGUgU1ZHIHZpZXdib3gKICAgICAgICAgICAgICAgIG5ld1ggPSBNYXRoLm1heCh2aWV3Qm94LngsIE1hdGgubWluKG5ld1gsIHZpZXdCb3gueCArIHZpZXdCb3gud2lkdGggLSB0ZXh0QkJveC53aWR0aCkpOwogICAgICAgICAgICAgICAgbmV3WSA9IE1hdGgubWF4KHZpZXdCb3gueSwgTWF0aC5taW4obmV3WSwgdmlld0JveC55ICsgdmlld0JveC5oZWlnaHQgLSB0ZXh0QkJveC5oZWlnaHQpKTsKCiAgICAgICAgICAgICAgICBkcmFnZ2VkU3ZnRWxlbWVudC5zZXRBdHRyaWJ1dGVOUyhudWxsLCAieCIsIG5ld1gpOwogICAgICAgICAgICAgICAgZHJhZ2dlZFN2Z0VsZW1lbnQuc2V0QXR0cmlidXRlTlMobnVsbCwgInkiLCBuZXdZKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZW5kRHJhZyhldnQpIHsKICAgICAgICAgICAgZHJhZ2dlZFN2Z0VsZW1lbnQgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFNWRyBFZGl0IENsaWNrIEhhbmRsZXIgLS0tCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlU3ZnRWRpdENsaWNrKGUpIHsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsZXRlLXN2Zy1idG4nKSkgewogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0SWQgPSBlLnRhcmdldC5kYXRhc2V0LnRhcmdldElkOwogICAgICAgICAgICAgICAgY29uc3Qgc3ZnID0gZS5jdXJyZW50VGFyZ2V0OwogICAgICAgICAgICAgICAgY29uc3QgdGV4dEVsZW1lbnRUb0RlbGV0ZSA9IHN2Zy5xdWVyeVNlbGVjdG9yKGAjJHt0YXJnZXRJZH1gKTsKICAgICAgICAgICAgICAgIGlmICh0ZXh0RWxlbWVudFRvRGVsZXRlKSB7CiAgICAgICAgICAgICAgICAgICAgdGV4dEVsZW1lbnRUb0RlbGV0ZS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGUudGFyZ2V0LnJlbW92ZSgpOyAvLyBSZW1vdmUgdGhlIGRlbGV0ZSBidXR0b24gaXRzZWxmCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRWRpdFF1ZXN0aW9uKGUpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmxldCBjdXJyZW50RWRpdGluZ1F1aXpEYXRhID0gbnVsbDsgLy8g4LmA4Lie4Li04LmI4Lih4LiV4Lix4Lin4LmB4Lib4LijIGdsb2JhbCDguJnguLXguYnguYTguKfguYnguJTguYnguLLguJnguJrguJnguILguK3guIcgc2NyaXB0CgogICAgICAgIC8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4teC5iCAxOiDguYDguJvguLTguJQgRWRpdG9yIOC5geC4peC4sOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4pQogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZU9wZW5RdWl6RWRpdG9yKHF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gcmVuZGVyUXVpekVkaXRvcihxdWl6RGF0YSkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gaGFuZGxlVG9nZ2xlSGlkZGVuT3B0aW9ucyhpbmRleCkgewogICAgaWYgKCFjdXJyZW50RWRpdGluZ1F1aXpEYXRhIHx8ICFjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF0pIHJldHVybjsKICAgIAogICAgY29uc3QgcSA9IGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zW2luZGV4XTsKICAgIGNvbnN0IGN1cnJlbnRUeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgJ211bHRpcGxlX2Nob2ljZSc7CgogICAgLy8gMS4g4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZ4LiI4Liy4LiBIERPTSDguKXguIfguJXguLHguKfguYHguJvguKMgcSDguIHguYjguK3guJkgKOC5gOC4nuC4t+C5iOC4reC5hOC4oeC5iOC5g+C4q+C5ieC4quC4tOC5iOC4h+C4l+C4teC5iOC4nuC4tOC4oeC4nuC5jOC4peC5iOC4suC4quC4uOC4lOC4q+C4suC4ouC5hOC4mykKICAgIGNvbnN0IGVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnF1ZXN0aW9uLWVkaXRvci1pdGVtW2RhdGEtcS1pbmRleD0iJHtpbmRleH0iXWApOwogICAgaWYgKGVsKSB7CiAgICAgICAgcS5xdWVzdGlvblRleHQgPSBlbC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYScpLnZhbHVlOwogICAgICAgIAogICAgICAgIGlmIChjdXJyZW50VHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAgICAgY29uc3Qgb3B0aW9uSW5wdXRzID0gZWwucXVlcnlTZWxlY3RvckFsbCgnLm9wdGlvbi1pbnB1dCcpOwogICAgICAgICAgICBxLm9wdGlvbnMgPSBBcnJheS5mcm9tKG9wdGlvbklucHV0cykubWFwKGlucHV0ID0+IGlucHV0LnZhbHVlKTsKICAgICAgICAgICAgY29uc3QgY2hlY2tlZFJhZGlvID0gZWwucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT0icmFkaW8iXTpjaGVja2VkJyk7CiAgICAgICAgICAgIGlmIChjaGVja2VkUmFkaW8pIHEuY29ycmVjdEFuc3dlckluZGV4ID0gcGFyc2VJbnQoY2hlY2tlZFJhZGlvLnZhbHVlKTsKICAgICAgICB9IAogICAgICAgIGVsc2UgaWYgKGN1cnJlbnRUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBjdXJyZW50VHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHsKICAgICAgICAgICAgY29uc3QgaWRlYWxJbnB1dCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5pZGVhbC1hbnN3ZXItaW5wdXQnKTsKICAgICAgICAgICAgaWYgKGlkZWFsSW5wdXQpIHEuaWRlYWxBbnN3ZXIgPSBpZGVhbElucHV0LnZhbHVlOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaGlkZGVuSW5wdXRzID0gZWwucXVlcnlTZWxlY3RvckFsbCgnLmhpZGRlbi1vcHRpb24taW5wdXQnKTsKICAgICAgICAgICAgaWYgKGhpZGRlbklucHV0cy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBxLm9wdGlvbnMgPSBBcnJheS5mcm9tKGhpZGRlbklucHV0cykubWFwKGlucHV0ID0+IGlucHV0LnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyAyLiDguKrguKXguLHguJrguKrguJbguLLguJnguLAKICAgIGlmIChjdXJyZW50VHlwZSA9PT0gJ211bHRpcGxlX2Nob2ljZScpIHsKICAgICAgICAvLyDguYHguJvguKXguIfguYDguJvguYfguJkgU2hvcnQgQW5zd2VyIChIaWRkZW4gT3B0aW9ucykKICAgICAgICBxLnF1ZXN0aW9uVHlwZSA9ICdzaG9ydF9hbnN3ZXInOwogICAgICAgIC8vIOC4leC4seC5ieC4h+C4hOC5iOC4suC5gOC4ieC4peC4ouC4reC4seC4leC5guC4meC4oeC4seC4leC4tCDguYLguJTguKLguYDguK3guLIgdGV4dCDguILguK3guIfguJXguLHguKfguYDguKXguLfguK3guIHguJfguLXguYjguJbguLnguIEg4Lih4Liy4LmD4Liq4LmI4LmD4LiZIGlkZWFsQW5zd2VyCiAgICAgICAgaWYgKHEub3B0aW9ucyAmJiBxLmNvcnJlY3RBbnN3ZXJJbmRleCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHEuaWRlYWxBbnN3ZXIgPSBxLm9wdGlvbnNbcS5jb3JyZWN0QW5zd2VySW5kZXhdIHx8ICcnOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LmB4Lib4Lil4LiH4LiB4Lil4Lix4Lia4LmA4Lib4LmH4LiZIE11bHRpcGxlIENob2ljZQogICAgICAgIHEucXVlc3Rpb25UeXBlID0gJ211bHRpcGxlX2Nob2ljZSc7CiAgICAgICAgLy8gKOC4guC5ieC4reC4oeC4ueC4pSBvcHRpb25zIOC5geC4peC4sCBjb3JyZWN0QW5zd2VySW5kZXgg4Lii4Lix4LiH4LiE4LiH4Lit4Lii4Li54LmI4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKQogICAgfQoKICAgIC8vIDMuIOC4p+C4suC4lOC4q+C4meC5ieC4suC4iOC4reC5g+C4q+C4oeC5iAogICAgcmVuZGVyUXVpekVkaXRvcihjdXJyZW50RWRpdGluZ1F1aXpEYXRhKTsKfQoJCQoJCWZ1bmN0aW9uIGhhbmRsZURlbGV0ZVF1ZXN0aW9uSW5FZGl0b3IoaW5kZXgpIHsKICAgIGlmICghY3VycmVudEVkaXRpbmdRdWl6RGF0YSB8fCAhY3VycmVudEVkaXRpbmdRdWl6RGF0YS5xdWVzdGlvbnNbaW5kZXhdKSByZXR1cm47CgogICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiE4Liz4LiW4Liy4Lih4Lih4Liy4LmB4Liq4LiU4LiH4LmA4Lie4Li34LmI4Lit4Lii4Li34LiZ4Lii4Lix4LiZCiAgICBjb25zdCBxdWVzdGlvblRleHQgPSBjdXJyZW50RWRpdGluZ1F1aXpEYXRhLnF1ZXN0aW9uc1tpbmRleF0ucXVlc3Rpb25UZXh0IHx8IGN1cnJlbnRFZGl0aW5nUXVpekRhdGEucXVlc3Rpb25zW2luZGV4XS5zdGVtOwogICAgCiAgICBzaG93Q29uZmlybWF0aW9uKAogICAgICAgIGDguITguLjguJPguYHguJnguYjguYPguIjguKvguKPguLfguK3guYTguKHguYjguKfguYjguLLguJXguYnguK3guIfguIHguLLguKPguKXguJrguITguLPguJbguLLguKHguILguYnguK0gJHtpbmRleCArIDF9ICgiJHtxdWVzdGlvblRleHQuc3Vic3RyaW5nKDAsIDIwKX0uLi4iKT9gLAogICAgICAgICgpID0+IHsKICAgICAgICAgICAgLy8gMS4g4Lil4Lia4LiE4Liz4LiW4Liy4Lih4Lit4Lit4LiB4LiI4Liy4LiBIGFycmF5IOC5g+C4mSBzdGF0ZSDguIrguLHguYjguKfguITguKPguLLguKcKICAgICAgICAgICAgY3VycmVudEVkaXRpbmdRdWl6RGF0YS5xdWVzdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIOC4p+C4suC4lOC4q+C4meC5ieC4suC4iOC4rSBFZGl0b3Ig4LmD4Lir4Lih4LmI4LiX4Lix4LmJ4LiH4Lir4Lih4LiUICjguITguLPguJbguLLguKHguIjguLDguKvguLLguKLguYTguJsg4LmB4Lil4Liw4Lil4Liz4LiU4Lix4Lia4LiC4LmJ4Lit4LiI4Liw4LiW4Li54LiB4LiI4Lix4LiU4LmA4Lij4Li14Lii4LiH4LmD4Lir4Lih4LmIKQogICAgICAgICAgICByZW5kZXJRdWl6RWRpdG9yKGN1cnJlbnRFZGl0aW5nUXVpekRhdGEpOwogICAgICAgICAgICAKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4peC4muC4hOC4s+C4luC4suC4oeC5geC4peC5ieC4pyAo4Lit4Lii4LmI4Liy4Lil4Li34Lih4LiB4LiUICfguJrguLHguJnguJfguLbguIHguIHguLLguKPguYHguIHguYnguYTguIInIOC5gOC4nuC4t+C5iOC4reC4ouC4t+C4meC4ouC4seC4mSkiKTsKICAgICAgICB9CiAgICApOwp9CgpmdW5jdGlvbiBoYW5kbGVBZGRRdWVzdGlvbkluRWRpdG9yKCkgewogICAgaWYgKCFjdXJyZW50RWRpdGluZ1F1aXpEYXRhKSByZXR1cm47CgogICAgLy8gMS4g4Lit4LmI4Liy4LiZ4LiE4LmI4Liy4Lib4Lij4Liw4LmA4Lig4LiX4LiE4Liz4LiW4Liy4Lih4LiI4Liy4LiBIERyb3Bkb3duCiAgICBjb25zdCB0eXBlU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy1xdWVzdGlvbi10eXBlLXNlbGVjdCcpOwogICAgY29uc3Qgc2VsZWN0ZWRUeXBlID0gdHlwZVNlbGVjdCA/IHR5cGVTZWxlY3QudmFsdWUgOiAnbXVsdGlwbGVfY2hvaWNlJzsKCiAgICAvLyAyLiDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIfguILguYnguK3guKHguLnguKXguYDguKPguLTguYjguKHguJXguYnguJnguJXguLLguKHguJvguKPguLDguYDguKDguJfguJfguLXguYjguYDguKXguLfguK3guIEKICAgIGxldCBuZXdRdWVzdGlvbiA9IHsKICAgICAgICBpZDogYHFfJHtEYXRlLm5vdygpfV9uZXdgLAogICAgICAgIHF1ZXN0aW9uVHlwZTogc2VsZWN0ZWRUeXBlLAogICAgICAgIHF1ZXN0aW9uVGV4dDogJy0tLSBb4LiE4Liz4LiW4Liy4Lih4LmD4Lir4Lih4LmIXSAtLS0nCiAgICB9OwoKICAgIHN3aXRjaCAoc2VsZWN0ZWRUeXBlKSB7CiAgICAgICAgY2FzZSAnbXVsdGlwbGVfY2hvaWNlJzoKICAgICAgICAgICAgbmV3UXVlc3Rpb24ub3B0aW9ucyA9IFsn4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIOC4gScsICfguJXguLHguKfguYDguKXguLfguK3guIEg4LiCJywgJ+C4leC4seC4p+C5gOC4peC4t+C4reC4gSDguIQnLCAn4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBIOC4hyddOwogICAgICAgICAgICBuZXdRdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXggPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOgogICAgICAgIGNhc2UgJ2ZpbGxfaW5fbm9fY2hvaWNlcyc6CiAgICAgICAgICAgIG5ld1F1ZXN0aW9uLmlkZWFsQW5zd2VyID0gJ+C4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hyc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICBuZXdRdWVzdGlvbi5jb3JyZWN0QW5zd2VyID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgIG5ld1F1ZXN0aW9uLnN0ZW0gPSAn4LiE4Liz4LiW4Liy4LihLi4uJzsKICAgICAgICAgICAgbmV3UXVlc3Rpb24uY29ycmVjdFJlc3BvbnNlID0gJ+C4hOC4ueC5iOC4hOC4s+C4leC4reC4mi4uLic7CiAgICAgICAgICAgIC8vIOC4quC4s+C4q+C4o+C4seC4miBtYXRjaGluZyDguYDguKPguLLguK3guLLguIjguJXguYnguK3guIfguYPguKrguYggc3RlbSDguYPguJkgcXVlc3Rpb25UZXh0IOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSByZW5kZXJRdWl6RWRpdG9yIOC4l+C4s+C4h+C4suC4meC4luC4ueC4geC5g+C4meC4muC4suC4h+C4iOC4uOC4lAogICAgICAgICAgICBuZXdRdWVzdGlvbi5xdWVzdGlvblRleHQgPSAn4LiE4Liz4LiW4Liy4LihLi4uJzsgCiAgICAgICAgICAgIGJyZWFrOwogICAgfQoKICAgIC8vIDMuIOC5gOC4nuC4tOC5iOC4oeC4hOC4s+C4luC4suC4oeC5g+C4q+C4oeC5iOC5gOC4guC5ieC4suC5hOC4m+C5g+C4mSBzdGF0ZQogICAgY3VycmVudEVkaXRpbmdRdWl6RGF0YS5xdWVzdGlvbnMucHVzaChuZXdRdWVzdGlvbik7CiAgICAKICAgIC8vIDQuIOC4p+C4suC4lOC4q+C4meC5ieC4suC4iOC4rSBFZGl0b3Ig4LmD4Lir4Lih4LmICiAgICByZW5kZXJRdWl6RWRpdG9yKGN1cnJlbnRFZGl0aW5nUXVpekRhdGEpOwogICAgCiAgICAvLyA1LiDguYDguKXguLfguYjguK3guJnguIjguK3guYTguJvguJfguLXguYjguITguLPguJbguLLguKHguYPguKvguKHguYjguYHguKXguLDguYLguJ/guIHguLHguKoKICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGNvbnN0IGxhc3RRdWVzdGlvbkVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucXVlc3Rpb24tZWRpdG9yLWl0ZW06bGFzdC1vZi10eXBlJyk7CiAgICAgICAgaWYgKGxhc3RRdWVzdGlvbkVsZW1lbnQpIHsKICAgICAgICAgICAgbGFzdFF1ZXN0aW9uRWxlbWVudC5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICdjZW50ZXInIH0pOwogICAgICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IGxhc3RRdWVzdGlvbkVsZW1lbnQucXVlcnlTZWxlY3RvcigndGV4dGFyZWEnKTsKICAgICAgICAgICAgaWYgKHRleHRhcmVhKSB0ZXh0YXJlYS5mb2N1cygpOwogICAgICAgIH0KICAgIH0sIDEwMCk7Cn0KCQkKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWlGaXhRdWVzdGlvbihlKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVNhdmVDaGFuZ2VzKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaW5pdGlhdGVSZUdyYWRlUHJvY2VzcyhxdWl6SWQpIHsKICAgIHNob3dNZXNzYWdlKCLguIHguLPguKXguLHguIfguYDguKPguLTguYjguKHguIHguKPguLDguJrguKfguJnguIHguLLguKPguJXguKPguKfguIjguITguLDguYHguJnguJnguYPguKvguKHguYguLi4g4LiB4Lij4Li44LiT4Liy4Lij4Lit4Liq4Lix4LiB4LiE4Lij4Li54LmIIik7CgogICAgdHJ5IHsKICAgICAgICAvLyAxLiDguJTguLbguIfguILguYnguK3guKHguLnguKXguILguYnguK3guKrguK3guJrguYDguKfguK3guKPguYzguIrguLHguJnguKXguYjguLLguKrguLjguJQgKOC4l+C4teC5iOC4oeC4teC5gOC4ieC4peC4ouC5g+C4q+C4oeC5iCkKICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBxdWl6SWQpOwogICAgICAgIGNvbnN0IHF1aXpTbmFwID0gYXdhaXQgZ2V0RG9jKHF1aXpSZWYpOwogICAgICAgIGlmICghcXVpelNuYXAuZXhpc3RzKCkpIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAgICAgY29uc3QgbmV3UXVpekRhdGEgPSB7IGlkOiBxdWl6SWQsIC4uLnF1aXpTbmFwLmRhdGEoKSB9OwoKICAgICAgICAvLyAyLiDguJTguLbguIfguILguYnguK3guKHguLnguKXguIHguLLguKPguKrguYjguIfguIfguLLguJkgKHN1Ym1pc3Npb24pIOC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4uOC4geC4hOC4meC5g+C4meC4guC5ieC4reC4quC4reC4muC4meC4teC5iQogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkLCAic3VibWlzc2lvbnMiKTsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uc1NuYXAgPSBhd2FpdCBnZXREb2NzKHN1Ym1pc3Npb25zUmVmKTsKICAgICAgICBpZiAoc3VibWlzc2lvbnNTbmFwLmVtcHR5KSB7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguIHguLLguKPguKrguYjguIfguIfguLLguJnguYDguIHguYjguLLguYPguKvguYnguJXguKPguKfguIjguYPguKvguKHguYgiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gMy4g4Liq4Lij4LmJ4Liy4LiHIFByb21pc2Ug4Liq4Liz4Lir4Lij4Lix4Lia4LiB4Liy4Lij4LiV4Lij4Lin4LiI4LiE4Liw4LmB4LiZ4LiZ4LmD4Lir4Lih4LmI4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmB4LiV4LmI4Lil4Liw4LiE4LiZCiAgICAgICAgY29uc3QgcmVHcmFkZVByb21pc2VzID0gc3VibWlzc2lvbnNTbmFwLmRvY3MubWFwKHN1Ym1pc3Npb25Eb2MgPT4gCiAgICAgICAgICAgIHJlR3JhZGVTaW5nbGVTdWJtaXNzaW9uKHN1Ym1pc3Npb25Eb2MsIG5ld1F1aXpEYXRhKQogICAgICAgICk7CgogICAgICAgIC8vIDQuIOC4o+C4reC5g+C4q+C5ieC4geC4o+C4sOC4muC4p+C4meC4geC4suC4o+C4leC4o+C4p+C4iOC5g+C4q+C4oeC5iOC4guC4reC4h+C4l+C4uOC4geC4hOC4meC5gOC4quC4o+C5h+C4iOC4quC4tOC5ieC4mQogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHJlR3JhZGVQcm9taXNlcyk7CgogICAgICAgIC8vIDUuIOC4q+C4peC4seC4h+C4iOC4suC4geC4leC4o+C4p+C4iOC5g+C4q+C4oeC5iOC4hOC4o+C4muC4l+C4uOC4geC4hOC4meC5geC4peC5ieC4pyDguYPguKvguYnguK3guLHguJvguYDguJTguJXguJXguLLguKPguLLguIfguJzguLnguYnguJnguLPguILguK3guIfguYLguJvguKPguYDguIjguIQKICAgICAgICAvLyAo4LiI4Liz4LmA4Lib4LmH4LiZ4LiV4LmJ4Lit4LiH4Lih4Li1IHByb2plY3RJZCDguYPguJnguILguYnguK3guKHguLnguKXguILguYnguK3guKrguK3guJopCiAgICAgICAgaWYgKG5ld1F1aXpEYXRhLnByb2plY3RJZCkgewogICAgICAgICAgICBjb25zdCBwcm9qZWN0UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzYCwgbmV3UXVpekRhdGEucHJvamVjdElkKTsKICAgICAgICAgICAgY29uc3QgcHJvamVjdFNuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICAgICAgICAgIGlmIChwcm9qZWN0U25hcC5leGlzdHMoKSAmJiBwcm9qZWN0U25hcC5kYXRhKCkuc3R1ZGVudHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRVcGRhdGVQcm9taXNlcyA9IHByb2plY3RTbmFwLmRhdGEoKS5zdHVkZW50cy5tYXAoc3R1ZGVudE5hbWUgPT4gCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3R1ZGVudFByb2ZpbGUobmV3UXVpekRhdGEucHJvamVjdElkLCBzdHVkZW50TmFtZSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChzdHVkZW50VXBkYXRlUHJvbWlzZXMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNob3dNZXNzYWdlKGDguJXguKPguKfguIjguITguLDguYHguJnguJnguYPguKvguKHguYggJHtzdWJtaXNzaW9uc1NuYXAuc2l6ZX0g4Lij4Liy4Lii4LiB4Liy4Lij4Liq4Liz4LmA4Lij4LmH4LiIISDguITguLDguYHguJnguJnguYHguKXguLDguKrguJbguLTguJXguLTguJfguLHguYnguIfguKvguKHguJTguYTguJTguYnguKPguLHguJrguIHguLLguKPguK3guLHguJvguYDguJTguJXguYHguKXguYnguKdgKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlLWdyYWRlIHByb2Nlc3MgZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZShg4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiV4Lij4Lin4LiI4LiE4Liw4LmB4LiZ4LiZ4LmD4Lir4Lih4LmIOiAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIHJlR3JhZGVTaW5nbGVTdWJtaXNzaW9uKHN1Ym1pc3Npb25Eb2MsIG5ld1F1aXpEYXRhKSB7CiAgICBjb25zdCBzdWJtaXNzaW9uRGF0YSA9IHN1Ym1pc3Npb25Eb2MuZGF0YSgpOwogICAgY29uc3Qgc3R1ZGVudE5hbWUgPSBzdWJtaXNzaW9uRGF0YS5zdHVkZW50TmFtZTsKICAgIGNvbnN0IG9sZEF0dGVtcHRzID0gc3VibWlzc2lvbkRhdGEuYXR0ZW1wdHMgfHwgW107CiAgICBjb25zdCBuZXdBdHRlbXB0cyA9IFtdOwoKICAgIC8vIOC4lOC4tuC4hyBUeXBlIFNjb3Jpbmcg4LiI4Liy4LiBIFF1aXogRGF0YQogICAgY29uc3QgdHlwZVNjb3JpbmcgPSBuZXdRdWl6RGF0YS5zZXR0aW5ncz8udHlwZVNjb3JpbmcgfHwgeyBtY3E6IDEsIHNhOiAxLCB0ZjogMSB9OwoKICAgIGZvciAoY29uc3QgYXR0ZW1wdCBvZiBvbGRBdHRlbXB0cykgewogICAgICAgIGxldCBuZXdSYXdTY29yZSA9IDA7CiAgICAgICAgbGV0IG5ld0Vhcm5lZEJhZGdlcyA9IFtdOyAKICAgICAgICBsZXQgY29ycmVjdFN0cmVhayA9IDA7CiAgICAgICAgY29uc3QgbmV3RGV0YWlsZWRBbnN3ZXJzID0gW107CiAgICAgICAgCiAgICAgICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4LiC4Lit4LiH4Lij4Lit4Lia4LiZ4Li14LmJIChTdW0gb2YgV2VpZ2h0cykKICAgICAgICBsZXQgYXR0ZW1wdE1heFNjb3JlID0gMDsKCiAgICAgICAgZm9yIChjb25zdCBhbnMgb2YgYXR0ZW1wdC5hbnN3ZXJzKSB7CiAgICAgICAgICAgIGxldCBuZXdRdWVzdGlvbjsKICAgICAgICAgICAgaWYgKGFucy5xdWVzdGlvbklkKSB7CiAgICAgICAgICAgICAgICBuZXdRdWVzdGlvbiA9IG5ld1F1aXpEYXRhLnF1ZXN0aW9ucy5maW5kKHEgPT4gcS5pZCA9PT0gYW5zLnF1ZXN0aW9uSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghbmV3UXVlc3Rpb24gJiYgYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0KSB7CiAgICAgICAgICAgICAgICBuZXdRdWVzdGlvbiA9IG5ld1F1aXpEYXRhLnF1ZXN0aW9ucy5maW5kKHEgPT4gKHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dCkgPT09IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCBpc0NvcnJlY3QgPSBmYWxzZTsKICAgICAgICAgICAgbGV0IHdlaWdodCA9IDE7CgogICAgICAgICAgICBpZiAobmV3UXVlc3Rpb24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IG5ld1F1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBuZXdRdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8g4Lir4Liy4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBCiAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB3ZWlnaHQgPSBwYXJzZUZsb2F0KHR5cGVTY29yaW5nLnNhKSB8fCAxOwogICAgICAgICAgICAgICAgZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3JpbmcudGYpIHx8IDE7CiAgICAgICAgICAgICAgICBlbHNlIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3JpbmcubWNxKSB8fCAxOwoKICAgICAgICAgICAgICAgIHN3aXRjaCAocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbXVsdGlwbGVfY2hvaWNlJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1F1ZXN0aW9uLm9wdGlvbnMgJiYgbmV3UXVlc3Rpb24uY29ycmVjdEFuc3dlckluZGV4IDwgbmV3UXVlc3Rpb24ub3B0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RBbnN3ZXJUZXh0ID0gbmV3UXVlc3Rpb24ub3B0aW9uc1tuZXdRdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gKGFucy5hbnN3ZXJUZXh0ID09PSBjb3JyZWN0QW5zd2VyVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0dWRlbnRBbnN3ZXJCb29sID0gKGFucy5hbnN3ZXIgPT09IHRydWUgfHwgYW5zLmFuc3dlciA9PT0gJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gKHN0dWRlbnRBbnN3ZXJCb29sID09PSBuZXdRdWVzdGlvbi5jb3JyZWN0QW5zd2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IChhbnMuYW5zd2VyID09PSBuZXdRdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOgogICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3QgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKGFucy5hbnN3ZXIsIG5ld1F1ZXN0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gYW5zLmlzQ29ycmVjdDsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGF0dGVtcHRNYXhTY29yZSArPSB3ZWlnaHQ7CgogICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICBuZXdSYXdTY29yZSArPSB3ZWlnaHQ7IC8vIOC4muC4p+C4geC4hOC4sOC5geC4meC4meC4leC4suC4oeC4meC5ieC4s+C4q+C4meC4seC4gQogICAgICAgICAgICAgICAgY29ycmVjdFN0cmVhaysrOwogICAgICAgICAgICAgICAgaWYgKGNvcnJlY3RTdHJlYWsgPT09IDMpIG5ld0Vhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5PTl9GSVJFLmlkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWsgPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5ld0RldGFpbGVkQW5zd2Vycy5wdXNoKHsgLi4uYW5zLCBpc0NvcnJlY3Q6IGlzQ29ycmVjdCB9KTsgCiAgICAgICAgfQoKICAgICAgICBsZXQgbmV3UG9pbnRzID0gMDsKICAgICAgICBjb25zdCBpc1ByZXNlcnZlZFNjb3JlID0gYXR0ZW1wdC5pc1N5bmNHYW1lID09PSB0cnVlIHx8IChhdHRlbXB0LnBvaW50cyA+IChuZXdRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoICogMjApKTsKCiAgICAgICAgaWYgKGlzUHJlc2VydmVkU2NvcmUpIHsKICAgICAgICAgICAgbmV3UG9pbnRzID0gYXR0ZW1wdC5wb2ludHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g4LiE4Liz4LiZ4Lin4LiTIFBvaW50IOC5g+C4q+C4oeC5iOC5geC4muC4muC4nuC4t+C5ieC4meC4kOC4suC4mSAo4Lii4Lix4LiH4LmE4Lih4LmI4Lij4Lin4LihIENvbmZpZGVuY2Ug4LmA4Lie4Lij4Liy4Liw4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4LmI4Liy4Lit4Liy4LiI4LmE4Lih4LmI4Lih4Li1KQogICAgICAgICAgICAvLyDguKrguKHguKHguJXguLTguKfguYjguLLguILguYnguK3guKHguLnguKXguYDguIHguYjguLLguYDguJvguYfguJnguYHguJrguJogTm9ybWFsIE1vZGU6IOC4luC4ueC4geC5hOC4lOC5iSBXZWlnaHQgUG9pbnQKICAgICAgICAgICAgbmV3UG9pbnRzID0gbmV3UmF3U2NvcmU7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQmFkZ2Ug4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4LihICjguYDguIrguYfguITguIjguLLguIHguITguLDguYHguJnguJnguJTguLTguJogdnMg4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihKQogICAgICAgICAgICBpZiAobmV3UmF3U2NvcmUgPT09IGF0dGVtcHRNYXhTY29yZSAmJiBhdHRlbXB0TWF4U2NvcmUgPiAwKSB7CiAgICAgICAgICAgICAgICAvLyBuZXdQb2ludHMgKz0gNTA7IC8vIOC4leC4seC4lOC5guC4muC4meC4seC4qiArNTAg4Lit4Lit4LiB4LiV4Liy4LihIFJlcXVpcmVtZW50IOC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C5g+C4q+C5iSBQb2ludCDguKrguLDguJfguYnguK3guJnguITguLDguYHguJnguJnguIjguKPguLTguIcKICAgICAgICAgICAgICAgIG5ld0Vhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5QRVJGRUNUX1NDT1JFLmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBuZXdBdHRlbXB0cy5wdXNoKHsgCiAgICAgICAgICAgIC4uLmF0dGVtcHQsIAogICAgICAgICAgICBzY29yZTogbmV3UmF3U2NvcmUsIAogICAgICAgICAgICBwb2ludHM6IG5ld1BvaW50cywgCiAgICAgICAgICAgIGJhZGdlczogQXJyYXkuZnJvbShuZXcgU2V0KG5ld0Vhcm5lZEJhZGdlcykpLAogICAgICAgICAgICBhbnN3ZXJzOiBuZXdEZXRhaWxlZEFuc3dlcnMgCiAgICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgbmV3Rmlyc3RTY29yZSA9IG5ld0F0dGVtcHRzLmxlbmd0aCA+IDAgPyBuZXdBdHRlbXB0c1swXS5zY29yZSA6IDA7CiAgICBjb25zdCBuZXdCZXN0U2NvcmUgPSBNYXRoLm1heCguLi5uZXdBdHRlbXB0cy5tYXAoYSA9PiBhLnNjb3JlKSk7CiAgICBjb25zdCBuZXdMYXRlc3RTY29yZSA9IG5ld0F0dGVtcHRzLmxlbmd0aCA+IDAgPyBuZXdBdHRlbXB0c1tuZXdBdHRlbXB0cy5sZW5ndGggLSAxXS5zY29yZSA6IDA7CiAgICBjb25zdCBuZXdMYXRlc3RQb2ludHMgPSBuZXdBdHRlbXB0cy5sZW5ndGggPiAwID8gbmV3QXR0ZW1wdHNbbmV3QXR0ZW1wdHMubGVuZ3RoIC0gMV0ucG9pbnRzIDogMDsKICAgIAogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4Lih4LiC4Lit4LiH4LiC4LmJ4Lit4Liq4Lit4Lia4LiK4Li44LiU4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZICjguYDguJ7guLfguYjguK3guK3guLHguJvguYDguJTguJUgdG90YWxRdWVzdGlvbnMpCiAgICBsZXQgY3VycmVudFF1aXpNYXhTY29yZSA9IDA7CiAgICBuZXdRdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaChxID0+IHsKICAgICAgICBjb25zdCBxdCA9IHEucXVlc3Rpb25UeXBlIHx8IG5ld1F1aXpEYXRhLnF1aXpUeXBlOwogICAgICAgIGlmIChxdCA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXQgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSBjdXJyZW50UXVpek1heFNjb3JlICs9IChwYXJzZUZsb2F0KHR5cGVTY29yaW5nLnNhKSB8fCAxKTsKICAgICAgICBlbHNlIGlmIChxdCA9PT0gJ3RydWVfZmFsc2UnKSBjdXJyZW50UXVpek1heFNjb3JlICs9IChwYXJzZUZsb2F0KHR5cGVTY29yaW5nLnRmKSB8fCAxKTsKICAgICAgICBlbHNlIGN1cnJlbnRRdWl6TWF4U2NvcmUgKz0gKHBhcnNlRmxvYXQodHlwZVNjb3JpbmcubWNxKSB8fCAxKTsKICAgIH0pOwoKICAgIGNvbnN0IHN1Ym1pc3Npb25SZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplcy8ke25ld1F1aXpEYXRhLmlkfS9zdWJtaXNzaW9uc2AsIHN0dWRlbnROYW1lKTsKICAgIGF3YWl0IHVwZGF0ZURvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgYXR0ZW1wdHM6IG5ld0F0dGVtcHRzLAogICAgICAgIGZpcnN0U2NvcmU6IG5ld0ZpcnN0U2NvcmUsCiAgICAgICAgYmVzdFNjb3JlOiBuZXdCZXN0U2NvcmUsCiAgICAgICAgbGF0ZXN0U2NvcmU6IG5ld0xhdGVzdFNjb3JlLAogICAgICAgIHBvaW50czogbmV3TGF0ZXN0UG9pbnRzLAogICAgICAgIHRvdGFsUXVlc3Rpb25zOiBjdXJyZW50UXVpek1heFNjb3JlIC8vIOC4reC4seC4m+C5gOC4lOC4leC4leC4seC4p+C4q+C4suC4o+C5g+C4q+C5ieC5gOC4m+C5h+C4meC4hOC4sOC5geC4meC4meC5gOC4leC5h+C4oeC4o+C4p+C4oQogICAgfSk7Cn0KCiAgICAgICAgZnVuY3Rpb24gY2xlYW51cFF1aXpPcHRpb25zKHF1aXpEYXRhKSB7CiAgICAgICAgICAgIC8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4q+C4siDguKsu4LijLuC4oS4gKEdDRCkg4LmA4Lie4Li34LmI4Lit4LmD4LiK4LmJ4Lil4LiU4LiX4Lit4LiZ4LmA4Lio4Lip4Liq4LmI4Lin4LiZCiAgICAgICAgICAgIGNvbnN0IGdjZCA9IChhLCBiKSA9PiBiID09PSAwID8gYSA6IGdjZChiLCBhICUgYik7CgogICAgICAgICAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguYHguJvguKXguIfguKrguJXguKPguLTguIfguYDguKjguKnguKrguYjguKfguJkgKOC5gOC4iuC5iOC4mSAiMyAxLzIiKSDguYDguJvguYfguJnguITguYjguLLguJXguLHguKfguYDguKXguIIgKDMuNSkKICAgICAgICAgICAgY29uc3QgcGFyc2VGcmFjdGlvbiA9IChzdHIpID0+IHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBzdHIgPSBzdHIudHJpbSgpOwogICAgICAgICAgICAgICAgY29uc3QgcGFydHMgPSBzdHIuc3BsaXQoL1sgL10vKS5maWx0ZXIocCA9PiBwICE9PSAnJyk7IC8vIOC4o+C4reC4h+C4o+C4seC4muC4l+C4seC5ieC4hyAiMyAxLzIiIOC5geC4peC4sCAiMy8yIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7IC8vIOC4iOC4s+C4meC4p+C4meC4hOC4peC4sCAiMyAxLzIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHBhcnRzWzBdKSArIChwYXJzZUludChwYXJ0c1sxXSkgLyBwYXJzZUludChwYXJ0c1syXSkpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsgLy8g4LmA4Lio4Lip4LmA4LiB4Li04LiZICI3LzIiCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHBhcnRzWzBdKSAvIHBhcnNlSW50KHBhcnRzWzFdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydHMubGVuZ3RoID09PSAxICYmICFpc05hTihwYXJ0c1swXSkpIHsgLy8g4LiI4Liz4LiZ4Lin4LiZ4LmA4LiV4LmH4LihCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQocGFydHNbMF0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7IC8vIOC4o+C4ueC4m+C5geC4muC4muC4l+C4teC5iOC5hOC4oeC5iOC4o+C4ueC5ieC4iOC4seC4gQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Lil4LiU4LiX4Lit4LiZ4LmB4Lil4Liw4LiI4Lix4LiU4Lij4Li54Lib4LmB4Lia4Lia4LmA4Lio4Lip4Liq4LmI4Lin4LiZ4LmD4Lir4Lih4LmICiAgICAgICAgICAgIGNvbnN0IHNpbXBsaWZ5QW5kRm9ybWF0ID0gKHN0cikgPT4gewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzdHIgIT09ICdzdHJpbmcnKSByZXR1cm4gc3RyOwogICAgICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBzdHIubWF0Y2goLyhcZCspXHMrKFxkKylcLyhcZCspLyk7IC8vIOC4leC4o+C4p+C4iOC4iOC4seC4muC4o+C4ueC4m+C5geC4muC4muC4iOC4s+C4meC4p+C4meC4hOC4peC4sCAiMyAxLzIiCiAgICAgICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aG9sZSA9IHBhcnNlSW50KG1hdGNoWzFdKTsKICAgICAgICAgICAgICAgICAgICBsZXQgbnVtID0gcGFyc2VJbnQobWF0Y2hbMl0pOwogICAgICAgICAgICAgICAgICAgIGxldCBkZW4gPSBwYXJzZUludChtYXRjaFszXSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29tbW9uID0gZ2NkKG51bSwgZGVuKTsKICAgICAgICAgICAgICAgICAgICBudW0gLz0gY29tbW9uOwogICAgICAgICAgICAgICAgICAgIGRlbiAvPSBjb21tb247CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlbiA9PT0gMSkgcmV0dXJuICh3aG9sZSArIG51bSkudG9TdHJpbmcoKTsgLy8g4LiW4LmJ4Liy4LmA4Lib4LmH4LiZIDMgMi8yIOC5g+C4q+C5ieC5gOC4m+C5h+C4mSA0CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke3dob2xlfSAke251bX0vJHtkZW59YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBzdHI7IC8vIOC4hOC4t+C4meC4hOC5iOC4suC5gOC4lOC4tOC4oeC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5iOC4iOC4s+C4meC4p+C4meC4hOC4peC4sAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHF1aXpEYXRhICYmIHF1aXpEYXRhLnF1ZXN0aW9ucykgewogICAgICAgICAgICAgICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8g4LiX4Liz4LiH4Liy4LiZ4LmA4LiJ4Lie4Liy4Liw4LiB4Lix4Lia4LiE4Liz4LiW4Liy4Lih4LmB4Lia4Lia4Lib4Lij4LiZ4Lix4LiiIChtdWx0aXBsZV9jaG9pY2UpCiAgICAgICAgICAgICAgICAgICAgaWYgKHEucXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyAmJiBxLm9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdW5pcXVlT3B0aW9ucyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxDb3JyZWN0T3B0aW9uVGV4dCA9IHEub3B0aW9uc1txLmNvcnJlY3RBbnN3ZXJJbmRleF07CgogICAgICAgICAgICAgICAgICAgICAgICBxLm9wdGlvbnMuZm9yRWFjaChvcHQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2ltcGxpZmllZE9wdCA9IHNpbXBsaWZ5QW5kRm9ybWF0KG9wdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBudW1lcmljVmFsdWUgPSBwYXJzZUZyYWN0aW9uKHNpbXBsaWZpZWRPcHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguYPguIrguYnguITguYjguLLguJXguLHguKfguYDguKXguILguYDguJvguYfguJkga2V5IOC5gOC4nuC4t+C5iOC4reC4leC4o+C4p+C4iOC4quC4reC4muC4hOC4p+C4suC4oeC4i+C5ieC4s+C4i+C5ieC4reC4mQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li1IGtleSDguJnguLXguYkg4LmD4Lir4LmJ4LmA4Lie4Li04LmI4Lih4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIE1hcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bWVyaWNWYWx1ZSAhPT0gbnVsbCAmJiAhdW5pcXVlT3B0aW9ucy5oYXMobnVtZXJpY1ZhbHVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZU9wdGlvbnMuc2V0KG51bWVyaWNWYWx1ZSwgc2ltcGxpZmllZE9wdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiHIEFycmF5IOC4guC4reC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4q+C4oeC5iOC4iOC4suC4geC4hOC5iOC4suC4l+C4teC5iOC5hOC4oeC5iOC4i+C5ieC4s+C4geC4seC4mQogICAgICAgICAgICAgICAgICAgICAgICBxLm9wdGlvbnMgPSBBcnJheS5mcm9tKHVuaXF1ZU9wdGlvbnMudmFsdWVzKCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiE4LmJ4LiZ4Lir4LiyIEluZGV4IOC5g+C4q+C4oeC5iOC4guC4reC4h+C4hOC4s+C4leC4reC4muC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4hwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdDb3JyZWN0SW5kZXggPSBxLm9wdGlvbnMuZmluZEluZGV4KG9wdCA9PiBvcHQgPT09IHNpbXBsaWZ5QW5kRm9ybWF0KG9yaWdpbmFsQ29ycmVjdE9wdGlvblRleHQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcS5jb3JyZWN0QW5zd2VySW5kZXggPSBuZXdDb3JyZWN0SW5kZXggIT09IC0xID8gbmV3Q29ycmVjdEluZGV4IDogMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcXVpekRhdGE7CiAgICAgICAgfQoKZnVuY3Rpb24gc2hvd0dhbWVTdGFydENvbmZpcm1hdGlvbk1vZGFsKHF1aXpJZCwgbW9kZSwgdG9waWMpIHsKICAgIGNvbnN0IHF1aXogPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWQpIHx8IGFsbFF1aXp6ZXNHbG9iYWwuZmluZChxID0+IHEuaWQgPT09IHF1aXpJZCk7CiAgICBjb25zdCB0b3BpY1RleHQgPSBxdWl6ID8gcXVpei50b3BpYyA6ICh0b3BpYyB8fCAn4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaJyk7CgogICAgYWN0aW9uVGFyZ2V0SWQgPSBxdWl6SWQ7CiAgICAKICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1nYW1lLXN0YXJ0LWJ0bicpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtc3RhcnQtcXVpei1pZCcpLnZhbHVlID0gcXVpeklkOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWUtc3RhcnQtbW9kZScpLnZhbHVlID0gbW9kZTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1zdGFydC1tb2RhbC10aXRsZScpLmlubmVyVGV4dCA9IGDguYDguKPguLTguYjguKHguIHguLTguIjguIHguKPguKPguKE6ICR7dG9waWNUZXh0fWA7CgogICAgLy8gLS0tIOC4iOC4seC4lOC4geC4suC4o+C4geC4suC4o+C5geC4quC4lOC4h+C4nOC4pSBVSSDguJXguLLguKHguYLguKvguKHguJQgLS0tCiAgICBjb25zdCBzeW5jVmFyaWFudFNlbGVjdG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdmFyaWFudC1zZWxlY3RvcicpOwogICAgY29uc3Qgc3luY0JsYWNrTWFya2V0U2V0dGluZ3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmxhY2stbWFya2V0LXNldHRpbmdzLWNvbnRhaW5lcicpOyAKICAgIAogICAgLy8gKOC4peC4muC4leC4seC4p+C5geC4m+C4oyBvbmV0TW9kZUNvbnRhaW5lciDguK3guK3guIEpCiAgICAKICAgIGNvbnN0IHRpbWVyQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy10aW1lci1lbmFibGUtY2hlY2tib3gnKTsKICAgIGNvbnN0IHN5bmNUaW1lclNldHRpbmdzID0gdGltZXJDaGVja2JveCA/IHRpbWVyQ2hlY2tib3guY2xvc2VzdCgnZGl2LmJvcmRlci10JykgOiBudWxsOwoKICAgIGlmIChtb2RlID09PSAnc3luYycpIHsKICAgICAgICAvLyDguYLguKvguKHguJQgU3luYzog4LmB4Liq4LiU4LiH4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmC4Lir4Lih4LiU4LmA4LiB4LihLCDguYDguKfguKXguLIsIOC4leC4peC4suC4lOC4oeC4t+C4lAogICAgICAgIGlmIChzeW5jVmFyaWFudFNlbGVjdG9yKSBzeW5jVmFyaWFudFNlbGVjdG9yLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIGlmIChzeW5jVGltZXJTZXR0aW5ncykgc3luY1RpbWVyU2V0dGluZ3MuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgaWYgKHN5bmNCbGFja01hcmtldFNldHRpbmdzKSBzeW5jQmxhY2tNYXJrZXRTZXR0aW5ncy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAKICAgICAgICAvLyAo4Lil4Lia4Lia4Lij4Lij4LiX4Lix4LiU4LiX4Li14LmI4Liq4Lix4LmI4LiHIG9uZXRNb2RlQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpIOC4reC4reC4gSkKCiAgICB9IGVsc2UgewogICAgICAgIC8vIOC5guC4q+C4oeC4lOC4reC4t+C5iOC4meC5hjog4LiL4LmI4Lit4LiZ4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiC4Lit4LiHIFN5bmMg4LmD4Lir4LmJ4Lir4Lih4LiUCiAgICAgICAgaWYgKHN5bmNWYXJpYW50U2VsZWN0b3IpIHN5bmNWYXJpYW50U2VsZWN0b3IuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgaWYgKHN5bmNUaW1lclNldHRpbmdzKSBzeW5jVGltZXJTZXR0aW5ncy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICBpZiAoc3luY0JsYWNrTWFya2V0U2V0dGluZ3MpIHN5bmNCbGFja01hcmtldFNldHRpbmdzLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIAogICAgICAgIC8vICjguKXguJrguJrguKPguKPguJfguLHguJTguJfguLXguYjguKrguLHguYjguIcgb25ldE1vZGVDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykg4Lit4Lit4LiBKQogICAgfQoKICAgIC8vICjguKXguJrguKrguYjguKfguJnguKPguLXguYDguIvguYfguJXguITguYjguLIgb25ldENoZWNrYm94IOC4reC4reC4gSkKCiAgICAvLyDguYHguKrguJTguIcgTW9kYWwKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtLWdhbWUtc3RhcnQtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKfQoKYXN5bmMgZnVuY3Rpb24gc2F2ZUdhbWVSZXN1bHRzQXNTdWJtaXNzaW9ucyhmaW5hbEdhbWVEYXRhKSB7CiAgICBpZiAoZmluYWxHYW1lRGF0YS5yZXN1bHRzU2F2ZWQpIHsKICAgICAgICBjb25zb2xlLmxvZygiR2FtZSByZXN1bHRzIGFscmVhZHkgc2F2ZWQuIFNraXBwaW5nLiIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zb2xlLmxvZygiU2F2aW5nIGdhbWUgcmVzdWx0cyAoV2VpZ2h0ZWQgU2NvcmUpLi4uIiwgZmluYWxHYW1lRGF0YSk7CiAgICBjb25zdCBxdWl6SWQgPSBmaW5hbEdhbWVEYXRhLnF1aXpJZDsKICAgIGxldCBwbGF5ZXJzRGF0YSA9IFtdOwoKICAgIGlmIChmaW5hbEdhbWVEYXRhLnBsYXllcnMpIHsgCiAgICAgICAgcGxheWVyc0RhdGEgPSBPYmplY3QuZW50cmllcyhmaW5hbEdhbWVEYXRhLnBsYXllcnMpLm1hcCgoW25hbWUsIGRhdGFdKSA9PiAoeyBuYW1lLCAuLi5kYXRhIH0pKTsKICAgIH0gZWxzZSBpZiAoZmluYWxHYW1lRGF0YS5ncm91cHMpIHsgCiAgICAgICAgT2JqZWN0LnZhbHVlcyhmaW5hbEdhbWVEYXRhLmdyb3VwcykuZm9yRWFjaChncm91cCA9PiB7CiAgICAgICAgICAgIGdyb3VwLm1lbWJlcnMuZm9yRWFjaChtZW1iZXJOYW1lID0+IHsKICAgICAgICAgICAgICAgIHBsYXllcnNEYXRhLnB1c2goeyBuYW1lOiBtZW1iZXJOYW1lLCBzY29yZTogZ3JvdXAuc2NvcmUsIGFuc3dlcnM6IGdyb3VwLmFuc3dlcnMgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChwbGF5ZXJzRGF0YS5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICBjb25zdCBxdWl6RGF0YSA9IGZpbmFsR2FtZURhdGEuc2h1ZmZsZWRRdWl6IHx8IGN1cnJlbnRRdWl6RGF0YTsKICAgIAogICAgLy8gMS4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihIChUb3RhbCBXZWlnaHRlZCBTY29yZSkKICAgIGxldCB0b3RhbE1heFNjb3JlID0gMDsKICAgIHF1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgIGNvbnN0IHcgPSBnZXRRdWVzdGlvbldlaWdodChxdWl6RGF0YSwgcS5xdWVzdGlvblR5cGUgfHwgcXVpekRhdGEucXVpelR5cGUpOwogICAgICAgIHRvdGFsTWF4U2NvcmUgKz0gdzsKICAgIH0pOwoKICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICBjb25zdCBwcm9qZWN0SWQgPSBxdWl6RGF0YS5wcm9qZWN0SWQgfHwgY3VycmVudFByb2plY3RJZDsKICAgIGNvbnN0IHByb2ZpbGVVcGRhdGVzID0ge307CgogICAgZm9yIChjb25zdCBwbGF5ZXIgb2YgcGxheWVyc0RhdGEpIHsKICAgICAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgcGxheWVyLm5hbWUpOwogICAgICAgIAogICAgICAgIC8vIDIuIOC4hOC4s+C4meC4p+C4k+C4hOC4sOC5geC4meC4meC4lOC4tOC4muC4leC4suC4oeC4meC5ieC4s+C4q+C4meC4seC4gSAoV2VpZ2h0ZWQgUmF3IFNjb3JlKQogICAgICAgIGxldCByYXdTY29yZVdlaWdodGVkID0gMDsKICAgICAgICBjb25zdCBhbnN3ZXJzTGlzdCA9IHBsYXllci5hbnN3ZXJzIHx8IFtdOwogICAgICAgIAogICAgICAgIGFuc3dlcnNMaXN0LmZvckVhY2goYW5zID0+IHsKICAgICAgICAgICAgaWYgKGFucy5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgIC8vIOC4q+C4suC4hOC4s+C4luC4suC4oeC5gOC4nuC4t+C5iOC4reC4lOC4ueC4meC5ieC4s+C4q+C4meC4seC4gQogICAgICAgICAgICAgICAgY29uc3QgcSA9IHF1aXpEYXRhLnF1ZXN0aW9uc1thbnMucXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgICAgICBpZiAocSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHcgPSBnZXRRdWVzdGlvbldlaWdodChxdWl6RGF0YSwgcS5xdWVzdGlvblR5cGUgfHwgcXVpekRhdGEucXVpelR5cGUpOwogICAgICAgICAgICAgICAgICAgIHJhd1Njb3JlV2VpZ2h0ZWQgKz0gdzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmF3U2NvcmVXZWlnaHRlZCArPSAxOyAvLyBGYWxsYmFjawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIDMuIOC5g+C4iuC5iSBQb2ludHMg4LiX4Li14LmI4LmA4Lil4LmI4LiZ4LmE4LiU4LmJ4LiI4Lij4Li04LiH4LmD4LiZ4LmA4LiB4LihICjguKPguKfguKEgV2FnZXIg4LmB4Lil4LmJ4LinKQogICAgICAgIGxldCBmaW5hbFBvaW50cyA9IChwbGF5ZXIudG90YWxQb2ludHMgIT09IHVuZGVmaW5lZCkgPyBwbGF5ZXIudG90YWxQb2ludHMgOiByYXdTY29yZVdlaWdodGVkOwoKICAgICAgICBsZXQgZWFybmVkQmFkZ2VzID0gcGxheWVyLmJhZGdlcyB8fCBbXTsKICAgICAgICAvLyDguYDguIrguYfguITguITguLDguYHguJnguJnguYDguJXguYfguKHguIjguLLguIHguITguLDguYHguJnguJnguJTguLTguJrguJfguLXguYjguKHguLXguJnguYnguLPguKvguJnguLHguIHguYHguKXguYnguKcg4LmA4LiX4Li14Lii4Lia4LiB4Lix4Lia4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihCiAgICAgICAgaWYgKHJhd1Njb3JlV2VpZ2h0ZWQgPT09IHRvdGFsTWF4U2NvcmUgJiYgdG90YWxNYXhTY29yZSA+IDApIHsKICAgICAgICAgICAgaWYgKCFlYXJuZWRCYWRnZXMuaW5jbHVkZXMoJ3BlcmZlY3Rfc2NvcmUnKSkgZWFybmVkQmFkZ2VzLnB1c2goJ3BlcmZlY3Rfc2NvcmUnKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGdhbWVBdHRlbXB0ID0gewogICAgICAgICAgICBzY29yZTogcmF3U2NvcmVXZWlnaHRlZCwgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LmA4Lib4LmH4LiZ4LiE4Liw4LmB4LiZ4LiZ4LiX4Li14LmI4Lih4Li14LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIHBvaW50czogZmluYWxQb2ludHMsICAgICAvLyDguJrguLHguJnguJfguLbguIEgUG9pbnRzIOC4l+C4teC5iOC5gOC4peC5iOC4meC5hOC4lOC5ieC4iOC4o+C4tOC4h+C5g+C4meC5gOC4geC4oQogICAgICAgICAgICBiYWRnZXM6IGVhcm5lZEJhZGdlcywKICAgICAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgaXNTeW5jR2FtZTogdHJ1ZSwKICAgICAgICAgICAgYW5zd2VyczogYW5zd2Vyc0xpc3QubWFwKGFucyA9PiAoewogICAgICAgICAgICAgICAgcXVlc3Rpb25JZDogYW5zLnF1ZXN0aW9uSWQsCiAgICAgICAgICAgICAgICBhbnN3ZXI6IGFucy5hbnN3ZXIsCiAgICAgICAgICAgICAgICBhbnN3ZXJUZXh0OiBhbnMuYW5zd2VyVGV4dCwKICAgICAgICAgICAgICAgIGlzQ29ycmVjdDogYW5zLmlzQ29ycmVjdCwKICAgICAgICAgICAgICAgIG9yaWdpbmFsUXVlc3Rpb25UZXh0OiBhbnMub3JpZ2luYWxRdWVzdGlvblRleHQsCiAgICAgICAgICAgICAgICB3YXNDb25maWRlbnQ6IGFucy53YXNDb25maWRlbnQsCiAgICAgICAgICAgICAgICBwb3dlcnVwVXNlZDogYW5zLnBvd2VydXBVc2VkIHx8IG51bGwgCiAgICAgICAgICAgIH0pKQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgY29uc3Qgc3VibWlzc2lvbkRvYyA9IGF3YWl0IGdldERvYyhzdWJtaXNzaW9uUmVmKTsKICAgICAgICBjb25zdCBleGlzdGluZ0RhdGEgPSBzdWJtaXNzaW9uRG9jLmV4aXN0cygpID8gc3VibWlzc2lvbkRvYy5kYXRhKCkgOiB7fTsKICAgICAgICAKICAgICAgICBjb25zdCBvbGRCZXN0UG9pbnRzID0gZXhpc3RpbmdEYXRhLnBvaW50cyB8fCAwOwogICAgICAgIGxldCBwb2ludHNUb0FkZCA9IDA7CiAgICAgICAgaWYgKGZpbmFsUG9pbnRzID4gb2xkQmVzdFBvaW50cykgewogICAgICAgICAgICBwb2ludHNUb0FkZCA9IGZpbmFsUG9pbnRzIC0gb2xkQmVzdFBvaW50czsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHN1Ym1pc3Npb25EYXRhID0gewogICAgICAgICAgICBzdHVkZW50TmFtZTogcGxheWVyLm5hbWUsCiAgICAgICAgICAgIHRvdGFsUXVlc3Rpb25zOiB0b3RhbE1heFNjb3JlLCAvLyDguYPguIrguYnguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKHguYDguJvguYfguJnguJXguLHguKfguKvguLLguKMKICAgICAgICAgICAgYXR0ZW1wdHM6IGFycmF5VW5pb24oZ2FtZUF0dGVtcHQpLAogICAgICAgICAgICBsYXRlc3RTY29yZTogcmF3U2NvcmVXZWlnaHRlZCwKICAgICAgICAgICAgcG9pbnRzOiBNYXRoLm1heChvbGRCZXN0UG9pbnRzLCBmaW5hbFBvaW50cyksCiAgICAgICAgICAgIGxhdGVzdFN1Ym1pdHRlZEF0OiBnYW1lQXR0ZW1wdC5zdWJtaXR0ZWRBdCwKICAgICAgICAgICAgYmVzdFNjb3JlOiBNYXRoLm1heCgoZXhpc3RpbmdEYXRhLmJlc3RTY29yZSB8fCAwKSwgcmF3U2NvcmVXZWlnaHRlZCksCiAgICAgICAgICAgIGZpcnN0U2NvcmU6IGV4aXN0aW5nRGF0YS5maXJzdFNjb3JlICE9PSB1bmRlZmluZWQgPyBleGlzdGluZ0RhdGEuZmlyc3RTY29yZSA6IHJhd1Njb3JlV2VpZ2h0ZWQKICAgICAgICB9OwoKICAgICAgICBiYXRjaC5zZXQoc3VibWlzc2lvblJlZiwgc3VibWlzc2lvbkRhdGEsIHsgbWVyZ2U6IHRydWUgfSk7CgogICAgICAgIGlmIChwcm9qZWN0SWQpIHsKICAgICAgICAgICAgaWYgKCFwcm9maWxlVXBkYXRlc1twbGF5ZXIubmFtZV0pIHsKICAgICAgICAgICAgICAgIHByb2ZpbGVVcGRhdGVzW3BsYXllci5uYW1lXSA9IHsgcG9pbnRzVG9BZGQ6IDAsIGJhZGdlc1RvQWRkOiBbXSB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByb2ZpbGVVcGRhdGVzW3BsYXllci5uYW1lXS5wb2ludHNUb0FkZCArPSBwb2ludHNUb0FkZDsKICAgICAgICAgICAgZWFybmVkQmFkZ2VzLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICBwcm9maWxlVXBkYXRlc1twbGF5ZXIubmFtZV0uYmFkZ2VzVG9BZGQucHVzaChiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwcm9qZWN0SWQpIHsKICAgICAgICBmb3IgKGNvbnN0IFtzdHVkZW50TmFtZSwgdXBkYXRlRGF0YV0gb2YgT2JqZWN0LmVudHJpZXMocHJvZmlsZVVwZGF0ZXMpKSB7CiAgICAgICAgICAgIGlmICh1cGRhdGVEYXRhLnBvaW50c1RvQWRkID4gMCB8fCB1cGRhdGVEYXRhLmJhZGdlc1RvQWRkLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpbGVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHMvJHtwcm9qZWN0SWR9L3N0dWRlbnRQcm9maWxlc2AsIHN0dWRlbnROYW1lKTsKICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVBheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAgICAgc3R1ZGVudE5hbWU6IHN0dWRlbnROYW1lLAogICAgICAgICAgICAgICAgICAgIHRvdGFsUG9pbnRzOiBpbmNyZW1lbnQodXBkYXRlRGF0YS5wb2ludHNUb0FkZCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB1cGRhdGVEYXRhLmJhZGdlc1RvQWRkLmZvckVhY2goYmFkZ2VJZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlUGF5bG9hZFtgYmFkZ2VzQ291bnQuJHtiYWRnZUlkfWBdID0gaW5jcmVtZW50KDEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBiYXRjaC5zZXQocHJvZmlsZVJlZiwgdXBkYXRlUGF5bG9hZCwgeyBtZXJnZTogdHJ1ZSB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICB0cnkgewogICAgICAgIGlmIChjdXJyZW50TGl2ZUdhbWVJZCkgewogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgYmF0Y2gudXBkYXRlKGdhbWVSZWYsIHsgcmVzdWx0c1NhdmVkOiB0cnVlIH0pOwogICAgICAgIH0KCiAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7CiAgICAgICAgY29uc29sZS5sb2coIlNhdmUgY29tcGxldGUgKFdlaWdodGVkIFNjb3JlcykiKTsKICAgICAgICBzaG93TWVzc2FnZShg4Lia4Lix4LiZ4LiX4Li24LiB4Lic4Lil4LiB4Liy4Lij4LmA4Lij4Li14Lii4LiZ4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinIWApOwogICAgICAgIAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzYXZpbmcgZ2FtZSByZXN1bHRzOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4Lic4Lil4LiE4Liw4LmB4LiZ4LiZIik7CiAgICB9Cn0KCi8vIOKWvOKWvOKWvCDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgc2F2ZVF1aXog4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOKWvOKWvOKWvAphc3luYyBmdW5jdGlvbiBzYXZlUXVpeihmb3JjZWRQcm9qZWN0SWQgPSBudWxsLCBibHVlcHJpbnRUb3BpY0lkID0gbnVsbCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKZnVuY3Rpb24gcHJvbXB0Rm9yUHJvamVjdEFuZFNhdmUoKSB7CiAgICBjb25zdCBtb3ZlUXVpek1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdmUtcXVpei1tb2RhbCcpOwogICAgY29uc3QgcHJvamVjdFNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotcHJvamVjdC1zZWxlY3QnKTsKICAgIGNvbnN0IG1vZGFsVGl0bGUgPSBtb3ZlUXVpek1vZGFsLnF1ZXJ5U2VsZWN0b3IoJ2gzJyk7CiAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tbW92ZS1xdWl6LWJ0bicpOwoKICAgIC8vIDEuIOC5gOC4m+C4peC4teC5iOC4ouC4meC4guC5ieC4reC4hOC4p+C4suC4oeC5g+C4mSBNb2RhbCDguYPguKvguYnguYDguKvguKHguLLguLDguKrguKEKICAgIG1vZGFsVGl0bGUudGV4dENvbnRlbnQgPSAn4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LmA4Lie4Li34LmI4Lit4Lia4Lix4LiZ4LiX4Li24LiBJzsKICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAn4LmA4Lil4Li34Lit4LiB4LmB4Lil4Liw4Lia4Lix4LiZ4LiX4Li24LiBJzsKCiAgICAvLyAyLiDguYHguKrguJTguIfguKPguLLguKLguIHguLLguKPguYLguJvguKPguYDguIjguITguJfguLHguYnguIfguKvguKHguJTguJfguLXguYjguKHguLUKICAgIGlmIChhbGxQcm9qZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICBwcm9qZWN0U2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPuC4hOC4uOC4k+C4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC5guC4m+C4o+C5gOC4iOC4hDwvb3B0aW9uPic7CiAgICAgICAgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICAgIHByb2plY3RTZWxlY3QuaW5uZXJIVE1MID0gYWxsUHJvamVjdHMKICAgICAgICAgICAgLm1hcChwID0+IGA8b3B0aW9uIHZhbHVlPSIke3AuaWR9Ij4ke3AucHJvamVjdE5hbWV9PC9vcHRpb24+YCkKICAgICAgICAgICAgLmpvaW4oJycpOwogICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KICAgIAogICAgLy8gMy4g4LmB4Liq4LiU4LiHIE1vZGFsCiAgICBtb3ZlUXVpek1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwoKICAgIC8vIDQuIOC4iOC4seC4lOC4geC4suC4o+C5gOC4oeC4t+C5iOC4reC4nOC4ueC5ieC5g+C4iuC5ieC4geC4lOC4m+C4uOC5iOC4oSAi4LmA4Lil4Li34Lit4LiB4LmB4Lil4Liw4Lia4Lix4LiZ4LiX4Li24LiBIgogICAgY29uc3QgbmV3Q29uZmlybUhhbmRsZXIgPSAoKSA9PiB7CiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0SWQgPSBwcm9qZWN0U2VsZWN0LnZhbHVlOwogICAgICAgIGlmIChzZWxlY3RlZFByb2plY3RJZCkgewogICAgICAgICAgICBjdXJyZW50UHJvamVjdElkID0gc2VsZWN0ZWRQcm9qZWN0SWQ7IC8vICoq4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LmC4Lib4Lij4LmA4LiI4LiE4LiX4Li14LmI4LmA4Lil4Li34Lit4LiBKioKICAgICAgICAgICAgbW92ZVF1aXpNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgLy8g4LiL4LmI4Lit4LiZIE1vZGFsCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDguYDguKPguLXguKLguIHguJ/guLHguIfguIHguYzguIrguLHguJkgc2F2ZVF1aXog4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiHIOC4i+C4tuC5iOC4h+C4hOC4o+C4seC5ieC4h+C4meC4teC5iSBjdXJyZW50UHJvamVjdElkIOC4iOC4sOC5hOC4oeC5iOC5gOC4m+C5h+C4meC4hOC5iOC4suC4p+C5iOC4suC4h+C5geC4peC5ieC4pwogICAgICAgICAgICBzYXZlUXVpeigpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4hOC4t+C4meC4hOC5iOC4suC4guC5ieC4reC4hOC4p+C4suC4oeC5geC4peC4sCBFdmVudCBMaXN0ZW5lciDguILguK3guIcgTW9kYWwg4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihCiAgICAgICAgICAgIG1vZGFsVGl0bGUudGV4dENvbnRlbnQgPSAn4Lii4LmJ4Liy4Lii4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmE4Lib4LmC4Lib4Lij4LmA4LiI4LiE4Lit4Li34LmI4LiZJzsKICAgICAgICAgICAgY29uZmlybUJ0bi50ZXh0Q29udGVudCA9ICfguKLguYnguLLguKInOwogICAgICAgICAgICBjb25maXJtQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbmV3Q29uZmlybUhhbmRsZXIpOwogICAgICAgICAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY29uZmlybU1vdmVRdWl6KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmC4Lib4Lij4LmA4LiI4LiE4LiX4Li14LmI4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiBIik7CiAgICAgICAgfQogICAgfTsKCiAgICAvLyDguKXguJogRXZlbnQgTGlzdGVuZXIg4LmA4LiB4LmI4Liy4Lit4Lit4LiB4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinIOC5geC4peC5ieC4p+C5g+C4quC5iOC4leC4seC4p+C5g+C4q+C4oeC5iOC5gOC4guC5ieC4suC5hOC4mwogICAgY29uZmlybUJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGNvbmZpcm1Nb3ZlUXVpeik7CiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbmV3Q29uZmlybUhhbmRsZXIpOwp9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gY29weVRleHRUb0NsaXBib2FyZCh0ZXh0LCBzdWNjZXNzTWVzc2FnZSkgewogICAgICAgICAgICBjb25zdCB0ZXh0QXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICAgICAgICAgIHRleHRBcmVhLnZhbHVlID0gdGV4dDsKICAgICAgICAgICAgdGV4dEFyZWEuc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwogICAgICAgICAgICB0ZXh0QXJlYS5zdHlsZS5vcGFjaXR5ID0gIjAiOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRBcmVhKTsKICAgICAgICAgICAgdGV4dEFyZWEuZm9jdXMoKTsKICAgICAgICAgICAgdGV4dEFyZWEuc2VsZWN0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzZnVsID0gZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKHN1Y2Nlc3NmdWwgPyBzdWNjZXNzTWVzc2FnZSA6ICLguITguLHguJTguKXguK3guIHguYTguKHguYjguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiE4Lix4LiU4Lil4Lit4LiB4LmE4Lih4LmI4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDb3B5IGNvbW1hbmQgZmFpbGVkJywgZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRBcmVhKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBBZG1pbiBSZXN1bHRzIFZpZXcgLS0tCiAgICAgICAgZnVuY3Rpb24gbGlzdGVuRm9yUHJvamVjdFF1aXp6ZXMocHJvamVjdElkKSB7CiAgICAgICAgICAgIGNvbnN0IHF1aXp6ZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgKTsKICAgICAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHF1aXp6ZXNSZWYsIHdoZXJlKCJwcm9qZWN0SWQiLCAiPT0iLCBwcm9qZWN0SWQpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuc3Vic2NyaWJlUXVpenplc0xpc3RlbmVyID0gb25TbmFwc2hvdChxLCBhc3luYyAoc25hcHNob3QpID0+IHsKICAgICAgICAgICAgICAgIGFsbFF1aXp6ZXMgPSBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gKHsgaWQ6IGRvYy5pZCwgLi4uZG9jLmRhdGEoKSB9KSk7CiAgICAgICAgICAgICAgICByZW5kZXJRdWl6emVzKCk7CiAgICAgICAgICAgIH0sIChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZmV0Y2hpbmcgcHJvamVjdCBxdWl6emVzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0LXF1aXp6ZXMtbGlzdCcpLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1yZWQtNTAwIj7guYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYLguKvguKXguJTguYHguJrguJrguJfguJTguKrguK3guJo8L3A+JzsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAphc3luYyBmdW5jdGlvbiByZW5kZXJRdWl6emVzKCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVW5wYWlyUXVpeihxdWl6SWRUb1VucGFpcikgewogICAgY29uc3QgcXVpekRhdGEgPSBhbGxRdWl6emVzLmZpbmQocSA9PiBxLmlkID09PSBxdWl6SWRUb1VucGFpcik7CiAgICBpZiAoIXF1aXpEYXRhIHx8ICFxdWl6RGF0YS5wYWlyZWRRdWl6SWQpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmIIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4ouC4geC5gOC4peC4tOC4geC4geC4suC4o+C4iOC4seC4muC4hOC4ueC5iOC5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5iT9gLAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0UXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkVG9VbnBhaXIpOwogICAgICAgICAgICAgICAgY29uc3Qgc2Vjb25kUXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpekRhdGEucGFpcmVkUXVpeklkKTsKCiAgICAgICAgICAgICAgICAvLyDguKXguJrguIHguLLguKPguIjguLHguJrguITguLnguYjguILguK3guIfguJfguLHguYnguIfguKrguK3guIfguJ3guLHguYjguIcKICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChkYik7CiAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUoZmlyc3RRdWl6UmVmLCB7IHBhaXJlZFF1aXpJZDogbnVsbCB9KTsKICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShzZWNvbmRRdWl6UmVmLCB7IHBhaXJlZFF1aXpJZDogbnVsbCB9KTsKICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LiI4Lix4Lia4LiE4Li54LmI4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgICAgICAgICAvLyBvblNuYXBzaG90IOC4iOC4sOC4reC4seC4m+C5gOC4lOC4lSBVSSDguYPguKvguYnguK3guLHguJXguYLguJnguKHguLHguJXguLQKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHVucGFpcmluZyBxdWl6emVzOiIsIGVycm9yKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguKLguIHguYDguKXguLTguIHguIHguLLguKPguIjguLHguJrguITguLnguYgiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICk7Cn0KLy8g4pay4pay4payIOC4quC4tOC5ieC4meC4quC4uOC4lOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iCDilrLilrLilrIKCi8vIC0tLSDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgZm9ybWF0QW5kUHJpbnRMZXNzb25QbGFuIOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KZnVuY3Rpb24gZm9ybWF0QW5kUHJpbnRMZXNzb25QbGFuKGxlc3NvblBsYW4sIHF1aXpEYXRhKSB7CiAgICBjb25zdCBsZXNzb25XaW5kb3cgPSB3aW5kb3cub3BlbignJywgJ19ibGFuaycpOwogICAgCiAgICBjb25zdCBsZXNzb25IdG1sID0gYAogICAgICAgIDwhRE9DVFlQRSBodG1sPgogICAgICAgIDxodG1sIGxhbmc9InRoIj4KICAgICAgICA8aGVhZD4KICAgICAgICAgICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgICAgICAgICA8dGl0bGU+4LmB4Lic4LiZ4LiB4Liy4Lij4Liq4Lit4LiZOiAke3F1aXpEYXRhLnRvcGljfTwvdGl0bGU+CiAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi50YWlsd2luZGNzcy5jb20iPjxcL3NjcmlwdD4KICAgICAgICAgICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1TYXJhYnVuOndnaHRANDAwOzcwMCZkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXggPSB7CiAgICAgICAgICAgICAgICAgICAgdGV4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZU1hdGg6IFtbJyQnLCAnJCddLCBbJ1xcXFwoJywgJ1xcXFwpJ11dCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzdmc6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9udENhY2hlOiAnZ2xvYmFsJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIDxcL3NjcmlwdD4KICAgICAgICAgICAgPHNjcmlwdCBpZD0iTWF0aEpheC1zY3JpcHQiIGFzeW5jIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tYXRoamF4QDMvZXM1L3RleC1tbWwtY2h0bWwuanMiPjxcL3NjcmlwdD4KICAgICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2FyYWJ1bicsIHNhbnMtc2VyaWY7IH0KICAgICAgICAgICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAgICAgICAgIC5uby1wcmludCB7IGRpc3BsYXk6IG5vbmU7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5jb250ZW50LXNlY3Rpb24geyBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7IH0KICAgICAgICAgICAgPC9zdHlsZT4KICAgICAgICA8L2hlYWQ+CiAgICAgICAgPGJvZHkgY2xhc3M9InAtOCBtYXgtdy00eGwgbXgtYXV0byI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIG1iLTgiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGciPuC5geC4nOC4meC4geC4suC4o+C4quC4reC4meC5geC4peC4sOC4hOC4s+C5geC4meC4sOC4meC4s+C4quC4s+C4q+C4o+C4seC4muC4hOC4o+C4uTwvcD4KICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIj7guYDguKPguLfguYjguK3guIc6ICR7cXVpekRhdGEudG9waWN9PC9oMT4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGFjZS15LTgiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIGJnLXJlZC01MCBwLTQgcm91bmRlZC1sZyBib3JkZXItbC00IGJvcmRlci1yZWQtNDAwIj4KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtcmVkLTgwMCBtYi0yIj7guIjguLjguJTguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKLguLHguIfguYTguKHguYjguYDguILguYnguLLguYPguIggKExlYXJuaW5nIEdhcHMpPC9oMj4KICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSB0ZXh0LXJlZC05MDAgc3BhY2UteS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtsZXNzb25QbGFuLmxlYXJuaW5nR2Fwcy5tYXAoZ2FwID0+IGA8bGk+JHtnYXB9PC9saT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIGJnLWJsdWUtNTAgcC00IHJvdW5kZWQtbGcgYm9yZGVyLWwtNCBib3JkZXItYmx1ZS00MDAiPgogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC1ibHVlLTgwMCBtYi0yIj7guYHguJnguKfguJfguLLguIfguIHguLLguKPguKrguK3guJnguYHguKXguLDguYDguJnguLfguYnguK3guKvguLLguJfguJrguJfguKfguJk8L2gyPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktODAwIHdoaXRlc3BhY2UtcHJlLXdyYXAiPiR7bGVzc29uUGxhbi50ZWFjaGluZ0NvbnRlbnR9PC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGVudC1zZWN0aW9uIGJnLWdyZWVuLTUwIHAtNCByb3VuZGVkLWxnIGJvcmRlci1sLTQgYm9yZGVyLWdyZWVuLTQwMCI+CiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LWdyZWVuLTgwMCBtYi0yIj7guYLguIjguJfguKLguYzguJXguLHguKfguK3guKLguYjguLLguIfguKrguLPguKvguKPguLHguJrguJ3guLbguIHguJ3guJk8L2gyPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7bGVzc29uUGxhbi5wcmFjdGljZVByb2JsZW1zLm1hcChwID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guYLguIjguJfguKLguYw6PC9zdHJvbmc+ICR7cC5xdWVzdGlvbn08L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guYDguInguKXguKI6PC9zdHJvbmc+ICR7cC5zb2x1dGlvbn08L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9ib2R5PgogICAgICAgIDwvaHRtbD4KICAgIGA7CiAgICAKICAgIGxlc3NvbldpbmRvdy5kb2N1bWVudC53cml0ZShsZXNzb25IdG1sKTsKICAgIGxlc3NvbldpbmRvdy5kb2N1bWVudC5jbG9zZSgpOwogICAgbGVzc29uV2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIC8vIOC5gOC4nuC4tOC5iOC4oeC4geC4suC4o+C4q+C4meC5iOC4p+C4h+C5gOC4p+C4peC4suC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBNYXRoSmF4IOC4l+C4s+C4h+C4suC4meC5gOC4quC4o+C5h+C4iOC4geC5iOC4reC4meC4nuC4tOC4oeC4nuC5jAogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBsZXNzb25XaW5kb3cucHJpbnQoKTsKICAgICAgICB9LCAxMDAwKTsgCiAgICB9Owp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVBaUZpeEZvcm11bGEoaW5kZXgpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUdlbmVyYXRlTGVzc29uUGxhbihxdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKICAgICAgICAKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVEdXBsaWNhdGVRdWl6IOC5gOC4lOC4tOC4oeC4l+C4seC5ieC4h+C4q+C4oeC4lCAtLS0KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRHVwbGljYXRlUXVpeihxdWl6SWQpICB7IC8qIFJlbW92ZWQgKi8gfSAKCi8vIC0tLSDguKfguLLguIfguJfguLHguJrguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlRGVsZXRlUXVpeiDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkgLS0tCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZURlbGV0ZVF1aXoocXVpeklkLCBzaG93U3VjY2Vzc01lc3NhZ2UgPSB0cnVlKSAgeyAvKiBSZW1vdmVkICovIH0gCgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIHNob3dRdWl6RGV0YWlsVmlldyhxdWl6SWQpIHsKICAgICAgICAgICAgaWYgKHVuc3Vic2NyaWJlU3VibWlzc2lvbnNMaXN0ZW5lcikgdW5zdWJzY3JpYmVTdWJtaXNzaW9uc0xpc3RlbmVyKCk7CiAgICAgICAgICAgIHN3aXRjaFF1aXpEZXRhaWxUYWIoJ2FuYWx5dGljcycpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIDEuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4l+C4teC5iOC4hOC4peC4tOC4gQogICAgICAgICAgICAgICAgY29uc3QgcXVpelJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHF1aXpEb2MgPSBhd2FpdCBnZXREb2MocXVpelJlZik7CgogICAgICAgICAgICAgICAgaWYgKCFxdWl6RG9jLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5hOC4oeC5iOC4nuC4muC4guC5ieC4reC4oeC4ueC4peC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBxdWl6RGF0YSA9IHsgaWQ6IHF1aXpEb2MuaWQsIC4uLnF1aXpEb2MuZGF0YSgpIH07CiAgICAgICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBxdWl6RGF0YTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gWyDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguILguYPguKvguKHguYjguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KICAgICAgICAgICAgICAgIC8vIDIuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C5guC4m+C4o+C5gOC4iOC4hOC5geC4oeC5iOC4guC4reC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4seC5ieC4meC5hiDguYDguKrguKHguK0KICAgICAgICAgICAgICAgIC8vIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5geC4meC5iOC5g+C4iOC4p+C5iOC4suC5gOC4o+C4suC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4meC4seC4geC5gOC4o+C4teC4ouC4mSAoY3VycmVudFByb2plY3REYXRhKSDguJ7guKPguYnguK3guKHguYPguIrguYnguIfguLLguJkKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcHJvamVjdHNgLCBxdWl6RGF0YS5wcm9qZWN0SWQpOwogICAgICAgICAgICAgICAgY29uc3QgcHJvamVjdERvYyA9IGF3YWl0IGdldERvYyhwcm9qZWN0UmVmKTsKICAgICAgICAgICAgICAgIGlmIChwcm9qZWN0RG9jLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2plY3REYXRhID0gcHJvamVjdERvYy5kYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2plY3RJZCA9IHF1aXpEYXRhLnByb2plY3RJZDsgLy8g4Lit4Lix4Lib4LmA4LiU4LiVIElEIOC5guC4m+C4o+C5gOC4iOC4hOC4m+C4seC4iOC4iOC4uOC4muC4seC4meC5g+C4q+C5ieC4luC4ueC4geC4leC5ieC4reC4h+C5gOC4quC4oeC4rQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyDguYPguJnguIHguKPguJPguLXguJfguLXguYjguYLguJvguKPguYDguIjguITguJbguLnguIHguKXguJrguYTguJvguYHguKXguYnguKfguYHguJXguYjguYHguJrguJrguJfguJTguKrguK3guJrguKLguLHguIfguK3guKLguLnguYggKOC4geC4o+C4k+C4teC4ieC4uOC4geC5gOC4ieC4tOC4mSkKICAgICAgICAgICAgICAgICAgICAvLyDguYPguKvguYnguYPguIrguYnguILguYnguK3guKHguLnguKXguKfguYjguLLguIfguYYg4LmB4LiX4LiZ4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4LmB4Lit4Lib4Lie4Lix4LiHCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFByb2plY3REYXRhID0geyBzdHVkZW50czogW10gfTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UHJvamVjdElkID0gcXVpekRhdGEucHJvamVjdElkOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gLS0tIFsg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCgogICAgICAgICAgICAgICAgLy8gMy4g4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4Lir4Lix4Lin4LiC4LmJ4Lit4LmB4Lil4LiwIElEIOC4muC4meC4q+C4meC5ieC4suC4iOC4rQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtcXVpei10aXRsZScpLnRleHRDb250ZW50ID0gcXVpekRhdGEudG9waWM7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy1xdWl6LWlkLWRpc3BsYXknKS50ZXh0Q29udGVudCA9IHF1aXpJZDsKCiAgICAgICAgICAgICAgICAvLyA0LiDguYDguKPguLTguYjguKHguJ/guLHguIfguILguYnguK3guKHguLnguKXguIHguLLguKPguKrguYjguIfguIfguLLguJkg4LmB4Lil4Liw4Lin4Liy4LiU4Lic4Lil4Lil4Lix4Lie4LiY4LmMCiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIHF1aXpJZCwgInN1Ym1pc3Npb25zIik7CnVuc3Vic2NyaWJlU3VibWlzc2lvbnNMaXN0ZW5lciA9IG9uU25hcHNob3Qoc3VibWlzc2lvbnNSZWYsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgICAgICAgIC8vIDEuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lCAo4Lij4Lin4Lih4LiX4Lix4LmJ4LiH4LiX4Li14LmI4Lii4Lix4LiH4LiX4Liz4LmE4Lih4LmI4LmA4Liq4Lij4LmH4LiIKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbFN1Ym1pc3Npb25zID0gc25hcHNob3QuZG9jcy5tYXAoZG9jID0+ICh7IGlkOiBkb2MuaWQsIC4uLmRvYy5kYXRhKCkgfSkpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdWJtaXNzaW9ucyA9IGFsbFN1Ym1pc3Npb25zOyAKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4g4Liq4Lij4LmJ4Liy4LiHIGxpc3Qg4LmD4Lir4Lih4LmI4LiX4Li14LmI4LiB4Lij4Lit4LiH4LmA4Lit4Liy4LmA4LiJ4Lie4Liy4Liw4LiE4LiZ4LiX4Li14LmIICLguJfguLPguYDguKrguKPguYfguIjguYHguKXguYnguKciIOC4iOC4o+C4tOC4h+C5hiAo4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4LiX4Liz4LiC4LmJ4Lit4Liq4Lit4LiaKQogICAgICAgICAgICAgICAgICAgIC8vIOC5gOC4nuC4t+C5iOC4reC4quC5iOC4h+C5hOC4m+C5g+C4q+C5ieC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4guC5ieC4reC4oeC4ueC4peC4hOC4sOC5geC4meC4meC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlZFN1Ym1pc3Npb25zID0gYWxsU3VibWlzc2lvbnMuZmlsdGVyKHN1YiA9PiBzdWIuYXR0ZW1wdHMgJiYgc3ViLmF0dGVtcHRzLmxlbmd0aCA+IDApOwoKICAgICAgICAgICAgICAgICAgICAvLyAzLiDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguJXguYjguLLguIfguYYg4LmC4LiU4Lii4Liq4LmI4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Li14LmI4LmA4Lir4Lih4Liy4Liw4Liq4Lih4LmE4Lib4LmD4Lir4LmJCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyQmVoYXZpb3JMb2coYWxsU3VibWlzc2lvbnMpOyAvLyA8LS0g4LmD4LiK4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyQW5zd2VyR3JpZChjdXJyZW50UHJvamVjdERhdGEuc3R1ZGVudHMsIGNvbXBsZXRlZFN1Ym1pc3Npb25zLCBxdWl6RGF0YSk7IC8vIDwtLSDguYPguIrguYnguYDguInguJ7guLLguLDguJfguLXguYjguJfguLPguYDguKrguKPguYfguIgKICAgICAgICAgICAgICAgICAgICByZW5kZXJBbmFseXRpY3MocXVpekRhdGEsIGNvbXBsZXRlZFN1Ym1pc3Npb25zKTsgLy8gPC0tIOC5g+C4iuC5ieC5gOC4ieC4nuC4suC4sOC4l+C4teC5iOC4l+C4s+C5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgICAgIHJlbmRlclF1aXpSZXN1bHRzVGFibGUoY3VycmVudFByb2plY3REYXRhLnN0dWRlbnRzLCBhbGxTdWJtaXNzaW9ucywgcXVpekRhdGEpOyAvLyA8LS0g4LmD4LiK4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIOC5gOC4nuC4t+C5iOC4reC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC5hOC4lOC5ieC4hOC4o+C4muC4l+C4uOC4geC4hOC4mQogICAgICAgICAgICAgICAgICAgIHJlbmRlclF1aXpMZWFkZXJib2FyZChjb21wbGV0ZWRTdWJtaXNzaW9ucywgcXVpekRhdGEsICdxdWl6LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsgLy8gPC0tIOC5g+C4iuC5ieC5gOC4ieC4nuC4suC4sOC4l+C4teC5iOC4l+C4s+C5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gNS4g4LmB4Liq4LiU4LiHIFZpZXcKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdxdWl6LXJlc3VsdHMnKTsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBzaG93aW5nIHF1aXogZGV0YWlsIHZpZXc6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5geC4quC4lOC4h+C4o+C4suC4ouC4peC4sOC5gOC4reC4teC4ouC4lOC5geC4muC4muC4l+C4lOC4quC4reC4miIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoJCQpmdW5jdGlvbiByZW5kZXJBbnN3ZXJHcmlkKHN0dWRlbnRzLCBzdWJtaXNzaW9ucywgcXVpekRhdGEpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbnN3ZXItZ3JpZC1jb250YWluZXInKTsKICAgIGlmICghY29udGFpbmVyKSByZXR1cm47CgogICAgaWYgKCFzdHVkZW50cyB8fCBzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJwLTQgdGV4dC1jZW50ZXIgdGV4dC1ncmF5LTUwMCI+4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmA4Lie4Li34LmI4Lit4LiZ4Liz4Lih4Liy4Liq4Lij4LmJ4Liy4LiH4LiV4Liy4Lij4Liy4LiHPC9wPic7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHF1ZXN0aW9ucyA9IHF1aXpEYXRhLnF1ZXN0aW9uczsKICAgIGNvbnN0IHN1Ym1pc3Npb25zQnlTdHVkZW50ID0gc3VibWlzc2lvbnMucmVkdWNlKChhY2MsIHN1YikgPT4gewogICAgICAgIGFjY1tzdWIuc3R1ZGVudE5hbWVdID0gc3ViOwogICAgICAgIHJldHVybiBhY2M7CiAgICB9LCB7fSk7CgogICAgY29uc3QgdG9DaGFyID0gKGluZGV4KSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKDY1ICsgaW5kZXgpOwoKICAgIGNvbnN0IGdldENvcnJlY3RBbnN3ZXJUZXh0ID0gKHEpID0+IHsKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICAgICAgcmV0dXJuIHEub3B0aW9ucyAmJiBxLm9wdGlvbnMubGVuZ3RoID4gcS5jb3JyZWN0QW5zd2VySW5kZXggPyB0b0NoYXIocS5jb3JyZWN0QW5zd2VySW5kZXgpIDogJy0nOwogICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RCb29sID0gKHEuY29ycmVjdEFuc3dlciA9PT0gdHJ1ZSB8fCBTdHJpbmcocS5jb3JyZWN0QW5zd2VyKS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZScpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvcnJlY3RCb29sID8gJ+C5g+C4iuC5iCcgOiAn4LmE4Lih4LmI4LmD4LiK4LmIJzsKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgICAgICByZXR1cm4gcS5jb3JyZWN0UmVzcG9uc2UgfHwgJy0nOwogICAgICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOgogICAgICAgICAgICAgICAgcmV0dXJuICfguJ7guLTguKHguJ7guYzguJXguK3guJonOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuICctJzsKICAgICAgICB9CiAgICB9OwoKICAgIGNvbnN0IGdldFVzZXJBbnN3ZXJUZXh0ID0gKHEsIGFucykgPT4gewogICAgICAgIGlmIChhbnMuYW5zd2VyID09PSBudWxsIHx8IGFucy5hbnN3ZXIgPT09IHVuZGVmaW5lZCkgcmV0dXJuICctJzsKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBxdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICBzd2l0Y2ggKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxJbmRleCA9IHEub3B0aW9ucy5maW5kSW5kZXgob3B0ID0+IG9wdCA9PT0gYW5zLmFuc3dlclRleHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsSW5kZXggIT09IC0xID8gdG9DaGFyKG9yaWdpbmFsSW5kZXgpIDogKGFucy5hbnN3ZXJUZXh0IHx8ICctJyk7CiAgICAgICAgICAgIGNhc2UgJ3RydWVfZmFsc2UnOgogICAgICAgICAgICAgICAgaWYgKGFucy5hbnN3ZXIgPT0gJzAnIHx8IGFucy5hbnN3ZXIgPT09IHRydWUgfHwgYW5zLmFuc3dlciA9PT0gJ3RydWUnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICfguYPguIrguYgnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuICfguYTguKHguYjguYPguIrguYgnOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGFucy5hbnN3ZXI7CiAgICAgICAgfQogICAgfTsKCiAgICBsZXQgdGFibGVIdG1sID0gYAogICAgICAgIDx0YWJsZSBjbGFzcz0ibWluLXctZnVsbCBiZy13aGl0ZSB0ZXh0LXNtIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgPHRoZWFkIGNsYXNzPSJiZy1ncmF5LTEwMCI+CiAgICAgICAgICAgICAgICA8dHI+CiAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTIgYm9yZGVyLWIgYm9yZGVyLXIgZm9udC1zZW1pYm9sZCB0ZXh0LWxlZnQgc3RpY2t5IGxlZnQtMCBiZy1ncmF5LTEwMCB6LTEwIj7guIrguLfguYjguK0gLSDguKrguIHguLjguKU8L3RoPgogICAgICAgICAgICAgICAgICAgICR7cXVlc3Rpb25zLm1hcCgocSwgaSkgPT4gYDx0aCBjbGFzcz0icHktMiBweC0yIGJvcmRlci1iIj4ke2kgKyAxfTwvdGg+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJiZy1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgYm9yZGVyLXIgdGV4dC1sZWZ0IHN0aWNreSBsZWZ0LTAgYmctZ3JheS0yMDAgei0xMCI+4LmA4LiJ4Lil4LiiPC90aD4KICAgICAgICAgICAgICAgICAgICAke3F1ZXN0aW9ucy5tYXAocSA9PiBgPHRkIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgZm9udC1ib2xkIHRleHQtYmx1ZS03MDAiPiR7Z2V0Q29ycmVjdEFuc3dlclRleHQocSl9PC90ZD5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgIDwvdGhlYWQ+CiAgICAgICAgICAgIDx0Ym9keT4KICAgIGA7CgogICAgc3R1ZGVudHMuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICB0YWJsZUh0bWwgKz0gJzx0cj4nOwogICAgICAgIHRhYmxlSHRtbCArPSBgPHRkIGNsYXNzPSJweS0yIHB4LTIgYm9yZGVyLWIgYm9yZGVyLXIgdGV4dC1sZWZ0IHN0aWNreSBsZWZ0LTAgYmctd2hpdGUgei0xMCI+JHtuYW1lfTwvdGQ+YDsKICAgICAgICAKICAgICAgICBjb25zdCBzdWJtaXNzaW9uID0gc3VibWlzc2lvbnNCeVN0dWRlbnRbbmFtZV07CiAgICAgICAgaWYgKHN1Ym1pc3Npb24pIHsKICAgICAgICAgICAgY29uc3QgbGF0ZXN0QXR0ZW1wdCA9IHN1Ym1pc3Npb24uYXR0ZW1wdHNbc3VibWlzc2lvbi5hdHRlbXB0cy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcXVlc3Rpb25zLmZvckVhY2goKHEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBhbnN3ZXIgPSBsYXRlc3RBdHRlbXB0LmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLnF1ZXN0aW9uSWQgPT09IHEuaWQpOwoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgY2VsbENsYXNzZXMgPSAnJzsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBhbnN3ZXIuaXNDb3JyZWN0ID09PSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29uZmlkZW50ID0gKGFuc3dlci53YXNDb25maWRlbnQgPT09IHRydWUgfHwgYW5zd2VyLndhc0NvbmZpZGVudCA9PT0gJ2NvbmZpZGVudCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gYW5zd2VyLnBvd2VydXBVc2VkOwoKICAgICAgICAgICAgICAgICAgICBpZiAocG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4quC4teC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lOC5gOC4lOC4tOC4oeC4nuC4seC4mSAo4Lib4Lij4Lix4Lia4LmB4LiB4LmJOiDguYDguK3guLIgYm9yZGVyIOC4reC4reC4gSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbENsYXNzZXMgPSAnYmcteWVsbG93LTMwMCB0ZXh0LXllbGxvdy05MDAgZm9udC1ib2xkJzsgLy8g4LmA4Lir4Lil4Li34Lit4LmB4LiE4LmI4Liq4Li14Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmB4Lil4Liw4LiV4Lix4Lin4Lit4Lix4LiB4Lip4LijCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZWxsQ2xhc3NlcyA9ICdiZy1yZWQtNzAwIHRleHQtd2hpdGUgZm9udC1ib2xkJzsgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29uZmlkZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGxDbGFzc2VzID0gaXNDb3JyZWN0ID8gJ2JnLWdyZWVuLTQwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCcgOiAnYmctcmVkLTUwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCc7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2VsbENsYXNzZXMgPSBpc0NvcnJlY3QgPyAnYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1yZWQtMTAwIHRleHQtcmVkLTgwMCc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHRhYmxlSHRtbCArPSBgPHRkIGNsYXNzPSJweS0yIHB4LTIgYm9yZGVyLWIgJHtjZWxsQ2xhc3Nlc30iPiR7Z2V0VXNlckFuc3dlclRleHQocSwgYW5zd2VyKX08L3RkPmA7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0YWJsZUh0bWwgKz0gJzx0ZCBjbGFzcz0icHktMiBweC0yIGJvcmRlci1iIGJnLWdyYXktNTAiPi08L3RkPic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhYmxlSHRtbCArPSBxdWVzdGlvbnMubWFwKCgpID0+ICc8dGQgY2xhc3M9InB5LTIgcHgtMiBib3JkZXItYiBiZy1ncmF5LTUwIHRleHQtZ3JheS00MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4quC5iOC4hzwvdGQ+Jykuam9pbignJyk7CiAgICAgICAgfQogICAgICAgIHRhYmxlSHRtbCArPSAnPC90cj4nOwogICAgfSk7CgogICAgdGFibGVIdG1sICs9ICc8L3Rib2R5PjwvdGFibGU+JzsKICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSB0YWJsZUh0bWw7Cn0KCmZ1bmN0aW9uIHJlbmRlclF1aXpSZXN1bHRzVGFibGUoc3R1ZGVudHMsIHN1Ym1pc3Npb25zLCBxdWl6RGF0YSkgewogICAgY29uc3Qgc3VibWlzc2lvbnNCeVN0dWRlbnQgPSBzdWJtaXNzaW9ucy5yZWR1Y2UoKGFjYywgc3ViKSA9PiB7CiAgICAgICAgYWNjW3N1Yi5zdHVkZW50TmFtZV0gPSBzdWI7CiAgICAgICAgcmV0dXJuIGFjYzsKICAgIH0sIHt9KTsKCiAgICAvLyAtLS0gW+C5geC4geC5ieC5hOC4gl0gMS4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihIChXZWlnaHRlZCBNYXggU2NvcmUpIC0tLQogICAgbGV0IHRvdGFsTWF4U2NvcmUgPSAwOwogICAgY29uc3QgdHlwZVNjb3JpbmcgPSBxdWl6RGF0YS5zZXR0aW5ncz8udHlwZVNjb3JpbmcgfHwgeyBtY3E6IDEsIHNhOiAxLCB0ZjogMSB9OwogICAgaWYgKHF1aXpEYXRhLnF1ZXN0aW9ucyAmJiBxdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgIHF1aXpEYXRhLnF1ZXN0aW9ucy5mb3JFYWNoKHEgPT4gewogICAgICAgICAgICBjb25zdCBxVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IHF1aXpEYXRhLnF1aXpUeXBlOwogICAgICAgICAgICBsZXQgd2VpZ2h0ID0gMTsKICAgICAgICAgICAgaWYgKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3Jpbmcuc2EpIHx8IDE7CiAgICAgICAgICAgIGVsc2UgaWYgKHFUeXBlID09PSAndHJ1ZV9mYWxzZScpIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3JpbmcudGYpIHx8IDE7CiAgICAgICAgICAgIGVsc2Ugd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy5tY3EpIHx8IDE7CiAgICAgICAgICAgIHRvdGFsTWF4U2NvcmUgKz0gd2VpZ2h0OwogICAgICAgIH0pOwogICAgfSBlbHNlIHsgdG90YWxNYXhTY29yZSA9IDE7IH0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAvLyAxLiDguJvguLjguYjguKHguKXguJrguKvguKHguLnguYgKICAgIGNvbnN0IGV4cG9ydENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzY29yZXMtdGFiLWNvbnRlbnQgLm1iLTQuZmxleCcpOwogICAgaWYgKGV4cG9ydENvbnRhaW5lciAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstZGVsZXRlLXN1Ym1pc3Npb25zLWJ0bicpKSB7CiAgICAgICAgY29uc3QgYnVsa0RlbGV0ZUJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIGJ1bGtEZWxldGVCdG4uaWQgPSAnYnVsay1kZWxldGUtc3VibWlzc2lvbnMtYnRuJzsKICAgICAgICBidWxrRGVsZXRlQnRuLmNsYXNzTmFtZSA9ICdoaWRkZW4gYmctcmVkLTYwMCB0ZXh0LXdoaXRlIHB5LTEgcHgtMyByb3VuZGVkLW1kIGhvdmVyOmJnLXJlZC03MDAgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBtbC1hdXRvIHRyYW5zaXRpb24tYWxsJzsKICAgICAgICBidWxrRGVsZXRlQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCI+PC9pPiDguKXguJrguKPguLLguKLguIHguLLguKPguJfguLXguYjguYDguKXguLfguK3guIEgKDxzcGFuIGlkPSJzZWxlY3RlZC1jb3VudCI+MDwvc3Bhbj4pJzsKICAgICAgICBleHBvcnRDb250YWluZXIuYXBwZW5kQ2hpbGQoYnVsa0RlbGV0ZUJ0bik7CiAgICAgICAgYnVsa0RlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUJ1bGtEZWxldGVTdWJtaXNzaW9ucyk7CiAgICB9CgogICAgLy8gMi4g4Lir4Lix4Lin4LiV4Liy4Lij4Liy4LiHCiAgICBjb25zdCB0YWJsZUhlYWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmVzdWx0cy10YWJsZSB0aGVhZCB0cicpOwogICAgaWYgKHRhYmxlSGVhZCkgewogICAgICAgIHRhYmxlSGVhZC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIHctMTAiPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0ic2VsZWN0LWFsbC1zdWJtaXNzaW9ucyIgY2xhc3M9ImgtNCB3LTQgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgIDwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guITguLDguYHguJnguJnguJTguLXguJfguLXguYjguKrguLjguJQ8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC4nOC4pTwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4Lib4Lij4Liw4LmA4Lig4LiXPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guITguLDguYHguJnguJnguITguKPguLHguYnguIfguYHguKPguIE8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC4hOC4sOC5geC4meC4meC4peC5iOC4suC4quC4uOC4lDwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+UG9pbnRzPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guKrguJbguLLguJnguLA8L3RoPgogICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQiPuC5gOC4p+C4peC4suC4l+C4teC5iOC4quC5iOC4h+C4peC5iOC4suC4quC4uOC4lDwvdGg+CiAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4LiI4Lix4LiU4LiB4Liy4LijPC90aD4KICAgICAgICBgOwogICAgfQoKICAgIGNvbnN0IHRhYmxlQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXJlc3VsdHMtdGFibGUtYm9keScpOwogICAgaWYgKCFzdHVkZW50cyB8fCBzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICB0YWJsZUJvZHkuaW5uZXJIVE1MID0gJzx0cj48dGQgY29sc3Bhbj0iMTEiIGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTQgdGV4dC1ncmF5LTUwMCI+4LmE4Lih4LmI4Lih4Li14Lij4Liy4Lii4LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmD4LiZ4LmC4Lib4Lij4LmA4LiI4LiE4LiZ4Li14LmJPC90ZD48L3RyPic7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgCiAgICBjb25zdCBpc1JlbWVkaWFsUXVpeiA9IHF1aXpEYXRhLmlzUmVtZWRpYWwgPT09IHRydWU7CiAgICBjb25zdCBwYXNzaW5nU2NvcmUgPSBxdWl6RGF0YS5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IC0xOyAKCiAgICBsZXQgaHRtbCA9ICcnOwogICAgc3R1ZGVudHMuZm9yRWFjaChzdHVkZW50TmFtZSA9PiB7CiAgICAgICAgY29uc3Qgc3VibWlzc2lvbiA9IHN1Ym1pc3Npb25zQnlTdHVkZW50W3N0dWRlbnROYW1lXTsKICAgICAgICBsZXQgcXVpelR5cGVIdG1sID0gYDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj48c3BhbiBjbGFzcz0idGV4dC14cyBmb250LW1lZGl1bSBweC0yLjUgcHktMC41IHJvdW5kZWQtZnVsbCAke2lzUmVtZWRpYWxRdWl6ID8gJ2JnLWFtYmVyLTEwMCB0ZXh0LWFtYmVyLTgwMCcgOiAnYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTgwMCd9Ij4ke2lzUmVtZWRpYWxRdWl6ID8gJ+C4quC4reC4muC4i+C5iOC4reC4oScgOiAn4Liq4Lit4Lia4Lib4LiB4LiV4Li0J308L3NwYW4+PC90ZD5gOwogICAgICAgIAogICAgICAgIGxldCBjaGVja2JveEh0bWwgPSAnJzsKICAgICAgICBpZiAoc3VibWlzc2lvbikgewogICAgICAgICAgICBjaGVja2JveEh0bWwgPSBgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjbGFzcz0ic3VibWlzc2lvbi1jaGVja2JveCBoLTQgdy00IHJvdW5kZWQgYm9yZGVyLWdyYXktMzAwIHRleHQtaW5kaWdvLTYwMCBmb2N1czpyaW5nLWluZGlnby01MDAgY3Vyc29yLXBvaW50ZXIiIHZhbHVlPSIke3N0dWRlbnROYW1lfSI+YDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgY2hlY2tib3hIdG1sID0gYDxpbnB1dCB0eXBlPSJjaGVja2JveCIgZGlzYWJsZWQgY2xhc3M9ImgtNCB3LTQgcm91bmRlZCBib3JkZXItZ3JheS0yMDAgdGV4dC1ncmF5LTMwMCBjdXJzb3Itbm90LWFsbG93ZWQiPmA7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3VibWlzc2lvbikgewogICAgICAgICAgICBpZiAoc3VibWlzc2lvbi5hdHRlbXB0cyAmJiBzdWJtaXNzaW9uLmF0dGVtcHRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGxldCBpc1Bhc3MgPSBpc1JlbWVkaWFsUXVpeiA/IChzdWJtaXNzaW9uLmJlc3RTY29yZSA9PT0gdG90YWxNYXhTY29yZSkgOiAocGFzc2luZ1Njb3JlICE9PSAtMSAmJiBzdWJtaXNzaW9uLmJlc3RTY29yZSA+PSBwYXNzaW5nU2NvcmUpOwogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0Q2xhc3MgPSBpc1Bhc3MgPyAnYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1yZWQtMTAwIHRleHQtcmVkLTgwMCc7CiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gaXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJzsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdEh0bWwgPSBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPjxzcGFuIGNsYXNzPSJ0ZXh0LXhzIGZvbnQtbWVkaXVtIG1yLTIgcHgtMi41IHB5LTAuNSByb3VuZGVkLWZ1bGwgJHtyZXN1bHRDbGFzc30iPiR7cmVzdWx0VGV4dH08L3NwYW4+PC90ZD5gOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzQ2VsbCA9IGA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+PHNwYW4gY2xhc3M9ImJnLWJsdWUtMTAwIHRleHQtYmx1ZS04MDAgdGV4dC14cyBmb250LW1lZGl1bSBtci0yIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsIj7guKrguYjguIfguYHguKXguYnguKcgKCR7c3VibWlzc2lvbi5hdHRlbXB0cz8ubGVuZ3RoIHx8IDF9IOC4hOC4o+C4seC5ieC4hyk8L3NwYW4+PC90ZD5gOwoKICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50c0h0bWwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWJsdWUtNjAwIj4keyhzdWJtaXNzaW9uLnBvaW50cyB8fCAwKS50b0xvY2FsZVN0cmluZygpfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZWRpdC1wb2ludHMtYnRuIHRleHQtZ3JheS00MDAgaG92ZXI6dGV4dC1vcmFuZ2UtNTAwIHRyYW5zaXRpb24tY29sb3JzIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXN0dWRlbnQtbmFtZT0iJHtzdHVkZW50TmFtZX0iIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtY3VycmVudC1wb2ludHM9IiR7c3VibWlzc2lvbi5wb2ludHMgfHwgMH0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU9IuC5geC4geC5ieC5hOC4giBQb2ludHMg4LiU4LmJ4Lin4Lii4Lih4Li34LitIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtcGVuIHRleHQteHMiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwoKICAgICAgICAgICAgICAgIC8vIC0tLSBb4LmB4LiB4LmJ4LmE4LiCXSDguYPguIrguYkgdG90YWxNYXhTY29yZSDguYHguJfguJkgc3VibWlzc2lvbi50b3RhbFF1ZXN0aW9ucyAtLS0KICAgICAgICAgICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iaG92ZXI6YmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIj4ke2NoZWNrYm94SHRtbH08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+JHtzdHVkZW50TmFtZX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWdyZWVuLTYwMCBmb250LWJvbGQiPiR7c3VibWlzc2lvbi5iZXN0U2NvcmV9IC8gJHt0b3RhbE1heFNjb3JlfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICR7cmVzdWx0SHRtbH0KICAgICAgICAgICAgICAgICAgICAgICAgJHtxdWl6VHlwZUh0bWx9CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIGZvbnQtc2VtaWJvbGQiPiR7c3VibWlzc2lvbi5maXJzdFNjb3JlfSAvICR7dG90YWxNYXhTY29yZX08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiBmb250LXNlbWlib2xkIj4ke3N1Ym1pc3Npb24ubGF0ZXN0U2NvcmV9IC8gJHt0b3RhbE1heFNjb3JlfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke3BvaW50c0h0bWx9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNDZWxsfQogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LXNtIHRleHQtZ3JheS02MDAiPiR7bmV3IERhdGUoc3VibWlzc2lvbi5sYXRlc3RTdWJtaXR0ZWRBdCkudG9Mb2NhbGVTdHJpbmcoJ3RoLVRIJyl9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBkYXRhLXN0dWRlbnQtbmFtZT0iJHtzdHVkZW50TmFtZX0iIGNsYXNzPSJkZWxldGUtc3VibWlzc2lvbi1idG4gdGV4dC1yZWQtNTAwIGhvdmVyOnRleHQtcmVkLTcwMCB0ZXh0LWxnIHAtMSIgdGl0bGU9IuC4peC4muC4nOC4peC4quC4reC4muC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4hOC4meC4meC4teC5iSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaC1hbHQgcG9pbnRlci1ldmVudHMtbm9uZSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPC90cj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDguIHguKPguJPguLXguYDguKPguLTguYjguKHguJfguLPguYHguJXguYjguYTguKHguYjguYDguKrguKPguYfguIgKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1c0NlbGwgPSBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPjxzcGFuIGNsYXNzPSJiZy1vcmFuZ2UtMTAwIHRleHQtb3JhbmdlLTgwMCB0ZXh0LXhzIGZvbnQtbWVkaXVtIG1yLTIgcHgtMi41IHB5LTAuNSByb3VuZGVkLWZ1bGwiPuC5gOC4o+C4tOC5iOC4oeC5geC4peC5ieC4pyAo4Lii4Lix4LiH4LmE4Lih4LmI4Liq4LmI4LiHKTwvc3Bhbj48L3RkPmA7CiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9ImhvdmVyOmJnLWdyYXktNTAgYmctb3JhbmdlLTUwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7Y2hlY2tib3hIdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke3N0dWRlbnROYW1lfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4gPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPgogICAgICAgICAgICAgICAgICAgICAgICAke3F1aXpUeXBlSHRtbH0KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPiA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+IDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtzdGF0dXNDZWxsfQogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LXNtIHRleHQtZ3JheS02MDAiPiR7bmV3IERhdGUoc3VibWlzc2lvbi5zdGFydGVkQXQpLnRvTG9jYWxlU3RyaW5nKCd0aC1USCcpfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGRhdGEtc3R1ZGVudC1uYW1lPSIke3N0dWRlbnROYW1lfSIgY2xhc3M9ImRlbGV0ZS1zdWJtaXNzaW9uLWJ0biB0ZXh0LXJlZC01MDAgaG92ZXI6dGV4dC1yZWQtNzAwIHRleHQtbGcgcC0xIiB0aXRsZT0i4Lil4Lia4Lic4Lil4Liq4Lit4Lia4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiE4LiZ4LiZ4Li14LmJIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRyYXNoLWFsdCBwb2ludGVyLWV2ZW50cy1ub25lIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4KICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOC4geC4o+C4k+C4teC4l+C4teC5iOC4ouC4seC4h+C5hOC4oeC5iOC5gOC4o+C4tOC5iOC4oeC4l+C4swogICAgICAgICAgICBjb25zdCBzdGF0dXNDZWxsID0gYDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj48c3BhbiBjbGFzcz0iYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy04MDAgdGV4dC14cyBmb250LW1lZGl1bSBtci0yIHB4LTIuNSBweS0wLjUgcm91bmRlZC1mdWxsIj7guKLguLHguIfguYTguKHguYjguKrguYjguIc8L3NwYW4+PC90ZD5gOwogICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0iaG92ZXI6YmctZ3JheS01MCI+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7Y2hlY2tib3hIdG1sfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPiR7c3R1ZGVudE5hbWV9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+IDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4KICAgICAgICAgICAgICAgICAgICAke3F1aXpUeXBlSHRtbH0KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+IDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4tPC90ZD4gPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPi08L3RkPgogICAgICAgICAgICAgICAgICAgICR7c3RhdHVzQ2VsbH0KICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+LTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPjwvdGQ+CiAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICBgOwogICAgICAgIH0KICAgIH0pOwogICAgdGFibGVCb2R5LmlubmVySFRNTCA9IGh0bWw7CgogICAgLy8gQ2hlY2tib3ggTG9naWMKICAgIGNvbnN0IHNlbGVjdEFsbENiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1hbGwtc3VibWlzc2lvbnMnKTsKICAgIGNvbnN0IHJvd0NicyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJtaXNzaW9uLWNoZWNrYm94Jyk7CiAgICBjb25zdCBidWxrQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstZGVsZXRlLXN1Ym1pc3Npb25zLWJ0bicpOwogICAgY29uc3QgY291bnRTcGFuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGVkLWNvdW50Jyk7CgogICAgY29uc3QgdXBkYXRlQnVsa0J0blN0YXRlID0gKCkgPT4gewogICAgICAgIGNvbnN0IGNoZWNrZWRDb3VudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJtaXNzaW9uLWNoZWNrYm94OmNoZWNrZWQnKS5sZW5ndGg7CiAgICAgICAgaWYgKGNvdW50U3BhbikgY291bnRTcGFuLnRleHRDb250ZW50ID0gY2hlY2tlZENvdW50OwogICAgICAgIGlmIChjaGVja2VkQ291bnQgPiAwKSB7CiAgICAgICAgICAgIGJ1bGtCdG4uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVsa0J0bi5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9OwoKICAgIGlmIChzZWxlY3RBbGxDYikgewogICAgICAgIHNlbGVjdEFsbENiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKSA9PiB7CiAgICAgICAgICAgIHJvd0Nicy5mb3JFYWNoKGNiID0+IGNiLmNoZWNrZWQgPSBlLnRhcmdldC5jaGVja2VkKTsKICAgICAgICAgICAgdXBkYXRlQnVsa0J0blN0YXRlKCk7CiAgICAgICAgfSk7CiAgICB9CgogICAgcm93Q2JzLmZvckVhY2goY2IgPT4gewogICAgICAgIGNiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgICAgICAgICAgaWYgKCFjYi5jaGVja2VkICYmIHNlbGVjdEFsbENiKSBzZWxlY3RBbGxDYi5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChjYi5jaGVja2VkICYmIHNlbGVjdEFsbENiKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhbGxDaGVja2VkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnN1Ym1pc3Npb24tY2hlY2tib3g6Y2hlY2tlZCcpLmxlbmd0aCA9PT0gcm93Q2JzLmxlbmd0aDsKICAgICAgICAgICAgICAgIGlmIChhbGxDaGVja2VkKSBzZWxlY3RBbGxDYi5jaGVja2VkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB1cGRhdGVCdWxrQnRuU3RhdGUoKTsKICAgICAgICB9KTsKICAgIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVCdWxrRGVsZXRlU3VibWlzc2lvbnMoKSB7CiAgICBjb25zdCBzZWxlY3RlZENoZWNrYm94ZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc3VibWlzc2lvbi1jaGVja2JveDpjaGVja2VkJyk7CiAgICBjb25zdCBzZWxlY3RlZE5hbWVzID0gQXJyYXkuZnJvbShzZWxlY3RlZENoZWNrYm94ZXMpLm1hcChjYiA9PiBjYi52YWx1ZSk7CgogICAgaWYgKHNlbGVjdGVkTmFtZXMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgaWYgKCFjdXJyZW50UXVpekRhdGEgfHwgIWN1cnJlbnRRdWl6RGF0YS5pZCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJrguYTguKHguYjguJbguLnguIHguJXguYnguK3guIciKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgc2hvd0NvbmZpcm1hdGlvbigKICAgICAgICBg4LiE4Li44LiT4LmB4LiZ4LmI4LmD4LiI4Lir4Lij4Li34Lit4LmE4Lih4LmI4Lin4LmI4Liy4LiV4LmJ4Lit4LiH4LiB4Liy4Lij4Lil4Lia4Lic4Lil4LiB4Liy4Lij4Liq4Lit4Lia4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZICR7c2VsZWN0ZWROYW1lcy5sZW5ndGh9IOC4hOC4meC4l+C4teC5iOC5gOC4peC4t+C4reC4gT8g4LiB4Liy4Lij4LiB4Lij4Liw4LiX4Liz4LiZ4Li14LmJ4LmE4Lih4LmI4Liq4Liy4Lih4Liy4Lij4LiW4Lii4LmJ4Lit4LiZ4LiB4Lil4Lix4Lia4LmE4LiU4LmJYCwKICAgICAgICBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHF1aXpJZCA9IGN1cnJlbnRRdWl6RGF0YS5pZDsKICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKCiAgICAgICAgICAgIHNlbGVjdGVkTmFtZXMuZm9yRWFjaChzdHVkZW50TmFtZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAgICAgYmF0Y2guZGVsZXRlKHN1Ym1pc3Npb25SZWYpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCBiYXRjaC5jb21taXQoKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguKXguJrguJzguKXguIHguLLguKPguKrguK3guJogJHtzZWxlY3RlZE5hbWVzLmxlbmd0aH0g4Lij4Liy4Lii4LiB4Liy4Lij4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinYCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIOC4i+C5iOC4reC4meC4m+C4uOC5iOC4oeC4q+C4peC4seC4h+C4iOC4suC4geC4peC4muC5gOC4quC4o+C5h+C4iAogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1bGstZGVsZXRlLXN1Ym1pc3Npb25zLWJ0bicpLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgLy8g4LmA4LiE4Lil4Li14Lii4Lij4LmMIENoZWNrYm94IOC4q+C4seC4p+C4leC4suC4o+C4suC4hwogICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0QWxsSGVhZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdC1hbGwtc3VibWlzc2lvbnMnKTsKICAgICAgICAgICAgICAgIGlmKHNlbGVjdEFsbEhlYWRlcikgc2VsZWN0QWxsSGVhZGVyLmNoZWNrZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICAvLyBvblNuYXBzaG90IOC4iOC4sOC4l+C4s+C4h+C4suC4meC5geC4peC4sOC4o+C4teC5gOC4n+C4o+C4iuC4leC4suC4o+C4suC4h+C5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tAogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgYnVsayBkZWxldGluZyBzdWJtaXNzaW9uczoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4Lia4LiC4LmJ4Lit4Lih4Li54LilIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICApOwp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1SZW5hbWVRdWl6KCkgewogICAgICAgICAgICBjb25zdCBuZXdOYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbmFtZS1xdWl6LWlucHV0JykudmFsdWUudHJpbSgpOwogICAgICAgICAgICBpZiAoIW5ld05hbWUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYPguKrguYjguIrguLfguYjguK3guYPguKvguKHguYgiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWFjdGlvblRhcmdldElkKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBhY3Rpb25UYXJnZXRJZCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocXVpelJlZiwgeyB0b3BpYzogbmV3TmFtZSB9KTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguJvguKXguLXguYjguKLguJnguIrguLfguYjguK3guYHguJrguJrguJfguJTguKrguK3guJrguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIHJlbmFtZVF1aXpNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgICAgIGFjdGlvblRhcmdldElkID0gbnVsbDsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHJlbmFtaW5nIHF1aXo6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC4iuC4t+C5iOC4rSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZU1vdmVRdWl6KHF1aXpJZCkgIHsgLyogUmVtb3ZlZCAqLyB9IAoKICAgICAgICBhc3luYyBmdW5jdGlvbiBjb25maXJtTW92ZVF1aXooKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld1Byb2plY3RJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3ZlLXF1aXotcHJvamVjdC1zZWxlY3QnKS52YWx1ZTsKICAgICAgICAgICAgaWYgKCFuZXdQcm9qZWN0SWQpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguYDguKXguLfguK3guIHguYLguJvguKPguYDguIjguITguJvguKXguLLguKLguJfguLLguIciKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWFjdGlvblRhcmdldElkKSByZXR1cm47CgogICAgICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBhY3Rpb25UYXJnZXRJZCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2MocXVpelJlZiwgeyBwcm9qZWN0SWQ6IG5ld1Byb2plY3RJZCB9KTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKLguYnguLLguKLguYHguJrguJrguJfguJTguKrguK3guJrguKrguLPguYDguKPguYfguIgiKTsKICAgICAgICAgICAgICAgIG1vdmVRdWl6TW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBhY3Rpb25UYXJnZXRJZCA9IG51bGw7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBtb3ZpbmcgcXVpejoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lii4LmJ4Liy4Lii4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVRdWl6U2V0dGluZ3MocXVpeklkKSAgeyAvKiBSZW1vdmVkICovIH0gCgpmdW5jdGlvbiB0b2dnbGVUaW1lcklucHV0SW5Nb2RhbCgpIHsKICAgIGNvbnN0IG1vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItbW9kZS1zZWxlY3QnKS52YWx1ZTsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC10aW1lci1kdXJhdGlvbi1jb250YWluZXInKTsKICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXRpbWVyLWR1cmF0aW9uLWxhYmVsJyk7CiAgICAKICAgIGlmIChtb2RlID09PSAnbm9uZScpIHsKICAgICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9IGVsc2UgewogICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICBpZiAobW9kZSA9PT0gJ3dob2xlX3F1aXonKSB7CiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ+C4o+C4sOC4ouC4sOC5gOC4p+C4peC4siAo4LiZ4Liy4LiX4Li1KTonOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxhYmVsLnRleHRDb250ZW50ID0gJ+C4o+C4sOC4ouC4sOC5gOC4p+C4peC4siAo4Lin4Li04LiZ4Liy4LiX4Li1KTonOwogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gdG9nZ2xlQ29uZmlkZW5jZU9wdGlvbnNJbk1vZGFsKCkgewogICAgY29uc3QgaXNDaGVja2VkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWNvbmZpZGVuY2Utc2NvcmluZy1jaGVja2JveCcpLmNoZWNrZWQ7CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtY29uZmlkZW5jZS1tb2RlLWNvbnRhaW5lcicpOwogICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgIGlmIChpc0NoZWNrZWQpIHsKICAgICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1RdWl6U2V0dGluZ3MoKSB7CiAgICBpZiAoIWFjdGlvblRhcmdldElkKSByZXR1cm47CiAgICAKICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGFjdGlvblRhcmdldElkKTsKICAgIAogICAgY29uc3QgbmV3U2V0dGluZ3MgPSB7CiAgICAgICAgc2h1ZmZsZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXNodWZmbGUtc2VsZWN0JykudmFsdWUsCiAgICAgICAgcmVzdWx0c0Rpc3BsYXk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1yZXN1bHRzLWRpc3BsYXktc2VsZWN0JykudmFsdWUsCiAgICAgICAgdGltZXJNb2RlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItbW9kZS1zZWxlY3QnKS52YWx1ZSwKICAgICAgICB0aW1lckR1cmF0aW9uOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtdGltZXItZHVyYXRpb24taW5wdXQnKS52YWx1ZSkgfHwgMTAsCiAgICAgICAgcGFzc2luZ1Njb3JlOiBwYXJzZUludChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtcGFzc2luZy1zY29yZS1pbnB1dCcpLnZhbHVlKSB8fCAwLAogICAgICAgIGlzQWRhcHRpdmU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1hZGFwdGl2ZS1xdWl6LWNoZWNrYm94JykuY2hlY2tlZCwKCQllbmFibGVSZW1lZGlhbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWVuYWJsZS1yZW1lZGlhbC1jaGVja2JveCcpLmNoZWNrZWQsCgkJcmVtZWRpYWxMb2dpYzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLXJlbWVkaWFsLWxvZ2ljLXNlbGVjdCcpLnZhbHVlLAogICAgICAgIGxvb3BVbnRpbFBhc3M6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1sb29wLXVudGlsLXBhc3MtY2hlY2tib3gnKS5jaGVja2VkLAogICAgICAgIGlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW9kYWwtY29uZmlkZW5jZS1zY29yaW5nLWNoZWNrYm94JykuY2hlY2tlZCwKICAgICAgICBjb25maWRlbmNlTW9kZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGFsLWNvbmZpZGVuY2UtbW9kZS1zZWxlY3QnKS52YWx1ZSwKCiAgICAgICAgLy8g4pa84pa84pa8IFvguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKHguYPguKvguKHguYg6IOC4muC4seC4meC4l+C4tuC4geC4hOC4sOC5geC4meC4meC4o+C4suC4ouC4m+C4o+C4sOC5gOC4oOC4l10g4pa84pa84pa8CiAgICAgICAgdHlwZVNjb3Jpbmc6IHsKICAgICAgICAgICAgbWNxOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS1tY3EnKS52YWx1ZSkgfHwgMSwgLy8g4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBCiAgICAgICAgICAgIHNhOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS1zYScpLnZhbHVlKSB8fCAxLCAgLy8g4LmA4LiV4Li04Lih4LiE4LizCiAgICAgICAgICAgIHRmOiBwYXJzZUZsb2F0KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RhbC1zY29yZS10ZicpLnZhbHVlKSB8fCAxICAgLy8g4LiW4Li54LiB4Lic4Li04LiUCiAgICAgICAgfQoKICAgIH07CgogICAgdHJ5IHsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocXVpelJlZiwgeyBzZXR0aW5nczogbmV3U2V0dGluZ3MgfSk7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4muC4seC4meC4l+C4tuC4geC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4suC4quC4s+C5gOC4o+C5h+C4iCIpOwogICAgICAgIHF1aXpTZXR0aW5nc01vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgIGFjdGlvblRhcmdldElkID0gbnVsbDsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdXBkYXRpbmcgcXVpeiBzZXR0aW5nczoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4muC4seC4meC4l+C4tuC4gSIpOwogICAgfQp9CgogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1RdWl6U3RhdHVzKCkgewogICAgICAgICAgICBpZiAoIWFjdGlvblRhcmdldElkKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IHF1aXpSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvcXVpenplc2AsIGFjdGlvblRhcmdldElkKTsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJzdGF0dXMtb3B0aW9uIl06Y2hlY2tlZCcpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFzZWxlY3RlZE9wdGlvbikgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4quC4luC4suC4meC4sCIpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBzdGF0dXNDaG9pY2UgPSBzZWxlY3RlZE9wdGlvbi52YWx1ZTsKICAgICAgICAgICAgbGV0IGRhdGFUb1VwZGF0ZSA9IHt9OwoKICAgICAgICAgICAgaWYgKHN0YXR1c0Nob2ljZSA9PT0gJ2FjdGl2ZScgfHwgc3RhdHVzQ2hvaWNlID09PSAnaW5hY3RpdmUnKSB7CiAgICAgICAgICAgICAgICBkYXRhVG9VcGRhdGUgPSB7IHN0YXR1czogc3RhdHVzQ2hvaWNlLCBzdGFydFRpbWU6IG51bGwsIGVuZFRpbWU6IG51bGwgfTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXNDaG9pY2UgPT09ICdzY2hlZHVsZScpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LXN0YXJ0LXRpbWUnKS52YWx1ZTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZFRpbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1lbmQtdGltZScpLnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKCFzdGFydFRpbWUgJiYgIWVuZFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4LmA4Lin4Lil4Liy4LmA4Lib4Li04LiUIOC4q+C4o+C4t+C4rSDguYDguKfguKXguLLguJvguLTguJQg4Lit4Lii4LmI4Liy4LiH4LiZ4LmJ4Lit4Lii4Lir4LiZ4Li24LmI4LiH4Lit4Lii4LmI4Liy4LiHIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGF0YVRvVXBkYXRlID0geyAKICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdzY2hlZHVsZWQnLCAKICAgICAgICAgICAgICAgICAgICBzdGFydFRpbWU6IHN0YXJ0VGltZSA/IG5ldyBEYXRlKHN0YXJ0VGltZSkudG9JU09TdHJpbmcoKSA6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgZW5kVGltZTogZW5kVGltZSA/IG5ldyBEYXRlKGVuZFRpbWUpLnRvSVNPU3RyaW5nKCkgOiBudWxsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKHF1aXpSZWYsIGRhdGFUb1VwZGF0ZSk7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4Lit4Lix4Lib4LmA4LiU4LiV4Liq4LiW4Liy4LiZ4Liw4Liq4Liz4LmA4Lij4LmH4LiIIik7CiAgICAgICAgICAgICAgICBxdWl6U3RhdHVzTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBhY3Rpb25UYXJnZXRJZCA9IG51bGw7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgdXBkYXRpbmcgcXVpeiBzdGF0dXM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguK3guLHguJvguYDguJTguJXguKrguJbguLLguJnguLAiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIExlYWRlcmJvYXJkIC0tLQogICAgICAgIGZ1bmN0aW9uIGxpc3RlbkZvclN0dWRlbnRQcm9maWxlcyhwcm9qZWN0SWQpIHsKICAgICAgICAgICAgY29uc3QgcHJvZmlsZXNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzLyR7cHJvamVjdElkfS9zdHVkZW50UHJvZmlsZXNgKTsKICAgICAgICAgICAgdW5zdWJzY3JpYmVTdHVkZW50UHJvZmlsZXNMaXN0ZW5lciA9IG9uU25hcHNob3QocHJvZmlsZXNSZWYsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcHJvZmlsZXMgPSBzbmFwc2hvdC5kb2NzLm1hcChkb2MgPT4gZG9jLmRhdGEoKSk7CiAgICAgICAgICAgICAgICByZW5kZXJMZWFkZXJib2FyZChwcm9maWxlcywgJ2xlYWRlcmJvYXJkLXRhYmxlLWJvZHknKTsKICAgICAgICAgICAgfSwgKGVycm9yKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBsaXN0ZW5pbmcgZm9yIHN0dWRlbnQgcHJvZmlsZXM6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xlYWRlcmJvYXJkLXRhYmxlLWJvZHknKS5pbm5lckhUTUwgPSAnPHRyPjx0ZCBjb2xzcGFuPSI0IiBjbGFzcz0idGV4dC1jZW50ZXIgcC00IHRleHQtcmVkLTUwMCI+4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmC4Lir4Lil4LiU4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LiZ4LizPC90ZD48L3RyPic7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyTGVhZGVyYm9hcmQocHJvZmlsZXMsIHRhYmxlQm9keUlkKSB7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlQm9keSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRhYmxlQm9keUlkKTsKICAgICAgICAgICAgaWYgKCFwcm9maWxlcyB8fCBwcm9maWxlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHRhYmxlQm9keS5pbm5lckhUTUwgPSAnPHRyPjx0ZCBjb2xzcGFuPSI0IiBjbGFzcz0idGV4dC1jZW50ZXIgcC00IHRleHQtZ3JheS01MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC4hOC4sOC5geC4meC4meC4quC4s+C4q+C4o+C4seC4muC4leC4suC4o+C4suC4h+C4nOC4ueC5ieC4meC4szwvdGQ+PC90cj4nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gQWR2YW5jZWQgUmFua2luZyAtLS0KICAgICAgICAgICAgcHJvZmlsZXMuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICAgICAgLy8gMS4gUHJpbWFyeTogVG90YWwgUG9pbnRzCiAgICAgICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gKGIudG90YWxQb2ludHMgfHwgMCkgLSAoYS50b3RhbFBvaW50cyB8fCAwKTsKICAgICAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKCiAgICAgICAgICAgICAgICAvLyAyLiBTZWNvbmRhcnk6IE51bWJlciBvZiBTcGVjaWFsaXN0ICjwn5Gp4oCN8J+agCkgYmFkZ2VzCiAgICAgICAgICAgICAgICBjb25zdCBzcGVjaWFsaXN0RGlmZiA9IChiLmJhZGdlc0NvdW50Py5zcGVjaWFsaXN0IHx8IDApIC0gKGEuYmFkZ2VzQ291bnQ/LnNwZWNpYWxpc3QgfHwgMCk7CiAgICAgICAgICAgICAgICBpZiAoc3BlY2lhbGlzdERpZmYgIT09IDApIHJldHVybiBzcGVjaWFsaXN0RGlmZjsKCiAgICAgICAgICAgICAgICAvLyAzLiBUZXJ0aWFyeTogTnVtYmVyIG9mIEZpcnN0IFRyeSBBY2UgKPCfmoApIGJhZGdlcwogICAgICAgICAgICAgICAgY29uc3QgZmlyc3RUcnlBY2VEaWZmID0gKGIuYmFkZ2VzQ291bnQ/LmZpcnN0X3RyeV9hY2UgfHwgMCkgLSAoYS5iYWRnZXNDb3VudD8uZmlyc3RfdHJ5X2FjZSB8fCAwKTsKICAgICAgICAgICAgICAgIGlmIChmaXJzdFRyeUFjZURpZmYgIT09IDApIHJldHVybiBmaXJzdFRyeUFjZURpZmY7CgogICAgICAgICAgICAgICAgLy8gNC4gUXVhdGVybmFyeTogTnVtYmVyIG9mIFBlcmZlY3QgU2NvcmUgKPCfkZEpIGJhZGdlcwogICAgICAgICAgICAgICAgY29uc3QgcGVyZmVjdFNjb3JlRGlmZiA9IChiLmJhZGdlc0NvdW50Py5wZXJmZWN0X3Njb3JlIHx8IDApIC0gKGEuYmFkZ2VzQ291bnQ/LnBlcmZlY3Rfc2NvcmUgfHwgMCk7CiAgICAgICAgICAgICAgICBpZiAocGVyZmVjdFNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHBlcmZlY3RTY29yZURpZmY7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIDUuIFF1aW5hcnk6IE51bWJlciBvZiBRdWljayBUaGlua2VyICjimqHvuI8pIGJhZGdlcwogICAgICAgICAgICAgICAgY29uc3QgcXVpY2tUaGlua2VyRGlmZiA9IChiLmJhZGdlc0NvdW50Py5xdWlja190aGlua2VyIHx8IDApIC0gKGEuYmFkZ2VzQ291bnQ/LnF1aWNrX3RoaW5rZXIgfHwgMCk7CiAgICAgICAgICAgICAgICBpZiAocXVpY2tUaGlua2VyRGlmZiAhPT0gMCkgcmV0dXJuIHF1aWNrVGhpbmtlckRpZmY7CgogICAgICAgICAgICAgICAgLy8gNi4gRmluYWw6IEFscGhhYmV0aWNhbCBieSBuYW1lCiAgICAgICAgICAgICAgICByZXR1cm4gYS5zdHVkZW50TmFtZS5sb2NhbGVDb21wYXJlKGIuc3R1ZGVudE5hbWUsICd0aCcpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGxldCBodG1sID0gJyc7CiAgICAgICAgICAgIHByb2ZpbGVzLmZvckVhY2goKHByb2ZpbGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCByYW5rID0gaW5kZXggKyAxOwogICAgICAgICAgICAgICAgY29uc3QgYmFkZ2VzQ291bnQgPSBwcm9maWxlLmJhZGdlc0NvdW50IHx8IHt9OwoKICAgICAgICAgICAgICAgIGxldCBiYWRnZXNIVE1MID0gJyc7CiAgICAgICAgICAgICAgICBjb25zdCBiYWRnZU9yZGVyID0gWydzcGVjaWFsaXN0JywgJ3BlcmZlY3Rfc2NvcmUnLCAnZmlyc3RfdHJ5X2FjZScsICdxdWlja190aGlua2VyJ107CgogICAgICAgICAgICAgICAgYmFkZ2VPcmRlci5mb3JFYWNoKGJhZGdlSWQgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChiYWRnZXNDb3VudFtiYWRnZUlkXSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFkZ2VJbmZvID0gT2JqZWN0LnZhbHVlcyhCQURHRVMpLmZpbmQoYiA9PiBiLmlkID09PSBiYWRnZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhZGdlSW5mbykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhZGdlSWQgPT09ICdzcGVjaWFsaXN0JykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBzcGVjaWFsaXN0LCBqdXN0IHNob3cgdGhlIGljb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWRnZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImlubGluZS1mbGV4IGl0ZW1zLWNlbnRlciBteC0xIiB0aXRsZT0iJHtiYWRnZUluZm8ubmFtZX0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyAke2JhZGdlSW5mby5pY29ufSB0ZXh0LWxnIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3Igb3RoZXJzLCBzaG93IGljb24gYW5kIGNvdW50CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFkZ2VzSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJpbmxpbmUtZmxleCBpdGVtcy1jZW50ZXIgbXgtMSIgdGl0bGU9IiR7YmFkZ2VJbmZvLm5hbWV9ICgke2JhZGdlc0NvdW50W2JhZGdlSWRdfSDguITguKPguLHguYnguIcpIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgJHtiYWRnZUluZm8uaWNvbn0gdGV4dC1sZyI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im1sLTEgdGV4dC1zbSBmb250LXNlbWlib2xkIj4ke2JhZGdlc0NvdW50W2JhZGdlSWRdfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9ImhvdmVyOmJnLWdyYXktNTAiPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciBmb250LWJvbGQiPiR7cmFua308L3RkPgogICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+JHtwcm9maWxlLnN0dWRlbnROYW1lfTwvdGQ+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIGZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tNjAwIj4keyhwcm9maWxlLnRvdGFsUG9pbnRzIHx8IDApLnRvTG9jYWxlU3RyaW5nKCl9PC90ZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIiPiR7YmFkZ2VzSFRNTCB8fCAnLSd9PC90ZD4KICAgICAgICAgICAgICAgICAgICA8L3RyPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRhYmxlQm9keS5pbm5lckhUTUwgPSBodG1sOwogICAgICAgIH0KCQkKCQkvLyAtLS0gWyDguYDguJ7guLTguYjguKHguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguJnguLXguYnguYDguILguYnguLLguYTguJvguJfguLHguYnguIfguKvguKHguJQgXSAtLS0KCi8qKgogKiDguYHguKrguJTguIfguKvguJnguYnguLLguIjguK3guKrguLPguKvguKPguLHguJrguYLguKvguKHguJTguKfguJnguKXguLnguJvguYDguKHguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJnguKrguK3guJrguYTguKHguYjguJzguYjguLLguJkgKOC5gOC4p+C4reC4o+C5jOC4iuC4seC4meC4reC4seC4m+C5gOC4lOC4leC4peC5iOC4suC4quC4uOC4lCkKICogQHBhcmFtIHtudW1iZXJ9IHNjb3JlIOC4hOC4sOC5geC4meC4meC4l+C4teC5iOC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4s+C5hOC4lOC5iQogKiBAcGFyYW0ge251bWJlcn0gdG90YWxRdWVzdGlvbnMg4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAqIEBwYXJhbSB7c3RyaW5nfSBkaXNwbGF5U2V0dGluZyDguIHguLLguKPguJXguLHguYnguIfguITguYjguLLguIHguLLguKPguYHguKrguJTguIfguJzguKUKICovCmZ1bmN0aW9uIGRpc3BsYXlMb29wU2NyZWVuKHNjb3JlLCB0b3RhbFF1ZXN0aW9ucywgZGlzcGxheVNldHRpbmcpIHsKICAgIGxldCBzY29yZUh0bWwgPSAnJzsKICAgIGlmIChkaXNwbGF5U2V0dGluZyAhPT0gJ3Nob3dfcGFzc19mYWlsX29ubHknKSB7CiAgICAgICAgc2NvcmVIdG1sID0gYDxwIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIG10LTIiPuC4hOC4sOC5geC4meC4meC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4rSA8c3Ryb25nIGNsYXNzPSJ0ZXh0LXhsIj4ke3Njb3JlfSAvICR7dG90YWxRdWVzdGlvbnN9PC9zdHJvbmc+PC9wPmA7CiAgICB9CgogICAgY29uc3QgaHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggYmctcmVkLTEwMCByb3VuZGVkLWxnIGZhZGUtaW4iPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXJlZG8tYWx0IHRleHQtNXhsIHRleHQtcmVkLTUwMCBtYi00IGFuaW1hdGUtc3BpbiBbYW5pbWF0aW9uLWR1cmF0aW9uOjJzXSI+PC9pPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXJlZC04MDAiPuC4ouC4seC4h+C5hOC4oeC5iOC4nOC5iOC4suC4meC5gOC4geC4k+C4keC5jOC4meC4sCE8L2gzPgogICAgICAgICAgICAke3Njb3JlSHRtbH0KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS02MDAiPuC4quC4ueC5ieC5hiDguKXguK3guIfguYPguKvguKHguYjguK3guLXguIHguITguKPguLHguYnguIfguYDguJ7guLfguYjguK3guJfguJrguJfguKfguJnguITguKfguLLguKHguYDguILguYnguLLguYPguIjguJnguLA8L3A+CiAgICAgICAgICAgIDxidXR0b24gaWQ9InJldGFrZS1xdWl6LWxvb3AtYnRuIiBjbGFzcz0ibXQtNiBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMyBweC02IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1yZWQtNzAwIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSI+CiAgICAgICAgICAgICAgICDguJfguLPguYHguJrguJrguJfguJTguKrguK3guJrguK3guLXguIHguITguKPguLHguYnguIcKICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gaHRtbDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXRha2UtcXVpei1sb29wLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIC8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lCAxIOC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC5gOC4guC5ieC4suC4oeC4suC4hOC4o+C4seC4miBdIC0tLQogICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyAvLyDguKrguLHguYjguIfguIvguYjguK3guJnguKvguJnguYnguLLguIjguK0gIuC4ouC4seC4h+C5hOC4oeC5iOC4nOC5iOC4suC4meC5gOC4geC4k+C4keC5jCIg4LiB4LmI4Lit4LiZCiAgICAgICAgCiAgICAgICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgZGlzcGxheVF1aXpGb3JTdHVkZW50KGN1cnJlbnRRdWl6RGF0YSk7CiAgICB9KTsKfQoKICAgICAgICAvLyBORVc6IFJlbmRlciBRdWl6LXNwZWNpZmljIExlYWRlcmJvYXJkCiAgICAgICAgLy8gLS0tIOC4meC4s+C5guC4hOC5ieC4lOC4meC4teC5ieC5hOC4m+C4p+C4suC4h+C5geC4l+C4meC4l+C4teC5iOC4n+C4seC4h+C4geC5jOC4iuC4seC4mSByZW5kZXJRdWl6TGVhZGVyYm9hcmQg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpmdW5jdGlvbiByZW5kZXJRdWl6TGVhZGVyYm9hcmQoc3VibWlzc2lvbnMsIHF1aXpEYXRhLCB0YWJsZUJvZHlJZCkgewogICAgY29uc3QgdGFibGVCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVCb2R5SWQpOwogICAgY29uc3QgaXNTdHVkZW50VmlldyA9IHRhYmxlQm9keUlkID09PSAnc3R1ZGVudC1xdWl6LWxlYWRlcmJvYXJkLXRhYmxlLWJvZHknOwogICAgCiAgICAvLyAtLS0gW+C5geC4geC5ieC5hOC4gl0gMS4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LmA4LiV4LmH4Lih4Lij4Lin4LihIChXZWlnaHRlZCBNYXggU2NvcmUpIC0tLQogICAgbGV0IHRvdGFsTWF4U2NvcmUgPSAwOwogICAgY29uc3QgdHlwZVNjb3JpbmcgPSBxdWl6RGF0YS5zZXR0aW5ncz8udHlwZVNjb3JpbmcgfHwgeyBtY3E6IDEsIHNhOiAxLCB0ZjogMSB9OwogICAgCiAgICBpZiAocXVpekRhdGEucXVlc3Rpb25zICYmIHF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2gocSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHFUeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgcXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgICAgIGxldCB3ZWlnaHQgPSAxOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHFUeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHsKICAgICAgICAgICAgICAgIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3Jpbmcuc2EpIHx8IDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocVR5cGUgPT09ICd0cnVlX2ZhbHNlJykgewogICAgICAgICAgICAgICAgd2VpZ2h0ID0gcGFyc2VGbG9hdCh0eXBlU2NvcmluZy50ZikgfHwgMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG11bHRpcGxlX2Nob2ljZSwgbWF0Y2hpbmcsIGV0Yy4KICAgICAgICAgICAgICAgIHdlaWdodCA9IHBhcnNlRmxvYXQodHlwZVNjb3JpbmcubWNxKSB8fCAxOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRvdGFsTWF4U2NvcmUgKz0gd2VpZ2h0OwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgICB0b3RhbE1heFNjb3JlID0gMTsgLy8g4LiB4Lix4LiZ4Lir4Liy4Lij4LiU4LmJ4Lin4LiiIDAg4LiB4Lij4LiT4Li14LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Liq4Lit4LiaCiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4q+C4seC4p+C4leC4suC4o+C4suC4h+C4l+C4teC5iOC4l+C4s+C5g+C4q+C5ieC4hOC4peC4tOC4geC5hOC4lOC5iSAtLS0KICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVCb2R5SWQpLmNsb3Nlc3QoJ3RhYmxlJyk7CiAgICBpZiAodGFibGUgJiYgIWlzU3R1ZGVudFZpZXcpIHsKICAgICAgICBjb25zdCB0aGVhZCA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3IoJ3RoZWFkJyk7CiAgICAgICAgdGhlYWQuaW5uZXJIVE1MID0gYAogICAgICAgICAgICA8dHIgY2xhc3M9ImJnLWdyYXktMTAwIj4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIHctMTYiPuC4reC4seC4meC4lOC4seC4mjwvdGg+CiAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQgc29ydGFibGUtaGVhZGVyIiBkYXRhLXNvcnQ9InN0dWRlbnROYW1lIiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+4LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIHNvcnRhYmxlLWhlYWRlciIgZGF0YS1zb3J0PSJiZXN0U2NvcmUiIHN0eWxlPSJjdXJzb3I6IHBvaW50ZXI7Ij7guITguLDguYHguJnguJnguJTguLXguJfguLXguYjguKrguLjguJQ8L3RoPgogICAgICAgICAgICAgICAgPHRoIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPuC4nOC4pTwvdGg+CiAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciBzb3J0YWJsZS1oZWFkZXIiIGRhdGEtc29ydD0icG9pbnRzIiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+UG9pbnRzICjguITguKPguLHguYnguIfguKXguYjguLLguKrguLjguJQpPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIHNvcnRhYmxlLWhlYWRlciIgZGF0YS1zb3J0PSJhdHRlbXB0cyIgc3R5bGU9ImN1cnNvcjogcG9pbnRlcjsiPuC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4h+C4l+C4teC5iOC4l+C4szwvdGg+CiAgICAgICAgICAgICAgICA8dGggY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWxlZnQgc29ydGFibGUtaGVhZGVyIiBkYXRhLXNvcnQ9ImxhdGVzdFN1Ym1pdHRlZEF0IiBzdHlsZT0iY3Vyc29yOiBwb2ludGVyOyI+4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiH4Lil4LmI4Liy4Liq4Li44LiUPC90aD4KICAgICAgICAgICAgICAgIDx0aCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtbGVmdCI+4Lib4LmJ4Liy4Lii4Lij4Liy4LiH4Lin4Lix4LilPC90aD4KICAgICAgICAgICAgPC90cj4KICAgICAgICBgOwogICAgfQoKICAgIGlmICghc3VibWlzc2lvbnMgfHwgc3VibWlzc2lvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGFibGVCb2R5LmlubmVySFRNTCA9IGA8dHI+PHRkIGNvbHNwYW49IiR7aXNTdHVkZW50VmlldyA/IDYgOiA4fSIgY2xhc3M9InRleHQtY2VudGVyIHAtNCB0ZXh0LWdyYXktNTAwIj7guKLguLHguIfguYTguKHguYjguKHguLXguJnguLHguIHguYDguKPguLXguKLguJnguKrguYjguIfguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYk8L3RkPjwvdHI+YDsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4mSBMb2dpYyDguIHguLLguKPguIjguLHguJTguYDguKPguLXguKLguIfguILguYnguK3guKHguLnguKUgLS0tCiAgICBjb25zdCBzdWJtaXNzaW9uc0NvcHkgPSBbLi4uc3VibWlzc2lvbnNdOyAKICAgIHN1Ym1pc3Npb25zQ29weS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgbGV0IHZhbEEsIHZhbEI7CiAgICAgICAgc3dpdGNoIChxdWl6TGVhZGVyYm9hcmRTb3J0QnkpIHsKICAgICAgICAgICAgY2FzZSAnc3R1ZGVudE5hbWUnOgogICAgICAgICAgICAgICAgdmFsQSA9IGEuc3R1ZGVudE5hbWUgfHwgJyc7CiAgICAgICAgICAgICAgICB2YWxCID0gYi5zdHVkZW50TmFtZSB8fCAnJzsKICAgICAgICAgICAgICAgIHJldHVybiBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gdmFsQS5sb2NhbGVDb21wYXJlKHZhbEIsICd0aCcpIDogdmFsQi5sb2NhbGVDb21wYXJlKHZhbEEsICd0aCcpOwogICAgICAgICAgICBjYXNlICdwb2ludHMnOgogICAgICAgICAgICAgICAgdmFsQSA9IGEucG9pbnRzIHx8IDA7CiAgICAgICAgICAgICAgICB2YWxCID0gYi5wb2ludHMgfHwgMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdhdHRlbXB0cyc6CiAgICAgICAgICAgICAgICB2YWxBID0gYS5hdHRlbXB0cz8ubGVuZ3RoIHx8IDE7CiAgICAgICAgICAgICAgICB2YWxCID0gYi5hdHRlbXB0cz8ubGVuZ3RoIHx8IDE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAnbGF0ZXN0U3VibWl0dGVkQXQnOgogICAgICAgICAgICAgICAgdmFsQSA9IG5ldyBEYXRlKGEubGF0ZXN0U3VibWl0dGVkQXQpOwogICAgICAgICAgICAgICAgdmFsQiA9IG5ldyBEYXRlKGIubGF0ZXN0U3VibWl0dGVkQXQpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2Jlc3RTY29yZSc6CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICB2YWxBID0gYS5iZXN0U2NvcmU7CiAgICAgICAgICAgICAgICB2YWxCID0gYi5iZXN0U2NvcmU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbEEgPCB2YWxCKSByZXR1cm4gcXVpekxlYWRlcmJvYXJkU29ydE9yZGVyID09PSAnYXNjJyA/IC0xIDogMTsKICAgICAgICBpZiAodmFsQSA+IHZhbEIpIHJldHVybiBxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gMSA6IC0xOwogICAgICAgIHJldHVybiAwOyAKICAgIH0pOwoKICAgIC8vIC0tLSDguKrguYjguKfguJnguIHguLLguKPguKrguKPguYnguLLguIfguJXguLLguKPguLLguIcgLS0tCiAgICBjb25zdCBpc1JlbWVkaWFsUXVpeiA9IHF1aXpEYXRhLmlzUmVtZWRpYWwgPT09IHRydWU7CiAgICAvLyDguJvguKPguLHguJrguYDguIHguJPguJHguYzguJzguYjguLLguJnguYPguKvguYnguYDguJfguLXguKLguJrguIHguLHguJrguITguLDguYHguJnguJnguYDguJXguYfguKHguKPguKfguKEgKOC4luC5ieC4suC5hOC4oeC5iOC5hOC4lOC5ieC4leC4seC5ieC4h+C4hOC5iOC4suC4leC4suC4ouC4leC4seC4p+C5hOC4p+C5iSkKICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IHF1aXpEYXRhLnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gKHRvdGFsTWF4U2NvcmUgLyAyKTsKCiAgICBsZXQgaHRtbCA9ICcnOwogICAgc3VibWlzc2lvbnNDb3B5LmZvckVhY2goKHN1YiwgaW5kZXgpID0+IHsKICAgICAgICBjb25zdCByYW5rID0gaW5kZXggKyAxOwogICAgICAgIGxldCByZXN1bHRIdG1sID0gJzx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIj4tPC90ZD4nOwogICAgICAgIAogICAgICAgIC8vIOC5gOC4iuC5h+C4hOC4nOC4pSDguJzguYjguLLguJkv4LmE4Lih4LmI4Lic4LmI4Liy4LiZCiAgICAgICAgaWYgKGlzUmVtZWRpYWxRdWl6IHx8IHBhc3NpbmdTY29yZSAhPT0gLTEpIHsKICAgICAgICAgICAgbGV0IGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHN1Yi5iZXN0U2NvcmUgPT09IHRvdGFsTWF4U2NvcmUpIDogKHN1Yi5iZXN0U2NvcmUgPj0gcGFzc2luZ1Njb3JlKTsKICAgICAgICAgICAgY29uc3QgcmVzdWx0Q2xhc3MgPSBpc1Bhc3MgPyAnYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJyA6ICdiZy1yZWQtMTAwIHRleHQtcmVkLTgwMCc7CiAgICAgICAgICAgIGNvbnN0IHJlc3VsdFRleHQgPSBpc1Bhc3MgPyAn4Lic4LmI4Liy4LiZJyA6ICfguYTguKHguYjguJzguYjguLLguJknOwogICAgICAgICAgICByZXN1bHRIdG1sID0gYDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIHRleHQtY2VudGVyIj48c3BhbiBjbGFzcz0idGV4dC14cyBmb250LW1lZGl1bSBweC0yLjUgcHktMC41IHJvdW5kZWQtZnVsbCAke3Jlc3VsdENsYXNzfSI+JHtyZXN1bHRUZXh0fTwvc3Bhbj48L3RkPmA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgIGNvbnN0IGJhZGdlc0hUTUwgPSAobGF0ZXN0QXR0ZW1wdC5iYWRnZXMgfHwgW10pCiAgICAgICAgICAgIC5tYXAoYmFkZ2VJZCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBiYWRnZUluZm8gPSBPYmplY3QudmFsdWVzKEJBREdFUykuZmluZChiID0+IGIuaWQgPT09IGJhZGdlSWQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJhZGdlSW5mbyA/IGA8c3BhbiB0aXRsZT0iJHtiYWRnZUluZm8ubmFtZX0iPjxpIGNsYXNzPSJmYXMgJHtiYWRnZUluZm8uaWNvbn0gbXgtMSB0ZXh0LWxnIj48L2k+PC9zcGFuPmAgOiAnJzsKICAgICAgICAgICAgfSkuam9pbignJyk7CiAgICAgICAgICAgIAogICAgICAgIC8vIC0tLSBb4LmB4LiB4LmJ4LmE4LiCXSDguYPguIrguYkgdG90YWxNYXhTY29yZSDguYHguJfguJkgdG90YWxRdWVzdGlvbnMg4LiX4Li14LmI4LmA4Lib4LmH4LiZ4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4LitIC0tLQogICAgICAgIGh0bWwgKz0gYAogICAgICAgICAgICA8dHIgY2xhc3M9ImhvdmVyOmJnLWdyYXktNTAiPgogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgZm9udC1ib2xkIj4ke3Jhbmt9PC90ZD4KICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0icHktMiBweC00IGJvcmRlci1iIj4ke3N1Yi5zdHVkZW50TmFtZX08L3RkPgogICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIgZm9udC1ib2xkIHRleHQtZ3JlZW4tNjAwIj4ke3N1Yi5iZXN0U2NvcmV9IC8gJHt0b3RhbE1heFNjb3JlfTwvdGQ+CiAgICAgICAgICAgICAgICAke3Jlc3VsdEh0bWx9CiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LWNlbnRlciBmb250LXNlbWlib2xkIHRleHQtYmx1ZS02MDAiPiR7KHN1Yi5wb2ludHMgfHwgMCkudG9Mb2NhbGVTdHJpbmcoKX08L3RkPgogICAgICAgICAgICAgICAgJHtpc1N0dWRlbnRWaWV3ID8gIiIgOiBgPHRkIGNsYXNzPSJweS0yIHB4LTQgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7c3ViLmF0dGVtcHRzPy5sZW5ndGggfHwgMX08L3RkPmB9CiAgICAgICAgICAgICAgICAke2lzU3R1ZGVudFZpZXcgPyAiIiA6IGA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiB0ZXh0LXNtIHRleHQtZ3JheS02MDAiPiR7bmV3IERhdGUoc3ViLmxhdGVzdFN1Ym1pdHRlZEF0KS50b0xvY2FsZVN0cmluZygndGgtVEgnKX08L3RkPmB9CiAgICAgICAgICAgICAgICA8dGQgY2xhc3M9InB5LTIgcHgtNCBib3JkZXItYiI+JHtiYWRnZXNIVE1MIHx8ICctJ308L3RkPgogICAgICAgICAgICA8L3RyPgogICAgICAgIGA7CiAgICB9KTsKICAgIHRhYmxlQm9keS5pbm5lckhUTUwgPSBodG1sOwoKICAgIC8vIC0tLSDguKrguYjguKfguJnguYHguKrguJTguIfguKrguLHguI3guKXguLHguIHguKnguJPguYwg4payIOKWvCAtLS0KICAgIGlmICh0YWJsZSAmJiAhaXNTdHVkZW50VmlldykgewogICAgICAgIHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RoZWFkIC5zb3J0YWJsZS1oZWFkZXInKS5mb3JFYWNoKHRoID0+IHsKICAgICAgICAgICAgY29uc3QgaW5kaWNhdG9yID0gdGgucXVlcnlTZWxlY3RvcignLnNvcnQtaW5kaWNhdG9yJyk7CiAgICAgICAgICAgIGlmIChpbmRpY2F0b3IpIGluZGljYXRvci5yZW1vdmUoKTsgCiAgICAgICAgICAgIGlmICh0aC5kYXRhc2V0LnNvcnQgPT09IHF1aXpMZWFkZXJib2FyZFNvcnRCeSkgewogICAgICAgICAgICAgICAgdGguaW5uZXJIVE1MICs9IGA8c3BhbiBjbGFzcz0ic29ydC1pbmRpY2F0b3IgbWwtMiI+JHtxdWl6TGVhZGVyYm9hcmRTb3J0T3JkZXIgPT09ICdhc2MnID8gJ+KWsicgOiAn4pa8J308L3NwYW4+YDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9CgovKioKICog4LiI4Lix4LiU4LiB4Liy4Lij4LiB4Liy4Lij4Lil4Lia4Lic4Lil4LiB4Liy4Lij4Liq4Lit4Lia4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lij4Liy4Lii4Lia4Li44LiE4LiE4LilCiAqIEBwYXJhbSB7c3RyaW5nfSBzdHVkZW50TmFtZSAtIOC4iuC4t+C5iOC4reC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4nOC4peC4quC4reC4mgogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlRGVsZXRlU3VibWlzc2lvbihzdHVkZW50TmFtZSkgewogICAgaWYgKCFjdXJyZW50UXVpekRhdGEgfHwgIWN1cnJlbnRRdWl6RGF0YS5pZCB8fCAhc3R1ZGVudE5hbWUpIHsKICAgICAgICBzaG93TWVzc2FnZSgi4LiC4LmJ4Lit4Lih4Li54Lil4LmE4Lih4LmI4LmA4Lie4Li14Lii4LiH4Lie4Lit4LiX4Li14LmI4LiI4Liw4Lil4Lia4Lic4Lil4Liq4Lit4LiaIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNob3dDb25maXJtYXRpb24oCiAgICAgICAgYOC4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4peC4muC4nOC4peC4geC4suC4o+C4quC4reC4muC4guC4reC4hyAiJHtzdHVkZW50TmFtZX0iPyDguJnguLHguIHguYDguKPguLXguKLguJnguIjguLDguJXguYnguK3guIfguJfguLPguYHguJrguJrguJfguJTguKrguK3guJrguJnguLXguYnguYPguKvguKHguYjguK3guLXguIHguITguKPguLHguYnguIdgLAogICAgICAgIGFzeW5jICgpID0+IHsKICAgICAgICAgICAgY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwogICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgc3R1ZGVudE5hbWUpOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGF3YWl0IGRlbGV0ZURvYyhzdWJtaXNzaW9uUmVmKTsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguKXguJrguJzguKXguKrguK3guJrguILguK3guIcgJHtzdHVkZW50TmFtZX0g4Liq4Liz4LmA4Lij4LmH4LiIYCk7CiAgICAgICAgICAgICAgICAvLyDguKPguLDguJrguJrguIjguLAgcmUtcmVuZGVyIOC4leC4suC4o+C4suC4h+C5g+C4q+C5ieC4reC4seC4leC5guC4meC4oeC4seC4leC4tOC5gOC4nuC4o+C4suC4sCBvblNuYXBzaG90IOC4l+C4s+C4h+C4suC4meC4reC4ouC4ueC5iAogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZGVsZXRpbmcgc3VibWlzc2lvbjoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lil4Lia4Lic4Lil4Liq4Lit4LiaIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICApOwp9CgogICAgICAgIC8vIC0tLSBTdHVkZW50IEZsb3cgLS0tCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlTG9hZFF1aXooKSB7CiAgICAvLyAxLiBSZXNldCDguITguYjguLLguIrguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJnguIHguYjguK3guJnguYDguKrguKHguK0g4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4Lib4Lil4Lit4LiU4Lig4Lix4LiiCiAgICBjdXJyZW50U3R1ZGVudE5hbWUgPSBudWxsOyAKCiAgICBjb25zdCBxdWl6SWRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWlkLWlucHV0Jyk7CiAgICBjb25zdCBxdWl6SWQgPSBxdWl6SWRJbnB1dC52YWx1ZS50cmltKCk7CiAgICBpZiAoIXF1aXpJZCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguJvguYnguK3guJnguKPguKvguLHguKrguYHguJrguJrguJfguJTguKrguK3guJoiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbG9hZFF1aXpCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgbG9hZFF1aXpCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT7guIHguLPguKXguLHguIfguYLguKvguKXguJQuLi4nOwoKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcXVpekRvY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzYCwgcXVpeklkKTsKICAgICAgICBjb25zdCBxdWl6RG9jU25hcCA9IGF3YWl0IGdldERvYyhxdWl6RG9jUmVmKTsKCiAgICAgICAgaWYgKCFxdWl6RG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Liq4Liz4Lir4Lij4Lix4Lia4Lij4Lir4Lix4Liq4LiZ4Li14LmJIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOC5g+C4iuC5ieC4muC4o+C4o+C4l+C4seC4lOC5gOC4lOC4tOC4oeC4guC4reC4h+C4hOC4uOC4k+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC5gOC4guC5ieC4suC4geC4seC4miBpbmRleC5odG1sCiAgICAgICAgY3VycmVudFF1aXpEYXRhID0geyBpZDogcXVpekRvY1NuYXAuaWQsIC4uLnF1aXpEb2NTbmFwLmRhdGEoKSB9OwoKICAgICAgICAvLyBDaGVjayBRdWl6IFN0YXR1cyAo4LmD4LiK4LmJIExvZ2ljIOC5gOC4lOC4tOC4oeC4guC4reC4h+C4hOC4uOC4k+C5gOC4m+C5iuC4sOC5hikKICAgICAgICBjb25zdCBzdGF0dXMgPSBjdXJyZW50UXVpekRhdGEuc3RhdHVzIHx8ICdhY3RpdmUnOwogICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7CiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2luYWN0aXZlJykgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJ4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4Lit4Lii4Li54LmIIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ3NjaGVkdWxlZCcpIHsKICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gY3VycmVudFF1aXpEYXRhLnN0YXJ0VGltZSA/IG5ldyBEYXRlKGN1cnJlbnRRdWl6RGF0YS5zdGFydFRpbWUpIDogbnVsbDsKICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IGN1cnJlbnRRdWl6RGF0YS5lbmRUaW1lID8gbmV3IERhdGUoY3VycmVudFF1aXpEYXRhLmVuZFRpbWUpIDogbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChzdGFydFRpbWUgJiYgbm93IDwgc3RhcnRUaW1lKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShg4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJ4LiI4Liw4LmA4Lib4Li04LiU4LmD4Lir4LmJ4LiX4Liz4LmD4LiZ4Lin4Lix4LiZ4LiX4Li14LmIICR7c3RhcnRUaW1lLnRvTG9jYWxlU3RyaW5nKCd0aC1USCcsIHsgaG91cjEyOiBmYWxzZSB9KX1gKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW5kVGltZSAmJiBub3cgPiBlbmRUaW1lKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJ4Lir4Lih4LiU4LmA4Lin4Lil4Liy4LmB4Lil4LmJ4LinIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgcHJvamVjdElkID0gY3VycmVudFF1aXpEYXRhLnByb2plY3RJZDsKICAgICAgICBjdXJyZW50UHJvamVjdElkID0gcHJvamVjdElkOyAvLyA8LS0g4LiE4LiH4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmE4Lin4LmJ4LiV4Liy4Lih4LmA4LiU4Li04LihIOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBHbG9iYWwgU3RhdGUg4LiX4Liz4LiH4Liy4LiZ4LiW4Li54LiB4LiV4LmJ4Lit4LiHCgogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIC8vIPCflKUg4LiI4Li44LiU4LmA4Lib4Lil4Li14LmI4Lii4LiZ4Liq4Liz4LiE4Lix4LiNIChUaGUgTG9naWMgRm9yaykg8J+UpQogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIAogICAgICAgIC8vIOC4geC4o+C4k+C4teC4l+C4teC5iCAxOiDguYDguJvguYfguJnguILguYnguK3guKrguK3guJrguIvguYjguK3guKEgKE5ldyBQYXRoKQogICAgICAgIC8vIOC5gOC4o+C4suC5gOC4iuC5h+C4hOC4p+C5iOC4suC4oeC4tSBmbGFnIGlzUmVtZWRpYWwg4LmB4Lil4Liw4Lih4Li14LiK4Li34LmI4Lit4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4Lij4Liw4Lia4Li44Lih4Liy4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICAgICAgaWYgKGN1cnJlbnRRdWl6RGF0YS5pc1JlbWVkaWFsICYmIGN1cnJlbnRRdWl6RGF0YS5yZW1lZGlhbEZvcikgewogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4Lil4Lix4LiU4LiC4Lix4LmJ4LiZ4LiV4Lit4LiZOiDguYTguKHguYjguJXguYnguK3guIfguYLguKvguKXguJQgUHJvamVjdCDguYDguJ7guLfguYjguK3guYDguK3guLIgRHJvcGRvd24g4LiK4Li34LmI4Lit4LmA4Lie4Li34LmI4Lit4LiZCiAgICAgICAgICAgIC8vIOC5gOC4nuC4o+C4suC4sOC4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oSDguKPguLDguJrguLjguJXguLHguKfguITguJnguJfguLPguKHguLLguIrguLHguJTguYDguIjguJnguYHguKXguYnguKcKICAgICAgICAgICAgY3VycmVudFN0dWRlbnROYW1lID0gY3VycmVudFF1aXpEYXRhLnJlbWVkaWFsRm9yOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8g4LmA4Lij4Li14Lii4LiB4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4Lij4Li04LmI4Lih4Liq4Lit4Lia4LmB4Lia4Lia4LiL4LmI4Lit4LihICjguJXguYnguK3guIfguKHguLXguJ/guLHguIfguIHguYzguIrguLHguJnguJnguLXguYnguIjguLLguIHguIHguLLguKMgY29weSDguKHguLLguIjguLLguIEgQS5odG1sKQogICAgICAgICAgICBkaXNwbGF5UmVtZWRpYWxTdGFydFNjcmVlbihjdXJyZW50U3R1ZGVudE5hbWUsIGN1cnJlbnRRdWl6RGF0YS50b3BpYyk7CgogICAgICAgIH0gCiAgICAgICAgLy8g4LiB4Lij4LiT4Li14LiX4Li14LmIIDI6IOC5gOC4m+C5h+C4meC4guC5ieC4reC4quC4reC4muC4m+C4geC4leC4tCAoT3JpZ2luYWwgUGF0aCkKICAgICAgICAvLyDguYLguITguYnguJTguKrguYjguKfguJnguJnguLXguYnguITguLfguK3guILguK3guIfguYDguJTguLTguKHguILguK3guIfguITguLjguJMgMTAwJSDguIjguLDguJfguLPguIfguLLguJnguYDguKHguLfguYjguK3guYTguKHguYjguYPguIrguYjguILguYnguK3guKrguK3guJrguIvguYjguK3guKEKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcHJvamVjdERvY1JlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHByb2plY3RJZCk7CiAgICAgICAgICAgIGNvbnN0IHByb2plY3REb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHByb2plY3REb2NSZWYpOwoKICAgICAgICAgICAgaWYgKCFwcm9qZWN0RG9jU25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDog4LmE4Lih4LmI4Lie4Lia4LmC4Lib4Lij4LmA4LiI4LiE4LiX4Li14LmI4LmA4LiB4Li14LmI4Lii4Lin4LiC4LmJ4Lit4LiH4LiB4Lix4Lia4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiZ4Li14LmJIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHByb2plY3REYXRhID0gcHJvamVjdERvY1NuYXAuZGF0YSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3VycmVudFN0dWRlbnRQcm9qZWN0RGF0YSA9IHByb2plY3REYXRhOyAKICAgICAgICAgICAgZGlzcGxheVN0dWRlbnROYW1lU2VsZWN0b3IocHJvamVjdERhdGEuc3R1ZGVudHMsIGN1cnJlbnRRdWl6RGF0YS50b3BpYyk7CiAgICAgICAgfQogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgbG9hZGluZyBxdWl6IGZvciBzdHVkZW50OiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LmC4Lir4Lil4LiU4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaIik7CiAgICB9IGZpbmFsbHkgewogICAgICAgIGxvYWRRdWl6QnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgbG9hZFF1aXpCdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc2VhcmNoIG1yLTIiPjwvaT7guITguYnguJnguKvguLLguYHguJrguJrguJfguJTguKrguK3guJonOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVNYW51YWxFZGl0UG9pbnRzKHN0dWRlbnROYW1lLCBuZXdQb2ludHMpIHsKICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEuaWQpIHJldHVybjsKCiAgICBjb25zdCBxdWl6SWQgPSBjdXJyZW50UXVpekRhdGEuaWQ7CiAgICBjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgc3R1ZGVudE5hbWUpOwoKICAgIHRyeSB7CiAgICAgICAgLy8gMS4g4Lit4Lix4Lib4LmA4LiU4LiVIFBvaW50cyDguJfguLXguYjguKvguJnguYnguLIgU3VibWlzc2lvbgogICAgICAgIC8vIOC5gOC4o+C4suC4iOC4sOC4reC4seC4m+C5gOC4lOC4leC4l+C4teC5iCByb290IGxldmVsIOC5geC4peC4sCBhdHRlbXB0IOC4peC5iOC4suC4quC4uOC4lOC4lOC5ieC4p+C4oiDguYDguJ7guLfguYjguK3guITguKfguLLguKHguIrguLHguKfguKPguYwKICAgICAgICBjb25zdCBzdWJtaXNzaW9uU25hcCA9IGF3YWl0IGdldERvYyhzdWJtaXNzaW9uUmVmKTsKICAgICAgICBpZiAoIXN1Ym1pc3Npb25TbmFwLmV4aXN0cygpKSByZXR1cm47CgogICAgICAgIGNvbnN0IGRhdGEgPSBzdWJtaXNzaW9uU25hcC5kYXRhKCk7CiAgICAgICAgY29uc3QgYXR0ZW1wdHMgPSBkYXRhLmF0dGVtcHRzIHx8IFtdOwogICAgICAgIAogICAgICAgIC8vIOC4reC4seC4m+C5gOC4lOC4lSBwb2ludHMg4LmD4LiZIGF0dGVtcHQg4Lil4LmI4Liy4Liq4Li44LiUICjguJbguYnguLLguKHguLUpCiAgICAgICAgaWYgKGF0dGVtcHRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgYXR0ZW1wdHNbYXR0ZW1wdHMubGVuZ3RoIC0gMV0ucG9pbnRzID0gbmV3UG9pbnRzOwogICAgICAgICAgICAvLyDguYDguJ7guLTguYjguKEgRmxhZyDguJ7guLTguYDguKjguKkg4LmA4Lie4Li34LmI4Lit4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LiE4Liz4LiZ4Lin4LiT4LiX4Lix4Lia4LmD4LiZ4Lit4LiZ4Liy4LiE4LiVCiAgICAgICAgICAgIGF0dGVtcHRzW2F0dGVtcHRzLmxlbmd0aCAtIDFdLmlzU3luY0dhbWUgPSB0cnVlOyAKICAgICAgICB9CgogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgIHBvaW50czogbmV3UG9pbnRzLCAvLyDguK3guLHguJvguYDguJTguJXguITguYjguLLguKvguKXguLHguIEKICAgICAgICAgICAgYXR0ZW1wdHM6IGF0dGVtcHRzCiAgICAgICAgfSk7CgogICAgICAgIC8vIDIuIOC4quC4s+C4hOC4seC4jeC4oeC4suC4gSEg4Liq4Lix4LmI4LiH4LiE4Liz4LiZ4Lin4LiTIExlYWRlcmJvYXJkIOC5g+C4q+C4oeC5iOC4l+C4seC4meC4l+C4tQogICAgICAgIGlmIChjdXJyZW50UHJvamVjdERhdGEgJiYgY3VycmVudFByb2plY3RJZCkgewogICAgICAgICAgICBhd2FpdCB1cGRhdGVTdHVkZW50UHJvZmlsZShjdXJyZW50UHJvamVjdElkLCBzdHVkZW50TmFtZSk7CiAgICAgICAgfQoKICAgICAgICBzaG93TWVzc2FnZShg4LmB4LiB4LmJ4LmE4LiCIFBvaW50cyDguILguK3guIcgJHtzdHVkZW50TmFtZX0g4LmA4Lib4LmH4LiZICR7bmV3UG9pbnRzfSDguKrguLPguYDguKPguYfguIghYCk7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciB1cGRhdGluZyBwb2ludHM6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguJrguLHguJnguJfguLbguIHguITguLDguYHguJnguJkiKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlSm9pbkxpdmVHYW1lKCkgewogICAgY29uc3QgcGluSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZS1waW4taW5wdXQnKTsKICAgIGNvbnN0IG5pY2tuYW1lSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmlja25hbWUtaW5wdXQnKTsKICAgIGNvbnN0IGpvaW5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybS1qb2luLWdhbWUtYnRuJyk7CgogICAgY29uc3QgZ2FtZVBpbiA9IHBpbklucHV0LnZhbHVlLnRyaW0oKTsKICAgIGNvbnN0IG5pY2tuYW1lID0gbmlja25hbWVJbnB1dC52YWx1ZS50cmltKCk7CgogICAgaWYgKCFnYW1lUGluIHx8ICFuaWNrbmFtZSkgewogICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguIHguKPguK3guIHguKPguKvguLHguKrguYDguILguYnguLLguKPguYjguKfguKHguYHguKXguLDguIrguLfguYjguK3guYDguKXguYjguJnguYPguKvguYnguITguKPguJrguJbguYnguKfguJkiKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgam9pbkJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBqb2luQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiBtci0yIj48L2k+4LiB4Liz4Lil4Lix4LiH4LiV4Lij4Lin4LiI4Liq4Lit4LiaLi4uJzsKCiAgICB0cnkgewogICAgICAgIC8vIDEuIOC4q+C4suC4q+C5ieC4reC4h+C5gOC4geC4oeC4iOC4suC4gSBQSU4KICAgICAgICBjb25zdCBnYW1lc1JlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCk7CiAgICAgICAgLy8g4Lir4Liy4LmE4LiU4LmJ4LiX4Lix4LmJ4LiH4Lir4LmJ4Lit4LiH4LiX4Li14LmI4Lij4LitIChsb2JieSkg4LmB4Lil4Liw4Lir4LmJ4Lit4LiH4LiX4Li14LmI4LmA4Lij4Li04LmI4Lih4LmE4Lib4LmB4Lil4LmJ4LinIChxdWVzdGlvbiwgc3VtbWFyeSwgcmVzdWx0cykKICAgICAgICBjb25zdCBxID0gcXVlcnkoZ2FtZXNSZWYsIHdoZXJlKCJwaW4iLCAiPT0iLCBnYW1lUGluKSwgd2hlcmUoInN0YXR1cyIsICJpbiIsIFsibG9iYnkiLCAicXVlc3Rpb24iLCAic3VtbWFyeSIsICJyZXN1bHRzIl0pKTsKICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CgogICAgICAgIGlmIChzbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICAvLyDguJbguYnguLLguYTguKHguYjguYDguIjguK3guYPguJkgU3luYyBHYW1lIOC4peC4reC4h+C5hOC4m+C4q+C4suC5g+C4mSBUZWFtIEdhbWUgKOC5gOC4nOC4t+C5iOC4reC5gOC4guC5ieC4suC4nOC4tOC4lOC5guC4q+C4oeC4lCkKICAgICAgICAgICAgY29uc3QgdGVhbUdhbWVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9saXZlR2FtZXNgKTsgLy8gdGVhbS9saXZlIHJhY2UgdXNlcyBsaXZlR2FtZXMgY29sbGVjdGlvbgogICAgICAgICAgICBjb25zdCBxVGVhbSA9IHF1ZXJ5KHRlYW1HYW1lc1JlZiwgd2hlcmUoImdhbWVQaW4iLCAiPT0iLCBnYW1lUGluKSk7CiAgICAgICAgICAgIGNvbnN0IHNuYXBUZWFtID0gYXdhaXQgZ2V0RG9jcyhxVGVhbSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXNuYXBUZWFtLmVtcHR5KSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguYDguIjguK3guYPguJkgVGVhbSBNb2RlIOC5g+C4q+C5ieC5hOC4m+C5g+C4iuC5iSBMb2dpYyDguYDguJTguLTguKEKICAgICAgICAgICAgICAgIGF3YWl0IHByb2NlZWRXaXRoVGVhbVF1aXpKb2luKHNuYXBUZWFtLmRvY3NbMF0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4Lia4Lir4LmJ4Lit4LiH4LmA4LiB4Lih4LiU4LmJ4Lin4Lii4Lij4Lir4Lix4Liq4LiZ4Li14LmJIOC4q+C4o+C4t+C4reC5gOC4geC4oeC4iOC4muC5hOC4m+C5geC4peC5ieC4pyIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjb25zdCBnYW1lRG9jID0gc25hcHNob3QuZG9jc1swXTsKICAgICAgICBjdXJyZW50TGl2ZUdhbWVJZCA9IGdhbWVEb2MuaWQ7CiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lRG9jLmRhdGEoKTsKCiAgICAgICAgLy8gMi4g4LmA4LiK4Li34LmI4Lit4Lih4LmC4Lii4LiH4LiC4LmJ4Lit4Lih4Li54LilIFF1aXog4LmB4Lil4LiwIFByb2plY3QKICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgICAgIGNvbnN0IHF1aXpTbmFwID0gYXdhaXQgZ2V0RG9jKHF1aXpSZWYpOwogICAgICAgIGlmIChxdWl6U25hcC5leGlzdHMoKSkgewogICAgICAgICAgICAgY3VycmVudFF1aXpEYXRhID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6OyAvLyDguYPguIrguYkgUXVpeiDguJfguLXguYjguKrguKXguLHguJrguYHguKXguYnguKfguIjguLLguIHguYPguJnguKvguYnguK3guIcKICAgICAgICB9CgogICAgICAgIC8vIDMuIFvguIjguLjguJTguJfguLXguYjguYHguIHguYnguYTguIJdIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4nOC4ueC5ieC5gOC4peC5iOC4meC4hOC4meC4meC4teC5ieC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C4q+C4o+C4t+C4reC4ouC4seC4hwogICAgICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIG5pY2tuYW1lKTsKICAgICAgICBjb25zdCBwbGF5ZXJTbmFwID0gYXdhaXQgZ2V0RG9jKHBsYXllclJlZik7CgogICAgICAgIGlmIChwbGF5ZXJTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguYDguIHguYjguLIgKFJlLWpvaW4pID09PQogICAgICAgICAgICBqb2luQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNwaW5uZXIgZmEtc3BpbiBtci0yIj48L2k+4LiB4Liz4Lil4Lix4LiH4LiB4Li54LmJ4LiE4Li34LiZ4LiC4LmJ4Lit4Lih4Li54LilLi4uJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC5geC4hOC5iOC4reC4seC4m+C5gOC4lOC4leC4quC4luC4suC4meC4sOC5gOC4m+C5h+C4mSBhY3RpdmUg4Lir4LmJ4Liy4Lih4Lij4Li14LmA4LiL4LmH4LiV4LiE4Liw4LmB4LiZ4LiZCiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhwbGF5ZXJSZWYsIHsgc3RhdHVzOiAnYWN0aXZlJyB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHNob3dNZXNzYWdlKGDguKLguLTguJnguJTguLXguJXguYnguK3guJnguKPguLHguJrguIHguKXguLHguJogJHtuaWNrbmFtZX0hIOC4guC5ieC4reC4oeC4ueC4peC4guC4reC4h+C4hOC4uOC4k+C4luC4ueC4geC4geC4ueC5ieC4hOC4t+C4meC5geC4peC5ieC4p2ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguYPguKvguKHguYggKE5ldyBKb2luKSA9PT0KICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LmA4LiB4Lih4LmA4Lij4Li04LmI4Lih4LmE4Lib4Lir4Lij4Li34Lit4Lii4Lix4LiHIOC4luC5ieC4suC5gOC4o+C4tOC5iOC4oeC5hOC4m+C5geC4peC5ieC4p+C4reC4suC4iOC4iOC4sOC4q+C5ieC4suC4oeC5gOC4guC5ieC4siDguKvguKPguLfguK3guYDguILguYnguLLguYHguJrguJogMCDguITguLDguYHguJnguJkKICAgICAgICAgICAgaWYgKGdhbWVEYXRhLnN0YXR1cyAhPT0gJ2xvYmJ5JykgewogICAgICAgICAgICAgICAgLy8gKE9wdGlvbmFsOiDguJbguYnguLLguK3guKLguLLguIHguYPguKvguYnguYDguILguYnguLLguYTguJTguYnguYHguJXguYjguYDguKPguLTguYjguKEgMCDguIHguYfguKXguJogQmxvY2sg4LiZ4Li14LmJ4LiX4Li04LmJ4LiHKQogICAgICAgICAgICAgICAgLy8g4LmB4LiV4LmI4Lib4LiB4LiV4Li04LiV4Lil4Liy4LiU4Lih4Li34LiU4LiW4LmJ4Liy4LmA4LiC4LmJ4Liy4Lih4Liy4LiX4Li14Lir4Lil4Lix4LiH4LiI4Liw4LmA4Liq4Li14Lii4LmA4Lib4Lij4Li14Lii4Lia4Lih4Liy4LiBCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGpvaW5CdG4uaW5uZXJIVE1MID0gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT7guIHguLPguKXguLHguIfguYDguILguYnguLLguKPguYjguKfguKEuLi4nOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbmV3UGxheWVyRGF0YSA9IHsKICAgICAgICAgICAgICAgIG5hbWU6IG5pY2tuYW1lLAogICAgICAgICAgICAgICAgc2NvcmU6IDAsCiAgICAgICAgICAgICAgICB0b3RhbFBvaW50czogMCwKICAgICAgICAgICAgICAgIHBvaW50c0xhc3RSb3VuZDogMCwKICAgICAgICAgICAgICAgIHBvd2VydXBzOiB7CiAgICAgICAgICAgICAgICAgICAgZmlmdHlGaWZ0eTogMCwgc2Vjb25kQ2hhbmNlOiAwLCBidXlUaW1lOiAwLCBwb2xsOiAwLAogICAgICAgICAgICAgICAgICAgIHdhZ2VyTXVsdGlwbGllcjogMCwgZm9yY2VDb25maWRlbnQ6IDAsIGN1dE9uZTogMCwgaW5zdXJhbmNlOiAwLCBzdHJhdGVneVNjYW46IDAsIGppbng6IDAsIHJldmVhbE9wdGlvbnM6IDAKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBhbnN3ZXJlZDogZmFsc2UsCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLAogICAgICAgICAgICAgICAgYW5zd2VyczogW10sCiAgICAgICAgICAgICAgICBqb2luZWRBdDogc2VydmVyVGltZXN0YW1wKCksCiAgICAgICAgICAgICAgICBpc0ppbnhlZDogZmFsc2UsCiAgICAgICAgICAgICAgICBpc0ZvcmNlZENvbmZpZGVudDogZmFsc2UsCiAgICAgICAgICAgICAgICB0aW1lQm9udXNUaGlzUXVlc3Rpb246IDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYXdhaXQgc2V0RG9jKHBsYXllclJlZiwgbmV3UGxheWVyRGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyA0LiDguJXguLHguYnguIfguITguYjguLLguJXguLHguKfguYHguJvguKMgTG9jYWwg4LmB4Lil4Liw4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54LilCiAgICAgICAgY3VycmVudFN0dWRlbnROYW1lID0gbmlja25hbWU7CiAgICAgICAgbG9jYWxUZWFtUGxheWVycyA9IFtuaWNrbmFtZV07CiAgICAgICAgCiAgICAgICAgc2hvd1ZpZXcoJ2xpdmUtZ2FtZScpOwogICAgICAgIGxpc3RlbkZvclN5bmNHYW1lVXBkYXRlcygpOwoKICAgICAgICAvLyDguYDguIHguYfguJogU2Vzc2lvbiDguYDguJ7guLfguYjguK3guIHguLHguJkgUmVmcmVzaCDguYHguKXguYnguKfguKvguKXguLjguJQKICAgICAgICBjb25zdCBnYW1lU3RhdGUgPSB7CiAgICAgICAgICAgIGdhbWVJZDogY3VycmVudExpdmVHYW1lSWQsCiAgICAgICAgICAgIG1vZGU6ICdzeW5jJywKICAgICAgICAgICAgcGxheWVyczogbG9jYWxUZWFtUGxheWVycywKICAgICAgICAgICAgdHVybkluZGV4OiAwCiAgICAgICAgfTsKICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicsIEpTT04uc3RyaW5naWZ5KGdhbWVTdGF0ZSkpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyBsaXZlIGdhbWU6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJTguYPguJnguIHguLLguKPguYDguILguYnguLLguKPguYjguKfguKE6ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0gZmluYWxseSB7CiAgICAgICAgam9pbkJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgIGlmIChqb2luQnRuLmlubmVySFRNTC5pbmNsdWRlcygnc3Bpbm5lcicpKSBqb2luQnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXNpZ24taW4tYWx0IG1yLTIiPjwvaT7guYDguILguYnguLLguKPguYjguKfguKEnOwogICAgfQp9CgogICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlTdHVkZW50TmFtZVNlbGVjdG9yKHN0dWRlbnRzLCB0b3BpYykgewogICAgICAgICAgICBjb25zdCBzdHVkZW50TmFtZVNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LW5hbWUtc2VsZWN0Jyk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXF1aXotdG9waWMnKS50ZXh0Q29udGVudCA9IGDguYHguJrguJrguJfguJTguKrguK3guJo6ICR7dG9waWN9YDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghc3R1ZGVudHMgfHwgc3R1ZGVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICBzdHVkZW50TmFtZVNlbGVjdC5pbm5lckhUTUwgPSBgPG9wdGlvbiB2YWx1ZT0iIj7guYTguKHguYjguJ7guJrguKPguLLguKLguIrguLfguYjguK3guJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguYLguJvguKPguYDguIjguITguJnguLXguYk8L29wdGlvbj5gOwogICAgICAgICAgICAgICAgc3RhcnRRdWl6QnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN0dWRlbnROYW1lU2VsZWN0LmlubmVySFRNTCA9ICc8b3B0aW9uIHZhbHVlPSIiPi0tIOC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4iuC4t+C5iOC4rSAtLTwvb3B0aW9uPic7CiAgICAgICAgICAgICAgICBzdHVkZW50cy5mb3JFYWNoKG5hbWUgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgICAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IG5hbWU7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gbmFtZTsKICAgICAgICAgICAgICAgICAgICBzdHVkZW50TmFtZVNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzdGFydFF1aXpCdG4uZGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3R1ZGVudEluaXRpYWxWaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBzdHVkZW50TmFtZVNlbGVjdGlvblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgfQoKICAgICAgICAvLyBIZWxwZXIgdG8gc2h1ZmZsZSBhcnJheXMKICAgICAgICBmdW5jdGlvbiBzaHVmZmxlQXJyYXkoYXJyYXkpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IGFycmF5Lmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICAgICAgICAgIGNvbnN0IGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTsKICAgICAgICAgICAgICAgIFthcnJheVtpXSwgYXJyYXlbal1dID0gW2FycmF5W2pdLCBhcnJheVtpXV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgkJCgkJLyoqCiAgICAgICAgICog4Liq4Lij4LmJ4Liy4LiH4Liq4Liz4LmA4LiZ4Liy4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LmB4Lil4Liw4LiX4Liz4LiB4Liy4Lij4Liq4Lil4Lix4Lia4LiC4LmJ4LitL+C4leC4seC4p+C5gOC4peC4t+C4reC4geC4leC4suC4oeC4geC4suC4o+C4leC4seC5ieC4h+C4hOC5iOC4sgogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcmlnaW5hbFF1aXpEYXRhIC0g4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaCiAgICAgICAgICogQHJldHVybnMge29iamVjdH0g4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiK4Li44LiU4LmD4Lir4Lih4LmI4LiX4Li14LmI4Lic4LmI4Liy4LiZ4LiB4Liy4Lij4Liq4Lil4Lix4Lia4LmB4Lil4LmJ4LinCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gZ2V0U2h1ZmZsZWRRdWl6KG9yaWdpbmFsUXVpekRhdGEpIHsKICAgICAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4Liq4Liz4LmA4LiZ4Liy4LiC4LmJ4Lit4Lih4Li54Lil4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4LiB4Lij4Liw4LiX4Lia4LiV4LmJ4LiZ4LiJ4Lia4Lix4LiaCiAgICAgICAgICAgIGxldCBwcm9jZXNzZWRRdWl6ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvcmlnaW5hbFF1aXpEYXRhKSk7IAogICAgICAgICAgICBjb25zdCBzaHVmZmxlU2V0dGluZyA9IHByb2Nlc3NlZFF1aXouc2V0dGluZ3M/LnNodWZmbGUgfHwgJ25vbmUnOwoKICAgICAgICAgICAgaWYgKHNodWZmbGVTZXR0aW5nID09PSAnbm9uZScpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzZWRRdWl6OyAvLyDguJbguYnguLLguYTguKHguYjguKrguKXguLHguJog4LiB4LmH4Liq4LmI4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiU4Li04Lih4LiB4Lil4Lix4Lia4LmE4Lib4LmA4Lil4LiiCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIDEuIOC4quC4peC4seC4muC4peC4s+C4lOC4seC4muC4hOC4s+C4luC4suC4oSAo4LiW4LmJ4Liy4LiV4Lix4LmJ4LiH4LiE4LmI4Liy4LmE4Lin4LmJKQogICAgICAgICAgICBpZiAoc2h1ZmZsZVNldHRpbmcgPT09ICdxdWVzdGlvbnNfb25seScgfHwgc2h1ZmZsZVNldHRpbmcgPT09ICdib3RoJykgewogICAgICAgICAgICAgICAgc2h1ZmZsZUFycmF5KHByb2Nlc3NlZFF1aXoucXVlc3Rpb25zKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gMi4g4Liq4Lil4Lix4Lia4Lil4Liz4LiU4Lix4Lia4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LmD4LiZ4LmB4LiV4LmI4Lil4Liw4LiE4Liz4LiW4Liy4LihICjguJbguYnguLLguJXguLHguYnguIfguITguYjguLLguYTguKfguYkpCiAgICAgICAgICAgIGlmIChzaHVmZmxlU2V0dGluZyA9PT0gJ2Nob2ljZXNfb25seScgfHwgc2h1ZmZsZVNldHRpbmcgPT09ICdib3RoJykgewogICAgICAgICAgICAgICAgcHJvY2Vzc2VkUXVpei5xdWVzdGlvbnMuZm9yRWFjaChxID0+IHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBwcm9jZXNzZWRRdWl6LnF1aXpUeXBlOwogICAgICAgICAgICAgICAgICAgIC8vIOC4quC4peC4seC4muC4leC4seC4p+C5gOC4peC4t+C4reC4geC4quC4s+C4q+C4o+C4seC4miBNdWx0aXBsZSBDaG9pY2UKICAgICAgICAgICAgICAgICAgICBpZiAocS5vcHRpb25zKSB7IAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgb3B0aW9uc1RvU2h1ZmZsZSA9IHEub3B0aW9ucy5tYXAoKG9wdCwgaW5kZXgpID0+ICh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBvcHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3Q6IGluZGV4ID09PSBxLmNvcnJlY3RBbnN3ZXJJbmRleAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNodWZmbGVBcnJheShvcHRpb25zVG9TaHVmZmxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Lit4Lix4Lib4LmA4LiU4LiVIG9wdGlvbnMg4LmB4Lil4LiwIGNvcnJlY3RBbnN3ZXJJbmRleCDguYPguKvguKHguYjguJXguLLguKHguKXguLPguJTguLHguJrguJfguLXguYjguKrguKXguLHguJrguYHguKXguYnguKcKICAgICAgICAgICAgICAgICAgICAgICAgcS5vcHRpb25zID0gb3B0aW9uc1RvU2h1ZmZsZS5tYXAob3B0ID0+IG9wdC50ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgcS5jb3JyZWN0QW5zd2VySW5kZXggPSBvcHRpb25zVG9TaHVmZmxlLmZpbmRJbmRleChvcHQgPT4gb3B0LmlzQ29ycmVjdCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIOC4quC4peC4seC4muC4leC4seC4p+C5gOC4peC4t+C4reC4geC4quC4s+C4q+C4o+C4seC4miBNYXRjaGluZwogICAgICAgICAgICAgICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJyAmJiBxLmFsbFJlc3BvbnNlcykgewogICAgICAgICAgICAgICAgICAgICAgICBzaHVmZmxlQXJyYXkocS5hbGxSZXNwb25zZXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gcHJvY2Vzc2VkUXVpejsKICAgICAgICB9CgpmdW5jdGlvbiBkaXNwbGF5UXVpekZvclN0dWRlbnQocXVpekRhdGEpIHsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIGN1cnJlbnREaXNwbGF5ZWRRdWl6ID0gZ2V0U2h1ZmZsZWRRdWl6KHF1aXpEYXRhKTsKCiAgICAvLyAtLS0gWyDguYDguKPguLTguYjguKHguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgXSAtLS0KICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4geC5iOC4reC4meC4p+C5iOC4suC5hOC4oeC5iOC5g+C4iuC5iOC5guC4q+C4oeC4lOC4l+C4lOC4quC4reC4muC4guC4reC4hyBBZG1pbgogICAgaWYgKGN1cnJlbnRNb2RlICE9PSAnYWRtaW4tdGVzdGluZycpIHsKICAgICAgICAvLyDguJbguYnguLLguYTguKHguYjguYPguIrguYLguKvguKHguJTguJfguJTguKrguK3guJog4LmD4Lir4LmJ4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZ4Lif4Li14LmA4LiI4Lit4Lij4LmM4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICAgICAgcmVxdWVzdFdha2VMb2NrKCk7IC8vIOC4m+C5ieC4reC4h+C4geC4seC4meC4iOC4reC4lOC4seC4mgoKICAgICAgICBpc1F1aXpBY3RpdmUgPSB0cnVlOwogICAgICAgIGNoZWF0QXR0ZW1wdHMgPSAwOwogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7CiAgICAgICAgZW50ZXJGdWxsc2NyZWVuKCk7IC8vIOC5gOC4guC5ieC4suC5guC4q+C4oeC4lOC5gOC4leC5h+C4oeC4iOC4rQoKICAgICAgICAvLyDguYDguKPguLTguYjguKHguJXguYnguJnguIHguLLguKPguIjguLHguJrguYDguKfguKXguLLguKrguLPguKvguKPguLHguJrguKvguKPguLXguYjguYHguKrguIcKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgcmVzZXREaW1UaW1lcik7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHJlc2V0RGltVGltZXIpOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgcmVzZXREaW1UaW1lcik7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCByZXNldERpbVRpbWVyKTsKICAgICAgICByZXNldERpbVRpbWVyKCk7IC8vIOC5gOC4o+C4tOC5iOC4oeC4meC4seC4muC4hOC4o+C4seC5ieC4h+C5geC4o+C4gQogICAgfQogICAgLy8gLS0tIFsg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCgogICAgY29uc3QgdGltZXJNb2RlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnRpbWVyTW9kZSB8fCAnbm9uZSc7CiAgICBpZiAodGltZXJNb2RlID09PSAnd2hvbGVfcXVpeicpIHsKICAgICAgICByZW5kZXJGdWxsUXVpekZvcm0oKTsKICAgICAgICBzdGFydFdob2xlUXVpelRpbWVyKGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzLnRpbWVyRHVyYXRpb24pOwogICAgfSBlbHNlIGlmICh0aW1lck1vZGUgPT09ICdwZXJfcXVlc3Rpb24nKSB7CiAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXggPSAwOwogICAgICAgIHN0dWRlbnRBbnN3ZXJzUGVyUXVlc3Rpb24gPSBbXTsKICAgICAgICByZW5kZXJQZXJRdWVzdGlvblZpZXcoKTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVuZGVyRnVsbFF1aXpGb3JtKCk7CiAgICB9Cn0KCndpbmRvdy50b2dnbGVNYXRoRHJvcGRvd24gPSBmdW5jdGlvbihpbmRleCkgewogICAgY29uc3QgbGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBkcm9wZG93bi1saXN0LSR7aW5kZXh9YCk7CiAgICBjb25zdCBhbGxMaXN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tpZF49ImRyb3Bkb3duLWxpc3QtIl0nKTsKICAgIAogICAgLy8g4Lib4Li04LiUIERyb3Bkb3duIOC4reC4t+C5iOC4meC5hiDguIHguYjguK3guJkKICAgIGFsbExpc3RzLmZvckVhY2goZWwgPT4gewogICAgICAgIGlmIChlbC5pZCAhPT0gYGRyb3Bkb3duLWxpc3QtJHtpbmRleH1gKSBlbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pOwoKICAgIC8vIOC4quC4peC4seC4muC5gOC4m+C4tOC4lC/guJvguLTguJQg4Lit4Lix4LiZ4LiX4Li14LmI4LiE4Lil4Li04LiBCiAgICBpZiAobGlzdCkgbGlzdC5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsKfTsKCndpbmRvdy5zZWxlY3RNYXRoT3B0aW9uID0gZnVuY3Rpb24ocUluZGV4LCBvcHRJbmRleCkgewogICAgY29uc3QgcXVpeiA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6OwogICAgaWYgKCFxdWl6KSByZXR1cm47CgogICAgY29uc3QgcXVlc3Rpb24gPSBxdWl6LnF1ZXN0aW9uc1txSW5kZXhdOwogICAgY29uc3Qgc2VsZWN0ZWRWYWx1ZSA9IHF1ZXN0aW9uLmFsbFJlc3BvbnNlc1tvcHRJbmRleF07CgogICAgLy8gMS4g4Lit4Lix4Lib4LmA4LiU4LiV4LiE4LmI4Liy4Lil4LiH4LmD4LiZIEhpZGRlbiBJbnB1dCAo4LmA4Lie4Li34LmI4Lit4Liq4LmI4LiH4Lif4Lit4Lij4LmM4LihKQogICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgaW5wdXQtJHtxSW5kZXh9YCk7CiAgICBpZiAoaW5wdXQpIGlucHV0LnZhbHVlID0gc2VsZWN0ZWRWYWx1ZTsKCiAgICAvLyAyLiDguK3guLHguJvguYDguJTguJXguILguYnguK3guITguKfguLLguKHguJrguJnguJvguLjguYjguKEg4LmB4Lil4Liw4Liq4Lix4LmI4LiHIFJlbmRlciBNYXRoSmF4CiAgICBjb25zdCBkaXNwbGF5QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHNlbGVjdGVkLXRleHQtJHtxSW5kZXh9YCk7CiAgICBpZiAoZGlzcGxheUJ0bikgewogICAgICAgIGRpc3BsYXlCdG4uaW5uZXJIVE1MID0gc2VsZWN0ZWRWYWx1ZTsgLy8g4LmD4Liq4LmI4Liq4Li54LiV4Lij4Lil4LiH4LmE4LibCiAgICAgICAgaWYgKHdpbmRvdy5NYXRoSmF4KSBNYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtkaXNwbGF5QnRuXSk7IC8vIOC5geC4m+C4peC4h+C4quC4ueC4leC4o+C4l+C4seC4meC4l+C4tQogICAgICAgIGRpc3BsYXlCdG4uY2xhc3NMaXN0LmFkZCgndGV4dC1pbmRpZ28tNzAwJywgJ2ZvbnQtYm9sZCcpOyAvLyDguYDguJvguKXguLXguYjguKLguJnguKrguLXguYPguKvguYnguKPguLnguYnguKfguYjguLLguYDguKXguLfguK3guIHguYHguKXguYnguKcKICAgIH0KCiAgICAvLyAzLiDguJvguLTguJQgRHJvcGRvd24KICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZHJvcGRvd24tbGlzdC0ke3FJbmRleH1gKTsKICAgIGlmIChsaXN0KSBsaXN0LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwp9OwoKLy8g4Lib4Li04LiUIERyb3Bkb3duIOC5gOC4oeC4t+C5iOC4reC4hOC4peC4tOC4geC4l+C4teC5iOC4reC4t+C5iOC4mQpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoJy5jdXN0b20tbWF0aC1kcm9wZG93bicpKSB7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2lkXj0iZHJvcGRvd24tbGlzdC0iXScpLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogICAgfQp9KTsKICAgICAgICAKZnVuY3Rpb24gcmVuZGVyRnVsbFF1aXpGb3JtKCkgewogICAgY29uc3QgY29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID09PSB0cnVlOwogICAgY29uc3QgY29uZmlkZW5jZU1vZGUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uY29uZmlkZW5jZU1vZGUgfHwgJ2NoZWNrYm94JzsKICAgIAogICAgLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiK4LmH4LiE4Lin4LmI4Liy4LmB4Liq4LiU4LiH4Lir4Lix4Lin4LiC4LmJ4LitICLguIjguLHguJrguITguLnguYgiIOC5hOC4m+C4q+C4o+C4t+C4reC4ouC4seC4hwogICAgbGV0IGhhc1Nob3duTWF0Y2hpbmdIZWFkZXIgPSBmYWxzZTsKCiAgICBsZXQgaHRtbCA9IGAKICAgICAgICAgPGRpdiBpZD0idGltZXItY29udGFpbmVyIiBjbGFzcz0ibWItNCI+PC9kaXY+CiAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi00Ij4KICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJvbGQiPuC5geC4muC4muC4l+C4lOC4quC4reC4mjogJHtjdXJyZW50RGlzcGxheWVkUXVpei50b3BpY308L2gzPgogICAgICAgICAgICAgJHtjdXJyZW50TW9kZSA9PT0gJ2FkbWluLXRlc3RpbmcnID8gJzxidXR0b24gaWQ9ImNhbmNlbC10ZXN0LWJ0biIgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LXJlZC02MDAgZm9udC1zZW1pYm9sZCBweS0xIHB4LTIgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtNTAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTEiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LiX4LiU4Liq4Lit4LiaPC9idXR0b24+JyA6ICcnfQogICAgICAgICA8L2Rpdj4KICAgICAgICAgPGZvcm0gaWQ9InF1aXotZm9ybSI+CiAgICBgOwogICAgCiAgICBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMuZm9yRWFjaCgocSwgcXVlc3Rpb25JbmRleCkgPT4gewogICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1aXpUeXBlOwogICAgICAgIGNvbnN0IHpJbmRleFN0eWxlID0gYHotaW5kZXg6ICR7MTAwIC0gcXVlc3Rpb25JbmRleH07YDsKICAgICAgICAKICAgICAgICAvLyAtLS0gW+C4quC5iOC4p+C4meC4l+C4teC5iCAxXSDguYHguKrguJTguIfguKvguLHguKfguILguYnguK3guYPguKvguI3guYggIuC4iOC4seC4muC4hOC4ueC5iC4uLiIg4LmB4LiE4LmI4LiE4Lij4Lix4LmJ4LiH4LmA4LiU4Li14Lii4LinIC0tLQogICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJyAmJiAhaGFzU2hvd25NYXRjaGluZ0hlYWRlcikgewogICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYi02IHAtNCBiZy1pbmRpZ28tNTAgYm9yZGVyLWwtNCBib3JkZXItaW5kaWdvLTUwMCB0ZXh0LWluZGlnby05MDAgcm91bmRlZC1yLWxnIHNoYWRvdy1zbSI+CiAgICAgICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJ0ZXh0LWxnIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjaGFuZ2UtYWx0IG1yLTMiPjwvaT4g4LiE4Liz4LiK4Li14LmJ4LmB4LiI4LiHOiDguIjguLHguJrguITguLnguYjguILguYnguK3guITguKfguLLguKHguJXguYjguK3guYTguJvguJnguLXguYnguYPguKvguYnguJbguLnguIHguJXguYnguK3guIcKICAgICAgICAgICAgICAgICAgICA8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgICAgIGhhc1Nob3duTWF0Y2hpbmdIZWFkZXIgPSB0cnVlOyAvLyDguJvguLHguIHguJjguIfguKfguYjguLLguYHguKrguJTguIfguYHguKXguYnguKcKICAgICAgICB9CiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ibWItNiBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS01MCByZWxhdGl2ZSIgc3R5bGU9IiR7ekluZGV4U3R5bGV9Ij5gOwoKICAgICAgICAvLyAtLS0gW+C4quC5iOC4p+C4meC4l+C4teC5iCAyXSDguKrguYjguKfguJnguKvguLHguKfguILguYnguK3guITguLPguJbguLLguKEgKOC4luC5ieC4suC5hOC4oeC5iOC5g+C4iuC5iCBNYXRjaGluZyDguYPguKvguYnguYHguKrguJTguIfguJvguIHguJXguLQpIC0tLQogICAgICAgIGlmIChxdWVzdGlvblR5cGUgIT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvbnQtc2VtaWJvbGQgbWItMyI+CiAgICAgICAgICAgICAgICAgICAgPHA+JHtxdWVzdGlvbkluZGV4ICsgMX0uICR7cS5pbnN0cnVjdGlvbnMgfHwgcS5xdWVzdGlvblRleHR9PC9wPgogICAgICAgICAgICAgICAgICAgICR7cS5pbWFnZUNvZGUgPyBgPGRpdiBjbGFzcz0ibXktNCBmbGV4IGp1c3RpZnktY2VudGVyIj4ke3EuaW1hZ2VDb2RlfTwvZGl2PmAgOiAnJ30KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgICAgCiAgICAgICAgaHRtbCArPSBgPGRpdiBjbGFzcz0ic3BhY2UteS0yIj5gOwogICAgICAgIAogICAgICAgIC8vIDEuIE1hdGNoaW5nIChDdXN0b20gRHJvcGRvd24pCiAgICAgICAgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nICYmIHEuYWxsUmVzcG9uc2VzKSB7CiAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgc206aXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgc206dy0xLzIgcC0zIGJnLWJsdWUtNTAgcm91bmRlZCBib3JkZXIgYm9yZGVyLWJsdWUtMTAwIGZvbnQtc2VtaWJvbGQgdGV4dC1ibHVlLTgwMCBmbGV4IGl0ZW1zLXN0YXJ0IGdhcC0zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWluZGlnby02MDAgdGV4dC1sZyBtdC1bLTJweF0iPiR7cXVlc3Rpb25JbmRleCArIDF9Ljwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImxlYWRpbmctc251ZyI+JHtxLnN0ZW19PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgc206dy0xLzIgcmVsYXRpdmUgY3VzdG9tLW1hdGgtZHJvcGRvd24iPgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBuYW1lPSJxdWVzdGlvbiR7cXVlc3Rpb25JbmRleH0iIGlkPSJpbnB1dC0ke3F1ZXN0aW9uSW5kZXh9IiByZXF1aXJlZD4KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzcz0idy1mdWxsIHAtMyBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgYmctd2hpdGUgdGV4dC1sZWZ0IGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBob3Zlcjpib3JkZXItaW5kaWdvLTUwMCBmb2N1czpyaW5nLTIgZm9jdXM6cmluZy1pbmRpZ28tMjAwIHRyYW5zaXRpb24tYWxsIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s9IndpbmRvdy50b2dnbGVNYXRoRHJvcGRvd24oJHtxdWVzdGlvbkluZGV4fSkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9InNlbGVjdGVkLXRleHQtJHtxdWVzdGlvbkluZGV4fSIgY2xhc3M9InRydW5jYXRlIHRleHQtZ3JheS01MDAiPi0tIOC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4miAtLTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIHRleHQtZ3JheS00MDAgdGV4dC1zbSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9ImRyb3Bkb3duLWxpc3QtJHtxdWVzdGlvbkluZGV4fSIgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImhpZGRlbiBhYnNvbHV0ZSB0b3AtZnVsbCBsZWZ0LTAgdy1mdWxsIG10LTEgYmctd2hpdGUgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIHNoYWRvdy14bCBtYXgtaC02MCBvdmVyZmxvdy15LWF1dG8gei01MCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke3EuYWxsUmVzcG9uc2VzLm1hcCgocmVzcCwgb3B0SW5kZXgpID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgYm9yZGVyLWdyYXktMTAwIGhvdmVyOmJnLWluZGlnby01MCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uLWNvbG9ycyB0ZXh0LXNtIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljaz0id2luZG93LnNlbGVjdE1hdGhPcHRpb24oJHtxdWVzdGlvbkluZGV4fSwgJHtvcHRJbmRleH0pIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtyZXNwfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgCiAgICAgICAgLy8gMi4gVHJ1ZS9GYWxzZQogICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgaHRtbCArPSBgPGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJxJHtxdWVzdGlvbkluZGV4fV9vcHQwIiBuYW1lPSJxdWVzdGlvbiR7cXVlc3Rpb25JbmRleH0iIHZhbHVlPSJ0cnVlIiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icSR7cXVlc3Rpb25JbmRleH1fb3B0MCI+4LmD4LiK4LmIPC9sYWJlbD48L2Rpdj5gOwogICAgICAgICAgICBodG1sICs9IGA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InEke3F1ZXN0aW9uSW5kZXh9X29wdDEiIG5hbWU9InF1ZXN0aW9uJHtxdWVzdGlvbkluZGV4fSIgdmFsdWU9ImZhbHNlIiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icSR7cXVlc3Rpb25JbmRleH1fb3B0MSI+4LmE4Lih4LmI4LmD4LiK4LmIPC9sYWJlbD48L2Rpdj5gOwoKICAgICAgICAvLyAzLiBNdWx0aXBsZSBDaG9pY2UKICAgICAgICB9IGVsc2UgaWYgKHEub3B0aW9ucyAmJiBBcnJheS5pc0FycmF5KHEub3B0aW9ucykgJiYgcS5vcHRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgaHRtbCArPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0icSR7cXVlc3Rpb25JbmRleH1fb3B0JHtpfSIgbmFtZT0icXVlc3Rpb24ke3F1ZXN0aW9uSW5kZXh9IiB2YWx1ZT0iJHtpfSIgY2xhc3M9Im1yLTIgYWNjZW50LWluZGlnby02MDAiIHJlcXVpcmVkPgogICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InEke3F1ZXN0aW9uSW5kZXh9X29wdCR7aX0iPiR7b3B0fTwvbGFiZWw+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYCkuam9pbignJyk7CiAgICAgICAgICAgIAogICAgICAgIC8vIDQuIFNob3J0IEFuc3dlcgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGh0bWwgKz0gYDx0ZXh0YXJlYSBuYW1lPSJxdWVzdGlvbiR7cXVlc3Rpb25JbmRleH0iIGNsYXNzPSJ3LWZ1bGwgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyIgcm93cz0iMyIgcmVxdWlyZWQgcGxhY2Vob2xkZXI9IuC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4muC4guC4reC4h+C4hOC4uOC4ky4uLiI+PC90ZXh0YXJlYT5gOwogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKCiAgICAgICAgaWYgKGNvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCkgewogICAgICAgICAgICBodG1sICs9IGA8ZGl2IGNsYXNzPSJtdC00IHB0LTMgYm9yZGVyLXQgYm9yZGVyLWdyYXktMjAwIj5gOwogICAgICAgICAgICBpZiAoY29uZmlkZW5jZU1vZGUgPT09ICdtYW5kYXRvcnknKSB7CiAgICAgICAgICAgICAgICBodG1sICs9IGAKICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktNzAwIG1iLTIiPuC4hOC4uOC4k+C4oeC4seC5iOC4meC5g+C4iOC5g+C4meC4hOC4s+C4leC4reC4muC4guC5ieC4reC4meC4teC5ieC5geC4hOC5iOC5hOC4q+C4mT86PC9wPgogICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSJjb25maWRlbmNlLWlucHV0LSR7cXVlc3Rpb25JbmRleH0iIG5hbWU9ImNvbmZpZGVuY2Uke3F1ZXN0aW9uSW5kZXh9IiB2YWx1ZT0iIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJmbGV4LTEgcHktMiBweC00IHJvdW5kZWQtbWQgdGV4dC1zbSBmb250LXNlbWlib2xkIGNvbmZpZGVuY2UtY2hvaWNlLWJ0biBjb25maWRlbnQiIGRhdGEtcXVlc3Rpb24taW5kZXg9IiR7cXVlc3Rpb25JbmRleH0iIGRhdGEtdmFsdWU9ImNvbmZpZGVudCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFyIGZhLXNtaWxlLWJlYW0gbXItMiI+PC9pPuC4oeC4seC5iOC4meC5g+C4iAogICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGNsYXNzPSJmbGV4LTEgcHktMiBweC00IHJvdW5kZWQtbWQgdGV4dC1zbSBmb250LXNlbWlib2xkIGNvbmZpZGVuY2UtY2hvaWNlLWJ0biBub3QtY29uZmlkZW50IiBkYXRhLXF1ZXN0aW9uLWluZGV4PSIke3F1ZXN0aW9uSW5kZXh9IiBkYXRhLXZhbHVlPSJub3RfY29uZmlkZW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXIgZmEtbWVoIG1yLTIiPjwvaT7guYTguKHguYjguKHguLHguYjguJnguYPguIgKICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iY29uZmlkZW5jZSR7cXVlc3Rpb25JbmRleH0iIG5hbWU9ImNvbmZpZGVuY2Uke3F1ZXN0aW9uSW5kZXh9IiBjbGFzcz0iaC00IHctNCByb3VuZGVkIGJvcmRlci1ncmF5LTMwMCB0ZXh0LWluZGlnby02MDAgZm9jdXM6cmluZy1pbmRpZ28tNTAwIj4KICAgICAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJjb25maWRlbmNlJHtxdWVzdGlvbkluZGV4fSIgY2xhc3M9Im1sLTIgdGV4dC1zbSBmb250LW1lZGl1bSB0ZXh0LWdyYXktNzAwIGN1cnNvci1wb2ludGVyIj7guInguLHguJnguKHguLHguYjguJnguYPguIjguYPguJnguITguLPguJXguK3guJrguILguYnguK3guJnguLXguYk8L2xhYmVsPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfQogICAgICAgICAgICBodG1sICs9IGA8L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgaHRtbCArPSBgPC9kaXY+YDsKICAgIH0pOwogICAgCiAgICBodG1sICs9IGA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9InctZnVsbCBtdC00IGJnLXB1cnBsZS02MDAgdGV4dC13aGl0ZSBweS0zIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLXB1cnBsZS03MDAiPgogICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIiPjwvaT7guKrguYjguIfguITguLPguJXguK3guJoKICAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7CiAgICBodG1sICs9IGA8L2Zvcm0+YDsKICAgIHN0dWRlbnRRdWl6QXJlYS5pbm5lckhUTUwgPSBodG1sOwogICAgCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIGNvbnN0IGNhbmNlbEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtdGVzdC1idG4nKTsKICAgICAgICBpZihjYW5jZWxCdG4pIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNhbmNlbEFkbWluVGVzdCk7CiAgICB9CgogICAgY29uc3QgcXVpekZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpei1mb3JtJyk7CiAgICBpZiAocXVpekZvcm0pIHsKICAgICAgICBxdWl6Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVTdWJtaXRRdWl6KTsKICAgICAgICBxdWl6Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbmZpZGVuY2UtY2hvaWNlLWJ0bicpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBidG4gPSBlLnRhcmdldDsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gYnRuLmRhdGFzZXQucXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYnRuLmRhdGFzZXQudmFsdWU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgY29uZmlkZW5jZS1pbnB1dC0ke2luZGV4fWApLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSBidG4ucGFyZW50RWxlbWVudDsKICAgICAgICAgICAgICAgIHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29uZmlkZW5jZS1jaG9pY2UtYnRuJykuZm9yRWFjaChiID0+IGIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJykpOwogICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHdpbmRvdy5NYXRoSmF4LnR5cGVzZXRQcm9taXNlKFtzdHVkZW50UXVpekFyZWFdKTsKICAgICAgICB9LCA1MCk7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdFF1aXooZXZlbnQpIHsKICAgIGlmKGV2ZW50KSBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgaWYocXVpelRpbWVySW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwocXVpelRpbWVySW50ZXJ2YWwpOwogICAgCiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotZm9ybScpOwogICAgaWYgKCFmb3JtKSByZXR1cm47CiAgICAKICAgIC8vIC0tLSBMb2dpYyDguYPguKvguKHguYg6IOC4leC4o+C4p+C4iOC4quC4reC4muC4geC5iOC4reC4meC4quC5iOC4hyAtLS0KICAgIGNvbnN0IGNvbmZpZGVuY2VFbmFibGVkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID09PSB0cnVlOwogICAgY29uc3QgY29uZmlkZW5jZU1vZGUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uY29uZmlkZW5jZU1vZGUgfHwgJ2NoZWNrYm94JzsKCiAgICBpZiAoY29uZmlkZW5jZUVuYWJsZWQgJiYgY29uZmlkZW5jZU1vZGUgPT09ICdtYW5kYXRvcnknKSB7CiAgICAgICAgbGV0IGFsbENvbmZpZGVuY2VTZWxlY3RlZCA9IHRydWU7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY29uZmlkZW5jZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAjY29uZmlkZW5jZS1pbnB1dC0ke2l9YCk7CiAgICAgICAgICAgIGlmICghY29uZmlkZW5jZUlucHV0IHx8IGNvbmZpZGVuY2VJbnB1dC52YWx1ZSA9PT0gJycpIHsKICAgICAgICAgICAgICAgIGFsbENvbmZpZGVuY2VTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFhbGxDb25maWRlbmNlU2VsZWN0ZWQpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4o+C4sOC4lOC4seC4muC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iOC5g+C4q+C5ieC4hOC4o+C4muC4l+C4uOC4geC4guC5ieC4reC4geC5iOC4reC4meC4quC5iOC4h+C4hOC4s+C4leC4reC4muC4hOC4o+C4seC4miIpOwogICAgICAgICAgICByZXR1cm47IC8vIOC4q+C4ouC4uOC4lOC4geC4suC4o+C4l+C4s+C4h+C4suC4mQogICAgICAgIH0KICAgIH0KICAgIC8vIC0tLSDguKrguLTguYnguJnguKrguLjguJQgTG9naWMg4LmD4Lir4Lih4LmIIC0tLQogICAgCiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPSJzdWJtaXQiXScpOwogICAgY29uc3QgaGFzU2hvcnRBbnN3ZXIgPSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMuc29tZShxID0+IHEucXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyk7CgogICAgaWYoc3VibWl0QnV0dG9uKSB7CiAgICAgICAgc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICBzdWJtaXRCdXR0b24uaW5uZXJIVE1MID0gaGFzU2hvcnRBbnN3ZXIgCiAgICAgICAgICAgID8gJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT5BSSDguIHguLPguKXguLHguIfguJXguKPguKfguIjguITguLPguJXguK3guJouLi4nCiAgICAgICAgICAgIDogJzxpIGNsYXNzPSJmYXMgZmEtc3Bpbm5lciBmYS1zcGluIG1yLTIiPjwvaT7guIHguLPguKXguLHguIfguKrguYjguIfguITguLPguJXguK3guJouLi4nOwogICAgfQogICAgCiAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTsKICAgIAogICAgY29uc3QgdXNlckFuc3dlcnMgPSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubWFwKChxLCBxdWVzdGlvbkluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgYW5zd2VyID0gZm9ybURhdGEuZ2V0KGBxdWVzdGlvbiR7cXVlc3Rpb25JbmRleH1gKTsKICAgICAgICAKICAgICAgICAvLyDguYHguIHguYnguYTguILguIHguLLguKPguK3guYjguLLguJnguITguYjguLIgd2FzQ29uZmlkZW50IOC5g+C4q+C5ieC4o+C4reC4h+C4o+C4seC4muC4l+C4seC5ieC4hyAyIOC5guC4q+C4oeC4lAogICAgICAgIGxldCB3YXNDb25maWRlbnQ7CiAgICAgICAgaWYgKGNvbmZpZGVuY2VNb2RlID09PSAnbWFuZGF0b3J5JykgewogICAgICAgICAgICB3YXNDb25maWRlbnQgPSBmb3JtRGF0YS5nZXQoYGNvbmZpZGVuY2Uke3F1ZXN0aW9uSW5kZXh9YCk7IC8vIOC4iOC4sOC5hOC4lOC5iSAnY29uZmlkZW50JyDguKvguKPguLfguK0gJ25vdF9jb25maWRlbnQnCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2FzQ29uZmlkZW50ID0gZm9ybURhdGEuZ2V0KGBjb25maWRlbmNlJHtxdWVzdGlvbkluZGV4fWApID09PSAnb24nOyAvLyDguIjguLDguYTguJTguYkgdHJ1ZSDguKvguKPguLfguK0gZmFsc2UKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLi4uICjguKrguYjguKfguJnguJfguLXguYjguYDguKvguKXguLfguK3guILguK3guIfguJ/guLHguIfguIHguYzguIrguLHguJnguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpIC4uLgogICAgICAgIGxldCBwYXJzZWRBbnN3ZXIgPSBudWxsOwogICAgICAgIGlmIChhbnN3ZXIgIT09IG51bGwgJiYgYW5zd2VyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1aXpUeXBlOwogICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX3RoZV9ibGFuaycpIHsKICAgICAgICAgICAgICAgIHBhcnNlZEFuc3dlciA9IHBhcnNlSW50KGFuc3dlcik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwYXJzZWRBbnN3ZXIgPSBhbnN3ZXI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgYW5zd2VyOiBwYXJzZWRBbnN3ZXIsIHdhc0NvbmZpZGVudDogd2FzQ29uZmlkZW50IH07CiAgICB9KTsKICAgIAogICAgY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwogICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2AsIGN1cnJlbnRTdHVkZW50TmFtZSk7CiAgICBjb25zdCBzdWJtaXNzaW9uU25hcCA9IGF3YWl0IGdldERvYyhzdWJtaXNzaW9uUmVmKTsKICAgIGNvbnN0IGV4aXN0aW5nRGF0YSA9IHN1Ym1pc3Npb25TbmFwLmV4aXN0cygpID8gc3VibWlzc2lvblNuYXAuZGF0YSgpIDoge307CiAgICBjb25zdCBwcmV2aW91c0F0dGVtcHRzID0gZXhpc3RpbmdEYXRhLmF0dGVtcHRzIHx8IFtdOwoKICAgIGF3YWl0IHByb2Nlc3NBbmRTdWJtaXRBbnN3ZXJzKHVzZXJBbnN3ZXJzLCBwcmV2aW91c0F0dGVtcHRzKTsKfQogICAgICAgIAogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGdyYWRlU2hvcnRBbnN3ZXJXaXRoQUkodXNlckFuc3dlciwgaWRlYWxBbnN3ZXIpIHsKICAgICAgICAgICAgaWYgKCF1c2VyQW5zd2VyIHx8ICFpZGVhbEFuc3dlcikgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvbXB0ID0gYFBsZWFzZSBldmFsdWF0ZSBpZiB0aGUgdXNlcidzIGFuc3dlciBpcyBjb3JyZWN0IGJhc2VkIG9uIHRoZSBpZGVhbCBhbnN3ZXIuIFRoZSBjb250ZXh0IGlzIGEgc2ltcGxlIHF1aXosIHNvIGJlIGxlbmllbnQgd2l0aCBwaHJhc2luZyBidXQgc3RyaWN0IHdpdGggdGhlIGNvcmUgY29uY2VwdC4gVXNlciBBbnN3ZXI6ICIke3VzZXJBbnN3ZXJ9Ii4gSWRlYWwgQW5zd2VyOiAiJHtpZGVhbEFuc3dlcn0iLiBSZXNwb25kIHdpdGggb25seSAidHJ1ZSIgb3IgImZhbHNlIi5gOwogICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsgY29udGVudHM6IFt7IHJvbGU6ICJ1c2VyIiwgcGFydHM6IFt7IHRleHQ6IHByb21wdCB9XSB9XSB9OwogICAgICAgICAgICAgICAgY29uc3QgYXBpS2V5ID0gIkFJemFTeUQ0dHU2VmpuMUJoTHg0cFlYV0V0QXdhbFdDUDJJTXlGWSI7IC8vIEFQSSBrZXkgd2lsbCBiZSBwcm92aWRlZCBieSB0aGUgZW52aXJvbm1lbnQKICAgICAgICAgICAgICAgIGNvbnN0IGFwaVVybCA9IGBodHRwczovL2dlbmVyYXRpdmVsYW5ndWFnZS5nb29nbGVhcGlzLmNvbS92MWJldGEvbW9kZWxzL2dlbWluaS0yLjUtZmxhc2gtcHJldmlldy0wOS0yMDI1OmdlbmVyYXRlQ29udGVudD9rZXk9JHthcGlLZXl9YDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChhcGlVcmwsIHsgbWV0aG9kOiAnUE9TVCcsIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LCBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSB9KTsKICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcignQVBJIGNhbGwgZmFpbGVkJyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRleHRSZXNwb25zZSA9IHJlc3VsdC5jYW5kaWRhdGVzWzBdLmNvbnRlbnQucGFydHNbMF0udGV4dC50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0ZXh0UmVzcG9uc2UgPT09ICd0cnVlJzsKCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJBSSBncmFkaW5nIGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIERlZmF1bHQgdG8gaW5jb3JyZWN0IGlmIEFJIGZhaWxzCiAgICAgICAgICAgIH0KICAgICAgICB9CgoKYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0FuZFN1Ym1pdEFuc3dlcnModXNlckFuc3dlcnMsIHByZXZpb3VzQXR0ZW1wdHMpIHsKICAgIC8vIDEuIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4quC4luC4suC4meC4sOC4q+C4meC5ieC4suC4iOC4reC5geC4peC4sOC4o+C4sOC4muC4muC4m+C5ieC4reC4h+C4geC4seC4mQogICAgaWYgKHR5cGVvZiByZWxlYXNlV2FrZUxvY2sgPT09ICdmdW5jdGlvbicpIHJlbGVhc2VXYWtlTG9jaygpOwogICAgaWYgKHR5cGVvZiBzdG9wRGltVGltZXIgPT09ICdmdW5jdGlvbicpIHN0b3BEaW1UaW1lcigpOwogICAgCiAgICB0cnkgewogICAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgewogICAgICAgICAgICBhd2FpdCBkb2N1bWVudC5leGl0RnVsbHNjcmVlbigpLmNhdGNoKGUgPT4gY29uc29sZS53YXJuKCJGdWxsc2NyZWVuIGV4aXQgaWdub3JlZDoiLCBlKSk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUud2FybigiRnVsbHNjcmVlbiBleGl0IGZhaWxlZCAoc2FmZSB0byBpZ25vcmUpOiIsIGUpOwogICAgfQogICAgCiAgICBpc1F1aXpBY3RpdmUgPSBmYWxzZTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCBoYW5kbGVWaXNpYmlsaXR5Q2hhbmdlKTsKCiAgICAvLyAyLiDguYDguJXguKPguLXguKLguKHguJXguLHguKfguYHguJvguKPguKrguLPguKvguKPguLHguJrguITguLPguJnguKfguJPguITguLDguYHguJnguJkKICAgIGxldCB0b3RhbFJhd1Njb3JlID0gMDsgCiAgICBsZXQgdG90YWxNYXhTY29yZSA9IDA7IAogICAgbGV0IHRvdGFsUG9pbnRzID0gMDsgICAgCiAgICAKICAgIGNvbnN0IGRldGFpbGVkQW5zd2VycyA9IFtdOwogICAgY29uc3QgcXVlc3Rpb25zID0gY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zOwogICAgY29uc3QgdG90YWxRdWVzdGlvbnNDb3VudCA9IHF1ZXN0aW9ucy5sZW5ndGg7CiAgICAKICAgIGxldCBjb3JyZWN0U3RyZWFrID0gMDsKICAgIGxldCBlYXJuZWRCYWRnZXMgPSBbXTsKCiAgICAvLyAzLiDguYDguKPguLTguYjguKHguKfguJnguKXguLnguJvguJXguKPguKfguIjguITguLPguJXguK3guJrguJfguLXguKXguLDguILguYnguK0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVlc3Rpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgcSA9IHF1ZXN0aW9uc1tpXTsKICAgICAgICBjb25zdCB1c2VyQW5zd2VyRGF0YSA9IHVzZXJBbnN3ZXJzW2ldOwogICAgICAgIGNvbnN0IHVzZXJBbnN3ZXIgPSB1c2VyQW5zd2VyRGF0YSA/IHVzZXJBbnN3ZXJEYXRhLmFuc3dlciA6IG51bGw7CiAgICAgICAgY29uc3Qgd2FzQ29uZmlkZW50ID0gdXNlckFuc3dlckRhdGEgPyB1c2VyQW5zd2VyRGF0YS53YXNDb25maWRlbnQgOiBudWxsOwogICAgICAgIAogICAgICAgIGNvbnN0IHFUeXBlID0gcS5xdWVzdGlvblR5cGUgfHwgY3VycmVudERpc3BsYXllZFF1aXoucXVpelR5cGU7CiAgICAgICAgY29uc3Qgd2VpZ2h0ID0gKHR5cGVvZiBnZXRRdWVzdGlvbldlaWdodCA9PT0gJ2Z1bmN0aW9uJykgPyBnZXRRdWVzdGlvbldlaWdodChjdXJyZW50RGlzcGxheWVkUXVpeiwgcVR5cGUpIDogMTsKICAgICAgICAKICAgICAgICB0b3RhbE1heFNjb3JlICs9IHdlaWdodDsgCgogICAgICAgIGxldCBpc0NvcnJlY3QgPSBmYWxzZTsKICAgICAgICAKICAgICAgICBpZiAocVR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHFUeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgICAgICBjb25zdCBjbGVhblVzZXIgPSBTdHJpbmcodXNlckFuc3dlciB8fCAnJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGNvbnN0IGNsZWFuSWRlYWwgPSBTdHJpbmcocS5pZGVhbEFuc3dlciB8fCAnJykudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGlzQ29ycmVjdCA9IChjbGVhblVzZXIgPT09IGNsZWFuSWRlYWwpOyAKICAgICAgICB9IGVsc2UgaWYgKHFUeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgY29uc3QgY29ycmVjdEJvb2wgPSAocS5jb3JyZWN0QW5zd2VyID09PSB0cnVlIHx8IFN0cmluZyhxLmNvcnJlY3RBbnN3ZXIpLnRvTG93ZXJDYXNlKCkgPT09ICd0cnVlJyk7CiAgICAgICAgICAgIGNvbnN0IHVzZXJCb29sID0gKHVzZXJBbnN3ZXIgPT09ICd0cnVlJyB8fCB1c2VyQW5zd2VyID09PSB0cnVlKTsKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKHVzZXJCb29sID09PSBjb3JyZWN0Qm9vbCk7CiAgICAgICAgfSBlbHNlIGlmIChxVHlwZSA9PT0gJ21hdGNoaW5nX2l0ZW0nKSB7CiAgICAgICAgICAgIGlzQ29ycmVjdCA9ICh1c2VyQW5zd2VyID09PSBxLmNvcnJlY3RSZXNwb25zZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKHBhcnNlSW50KHVzZXJBbnN3ZXIpID09PSBxLmNvcnJlY3RBbnN3ZXJJbmRleCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByYXdTY29yZUZvclF1ZXN0aW9uID0gaXNDb3JyZWN0ID8gd2VpZ2h0IDogMDsKICAgICAgICB0b3RhbFJhd1Njb3JlICs9IHJhd1Njb3JlRm9yUXVlc3Rpb247CgogICAgICAgIGxldCBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSAwOwogICAgICAgIGlmIChjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQpIHsKICAgICAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gKHdhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCB3YXNDb25maWRlbnQgPT09ICdjb25maWRlbnQnKSA/IHdlaWdodCAqIDIgOiB3ZWlnaHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSAod2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IHdhc0NvbmZpZGVudCA9PT0gJ2NvbmZpZGVudCcpID8gLXdlaWdodCA6IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSByYXdTY29yZUZvclF1ZXN0aW9uOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB0b3RhbFBvaW50cyArPSBwb2ludHNGb3JUaGlzUXVlc3Rpb247CgogICAgICAgIGlmIChpc0NvcnJlY3QpIHsKICAgICAgICAgICAgY29ycmVjdFN0cmVhaysrOwogICAgICAgICAgICBpZiAoY29ycmVjdFN0cmVhayA9PT0gMykgZWFybmVkQmFkZ2VzLnB1c2goQkFER0VTLk9OX0ZJUkUuaWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvcnJlY3RTdHJlYWsgPSAwOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBsZXQgYW5zd2VyVGV4dCA9IG51bGw7CiAgICAgICAgaWYgKHEub3B0aW9ucyAmJiAocVR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnIHx8IHFUeXBlID09PSAnZmlsbF9pbl93aXRoX2Nob2ljZXMnKSAmJiB1c2VyQW5zd2VyICE9PSBudWxsKSB7CiAgICAgICAgICAgIGFuc3dlclRleHQgPSBxLm9wdGlvbnNbdXNlckFuc3dlcl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYW5zd2VyVGV4dCA9IHVzZXJBbnN3ZXI7CiAgICAgICAgfQoKICAgICAgICBkZXRhaWxlZEFuc3dlcnMucHVzaCh7CiAgICAgICAgICAgIHF1ZXN0aW9uSWQ6IHEuaWQsCiAgICAgICAgICAgIGFuc3dlcjogdXNlckFuc3dlciwgCiAgICAgICAgICAgIGFuc3dlclRleHQ6IGFuc3dlclRleHQsIAogICAgICAgICAgICBpc0NvcnJlY3Q6IGlzQ29ycmVjdCwKICAgICAgICAgICAgd2FzQ29uZmlkZW50OiB3YXNDb25maWRlbnQsCiAgICAgICAgICAgIHBvaW50c0F3YXJkZWQ6IHBvaW50c0ZvclRoaXNRdWVzdGlvbiwKICAgICAgICAgICAgb3JpZ2luYWxRdWVzdGlvblRleHQ6IHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dCwKICAgICAgICAgICAgb3JpZ2luYWxJbmRleDogaSAKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyA0LiDguITguLPguJnguKfguJPguYDguKvguKPguLXguKLguI3guKPguLLguIfguKfguLHguKXguYHguKXguLDguKrguJbguLTguJXguLQKICAgIGNvbnN0IHVzZXJEZWZpbmVkUGFzc2luZ1Njb3JlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnBhc3NpbmdTY29yZTsKICAgIGNvbnN0IHBhc3NpbmdUaHJlc2hvbGQgPSAodXNlckRlZmluZWRQYXNzaW5nU2NvcmUgIT09IHVuZGVmaW5lZCAmJiB1c2VyRGVmaW5lZFBhc3NpbmdTY29yZSAhPT0gbnVsbCkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHVzZXJEZWZpbmVkUGFzc2luZ1Njb3JlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgOiAodG90YWxNYXhTY29yZSAvIDIpOwogICAgCiAgICBpZiAodG90YWxSYXdTY29yZSA9PT0gdG90YWxNYXhTY29yZSAmJiB0b3RhbE1heFNjb3JlID4gMCAmJiAhY3VycmVudERpc3BsYXllZFF1aXouaXNSZW1lZGlhbCkgewogICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5QRVJGRUNUX1NDT1JFLmlkKTsKICAgIH0KICAgIAogICAgY29uc3QgdGltZXJNb2RlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnRpbWVyTW9kZTsKICAgIGlmICh0aW1lck1vZGUgPT09ICd3aG9sZV9xdWl6JyAmJiB0eXBlb2YgcXVpelN0YXJ0VGltZSAhPT0gJ3VuZGVmaW5lZCcgJiYgcXVpelN0YXJ0VGltZSkgeyAKICAgICAgICBjb25zdCB0aW1lVGFrZW4gPSAobmV3IERhdGUoKSAtIHF1aXpTdGFydFRpbWUpIC8gMTAwMDsKICAgICAgICBjb25zdCB0aW1lQWxsb3dlZCA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzLnRpbWVyRHVyYXRpb24gKiA2MDsKICAgICAgICBpZiAodG90YWxSYXdTY29yZSA+PSBwYXNzaW5nVGhyZXNob2xkICYmIHRpbWVUYWtlbiA8IHRpbWVBbGxvd2VkIC8gMikgewogICAgICAgICAgICBlYXJuZWRCYWRnZXMucHVzaChCQURHRVMuUVVJQ0tfVEhJTktFUi5pZCk7CiAgICAgICAgfQogICAgfQoKICAgIGlmIChwcmV2aW91c0F0dGVtcHRzLmxlbmd0aCA9PT0gMCAmJiB0b3RhbFJhd1Njb3JlID09PSB0b3RhbE1heFNjb3JlICYmIHRvdGFsTWF4U2NvcmUgPiAwKSB7CiAgICAgICAgZWFybmVkQmFkZ2VzLnB1c2goQkFER0VTLkZJUlNUX1RSWV9BQ0UuaWQpOwogICAgfQogICAgaWYgKHByZXZpb3VzQXR0ZW1wdHMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGZpcnN0QXR0ZW1wdFNjb3JlID0gcHJldmlvdXNBdHRlbXB0c1swXS5zY29yZTsKICAgICAgICBpZiAoZmlyc3RBdHRlbXB0U2NvcmUgPCBwYXNzaW5nVGhyZXNob2xkICYmIHRvdGFsUmF3U2NvcmUgPj0gcGFzc2luZ1RocmVzaG9sZCkgewogICAgICAgICAgICBjb25zdCBoYXNDb21lYmFja0JhZGdlID0gcHJldmlvdXNBdHRlbXB0cy5zb21lKGF0dGVtcHQgPT4gKGF0dGVtcHQuYmFkZ2VzIHx8IFtdKS5pbmNsdWRlcyhCQURHRVMuQ09NRUJBQ0tfS0lORy5pZCkpOwogICAgICAgICAgICBpZiAoIWhhc0NvbWViYWNrQmFkZ2UpIHsKICAgICAgICAgICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5DT01FQkFDS19LSU5HLmlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmIChwcmV2aW91c0F0dGVtcHRzLmxlbmd0aCA9PT0gNCkgewogICAgICAgIGVhcm5lZEJhZGdlcy5wdXNoKEJBREdFUy5QRVJTRVZFUkFOQ0UuaWQpOwogICAgfQogICAgCiAgICBjb25zdCBkaXNwbGF5U2V0dGluZyA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzLnJlc3VsdHNEaXNwbGF5OwogICAgCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIGhhbmRsZVJlc3VsdERpc3BsYXkoZGlzcGxheVNldHRpbmcsIHRvdGFsUmF3U2NvcmUsIHRvdGFsUG9pbnRzLCBlYXJuZWRCYWRnZXMsIGRldGFpbGVkQW5zd2VycywgdG90YWxNYXhTY29yZSk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIOC5gOC4leC4o+C4teC4ouC4oeC4hOC4sOC5geC4meC4meC4iOC4s+C4meC4p+C4meC4guC5ieC4reC4luC4ueC4gSAoSW50ZWdlcikKICAgIGNvbnN0IHNjb3JlQ291bnQgPSBkZXRhaWxlZEFuc3dlcnMuZmlsdGVyKGEgPT4gYS5pc0NvcnJlY3QpLmxlbmd0aDsgCiAgICBjb25zdCB0b3RhbFF1ZXN0aW9ucyA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGg7CgogICAgLy8gNS4g4Lia4Lix4LiZ4LiX4Li24LiB4Lic4Lil4Lil4LiHIEZpcmVzdG9yZQogICAgY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwogICAgY29uc3Qgc3VibWlzc2lvblJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7cXVpeklkfS9zdWJtaXNzaW9uc2AsIGN1cnJlbnRTdHVkZW50TmFtZSk7CgogICAgdHJ5IHsKICAgICAgICAvLyDwn5SlIFvguKrguYjguKfguJnguJfguLXguYjguJvguKPguLHguJrguJvguKPguLjguIddIOC4reC5iOC4suC4meC4guC5ieC4reC4oeC4ueC4peC5gOC4geC5iOC4suC5gOC4nuC4t+C5iOC4reC4meC4seC4muC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4hyDwn5SlCiAgICAgICAgbGV0IGN1cnJlbnRTdWJtaXRDb3VudCA9IDA7CiAgICAgICAgbGV0IGF0dGVtcHRzSGlzdG9yeSA9IFsuLi5wcmV2aW91c0F0dGVtcHRzXTsgLy8g4LmA4Lij4Li04LmI4Lih4LiI4Liy4LiB4LiE4LmI4Liy4LiX4Li14LmI4Liq4LmI4LiH4LmA4LiC4LmJ4Liy4Lih4LiyCgogICAgICAgIC8vIOC4reC5iOC4suC4meC4guC5ieC4reC4oeC4ueC4peC4peC5iOC4suC4quC4uOC4lOC4iOC4suC4gSBEQiDguYDguJ7guLfguYjguK3guITguKfguLLguKHguIrguLHguKfguKPguYwgKOC4m+C5ieC4reC4h+C4geC4seC4meC4hOC5iOC4siBwcmV2aW91c0F0dGVtcHRzIOC5hOC4oeC5iOC4reC4seC4m+C5gOC4lOC4lSkKICAgICAgICBjb25zdCBkb2NTbmFwID0gYXdhaXQgZ2V0RG9jKHN1Ym1pc3Npb25SZWYpOwogICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIOC4reC5iOC4suC4meC4iOC4s+C4meC4p+C4meC4hOC4o+C4seC5ieC4h+C5gOC4geC5iOC4sgogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEuc3VibWl0Q291bnQgPT09ICdudW1iZXInKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50U3VibWl0Q291bnQgPSBkYXRhLnN1Ym1pdENvdW50OwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuYXR0ZW1wdHMgJiYgQXJyYXkuaXNBcnJheShkYXRhLmF0dGVtcHRzKSkgewogICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4LmE4Lih4LmI4Lih4Li1IGZpZWxkIHN1Ym1pdENvdW50IOC5g+C4q+C5ieC4meC4seC4muC4iOC4suC4gSBhcnJheSBhdHRlbXB0cwogICAgICAgICAgICAgICAgY3VycmVudFN1Ym1pdENvdW50ID0gZGF0YS5hdHRlbXB0cy5sZW5ndGg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIOC4reC4seC4m+C5gOC4lOC4leC4m+C4o+C4sOC4p+C4seC4leC4tOC5gOC4geC5iOC4suC5g+C4q+C5ieC4leC4o+C4h+C4geC4seC4miBEQgogICAgICAgICAgICBpZiAoZGF0YS5hdHRlbXB0cykgewogICAgICAgICAgICAgICAgYXR0ZW1wdHNIaXN0b3J5ID0gWy4uLmRhdGEuYXR0ZW1wdHNdOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyAzLiDguJrguKfguIHguYDguJ7guLTguYjguKEgMSDguJfguLHguJnguJfguLXguJfguLXguYjguIHguJTguKrguYjguIcgKOC4meC4teC5iOC4hOC4t+C4reC5gOC4peC4guC4o+C4reC4muC4m+C4seC4iOC4iOC4uOC4muC4seC4mSkKICAgICAgICBjb25zdCBuZXdTdWJtaXRDb3VudCA9IGN1cnJlbnRTdWJtaXRDb3VudCArIDE7CiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICBjb25zdCBuZXdBdHRlbXB0ID0gewogICAgICAgICAgICBzY29yZTogdG90YWxSYXdTY29yZSwKICAgICAgICAgICAgY29ycmVjdENvdW50OiBzY29yZUNvdW50LAogICAgICAgICAgICBwb2ludHM6IHRvdGFsUG9pbnRzLAogICAgICAgICAgICBiYWRnZXM6IEFycmF5LmZyb20obmV3IFNldChlYXJuZWRCYWRnZXMpKSwKICAgICAgICAgICAgc3VibWl0dGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgYW5zd2VyczogZGV0YWlsZWRBbnN3ZXJzLAogICAgICAgICAgICBhdHRlbXB0TnVtYmVyOiBuZXdTdWJtaXRDb3VudCAvLyDguJrguLHguJnguJfguLbguIHguYDguKXguILguKPguK3guJrguKXguIfguYPguJnguYHguJXguYjguKXguLDguITguKPguLHguYnguIfguJTguYnguKfguKIKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGF0dGVtcHRzSGlzdG9yeS5wdXNoKG5ld0F0dGVtcHQpOwoKICAgICAgICBjb25zdCBmaXJzdFNjb3JlID0gYXR0ZW1wdHNIaXN0b3J5Lmxlbmd0aCA9PT0gMSA/IHRvdGFsUmF3U2NvcmUgOiAoYXR0ZW1wdHNIaXN0b3J5WzBdLnNjb3JlIHx8IDApOwogICAgICAgIGNvbnN0IGJlc3RTY29yZSA9IE1hdGgubWF4KC4uLmF0dGVtcHRzSGlzdG9yeS5tYXAoYSA9PiBhLnNjb3JlKSk7CgogICAgICAgIGF3YWl0IHNldERvYyhzdWJtaXNzaW9uUmVmLCB7CiAgICAgICAgICAgIHN0dWRlbnROYW1lOiBjdXJyZW50U3R1ZGVudE5hbWUsCiAgICAgICAgICAgIHNjb3JlOiBzY29yZUNvdW50LCAgCiAgICAgICAgICAgIHRvdGFsUXVlc3Rpb25zOiB0b3RhbE1heFNjb3JlLCAKICAgICAgICAgICAgdG90YWxRdWVzdGlvbnNDb3VudDogdG90YWxRdWVzdGlvbnNDb3VudCwgCiAgICAgICAgICAgIGF0dGVtcHRzOiBhdHRlbXB0c0hpc3RvcnksCiAgICAgICAgICAgIGZpcnN0U2NvcmU6IGZpcnN0U2NvcmUsCiAgICAgICAgICAgIGJlc3RTY29yZTogYmVzdFNjb3JlLAogICAgICAgICAgICBsYXRlc3RTY29yZTogdG90YWxSYXdTY29yZSwKICAgICAgICAgICAgcG9pbnRzOiB0b3RhbFBvaW50cywgCiAgICAgICAgICAgIGxhdGVzdFN1Ym1pdHRlZEF0OiBuZXdBdHRlbXB0LnN1Ym1pdHRlZEF0LAogICAgICAgICAgICBkZXRhaWxlZExhc3RBdHRlbXB0OiBkZXRhaWxlZEFuc3dlcnMsIAogICAgICAgICAgICBwcm9qZWN0SWQ6IGN1cnJlbnRRdWl6RGF0YS5wcm9qZWN0SWQgfHwgIiIsCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyDwn5SlIOC4muC4seC4meC4l+C4tuC4geC4hOC5iOC4suC5g+C4q+C4oeC5iOC4peC4h+C5hOC4myAoRGFzaGJvYXJkIOC4iOC4sOC4lOC4tuC4h+C4leC4seC4p+C4meC4teC5ieC5hOC4m+C5guC4iuC4p+C5jCkg8J+UpQogICAgICAgICAgICBzdWJtaXRDb3VudDogbmV3U3VibWl0Q291bnQgCgogICAgICAgIH0sIHsgbWVyZ2U6IHRydWUgfSk7CgogICAgICAgIGF3YWl0IHVwZGF0ZVN0dWRlbnRQcm9maWxlKGN1cnJlbnRRdWl6RGF0YS5wcm9qZWN0SWQsIGN1cnJlbnRTdHVkZW50TmFtZSk7CiAgICAgICAgCiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIC8vIPCflKUg4Liq4LmI4Lin4LiZIExvZ2ljIOC5geC4quC4lOC4h+C4nOC4pSAo4LiE4LiH4LmA4LiU4Li04Lih4LiV4Liy4Lih4LiX4Li14LmI4LiE4Li44LiT4LiV4LmJ4Lit4LiH4LiB4Liy4LijKSDwn5SlCiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIAogICAgICAgIC8vIDEuIOC4luC5ieC4suC4geC4s+C4peC4seC4h+C4l+C4s+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oeC4reC4ouC4ueC5iCAtPiDguYPguIrguYnguKvguJnguYnguLLguYHguKrguJTguIfguJzguKXguYDguInguJ7guLLguLDguILguK3guIfguKrguK3guJrguIvguYjguK3guKEKICAgICAgICBpZiAoY3VycmVudERpc3BsYXllZFF1aXouaXNSZW1lZGlhbCkgewogICAgICAgICAgICBoYW5kbGVSZW1lZGlhbFJlc3VsdERpc3BsYXkoc2NvcmVDb3VudCwgdG90YWxRdWVzdGlvbnMsIGRldGFpbGVkQW5zd2Vycyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIDIuIOC4luC5ieC4suC5gOC4m+C5h+C4meC4guC5ieC4reC4quC4reC4muC4m+C4geC4leC4tAogICAgICAgIGNvbnN0IGlzUmVtZWRpYWxFbmFibGVkID0gY3VycmVudFF1aXpEYXRhLnNldHRpbmdzPy5lbmFibGVSZW1lZGlhbDsKICAgICAgICBjb25zdCBpc0ZhaWxlZCA9IHNjb3JlQ291bnQgPCB0b3RhbFF1ZXN0aW9uczsgLy8g4Lir4Lij4Li34Lit4LmD4LiK4LmJIHBhc3NpbmdUaHJlc2hvbGQg4LiV4Liy4Lih4LiV4LmJ4Lit4LiH4LiB4Liy4LijCgogICAgICAgIC8vIOC5gOC4h+C4t+C5iOC4reC4meC5hOC4giBBOiDguYDguJvguLTguJTguKPguLDguJrguJrguIvguYjguK3guKEgKyDguKrguK3guJrguJXguIEKICAgICAgICAvLyAtPiDguYPguKvguYnguKrguKPguYnguLLguIfguILguYnguK3guKrguK3guJrguIvguYjguK3guKEgKyDguYHguKrguJTguIfguKvguJnguYnguLIgIuC4o+C4reC4m+C4o+C4sOC4geC4suC4qOC4nOC4pS/guKXguLPguJTguLHguJrguJfguLXguYjguKrguYjguIciICjguYTguKHguYjguYLguIrguKfguYzguITguLDguYHguJnguJkpCiAgICAgICAgaWYgKGlzUmVtZWRpYWxFbmFibGVkICYmIGlzRmFpbGVkKSB7CiAgICAgICAgICAgICAKICAgICAgICAgICAgIC8vIOC4quC4o+C5ieC4suC4h+C4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oeC5gOC4h+C4teC4ouC4muC5hgogICAgICAgICAgICAgYXdhaXQgY3JlYXRlUmVtZWRpYWxRdWl6Rm9yU3R1ZGVudChjdXJyZW50UXVpekRhdGEsIGRldGFpbGVkQW5zd2VycywgY3VycmVudFN0dWRlbnROYW1lKTsKICAgICAgICAgICAgIAogICAgICAgICAgICAgLy8g4LiZ4Lix4Lia4Lil4Liz4LiU4Lix4Lia4LiB4Liy4Lij4Liq4LmI4LiHCiAgICAgICAgICAgICBjb25zdCBzdWJtaXNzaW9uc0NvbGwgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCk7CiAgICAgICAgICAgICBjb25zdCBzdWJTbmFwc2hvdCA9IGF3YWl0IGdldERvY3Moc3VibWlzc2lvbnNDb2xsKTsKICAgICAgICAgICAgIGNvbnN0IHJhbmsgPSBzdWJTbmFwc2hvdC5zaXplOwoKICAgICAgICAgICAgIC8vIOC5geC4quC4lOC4h+C4q+C4meC5ieC4suC4iOC4reC4quC4teC5gOC4guC4teC4ouC4pyAo4Lil4Liz4LiU4Lix4Lia4LiX4Li14LmI4Liq4LmI4LiHKQogICAgICAgICAgICAgaWYgKHR5cGVvZiBkaXNwbGF5U3VibWlzc2lvblN1Y2Nlc3MgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgICBkaXNwbGF5U3VibWlzc2lvblN1Y2Nlc3MocmFuayk7CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrCiAgICAgICAgICAgICAgICAgaGFuZGxlUmVzdWx0RGlzcGxheShkaXNwbGF5U2V0dGluZywgc2NvcmVDb3VudCwgdG90YWxQb2ludHMsIGVhcm5lZEJhZGdlcywgZGV0YWlsZWRBbnN3ZXJzLCB0b3RhbFF1ZXN0aW9ucyk7CiAgICAgICAgICAgICB9CiAgICAgICAgfSAKICAgICAgICAvLyDguYDguIfguLfguYjguK3guJnguYTguIIgQjog4Lib4Li04LiU4Lij4Liw4Lia4Lia4LiL4LmI4Lit4LihIOC4q+C4o+C4t+C4rSDguKrguK3guJrguJzguYjguLLguJkKICAgICAgICAvLyAtPiDguYPguKvguYnguYHguKrguJTguIfguJzguKXguJXguLLguKHguJfguLXguYjguJXguLHguYnguIfguITguYjguLLguYTguKfguYkgKFNob3cgUmVzdWx0cywgU2NvcmUsIGV0Yy4pCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICBoYW5kbGVSZXN1bHREaXNwbGF5KGRpc3BsYXlTZXR0aW5nLCBzY29yZUNvdW50LCB0b3RhbFBvaW50cywgZWFybmVkQmFkZ2VzLCBkZXRhaWxlZEFuc3dlcnMsIHRvdGFsUXVlc3Rpb25zKTsKICAgICAgICB9CiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIHNhdmluZyBzdWJtaXNzaW9uOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Lia4Lix4LiZ4LiX4Li24LiB4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTOiAiICsgZXJyb3IubWVzc2FnZSk7CiAgICB9Cn0KCmZ1bmN0aW9uIGdldFF1ZXN0aW9uV2VpZ2h0KHF1aXpEYXRhLCBxdWVzdGlvblR5cGUpIHsKICAgIGNvbnN0IHR5cGVTY29yaW5nID0gcXVpekRhdGEuc2V0dGluZ3M/LnR5cGVTY29yaW5nIHx8IHsgbWNxOiAxLCBzYTogMSwgdGY6IDEgfTsKICAgIAogICAgLy8g4LmB4Lib4Lil4LiH4LiE4LmI4Liy4LmA4Lib4LmH4LiZIEZsb2F0IOC5gOC4nuC4t+C5iOC4reC4hOC4p+C4suC4oeC4iuC4seC4p+C4o+C5jCAo4LiB4Lij4LiT4Li14Lij4Lix4Lia4Lih4Liy4LmA4Lib4LmH4LiZIFN0cmluZykKICAgIGNvbnN0IGdldFZhbCA9ICh2YWwpID0+IHsKICAgICAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHZhbCk7CiAgICAgICAgcmV0dXJuIGlzTmFOKG51bSkgPyAxIDogbnVtOwogICAgfTsKCiAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyB8fCBxdWVzdGlvblR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbCh0eXBlU2NvcmluZy5zYSk7CiAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgcmV0dXJuIGdldFZhbCh0eXBlU2NvcmluZy50Zik7CiAgICB9IGVsc2UgewogICAgICAgIC8vIG11bHRpcGxlX2Nob2ljZSwgbWF0Y2hpbmcsIGV0Yy4KICAgICAgICByZXR1cm4gZ2V0VmFsKHR5cGVTY29yaW5nLm1jcSk7CiAgICB9Cn0KICAgICAgICAKICAgICAgICBhc3luYyBmdW5jdGlvbiB1cGRhdGVTdHVkZW50UHJvZmlsZShwcm9qZWN0SWQsIHN0dWRlbnROYW1lKSB7CiAgICBjb25zdCBwcm9maWxlUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3Byb2plY3RzLyR7cHJvamVjdElkfS9zdHVkZW50UHJvZmlsZXNgLCBzdHVkZW50TmFtZSk7CgogICAgdHJ5IHsKICAgICAgICAvLyDguJTguLbguIfguILguYnguK3guKHguLnguKUgUXVpeiDguJfguLHguYnguIfguKvguKHguJTguYPguJkgUHJvamVjdCAo4Lii4Lit4Lih4LmA4Liq4Li14LiiIFJlYWQg4LiV4Lij4LiH4LiZ4Li14LmJ4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lih4LmI4LiZ4Lii4Liz4LmA4Lin4Lil4Liy4Liq4Lix4LmI4LiHIFJlY2FsY3VsYXRlKQogICAgICAgIGNvbnN0IHF1aXp6ZXNRdWVyeSA9IHF1ZXJ5KAogICAgICAgICAgICBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgKSwKICAgICAgICAgICAgd2hlcmUoInByb2plY3RJZCIsICI9PSIsIHByb2plY3RJZCkKICAgICAgICApOwogICAgICAgIGNvbnN0IHF1aXp6ZXNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocXVpenplc1F1ZXJ5KTsKICAgICAgICBjb25zdCBxdWl6SWRzID0gcXVpenplc1NuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuaWQpOwoKICAgICAgICBsZXQgY2FsY3VsYXRlZFRvdGFsUG9pbnRzID0gMDsKICAgICAgICBjb25zdCBmaW5hbEJhZGdlc0NvdW50ID0ge307CgogICAgICAgIC8vIOC5g+C4iuC5iSBQcm9taXNlLmFsbCDguYDguJ7guLfguYjguK3guJTguLbguIfguILguYnguK3guKHguLnguKXguJ7guKPguYnguK3guKHguIHguLHguJkgKOC5gOC4o+C5h+C4p+C4geC4p+C5iOC4siDguYHguJXguYjguYDguKrguLXguKIgUmVhZCDguYDguJfguYjguLLguYDguJTguLTguKEpCiAgICAgICAgY29uc3Qgc3VibWlzc2lvblByb21pc2VzID0gcXVpeklkcy5tYXAocXVpeklkID0+IAogICAgICAgICAgICBnZXREb2MoZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgc3R1ZGVudE5hbWUpKQogICAgICAgICk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc3VibWlzc2lvblNuYXBzID0gYXdhaXQgUHJvbWlzZS5hbGwoc3VibWlzc2lvblByb21pc2VzKTsKCiAgICAgICAgc3VibWlzc2lvblNuYXBzLmZvckVhY2goZG9jU25hcCA9PiB7CiAgICAgICAgICAgIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZG9jU25hcC5kYXRhKCk7CiAgICAgICAgICAgICAgICAvLyDguYPguIrguYkgUG9pbnRzIOC4l+C4teC5iOC4lOC4teC4l+C4teC5iOC4quC4uOC4lOC4guC4reC4h+C5geC4leC5iOC4peC4sCBRdWl6IOC4oeC4suC4o+C4p+C4oeC4geC4seC4mQogICAgICAgICAgICAgICAgY2FsY3VsYXRlZFRvdGFsUG9pbnRzICs9IChkYXRhLnBvaW50cyB8fCAwKTsKCiAgICAgICAgICAgICAgICAvLyDguJnguLHguJogQmFkZ2UKICAgICAgICAgICAgICAgIGlmIChkYXRhLmF0dGVtcHRzKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5hdHRlbXB0cy5mb3JFYWNoKGF0dGVtcHQgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ZW1wdC5iYWRnZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dGVtcHQuYmFkZ2VzLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiZ4Lix4Lia4LmA4LiJ4Lie4Liy4LiwIEJhZGdlIOC4l+C4teC5iOC5hOC4lOC5ieC4iOC4o+C4tOC4h+C5hiDguYTguKHguYjguYPguIrguYjguJnguLHguJrguIvguYnguLPguIvguYnguK3guJkgKOC4reC4seC4meC4meC4teC5iSBMb2dpYyDguYDguJTguLTguKHguILguK3guIfguITguLjguJPguK3guLLguIjguIjguLDguJnguLHguJrguIvguYnguLMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LmB4LiV4LmI4LmA4Lie4Li34LmI4Lit4LiE4Lin4Liy4Lih4LiH4LmI4Liy4LiiIOC5gOC4o+C4suC4iOC4sOC4meC4seC4muC4o+C4p+C4oeC5hOC4m+C4geC5iOC4reC4meC4leC4suC4oSBMb2dpYyDguYDguJTguLTguKEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gKuC4q+C4oeC4suC4ouC5gOC4q+C4leC4uDogTG9naWMg4LiB4Liy4Lij4LiZ4Lix4LiaIEJhZGdlIOC5geC4muC4muC4peC4sOC5gOC4reC4teC4ouC4lOC4reC4suC4iOC4i+C4seC4muC4i+C5ieC4reC4mSAKICAgICAgICAgICAgICAgICAgICAvLyDguYPguJnguJfguLXguYjguJnguLXguYnguYDguKPguLLguYDguJnguYnguJnguYHguIHguYnguYDguKPguLfguYjguK3guIcgVG90YWwgUG9pbnRzIOC5g+C4q+C5ieC4luC4ueC4geC4leC5ieC4reC4h+C4l+C4teC5iOC4quC4uOC4lOC4geC5iOC4reC4mQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgLy8g4Lia4Lix4LiZ4LiX4Li24LiB4LiX4Lix4Lia4Lil4LiH4LmE4Lib4LmA4Lil4LiiCiAgICAgICAgYXdhaXQgc2V0RG9jKHByb2ZpbGVSZWYsIHsKICAgICAgICAgICAgc3R1ZGVudE5hbWU6IHN0dWRlbnROYW1lLAogICAgICAgICAgICB0b3RhbFBvaW50czogY2FsY3VsYXRlZFRvdGFsUG9pbnRzLAogICAgICAgICAgICAvLyBiYWRnZXNDb3VudDogLi4uICjguJbguYnguLLguJXguYnguK3guIfguIHguLLguKPguITguLPguJnguKfguJMgQmFkZ2Ug4LmD4Lir4Lih4LmI4LiV4LmJ4Lit4LiH4LmA4LiC4Li14Lii4LiZIExvZ2ljIOC4p+C4meC4peC4ueC4m+C4peC4sOC5gOC4reC4teC4ouC4lOC4geC4p+C5iOC4suC4meC4teC5iSkKICAgICAgICB9LCB7IG1lcmdlOiB0cnVlIH0pOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiUHJvZmlsZSByZWNhbGN1bGF0aW9uIGVycm9yOiIsIGVycm9yKTsKICAgIH0KfQoKICAgICAgICBmdW5jdGlvbiBzdGFydEFkbWluVGVzdCgpIHsKICAgICAgICAgICAgaWYgKCFjdXJyZW50UXVpekRhdGEpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYHguJrguJrguJfguJTguKrguK3guJrguKrguLPguKvguKPguLHguJrguJfguJTguKXguK3guIciKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgdGVtcG9yYXJ5LCBkZWVwIGNvcHkgb2YgdGhlIHF1aXogZGF0YSBmb3IgdGhlIHRlc3QuCiAgICAgICAgICAgIC8vIFRoaXMgY29weSBhbHJlYWR5IGNvbnRhaW5zIHRoZSBjb3JyZWN0IHNldHRpbmdzIGZyb20gdGhlIHF1aXogaXRzZWxmLgogICAgICAgICAgICBsZXQgdGVzdFF1aXpEYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjdXJyZW50UXVpekRhdGEpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN1cnJlbnRNb2RlID0gJ2FkbWluLXRlc3RpbmcnOwogICAgICAgICAgICBjdXJyZW50U3R1ZGVudE5hbWUgPSAn4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44LihICjguJfguJTguKrguK3guJopJzsKCiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudFZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIHN0dWRlbnRJbml0aWFsVmlldy5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudE5hbWVTZWxlY3Rpb25WaWV3LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAKICAgICAgICAgICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7IC8vIFJlY29yZCBzdGFydCB0aW1lIGZvciBhZG1pbiB0ZXN0CiAgICAgICAgICAgIC8vIFBhc3MgdGhlIHF1aXogZGF0YSB0byB0aGUgZGlzcGxheSBmdW5jdGlvbi4KICAgICAgICAgICAgZGlzcGxheVF1aXpGb3JTdHVkZW50KHRlc3RRdWl6RGF0YSk7CiAgICAgICAgfQoKZnVuY3Rpb24gaGFuZGxlUmVzdWx0RGlzcGxheShkaXNwbGF5U2V0dGluZywgc2NvcmUsIHBvaW50cywgZWFybmVkQmFkZ2VzLCBkZXRhaWxlZEFuc3dlcnMsIHRvdGFsUXVlc3Rpb25zKSB7CiAgICBpZiAoZGlzcGxheVNldHRpbmcgPT09ICdtYW51YWxfcmVsZWFzZScpIHsKICAgICAgICBkaXNwbGF5U3VibWlzc2lvbkNvbmZpcm1hdGlvbigpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBwYXNzaW5nU2NvcmUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IE1hdGguZmxvb3IodG90YWxRdWVzdGlvbnMgLyAyKTsKICAgIGNvbnN0IGlzQWRhcHRpdmUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNBZGFwdGl2ZSA/PyBmYWxzZTsKICAgIGNvbnN0IGxvb3BVbnRpbFBhc3NFbmFibGVkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/Lmxvb3BVbnRpbFBhc3MgPT09IHRydWU7CiAgICBjb25zdCBkaWRGYWlsID0gc2NvcmUgPCBwYXNzaW5nU2NvcmU7CiAgICAKICAgIC8vIC0tLSBbIOC4quC5iOC4p+C4meC4l+C4teC5iOC5geC4geC5ieC5hOC4giBdIC0tLQogICAgLy8gMS4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiB4LmI4Lit4LiZ4Lin4LmI4LiyIGRpc3BsYXlTZXR0aW5nIOC5gOC4m+C5h+C4meC4o+C4ueC4m+C5geC4muC4muC5g+C4q+C4oeC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgY29uc3QgaXNOZXdEaXNwbGF5TW9kZSA9IGRpc3BsYXlTZXR0aW5nID09PSAnaGFsZl9tYXJrX3N0YXR1cycgfHwgZGlzcGxheVNldHRpbmcgPT09ICdwZXJmZWN0X3Njb3JlX3N0YXR1cyc7CiAgICAKICAgIC8vIDIuIOC5gOC4nuC4tOC5iOC4oeC5gOC4h+C4t+C5iOC4reC4meC5hOC4giAhaXNOZXdEaXNwbGF5TW9kZSDguYDguILguYnguLLguYTguJsg4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJ4LmC4Lir4Lih4LiU4Lin4LiZ4Lil4Li54Lib4LiX4Liz4LiH4Liy4LiZ4LiB4Lix4Lia4Lij4Li54Lib4LmB4Lia4Lia4LmD4Lir4Lih4LmICiAgICBpZiAobG9vcFVudGlsUGFzc0VuYWJsZWQgJiYgZGlkRmFpbCAmJiAhaXNOZXdEaXNwbGF5TW9kZSkgewogICAgLy8gLS0tIFsg4Liq4Li04LmJ4LiZ4Liq4Li44LiU4LiB4Liy4Lij4LmB4LiB4LmJ4LmE4LiCIF0gLS0tCiAgICAgICAgaWYgKGRpc3BsYXlTZXR0aW5nID09PSAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJykgewogICAgICAgICAgICBkaXNwbGF5UmVzdWx0c1dpdGhBbnN3ZXJzKHNjb3JlLCBwb2ludHMsIGVhcm5lZEJhZGdlcywgZGV0YWlsZWRBbnN3ZXJzLCB0b3RhbFF1ZXN0aW9ucywgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGlzcGxheUxvb3BTY3JlZW4oc2NvcmUsIHRvdGFsUXVlc3Rpb25zLCBkaXNwbGF5U2V0dGluZyk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoaXNBZGFwdGl2ZSAmJiBkaWRGYWlsKSB7CiAgICAgICAgc3RhcnRBZGFwdGl2ZUZsb3coZGV0YWlsZWRBbnN3ZXJzLCBzY29yZSwgdG90YWxRdWVzdGlvbnMpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyDguKrguYjguKfguJkgc3dpdGNoIGNhc2Ug4LiX4Li14LmI4LmA4Lir4Lil4Li34Lit4LiX4Liz4LiH4Liy4LiZ4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihCiAgICBzd2l0Y2ggKGRpc3BsYXlTZXR0aW5nKSB7CiAgICAgICAgY2FzZSAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJzoKICAgICAgICAgICAgZGlzcGxheVJlc3VsdHNXaXRoQW5zd2VycyhzY29yZSwgcG9pbnRzLCBlYXJuZWRCYWRnZXMsIGRldGFpbGVkQW5zd2VycywgdG90YWxRdWVzdGlvbnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzaG93X3Jlc3VsdHNfb25seSc6CiAgICAgICAgICAgIGRpc3BsYXlSZXN1bHRzU2NvcmVPbmx5KHNjb3JlLCBwb2ludHMsIGVhcm5lZEJhZGdlcywgdG90YWxRdWVzdGlvbnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdzaG93X3Bhc3NfZmFpbF9vbmx5JzoKICAgICAgICAgICAgZGlzcGxheVBhc3NGYWlsT25seShzY29yZSwgdG90YWxRdWVzdGlvbnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdoYWxmX21hcmtfc3RhdHVzJzoKICAgICAgICAgICAgZGlzcGxheUhhbGZNYXJrUmVzdWx0KHNjb3JlLCB0b3RhbFF1ZXN0aW9ucyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3BlcmZlY3Rfc2NvcmVfc3RhdHVzJzoKICAgICAgICAgICAgZGlzcGxheVBlcmZlY3RTY29yZVJlc3VsdChzY29yZSwgdG90YWxRdWVzdGlvbnMpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBkaXNwbGF5U3VibWlzc2lvbkNvbmZpcm1hdGlvbigpOwogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVSZW1lZGlhbFF1aXood2Vha25lc3NFeHBsYW5hdGlvbnMpIHsKICAgIC8vIOC5geC4quC4lOC4h+C4quC4luC4suC4meC4sOC4geC4s+C4peC4seC4h+C5guC4q+C4peC4lOC5g+C4q+C5ieC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4o+C4suC4mgogICAgc3R1ZGVudFJlYWRpbmdBcmVhLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTgiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQtZ3JheS02MDAiPuC5gOC4ouC4teC5iOC4ouC4oeC5gOC4peC4oiEgQUkg4LiB4Liz4Lil4Lix4LiH4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiK4Li44LiU4LmD4Lir4Lih4LmI4LmA4Lie4Li34LmI4Lit4LiX4Lia4LiX4Lin4LiZ4LiE4Lin4Liy4Lih4LmA4LiC4LmJ4Liy4LmD4LiILi4uPC9wPgogICAgICAgIDwvZGl2PgogICAgYDsKCiAgICAvLyAxLiDguKrguKPguYnguLLguIcgUHJvbXB0IOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBBSSDguKrguKPguYnguLLguIfguILguYnguK3guKrguK3guJrguIvguYjguK3guKEKICAgIGNvbnN0IHJlbWVkaWFsUXVpelByb21wdCA9IGAKICAgICAgICDguIjguLLguIHguKvguLHguKfguILguYnguK3guYDguKvguKXguYjguLLguJnguLXguYnguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKLguLHguIfguYTguKHguYjguYDguILguYnguLLguYPguIg6CiAgICAgICAgJHt3ZWFrbmVzc0V4cGxhbmF0aW9uc30KCiAgICAgICAg4LmC4Lib4Lij4LiU4Liq4Lij4LmJ4Liy4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lib4Lij4LiZ4Lix4Lii4LiK4Li44LiU4LmD4Lir4Lih4LmI4LiI4Liz4LiZ4Lin4LiZIDIg4LiC4LmJ4LitIOC5gOC4nuC4t+C5iOC4reC4l+C4lOC4quC4reC4muC4hOC4p+C4suC4oeC5gOC4guC5ieC4suC5g+C4iOC5g+C4meC4q+C4seC4p+C4guC5ieC4reC5gOC4q+C4peC5iOC4suC4meC4teC5ieC5guC4lOC4ouC5gOC4ieC4nuC4suC4sAogICAgICAgIOC5geC4leC5iOC4peC4sOC4guC5ieC4reC4leC5ieC4reC4h+C4oeC4tSA0IOC4leC4seC4p+C5gOC4peC4t+C4reC4gSwg4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHCgogICAgICAgIOC5g+C4q+C5ieC4nOC4peC4peC4seC4nuC4mOC5jOC5gOC4m+C5h+C4mSBKU09OIG9iamVjdCDguJfguLXguYjguKHguLXguYLguITguKPguIfguKrguKPguYnguLLguIfguJTguLHguIfguJnguLXguYk6CiAgICAgICAgLSB0b3BpYzogKHN0cmluZykg4LiV4Lix4LmJ4LiH4LiK4Li34LmI4Lit4Lir4Lix4Lin4LiC4LmJ4Lit4Lin4LmI4LiyICLguYHguJrguJrguJfguJTguKrguK3guJrguIvguYjguK3guKHguYDguKrguKPguLTguKEiCiAgICAgICAgLSBxdWVzdGlvbnM6IChhcnJheSBvZiBvYmplY3RzKSDguYLguJTguKLguYHguJXguYjguKXguLAgb2JqZWN0IOC4oeC4tToKICAgICAgICAgIC0gcXVlc3Rpb25UZXh0OiAoc3RyaW5nKQogICAgICAgICAgLSBvcHRpb25zOiAoYXJyYXkgb2YgNCBzdHJpbmdzKQogICAgICAgICAgLSBjb3JyZWN0QW5zd2VySW5kZXg6IChudW1iZXIpCgkJICAke3NpbXBsZU1hdGhQcm9tcHR9CiAgICBgOwoKICAgIC8vIDIuIOC4geC4s+C4q+C4meC4lCBTY2hlbWEg4Liq4Liz4Lir4Lij4Lix4Lia4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4LiC4LmJ4Lit4Liq4Lit4LiaICjguYPguIrguYkgbWNxU2NoZW1hIOC4l+C4teC5iOC4oeC4teC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C5hOC4lOC5iSkKICAgIGNvbnN0IG1jcVNjaGVtYSA9IHsKICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgIHF1ZXN0aW9uVGV4dDogeyB0eXBlOiAiU1RSSU5HIiB9LAogICAgICAgICAgICBvcHRpb25zOiB7IHR5cGU6ICJBUlJBWSIsIGl0ZW1zOiB7IHR5cGU6ICJTVFJJTkciIH0gfSwKICAgICAgICAgICAgY29ycmVjdEFuc3dlckluZGV4OiB7IHR5cGU6ICJOVU1CRVIiIH0KICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBbInF1ZXN0aW9uVGV4dCIsICJvcHRpb25zIiwgImNvcnJlY3RBbnN3ZXJJbmRleCJdCiAgICB9OwoKICAgIGNvbnN0IHJlbWVkaWFsUXVpelNjaGVtYSA9IHsKICAgICAgICB0eXBlOiAiT0JKRUNUIiwKICAgICAgICBwcm9wZXJ0aWVzOiB7CiAgICAgICAgICAgIHRvcGljOiB7IHR5cGU6ICJTVFJJTkciIH0sCiAgICAgICAgICAgIHF1ZXN0aW9uczogeyB0eXBlOiAiQVJSQVkiLCBpdGVtczogbWNxU2NoZW1hIH0KICAgICAgICB9LAogICAgICAgIHJlcXVpcmVkOiBbInRvcGljIiwgInF1ZXN0aW9ucyJdCiAgICB9OwoKICAgIHRyeSB7CiAgICAgICAgLy8gMy4g4LmA4Lij4Li14Lii4LiBIEFQSSDguYDguJ7guLfguYjguK3guKrguKPguYnguLLguIfguILguYnguK3guKrguK3guJrguIvguYjguK3guKEKICAgICAgICAvLyDguYDguKPguLLguIjguLDguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJkgaGFuZGxlQXBpQ2FsbCDguJfguLXguYjguKHguLXguK3guKLguLnguYjguYHguKXguYnguKcg4LmB4LiV4LmI4Liq4LmI4LiHIFByb21wdCDguYHguKXguLAgU2NoZW1hIOC5g+C4q+C4oeC5iOC5gOC4guC5ieC4suC5hOC4mwogICAgICAgIC8vIOC5geC4peC4sOC5gOC4meC4t+C5iOC4reC4h+C4iOC4suC4geC5gOC4o+C4suC5hOC4oeC5iOC4leC5ieC4reC4h+C4geC4suC4o+C5g+C4q+C5ieC4nOC4peC4peC4seC4nuC4mOC5jOC5hOC4m+C5geC4quC4lOC4h+C5g+C4meC4quC5iOC4p+C4meC4guC4reC4h+C4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oSAoYWRtaW4pIOC5gOC4o+C4suC4iOC4tuC4h+C4leC5ieC4reC4h+C4iOC4seC4lOC4geC4suC4o+C5gOC4reC4hwogICAgICAgIGNvbnN0IHJlbWVkaWFsUXVpekRhdGEgPSBhd2FpdCBjYWxsQW5hbHlzaXNBcGkocmVtZWRpYWxRdWl6UHJvbXB0LCByZW1lZGlhbFF1aXpTY2hlbWEpOwogICAgICAgIHJlbWVkaWFsUXVpekRhdGEuaXNSZW1lZGlhbCA9IHRydWU7CgogICAgICAgIC8vIDQuIOC5gOC4oeC4t+C5iOC4reC5hOC4lOC5ieC4guC5ieC4reC4quC4reC4muC4iuC4uOC4lOC5g+C4q+C4oeC5iOC4oeC4suC5geC4peC5ieC4pyDguYPguKvguYnguYHguKrguJTguIfguJzguKXguYPguKvguYnguJnguLHguIHguYDguKPguLXguKLguJnguJfguLMKICAgICAgICBzdHVkZW50UmVhZGluZ0FyZWEuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IC8vIOC4i+C5iOC4reC4meC4quC5iOC4p+C4meC4guC4reC4h+C5gOC4meC4t+C5ieC4reC4q+C4suC4l+C4muC4l+C4p+C4mQogICAgICAgIAogICAgICAgIC8vIOC5gOC4o+C4suC4leC5ieC4reC4h+C5geC4meC5iOC5g+C4iOC4p+C5iOC4suC4guC5ieC4reC4quC4reC4muC4i+C5iOC4reC4oeC4meC4teC5ieC4oeC4tSBzZXR0aW5ncyDguJfguLXguYjguYDguKvguKHguLLguLDguKrguKEKICAgICAgICAvLyDguYLguJTguKLguK3guLLguIjguIjguLDguITguLHguJTguKXguK3guIEgc2V0dGluZ3Mg4Lia4Liy4LiH4Lit4Lii4LmI4Liy4LiH4Lih4Liy4LiI4Liy4LiB4LiC4LmJ4Lit4Liq4Lit4Lia4LmA4LiU4Li04LihIOC5geC4leC5iOC4m+C4tOC4lOC5guC4q+C4oeC4lCBhZGFwdGl2ZSDguYDguJ7guLfguYjguK3guYTguKHguYjguYPguKvguYnguKfguJnguIvguYnguLMKICAgICAgICBjb25zdCBuZXdRdWl6U2V0dGluZ3MgPSB7CiAgICAgICAgICAgIC4uLmN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzLAogICAgICAgICAgICBpc0FkYXB0aXZlOiBmYWxzZSwgLy8g4Lib4Li04LiU4LmC4Lir4Lih4LiU4Lib4Lij4Lix4Lia4Lie4Li34LmJ4LiZ4LiQ4Liy4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4LiC4LmJ4Lit4Liq4Lit4Lia4LiL4LmI4Lit4LihCiAgICAgICAgICAgIHJlc3VsdHNEaXNwbGF5OiAnc2hvd19yZXN1bHRzX2FuZF9hbnN3ZXJzJyAvLyDguJrguLHguIfguITguLHguJrguYPguKvguYnguYHguKrguJTguIfguYDguInguKXguKLguKvguKXguLHguIfguJfguLPguYDguKrguKPguYfguIgKICAgICAgICB9OwogICAgICAgIHJlbWVkaWFsUXVpekRhdGEuc2V0dGluZ3MgPSBuZXdRdWl6U2V0dGluZ3M7CiAgICAgICAgCiAgICAgICAgLy8g4LmA4Lij4Li04LmI4Lih4LiX4Liz4LiC4LmJ4Lit4Liq4Lit4Lia4LiL4LmI4Lit4LihCiAgICAgICAgZGlzcGxheVF1aXpGb3JTdHVkZW50KHJlbWVkaWFsUXVpekRhdGEpOwoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiUmVtZWRpYWwgcXVpeiBnZW5lcmF0aW9uIGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C4quC4o+C5ieC4suC4h+C5geC4muC4muC4l+C4lOC4quC4reC4muC4i+C5iOC4reC4oeC5gOC4quC4o+C4tOC4oSIpOwogICAgICAgIC8vIOC4q+C4suC4geC4peC5ieC4oeC5gOC4q+C4peC4pyDguYPguKvguYnguIHguKXguLHguJrguYTguJvguKvguJnguYnguLLguYHguKPguIEKICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgfQp9CgpmdW5jdGlvbiBkaXNwbGF5UGFzc0ZhaWxPbmx5KHNjb3JlLCB0b3RhbFF1ZXN0aW9ucykgewogICAgY29uc3QgcGFzc2luZ1Njb3JlID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnBhc3NpbmdTY29yZSA/PyAtMTsKICAgIGNvbnN0IGlzUmVtZWRpYWxRdWl6ID0gY3VycmVudERpc3BsYXllZFF1aXouaXNSZW1lZGlhbCA9PT0gdHJ1ZTsKICAgIGxldCBwYXNzRmFpbEhUTUwgPSAnJzsKICAgIGxldCBpc1Bhc3MgPSBmYWxzZTsKCiAgICBpZiAoaXNSZW1lZGlhbFF1aXogfHwgcGFzc2luZ1Njb3JlICE9PSAtMSkgewogICAgICAgIGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHNjb3JlID09PSB0b3RhbFF1ZXN0aW9ucykgOiAoc2NvcmUgPj0gcGFzc2luZ1Njb3JlKTsKICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gaXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJzsKICAgICAgICBwYXNzRmFpbEhUTUwgPSBgPGRpdiBjbGFzcz0ibXktNCI+PHNwYW4gY2xhc3M9InRleHQtNHhsIGZvbnQtYm9sZCBweC02IHB5LTIgcm91bmRlZC1mdWxsIGlubGluZS1ibG9jayAke3Jlc3VsdENsYXNzfSI+JHtyZXN1bHRUZXh0fTwvc3Bhbj48L2Rpdj5gOwogICAgfSBlbHNlIHsKICAgICAgICBwYXNzRmFpbEhUTUwgPSBgPHAgY2xhc3M9Im10LTQgdGV4dC1ncmF5LTYwMCI+KOC5hOC4oeC5iOC5hOC4lOC5ieC4leC4seC5ieC4h+C4hOC5iOC4suC5gOC4geC4k+C4keC5jOC4nOC5iOC4suC4meC4quC4s+C4q+C4o+C4seC4muC5geC4muC4muC4l+C4lOC4quC4reC4muC4meC4teC5iSk8L3A+YDsKICAgIH0KCiAgICBsZXQgcmVzdWx0SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggYmctaW5kaWdvLTEwMCByb3VuZGVkLWxnIj4KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1hd2FyZCB0ZXh0LTV4bCB0ZXh0LWluZGlnby01MDAgbWItNCI+PC9pPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTYwMCBtYi0yIj7guJzguLnguYnguYDguILguYnguLLguKrguK3guJo6IDxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtaW5kaWdvLTgwMCI+JHtjdXJyZW50U3R1ZGVudE5hbWV9PC9zcGFuPjwvcD4KICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1pbmRpZ28tODAwIG1iLTIiPuC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ouC5geC4peC5ieC4pzwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNzAwIG1iLTIiPuC4nOC4peC4geC4suC4o+C4l+C4lOC4quC4reC4muC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4rTo8L3A+CiAgICAgICAgICAgICR7cGFzc0ZhaWxIVE1MfQogICAgICAgIDwvZGl2PgogICAgYDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmlubmVySFRNTCA9IHJlc3VsdEhUTUw7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgc2hvd1JhbmtpbmdzOiB0cnVlLCBzaG93SW1wcm92ZUJ1dHRvbjogIWlzUGFzcyB9KTsKfQoKLy8gLS0tIOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBjYW5jZWxBZG1pblRlc3Qg4LmA4LiU4Li04Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUIC0tLQpmdW5jdGlvbiBjYW5jZWxBZG1pblRlc3QoKSB7CiAgICBpZiAocXVpelRpbWVySW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwocXVpelRpbWVySW50ZXJ2YWwpOwogICAgaWYgKHBlclF1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwoJCQkKCXJlbGVhc2VXYWtlTG9jaygpOwoJc3RvcERpbVRpbWVyKCk7CglleGl0RnVsbHNjcmVlbigpOwoJZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGhhbmRsZUZ1bGxzY3JlZW5DaGFuZ2UpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgICAgICAgICAKICAgIGN1cnJlbnRNb2RlID0gJ2FkbWluJzsgLy8gUmVzZXQgbW9kZQogICAgc3R1ZGVudFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICBhZG1pblZpZXcuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CgogICAgLy8gW+C5geC4geC5ieC5hOC4gl0g4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiC4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaICLguITguKfguLLguKHguIjguLMiCiAgICBpZiAoY2FtZUZyb21CbHVlcHJpbnQgJiYgY3VycmVudEJsdWVwcmludFByb2plY3RJZCkgewogICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICBjYW1lRnJvbUJsdWVwcmludCA9IGZhbHNlOyAvLyDguKXguYnguLLguIfguITguKfguLLguKHguIjguLMKICAgIH0gZWxzZSB7CiAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7IC8vIOC4l+C4s+C4h+C4suC4meC4leC4suC4oeC4m+C4geC4leC4tAogICAgfQp9CgpmdW5jdGlvbiBzZXR1cFJlc3VsdFNjcmVlbkJhY2tCdXR0b24ob3B0aW9ucykgewogICAgLy8g4LiB4Liz4Lir4LiZ4LiU4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCiAgICBjb25zdCBjb25maWcgPSB7CiAgICAgICAgaXNMb29waW5nOiBmYWxzZSwKICAgICAgICBzY29yZTogMCwKICAgICAgICB0b3RhbFF1ZXN0aW9uczogMSwKICAgICAgICBzaG93UmFua2luZ3M6IHRydWUsIC8vIOC5geC4quC4lOC4h+C4m+C4uOC5iOC4oeC4reC4seC4meC4lOC4seC4muC5gOC4m+C5h+C4meC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mQogICAgICAgIHNob3dJbXByb3ZlQnV0dG9uOiB1bmRlZmluZWQsIC8vIHVuZGVmaW5lZCDguKvguKHguLLguKLguJbguLbguIfguYPguKvguYnguJXguLHguJTguKrguLTguJnguYPguIjguIjguLLguIEgc2NvcmUKICAgICAgICAuLi5vcHRpb25zIAogICAgfTsKCiAgICBpZiAoY29uZmlnLmlzTG9vcGluZykgewogICAgICAgIGNvbnN0IGJ1dHRvbkhUTUwgPSBgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTYgcHQtNiBib3JkZXItdCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCB3LWZ1bGwgbWF4LXctbWQgbXgtYXV0byI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJyZXRha2UtcXVpei1sb29wLWJ0biIgY2xhc3M9InctZnVsbCBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMyBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy1yZWQtNzAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHRyYW5zaXRpb24tdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSB3aGl0ZXNwYWNlLW5vd3JhcCI+CiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1yZWRvLWFsdCBtci0yIj48L2k+4LiX4Liz4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lit4Li14LiB4LiE4Lij4Lix4LmJ4LiHCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGJ1dHRvbkhUTUwpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXRha2UtcXVpei1sb29wLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgcXVpelN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIGRpc3BsYXlRdWl6Rm9yU3R1ZGVudChjdXJyZW50UXVpekRhdGEpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBiYWNrQnV0dG9uSWQgPSAnYmFjay1mcm9tLXJlc3VsdHMtYnRuJzsKICAgIGNvbnN0IGlzVGVzdGluZyA9IGN1cnJlbnRNb2RlID09PSAnYWRtaW4tdGVzdGluZyc7CiAgICBjb25zdCBiYWNrQnV0dG9uVGV4dCA9IGlzVGVzdGluZyA/ICc8aSBjbGFzcz0iZmFzIGZhLWFycm93LWxlZnQgbXItMiI+PC9pPuC4geC4peC4seC4muC5hOC4m+C4q+C4meC5ieC4suC4iOC4seC4lOC4geC4suC4oycgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob21lIG1yLTIiPjwvaT7guIHguKXguLHguJrguKvguJnguYnguLLguYHguKPguIEnOwogICAgCiAgICBsZXQgYnV0dG9uc0hUTUwgPSAnJzsKCiAgICAvLyDguYDguIfguLfguYjguK3guJnguYTguII6IOC5geC4quC4lOC4h+C4m+C4uOC5iOC4oSAi4LiU4Li54Lit4Lix4LiZ4LiU4Lix4LiaIgogICAgaWYgKGNvbmZpZy5zaG93UmFua2luZ3MpIHsKICAgICAgICBidXR0b25zSFRNTCArPSBgPGJ1dHRvbiBpZD0idmlldy1yYW5raW5ncy1idG4iIGNsYXNzPSJ3LWZ1bGwgc206dy1hdXRvIGZsZXgtMSBiZy15ZWxsb3ctNTAwIHRleHQtd2hpdGUgcHktMyBweC00IHJvdW5kZWQtbGcgZm9udC1zZW1pYm9sZCBob3ZlcjpiZy15ZWxsb3ctNjAwIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwIj48aSBjbGFzcz0iZmFzIGZhLXRyb3BoeSI+PC9pPuC4lOC4ueC4reC4seC4meC4lOC4seC4mjwvYnV0dG9uPmA7CiAgICB9CgogICAgLy8g4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCOiDguYHguKrguJTguIfguJvguLjguYjguKEgIuC4m+C4o+C4seC4muC4m+C4o+C4uOC4h+C4hOC4sOC5geC4meC4mSIKICAgIGxldCBzaG91bGRTaG93SW1wcm92ZSA9IGNvbmZpZy5zaG93SW1wcm92ZUJ1dHRvbjsKICAgIGlmIChzaG91bGRTaG93SW1wcm92ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgc2hvdWxkU2hvd0ltcHJvdmUgPSBjb25maWcuc2NvcmUgPCBjb25maWcudG90YWxRdWVzdGlvbnM7CiAgICB9CgogICAgaWYgKHNob3VsZFNob3dJbXByb3ZlKSB7CiAgICAgICAgIGJ1dHRvbnNIVE1MICs9IGA8YnV0dG9uIGlkPSJyZXRha2UtZm9yLWltcHJvdmVtZW50LWJ0biIgY2xhc3M9InctZnVsbCBzbTp3LWF1dG8gZmxleC0xIGJnLW9yYW5nZS01MDAgdGV4dC13aGl0ZSBweS0zIHB4LTQgcm91bmRlZC1sZyBmb250LXNlbWlib2xkIGhvdmVyOmJnLW9yYW5nZS02MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIgd2hpdGVzcGFjZS1ub3dyYXAiPjxpIGNsYXNzPSJmYXMgZmEtcmVkby1hbHQiPjwvaT7guJvguKPguLHguJrguJvguKPguLjguIfguITguLDguYHguJnguJk8L2J1dHRvbj5gOwogICAgfQogICAgCiAgICAvLyDguJvguLjguYjguKEgIuC4geC4peC4seC4miIgKOC4oeC4teC5gOC4quC4oeC4rSkKICAgIGJ1dHRvbnNIVE1MICs9IGA8YnV0dG9uIGlkPSIke2JhY2tCdXR0b25JZH0iIGNsYXNzPSJ3LWZ1bGwgc206dy1hdXRvIGZsZXgtMSBiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctYmx1ZS03MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIgd2hpdGVzcGFjZS1ub3dyYXAiPiR7YmFja0J1dHRvblRleHR9PC9idXR0b24+YDsKCiAgICBjb25zdCBmaW5hbENvbnRhaW5lckhUTUwgPSBgPGRpdiBjbGFzcz0ibXQtNiBwdC02IGJvcmRlci10IGZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC00IHctZnVsbCBtYXgtdy1sZyBteC1hdXRvIj4ke2J1dHRvbnNIVE1MfTwvZGl2PmA7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGZpbmFsQ29udGFpbmVySFRNTCk7CgogICAgLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVycwogICAgc3R1ZGVudFJlc3VsdEFyZWEucXVlcnlTZWxlY3RvcignI3ZpZXctcmFua2luZ3MtYnRuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlU2hvd1N0dWRlbnRSYW5raW5ncyk7CiAgICAKICAgIGNvbnN0IHJldGFrZUJ0biA9IHN0dWRlbnRSZXN1bHRBcmVhLnF1ZXJ5U2VsZWN0b3IoJyNyZXRha2UtZm9yLWltcHJvdmVtZW50LWJ0bicpOwogICAgaWYgKHJldGFrZUJ0bikgewogICAgICAgICByZXRha2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgICAgICAgICBxdWl6U3RhcnRUaW1lID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgZGlzcGxheVF1aXpGb3JTdHVkZW50KGN1cnJlbnRRdWl6RGF0YSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYmFja0J1dHRvbklkKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBpZiAoaXNUZXN0aW5nKSB7CiAgICAgICAgICAgIGN1cnJlbnRNb2RlID0gJ2FkbWluJzsKICAgICAgICAgICAgc3R1ZGVudFZpZXcuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGFkbWluVmlldy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgc2hvd1ZpZXcoJ3Byb2plY3QtZGV0YWlsJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aXotaWQtaW5wdXQnKS52YWx1ZSA9ICcnOwogICAgICAgIH0KICAgIH0pOwp9CgogZnVuY3Rpb24gZGlzcGxheVJlc3VsdHNXaXRoQW5zd2VycyhzY29yZSwgcG9pbnRzLCBlYXJuZWRCYWRnZXMsIGRldGFpbGVkQW5zd2VycywgdG90YWxRdWVzdGlvbnMsIGlzTG9vcGluZyA9IGZhbHNlKSB7CiAgICBjb25zdCBwZXJjZW50YWdlID0gdG90YWxRdWVzdGlvbnMgPiAwID8gKHNjb3JlIC8gdG90YWxRdWVzdGlvbnMpICogMTAwIDogMDsKICAgIGNvbnN0IHBhc3NpbmdTY29yZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5wYXNzaW5nU2NvcmUgPz8gLTE7CiAgICBjb25zdCBpc1JlbWVkaWFsUXVpeiA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LmlzUmVtZWRpYWwgPT09IHRydWU7CiAgICBsZXQgcGFzc0ZhaWxIVE1MID0gJyc7CgogICAgaWYgKGlzUmVtZWRpYWxRdWl6IHx8IHBhc3NpbmdTY29yZSAhPT0gLTEpIHsKICAgICAgICBsZXQgaXNQYXNzID0gaXNSZW1lZGlhbFF1aXogPyAoc2NvcmUgPT09IHRvdGFsUXVlc3Rpb25zKSA6IChzY29yZSA+PSBwYXNzaW5nU2NvcmUpOwogICAgICAgIGNvbnN0IHJlc3VsdENsYXNzID0gaXNQYXNzID8gJ2JnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTgwMCcgOiAnYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAnOwogICAgICAgIGNvbnN0IHJlc3VsdFRleHQgPSBpc1Bhc3MgPyAn4Lic4LmI4Liy4LiZJyA6ICfguYTguKHguYjguJzguYjguLLguJknOwogICAgICAgIHBhc3NGYWlsSFRNTCA9IGA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIG10LTIgcHgtNCBweS0xIHJvdW5kZWQtZnVsbCBpbmxpbmUtYmxvY2sgJHtyZXN1bHRDbGFzc30iPiR7cmVzdWx0VGV4dH08L3A+YDsKICAgIH0KICAgIAogICAgbGV0IHJlc3VsdEhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgcC02IGJnLWluZGlnby0xMDAgcm91bmRlZC1sZyBtYi02Ij4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS02MDAgbWItMiI+4Lic4Li54LmJ4LmA4LiC4LmJ4Liy4Liq4Lit4LiaOiA8c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWluZGlnby04MDAiPiR7Y3VycmVudFN0dWRlbnROYW1lfTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtcHVycGxlLTcwMCBtYi0yIj7guJzguKXguIHguLLguKPguJfguJTguKrguK3guJo8L2gzPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC00eGwgZm9udC1ib2xkIG15LTIiPiR7c2NvcmV9IDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtbm9ybWFsIHRleHQtZ3JheS02MDAiPi8gJHt0b3RhbFF1ZXN0aW9uc308L3NwYW4+PC9wPgogICAgICAgICAgICAke3Bhc3NGYWlsSFRNTH0KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgZm9udC1zZW1pYm9sZCB0ZXh0LWJsdWUtNjAwIG10LTIiPiske3BvaW50c30gUG9pbnRzPC9wPgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1tZCI+4LiE4Li44LiT4LmE4LiU4LmJ4LiE4Liw4LmB4LiZ4LiZICR7cGVyY2VudGFnZS50b0ZpeGVkKDApfSU8L3A+CiAgICAgICAgICAgIDxkaXYgaWQ9ImVhcm5lZC1iYWRnZXMtY29udGFpbmVyIiBjbGFzcz0ibXQtNCBmbGV4IGp1c3RpZnktY2VudGVyIGdhcC00IGZsZXgtd3JhcCI+PC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGg0IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi00Ij7guJfguJrguJfguKfguJnguITguLPguJXguK3guJo8L2g0PgogICAgYDsKICAgIAogICAgY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zLmZvckVhY2goKHEsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgZGV0YWlsZWRBbnN3ZXIgPSBkZXRhaWxlZEFuc3dlcnNbaW5kZXhdOwogICAgICAgIGNvbnN0IHVzZXJBbnN3ZXIgPSBkZXRhaWxlZEFuc3dlci5hbnN3ZXI7CiAgICAgICAgY29uc3QgaXNDb3JyZWN0ID0gZGV0YWlsZWRBbnN3ZXIuaXNDb3JyZWN0OwogICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHEucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1aXpUeXBlOwoKICAgICAgICByZXN1bHRIVE1MICs9IGA8ZGl2IGNsYXNzPSJtYi00IHAtNCBib3JkZXIgcm91bmRlZC1sZyAke2lzQ29ycmVjdCA/ICdib3JkZXItZ3JlZW4tMzAwIGJnLWdyZWVuLTUwJyA6ICdib3JkZXItcmVkLTMwMCBiZy1yZWQtNTAnfSI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQiPiR7aW5kZXggKyAxfS4gJHtxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHR9PC9wPjxkaXYgY2xhc3M9Im10LTMgc3BhY2UteS0yIHRleHQtc20iPmA7CiAgICAgICAgCiAgICAgICAgc3dpdGNoKHF1ZXN0aW9uVHlwZSkgewogICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJSZXNwb25zZVRleHQgPSB1c2VyQW5zd2VyIHx8ICfguYTguKHguYjguYTguJTguYnguJXguK3guJonOwogICAgICAgICAgICAgICAgY29uc3QgY29ycmVjdFJlc3BvbnNlVGV4dCA9IHEuY29ycmVjdFJlc3BvbnNlOwogICAgICAgICAgICAgICAgcmVzdWx0SFRNTCArPSBgPHA+PHN0cm9uZz7guITguLPguJXguK3guJrguILguK3guIfguITguLjguJM6PC9zdHJvbmc+IDxzcGFuIGNsYXNzPSIkeyFpc0NvcnJlY3QgPyAnbGluZS10aHJvdWdoIHRleHQtcmVkLTcwMCcgOiAnJ30iPiR7dXNlclJlc3BvbnNlVGV4dH08L3NwYW4+PC9wPmA7CiAgICAgICAgICAgICAgICBpZiAoIWlzQ29ycmVjdCkgeyByZXN1bHRIVE1MICs9IGA8cCBjbGFzcz0idGV4dC1ncmVlbi03MDAiPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiHOjwvc3Ryb25nPiAke2NvcnJlY3RSZXNwb25zZVRleHR9PC9wPmA7IH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gPT09IFvguYHguIHguYnguYTguIJdIOC5gOC4nuC4tOC5iOC4oeC5gOC4hOC4qiBmaWxsX2luX25vX2Nob2ljZXMg4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lic4Lil4LmB4Lia4Lia4LmA4LiV4Li04Lih4LiE4LizID09PQogICAgICAgICAgICBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBjYXNlICdzaG9ydF9hbnN3ZXInOgogICAgICAgICAgICAgICAgcmVzdWx0SFRNTCArPSBgPHA+PHN0cm9uZz7guITguLPguJXguK3guJrguILguK3guIfguITguLjguJM6PC9zdHJvbmc+ICR7dXNlckFuc3dlciB8fCAn4LmE4Lih4LmI4LmE4LiU4LmJ4LiV4Lit4LiaJ308L3A+YDsKICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxwIGNsYXNzPSJ0ZXh0LWdyZWVuLTcwMCI+PHN0cm9uZz7guITguLPguJXguK3guJrguJfguLXguYjguYDguKvguKHguLLguLDguKrguKE6PC9zdHJvbmc+ICR7cS5pZGVhbEFuc3dlcn08L3A+YDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICByZXN1bHRIVE1MICs9IGA8cCBjbGFzcz0iJHtxLmNvcnJlY3RBbnN3ZXIgPT09IHRydWUgPyAnZm9udC1ib2xkIHRleHQtZ3JlZW4tNzAwJyA6ICcnfSAke3VzZXJBbnN3ZXIgPT09ICd0cnVlJyAmJiAhaXNDb3JyZWN0ID8gJ2xpbmUtdGhyb3VnaCB0ZXh0LXJlZC03MDAnIDogJyd9Ij7guYPguIrguYg8L3A+YDsKICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxwIGNsYXNzPSIke3EuY29ycmVjdEFuc3dlciA9PT0gZmFsc2UgPyAnZm9udC1ib2xkIHRleHQtZ3JlZW4tNzAwJyA6ICcnfSAke3VzZXJBbnN3ZXIgPT09ICdmYWxzZScgJiYgIWlzQ29ycmVjdCA/ICdsaW5lLXRocm91Z2ggdGV4dC1yZWQtNzAwJyA6ICcnfSI+4LmE4Lih4LmI4LmD4LiK4LmIPC9wPmA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNhc2UgJ211bHRpcGxlX2Nob2ljZSc6CiAgICAgICAgICAgIGNhc2UgJ2ZpbGxfaW5fd2l0aF9jaG9pY2VzJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIGlmIChxLm9wdGlvbnMgJiYgQXJyYXkuaXNBcnJheShxLm9wdGlvbnMpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SFRNTCArPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN0eWxlID0gJyc7IGxldCBpY29uID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID09PSBxLmNvcnJlY3RBbnN3ZXJJbmRleCkgeyBzdHlsZSA9ICdmb250LWJvbGQgdGV4dC1ncmVlbi03MDAnOyBpY29uID0gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIgdGV4dC1ncmVlbi02MDAiPjwvaT4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGkgPT09IHVzZXJBbnN3ZXIpIHsgc3R5bGUgPSAnZm9udC1ib2xkIHRleHQtcmVkLTcwMCBsaW5lLXRocm91Z2gnOyBpY29uID0gJzxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTIgdGV4dC1yZWQtNjAwIj48L2k+JzsgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9IiR7c3R5bGV9Ij4ke2ljb259JHtvcHR9PC9kaXY+YDsgfSkuam9pbignJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIOC4geC4o+C4k+C4teC4guC5ieC4reC4oeC4ueC4peC4nOC4tOC4lOC4nuC4peC4suC4lCAo4LmA4LiK4LmI4LiZIHR5cGUg4Lic4Li04LiUIOC5geC4peC4sOC5hOC4oeC5iOC4oeC4tSBvcHRpb25zKQogICAgICAgICAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxwPjxzdHJvbmc+4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTOjwvc3Ryb25nPiAke3VzZXJBbnN3ZXIgfHwgJ+C5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4mid9PC9wPmA7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0NvcnJlY3QpIHJlc3VsdEhUTUwgKz0gYDxwIGNsYXNzPSJ0ZXh0LWdyZWVuLTcwMCI+PHN0cm9uZz4o4LmE4Lih4LmI4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBKTwvc3Ryb25nPjwvcD5gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICghaXNDb3JyZWN0KSB7CiAgICAgICAgICAgIGNvbnN0IHByYWN0aWNlVG9waWMgPSBxLnN0ZW0gfHwgcS5xdWVzdGlvblRleHQ7CiAgICAgICAgICAgIHJlc3VsdEhUTUwgKz0gYDxkaXYgY2xhc3M9Im10LTMgdGV4dC1yaWdodCI+PGJ1dHRvbiBjbGFzcz0icHJhY3RpY2UtdG9waWMtYnRuIGJnLXllbGxvdy01MDAgdGV4dC13aGl0ZSB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmcteWVsbG93LTYwMCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSBtbC1hdXRvIiBkYXRhLXRvcGljPSIke2VzY2FwZShwcmFjdGljZVRvcGljKX0iPjxpIGNsYXNzPSJmYXMgZmEtcGVuY2lsLWFsdCI+PC9pPiDguJ3guLbguIHguJ3guJnguYDguKPguLfguYjguK3guIfguJnguLXguYnguYDguJ7guLTguYjguKHguYDguJXguLTguKE8L2J1dHRvbj48L2Rpdj5gOwogICAgICAgIH0KICAgICAgICByZXN1bHRIVE1MICs9IGA8L2Rpdj5gOwoJCXJlc3VsdEhUTUwgKz0gYDwvZGl2PmA7CiAgICB9KTsKICAgCiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSByZXN1bHRIVE1MOwogICAgcmVuZGVyRWFybmVkQmFkZ2VzKGVhcm5lZEJhZGdlcywgJ2Vhcm5lZC1iYWRnZXMtY29udGFpbmVyJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgaXNMb29waW5nLCBzY29yZSwgdG90YWxRdWVzdGlvbnMsIHNob3dSYW5raW5nczogdHJ1ZSB9KTsKICAgIAogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB3aW5kb3cuTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFJlc3VsdEFyZWFdKTsKfQoKZnVuY3Rpb24gZGlzcGxheVJlc3VsdHNTY29yZU9ubHkoc2NvcmUsIHBvaW50cywgZWFybmVkQmFkZ2VzLCB0b3RhbFF1ZXN0aW9ucykgewogICAgY29uc3QgcGVyY2VudGFnZSA9IHRvdGFsUXVlc3Rpb25zID4gMCA/IChzY29yZSAvIHRvdGFsUXVlc3Rpb25zKSAqIDEwMCA6IDA7CiAgICBjb25zdCBwYXNzaW5nU2NvcmUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8ucGFzc2luZ1Njb3JlID8/IC0xOwogICAgY29uc3QgaXNSZW1lZGlhbFF1aXogPSBjdXJyZW50RGlzcGxheWVkUXVpei5pc1JlbWVkaWFsID09PSB0cnVlOwogICAgbGV0IHBhc3NGYWlsSFRNTCA9ICcnOwoKICAgIGlmIChpc1JlbWVkaWFsUXVpeiB8fCBwYXNzaW5nU2NvcmUgIT09IC0xKSB7CiAgICAgICAgbGV0IGlzUGFzcyA9IGlzUmVtZWRpYWxRdWl6ID8gKHNjb3JlID09PSB0b3RhbFF1ZXN0aW9ucykgOiAoc2NvcmUgPj0gcGFzc2luZ1Njb3JlKTsKICAgICAgICBjb25zdCByZXN1bHRDbGFzcyA9IGlzUGFzcyA/ICdiZy1ncmVlbi0xMDAgdGV4dC1ncmVlbi04MDAnIDogJ2JnLXJlZC0xMDAgdGV4dC1yZWQtODAwJzsKICAgICAgICBjb25zdCByZXN1bHRUZXh0ID0gaXNQYXNzID8gJ+C4nOC5iOC4suC4mScgOiAn4LmE4Lih4LmI4Lic4LmI4Liy4LiZJzsKICAgICAgICBwYXNzRmFpbEhUTUwgPSBgPHAgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtdC0yIHB4LTQgcHktMSByb3VuZGVkLWZ1bGwgaW5saW5lLWJsb2NrICR7cmVzdWx0Q2xhc3N9Ij4ke3Jlc3VsdFRleHR9PC9wPmA7CiAgICB9CiAgICAKICAgIGxldCByZXN1bHRIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHAtOCBiZy1pbmRpZ28tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWF3YXJkIHRleHQtNXhsIHRleHQtaW5kaWdvLTUwMCBtYi00Ij48L2k+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIG1iLTIiPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjogPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1pbmRpZ28tODAwIj4ke2N1cnJlbnRTdHVkZW50TmFtZX08L3NwYW4+PC9wPgogICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWluZGlnby04MDAgbWItMiI+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4Lia4LmA4Lij4Li14Lii4Lia4Lij4LmJ4Lit4Lii4LmB4Lil4LmJ4LinPC9oMz4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtZ3JheS03MDAgbWItMiI+4LiZ4Li14LmI4LiE4Li34Lit4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiE4Li44LiTOjwvcD4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtNXhsIGZvbnQtYm9sZCBteS0yIj4ke3Njb3JlfSA8c3BhbiBjbGFzcz0idGV4dC0yeGwgZm9udC1ub3JtYWwgdGV4dC1ncmF5LTYwMCI+LyAke3RvdGFsUXVlc3Rpb25zfTwvc3Bhbj48L3A+CiAgICAgICAgICAgICR7cGFzc0ZhaWxIVE1MfQogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtYmx1ZS02MDAgbXQtMiI+KyR7cG9pbnRzfSBQb2ludHM8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXhsIj7guITguLTguJTguYDguJvguYfguJkgJHtwZXJjZW50YWdlLnRvRml4ZWQoMCl9JTwvcD4KICAgICAgICAgICAgPGRpdiBpZD0iZWFybmVkLWJhZGdlcy1jb250YWluZXIiIGNsYXNzPSJtdC00IGZsZXgganVzdGlmeS1jZW50ZXIgZ2FwLTQgZmxleC13cmFwIj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5pbm5lckhUTUwgPSByZXN1bHRIVE1MOwogICAgcmVuZGVyRWFybmVkQmFkZ2VzKGVhcm5lZEJhZGdlcywgJ2Vhcm5lZC1iYWRnZXMtY29udGFpbmVyJyk7CiAgICBzdHVkZW50UmVzdWx0QXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIHN0dWRlbnRRdWl6QXJlYS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIAogICAgc2V0dXBSZXN1bHRTY3JlZW5CYWNrQnV0dG9uKHsgc2NvcmUsIHRvdGFsUXVlc3Rpb25zLCBzaG93UmFua2luZ3M6IHRydWUgfSk7Cn0KCiAgICAgICAgZnVuY3Rpb24gZGlzcGxheVN1Ym1pc3Npb25Db25maXJtYXRpb24oKSB7CiAgICBsZXQgcmVzdWx0SFRNTCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBwLTggYmctZ3JlZW4tMTAwIHJvdW5kZWQtbGciPgogICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSB0ZXh0LTV4bCB0ZXh0LWdyZWVuLTUwMCBtYi00Ij48L2k+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIG1iLTIiPuC4nOC4ueC5ieC5gOC4guC5ieC4suC4quC4reC4mjogPHNwYW4gY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmVlbi04MDAiPiR7Y3VycmVudFN0dWRlbnROYW1lfTwvc3Bhbj48L3A+CiAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtZ3JlZW4tODAwIG1iLTIiPuC4quC5iOC4h+C4hOC4s+C4leC4reC4muC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ouC5geC4peC5ieC4pzwvaDM+CiAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWdyYXktNjAwIj7guJzguLnguYnguITguKfguJrguITguLjguKHguIjguLDguYHguIjguYnguIfguJzguKXguITguLDguYHguJnguJnguYPguKvguYnguJfguKPguLLguJrguKDguLLguKLguKvguKXguLHguIc8L3A+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC02IHB0LTYgYm9yZGVyLXQgZmxleCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJiYWNrLXRvLWhvbWUtbWFudWFsLXJlbGVhc2UiIGNsYXNzPSJiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNiByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctYmx1ZS03MDAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaG9tZSBtci0yIj48L2k+4LiB4Lil4Lix4Lia4LmE4Lib4Lir4LiZ4LmJ4Liy4LmB4Lij4LiBCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFJlc3VsdEFyZWEuaW5uZXJIVE1MID0gcmVzdWx0SFRNTDsKICAgIHN0dWRlbnRSZXN1bHRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgc3R1ZGVudFF1aXpBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwoKICAgIC8vIOC5gOC4nuC4tOC5iOC4oSBFdmVudCBMaXN0ZW5lciDguYPguKvguYnguIHguLHguJrguJvguLjguYjguKHguJfguLXguYjguKrguKPguYnguLLguIfguILguLbguYnguJnguYPguKvguKHguYgKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWNrLXRvLWhvbWUtbWFudWFsLXJlbGVhc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl6LWlkLWlucHV0JykudmFsdWUgPSAnJzsKICAgIH0pOwp9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlckVhcm5lZEJhZGdlcyhiYWRnZUlkcywgY29udGFpbmVySWQpIHsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVySWQpOwogICAgICAgICAgICBpZiAoIWNvbnRhaW5lciB8fCAhYmFkZ2VJZHMgfHwgYmFkZ2VJZHMubGVuZ3RoID09PSAwKSByZXR1cm47CgogICAgICAgICAgICBsZXQgYmFkZ2VzSFRNTCA9ICcnOwogICAgICAgICAgICBiYWRnZUlkcy5mb3JFYWNoKChiYWRnZUlkLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgYmFkZ2VJbmZvID0gT2JqZWN0LnZhbHVlcyhCQURHRVMpLmZpbmQoYiA9PiBiLmlkID09PSBiYWRnZUlkKTsKICAgICAgICAgICAgICAgIGlmIChiYWRnZUluZm8pIHsKICAgICAgICAgICAgICAgICAgICBiYWRnZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmFkZ2UtaWNvbiB0ZXh0LWNlbnRlciBwLTIgYmctd2hpdGUgcm91bmRlZC1sZyBzaGFkb3ciIHN0eWxlPSJhbmltYXRpb24tZGVsYXk6ICR7aW5kZXggKiAwLjJ9czsiIHRpdGxlPSIke2JhZGdlSW5mby5kZXNjcmlwdGlvbn0iPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyAke2JhZGdlSW5mby5pY29ufSB0ZXh0LTN4bCI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgZm9udC1zZW1pYm9sZCBtdC0xIj4ke2JhZGdlSW5mby5uYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBiYWRnZXNIVE1MOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFByZXNlbnRhdGlvbiBNb2RlIEZ1bmN0aW9ucyAtLS0KICAgICAgICBmdW5jdGlvbiBzdGFydFByZXNlbnRhdGlvbihxdWl6RGF0YSkgewogICAgICAgICAgICBjdXJyZW50UXVpekRhdGEgPSBnZXRTaHVmZmxlZFF1aXoocXVpekRhdGEpOyAvLyDguYHguIHguYnguYDguJvguYfguJkgcXVpekRhdGEKICAgICAgICAgICAgY3VycmVudFByZXNlbnRhdGlvblNsaWRlID0gMDsKICAgICAgICAgICAgcHJlc2VudGF0aW9uTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsgLy8gVXNlIHN0eWxlIHRvIHNob3cKICAgICAgICAgICAgcmVuZGVyUHJlc2VudGF0aW9uU2xpZGUoY3VycmVudFByZXNlbnRhdGlvblNsaWRlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGNsb3NlUHJlc2VudGF0aW9uKCkgewogICAgICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJlc2VudGF0aW9uTW9kYWwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHJlbmRlclByZXNlbnRhdGlvblNsaWRlKGluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tc2xpZGUtY29udGFpbmVyJyk7CiAgICAgICAgICAgIGlmICghY3VycmVudFF1aXpEYXRhIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zIHx8ICFjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2luZGV4XSkgewogICAgICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9IGA8cCBjbGFzcz0idGV4dC0yeGwiPuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDog4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiW4Liy4LihPC9wPmA7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcXVlc3Rpb24gPSBjdXJyZW50UXVpekRhdGEucXVlc3Rpb25zW2luZGV4XTsKICAgICAgICAgICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnRRdWl6RGF0YS5xdWl6VHlwZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsgLy8gQ2xlYXIgcHJldmlvdXMgc2xpZGUKCiAgICAgICAgICAgIGxldCBzbGlkZUhUTUwgPSBgCiAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXdoaXRlIHRleHQtZ3JheS04MDAgcC02IG1kOnAtMTIgcm91bmRlZC0yeGwgc2hhZG93LTJ4bCB3LWZ1bGwgbWF4LWgtWzkwdmhdIG92ZXJmbG93LXktYXV0byBmYWRlLWluIGZsZXggZmxleC1jb2wiPgogICAgICAgICAgICAgICAgICAgICR7cXVlc3Rpb24uaW1hZ2VDb2RlID8gYDxkaXYgY2xhc3M9Im15LTQgZmxleCBqdXN0aWZ5LWNlbnRlciI+JHtxdWVzdGlvbi5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTJ4bCBzbTp0ZXh0LTN4bCBsZzp0ZXh0LTR4bCBmb250LWJvbGQgbWItNiBtZDptYi0xMiB0ZXh0LWxlZnQiIHN0eWxlPSJsaW5lLWhlaWdodDogMS44OyI+JHtpbmRleCArIDF9LiAke3F1ZXN0aW9uLnN0ZW0gfHwgcXVlc3Rpb24ucXVlc3Rpb25UZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJwcmVzZW50YXRpb24tb3B0aW9ucyIgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTQgbWQ6Z2FwLTYgaXRlbXMtc3RyZXRjaCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIGA7CgogICAgICAgICAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgICAgICAgICBzbGlkZUhUTUwgKz0gcXVlc3Rpb24uYWxsUmVzcG9uc2VzLm1hcCgocmVzcCkgPT4gYAogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJwcmVzZW50YXRpb24tb3B0aW9uIHAtNCBtZDpwLTYgcm91bmRlZC1sZyB0ZXh0LWxnIG1kOnRleHQtMnhsIGJvcmRlci00IGJvcmRlci1ncmF5LTMwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIHRyYW5zaXRpb24tYWxsIGxlYWRpbmctbm9ybWFsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHRleHQtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cmVzcH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzoKICAgICAgICAgICAgICAgICAgICBzbGlkZUhUTUwgKz0gYDxidXR0b24gY2xhc3M9InByZXNlbnRhdGlvbi1vcHRpb24gcC00IG1kOnAtNiByb3VuZGVkLWxnIHRleHQtbGcgbWQ6dGV4dC0yeGwgYm9yZGVyLTQgYm9yZGVyLWdyYXktMzAwIGhvdmVyOmJnLWluZGlnby0xMDAgdHJhbnNpdGlvbi1hbGwgbGVhZGluZy1ub3JtYWwgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jZW50ZXIiIGRhdGEtYW5zd2VyPSJ0cnVlIj7guYPguIrguYg8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgPGJ1dHRvbiBjbGFzcz0icHJlc2VudGF0aW9uLW9wdGlvbiBwLTQgbWQ6cC02IHJvdW5kZWQtbGcgdGV4dC1sZyBtZDp0ZXh0LTJ4bCBib3JkZXItNCBib3JkZXItZ3JheS0zMDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCBsZWFkaW5nLW5vcm1hbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciIgZGF0YS1hbnN3ZXI9ImZhbHNlIj7guYTguKHguYjguYPguIrguYg8L2J1dHRvbj5gOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgICAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZXh0YXJlYSBpZD0icHJlc2VudGF0aW9uLXNob3J0LWFuc3dlci1pbnB1dCIgY2xhc3M9InctZnVsbCBwLTQgdGV4dC0yeGwgYm9yZGVyLTIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGcgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCIgcm93cz0iMiIgcGxhY2Vob2xkZXI9IuC4nuC4tOC4oeC4nuC5jOC4hOC4s+C4leC4reC4muC4l+C4teC5iOC4meC4teC5iC4uLiI+PC90ZXh0YXJlYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImNoZWNrLXByZXNlbnRhdGlvbi1hbnN3ZXItYnRuIiBjbGFzcz0ibXQtNCBiZy1ibHVlLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNiByb3VuZGVkLWxnIHRleHQteGwgaG92ZXI6YmctYmx1ZS03MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2siPjwvaT4g4LiV4Lij4Lin4LiI4LiE4Liz4LiV4Lit4LiaCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9InByZXNlbnRhdGlvbi1haS1yZXN1bHQiIGNsYXNzPSJoaWRkZW4gbXQtNCB0ZXh0LTJ4bCBmb250LWJvbGQiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmlsbF9pbl90aGVfYmxhbmsnOgogICAgICAgICAgICAgICAgY2FzZSAnbXVsdGlwbGVfY2hvaWNlJzoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgc2xpZGVIVE1MICs9IHF1ZXN0aW9uLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icHJlc2VudGF0aW9uLW9wdGlvbiBwLTQgbWQ6cC02IHJvdW5kZWQtbGcgdGV4dC1sZyBtZDp0ZXh0LTJ4bCBib3JkZXItNCBib3JkZXItZ3JheS0zMDAgaG92ZXI6YmctaW5kaWdvLTEwMCB0cmFuc2l0aW9uLWFsbCBsZWFkaW5nLW5vcm1hbCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWNlbnRlciIgZGF0YS1pbmRleD0iJHtpfSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke29wdH0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgYCkuam9pbignJyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNsaWRlSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBzbGlkZUhUTUw7CiAgICAgICAgICAgIGlmICh3aW5kb3cuTWF0aEpheCkgd2luZG93Lk1hdGhKYXgudHlwZXNldFByb21pc2UoW2NvbnRhaW5lcl0pOwoKICAgICAgICAgICAgLy8g4pa84pa84pa8IC0tLSDguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIIgLS0tIOKWvOKWvOKWvAogICAgICAgICAgICAvLyAxLiDguYDguJXguKPguLXguKLguKHguILguYnguK3guKHguLnguKXguJXguLHguKfguYDguKXguLfguK3guIEgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgICAgICAgICAgbGV0IG9wdGlvbnNGb3JTY3JhdGNocGFkID0gW107CiAgICAgICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ21hdGNoaW5nX2l0ZW0nOiBvcHRpb25zRm9yU2NyYXRjaHBhZCA9IHF1ZXN0aW9uLmFsbFJlc3BvbnNlcyB8fCBbXTsgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd0cnVlX2ZhbHNlJzogb3B0aW9uc0ZvclNjcmF0Y2hwYWQgPSBbJ+C5g+C4iuC5iCcsICfguYTguKHguYjguYPguIrguYgnXTsgYnJlYWs7CiAgICAgICAgICAgICAgICBkZWZhdWx0OiBvcHRpb25zRm9yU2NyYXRjaHBhZCA9IHF1ZXN0aW9uLm9wdGlvbnMgfHwgW107IGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAyLiDguITguYnguJnguKvguLLguJvguLjguYjguKEgIuC4l+C4lOC5gOC4peC4giIg4LiX4Li14LmI4LiV4Lit4LiZ4LiZ4Li14LmJ4Lit4Lii4Li54LmI4LmD4LiZIEhUTUwg4LmB4Lil4LmJ4LinCiAgICAgICAgICAgIGNvbnN0IHNjcmF0Y2hwYWRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlc2VudGF0aW9uLXNjcmF0Y2hwYWQtYnRuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiDguYDguJvguKXguLXguYjguKLguJnguIjguLLguIHguIHguLLguKMgIuC4quC4o+C5ieC4suC4h+C4m+C4uOC5iOC4oeC5g+C4q+C4oeC5iCIg4Lih4Liy4LmA4Lib4LmH4LiZICLguK3guLHguJvguYDguJTguJUgRXZlbnQgYG9uY2xpY2tgIiDguILguK3guIfguJvguLjguYjguKHguYDguJTguLTguKEKICAgICAgICAgICAgLy8g4LiB4Liy4Lij4LmD4LiK4LmJIC5vbmNsaWNrIOC4iOC4sOC5gOC4m+C5h+C4meC4geC4suC4o+C5gOC4guC4teC4ouC4meC4l+C4seC4miBMaXN0ZW5lciDguYDguIHguYjguLLguJfguLjguIHguITguKPguLHguYnguIcg4LiX4Liz4LmD4Lir4LmJ4LiC4LmJ4Lit4Lih4Li54Lil4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LmA4Liq4Lih4LitCiAgICAgICAgICAgIGlmIChzY3JhdGNocGFkQnRuKSB7CiAgICAgICAgICAgICAgICBzY3JhdGNocGFkQnRuLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIG9wdGlvbnNGb3JTY3JhdGNocGFkKTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g4pay4pay4payIC0tLSDguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguYHguIHguYnguYTguIIgLS0tIOKWsuKWsuKWsgoKICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnByZXNlbnRhdGlvbi1vcHRpb24nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gcmV2ZWFsQW5zd2VyRm9yUHJlc2VudGF0aW9uKGluZGV4LCBlLmN1cnJlbnRUYXJnZXQpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBjaGVja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1wcmVzZW50YXRpb24tYW5zd2VyLWJ0bicpOwogICAgICAgICAgICBpZiAoY2hlY2tCdG4pIHsKICAgICAgICAgICAgICAgIGNoZWNrQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gY2hlY2tTaG9ydEFuc3dlckZvclByZXNlbnRhdGlvbihpbmRleCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xpZGUtY291bnRlcicpLnRleHRDb250ZW50ID0gYOC4guC5ieC4reC4l+C4teC5iCAke2luZGV4ICsgMX0gLyAke2N1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RofWA7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2LXF1ZXN0aW9uLWJ0bicpLmRpc2FibGVkID0gaW5kZXggPT09IDA7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZXh0LXF1ZXN0aW9uLWJ0bicpLmRpc2FibGVkID0gaW5kZXggPT09IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gY2hlY2tTaG9ydEFuc3dlckZvclByZXNlbnRhdGlvbihxdWVzdGlvbkluZGV4KSB7CiAgICBjb25zdCBxdWVzdGlvbiA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVzZW50YXRpb24tc2hvcnQtYW5zd2VyLWlucHV0Jyk7CiAgICBjb25zdCBjaGVja0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGVjay1wcmVzZW50YXRpb24tYW5zd2VyLWJ0bicpOwogICAgY29uc3QgcmVzdWx0Q29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXNlbnRhdGlvbi1haS1yZXN1bHQnKTsKICAgIC8vIGNvbnN0IGV4cGxhbmF0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZXNlbnRhdGlvbi1leHBsYW5hdGlvbicpOyAvLyA8LS0tIOC4peC4muC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC4l+C4tOC5ieC4hwoKICAgIC8vIOC5geC4geC5ieC5hOC4guC5gOC4h+C4t+C5iOC4reC4meC5hOC4giBpZjog4LmA4Lit4LiyICFleHBsYW5hdGlvbkNvbnRhaW5lciDguK3guK3guIEKICAgIGlmICghaW5wdXQgfHwgIWNoZWNrQnRuIHx8ICFyZXN1bHRDb250YWluZXIpIHJldHVybjsgCgogICAgY29uc3QgdXNlckFuc3dlciA9IGlucHV0LnZhbHVlLnRyaW0oKTsKICAgIGlmICh1c2VyQW5zd2VyID09PSAnJykgewogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBjaGVja0J0bi5kaXNhYmxlZCA9IHRydWU7CiAgICBjaGVja0J0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPuC4geC4s+C4peC4seC4h+C4leC4o+C4p+C4iC4uLic7CiAgICBpbnB1dC5kaXNhYmxlZCA9IHRydWU7CgogICAgY29uc3QgaXNDb3JyZWN0ID0gYXdhaXQgZ3JhZGVTaG9ydEFuc3dlcih1c2VyQW5zd2VyLCBxdWVzdGlvbik7CgogICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgIHJlc3VsdENvbnRhaW5lci5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9InRleHQtZ3JlZW4tNTAwIj48aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPiDguJbguLnguIHguJXguYnguK3guIc8L3NwYW4+JzsKICAgIH0gZWxzZSB7CiAgICAgICAgcmVzdWx0Q29udGFpbmVyLmlubmVySFRNTCA9IGA8c3BhbiBjbGFzcz0idGV4dC1yZWQtNTAwIj48aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSI+PC9pPiDguYTguKHguYjguJbguLnguIHguJXguYnguK3guIc8L3NwYW4+ICjguITguLPguJXguK3guJrguJfguLXguYjguITguLLguJTguKvguKfguLHguIc6ICR7cXVlc3Rpb24uaWRlYWxBbnN3ZXJ9KWA7CiAgICB9CiAgICAKICAgIHJlc3VsdENvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgIC8vIGV4cGxhbmF0aW9uQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyAvLyA8LS0tIOC4peC4muC4muC4o+C4o+C4l+C4seC4lOC4meC4teC5ieC4l+C4tOC5ieC4hwogICAgY2hlY2tCdG4uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7IAp9CgogICAgICAgIGZ1bmN0aW9uIHJldmVhbEFuc3dlckZvclByZXNlbnRhdGlvbihxdWVzdGlvbkluZGV4LCBzZWxlY3RlZEJ1dHRvbikgewogICAgICAgICAgICBjb25zdCBxdWVzdGlvbiA9IGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnNbcXVlc3Rpb25JbmRleF07CiAgICAgICAgICAgIGNvbnN0IHF1ZXN0aW9uVHlwZSA9IHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50UXVpekRhdGEucXVpelR5cGU7CiAgICAgICAgICAgIAogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucHJlc2VudGF0aW9uLW9wdGlvbicpLmZvckVhY2goYnRuID0+IHsKICAgICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBidG4uY2xhc3NMaXN0LnJlbW92ZSgnaG92ZXI6YmctaW5kaWdvLTEwMCcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgaXNDb3JyZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZihxdWVzdGlvblR5cGUgPT09ICdtdWx0aXBsZV9jaG9pY2UnIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fdGhlX2JsYW5rJykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbkluZGV4ID0gcGFyc2VJbnQoYnRuLmRhdGFzZXQuaW5kZXgpOwogICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IG9wdGlvbkluZGV4ID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXg7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9uQW5zd2VyID0gYnRuLmRhdGFzZXQuYW5zd2VyID09PSAndHJ1ZSc7CiAgICAgICAgICAgICAgICAgICAgaXNDb3JyZWN0ID0gb3B0aW9uQW5zd2VyID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICAgICAgICAgIGlzQ29ycmVjdCA9IGJ0bi50ZXh0Q29udGVudC50cmltKCkgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ2JnLWdyZWVuLTUwMCcsICd0ZXh0LXdoaXRlJywgJ2JvcmRlci1ncmVlbi03MDAnKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnRuLmNsYXNzTGlzdC5hZGQoJ29wYWNpdHktNTAnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxlY3RlZEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCdvcGFjaXR5LTUwJyk7CgogICAgICAgICAgICBsZXQgd2FzU2VsZWN0aW9uQ29ycmVjdCA9IGZhbHNlOwogICAgICAgICAgICBpZiAocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJykgewogICAgICAgICAgICAgICAgd2FzU2VsZWN0aW9uQ29ycmVjdCA9IHBhcnNlSW50KHNlbGVjdGVkQnV0dG9uLmRhdGFzZXQuaW5kZXgpID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXg7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAndHJ1ZV9mYWxzZScpIHsKICAgICAgICAgICAgICAgIHdhc1NlbGVjdGlvbkNvcnJlY3QgPSAoc2VsZWN0ZWRCdXR0b24uZGF0YXNldC5hbnN3ZXIgPT09ICd0cnVlJykgPT09IHF1ZXN0aW9uLmNvcnJlY3RBbnN3ZXI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVlc3Rpb25UeXBlID09PSAnbWF0Y2hpbmdfaXRlbScpIHsKICAgICAgICAgICAgICAgIHdhc1NlbGVjdGlvbkNvcnJlY3QgPSBzZWxlY3RlZEJ1dHRvbi50ZXh0Q29udGVudC50cmltKCkgPT09IHF1ZXN0aW9uLmNvcnJlY3RSZXNwb25zZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCF3YXNTZWxlY3Rpb25Db3JyZWN0KSB7CiAgICAgICAgICAgICAgICBzZWxlY3RlZEJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdiZy1yZWQtNTAwJywgJ3RleHQtd2hpdGUnLCAnYm9yZGVyLXJlZC03MDAnKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBUaW1lciBGdW5jdGlvbnMgLS0tCiAgICAgICAgZnVuY3Rpb24gc3RhcnRXaG9sZVF1aXpUaW1lcihkdXJhdGlvbkluTWludXRlcykgewogICAgICAgICAgICBjb25zdCB0aW1lckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aW1lci1jb250YWluZXInKTsKICAgICAgICAgICAgaWYgKCF0aW1lckNvbnRhaW5lcikgcmV0dXJuOwoKICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IERhdGUubm93KCkgKyBkdXJhdGlvbkluTWludXRlcyAqIDYwICogMTAwMDsKICAgICAgICAgICAgdGltZXJDb250YWluZXIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIGJnLWdyYXktMTAwIHAtMiByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWluZGlnby03MDAiPuC5gOC4p+C4peC4suC4l+C4teC5iOC5gOC4q+C4peC4t+C4rTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9ImNvdW50ZG93bi1kaXNwbGF5IiBjbGFzcz0iZm9udC1ib2xkIHRleHQtbGcgdGV4dC1yZWQtNjAwIj4tLTotLTwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICBjb25zdCBjb3VudGRvd25EaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50ZG93bi1kaXNwbGF5Jyk7CgogICAgICAgICAgICBxdWl6VGltZXJJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZyA9IGVuZFRpbWUgLSBEYXRlLm5vdygpOwogICAgICAgICAgICAgICAgaWYgKHJlbWFpbmluZyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChxdWl6VGltZXJJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgY291bnRkb3duRGlzcGxheS50ZXh0Q29udGVudCA9ICIwMDowMCI7CiAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4q+C4oeC4lOC5gOC4p+C4peC4siEg4LiB4Liz4Lil4Lix4LiH4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaLi4uIik7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlU3VibWl0UXVpeihudWxsKTsgLy8gQXV0by1zdWJtaXQKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IoKHJlbWFpbmluZyAvIDEwMDAgLyA2MCkgJSA2MCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlY29uZHMgPSBNYXRoLmZsb29yKChyZW1haW5pbmcgLyAxMDAwKSAlIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgICAgICAgICAgICAgY291bnRkb3duRGlzcGxheS50ZXh0Q29udGVudCA9IGAke21pbnV0ZXN9OiR7c2Vjb25kc31gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICB9CgovLyDilrzilrzilrwg4Lin4Liy4LiH4LiX4Lix4Lia4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZIHJlbmRlclBlclF1ZXN0aW9uVmlldyDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIHJlbmRlclBlclF1ZXN0aW9uVmlldygpIHsKICAgIGlmIChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwocGVyUXVlc3Rpb25UaW1lckludGVydmFsKTsKICAgIAogICAgY29uc3QgcSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1ZXN0aW9uc1tjdXJyZW50UXVlc3Rpb25JbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBjdXJyZW50RGlzcGxheWVkUXVpei5xdWl6VHlwZTsKICAgIC8vIC0tLSDguYDguJ7guLTguYjguKHguKrguYjguKfguJnguJnguLXguYk6IOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC5gOC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC5guC4q+C4oeC4lOC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iCAtLS0KICAgIGNvbnN0IGNvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICAvLyAxLiDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIfguKvguKXguLHguIHguILguK3guIfguKvguJnguYnguLLguIjguK0KICAgIGxldCBodG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtYi0yIj4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCI+4LiE4Liz4LiW4Liy4Lih4LiX4Li14LmIICR7Y3VycmVudFF1ZXN0aW9uSW5kZXggKyAxfSDguIjguLLguIEgJHtjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubGVuZ3RofTwvcD4KICAgICAgICAgICAgJHtjdXJyZW50TW9kZSA9PT0gJ2FkbWluLXRlc3RpbmcnID8gJzxidXR0b24gaWQ9ImNhbmNlbC10ZXN0LWJ0biIgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTUwMCBob3Zlcjp0ZXh0LXJlZC02MDAgZm9udC1zZW1pYm9sZCBweS0xIHB4LTIgcm91bmRlZC1tZCBob3ZlcjpiZy1yZWQtNTAiPjxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIG1yLTEiPjwvaT4g4Lii4LiB4LmA4Lil4Li04LiB4LiB4Liy4Lij4LiX4LiU4Liq4Lit4LiaPC9idXR0b24+JyA6ICcnfQogICAgICAgIDwvZGl2PgogICAgICAgIDxoMyBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgbWItMiB0ZXh0LWNlbnRlciI+4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaOiAke2N1cnJlbnREaXNwbGF5ZWRRdWl6LnRvcGljfTwvaDM+CiAgICAgICAgCiAgICAgICAgPGRpdiBpZD0icGVyLXF1ZXN0aW9uLXRpbWVyLWNvbnRhaW5lciIgY2xhc3M9Im1iLTQiPjwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJtYi02IHAtNCBib3JkZXIgcm91bmRlZC1sZyBiZy1ncmF5LTUwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1zZW1pYm9sZCBtYi0zIiBpZD0icGVyLXF1ZXN0aW9uLXRleHQiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS0yIiBpZD0icGVyLXF1ZXN0aW9uLW9wdGlvbnMiPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBzdHVkZW50UXVpekFyZWEuaW5uZXJIVE1MID0gaHRtbDsKCiAgICAvLyAyLiDguYDguJXguKPguLXguKLguKEgSFRNTCDguKrguLPguKvguKPguLHguJrguITguLPguJbguLLguKHguYHguKXguLDguJXguLHguKfguYDguKXguLfguK3guIEKICAgIGxldCBxdWVzdGlvblRleHRIVE1MID0gKHEuc3RlbSB8fCBxLnF1ZXN0aW9uVGV4dCk7CiAgICBpZiAocS5pbWFnZUNvZGUpIHsKICAgICAgICBxdWVzdGlvblRleHRIVE1MICs9IGA8ZGl2IGNsYXNzPSJteS00IGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YDsKICAgIH0KICAgIAogICAgbGV0IG9wdGlvbnNIVE1MID0gJyc7CiAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgY2FzZSAnc2hvcnRfYW5zd2VyJzoKICAgICAgICBjYXNlICdmaWxsX2luX25vX2Nob2ljZXMnOgogICAgICAgICAgICBvcHRpb25zSFRNTCA9IGA8dGV4dGFyZWEgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJvd3M9IjMiIHJlcXVpcmVkPjwvdGV4dGFyZWE+YDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxkaXY+PGlucHV0IHR5cGU9InJhZGlvIiBpZD0icV9zaW5nbGVfb3B0MCIgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiB2YWx1ZT0idHJ1ZSIgY2xhc3M9Im1yLTIgYWNjZW50LWluZGlnby02MDAiIHJlcXVpcmVkPjxsYWJlbCBmb3I9InFfc2luZ2xlX29wdDAiPuC5g+C4iuC5iDwvbGFiZWw+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCB0eXBlPSJyYWRpbyIgaWQ9InFfc2luZ2xlX29wdDEiIG5hbWU9InF1ZXN0aW9uX3NpbmdsZSIgdmFsdWU9ImZhbHNlIiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icV9zaW5nbGVfb3B0MSI+4LmE4Lih4LmI4LmD4LiK4LmIPC9sYWJlbD48L2Rpdj5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYDxzZWxlY3QgbmFtZT0icXVlc3Rpb25fc2luZ2xlIiBjbGFzcz0idy1mdWxsIHAtMiBib3JkZXIgYm9yZGVyLWdyYXktMzAwIHJvdW5kZWQtbGciIHJlcXVpcmVkPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9IiI+LS0g4LmA4Lil4Li34Lit4LiB4LiE4Liz4LiV4Lit4LiaIC0tPC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHsocS5hbGxSZXNwb25zZXMgfHwgW10pLm1hcChyZXNwID0+IGA8b3B0aW9uIHZhbHVlPSIke3Jlc3B9Ij4ke3Jlc3B9PC9vcHRpb24+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD5gOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZihxLm9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gcS5vcHRpb25zLm1hcCgob3B0LCBpKSA9PiBgPGRpdj48aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJxX3NpbmdsZV9vcHQke2l9IiBuYW1lPSJxdWVzdGlvbl9zaW5nbGUiIHZhbHVlPSIke2l9IiBjbGFzcz0ibXItMiBhY2NlbnQtaW5kaWdvLTYwMCIgcmVxdWlyZWQ+PGxhYmVsIGZvcj0icV9zaW5nbGVfb3B0JHtpfSI+JHtvcHR9PC9sYWJlbD48L2Rpdj5gKS5qb2luKCcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICAvLyAzLiDguJnguLMgSFRNTCDguILguK3guIfguITguLPguJbguLLguKHguYHguKXguLDguJXguLHguKfguYDguKXguLfguK3guIHguYTguJvguYPguKrguYjguYPguJnguKvguJnguYnguLIKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXItcXVlc3Rpb24tdGV4dCcpLmlubmVySFRNTCA9IHF1ZXN0aW9uVGV4dEhUTUw7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXF1ZXN0aW9uLW9wdGlvbnMnKS5pbm5lckhUTUwgPSBvcHRpb25zSFRNTDsKCmNvbnN0IGNvbmZpZGVuY2VFbmFibGVkID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkID09PSB0cnVlOwpjb25zdCBjb25maWRlbmNlTW9kZSA9IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnNldHRpbmdzPy5jb25maWRlbmNlTW9kZSB8fCAnY2hlY2tib3gnOwoKLy8g4pa84pa84pa8IOC4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4gjog4LmA4Lie4Li04LmI4Lih4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCIGAmJiBjb25maWRlbmNlTW9kZSA9PT0gJ2NoZWNrYm94J2Ag4LmA4LiC4LmJ4Liy4LmE4LibIOKWvOKWvOKWvAppZiAoY29uZmlkZW5jZUVuYWJsZWQgJiYgY29uZmlkZW5jZU1vZGUgPT09ICdjaGVja2JveCcpIHsKICAgIC8vIOC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC5g+C4q+C4oeC5iOC4meC4teC5ieC4iOC4sOC4l+C4s+C5g+C4q+C5iSBDaGVja2JveCDguYHguKrguJTguIfguJzguKUgIuC5gOC4ieC4nuC4suC4sOC5gOC4oeC4t+C5iOC4rSIg4LmA4Lil4Li34Lit4LiB4LmC4Lir4Lih4LiUIGNoZWNrYm94IOC5gOC4l+C5iOC4suC4meC4seC5ieC4mQogICAgY29uc3QgY29uZmlkZW5jZUhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ibXQtNCBwdC0zIGJvcmRlci10IGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImNvbmZpZGVuY2Vfc2luZ2xlIiBuYW1lPSJjb25maWRlbmNlX3NpbmdsZSIgY2xhc3M9ImgtNCB3LTQgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCI+CiAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZGVuY2Vfc2luZ2xlIiBjbGFzcz0ibWwtMiB0ZXh0LXNtIGZvbnQtbWVkaXVtIHRleHQtZ3JheS03MDAgY3Vyc29yLXBvaW50ZXIiPuC4ieC4seC4meC4oeC4seC5iOC4meC5g+C4iOC5g+C4meC4hOC4s+C4leC4reC4muC4guC5ieC4reC4meC4teC5iTwvbGFiZWw+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgc3R1ZGVudFF1aXpBcmVhLnF1ZXJ5U2VsZWN0b3IoJy5tYi02LnAtNCcpLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgY29uZmlkZW5jZUhUTUwpOwp9CgogICAgLy8gNC4g4LmA4Lie4Li04LmI4Lih4Lib4Li44LmI4LihICLguJbguLHguJTguYTguJsiIOC5geC4peC4sOC5gOC4o+C4tOC5iOC4oSBUaW1lcgogICAgc3R1ZGVudFF1aXpBcmVhLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlZW5kJywgYAogICAgICAgIDxidXR0b24gaWQ9Im5leHQtcXVlc3Rpb24tdGltZWQtYnRuIiBjbGFzcz0idy1mdWxsIG10LTQgYmctaW5kaWdvLTYwMCB0ZXh0LXdoaXRlIHB5LTMgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgaG92ZXI6YmctaW5kaWdvLTcwMCI+CiAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQgbXItMiI+PC9pPgogICAgICAgICAgICAke2N1cnJlbnRRdWVzdGlvbkluZGV4ID09PSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMubGVuZ3RoIC0gMSA/ICfguKrguYjguIfguITguLPguJXguK3guJonIDogJ+C4hOC4s+C4luC4suC4oeC4luC4seC4lOC5hOC4myd9CiAgICAgICAgPC9idXR0b24+CiAgICBgKTsKCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbi10ZXN0aW5nJykgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWwtdGVzdC1idG4nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjYW5jZWxBZG1pblRlc3QpOwogICAgfQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25leHQtcXVlc3Rpb24tdGltZWQtYnRuJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVOZXh0UXVlc3Rpb25JblRpbWVkTW9kZShmYWxzZSkpOwogICAgaWYgKHdpbmRvdy5NYXRoSmF4KSB3aW5kb3cuTWF0aEpheC50eXBlc2V0UHJvbWlzZShbc3R1ZGVudFF1aXpBcmVhXSk7CiAgICBpZiAoY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3M/LnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICBzdGFydFBlclF1ZXN0aW9uVGltZXIoKTsKICAgIH0KfQoKICAgICAgICBmdW5jdGlvbiBzdGFydFBlclF1ZXN0aW9uVGltZXIoKSB7CiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uSW5TZWNvbmRzID0gY3VycmVudERpc3BsYXllZFF1aXouc2V0dGluZ3MudGltZXJEdXJhdGlvbjsKICAgICAgICAgICAgY29uc3QgdGltZXJDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXF1ZXN0aW9uLXRpbWVyLWNvbnRhaW5lcicpOwogICAgICAgICAgICBpZiAoIXRpbWVyQ29udGFpbmVyKSByZXR1cm47CgogICAgICAgICAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uSW5TZWNvbmRzOwogICAgICAgICAgICB0aW1lckNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ0aW1lci1iYXItY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIGJnLWdyYXktMjAwIHJvdW5kZWQtZnVsbCBoLTIuNSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0idGltZXItYmFyIiBjbGFzcz0iYmctaW5kaWdvLTYwMCBoLTIuNSByb3VuZGVkLWZ1bGwiIHN0eWxlPSJ3aWR0aDogMTAwJSI+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWNlbnRlciB0ZXh0LXNtIHRleHQtZ3JheS02MDAgbXQtMSI+4LmA4Lir4Lil4Li34Lit4LmA4Lin4Lil4LiyIDxzcGFuIGlkPSJwZXItcS1jb3VudGRvd24iPiR7cmVtYWluaW5nVGltZX08L3NwYW4+IOC4p+C4tOC4meC4suC4l+C4tTwvcD4KICAgICAgICAgICAgYDsKICAgICAgICAgICAgY29uc3QgdGltZXJCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGltZXItYmFyJyk7CiAgICAgICAgICAgIGNvbnN0IGNvdW50ZG93bkRpc3BsYXkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyLXEtY291bnRkb3duJyk7CgogICAgICAgICAgICBwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgICAgICByZW1haW5pbmdUaW1lLS07CiAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gKHJlbWFpbmluZ1RpbWUgLyBkdXJhdGlvbkluU2Vjb25kcykgKiAxMDA7CiAgICAgICAgICAgICAgICB0aW1lckJhci5zdHlsZS53aWR0aCA9IGAke3BlcmNlbnRhZ2V9JWA7CiAgICAgICAgICAgICAgICBjb3VudGRvd25EaXNwbGF5LnRleHRDb250ZW50ID0gcmVtYWluaW5nVGltZTsKCiAgICAgICAgICAgICAgICBpZiAocmVtYWluaW5nVGltZSA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKvguKHguJTguYDguKfguKXguLLguKrguLPguKvguKPguLHguJrguILguYnguK3guJnguLXguYkhIik7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlTmV4dFF1ZXN0aW9uSW5UaW1lZE1vZGUodHJ1ZSk7IC8vIEF1dG8tYWR2YW5jZSwgdHJ1ZSBtZWFucyBza2lwcGVkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgIH0KICAgICAgICAKLy8g4pa84pa84pa8IOC4p+C4suC4h+C4l+C4seC4muC4n+C4seC4h+C4geC5jOC4iuC4seC4mSBoYW5kbGVOZXh0UXVlc3Rpb25JblRpbWVkTW9kZSDguYDguJTguLTguKHguJfguLHguYnguIfguKvguKHguJTguJTguYnguKfguKLguYLguITguYnguJTguJnguLXguYkg4pa84pa84pa8CmZ1bmN0aW9uIGhhbmRsZU5leHRRdWVzdGlvbkluVGltZWRNb2RlKHdhc1NraXBwZWQgPSBmYWxzZSkgewogICAgaWYgKHBlclF1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChwZXJRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwoKICAgIGxldCBzZWxlY3RlZEFuc3dlciA9IG51bGw7CiAgICBsZXQgd2FzQ29uZmlkZW50ID0gZmFsc2U7IC8vIOC4hOC5iOC4suC5gOC4o+C4tOC5iOC4oeC4leC5ieC4mQoKICAgIGlmICghd2FzU2tpcHBlZCkgewogICAgICAgIC8vIC0tLSDguKrguYjguKfguJnguJTguLbguIfguILguYnguK3guKHguLnguKXguIjguLLguIHguJ/guK3guKPguYzguKEgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkgLS0tCiAgICAgICAgY29uc3QgY3VycmVudFF1ZXN0aW9uID0gY3VycmVudERpc3BsYXllZFF1aXoucXVlc3Rpb25zW2N1cnJlbnRRdWVzdGlvbkluZGV4XTsKICAgICAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBjdXJyZW50UXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGN1cnJlbnREaXNwbGF5ZWRRdWl6LnF1aXpUeXBlOwogICAgICAgIGlmIChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpIHsKICAgICAgICAgICAgc2VsZWN0ZWRBbnN3ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0ZXh0YXJlYVtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXScpPy52YWx1ZS50cmltKCkgPz8gIiI7CiAgICAgICAgfSBlbHNlIGlmIChxdWVzdGlvblR5cGUgPT09ICdtYXRjaGluZ19pdGVtJykgewogICAgICAgICAgICBzZWxlY3RlZEFuc3dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3NlbGVjdFtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXScpPy52YWx1ZSA/PyAiIjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBjaGVja2VkUmFkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJxdWVzdGlvbl9zaW5nbGUiXTpjaGVja2VkJyk7CiAgICAgICAgICAgIGlmIChjaGVja2VkUmFkaW8pIHsKICAgICAgICAgICAgICAgIHNlbGVjdGVkQW5zd2VyID0gY2hlY2tlZFJhZGlvLnZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzZWxlY3RlZEFuc3dlciA9PT0gbnVsbCB8fCBzZWxlY3RlZEFuc3dlciA9PT0gIiIpIHsKICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4geC4o+C4uOC4k+C4suC5gOC4peC4t+C4reC4geC4hOC4s+C4leC4reC4muC4geC5iOC4reC4meC4geC4lOC4m+C4uOC5iOC4oeC4luC4seC4lOC5hOC4m+C4hOC4o+C4seC4miIpOwogICAgICAgICAgICBzdGFydFBlclF1ZXN0aW9uVGltZXIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIOC4quC5iOC4p+C4mSBMb2dpYyDguYPguKvguKHguYjguJfguLXguYjguYDguJ7guLTguYjguKHguYDguILguYnguLLguKHguLIgLS0tCiAgICAgICAgY29uc3QgY29uZmlkZW5jZUVuYWJsZWQgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgPT09IHRydWU7CiAgICAgICAgY29uc3QgY29uZmlkZW5jZU1vZGUgPSBjdXJyZW50RGlzcGxheWVkUXVpei5zZXR0aW5ncz8uY29uZmlkZW5jZU1vZGUgfHwgJ2NoZWNrYm94JzsKCiAgICAgICAgLy8gKirguYDguIfguLfguYjguK3guJnguYTguILguKrguLPguITguLHguI06Kiog4LiW4LmJ4Liy4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LiH4Liy4LiZIOC5geC4peC4sOC5gOC4m+C5h+C4meC5guC4q+C4oeC4lOC4muC4seC4h+C4hOC4seC4muC5gOC4peC4t+C4reC4gQppZiAoY29uZmlkZW5jZUVuYWJsZWQgJiYgY29uZmlkZW5jZU1vZGUgPT09ICdtYW5kYXRvcnknKSB7CiAgICAgICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4muC4reC4gSBNb2RhbCDguKfguYjguLLguJnguLXguYjguITguLfguK3guYLguKvguKHguJTguIjguLHguJrguYDguKfguKXguLLguKPguLLguKLguILguYnguK0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKS5kYXRhc2V0LmN1cnJlbnRNb2RlID0gJ3RpbWVkJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuICLguJ7guLHguIEiIOC4hOC4s+C4leC4reC4muC5hOC4p+C5ieC5g+C4mSBoaWRkZW4gaW5wdXQKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGVkLWFuc3dlci1pbmRleC1oaWRkZW4nKS52YWx1ZSA9IHNlbGVjdGVkQW5zd2VyOwogICAgICAgICAgICAvLyAyLiDguYHguKrguJTguIcgTW9kYWwKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2UtbW9kYWwnKS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKICAgICAgICAgICAgLy8gMy4g4Lir4Lii4Li44LiU4LiB4Liy4Lij4LiX4Liz4LiH4Liy4LiZ4LiC4Lit4LiH4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4LiZ4Li14LmJ4LiX4Lix4LiZ4LiX4Li1ISAo4Lij4Lit4LmD4Lir4LmJ4Lic4Li54LmJ4LmD4LiK4LmJ4LiE4Lil4Li04LiB4Lib4Li44LmI4Lih4LmD4LiZIE1vZGFsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIOC4luC5ieC4suC5gOC4m+C5h+C4meC5guC4q+C4oeC4lCBDaGVja2JveCAo4LiC4Lit4LiH4LmA4LiU4Li04LihKSDguYPguKvguYnguJTguLbguIfguITguYjguLLguJXguLLguKHguJvguIHguJXguLQKICAgICAgICBjb25zdCBjb25maWRlbmNlQ2hlY2tib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZV9zaW5nbGUnKTsKICAgICAgICBpZiAoY29uZmlkZW5jZUNoZWNrYm94KSB7CiAgICAgICAgICAgIHdhc0NvbmZpZGVudCA9IGNvbmZpZGVuY2VDaGVja2JveC5jaGVja2VkOwogICAgICAgIH0KICAgICAgICAvLyAtLS0g4Liq4Li04LmJ4LiZ4Liq4Li44LiUIExvZ2ljIOC5g+C4q+C4oeC5iCAtLS0KICAgIH0KICAgIAogICAgLy8g4Liq4Lij4LmJ4Liy4LiHIG9iamVjdCDguITguLPguJXguK3guJoKICAgIGNvbnN0IGFuc3dlckRhdGEgPSB7IAogICAgICAgIGFuc3dlcjogc2VsZWN0ZWRBbnN3ZXIsIAogICAgICAgIHdhc0NvbmZpZGVudDogd2FzQ29uZmlkZW50IAogICAgfTsKCiAgICAvLyDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguYPguKvguKHguYjguYDguJ7guLfguYjguK3guYTguJvguILguYnguK3guJXguYjguK3guYTguJsKICAgIHByb2NlZWRUb05leHRRdWVzdGlvbihhbnN3ZXJEYXRhKTsKfQoKICAgICAgICBhc3luYyBmdW5jdGlvbiBmaW5hbGl6ZVBlclF1ZXN0aW9uUXVpeigpIHsKICAgICAgICAgICAgY29uc3QgaGFzU2hvcnRBbnN3ZXIgPSBjdXJyZW50RGlzcGxheWVkUXVpei5xdWVzdGlvbnMuc29tZShxID0+IHEucXVlc3Rpb25UeXBlID09PSAnc2hvcnRfYW5zd2VyJyk7CiAgICAgICAgICAgIGlmIChoYXNTaG9ydEFuc3dlcikgewogICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UoIuC4quC4tOC5ieC4meC4quC4uOC4lOC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4miBBSSDguIHguLPguKXguLHguIfguJXguKPguKfguIjguITguLPguJXguK3guJrguK3guLHguJXguJnguLHguKIuLi4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguKrguLTguYnguJnguKrguLjguJTguIHguLLguKPguJfguLPguYHguJrguJrguJfguJTguKrguK3guJog4LiB4Liz4Lil4Lix4LiH4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaLi4uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gLS0tIOC5gOC4nuC4tOC5iOC4oeC5guC4hOC5ieC4lOC4quC5iOC4p+C4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4myAtLS0KY29uc3QgcXVpeklkID0gY3VycmVudFF1aXpEYXRhLmlkOwpjb25zdCBzdWJtaXNzaW9uUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXMvJHtxdWl6SWR9L3N1Ym1pc3Npb25zYCwgY3VycmVudFN0dWRlbnROYW1lKTsKY29uc3Qgc3VibWlzc2lvblNuYXAgPSBhd2FpdCBnZXREb2Moc3VibWlzc2lvblJlZik7CmNvbnN0IGV4aXN0aW5nRGF0YSA9IHN1Ym1pc3Npb25TbmFwLmV4aXN0cygpID8gc3VibWlzc2lvblNuYXAuZGF0YSgpIDoge307CmNvbnN0IHByZXZpb3VzQXR0ZW1wdHMgPSBleGlzdGluZ0RhdGEuYXR0ZW1wdHMgfHwgW107CgovLyAtLS0g4LmB4LiB4LmJ4LmE4LiC4Lia4Lij4Lij4LiX4Lix4LiU4LmA4LiU4Li04Lih4LmD4Lir4LmJ4LmA4Lib4LmH4LiZ4LmB4Lia4Lia4LiZ4Li14LmJIC0tLQphd2FpdCBwcm9jZXNzQW5kU3VibWl0QW5zd2VycyhzdHVkZW50QW5zd2Vyc1BlclF1ZXN0aW9uLCBwcmV2aW91c0F0dGVtcHRzKTsKICAgICAgICB9CgogICAgICAgIC8vIC0tLSBFeHBvcnQgRnVuY3Rpb25zIC0tLQogICAgICAgIGZ1bmN0aW9uIGdldFJlc3VsdHNGaWxlbmFtZSgpIHsKICAgICAgICAgICAgY29uc3QgcXVpelRpdGxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtcXVpei10aXRsZScpLnRleHRDb250ZW50LnJlcGxhY2UoL1teYS16MC05XS9naSwgJ18nKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICByZXR1cm4gYHJlc3VsdHNfJHtxdWl6VGl0bGUgfHwgJ3F1aXonfWA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHBvcnRSZXN1bHRzQXNJbWFnZSgpIHsKICAgICAgICAgICAgY29uc3QgcmVzdWx0c1RhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdHMtdGFibGUtY29udGFpbmVyJyk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguKPguLnguJvguKDguLLguJ4uLi4iKTsKICAgICAgICAgICAgaHRtbDJjYW52YXMocmVzdWx0c1RhYmxlKS50aGVuKGNhbnZhcyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IGAke2dldFJlc3VsdHNGaWxlbmFtZSgpfS5wbmdgOwogICAgICAgICAgICAgICAgbGluay5ocmVmID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CiAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBtZXNzYWdlTW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0UmVzdWx0c0FzUERGKCkgewogICAgICAgICAgICBjb25zdCB7IGpzUERGIH0gPSB3aW5kb3cuanNwZGY7CiAgICAgICAgICAgIGNvbnN0IGRvYyA9IG5ldyBqc1BERigpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTm90ZToganNQREYgaGFzIGxpbWl0ZWQgc3VwcG9ydCBmb3Igbm9uLWxhdGluIGNoYXJhY3RlcnMgd2l0aG91dCBjdXN0b20gZm9udHMuCiAgICAgICAgICAgIC8vIFRoaXMgd2lsbCB3b3JrIGZvciBiYXNpYyB0ZXh0IGJ1dCBtaWdodCBub3QgcmVuZGVyIFRoYWkgY2hhcmFjdGVycyBjb3JyZWN0bHkuCiAgICAgICAgICAgIC8vIEZvciBmdWxsIFRoYWkgc3VwcG9ydCwgYSBmb250IGxpa2UgJ1NhcmFidW4nIHdvdWxkIG5lZWQgdG8gYmUgZW1iZWRkZWQuCiAgICAgICAgICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCAnbm9ybWFsJyk7IAogICAgICAgICAgICBkb2MuYXV0b1RhYmxlKHsgaHRtbDogJyNyZXN1bHRzLXRhYmxlJyB9KTsKICAgICAgICAgICAgZG9jLnNhdmUoYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LnBkZmApOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0UmVzdWx0c0FzV29yZCgpIHsKICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gIjxodG1sIHhtbG5zOm89J3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScgIisKICAgICAgICAgICAgICAgICJ4bWxuczp3PSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkJyAiKwogICAgICAgICAgICAgICAgInhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwJz4iKwogICAgICAgICAgICAgICAgIjxoZWFkPjxtZXRhIGNoYXJzZXQ9J3V0Zi04Jz48dGl0bGU+RXhwb3J0IEhUTUwgdG8gV29yZDwvdGl0bGU+PC9oZWFkPjxib2R5PiI7CiAgICAgICAgICAgIGNvbnN0IGZvb3RlciA9ICI8L2JvZHk+PC9odG1sPiI7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhUTUwgPSBoZWFkZXIgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicmVzdWx0cy10YWJsZS1jb250YWluZXIiKS5pbm5lckhUTUwgKyBmb290ZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzb3VyY2UgPSAnZGF0YTphcHBsaWNhdGlvbi92bmQubXMtd29yZDtjaGFyc2V0PXV0Zi04LCcgKyBlbmNvZGVVUklDb21wb25lbnQoc291cmNlSFRNTCk7CiAgICAgICAgICAgIGNvbnN0IGZpbGVEb3dubG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmaWxlRG93bmxvYWQpOwogICAgICAgICAgICBmaWxlRG93bmxvYWQuaHJlZiA9IHNvdXJjZTsKICAgICAgICAgICAgZmlsZURvd25sb2FkLmRvd25sb2FkID0gYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LmRvY2A7CiAgICAgICAgICAgIGZpbGVEb3dubG9hZC5jbGljaygpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGZpbGVEb3dubG9hZCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBleHBvcnRSZXN1bHRzQXNFeGNlbCgpIHsKICAgICAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cy10YWJsZScpOwogICAgICAgICAgICBsZXQgY3N2ID0gW107CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFibGUucm93cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGV0IHJvdyA9IFtdLCBjb2xzID0gdGFibGUucm93c1tpXS5xdWVyeVNlbGVjdG9yQWxsKCd0ZCwgdGgnKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY29scy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIC8vIEVzY2FwZSBkb3VibGUgcXVvdGVzIGFuZCB3cmFwIGluIGRvdWJsZSBxdW90ZXMKICAgICAgICAgICAgICAgICAgICByb3cucHVzaCgnIicgKyBjb2xzW2pdLmlubmVyVGV4dC5yZXBsYWNlKC8iL2csICciIicpICsgJyInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNzdi5wdXNoKHJvdy5qb2luKCcsJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNzdkZpbGUgPSBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoWzB4RUYsIDB4QkIsIDB4QkZdKSwgY3N2LmpvaW4oJ1xuJyldLCB7dHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7J30pOyAvLyBBZGQgQk9NIGZvciBFeGNlbAogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGNzdkZpbGUpOwogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYCR7Z2V0UmVzdWx0c0ZpbGVuYW1lKCl9LmNzdmA7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CgkJCgkJZnVuY3Rpb24gZXhwb3J0VGFibGVBc0ltYWdlKGNvbnRhaW5lcklkLCBmaWxlbmFtZSkgewogICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTsKICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN1bHRzLXF1aXotdGl0bGUnKTsgCiAgICAKICAgIGlmICghZWxlbWVudCkgewogICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNob3dNZXNzYWdlKCLguIHguLPguKXguLHguIfguKrguKPguYnguLLguIfguKPguLnguJvguKDguLLguJ4gKOC4i+C5iOC4reC4meC4nOC4peC4peC4seC4nuC4mOC5jCkuLi4iKTsKCiAgICAvLyAxLiDguKrguKPguYnguLLguIcgQ29udGFpbmVyIOC4iuC4seC5iOC4p+C4hOC4o+C4suC4pwogICAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd3JhcHBlci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7CiAgICB3cmFwcGVyLnN0eWxlLnBhZGRpbmcgPSAnMzBweCc7CiAgICB3cmFwcGVyLnN0eWxlLndpZHRoID0gJzEwMDBweCc7IAogICAgd3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7IAogICAgd3JhcHBlci5zdHlsZS5sZWZ0ID0gJy05OTk5cHgnOwogICAgd3JhcHBlci5zdHlsZS50b3AgPSAnMCc7CiAgICB3cmFwcGVyLnN0eWxlLnpJbmRleCA9ICctMSc7CiAgICAKICAgIC8vIDIuIOC4quC4o+C5ieC4suC4h+C4q+C4seC4p+C4guC5ieC4reC4iOC4s+C4peC4reC4hwogICAgY29uc3QgaGVhZGVyQ2xvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwogICAgaGVhZGVyQ2xvbmUuaW5uZXJUZXh0ID0gdGl0bGVFbGVtZW50ID8gdGl0bGVFbGVtZW50LmlubmVyVGV4dCA6ICfguKPguLLguKLguIfguLLguJnguJzguKXguITguLDguYHguJnguJknOwogICAgaGVhZGVyQ2xvbmUuc3R5bGUudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5mb250RmFtaWx5ID0gIidTYXJhYnVuJywgc2Fucy1zZXJpZiI7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5mb250U2l6ZSA9ICcyOHB4JzsKICAgIGhlYWRlckNsb25lLnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICBoZWFkZXJDbG9uZS5zdHlsZS5jb2xvciA9ICcjNDMzOGNhJzsgCiAgICBoZWFkZXJDbG9uZS5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMjBweCc7CiAgICAKICAgIC8vIDMuIOC4quC4o+C5ieC4suC4h+C4leC4suC4o+C4suC4h+C4iOC4s+C4peC4reC4hyAoQ2xvbmUgVGFibGUpCiAgICBjb25zdCB0YWJsZUNsb25lID0gZWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7CiAgICB0YWJsZUNsb25lLnN0eWxlLm1heEhlaWdodCA9ICdub25lJzsKICAgIHRhYmxlQ2xvbmUuc3R5bGUub3ZlcmZsb3cgPSAndmlzaWJsZSc7CgogICAgLy8gLS0tIFvguYDguJ7guLTguYjguKEgTG9naWM6IOC4i+C5iOC4reC4meC4hOC4reC4peC4seC4oeC4meC5jCAi4Lic4LilIl0gLS0tCiAgICAvLyDguITguYnguJnguKvguLIgaW5kZXgg4LiC4Lit4LiH4Lir4Lix4Lin4LiC4LmJ4Lit4LiV4Liy4Lij4Liy4LiH4LiX4Li14LmI4LmA4LiC4Li14Lii4LiZ4Lin4LmI4LiyICLguJzguKUiCiAgICBjb25zdCBoZWFkZXJzID0gdGFibGVDbG9uZS5xdWVyeVNlbGVjdG9yQWxsKCd0aCcpOwogICAgbGV0IHJlc3VsdENvbHVtbkluZGV4ID0gLTE7CgogICAgaGVhZGVycy5mb3JFYWNoKCh0aCwgaW5kZXgpID0+IHsKICAgICAgICBpZiAodGgudGV4dENvbnRlbnQudHJpbSgpID09PSAn4Lic4LilJykgewogICAgICAgICAgICB0aC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyAvLyDguIvguYjguK3guJnguKvguLHguKfguILguYnguK0KICAgICAgICAgICAgcmVzdWx0Q29sdW1uSW5kZXggPSBpbmRleDsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyDguJbguYnguLLguYDguIjguK3guITguK3guKXguLHguKHguJnguYwgIuC4nOC4pSIg4LmD4Lir4LmJ4Lin4LiZ4Lil4Li54Lib4LiL4LmI4Lit4LiZ4LiC4LmJ4Lit4Lih4Li54Lil4LmD4LiZ4LiX4Li44LiB4LmB4LiW4LinCiAgICBpZiAocmVzdWx0Q29sdW1uSW5kZXggIT09IC0xKSB7CiAgICAgICAgY29uc3Qgcm93cyA9IHRhYmxlQ2xvbmUucXVlcnlTZWxlY3RvckFsbCgndHInKTsKICAgICAgICByb3dzLmZvckVhY2gocm93ID0+IHsKICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGQnKTsKICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LmB4LiW4Lin4LiZ4Li14LmJ4Lih4Li1IGNlbGwg4LiE4Lij4Lia4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZ4Lir4Lij4Li34Lit4LmE4Lih4LmIICjguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJkgZXJyb3IpCiAgICAgICAgICAgIGlmIChjZWxscy5sZW5ndGggPiByZXN1bHRDb2x1bW5JbmRleCkgewogICAgICAgICAgICAgICAgY2VsbHNbcmVzdWx0Q29sdW1uSW5kZXhdLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IC8vIOC4i+C5iOC4reC4meC4iuC5iOC4reC4h+C4guC5ieC4reC4oeC4ueC4pQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIAogICAgLy8gNC4g4Lib4Lij4Liw4LiB4Lit4Lia4Lij4LmI4Liy4LiHCiAgICB3cmFwcGVyLmFwcGVuZENoaWxkKGhlYWRlckNsb25lKTsKICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQodGFibGVDbG9uZSk7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHdyYXBwZXIpOwoKICAgIC8vIDUuIOC4quC4seC5iOC4hyBodG1sMmNhbnZhcyDguJbguYjguLLguKLguKPguLnguJsKICAgIGh0bWwyY2FudmFzKHdyYXBwZXIsIHsKICAgICAgICBzY2FsZTogMiwgCiAgICAgICAgdXNlQ09SUzogdHJ1ZSwKICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJwogICAgfSkudGhlbihjYW52YXMgPT4gewogICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgbGluay5kb3dubG9hZCA9IGAke2ZpbGVuYW1lfS5wbmdgOwogICAgICAgIGxpbmsuaHJlZiA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwogICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICAKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHdyYXBwZXIpOwogICAgICAgIG1lc3NhZ2VNb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH0pLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXhwb3J0IEltYWdlIEVycm9yOiIsIGVycik7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh3cmFwcGVyKTsKICAgICAgICBzaG93TWVzc2FnZSgi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4Liq4Lij4LmJ4Liy4LiH4Lij4Li54Lib4Lig4Liy4LieIik7CiAgICB9KTsKfQoKICAgICAgICAvLyBSRUZBQ1RPUkVEIGV4cG9ydFJlc3VsdHNBc1BERiB0byBleHBvcnRUYWJsZUFzUERGCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0VGFibGVBc1BERih0YWJsZUlkLCBmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCB7IGpzUERGIH0gPSB3aW5kb3cuanNwZGY7CiAgICAgICAgICAgIGNvbnN0IGRvYyA9IG5ldyBqc1BERigpOwogICAgICAgICAgICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywgJ25vcm1hbCcpOyAKICAgICAgICAgICAgZG9jLmF1dG9UYWJsZSh7IGh0bWw6IGAjJHt0YWJsZUlkfWAgfSk7CiAgICAgICAgICAgIGRvYy5zYXZlKGAke2ZpbGVuYW1lfS5wZGZgKTsKICAgICAgICB9CgogICAgICAgIC8vIFJFRkFDVE9SRUQgZXhwb3J0UmVzdWx0c0FzV29yZCB0byBleHBvcnRUYWJsZUFzV29yZAogICAgICAgIGZ1bmN0aW9uIGV4cG9ydFRhYmxlQXNXb3JkKGNvbnRhaW5lcklkLCBmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVySWQpOwogICAgICAgICAgICBpZiAoIWVsZW1lbnQpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gIjxodG1sIHhtbG5zOm89J3VybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZScgIisKICAgICAgICAgICAgICAgICJ4bWxuczp3PSd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkJyAiKwogICAgICAgICAgICAgICAgInhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwJz4iKwogICAgICAgICAgICAgICAgIjxoZWFkPjxtZXRhIGNoYXJzZXQ9J3V0Zi04Jz48dGl0bGU+RXhwb3J0IEhUTUwgdG8gV29yZDwvdGl0bGU+PC9oZWFkPjxib2R5PiI7CiAgICAgICAgICAgIGNvbnN0IGZvb3RlciA9ICI8L2JvZHk+PC9odG1sPiI7CiAgICAgICAgICAgIGNvbnN0IHNvdXJjZUhUTUwgPSBoZWFkZXIgKyBlbGVtZW50LmlubmVySFRNTCArIGZvb3RlcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9ICdkYXRhOmFwcGxpY2F0aW9uL3ZuZC5tcy13b3JkO2NoYXJzZXQ9dXRmLTgsJyArIGVuY29kZVVSSUNvbXBvbmVudChzb3VyY2VIVE1MKTsKICAgICAgICAgICAgY29uc3QgZmlsZURvd25sb2FkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVEb3dubG9hZCk7CiAgICAgICAgICAgIGZpbGVEb3dubG9hZC5ocmVmID0gc291cmNlOwogICAgICAgICAgICBmaWxlRG93bmxvYWQuZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uZG9jYDsKICAgICAgICAgICAgZmlsZURvd25sb2FkLmNsaWNrKCk7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZmlsZURvd25sb2FkKTsKICAgICAgICB9CgogICAgICAgIC8vIFJFRkFDVE9SRUQgZXhwb3J0UmVzdWx0c0FzRXhjZWwgdG8gZXhwb3J0VGFibGVBc0V4Y2VsCiAgICAgICAgZnVuY3Rpb24gZXhwb3J0VGFibGVBc0V4Y2VsKHRhYmxlSWQsIGZpbGVuYW1lKSB7CiAgICAgICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGFibGVJZCk7CiAgICAgICAgICAgIGlmICghdGFibGUpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguYTguKHguYjguJ7guJrguJXguLLguKPguLLguIfguKrguLPguKvguKPguLHguJogRXhwb3J0Iik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGV0IGNzdiA9IFtdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRhYmxlLnJvd3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXSwgY29scyA9IHRhYmxlLnJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbCgndGQsIHRoJyk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvbHMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICByb3cucHVzaCgnIicgKyBjb2xzW2pdLmlubmVyVGV4dC5yZXBsYWNlKC8iL2csICciIicpICsgJyInKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNzdi5wdXNoKHJvdy5qb2luKCcsJykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGNzdkZpbGUgPSBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoWzB4RUYsIDB4QkIsIDB4QkZdKSwgY3N2LmpvaW4oJ1xuJyldLCB7dHlwZTogJ3RleHQvY3N2O2NoYXJzZXQ9dXRmLTg7J30pOwogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGNzdkZpbGUpOwogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYCR7ZmlsZW5hbWV9LmNzdmA7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CgogZnVuY3Rpb24gcmVuZGVyQW5hbHl0aWNzKHF1aXpEYXRhLCBzdWJtaXNzaW9ucykgIHsgLyogUmVtb3ZlZCAqLyB9IAoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRXhwb3J0TGVzc29uUERGKCkgewogICAgY29uc3QgbGVzc29uQ29udGVudEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImxlc3Nvbi1wbGFuLWNvbnRlbnQiKTsKICAgIGNvbnN0IHF1aXpUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsZXNzb24tcGxhbi10aXRsZScpLnRleHRDb250ZW50OwogICAgCiAgICAvLyDguYDguJvguLTguJTguKvguJnguYnguLLguJXguYjguLLguIfguYPguKvguKHguYjguYDguJ7guLfguYjguK3guYDguJXguKPguLXguKLguKHguJ7guLTguKHguJ7guYwKICAgIGNvbnN0IHByaW50V2luZG93ID0gd2luZG93Lm9wZW4oJycsICdfYmxhbmsnKTsKCiAgICAvLyDguKrguKPguYnguLLguIfguYLguITguKPguIfguKrguKPguYnguLLguIcgSFRNTCDguJfguLHguYnguIfguKvguKHguJTguKrguLPguKvguKPguLHguJrguKvguJnguYnguLLguJfguLXguYjguIjguLDguJ7guLTguKHguJ7guYwKICAgIGNvbnN0IHByaW50SHRtbCA9IGAKICAgICAgICA8IURPQ1RZUEUgaHRtbD4KICAgICAgICA8aHRtbCBsYW5nPSJ0aCI+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgICAgICAgICAgPHRpdGxlPiR7cXVpelRpdGxlfTwvdGl0bGU+CiAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi50YWlsd2luZGNzcy5jb20iPjxcL3NjcmlwdD4KICAgICAgICAgICAgPGxpbmsgaHJlZj0iaHR0cHM6Ly9mb250cy5nb29nbGVhcGlzLmNvbS9jc3MyP2ZhbWlseT1TYXJhYnVuOndnaHRANDAwOzcwMCZkaXNwbGF5PXN3YXAiIHJlbD0ic3R5bGVzaGVldCI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8c2NyaXB0PgogICAgICAgICAgICAgICAgd2luZG93Lk1hdGhKYXggPSB7CiAgICAgICAgICAgICAgICAgICAgdGV4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlubGluZU1hdGg6IFtbJyQnLCAnJCddLCBbJ1xcXFwoJywgJ1xcXFwpJ11dCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgPFwvc2NyaXB0PgogICAgICAgICAgICA8c2NyaXB0IGlkPSJNYXRoSmF4LXNjcmlwdCIgYXN5bmMgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21hdGhqYXhAMy9lczUvdGV4LW1tbC1jaHRtbC5qcyI+PFwvc2NyaXB0PgogICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICBib2R5IHsgCiAgICAgICAgICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdTYXJhYnVuJywgc2Fucy1zZXJpZjsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAbWVkaWEgcHJpbnQgewogICAgICAgICAgICAgICAgICAgIGJvZHkgeyAtd2Via2l0LXByaW50LWNvbG9yLWFkanVzdDogZXhhY3Q7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5jb250ZW50LXNlY3Rpb24geyAKICAgICAgICAgICAgICAgICAgICBwYWdlLWJyZWFrLWluc2lkZTogYXZvaWQ7IC8qIOC4m+C5ieC4reC4h+C4geC4seC4meC4geC4suC4o+C4leC4seC4lOC5gOC4meC4t+C5ieC4reC4q+C4suC4guC5ieC4suC4oeC4q+C4meC5ieC4siAqLwogICAgICAgICAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDJyZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTggbWF4LXctNHhsIG14LWF1dG8iPgogICAgICAgICAgICAke2xlc3NvbkNvbnRlbnRFbC5pbm5lckhUTUx9IAogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwogICAgCiAgICAvLyDguYDguILguLXguKLguJkgSFRNTCDguKXguIfguYPguJnguKvguJnguYnguLLguJXguYjguLLguIfguYPguKvguKHguYgKICAgIHByaW50V2luZG93LmRvY3VtZW50LndyaXRlKHByaW50SHRtbCk7CiAgICBwcmludFdpbmRvdy5kb2N1bWVudC5jbG9zZSgpOwoKICAgIC8vIOC4leC4seC5ieC4h+C5gOC4p+C4peC4suC4q+C4meC5iOC4p+C4h+C5gOC4nuC4t+C5iOC4reC5g+C4q+C5iSBNYXRoSmF4IHJlbmRlciDguKrguLnguJXguKPguITguJPguLTguJXguKjguLLguKrguJXguKPguYwgKOC4luC5ieC4suC4oeC4tSkg4LmD4Lir4LmJ4LmA4Liq4Lij4LmH4LiI4LiB4LmI4Lit4LiZ4Liq4Lix4LmI4LiH4Lie4Li04Lih4Lie4LmMCiAgICBwcmludFdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcHJpbnRXaW5kb3cucHJpbnQoKTsKICAgICAgICB9LCAxNTAwKTsgLy8g4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4LiyIDEuNSDguKfguLTguJnguLLguJfguLUKICAgIH07Cn0KCi8vIC0tLSBbIOC5gOC4nuC4tOC5iOC4oeC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4meC4teC5ieC5gOC4guC5ieC4suC5hOC4m+C5g+C4q+C4oeC5iOC4l+C4seC5ieC4h+C4q+C4oeC4lCBdIC0tLQpmdW5jdGlvbiByZW5kZXJJbnRlcmVzdGluZ1N0YXRzKHF1aXpEYXRhLCBzdWJtaXNzaW9ucykgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ludGVyZXN0aW5nLXN0YXRzLWNvbnRhaW5lcicpOwogICAgaWYgKCFjb250YWluZXIpIHJldHVybjsKICAgIGlmIChzdWJtaXNzaW9ucy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIGNvbC1zcGFuLWZ1bGwgdGV4dC1jZW50ZXIiPuC4ouC4seC4h+C5hOC4oeC5iOC4oeC4teC4guC5ieC4reC4oeC4ueC4peC5gOC4nuC4teC4ouC4h+C4nuC4reC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4h+C4quC4luC4tOC4leC4tDwvcD4nOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyAxLiDguITguLPguJnguKfguJPguKrguJbguLTguJXguLTguKPguLLguKLguILguYnguK0gKOC4q+C4suC4guC5ieC4reC4l+C4teC5iOC4luC4ueC4gS/guJzguLTguJTguKHguLLguIHguJfguLXguYjguKrguLjguJQpCiAgICBjb25zdCBxdWVzdGlvblN0YXRzID0gcXVpekRhdGEucXVlc3Rpb25zLm1hcCgocSwgaW5kZXgpID0+ICh7CiAgICAgICAgaW5kZXg6IGluZGV4ICsgMSwKICAgICAgICB0ZXh0OiBxLnF1ZXN0aW9uVGV4dCB8fCBxLnN0ZW0sCiAgICAgICAgY29ycmVjdDogMAogICAgfSkpOwoKICAgIHN1Ym1pc3Npb25zLmZvckVhY2goc3ViID0+IHsKICAgICAgICBjb25zdCBsYXRlc3RBdHRlbXB0ID0gc3ViLmF0dGVtcHRzW3N1Yi5hdHRlbXB0cy5sZW5ndGggLSAxXTsKICAgICAgICBpZiAobGF0ZXN0QXR0ZW1wdCAmJiBsYXRlc3RBdHRlbXB0LmFuc3dlcnMpIHsKICAgICAgICAgICAgbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZvckVhY2goYW5zID0+IHsKICAgICAgICAgICAgICAgIC8vIOC4hOC5ieC4meC4q+C4suC4guC5ieC4reC4l+C4teC5iOC4luC4ueC4geC4leC5ieC4reC4h+C4iOC4suC4gSAi4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4LiC4Lit4LiH4LiE4Liz4LiW4Liy4LihIiDguYHguJfguJnguJfguLXguYjguIjguLDguYPguIrguYkgIuC4leC4s+C5geC4q+C4meC5iOC4hyIKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRUb1VwZGF0ZSA9IHF1ZXN0aW9uU3RhdHMuZmluZChxID0+IHEudGV4dCA9PT0gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0ICYmIHN0YXRUb1VwZGF0ZSkgewogICAgICAgICAgICAgICAgICAgIHN0YXRUb1VwZGF0ZS5jb3JyZWN0Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIGNvbnN0IHRvdGFsU3VibWlzc2lvbnMgPSBzdWJtaXNzaW9ucy5sZW5ndGg7CiAgICBjb25zdCBtYXhDb3JyZWN0Q291bnQgPSBNYXRoLm1heCguLi5xdWVzdGlvblN0YXRzLm1hcChxID0+IHEuY29ycmVjdCkpOwogICAgY29uc3QgbWluQ29ycmVjdENvdW50ID0gTWF0aC5taW4oLi4ucXVlc3Rpb25TdGF0cy5tYXAocSA9PiBxLmNvcnJlY3QpKTsKCiAgICBjb25zdCBtb3N0Q29ycmVjdFF1ZXN0aW9ucyA9IHF1ZXN0aW9uU3RhdHMKICAgICAgICAuZmlsdGVyKHEgPT4gcS5jb3JyZWN0ID09PSBtYXhDb3JyZWN0Q291bnQpCiAgICAgICAgLm1hcChxID0+IGDguILguYnguK0gJHtxLmluZGV4fWApOwogICAgICAgIAogICAgY29uc3QgbGVhc3RDb3JyZWN0UXVlc3Rpb25zID0gcXVlc3Rpb25TdGF0cwogICAgICAgIC5maWx0ZXIocSA9PiBxLmNvcnJlY3QgPT09IG1pbkNvcnJlY3RDb3VudCkKICAgICAgICAubWFwKHEgPT4gYOC4guC5ieC4rSAke3EuaW5kZXh9YCk7CgogICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4Liq4LiW4Li04LiV4Li04Lij4Liy4Lii4LiE4LiZICjguKvguLLguITguJnguJfguLXguYjguJbguLnguIEv4Lic4Li04LiU4Lih4Liy4LiB4LiX4Li14LmI4Liq4Li44LiUKQogICAgY29uc3QgdG9wU2NvcmVycyA9IHN1Ym1pc3Npb25zCiAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIubGF0ZXN0U2NvcmUgLSBhLmxhdGVzdFNjb3JlKQogICAgICAgIC5maWx0ZXIoKHMsIGksIGFycikgPT4gcy5sYXRlc3RTY29yZSA9PT0gYXJyWzBdLmxhdGVzdFNjb3JlKTsKCiAgICBjb25zdCBsb3dlc3RTY29yZXJzID0gc3VibWlzc2lvbnMKICAgICAgICAuc29ydCgoYSwgYikgPT4gYS5sYXRlc3RTY29yZSAtIGIubGF0ZXN0U2NvcmUpCiAgICAgICAgLmZpbHRlcigocywgaSwgYXJyKSA9PiBzLmxhdGVzdFNjb3JlID09PSBhcnJbMF0ubGF0ZXN0U2NvcmUpOwoKICAgIC8vIDMuIOC4quC4o+C5ieC4suC4hyBIVE1MIOC4quC4s+C4q+C4o+C4seC4muC4geC4suC4o+C5jOC4lOC5geC4leC5iOC4peC4sOC5g+C4mgogICAgY29uc3QgaHRtbCA9IGAKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmVlbi01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWdyZWVuLTIwMCI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIGZhLWxnIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCI+4LiC4LmJ4Lit4LiX4Li14LmI4LiX4Liz4LiW4Li54LiB4Lih4Liy4LiB4LiX4Li14LmI4Liq4Li44LiUPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1ncmVlbi04MDAgdGV4dC1sZyI+JHttb3N0Q29ycmVjdFF1ZXN0aW9ucy5qb2luKCcsICcpfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4oJHttYXhDb3JyZWN0Q291bnR9IC8gJHt0b3RhbFN1Ym1pc3Npb25zfSDguITguJkpPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJiZy1yZWQtNTAgcC00IHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1yZWQtMjAwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctcmVkLTEwMCB0ZXh0LXJlZC02MDAgcC0yIHJvdW5kZWQtZnVsbCBtci0zIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSBmYS1sZyI+PC9pPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAiPuC4guC5ieC4reC4l+C4teC5iOC4l+C4s+C4nOC4tOC4lOC4oeC4suC4geC4l+C4teC5iOC4quC4uOC4lDwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtcmVkLTgwMCB0ZXh0LWxnIj4ke2xlYXN0Q29ycmVjdFF1ZXN0aW9ucy5qb2luKCcsICcpfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4oJHt0b3RhbFN1Ym1pc3Npb25zIC0gbWluQ29ycmVjdENvdW50fSAvICR7dG90YWxTdWJtaXNzaW9uc30g4LiE4LiZKTwvcD4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0iYmctYmx1ZS01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWJsdWUtMjAwIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5IGZhLWxnIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTYwMCI+4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li14LmI4LiE4Liw4LmB4LiZ4LiZ4Liq4Li54LiH4Liq4Li44LiUPC9wPgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1ibHVlLTgwMCB0ZXh0LWxnIj4ke3RvcFNjb3JlcnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSkuam9pbignLCAnKX08L3A+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+KOC5hOC4lOC5iSAke3RvcFNjb3JlcnNbMF0ubGF0ZXN0U2NvcmV9IOC4hOC4sOC5geC4meC4mSk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImJnLXllbGxvdy01MCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLXllbGxvdy0yMDAiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTYwMCBwLTIgcm91bmRlZC1mdWxsIG1yLTMiPgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtaGFuZHMtaGVscGluZyBmYS1sZyI+PC9pPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LXNtIHRleHQtZ3JheS02MDAiPuC4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4teC5iOC4hOC4p+C4o+C4lOC4ueC5geC4peC5gOC4m+C5h+C4meC4nuC4tOC5gOC4qOC4qTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQteWVsbG93LTgwMCB0ZXh0LWxnIj4ke2xvd2VzdFNjb3JlcnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSkuam9pbignLCAnKX08L3A+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+KOC5hOC4lOC5iSAke2xvd2VzdFNjb3JlcnNbMF0ubGF0ZXN0U2NvcmV9IOC4hOC4sOC5geC4meC4mSk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9IGh0bWw7Cn0KCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyU3VibWlzc2lvbkNoYXJ0KHN1Ym1pdHRlZENvdW50LCBub3RTdWJtaXR0ZWRDb3VudCwgc3VibWlzc2lvbnMsIHN0dWRlbnRzKSB7CiAgICAgICAgICAgIGNvbnN0IGN0eCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXNzaW9uLXN0YXR1cy1jaGFydCcpLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIGNvbnN0IHN1Ym1pdHRlZE5hbWVzID0gc3VibWlzc2lvbnMubWFwKHMgPT4gcy5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgIGNvbnN0IG5vdFN1Ym1pdHRlZE5hbWVzID0gc3R1ZGVudHMuZmlsdGVyKG5hbWUgPT4gIXN1Ym1pdHRlZE5hbWVzLmluY2x1ZGVzKG5hbWUpKTsKCiAgICAgICAgICAgIGlmIChjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uLmRlc3Ryb3koKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zdWJtaXNzaW9uID0gbmV3IENoYXJ0KGN0eCwgewogICAgICAgICAgICAgICAgdHlwZTogJ2RvdWdobnV0JywKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IFsn4Liq4LmI4LiH4LmB4Lil4LmJ4LinJywgJ+C4ouC4seC4h+C5hOC4oeC5iOC4quC5iOC4hyddLAogICAgICAgICAgICAgICAgICAgIGRhdGFzZXRzOiBbewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBbc3VibWl0dGVkQ291bnQsIG5vdFN1Ym1pdHRlZENvdW50XSwKICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBbJyMxMEI5ODEnLCAnI0Y1OUUwQiddLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogWycjZmZmZmZmJywgJyNmZmZmZmYnXSwKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDIKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHBsdWdpbnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kOiB7IHBvc2l0aW9uOiAnYm90dG9tJyB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogZnVuY3Rpb24oY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGFiZWwgPSBjb250ZXh0LmxhYmVsIHx8ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGFiZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsICs9ICc6ICc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwgKz0gY29udGV4dC5yYXc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyTGFiZWw6IGZ1bmN0aW9uKGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5kYXRhSW5kZXggPT09IDApIHsgLy8gU3VibWl0dGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyA9IHN1Ym1pdHRlZE5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBOb3QgU3VibWl0dGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lcyA9IG5vdFN1Ym1pdHRlZE5hbWVzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lcy5sZW5ndGggPiAwID8gbmFtZXMuam9pbignXG4nKSA6ICfguYTguKHguYjguKHguLUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiByZW5kZXJTY29yZURpc3RyaWJ1dGlvbkNoYXJ0KHN1Ym1pc3Npb25zLCB0b3RhbFF1ZXN0aW9ucykgewogICAgICAgICAgICBjb25zdCBjdHggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmUtZGlzdHJpYnV0aW9uLWNoYXJ0JykuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgY29uc3Qgc2NvcmVDb3VudHMgPSB7fTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdG90YWxRdWVzdGlvbnM7IGkrKykgewogICAgICAgICAgICAgICAgc2NvcmVDb3VudHNbaV0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1Ym1pc3Npb25zLmZvckVhY2goc3ViID0+IHsKICAgICAgICAgICAgICAgIGlmIChzY29yZUNvdW50c1tzdWIubGF0ZXN0U2NvcmVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBzY29yZUNvdW50c1tzdWIubGF0ZXN0U2NvcmVdKys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGNoYXJ0SW5zdGFuY2VzLnNjb3JlKSB7CiAgICAgICAgICAgICAgICBjaGFydEluc3RhbmNlcy5zY29yZS5kZXN0cm95KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhcnRJbnN0YW5jZXMuc2NvcmUgPSBuZXcgQ2hhcnQoY3R4LCB7CiAgICAgICAgICAgICAgICB0eXBlOiAnYmFyJywKICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICBsYWJlbHM6IE9iamVjdC5rZXlzKHNjb3JlQ291bnRzKSwKICAgICAgICAgICAgICAgICAgICBkYXRhc2V0czogW3sKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICfguIjguLPguJnguKfguJnguJnguLHguIHguYDguKPguLXguKLguJknLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBPYmplY3QudmFsdWVzKHNjb3JlQ291bnRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoNzksIDcwLCAyMjksIDAuOCknLAogICAgICAgICAgICAgICAgICAgICAgICBib3JkZXJDb2xvcjogJ3JnYmEoNzksIDcwLCAyMjksIDEpJywKICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyV2lkdGg6IDEKICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgICAgICAgICAgICByZXNwb25zaXZlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHNjYWxlczogewogICAgICAgICAgICAgICAgICAgICAgICB5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbkF0WmVybzogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpY2tzOiB7IHN0ZXBTaXplOiAxIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgeDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHsgZGlzcGxheTogdHJ1ZSwgdGV4dDogJ+C4hOC4sOC5geC4meC4mScgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBwbHVnaW5zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZDogeyBkaXNwbGF5OiBmYWxzZSB9LAogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlckxhYmVsOiBmdW5jdGlvbihjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNjb3JlID0gY29udGV4dC5sYWJlbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3R1ZGVudHNXaXRoU2NvcmUgPSBzdWJtaXNzaW9ucwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihzID0+IHMubGF0ZXN0U2NvcmUgPT0gc2NvcmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubWFwKHMgPT4gcy5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHVkZW50c1dpdGhTY29yZS5sZW5ndGggPiAwID8gc3R1ZGVudHNXaXRoU2NvcmUuam9pbignXG4nKSA6ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgZnVuY3Rpb24gcmVuZGVyUXVlc3Rpb25BbmFseXRpY3MocXVpekRhdGEsIHN1Ym1pc3Npb25zLCBzdHVkZW50cykgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uLWFuYWx5dGljcy1jb250YWluZXInKTsKICAgIGlmIChzdHVkZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtY2VudGVyIj7guKLguLHguIfguYTguKHguYjguKHguLXguJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguYLguJvguKPguYDguIjguITguYDguJ7guLfguYjguK3guKfguLTguYDguITguKPguLLguLDguKvguYzguKPguLLguKLguILguYnguK08L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iCAxOiDguYDguKPguLXguKLguIHguYPguIrguYnguJ/guLHguIfguIHguYzguIrguLHguJnguITguLPguJnguKfguJPguKrguJbguLTguJXguLTguJfguLHguYnguIfguKvguKHguJTguJfguLXguYjguIjguLPguYDguJvguYfguJkgLS0tCiAgICBjb25zdCBpdGVtQW5hbHlzaXMgPSBjYWxjdWxhdGVJdGVtQW5hbHlzaXMocXVpekRhdGEsIHN1Ym1pc3Npb25zKTsKICAgIGNvbnN0IGRpc3RyYWN0b3JBbmFseXNpcyA9IGNhbGN1bGF0ZURpc3RyYWN0b3JBbmFseXNpcyhxdWl6RGF0YSwgc3VibWlzc2lvbnMpOwoKICAgIC8vIC0tLSDguKrguYjguKfguJnguJfguLXguYggMjog4Liq4Lij4LmJ4Liy4LiH4LiB4Lil4LmI4Lit4LiH4Liq4Lij4Li44Lib4Lig4Liy4Lie4Lij4Lin4Lih4LiC4Lit4LiH4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiH4LmB4Lil4Liw4LiB4Lil4Li44LmI4Lih4Lit4LmI4Lit4LiZICjguKrguYjguKfguJnguYPguKvguKHguYgpIC0tLQogICAgbGV0IG92ZXJhbGxHcm91cHNIVE1MID0gJyc7CiAgICBpZiAoaXRlbUFuYWx5c2lzLm92ZXJhbGxHcm91cHMpIHsKICAgICAgICBvdmVyYWxsR3JvdXBzSFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNCBwLTQgYm9yZGVyIHJvdW5kZWQtbGcgYmctZ3JheS0xMDAiPgogICAgICAgICAgICAgICAgPGg0IGNsYXNzPSJmb250LXNlbWlib2xkIG1iLTIiPuC4quC4o+C4uOC4m+C4oOC4suC4nuC4o+C4p+C4oeC4geC4peC4uOC5iOC4oeC4l+C4teC5iOC5g+C4iuC5ieC5g+C4meC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jDwvaDQ+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00IHRleHQtc20iPgogICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPuC4geC4peC4uOC5iOC4oeC5gOC4geC5iOC4hyAoJHtpdGVtQW5hbHlzaXMub3ZlcmFsbEdyb3Vwcy51cHBlckdyb3VwTmFtZXMubGVuZ3RofSDguITguJkpPC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8dWwgY2xhc3M9Imxpc3QtZGlzYyBsaXN0LWluc2lkZSB0ZXh0LWdyYXktNjAwIG10LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtpdGVtQW5hbHlzaXMub3ZlcmFsbEdyb3Vwcy51cHBlckdyb3VwTmFtZXMubWFwKG5hbWUgPT4gYDxsaT4ke25hbWV9PC9saT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCI+4LiB4Lil4Li44LmI4Lih4Lit4LmI4Lit4LiZICgke2l0ZW1BbmFseXNpcy5vdmVyYWxsR3JvdXBzLmxvd2VyR3JvdXBOYW1lcy5sZW5ndGh9IOC4hOC4mSk8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHRleHQtZ3JheS02MDAgbXQtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW1BbmFseXNpcy5vdmVyYWxsR3JvdXBzLmxvd2VyR3JvdXBOYW1lcy5tYXAobmFtZSA9PiBgPGxpPiR7bmFtZX08L2xpPmApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9CgogICAgLy8gLS0tIOC4quC5iOC4p+C4meC4l+C4teC5iCAzOiDguKrguKPguYnguLLguIcgSFRNTCDguKrguLPguKvguKPguLHguJrguKPguLLguKLguKXguLDguYDguK3guLXguKLguJTguYHguJXguYjguKXguLDguILguYnguK0gKOC4p+C4mSBMb29wKSAtLS0KICAgIGxldCBodG1sID0gJyc7CiAgICBjb25zdCBzdWJtaXR0ZWROYW1lcyA9IHN1Ym1pc3Npb25zLm1hcChzID0+IHMuc3R1ZGVudE5hbWUpOwoKICAgLy8g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4Lia4Liq4Lij4LmJ4Liy4LiHIEJhZGdlIOC4guC4reC4h+C4hOC5iOC4suC4hOC4p+C4suC4oeC4ouC4suC4gSAocCkKY29uc3QgZ2V0UEJhZGdlID0gKHApID0+IHsKICAgIGlmIChwID49IDAuODApIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLXRlYWwtMTAwIHRleHQtdGVhbC04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guIfguYjguLLguKLguKHguLLguIE8L3NwYW4+YDsKICAgIGlmIChwID49IDAuNjApIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLWdyZWVuLTEwMCB0ZXh0LWdyZWVuLTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4h+C5iOC4suC4ojwvc3Bhbj5gOwogICAgaWYgKHAgPj0gMC40MCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4m+C4suC4meC4geC4peC4suC4hyAo4LmA4Lir4Lih4Liy4Liw4Liq4LihKTwvc3Bhbj5gOwogICAgaWYgKHAgPj0gMC4yMCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guKLguLLguIE8L3NwYW4+YDsKICAgIHJldHVybiBgPHNwYW4gY2xhc3M9ImJnLXJlZC0xMDAgdGV4dC1yZWQtODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4Lii4Liy4LiB4Lih4Liy4LiBPC9zcGFuPmA7Cn07CiAgICAvLyDguJ/guLHguIfguIHguYzguIrguLHguJnguKrguLPguKvguKPguLHguJrguKrguKPguYnguLLguIcgQmFkZ2Ug4LiC4Lit4LiH4LiE4LmI4Liy4Lit4Liz4LiZ4Liy4LiI4LiI4Liz4LmB4LiZ4LiBIChyKQpjb25zdCBnZXRSQmFkZ2UgPSAocikgPT4gewogICAgaWYgKHIgPCAwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1waW5rLTIwMCB0ZXh0LXBpbmstOTAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCIgdGl0bGU9IuC4reC4suC4iOC4l+C4s+C5g+C4q+C5ieC5gOC4lOC5h+C4geC4reC5iOC4reC4meC4leC4reC4muC4luC4ueC4geC4oeC4suC4geC4geC4p+C5iOC4suC5gOC4lOC5h+C4geC5gOC4geC5iOC4hyDguJXguYnguK3guIfguYHguIHguYnguYTguILguKvguKPguLfguK3guJXguLHguJTguJfguLTguYnguIciPuC4nOC4tOC4lOC4m+C4geC4leC4tDwvc3Bhbj5gOwogICAgaWYgKHIgPj0gMC40MCkgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4LiU4Li14Lih4Liy4LiBPC9zcGFuPmA7CiAgICBpZiAociA+PSAwLjMwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1ibHVlLTEwMCB0ZXh0LWJsdWUtODAwIHRleHQteHMgZm9udC1zZW1pYm9sZCBweC0yIHJvdW5kZWQtZnVsbCI+4LiU4Li1PC9zcGFuPmA7CiAgICBpZiAociA+PSAwLjIwKSByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCB0ZXh0LXhzIGZvbnQtc2VtaWJvbGQgcHgtMiByb3VuZGVkLWZ1bGwiPuC4nuC4reC5g+C4iuC5iTwvc3Bhbj5gOwogICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAgdGV4dC14cyBmb250LXNlbWlib2xkIHB4LTIgcm91bmRlZC1mdWxsIj7guITguKfguKPguJvguKPguLHguJrguJvguKPguLjguIc8L3NwYW4+YDsKfTsKCi8vIOC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4quC4s+C4q+C4o+C4seC4muC4quC4o+C5ieC4suC4hyBCYWRnZSDguILguK3guIfguYDguJvguK3guKPguYzguYDguIvguYfguJnguJXguYzguITguJnguJXguK3guJrguJbguLnguIEgKOC5geC4geC5ieC5hOC4guC4peC5iOC4suC4quC4uOC4lCkKY29uc3QgZ2V0UGVyY2VudENvcnJlY3RCYWRnZSA9IChyYXRlKSA9PiB7CiAgICBjb25zdCByb3VuZGVkUmF0ZSA9IHJhdGUudG9GaXhlZCgwKTsKICAgIAogICAgLy8gPT09IOC5gOC4h+C4t+C5iOC4reC4meC5hOC4guC4l+C4teC5iOC5gOC4nuC4tOC5iOC4oeC5gOC4guC5ieC4suC4oeC4suC5g+C4q+C4oeC5iCA9PT0KICAgIC8vIOC4luC5ieC4suC4hOC4sOC5geC4meC4meC5gOC4l+C5iOC4suC4geC4seC4miAxMDAlIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4quC4teC5gOC4guC4teC4ouC4pwogICAgaWYgKHBhcnNlRmxvYXQocm91bmRlZFJhdGUpID09PSAxMDApIHsKICAgICAgICByZXR1cm4gYDxzcGFuIGNsYXNzPSJiZy1ncmVlbi0yMDAgdGV4dC1ncmVlbi05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7CiAgICB9CiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy8g4LiW4LmJ4Liy4LmA4Lib4Lit4Lij4LmM4LmA4LiL4LmH4LiZ4LiV4LmM4Lih4Liy4LiB4LiB4Lin4LmI4Liy4Lir4Lij4Li34Lit4LmA4LiX4LmI4Liy4LiB4Lix4LiaIDUwJSDguYPguKvguYnguYDguJvguYfguJnguJvguYnguLLguKLguKrguLXguYDguKvguKXguLfguK3guIcKICAgIGlmIChyYXRlID49IDUwKSB7CiAgICAgICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmcteWVsbG93LTIwMCB0ZXh0LXllbGxvdy05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7CiAgICB9CiAgICAvLyDguJnguYnguK3guKLguIHguKfguYjguLIgNTAlIOC5g+C4q+C5ieC5gOC4m+C5h+C4meC4m+C5ieC4suC4ouC4quC4teC5geC4lOC4hwogICAgcmV0dXJuIGA8c3BhbiBjbGFzcz0iYmctcmVkLTIwMCB0ZXh0LXJlZC05MDAgZm9udC1zZW1pYm9sZCBweC0zIHB5LTEgcm91bmRlZC1tZCB0ZXh0LXhzIj7guJXguK3guJrguJbguLnguIEgJHtyb3VuZGVkUmF0ZX0lPC9zcGFuPmA7Cn07CgogICAgcXVpekRhdGEucXVlc3Rpb25zLmZvckVhY2goKHEsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBpdGVtQW5hbHlzaXMucGVyUXVlc3Rpb25TdGF0c1tpbmRleF07IC8vIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4iOC4suC4geC5guC4hOC4o+C4h+C4quC4o+C5ieC4suC4h+C5g+C4q+C4oeC5iAogICAgICAgIGNvbnN0IGRpc3RyYWN0b3JzID0gZGlzdHJhY3RvckFuYWx5c2lzW2luZGV4XTsKICAgICAgICBjb25zdCBxdWVzdGlvbkRpc3BsYXlUZXh0ID0gcS5zdGVtIHx8IHEucXVlc3Rpb25UZXh0IHx8IHEuaW5zdHJ1Y3Rpb25zOwoKICAgICAgICAvLyDguITguLPguJnguKfguJPguKrguLHguJTguKrguYjguKfguJnguITguJnguJXguK3guJrguJbguLnguIEv4Lic4Li04LiUICjguKDguLLguJ7guKPguKfguKEpCiAgICAgICAgbGV0IGNvcnJlY3RDb3VudCA9IDA7CiAgICAgICAgY29uc3QgY29ycmVjdFN0dWRlbnRzID0gW107CiAgICAgICAgY29uc3QgaW5jb3JyZWN0U3R1ZGVudHMgPSBbXTsKICAgICAgICBzdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAobGF0ZXN0QXR0ZW1wdCAmJiBsYXRlc3RBdHRlbXB0LmFuc3dlcnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckl0ZW0gPSBsYXRlc3RBdHRlbXB0LmFuc3dlcnMuZmluZChhbnMgPT4gYW5zLm9yaWdpbmFsUXVlc3Rpb25UZXh0ID09PSBxdWVzdGlvbkRpc3BsYXlUZXh0KSA/PyBsYXRlc3RBdHRlbXB0LmFuc3dlcnNbaW5kZXhdID8/IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoYW5zd2VySXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb3JyZWN0Q291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdFN0dWRlbnRzLnB1c2goc3ViLnN0dWRlbnROYW1lKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpbmNvcnJlY3RTdHVkZW50cy5wdXNoKHN1Yi5zdHVkZW50TmFtZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgY29ycmVjdFJhdGUgPSBzdWJtaXNzaW9ucy5sZW5ndGggPiAwID8gKGNvcnJlY3RDb3VudCAvIHN1Ym1pc3Npb25zLmxlbmd0aCkgKiAxMDAgOiAwOwogICAgICAgIGNvbnN0IHVuc3VibWl0dGVkU3R1ZGVudHMgPSBzdHVkZW50cy5maWx0ZXIobmFtZSA9PiAhc3VibWl0dGVkTmFtZXMuaW5jbHVkZXMobmFtZSkpOwoKICAgICAgIGNvbnN0IGFuYWx5c2lzSFRNTCA9IGFuYWx5c2lzID8gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCBib3JkZXItbCBwbC00IG1sLTIiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgZm9udC1zYW5zIj7guITguYjguLLguITguKfguLLguKHguKLguLLguIEgKHApPC9wPjxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC1pbmRpZ28tNzAwIHRleHQtbGciPiR7YW5hbHlzaXMucC50b0ZpeGVkKDIpfTwvcD48ZGl2PiR7Z2V0UEJhZGdlKGFuYWx5c2lzLnApfTwvZGl2PjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIiPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgZm9udC1zYW5zIj7guITguYjguLLguK3guLPguJnguLLguIjguIjguLPguYHguJnguIEgKHIpPC9wPjxwIGNsYXNzPSJmb250LWJvbGQgdGV4dC10ZWFsLTcwMCB0ZXh0LWxnIj4ke2FuYWx5c2lzLnIudG9GaXhlZCgyKX08L3A+PGRpdj4ke2dldFJCYWRnZShhbmFseXNpcy5yKX08L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcGwtMiI+CiAgICAgICAgICAgICAgICAgICAgJHtnZXRQZXJjZW50Q29ycmVjdEJhZGdlKGNvcnJlY3RSYXRlKX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+YCA6ICcnOwoKICAgICAgICAvLyDguKrguKPguYnguLLguIfguJXguLLguKPguLLguIfguKfguLTguYDguITguKPguLLguLDguKvguYzguJXguLHguKfguKXguKfguIcKICAgICAgICBsZXQgZGlzdHJhY3RvclRhYmxlSFRNTCA9ICcnOwogICAgICAgIGlmIChkaXN0cmFjdG9ycykgewogICAgICAgICAgICBkaXN0cmFjdG9yVGFibGVIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtNCI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQiPuC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4leC4seC4p+C5gOC4peC4t+C4reC4gTo8L3A+CiAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJtaW4tdy1mdWxsIGJnLXdoaXRlIGJvcmRlciBtdC0xIHRleHQteHMiPgogICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9ImJnLWdyYXktMjAwIj48dHI+PHRoIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgdGV4dC1sZWZ0Ij7guJXguLHguKfguYDguKXguLfguK3guIE8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guIHguKXguLjguYjguKHguYDguIHguYjguIc8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guIHguKXguLjguYjguKHguK3guYjguK3guJk8L3RoPjx0aCBjbGFzcz0icHktMSBweC0yIGJvcmRlci1iIHRleHQtY2VudGVyIj7guKPguKfguKE8L3RoPjwvdHI+PC90aGVhZD4KICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5PiR7T2JqZWN0LmtleXMoZGlzdHJhY3RvcnMpLm1hcChvcHRJbmRleCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGRpc3RyYWN0b3JzW29wdEluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NvcnJlY3QgPSBwYXJzZUludChvcHRJbmRleCkgPT09IHEuY29ycmVjdEFuc3dlckluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzR29vZERpc3RyYWN0b3IgPSAhaXNDb3JyZWN0ICYmIGRhdGEubG93ZXJfZ3JvdXBfY291bnQgPiBkYXRhLnVwcGVyX2dyb3VwX2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgPHRyIGNsYXNzPSIke2lzQ29ycmVjdCA/ICdiZy1ncmVlbi0xMDAgZm9udC1ib2xkJyA6ICcnfSI+PHRkIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIiPiR7aXNDb3JyZWN0ID8gJ+KclCAnIDogJyd9JHtkYXRhLnRleHR9PC90ZD48dGQgY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtkYXRhLnVwcGVyX2dyb3VwX2NvdW50fTwvdGQ+PHRkIGNsYXNzPSJweS0xIHB4LTIgYm9yZGVyLWIgdGV4dC1jZW50ZXIiPiR7ZGF0YS5sb3dlcl9ncm91cF9jb3VudH0gJHtpc0dvb2REaXN0cmFjdG9yID8gJ/CfkY0nIDogJyd9PC90ZD48dGQgY2xhc3M9InB5LTEgcHgtMiBib3JkZXItYiB0ZXh0LWNlbnRlciI+JHtkYXRhLnRvdGFsfTwvdGQ+PC90cj5gOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuam9pbignJyl9CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+PC90YWJsZT48L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4Liq4LmI4Lin4LiZ4LmB4Liq4LiU4LiH4Lij4Liy4Lii4LiK4Li34LmI4Lit4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiHL+C4reC5iOC4reC4meC4quC4s+C4q+C4o+C4seC4muC4guC5ieC4reC4meC4seC5ieC4meC5hiAo4Liq4LmI4Lin4LiZ4LmD4Lir4Lih4LmIKQogICAgICAgIGxldCBncm91cERldGFpbHNIVE1MID0gJyc7CiAgICAgICAgaWYgKGFuYWx5c2lzICYmIGFuYWx5c2lzLnVwcGVyR3JvdXBSZXNwb25kZXJzKSB7CiAgICAgICAgICAgIGdyb3VwRGV0YWlsc0hUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC00IGdyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXY+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTgwMCI+4LiB4Lil4Li44LmI4Lih4LmA4LiB4LmI4LiHICgke2FuYWx5c2lzLnVwcGVyR3JvdXBSZXNwb25kZXJzLmxlbmd0aH0g4LiE4LiZKTo8L3A+PHVsIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiBzcGFjZS15LTEgbXQtMSI+JHthbmFseXNpcy51cHBlckdyb3VwUmVzcG9uZGVycy5tYXAoc3R1ZGVudCA9PiBgPGxpPiR7c3R1ZGVudC5pc0NvcnJlY3QgPyAnPGkgY2xhc3M9ImZhcyBmYS1jaGVjay1jaXJjbGUgdGV4dC1ncmVlbi01MDAiPjwvaT4nIDogJzxpIGNsYXNzPSJmYXMgZmEtdGltZXMtY2lyY2xlIHRleHQtcmVkLTUwMCI+PC9pPid9ICR7c3R1ZGVudC5uYW1lfTwvbGk+YCkuam9pbignJyl9PC91bD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2PjxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPuC4geC4peC4uOC5iOC4oeC4reC5iOC4reC4mSAoJHthbmFseXNpcy5sb3dlckdyb3VwUmVzcG9uZGVycy5sZW5ndGh9IOC4hOC4mSk6PC9wPjx1bCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNjAwIHBsLTIgc3BhY2UteS0xIG10LTEiPiR7YW5hbHlzaXMubG93ZXJHcm91cFJlc3BvbmRlcnMubWFwKHN0dWRlbnQgPT4gYDxsaT4ke3N0dWRlbnQuaXNDb3JyZWN0ID8gJzxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIHRleHQtZ3JlZW4tNTAwIj48L2k+JyA6ICc8aSBjbGFzcz0iZmFzIGZhLXRpbWVzLWNpcmNsZSB0ZXh0LXJlZC01MDAiPjwvaT4nfSAke3N0dWRlbnQubmFtZX08L2xpPmApLmpvaW4oJycpfTwvdWw+PC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgIH0KCiAgICAgICAgLy8g4Lib4Lij4Liw4LiB4Lit4Lia4Lij4LmI4Liy4LiHIEhUTUwg4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LiC4Lit4LiH4LiC4LmJ4Lit4LiZ4Lix4LmJ4LiZ4LmGCiAgICAgICAgaHRtbCArPSBgCiAgICAgICAgICAgIDxkZXRhaWxzIGNsYXNzPSJiZy1ncmF5LTUwIHAtMyByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgIDxzdW1tYXJ5IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgY3Vyc29yLXBvaW50ZXIgZm9udC1zZW1pYm9sZCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InctMi80IHRydW5jYXRlIj7guILguYnguK0gJHtpbmRleCArIDF9OiAke3F1ZXN0aW9uRGlzcGxheVRleHR9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00Ij4ke2FuYWx5c2lzSFRNTH08aSBjbGFzcz0iZmFzIGZhLWNoZXZyb24tcmlnaHQgZGV0YWlscy1tYXJrZXIiPjwvaT48L2Rpdj4KICAgICAgICAgICAgICAgIDwvc3VtbWFyeT4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im10LTMgcHQtMyBib3JkZXItdCB0ZXh0LXNtIHNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guITguLPguJbguLLguKE6PC9zdHJvbmc+ICR7cXVlc3Rpb25EaXNwbGF5VGV4dH08L3A+CiAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7guKrguJbguLTguJXguLQ6PC9zdHJvbmc+IOC4meC4seC4geC5gOC4o+C4teC4ouC4mSAke2NvcnJlY3RDb3VudH0g4LiI4Liy4LiBICR7c3VibWlzc2lvbnMubGVuZ3RofSDguITguJnguJfguLXguYjguKrguYjguIcg4LiV4Lit4Lia4LiW4Li54LiBICgke2NvcnJlY3RSYXRlLnRvRml4ZWQoMCl9JSk8L3A+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtMiI+PHAgY2xhc3M9ImZvbnQtc2VtaWJvbGQgdGV4dC1ncmVlbi03MDAiPuC4leC4reC4muC4luC4ueC4gSAoJHtjb3JyZWN0U3R1ZGVudHMubGVuZ3RofSDguITguJkpOjwvcD48cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNjAwIHBsLTIiPiR7Y29ycmVjdFN0dWRlbnRzLmxlbmd0aCA+IDAgPyBjb3JyZWN0U3R1ZGVudHMuam9pbignLCAnKSA6ICfguYTguKHguYjguKHguLUnfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIj48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LXJlZC03MDAiPuC4leC4reC4muC4nOC4tOC4lCAoJHtpbmNvcnJlY3RTdHVkZW50cy5sZW5ndGh9IOC4hOC4mSk6PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiI+JHtpbmNvcnJlY3RTdHVkZW50cy5sZW5ndGggPiAwID8gaW5jb3JyZWN0U3R1ZGVudHMuam9pbignLCAnKSA6ICfguYTguKHguYjguKHguLUnfTwvcD48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIj48cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNTAwIj7guKLguLHguIfguYTguKHguYjguKrguYjguIcgKCR7dW5zdWJtaXR0ZWRTdHVkZW50cy5sZW5ndGh9IOC4hOC4mSk6PC9wPjxwIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS02MDAgcGwtMiI+JHt1bnN1Ym1pdHRlZFN0dWRlbnRzLmxlbmd0aCA+IDAgPyB1bnN1Ym1pdHRlZFN0dWRlbnRzLmpvaW4oJywgJykgOiAn4LmE4Lih4LmI4Lih4Li1J308L3A+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgJHtkaXN0cmFjdG9yVGFibGVIVE1MfQogICAgICAgICAgICAgICAgICAgICR7Z3JvdXBEZXRhaWxzSFRNTH0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2RldGFpbHM+CiAgICAgICAgYDsKICAgIH0pOwogICAgCiAgICAvLyAtLS0g4Liq4LmI4Lin4LiZ4LiX4Li14LmIIDQ6IOC4meC4syBIVE1MIOC4l+C4seC5ieC4h+C4q+C4oeC4lOC5hOC4m+C5geC4quC4lOC4h+C4nOC4peC5g+C4meC4q+C4meC5ieC4suC5gOC4p+C5h+C4miAtLS0KICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBvdmVyYWxsR3JvdXBzSFRNTCArIGh0bWw7CiAgICAKICAgIHRyeSB7CiAgICAgICAgaWYgKHdpbmRvdy5NYXRoSmF4ICYmIE1hdGhKYXgudHlwZXNldFByb21pc2UpIHsKICAgICAgICAgICAgTWF0aEpheC50eXBlc2V0UHJvbWlzZShbY29udGFpbmVyXSk7CiAgICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ01hdGhKYXggdHlwZXNldCBlcnJvciAoYW5hbHl0aWNzKTonLCBlKTsKICAgIH0KfQoKLyoqCiAqIOC4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4m+C4o+C4sOC4quC4tOC4l+C4mOC4tOC4oOC4suC4nuC4guC4reC4h+C4leC4seC4p+C4peC4p+C4h+C5g+C4meC4guC5ieC4reC4quC4reC4muC4m+C4o+C4meC4seC4ouC5geC4leC5iOC4peC4sOC4guC5ieC4rQogKiBAcGFyYW0ge29iamVjdH0gcXVpekRhdGEg4LiC4LmJ4Lit4Lih4Li54Lil4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4LiaCiAqIEBwYXJhbSB7QXJyYXl9IHN1Ym1pc3Npb25zIOC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4quC5iOC4h+C4h+C4suC4meC4guC4reC4h+C4meC4seC4geC5gOC4o+C4teC4ouC4meC4l+C4uOC4geC4hOC4mQogKiBAcmV0dXJucyB7b2JqZWN0fSDguJzguKXguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYzguJXguLHguKfguKXguKfguIfguILguK3guIfguYHguJXguYjguKXguLDguILguYnguK0KICovCmZ1bmN0aW9uIGNhbGN1bGF0ZURpc3RyYWN0b3JBbmFseXNpcyhxdWl6RGF0YSwgc3VibWlzc2lvbnMpIHsKICAgIGNvbnN0IGRpc3RyYWN0b3JSZXN1bHRzID0ge307CiAgICBpZiAoc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgcmV0dXJuIGRpc3RyYWN0b3JSZXN1bHRzOwoKICAgIGNvbnN0IHNvcnRlZFN1Ym1pc3Npb25zID0gWy4uLnN1Ym1pc3Npb25zXS5zb3J0KChhLCBiKSA9PiB7CiAgICAvLyAxLiDguYDguKPguLXguKLguIfguJXguLLguKHguITguLDguYHguJnguJnguKXguYjguLLguKrguLjguJQgKOC4oeC4suC4geC5hOC4m+C4meC5ieC4reC4oikKICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIubGF0ZXN0U2NvcmUgLSBhLmxhdGVzdFNjb3JlOwogICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKCiAgICAvLyAyLiDguJbguYnguLLguITguLDguYHguJnguJnguYDguJfguYjguLLguIHguLHguJkg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LiI4Liz4LiZ4Lin4LiZ4LiE4Lij4Lix4LmJ4LiH4LiX4Li14LmI4LiX4LizICjguJnguYnguK3guKLguYTguJvguKHguLLguIEpCiAgICBjb25zdCBhdHRlbXB0c0EgPSBhLmF0dGVtcHRzPy5sZW5ndGggfHwgMTsKICAgIGNvbnN0IGF0dGVtcHRzQiA9IGIuYXR0ZW1wdHM/Lmxlbmd0aCB8fCAxOwogICAgY29uc3QgYXR0ZW1wdERpZmYgPSBhdHRlbXB0c0EgLSBhdHRlbXB0c0I7CiAgICBpZiAoYXR0ZW1wdERpZmYgIT09IDApIHJldHVybiBhdHRlbXB0RGlmZjsKCiAgICAvLyAzLiDguJbguYnguLLguIjguLPguJnguKfguJnguITguKPguLHguYnguIfguYDguJfguYjguLLguIHguLHguJkg4LmD4Lir4LmJ4LmA4Lij4Li14Lii4LiH4LiV4Liy4Lih4LmA4Lin4Lil4Liy4LiX4Li14LmI4Liq4LmI4LiHICjguIHguYjguK3guJnguYTguJvguKvguKXguLHguIcpCiAgICBjb25zdCB0aW1lQSA9IG5ldyBEYXRlKGEubGF0ZXN0U3VibWl0dGVkQXQpOwogICAgY29uc3QgdGltZUIgPSBuZXcgRGF0ZShiLmxhdGVzdFN1Ym1pdHRlZEF0KTsKICAgIGNvbnN0IHRpbWVEaWZmID0gdGltZUEgLSB0aW1lQjsKICAgIGlmICh0aW1lRGlmZiAhPT0gMCkgcmV0dXJuIHRpbWVEaWZmOwoKICAgIC8vIDQuIOC4luC5ieC4suC5gOC4p+C4peC4suC4quC5iOC4h+C5gOC4l+C5iOC4suC4geC4seC4mSDguYPguKvguYnguYDguKPguLXguKLguIfguJXguLLguKHguIrguLfguYjguK0gKOC4gS3guK4pCiAgICByZXR1cm4gYS5zdHVkZW50TmFtZS5sb2NhbGVDb21wYXJlKGIuc3R1ZGVudE5hbWUsICd0aCcpOwp9KTsKICAgIGNvbnN0IHRvdGFsU3R1ZGVudHMgPSBzb3J0ZWRTdWJtaXNzaW9ucy5sZW5ndGg7CiAgICBjb25zdCBncm91cFNpemUgPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKHRvdGFsU3R1ZGVudHMgKiAwLjMzKSk7IC8vIOC4m+C5ieC4reC4h+C4geC4seC4mSBncm91cFNpemUg4LmA4Lib4LmH4LiZIDAKCiAgICBjb25zdCB1cHBlckdyb3VwID0gc29ydGVkU3VibWlzc2lvbnMuc2xpY2UoMCwgZ3JvdXBTaXplKTsKICAgIGNvbnN0IGxvd2VyR3JvdXAgPSBzb3J0ZWRTdWJtaXNzaW9ucy5zbGljZSgtZ3JvdXBTaXplKTsKCiAgICBxdWl6RGF0YS5xdWVzdGlvbnMuZm9yRWFjaCgocXVlc3Rpb24sIGluZGV4KSA9PiB7CiAgICAgICAgLy8g4LiX4Liz4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LmA4LiJ4Lie4Liy4Liw4LiC4LmJ4Lit4Liq4Lit4Lia4Lib4Lij4LiZ4Lix4Lii4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZCiAgICAgICAgaWYgKHF1ZXN0aW9uLnF1ZXN0aW9uVHlwZSAhPT0gJ211bHRpcGxlX2Nob2ljZScgfHwgIXF1ZXN0aW9uLm9wdGlvbnMpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcXVlc3Rpb25UZXh0ID0gcXVlc3Rpb24ucXVlc3Rpb25UZXh0OwogICAgICAgIGNvbnN0IGFuYWx5c2lzID0ge307CiAgICAgICAgLy8g4Liq4Lij4LmJ4Liy4LiH4LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4Liq4Liz4Lir4Lij4Lix4Lia4LiZ4Lix4Lia4LmB4LiV4LmI4Lil4Liw4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBCiAgICAgICAgcXVlc3Rpb24ub3B0aW9ucy5mb3JFYWNoKChvcHQsIG9wdEluZGV4KSA9PiB7CiAgICAgICAgICAgIGFuYWx5c2lzW29wdEluZGV4XSA9IHsKICAgICAgICAgICAgICAgIHRleHQ6IG9wdCwKICAgICAgICAgICAgICAgIHVwcGVyX2dyb3VwX2NvdW50OiAwLAogICAgICAgICAgICAgICAgbG93ZXJfZ3JvdXBfY291bnQ6IDAsCiAgICAgICAgICAgICAgICB0b3RhbDogMAogICAgICAgICAgICB9OwogICAgICAgIH0pOwoKICAgICAgICAvLyDguKfguJnguKXguLnguJvguYDguJ7guLfguYjguK3guJnguLHguJrguIjguLPguJnguKfguJnguITguJnguYDguKXguLfguK3guIHguYPguJnguYHguJXguYjguKXguLDguIHguKXguLjguYjguKEKICAgICAgICBzb3J0ZWRTdWJtaXNzaW9ucy5mb3JFYWNoKHN1YiA9PiB7CiAgICAgICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBjb25zdCBhbnN3ZXJJdGVtID0gbGF0ZXN0QXR0ZW1wdC5hbnN3ZXJzLmZpbmQoYW5zID0+IGFucy5vcmlnaW5hbFF1ZXN0aW9uVGV4dCA9PT0gcXVlc3Rpb25UZXh0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChhbnN3ZXJJdGVtICYmIGFuc3dlckl0ZW0uYW5zd2VyICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyAtLS0g4LiI4Li44LiU4LmB4LiB4LmJ4LmE4LiC4Lia4Lix4LmK4LiBIC0tLQogICAgICAgICAgICAgICAgLy8g4LiE4LmJ4LiZ4Lir4Liy4LiU4Lix4LiK4LiZ4Li14LiX4Li14LmI4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LiI4Liy4LiBICLguILguYnguK3guITguKfguLLguKEiIOC5geC4l+C4meC4l+C4teC5iOC4iOC4sOC5g+C4iuC5iSAi4LiV4Liz4LmB4Lir4LiZ4LmI4LiHIiDguJfguLXguYjguJzguLTguJTguYDguJ7guLXguYnguKLguJkKICAgICAgICAgICAgICAgIGNvbnN0IGNvcnJlY3RPcmlnaW5hbEluZGV4ID0gcXVlc3Rpb24ub3B0aW9ucy5maW5kSW5kZXgob3B0ID0+IG9wdCA9PT0gYW5zd2VySXRlbS5hbnN3ZXJUZXh0KTsKCiAgICAgICAgICAgICAgICBpZiAoY29ycmVjdE9yaWdpbmFsSW5kZXggIT09IC0xICYmIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XSkgewogICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS50b3RhbCsrOwoKICAgICAgICAgICAgICAgICAgICAvLyDguYDguIrguYfguITguKfguYjguLLguYDguJvguYfguJnguITguJnguYPguJnguIHguKXguLjguYjguKHguYDguIHguYjguIfguKvguKPguLfguK3guIHguKXguLjguYjguKHguK3guYjguK3guJkKICAgICAgICAgICAgICAgICAgICBpZiAodXBwZXJHcm91cC5pbmNsdWRlcyhzdWIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS51cHBlcl9ncm91cF9jb3VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobG93ZXJHcm91cC5pbmNsdWRlcyhzdWIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFuYWx5c2lzW2NvcnJlY3RPcmlnaW5hbEluZGV4XS5sb3dlcl9ncm91cF9jb3VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGRpc3RyYWN0b3JSZXN1bHRzW2luZGV4XSA9IGFuYWx5c2lzOwogICAgfSk7CgogICAgcmV0dXJuIGRpc3RyYWN0b3JSZXN1bHRzOwp9CgovKioKICog4LiE4Liz4LiZ4Lin4LiT4LiE4LmI4Liy4LiE4Lin4Liy4Lih4LmA4LiK4Li34LmI4Lit4Lih4Lix4LmI4LiZ4LiC4Lit4LiH4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiU4LmJ4Lin4Lii4Liq4Li54LiV4LijIEtSLTIwCiAqIEBwYXJhbSB7b2JqZWN0fSBxdWl6RGF0YSDguILguYnguK3guKHguLnguKXguILguK3guIfguYHguJrguJrguJfguJTguKrguK3guJoKICogQHBhcmFtIHtBcnJheX0gc3VibWlzc2lvbnMg4LiC4LmJ4Lit4Lih4Li54Lil4LiB4Liy4Lij4Liq4LmI4LiH4LiH4Liy4LiZ4LiC4Lit4LiH4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LiX4Li44LiB4LiE4LiZCiAqIEBwYXJhbSB7b2JqZWN0fSBpdGVtQW5hbHlzaXMg4Lic4Lil4LiB4Liy4Lij4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiE4LmI4LiyIHAg4LiC4Lit4LiH4LmB4LiV4LmI4Lil4Liw4LiC4LmJ4LitCiAqIEByZXR1cm5zIHtudW1iZXJ8bnVsbH0g4LiE4LmI4LiyIEtSLTIwIOC4q+C4o+C4t+C4rSBudWxsIOC4luC5ieC4suC4hOC4s+C4meC4p+C4k+C5hOC4oeC5iOC5hOC4lOC5iQogKi8KLy8g4LmC4LiE4LmJ4LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiC4LmB4Lil4LmJ4LinCmZ1bmN0aW9uIGNhbGN1bGF0ZVJlbGlhYmlsaXR5S1IyMChxdWl6RGF0YSwgc3VibWlzc2lvbnMsIGl0ZW1BbmFseXNpcykgewogICAgY29uc3QgayA9IHF1aXpEYXRhLnF1ZXN0aW9ucy5sZW5ndGg7CiAgICBpZiAoayA8IDIgfHwgc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgcmV0dXJuIG51bGw7CgogICAgLy8gLS0tIFvguYHguIHguYnguYTguIJdIOC4hOC4s+C4meC4p+C4k+C4hOC4sOC5geC4meC4meC4lOC4tOC4muC5geC4muC4miAi4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4Lit4LiX4Li14LmI4LiW4Li54LiBIiAoVW53ZWlnaHRlZCBTY29yZSkgLS0tCiAgICAvLyDguYDguJ7guLfguYjguK3guYPguKvguYnguKrguK3guJTguITguKXguYnguK3guIfguIHguLHguJrguKrguLnguJXguKMgS1ItMjAg4LiX4Li14LmI4LmD4LiK4LmJ4LiE4LmI4LiyIHAgKOC4quC4seC4lOC4quC5iOC4p+C4meC4hOC4meC4leC4reC4muC4luC4ueC4gSkKICAgIGNvbnN0IHVud2VpZ2h0ZWRTY29yZXMgPSBzdWJtaXNzaW9ucy5tYXAoc3ViID0+IHsKICAgICAgICAvLyDguJTguLbguIfguIHguLLguKPguJfguLPguITguKPguLHguYnguIfguKXguYjguLLguKrguLjguJQKICAgICAgICBjb25zdCBhdHRlbXB0ID0gc3ViLmF0dGVtcHRzICYmIHN1Yi5hdHRlbXB0cy5sZW5ndGggPiAwIAogICAgICAgICAgICA/IHN1Yi5hdHRlbXB0c1tzdWIuYXR0ZW1wdHMubGVuZ3RoIC0gMV0gCiAgICAgICAgICAgIDogbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgaWYgKCFhdHRlbXB0IHx8ICFhdHRlbXB0LmFuc3dlcnMpIHJldHVybiAwOwogICAgICAgIAogICAgICAgIC8vIOC4meC4seC4muC4iOC4s+C4meC4p+C4meC4guC5ieC4reC4l+C4teC5iOC4leC4reC4muC4luC4ueC4gSAoaXNDb3JyZWN0ID0gdHJ1ZSkg4LmC4LiU4Lii4LmE4Lih4LmI4Liq4LiZ4LmD4LiI4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LiE4Liw4LmB4LiZ4LiZCiAgICAgICAgcmV0dXJuIGF0dGVtcHQuYW5zd2Vycy5maWx0ZXIoYSA9PiBhLmlzQ29ycmVjdCkubGVuZ3RoOwogICAgfSk7CgogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiE4Lin4Liy4Lih4LmB4Lib4Lij4Lib4Lij4Lin4LiZIChWYXJpYW5jZSkg4LiI4Liy4LiB4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4LiX4Li14LmI4LiZ4Lix4Lia4LiI4Liz4LiZ4Lin4LiZ4LiC4LmJ4LitCiAgICBjb25zdCBtZWFuID0gdW53ZWlnaHRlZFNjb3Jlcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHVud2VpZ2h0ZWRTY29yZXMubGVuZ3RoOwogICAgY29uc3Qgc2NvcmVWYXJpYW5jZSA9IHVud2VpZ2h0ZWRTY29yZXMubWFwKHNjb3JlID0+IE1hdGgucG93KHNjb3JlIC0gbWVhbiwgMikpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gdW53ZWlnaHRlZFNjb3Jlcy5sZW5ndGg7CgogICAgaWYgKHNjb3JlVmFyaWFuY2UgPT09IDApIHJldHVybiBudWxsOwoKICAgIGxldCBzdW1fcHEgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrOyBpKyspIHsKICAgICAgICBjb25zdCBwID0gaXRlbUFuYWx5c2lzW2ldPy5wOwogICAgICAgIGlmIChwID09PSB1bmRlZmluZWQpIGNvbnRpbnVlOwogICAgICAgIGNvbnN0IHEgPSAxIC0gcDsKICAgICAgICBzdW1fcHEgKz0gcCAqIHE7CiAgICB9CgogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4Lin4Liy4Lih4LiW4Li54LiB4LiV4LmJ4Lit4LiH4LiC4Lit4LiHIHN1bV9wcQogICAgaWYgKHN1bV9wcSA9PT0gMCkgcmV0dXJuIG51bGw7CgogICAgY29uc3Qga3IyMCA9IChrIC8gKGsgLSAxKSkgKiAoMSAtIChzdW1fcHEgLyBzY29yZVZhcmlhbmNlKSk7CgogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4LiE4LmI4Liy4LmA4LiB4Li04LiZIDEgKOC4nOC4tOC4lOC4m+C4geC4leC4tCkKICAgIGlmIChrcjIwID4gMSkgcmV0dXJuIG51bGw7CgogICAgcmV0dXJuIGtyMjA7Cn0KCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlQW5hbHl6ZUNsYXNzKCkgewogICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4Lih4Li14LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LiB4Liz4Lil4Lix4LiH4LiU4Li54Lit4Lii4Li54LmI4Lir4Lij4Li34Lit4LmE4Lih4LmICiAgICBpZiAoIWN1cnJlbnRRdWl6RGF0YSB8fCAhY3VycmVudFF1aXpEYXRhLmlkKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDog4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4Lib4Lix4LiI4LiI4Li44Lia4Lix4LiZIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHN1Ym1pc3Npb25zUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9xdWl6emVzLyR7Y3VycmVudFF1aXpEYXRhLmlkfS9zdWJtaXNzaW9uc2ApOwogICAgY29uc3Qgc3VibWlzc2lvbnNTbmFwc2hvdCA9IGF3YWl0IGdldERvY3Moc3VibWlzc2lvbnNSZWYpOwogICAgY29uc3Qgc3VibWlzc2lvbnMgPSBzdWJtaXNzaW9uc1NuYXBzaG90LmRvY3MubWFwKGRvYyA9PiBkb2MuZGF0YSgpKTsKCiAgICBpZiAoc3VibWlzc2lvbnMubGVuZ3RoIDwgMikgewogICAgICAgIHNob3dNZXNzYWdlKCLguJXguYnguK3guIfguKHguLXguJnguLHguIHguYDguKPguLXguKLguJnguKrguYjguIfguIfguLLguJnguK3guKLguYjguLLguIfguJnguYnguK3guKIgMiDguITguJnguILguLbguYnguJnguYTguJsg4LiI4Li24LiH4LiI4Liw4Liq4Liy4Lih4Liy4Lij4LiW4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4Lig4Liy4Lie4Lij4Lin4Lih4LmE4LiU4LmJIik7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGFuYWx5c2lzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVuZ3RoLXdlYWtuZXNzLWFuYWx5c2lzLWNvbnRhaW5lcicpOwogICAgYW5hbHlzaXNDb250YWluZXIuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InRleHQtY2VudGVyIHB5LTgiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2FkZXIgbXgtYXV0byI+PC9kaXY+CiAgICAgICAgICAgIDxwIGNsYXNzPSJtdC00IHRleHQtZ3JheS02MDAiPkFJIOC4geC4s+C4peC4seC4h+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4oOC4suC4nuC4o+C4p+C4oS4uLiDguK3guLLguIjguYPguIrguYnguYDguKfguKXguLLguKrguLHguIHguITguKPguLnguYg8L3A+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuYWx5emUtc3RyZW5ndGhzLWJ0bicpLmRpc2FibGVkID0gdHJ1ZTsKCiAgICAvLyDguKrguKPguLjguJvguILguYnguK3guKHguLnguKXguITguLPguJXguK3guJrguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguJfguLjguIHguITguJnguYDguJ7guLfguYjguK3guKrguYjguIfguYPguKvguYkgQUkKICAgIGNvbnN0IHN0dWRlbnREYXRhU3VtbWFyeSA9IHN1Ym1pc3Npb25zLm1hcCgoc3ViLCBpbmRleCkgPT4gewogICAgICAgIGNvbnN0IGxhdGVzdEF0dGVtcHQgPSBzdWIuYXR0ZW1wdHNbc3ViLmF0dGVtcHRzLmxlbmd0aCAtIDFdOwogICAgICAgIGlmICghbGF0ZXN0QXR0ZW1wdCkgcmV0dXJuICcnOyAvLyDguILguYnguLLguKHguIHguKPguJPguLXguJfguLXguYjguYTguKHguYjguKHguLXguILguYnguK3guKHguLnguKXguIHguLLguKPguJfguLPguILguYnguK3guKrguK3guJoKICAgICAgICByZXR1cm4gYAogICAgICAgICAgICDguJnguLHguIHguYDguKPguLXguKLguJnguITguJnguJfguLXguYggJHtpbmRleCArIDF9ICgke3N1Yi5zdHVkZW50TmFtZX0pOgogICAgICAgICAgICDguITguLDguYHguJnguJk6ICR7bGF0ZXN0QXR0ZW1wdC5zY29yZX0vJHtzdWIudG90YWxRdWVzdGlvbnN9CiAgICAgICAgICAgIOC4hOC4s+C4leC4reC4muC4o+C4suC4ouC4guC5ieC4rTogJHtKU09OLnN0cmluZ2lmeShsYXRlc3RBdHRlbXB0LmFuc3dlcnMpfQogICAgICAgIGA7CiAgICB9KS5qb2luKCdcbi0tLVxuJyk7CgogICAgY29uc3QgYW5hbHlzaXNQcm9tcHQgPSBgCiAgICAgICAg4LiE4Li44LiT4LiE4Li34Lit4LiZ4Lix4LiB4Lin4Li04LmA4LiE4Lij4Liy4Liw4Lir4LmM4LiB4Liy4Lij4Lio4Li24LiB4Lip4Liy4Lic4Li54LmJ4LmA4LiK4Li14LmI4Lii4Lin4LiK4Liy4LiNIOC4oOC4suC4o+C4geC4tOC4iOC4guC4reC4h+C4hOC4uOC4k+C4hOC4t+C4reC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4oOC4suC4nuC4o+C4p+C4oeC4guC4reC4h+C4q+C5ieC4reC4h+C5gOC4o+C4teC4ouC4meC4iOC4suC4geC4guC5ieC4reC4oeC4ueC4peC4geC4suC4o+C4l+C4s+C5geC4muC4muC4l+C4lOC4quC4reC4mgoKICAgICAgICDguYHguJrguJrguJfguJTguKrguK3guJrguYDguKPguLfguYjguK3guIc6ICIke2N1cnJlbnRRdWl6RGF0YS50b3BpY30iCiAgICAgICAg4LiC4LmJ4Lit4Lih4Li54Lil4LiE4Liz4LiW4Liy4Lih4LiX4Lix4LmJ4LiH4Lir4Lih4LiUOiAke0pTT04uc3RyaW5naWZ5KGN1cnJlbnRRdWl6RGF0YS5xdWVzdGlvbnMpfQoKICAgICAgICDguJnguLXguYjguITguLfguK3guILguYnguK3guKHguLnguKXguKrguKPguLjguJvguILguK3guIfguJnguLHguIHguYDguKPguLXguKLguJnguYPguJnguKvguYnguK3guIc6CiAgICAgICAgJHtzdHVkZW50RGF0YVN1bW1hcnl9CgogICAgICAgIOC4iOC4suC4geC4guC5ieC4reC4oeC4ueC4peC4l+C4seC5ieC4h+C4q+C4oeC4lCDguYLguJvguKPguJTguKfguLTguYDguITguKPguLLguLDguKvguYzguYHguKXguLDguKrguKPguLjguJvguJzguKXguK3guK3guIHguKHguLLguYDguJvguYfguJkgSlNPTiBvYmplY3Qg4LiX4Li14LmI4Lih4Li14LmC4LiE4Lij4LiH4Liq4Lij4LmJ4Liy4LiH4LiU4Lix4LiH4LiZ4Li14LmJ4LmA4LiX4LmI4Liy4LiZ4Lix4LmJ4LiZOgogICAgICAgIC0gY2xhc3NTdHJlbmd0aHM6IOC4iOC4uOC4lOC5geC4guC5h+C4h+C5guC4lOC4ouC4o+C4p+C4oeC4guC4reC4h+C4q+C5ieC4reC4h+C5gOC4o+C4teC4ouC4meC4meC4teC5iSDguKvguKPguLfguK3guITguK3guJnguYDguIvguYfguJvguJXguYzguJfguLXguYjguJnguLHguIHguYDguKPguLXguKLguJnguKrguYjguKfguJnguYPguKvguI3guYjguYDguILguYnguLLguYPguIjguJXguKPguIfguIHguLHguJkgKGFycmF5IOC4guC4reC4hyBzdHJpbmcpCiAgICAgICAgLSBjbGFzc1dlYWtuZXNzZXM6IOC4iOC4uOC4lOC4reC5iOC4reC4meC5guC4lOC4ouC4o+C4p+C4oSDguKvguKPguLfguK3guITguKfguLLguKHguYDguILguYnguLLguYPguIjguJzguLTguJTguJfguLXguYjguJ7guJrguJrguYjguK3guKLguJfguLXguYjguKrguLjguJQgKGFycmF5IOC4guC4reC4hyBzdHJpbmcpCiAgICAgICAgLSB0ZWFjaGVyU3VnZ2VzdGlvbnM6IOC4guC5ieC4reC5gOC4quC4meC4reC5geC4meC4sOC5gOC4iuC4tOC4h+C4m+C4j+C4tOC4muC4seC4leC4tCAyLTMg4LiC4LmJ4Lit4Liq4Liz4Lir4Lij4Lix4Lia4LiE4Lij4Li5IOC5gOC4nuC4t+C5iOC4reC4meC4s+C5hOC4m+C4nuC4seC4kuC4meC4suC4geC4suC4o+C4quC4reC4meC5g+C4meC4hOC4o+C4seC5ieC4h+C4leC5iOC4reC5hOC4myAoYXJyYXkg4LiC4Lit4LiHIHN0cmluZykKCiAgICAgICAg4LiV4Lit4Lia4LmA4Lib4LmH4LiZ4Lig4Liy4Lip4Liy4LmE4LiX4Lii4LiX4Lix4LmJ4LiH4Lir4Lih4LiUCiAgICBgOwoKICAgIGNvbnN0IGFuYWx5c2lzU2NoZW1hID0gewogICAgICAgIHR5cGU6ICJPQkpFQ1QiLAogICAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICAgICAgY2xhc3NTdHJlbmd0aHM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LAogICAgICAgICAgICBjbGFzc1dlYWtuZXNzZXM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9LAogICAgICAgICAgICB0ZWFjaGVyU3VnZ2VzdGlvbnM6IHsgdHlwZTogIkFSUkFZIiwgaXRlbXM6IHsgdHlwZTogIlNUUklORyIgfSB9CiAgICAgICAgfSwKICAgICAgICByZXF1aXJlZDogWyJjbGFzc1N0cmVuZ3RocyIsICJjbGFzc1dlYWtuZXNzZXMiLCAidGVhY2hlclN1Z2dlc3Rpb25zIl0KICAgIH07CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBhbmFseXNpc1Jlc3VsdCA9IGF3YWl0IGNhbGxBbmFseXNpc0FwaShhbmFseXNpc1Byb21wdCwgYW5hbHlzaXNTY2hlbWEpOwogICAgICAgIGRpc3BsYXlDbGFzc0FuYWx5c2lzKGFuYWx5c2lzUmVzdWx0KTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIGNsYXNzIGFuYWx5c2lzOiIsIGVycm9yKTsKICAgICAgICBhbmFseXNpc0NvbnRhaW5lci5pbm5lckhUTUwgPSBgPGRpdiBjbGFzcz0idGV4dC1yZWQtNTAwIHRleHQtY2VudGVyIj48cD7guILguK3guK3guKDguLHguKIsIOC4geC4suC4o+C4p+C4tOC5gOC4hOC4o+C4suC4sOC4q+C5jOC4peC5ieC4oeC5gOC4q+C4peC4pzogJHtlcnJvci5tZXNzYWdlfTwvcD48L2Rpdj5gOwogICAgfSBmaW5hbGx5IHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5hbHl6ZS1zdHJlbmd0aHMtYnRuJykuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KfQpmdW5jdGlvbiBkaXNwbGF5Q2xhc3NBbmFseXNpcyhkYXRhKSB7CiAgICBjb25zdCBhbmFseXNpc0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHJlbmd0aC13ZWFrbmVzcy1hbmFseXNpcy1jb250YWluZXInKTsKICAgIGlmICghZGF0YSkgewogICAgICAgIGFuYWx5c2lzQ29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1yZWQtNTAwIj7guYTguKHguYjguYTguJTguYnguKPguLHguJrguILguYnguK3guKHguLnguKXguIHguLLguKPguKfguLTguYDguITguKPguLLguLDguKvguYzguIjguLLguIEgQUk8L3A+JzsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBhbmFseXNpc0NvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iZmFkZS1pbiBzcGFjZS15LTQgbXQtNCBib3JkZXItdCBwdC00Ij4KICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtZ3JlZW4tNzAwIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hlY2stY2lyY2xlIG1yLTIiPjwvaT7guIjguLjguJTguYHguILguYfguIfguILguK3guIfguKvguYnguK3guIfguYDguKPguLXguKLguJk8L2g0PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0xIGJnLWdyZWVuLTUwIHAtMyByb3VuZGVkLWxnIHRleHQtZ3JlZW4tODAwIj4KICAgICAgICAgICAgICAgICAgICAke2RhdGEuY2xhc3NTdHJlbmd0aHMubWFwKGl0ZW0gPT4gYDxsaT4ke2l0ZW19PC9saT5gKS5qb2luKCcnKX0KICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgIDxoNCBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtcmVkLTcwMCBtYi0yIj48aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSBtci0yIj48L2k+4LiI4Li44LiU4Lit4LmI4Lit4LiZIC8g4LiE4Lin4Liy4Lih4LmA4LiC4LmJ4Liy4LmD4LiI4Lic4Li04LiU4LiX4Li14LmI4Lie4Lia4Lia4LmI4Lit4LiiPC9oND4KICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHNwYWNlLXktMSBiZy1yZWQtNTAgcC0zIHJvdW5kZWQtbGcgdGV4dC1yZWQtODAwIj4KICAgICAgICAgICAgICAgICAgICAke2RhdGEuY2xhc3NXZWFrbmVzc2VzLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICA8aDQgY2xhc3M9InRleHQtbGcgZm9udC1zZW1pYm9sZCB0ZXh0LWJsdWUtNzAwIG1iLTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hhbGtib2FyZC10ZWFjaGVyIG1yLTIiPjwvaT7guILguYnguK3guYDguKrguJnguK3guYHguJnguLDguKrguLPguKvguKPguLHguJrguITguKPguLk8L2g0PgogICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0xIGJnLWJsdWUtNTAgcC0zIHJvdW5kZWQtbGcgdGV4dC1ibHVlLTgwMCI+CiAgICAgICAgICAgICAgICAgICAke2RhdGEudGVhY2hlclN1Z2dlc3Rpb25zLm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9CiAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIGA7Cn0KZnVuY3Rpb24gZm9ybWF0QW5kUHJpbnRXb3Jrc2hlZXQocXVpekRhdGEsIHdvcmtzaGVldFdpbmRvdykgeyAKICAgIGNvbnN0IHdvcmtzaGVldEh0bWwgPSBgCiAgICAgICAgPCFET0NUWVBFIGh0bWw+CiAgICAgICAgPGh0bWwgbGFuZz0idGgiPgogICAgICAgIDxoZWFkPgogICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICAgICAgICAgIDx0aXRsZT7guYPguJrguIfguLLguJk6ICR7cXVpekRhdGEudG9waWN9PC90aXRsZT4KICAgICAgICAgICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLnRhaWx3aW5kY3NzLmNvbSI+PFwvc2NyaXB0PgogICAgICAgICAgICA8bGluayBocmVmPSJodHRwczovL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2NzczI/ZmFtaWx5PVNhcmFidW46d2dodEA0MDA7NzAwJmRpc3BsYXk9c3dhcCIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxzY3JpcHQ+IHdpbmRvdy5NYXRoSmF4ID0geyB0ZXg6IHsgaW5saW5lTWF0aDogW1snJCcsICckJ10sIFsnXFwoJywgJ1xcKSddXSB9IH07IDxcL3NjcmlwdD4KICAgICAgICAgICAgPHNjcmlwdCBpZD0iTWF0aEpheC1zY3JpcHQiIGFzeW5jIHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tYXRoamF4QDMvZXM1L3RleC1tbWwtY2h0bWwuanMiPjxcL3NjcmlwdD4KICAgICAgICAgICAgPHN0eWxlPgogICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiAnU2FyYWJ1bicsIHNhbnMtc2VyaWY7IH0KICAgICAgICAgICAgICAgIEBtZWRpYSBwcmludCB7CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IC13ZWJraXQtcHJpbnQtY29sb3ItYWRqdXN0OiBleGFjdDsgfQogICAgICAgICAgICAgICAgICAgIC5uby1wcmludCB7IGRpc3BsYXk6IG5vbmU7IH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC5xdWVzdGlvbi1pdGVtIHsgcGFnZS1icmVhay1pbnNpZGU6IGF2b2lkOyB9CiAgICAgICAgICAgICAgICAuYW5zd2VyLWxpbmUgewogICAgICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBkb3R0ZWQgYmxhY2s7CiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCU7CiAgICAgICAgICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDFyZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+CiAgICAgICAgPC9oZWFkPgogICAgICAgIDxib2R5IGNsYXNzPSJwLTgiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LWNlbnRlciBtYi04Ij4KICAgICAgICAgICAgICAgIDxoMSBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIj7guYPguJrguIfguLLguJnguYDguKPguLfguYjguK3guIc6ICR7cXVpekRhdGEudG9waWN9PC9oMT4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIG1iLTggdGV4dC1sZyI+CiAgICAgICAgICAgICAgICA8cD7guIrguLfguYjguK06IC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uPC9wPgogICAgICAgICAgICAgICAgPHA+4Lin4Lix4LiZ4LiX4Li14LmIOiAuLi4uLi4uLy4uLi4uLi4vLi4uLi4uLi4uPC9wPgogICAgICAgICAgICAgICAgPHA+4LiE4Liw4LmB4LiZ4LiZOiAuLi4uLi4uLi4uLi4uLi4uLjwvcD4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNiI+CiAgICAgICAgICAgICAgICAke3F1aXpEYXRhLnF1ZXN0aW9ucy5tYXAoKHEsIGluZGV4KSA9PiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icXVlc3Rpb24taXRlbSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgbWItMiI+JHtpbmRleCArIDF9LiAke3EucXVlc3Rpb25UZXh0fTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgJHtxLmltYWdlQ29kZSA/IGA8ZGl2IGNsYXNzPSJteS0yIGZsZXgganVzdGlmeS1jZW50ZXIiPiR7cS5pbWFnZUNvZGV9PC9kaXY+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+4LiV4Lit4LiaOjwvc3Ryb25nPiA8c3BhbiBjbGFzcz0iYW5zd2VyLWxpbmUiPjwvc3Bhbj48L3A+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYCkuam9pbignJyl9CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvYm9keT4KICAgICAgICA8L2h0bWw+CiAgICBgOwogICAgd29ya3NoZWV0V2luZG93LmRvY3VtZW50LndyaXRlKHdvcmtzaGVldEh0bWwpOwogICAgd29ya3NoZWV0V2luZG93LmRvY3VtZW50LmNsb3NlKCk7CiAgICB3b3Jrc2hlZXRXaW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgLy8g4LmA4Lie4Li04LmI4Lih4LiB4Liy4Lij4Lir4LiZ4LmI4Lin4LiH4LmA4Lin4Lil4Liy4LmA4Lil4LmH4LiB4LiZ4LmJ4Lit4Lii4LmA4Lie4Li34LmI4Lit4LmD4Lir4LmJIE1hdGhKYXgg4LiX4Liz4LiH4Liy4LiZ4LmA4Liq4Lij4LmH4LiI4LiB4LmI4Lit4LiZ4Lie4Li04Lih4Lie4LmMCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHdvcmtzaGVldFdpbmRvdy5wcmludCgpOwogICAgICAgIH0sIDEwMDApOyAvLyDguKvguJnguYjguKfguIfguYDguKfguKXguLIgMSDguKfguLTguJnguLLguJfguLUKICAgIH07Cn0KYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVXb3Jrc2hlZXQoKSAgeyAvKiBSZW1vdmVkICovIH0gCgphc3luYyBmdW5jdGlvbiBjYWxsQW5hbHlzaXNBcGkocHJvbXB0LCBzY2hlbWEpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVN0YXJ0U3luY01vZGUocXVpeklkLCBzaG91bGRTYXZlID0gZmFsc2UsIHZhcmlhbnQgPSAnY2xhc3NpYycpICB7IC8qIFJlbW92ZWQgKi8gfSAKCmZ1bmN0aW9uIGNhbGN1bGF0ZUZpbmFsUG9kaXVtU2NvcmVzKGdhbWVEYXRhKSB7CiAgICBpZiAoIWdhbWVEYXRhIHx8ICFnYW1lRGF0YS5zaHVmZmxlZFF1aXogfHwgIWdhbWVEYXRhLnBsYXllcnMpIHsKICAgICAgICByZXR1cm4gZ2FtZURhdGEucGxheWVycyB8fCB7fTsKICAgIH0KCiAgICBjb25zdCBmaW5hbFBsYXllcnMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGdhbWVEYXRhLnBsYXllcnMpKTsgCgogICAgT2JqZWN0LnZhbHVlcyhmaW5hbFBsYXllcnMpLmZvckVhY2gocGxheWVyID0+IHsKICAgICAgICBwbGF5ZXIucmVhbFNjb3JlID0gcGxheWVyLnNjb3JlIHx8IDA7CiAgICAgICAgcGxheWVyLnRvdGFsUG9pbnRzID0gcGxheWVyLnRvdGFsUG9pbnRzIHx8IDA7IAogICAgICAgIAogICAgICAgIC8vIOC4leC4seC4lCBMb2dpYyDguIHguLLguKPguJrguKfguIEgKzEgQm9udXMg4Lit4Lit4LiB4LiV4Liy4Lih4LiX4Li14LmI4LiC4LitCiAgICAgICAgcGxheWVyLmhhc1BlcmZlY3RTY29yZUJvbnVzID0gZmFsc2U7IAogICAgfSk7CgogICAgcmV0dXJuIGZpbmFsUGxheWVyczsKfQoKLy8g4LiV4Lix4Lin4LmB4Lib4Lij4Liq4Liz4Lir4Lij4Lix4Lia4LmA4LiB4LmH4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LiK4Lix4LmI4Lin4LiE4Lij4Liy4LinIChEYXRhIE9wdGltaXphdGlvbikKbGV0IGNhY2hlZEdhbWVEYXRhID0gbnVsbDsKbGV0IGNhY2hlZFBsYXllckRhdGEgPSB7fTsgCmxldCB1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyID0gbnVsbDsKbGV0IHVuc3Vic2NyaWJlUGxheWVyc0NvbGxlY3Rpb25MaXN0ZW5lciA9IG51bGw7CgpmdW5jdGlvbiBsaXN0ZW5Gb3JTeW5jR2FtZVVwZGF0ZXMoKSB7CiAgICAvLyAxLiDguYDguITguKXguLXguKLguKPguYwgTGlzdGVuZXIg4LmA4LiB4LmI4LiyCiAgICBpZiAodW5zdWJzY3JpYmVMaXZlR2FtZUxpc3RlbmVyKSB1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIoKTsKICAgIGlmICh1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyKSB1bnN1YnNjcmliZVBsYXllckRvY0xpc3RlbmVyKCk7CiAgICBpZiAodW5zdWJzY3JpYmVQbGF5ZXJzQ29sbGVjdGlvbkxpc3RlbmVyKSB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIoKTsKCiAgICAvLyA9PT0gW+C5gOC4nuC4tOC5iOC4oeC4quC5iOC4p+C4meC4meC4teC5iV0g4Lil4LmJ4Liy4LiH4LiC4LmJ4Lit4Lih4Li54Lil4LmA4LiB4LmI4Liy4LiX4Li04LmJ4LiH4LiB4LmI4Lit4LiZ4LmA4Lij4Li04LmI4Lih4Lif4Lix4LiH4Lir4LmJ4Lit4LiH4LmD4Lir4Lih4LmI4LmA4Liq4Lih4LitID09PQogICAgY2FjaGVkUGxheWVyRGF0YSA9IHt9OyAKICAgIGNhY2hlZEdhbWVEYXRhID0gbnVsbDsKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwoKICAgIC8vIDIuIOC4n+C4seC4h+C4guC5ieC4reC4oeC4ueC4peC4quC4luC4suC4meC4sOC5gOC4geC4oSAoTWFpbiBEb2MpCiAgICB1bnN1YnNjcmliZUxpdmVHYW1lTGlzdGVuZXIgPSBvblNuYXBzaG90KGdhbWVSZWYsIChkb2NTbmFwKSA9PiB7CiAgICAgICAgaWYgKCFkb2NTbmFwLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ2FjdGl2ZUdhbWVTZXNzaW9uJyk7CiAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguLTguIjguIHguKPguKPguKHguKrguLTguYnguJnguKrguLjguJTguKXguIfguYHguKXguYnguKciKTsKICAgICAgICAgICAgaWYgKGNhbWVGcm9tQmx1ZXByaW50ICYmIGN1cnJlbnRCbHVlcHJpbnRQcm9qZWN0SWQpIHsKICAgICAgICAgICAgICAgIGRpc3BsYXlCbHVlcHJpbnRQcm9qZWN0TWFuYWdlcihjdXJyZW50Qmx1ZXByaW50UHJvamVjdElkKTsKICAgICAgICAgICAgICAgIGNhbWVGcm9tQmx1ZXByaW50ID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICAgICAgICAgIHNob3dWaWV3KCdwcm9qZWN0LWRldGFpbCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2hvd1ZpZXcoJ3N0dWRlbnQnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBjYWNoZWRHYW1lRGF0YSA9IGRvY1NuYXAuZGF0YSgpOwogICAgICAgIGlmIChjYWNoZWRHYW1lRGF0YS5zaHVmZmxlZFF1aXopIHsKICAgICAgICAgICAgY3VycmVudFF1aXpEYXRhID0gY2FjaGVkR2FtZURhdGEuc2h1ZmZsZWRRdWl6OwogICAgICAgIH0KICAgICAgICBzeW5jRGF0YUFuZFJlbmRlcigpOwogICAgfSk7CgogICAgLy8gMy4g4Lif4Lix4LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZIChTdWJjb2xsZWN0aW9uKQogICAgY29uc3QgcGxheWVyc0NvbFJlZiA9IGNvbGxlY3Rpb24oZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgKTsKCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIgPSBvblNuYXBzaG90KHBsYXllcnNDb2xSZWYsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICBzbmFwc2hvdC5kb2NDaGFuZ2VzKCkuZm9yRWFjaCgoY2hhbmdlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY2hhbmdlLnR5cGUgPT09ICJhZGRlZCIgfHwgY2hhbmdlLnR5cGUgPT09ICJtb2RpZmllZCIpIHsKICAgICAgICAgICAgICAgICAgICBjYWNoZWRQbGF5ZXJEYXRhW2NoYW5nZS5kb2MuaWRdID0gY2hhbmdlLmRvYy5kYXRhKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoYW5nZS50eXBlID09PSAicmVtb3ZlZCIpIHsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgY2FjaGVkUGxheWVyRGF0YVtjaGFuZ2UuZG9jLmlkXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHN5bmNEYXRhQW5kUmVuZGVyKCk7CiAgICAgICAgfSk7CgogICAgfSBlbHNlIHsKICAgICAgICBpZiAobG9jYWxUZWFtUGxheWVycyAmJiBsb2NhbFRlYW1QbGF5ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgY29uc3QgcSA9IHF1ZXJ5KHBsYXllcnNDb2xSZWYsIHdoZXJlKCduYW1lJywgJ2luJywgbG9jYWxUZWFtUGxheWVycykpOwogICAgICAgICAgICB1bnN1YnNjcmliZVBsYXllcnNDb2xsZWN0aW9uTGlzdGVuZXIgPSBvblNuYXBzaG90KHEsIChzbmFwc2hvdCkgPT4gewogICAgICAgICAgICAgICAgc25hcHNob3QuZG9jQ2hhbmdlcygpLmZvckVhY2goKGNoYW5nZSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gImFkZGVkIiB8fCBjaGFuZ2UudHlwZSA9PT0gIm1vZGlmaWVkIikgewogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQbGF5ZXJEYXRhW2NoYW5nZS5kb2MuaWRdID0gY2hhbmdlLmRvYy5kYXRhKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzeW5jRGF0YUFuZFJlbmRlcigpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIHN5bmNEYXRhQW5kUmVuZGVyKCkgewogICAgaWYgKCFjYWNoZWRHYW1lRGF0YSkgcmV0dXJuOwoKICAgIC8vIOC4hOC4s+C4meC4p+C4k+C4quC4luC4suC4meC4sCAnYW5zd2VyZWQnIOC4reC4seC4leC5guC4meC4oeC4seC4leC4tCAo4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LiV4LmJ4Lit4LiH4LmA4LiC4Li14Lii4LiZIERhdGFiYXNlIOC4muC5iOC4reC4ouC5hikKICAgIGNvbnN0IHBsYXllcnNEaXNwbGF5ID0ge307CiAgICBjb25zdCBjdXJyZW50SW5kZXggPSBjYWNoZWRHYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKCiAgICBPYmplY3Qua2V5cyhjYWNoZWRQbGF5ZXJEYXRhKS5mb3JFYWNoKHBpZCA9PiB7CiAgICAgICAgY29uc3QgcCA9IGNhY2hlZFBsYXllckRhdGFbcGlkXTsKICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguJzguLnguYnguYDguKXguYjguJnguJXguK3guJrguILguYnguK3guJvguLHguIjguIjguLjguJrguLHguJnguKvguKPguLfguK3guKLguLHguIcKICAgICAgICBjb25zdCBoYXNBbnN3ZXJlZFRoaXNUdXJuID0gcC5hbnN3ZXJzICYmIHAuYW5zd2Vycy5zb21lKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpOwogICAgICAgIAogICAgICAgIHBsYXllcnNEaXNwbGF5W3BpZF0gPSB7CiAgICAgICAgICAgIC4uLnAsCiAgICAgICAgICAgIGFuc3dlcmVkOiBoYXNBbnN3ZXJlZFRoaXNUdXJuIC8vIE92ZXJyaWRlIOC4hOC5iOC4suC4meC4teC5ieC5g+C4q+C5iSBVSSDguYDguJTguLTguKHguYDguK3guLLguYTguJvguYPguIrguYkKICAgICAgICB9OwogICAgfSk7CgogICAgLy8g4Lij4Lin4Lih4Lij4LmI4Liy4LiH4LiC4LmJ4Lit4Lih4Li54LilCiAgICBjb25zdCBtZXJnZWRHYW1lRGF0YSA9IHsKICAgICAgICAuLi5jYWNoZWRHYW1lRGF0YSwKICAgICAgICBwbGF5ZXJzOiBwbGF5ZXJzRGlzcGxheQogICAgfTsKCiAgICAvLyDguKrguYjguIfguYPguKvguYkgVUkg4LmA4LiU4Li04Lih4LiC4Lit4LiH4LiE4Li44LiT4LiX4Liz4LiH4Liy4LiZ4LiV4LmI4LitICjguYTguKHguYjguJXguYnguK3guIfguYHguIHguYkgVUkpCiAgICBpZiAoY3VycmVudE1vZGUgPT09ICdhZG1pbicpIHsKICAgICAgICB1cGRhdGVBZG1pblN5bmNWaWV3KG1lcmdlZEdhbWVEYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgICAgdXBkYXRlU3R1ZGVudFN5bmNWaWV3KG1lcmdlZEdhbWVEYXRhKTsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyU3luY0xvYmJ5VmlldyhwaW4sIHRvcGljKSB7CiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCBtYi0yIj5TeW5jIE1vZGU6ICR7dG9waWN9PC9oMj4KICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgbWItNCI+4LmD4Lir4LmJ4LiZ4Lix4LiB4LmA4Lij4Li14Lii4LiZ4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4LiU4LmJ4Lin4Lii4Lij4Lir4Lix4Liq4LiZ4Li14LmJOjwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUgdGV4dC1ncmF5LTgwMCByb3VuZGVkLWxnIHAtNCBtYi00Ij4KICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJ0ZXh0LTZ4bCBmb250LWJvbGQgdHJhY2tpbmctd2lkZXN0Ij4ke3Bpbn08L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgYmctd2hpdGUvMjAgcC00IHJvdW5kZWQtbGciPgogICAgICAgICAgICAgICAgPGgzIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItMiI+4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Li14LmI4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4LihICg8c3BhbiBpZD0icGxheWVyLWNvdW50Ij4wPC9zcGFuPik8L2gzPgogICAgICAgICAgICAgICAgPGRpdiBpZD0icGxheWVyLWxpc3QtbG9iYnkiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtaW5kaWdvLTIwMCI+4LiB4Liz4Lil4Lix4LiH4Lij4Lit4Lic4Li54LmJ4LmA4Lil4LmI4LiZLi4uPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTQgdGV4dC1sZWZ0Ij4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImNvbmZpZGVuY2Utc2NvcmluZy10b2dnbGUiIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBjdXJzb3ItcG9pbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJjb25maWRlbmNlLXNjb3JpbmctdG9nZ2xlIiB0eXBlPSJjaGVja2JveCIgY2xhc3M9ImgtNSB3LTUgcm91bmRlZCBib3JkZXItZ3JheS0zMDAgdGV4dC1pbmRpZ28tNjAwIGZvY3VzOnJpbmctaW5kaWdvLTUwMCIgY2hlY2tlZD4KICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0ibWwtMyB0ZXh0LWxnIGZvbnQtc2VtaWJvbGQiPuC5gOC4m+C4tOC4lOC5g+C4iuC5ieC4h+C4suC4meC4o+C4sOC4muC4muC4hOC4sOC5geC4meC4meC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iDwvc3Bhbj4KICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJjb25maWRlbmNlLXNjb3JpbmctZGVzY3JpcHRpb24iIGNsYXNzPSJtdC0yIHRleHQtc20gdGV4dC1pbmRpZ28tMjAwIHBsLTggc3BhY2UteS0xIj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1ib2xkIHRleHQtd2hpdGUiPuC4hOC4sOC5geC4meC4meC4nuC4tOC5gOC4qOC4qeC4l+C4teC5iOC4iOC4sOC4luC4ueC4geC4hOC4s+C4meC4p+C4k+C5g+C4meC4leC4reC4meC4l+C5ieC4suC4ojo8L3A+CiAgICAgICAgICAgICAgICAgICAgPHA+LSDguJXguK3guJrguJbguLnguIEgJiDguKHguLHguYjguJnguYPguIggPSDguYTguJTguYnguYLguJrguJnguLHguKogPHN0cm9uZyBjbGFzcz0idGV4dC13aGl0ZSI+KzE8L3N0cm9uZz4g4LiE4Liw4LmB4LiZ4LiZPC9wPgogICAgICAgICAgICAgICAgICAgIDxwPi0g4LiV4Lit4Lia4Lic4Li04LiUICYg4Lih4Lix4LmI4LiZ4LmD4LiIID0g4LiW4Li54LiB4Lir4Lix4LiBIDxzdHJvbmcgY2xhc3M9InRleHQtd2hpdGUiPi0xPC9zdHJvbmc+IOC4hOC4sOC5geC4meC4mTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTQwMCI+KOC4geC4o+C4k+C4tSAi4LmE4Lih4LmI4Lih4Lix4LmI4LiZ4LmD4LiIIiDguIjguLDguYTguKHguYjguKHguLXguITguLDguYHguJnguJnguJ7guLTguYDguKjguKkpPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtMyB0ZXh0LXNtIHRleHQteWVsbG93LTMwMCBwbC04Ij4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXN0YXIiPjwvaT4g4Lie4Li04LmA4Lio4LipOiDguJzguLnguYnguJfguLXguYjguYTguJTguYnguITguLDguYHguJnguJnguKvguKXguLHguIHguYDguJXguYfguKEg4LiI4Liw4LmE4LiU4LmJ4Lij4Lix4Lia4LmC4Lia4LiZ4Lix4LiqIDxzdHJvbmcgY2xhc3M9InRleHQtd2hpdGUiPisxPC9zdHJvbmc+IOC4hOC4sOC5geC4meC4meC5g+C4meC4q+C4meC5ieC4suC4quC4o+C4uOC4m+C4nOC4peC4quC4uOC4lOC4l+C5ieC4suC4ogogICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RhcnQtc3luYy1nYW1lLWJ0biIgY2xhc3M9Im10LTYgYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LTJ4bCBkaXNhYmxlZDpiZy1ncmF5LTQwMCIgZGlzYWJsZWQ+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBsYXkiPjwvaT4g4LmA4Lij4Li04LmI4Lih4LmA4LiB4LihCiAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgYDsKICAgIAogICAgLy8g4LmA4Lie4Li04LmI4LihIEV2ZW50IExpc3RlbmVyIOC5g+C4q+C5iSBDaGVja2JveCDguIvguYjguK3guJkv4LmB4Liq4LiU4LiH4LiE4Liz4Lit4LiY4Li04Lia4Liy4LiiCiAgICBjb25zdCB0b2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLXRvZ2dsZScpOwogICAgY29uc3QgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1zY29yaW5nLWRlc2NyaXB0aW9uJyk7CiAgICB0b2dnbGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgIGRlc2NyaXB0aW9uLnN0eWxlLmRpc3BsYXkgPSB0b2dnbGUuY2hlY2tlZCA/ICdibG9jaycgOiAnbm9uZSc7CiAgICB9KTsKCiAgICAvLyDguYHguIHguYnguYTguIIgRXZlbnQgTGlzdGVuZXIg4LiC4Lit4LiH4Lib4Li44LmI4Lih4LmA4Lij4Li04LmI4Lih4LmA4LiB4Lih4LmD4Lir4LmJ4Lia4Lix4LiZ4LiX4Li24LiB4LiE4LmI4LiyIHNldHRpbmcg4LiZ4Li14LmJ4LiU4LmJ4Lin4LiiCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQtc3luYy1nYW1lLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgIGNvbnN0IGdhbWVSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzYCwgY3VycmVudExpdmVHYW1lSWQpOwogICAgICAgIC8vIOC4reC5iOC4suC4meC4hOC5iOC4suC4iOC4suC4gSBDaGVja2JveAogICAgICAgIGNvbnN0IGNvbmZpZGVuY2VFbmFibGVkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZGVuY2Utc2NvcmluZy10b2dnbGUnKS5jaGVja2VkOwogICAgICAgIC8vIOC4quC5iOC4h+C4hOC5iOC4siBzZXR0aW5nIOC5hOC4m+C4nuC4o+C5ieC4reC4oeC4geC4seC4muC4geC4suC4o+C5gOC4o+C4tOC5iOC4oeC5gOC4geC4oQogICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7CiAgICAgICAgICAgIHN0YXR1czogJ3F1ZXN0aW9uJywKICAgICAgICAgICAgY3VycmVudFF1ZXN0aW9uSW5kZXg6IDAsCiAgICAgICAgICAgIHF1ZXN0aW9uRGlzcGxheWVkQXQ6IHNlcnZlclRpbWVzdGFtcCgpLAogICAgICAgICAgICBpc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZDogY29uZmlkZW5jZUVuYWJsZWQgLy8gPC0tIOC4muC4seC4meC4l+C4tuC4geC4hOC5iOC4suC4meC4teC5ieC4peC4hyBGaXJlc3RvcmUKICAgICAgICB9KTsKICAgIH0pOwp9CgpmdW5jdGlvbiB1cGRhdGVBZG1pblN5bmNWaWV3KGdhbWVEYXRhKSB7CiAgICBpZiAoc3luY1F1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChzeW5jUXVlc3Rpb25UaW1lckludGVydmFsKTsKCiAgICBzd2l0Y2ggKGdhbWVEYXRhLnN0YXR1cykgewogICAgICAgIGNhc2UgJ2xvYmJ5JzoKICAgICAgICAgICAgcmVuZGVyU3luY0xvYmJ5VmlldyhnYW1lRGF0YS5waW4sIGdhbWVEYXRhLnNodWZmbGVkUXVpei50b3BpYyk7CiAgICAgICAgICAgIGNvbnN0IGFjdGl2ZVBsYXllcnMgPSBPYmplY3QuZW50cmllcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIoKFtuYW1lLCBkYXRhXSkgPT4gZGF0YS5zdGF0dXMgIT09ICdpbmFjdGl2ZScpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyLWNvdW50JykudGV4dENvbnRlbnQgPSBhY3RpdmVQbGF5ZXJzLmxlbmd0aDsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1saXN0LWxvYmJ5JykuaW5uZXJIVE1MID0gYWN0aXZlUGxheWVycy5tYXAoKFtuYW1lLCBkYXRhXSkgPT4gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctYmxhY2svMzAgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICA8c3Bhbj4ke25hbWV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtuYW1lfSIgY2xhc3M9ImtpY2stcGxheWVyLWJ0bi1zeW5jIHRleHQtcmVkLTMwMCBob3Zlcjp0ZXh0LXdoaXRlIGZvbnQtYm9sZCIgdGl0bGU9IuC4meC4s+C4nOC4ueC5ieC5gOC4peC5iOC4meC4meC4teC5ieC4reC4reC4gSI+JnRpbWVzOzwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGApLmpvaW4oJycpIHx8ICc8cCBjbGFzcz0idGV4dC1pbmRpZ28tMjAwIj7guIHguLPguKXguLHguIfguKPguK3guJzguLnguYnguYDguKXguYjguJkuLi48L3A+JzsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0LXN5bmMtZ2FtZS1idG4nKS5kaXNhYmxlZCA9IGFjdGl2ZVBsYXllcnMubGVuZ3RoID09PSAwOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAncXVlc3Rpb24nOgogICAgICAgICAgICBjb25zdCBwbGF5ZXJzSW5HYW1lID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIocCA9PiBwLnN0YXR1cyAhPT0gJ2luYWN0aXZlJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBhbnN3ZXJlZFBsYXllcnMgPSBwbGF5ZXJzSW5HYW1lLmZpbHRlcihwID0+IHAuYW5zd2VyZWQgPT09IHRydWUgfHwgcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSk7CiAgICAgICAgICAgIGNvbnN0IHdhaXRpbmdQbGF5ZXJzID0gcGxheWVyc0luR2FtZS5maWx0ZXIocCA9PiAhcC5hbnN3ZXJlZCAmJiAhcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbik7CgogICAgICAgICAgICBjb25zdCBhbnN3ZXJlZENvdW50ID0gYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aDsKICAgICAgICAgICAgY29uc3Qgd2FpdGluZ0NvdW50ID0gd2FpdGluZ1BsYXllcnMubGVuZ3RoOwogICAgICAgICAgICBjb25zdCB0b3RhbEFjdGl2ZSA9IHBsYXllcnNJbkdhbWUubGVuZ3RoOwogICAgICAgICAgICBjb25zdCBhbGxBbnN3ZXJlZCA9IGFuc3dlcmVkQ291bnQgPT09IHRvdGFsQWN0aXZlICYmIHRvdGFsQWN0aXZlID4gMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC4uLiAo4LmC4LiE4LmJ4LiU4LmA4LiK4LmH4LiEIGFsbEFuc3dlcmVkIOC5gOC4lOC4tOC4oSDguITguIfguYTguKfguYkpIC4uLgogICAgICAgICAgICBpZiAoYWxsQW5zd2VyZWQgJiYgZ2FtZURhdGEuc3RhdHVzID09PSAncXVlc3Rpb24nKSB7CiAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgIHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3N1bW1hcnknIH0pOyAKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXBsYXllci1tYW5hZ2VtZW50JykgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlbmRlckFkbWluU3luY1F1ZXN0aW9uVmlldyhnYW1lRGF0YSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgLy8gLi4uICjguYLguITguYnguJQgdXBkYXRlIHBsYXllciBsaXN0IOC5gOC4lOC4tOC4oSDguITguIfguYTguKfguYkpIC4uLgogICAgICAgICAgICAgICAgIGNvbnN0IGFuc3dlckNvdW50ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5zd2VyLWNvdW50ZXInKTsKICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyQ291bnRlcikgeyBhbnN3ZXJDb3VudGVyLnRleHRDb250ZW50ID0gYCR7YW5zd2VyZWRDb3VudH0vJHt0b3RhbEFjdGl2ZX1gOyB9CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgY29uc3Qgc2hvd1Jlc0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaG93LXJlc3VsdHMtYnRuJyk7CiAgICAgICAgICAgICAgICAgaWYgKHNob3dSZXNCdG4pIHNob3dSZXNCdG4uZGlzYWJsZWQgPSAhYWxsQW5zd2VyZWQ7CgogICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllckxpc3RDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1wbGF5ZXItbGlzdCcpOwogICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJMaXN0Q29udGFpbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgIC8vIC4uLiAo4LmC4LiE4LmJ4LiUIHJlbmRlciBsaXN0IOC5gOC4lOC4tOC4oSkgLi4uCiAgICAgICAgICAgICAgICAgICAgIHBsYXllckxpc3RDb250YWluZXIuaW5uZXJIVE1MID0gcGxheWVyc0luR2FtZS5tYXAocGxheWVyID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0Fuc3dlcmVkID0gcGxheWVyLmFuc3dlcmVkID09PSB0cnVlIHx8IHBsYXllci5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJnQ29sb3IgPSBoYXNBbnN3ZXJlZCA/ICdiZy1ncmVlbi01MDAnIDogJ2JnLWdyYXktNjAwJzsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIHB4LTMgcHktMSByb3VuZGVkLWZ1bGwgdGV4dC13aGl0ZSB0ZXh0LXNtICR7YmdDb2xvcn0gYm9yZGVyIGJvcmRlci13aGl0ZS8xMCBzaGFkb3ctc20iPiR7aWNvbn08c3Bhbj4ke3BsYXllci5uYW1lfTwvc3Bhbj48YnV0dG9uIGRhdGEtcGxheWVyLW5hbWU9IiR7cGxheWVyLm5hbWV9IiBjbGFzcz0ia2ljay1wbGF5ZXItYnRuLXN5bmMgdGV4dC1yZWQtMjAwIGhvdmVyOnRleHQtd2hpdGUgZm9udC1ib2xkIG1sLTEgaG92ZXI6YmctcmVkLTUwMC8yMCByb3VuZGVkLWZ1bGwgdy01IGgtNSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciIgdGl0bGU9IuC4meC4s+C4nOC4ueC5ieC5gOC4peC5iOC4meC4meC4teC5ieC4reC4reC4gSI+JnRpbWVzOzwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgIH0pLmpvaW4oJycpOwogICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgLy8gLi4uICjguYLguITguYnguJQgdXBkYXRlIHdhaXRpbmcgY291bnQg4LmA4LiU4Li04LihKSAuLi4KICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbmFnZS10b3RhbC1wbGF5ZXJzJyk7CiAgICAgICAgICAgICAgICAgY29uc3Qgd2FpdGluZ0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hbmFnZS13YWl0aW5nLXBsYXllcnMnKTsKICAgICAgICAgICAgICAgICBpZiAodG90YWxFbCkgdG90YWxFbC50ZXh0Q29udGVudCA9IHRvdGFsQWN0aXZlOwogICAgICAgICAgICAgICAgIGlmICh3YWl0aW5nRWwpIHdhaXRpbmdFbC50ZXh0Q29udGVudCA9IHdhaXRpbmdDb3VudDsKCiAgICAgICAgICAgICAgICAgY29uc3QgZmFzdFJlc3BvbmRlckJvdHRvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmYXN0LXJlc3BvbmRlci1jb250YWluZXInKTsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmFzdFJlc3BvbmRlckhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXItZmFzdC1yZXNwb25kZXInKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMS4g4LiW4LmJ4Liy4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmIIOC5g+C4q+C5ieC5gOC4hOC4peC4teC4ouC4o+C5jOC4hOC5iOC4suC4l+C4teC5iOC4iOC4s+C5hOC4p+C5iSDguYDguJ7guLfguYjguK3guYDguKPguLTguYjguKHguKvguLLguITguJnguYDguIHguYjguIfguKPguK3guJrguYPguKvguKHguYgKICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggIT09IGxhc3RMb2NrZWRRdWVzdGlvbkluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2tlZEZhc3Rlc3RSZXNwb25kZXJOYW1lID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdExvY2tlZFF1ZXN0aW9uSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckhlYWRlcikgZmFzdFJlc3BvbmRlckhlYWRlci5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckJvdHRvbSkgZmFzdFJlc3BvbmRlckJvdHRvbS5pbm5lckhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIDIuIExvZ2ljIOC4geC4suC4o+C4q+C4suC5geC4peC4sOC4iOC4s+C4iuC4t+C5iOC4reC4hOC4meC5hOC4p+C4quC4uOC4lCAo4LiX4Liz4LiH4Liy4LiZ4LmA4Lih4Li34LmI4Lit4Lih4Li14LiE4LiZ4LiV4Lit4LiaIOC5geC4peC4sOC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4iOC4s+C4iuC4t+C5iOC4reC5g+C4hOC4o+C5hOC4p+C5iSkKICAgICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aCA+IDAgJiYgIWxvY2tlZEZhc3Rlc3RSZXNwb25kZXJOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyDguYDguKPguLXguKLguIfguKXguLPguJTguLHguJrguYDguKfguKXguLI6IOC5g+C4hOC4o+C5hOC4oeC5iOC4oeC4teC5gOC4p+C4peC4siAobnVsbCkg4LmD4Lir4LmJ4LmE4Lib4LiV4LmI4Lit4LiX4LmJ4Liy4LiiIChJbmZpbml0eSkg4Lib4LmJ4Lit4LiH4LiB4Lix4LiZ4LiB4Liy4Lij4LmB4Lii4LmI4LiH4LiX4Li14LmICiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvcnRlZEJ5VGltZSA9IFsuLi5hbnN3ZXJlZFBsYXllcnNdLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdldFRpbWUgPSAocCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcC5zdWJtaXR0ZWRBdCkgcmV0dXJuIEluZmluaXR5OyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcC5zdWJtaXR0ZWRBdC50b0RhdGUgPyBwLnN1Ym1pdHRlZEF0LnRvRGF0ZSgpLmdldFRpbWUoKSA6IG5ldyBEYXRlKHAuc3VibWl0dGVkQXQpLmdldFRpbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGltZShhKSAtIGdldFRpbWUoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiI4Liz4LiK4Li34LmI4Lit4LiE4LiZ4LmB4Lij4LiB4LiX4Li14LmI4LmA4Lij4Li14Lii4LiH4LmE4LiU4LmJICjguITguJnguJnguLXguYnguITguLfguK3guYHguIrguKHguJvguYzguILguK3guIfguILguYnguK3guJnguLXguYnguYHguJnguYjguJnguK3guJkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzb3J0ZWRCeVRpbWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWUgPSBzb3J0ZWRCeVRpbWVbMF0ubmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gMy4g4Liq4LmI4Lin4LiZ4LmB4Liq4LiU4LiH4Lic4LilICjguYPguIrguYnguIrguLfguYjguK0gbG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWUg4LiX4Li14LmI4LiI4Liz4LmE4Lin4LmJ4LmA4Liq4Lih4LitKQogICAgICAgICAgICAgICAgICAgIGlmIChsb2NrZWRGYXN0ZXN0UmVzcG9uZGVyTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuc3dlcmVkUGxheWVycy5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguKHguLXguITguJnguJXguK3guJrguYHguITguYggMSDguITguJk6IOC5geC4quC4lOC4h+C4m+C5ieC4suC4ouC5g+C4q+C4jeC5iOC4quC4teC5gOC4guC4teC4ouC4p+C4lOC5ieC4suC4meC4peC5iOC4suC4hyAo4LmA4Lir4Lih4Li34Lit4LiZ4LmA4LiU4Li04LihKSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJIZWFkZXIpIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gJyc7IC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4guC5ieC4suC4h+C4muC4mQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckJvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWdyYWRpZW50LXRvLXIgZnJvbS1ncmVlbi01MDAgdG8tZW1lcmFsZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTYgcm91bmRlZC14bCBzaGFkb3ctbGcgYm9yZGVyLTIgYm9yZGVyLWdyZWVuLTMwMCByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTMgYW5pbWF0ZS1ib3VuY2UiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSB0b3AtMCBsZWZ0LTAgdy1mdWxsIGgtZnVsbCBiZy13aGl0ZSBvcGFjaXR5LTIwIHRyYW5zZm9ybSBza2V3LXgtMTIiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWJvbHQgdGV4dC15ZWxsb3ctMzAwIHRleHQtMnhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LWJvbGQgdGV4dC1sZyI+4LiE4LiZ4Liq4LmI4LiH4LmE4Lin4LiX4Li14LmI4Liq4Li44LiUOjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtZXh0cmFib2xkIHRleHQtMnhsIHRleHQteWVsbG93LTEwMCBkcm9wLXNoYWRvdy1tZCI+JHtsb2NrZWRGYXN0ZXN0UmVzcG9uZGVyTmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vID09PSDguIHguKPguJPguLXguKHguLXguITguJnguJXguK3guJogMiDguITguJnguILguLbguYnguJnguYTguJs6IOC4ouC5ieC4suC4ouC4iuC4t+C5iOC4reC4hOC4meC5geC4o+C4geC5hOC4m+C5geC4m+C4sOC4m+C5ieC4suC4ouC5gOC4peC5h+C4geC4lOC5ieC4suC4meC4muC4mSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJCb3R0b20pIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gJyc7IC8vIOC5gOC4hOC4peC4teC4ouC4o+C5jOC4guC5ieC4suC4h+C4peC5iOC4suC4hwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmFzdFJlc3BvbmRlckhlYWRlcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGJnLWdyZWVuLTYwMC85MCBiYWNrZHJvcC1ibHVyLXNtIHRleHQtd2hpdGUgcHgtNCBweS0xIHJvdW5kZWQtZnVsbCBib3JkZXIgYm9yZGVyLWdyZWVuLTQwMCBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSB0cmFuc2Zvcm0gdHJhbnNpdGlvbi1hbGwgbWwtNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYm9sdCB0ZXh0LXllbGxvdy0zMDAiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gZm9udC1ib2xkIj7guYTguKfguKrguLjguJQ6IDxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy0xMDAiPiR7bG9ja2VkRmFzdGVzdFJlc3BvbmRlck5hbWV9PC9zcGFuPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4Lii4Lix4LiH4LmE4Lih4LmI4Lih4Li14LmD4LiE4Lij4LiV4Lit4LiaICjguYDguITguKXguLXguKLguKPguYzguJfguLHguYnguIfguITguLnguYgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJIZWFkZXIpIGZhc3RSZXNwb25kZXJIZWFkZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGZhc3RSZXNwb25kZXJCb3R0b20pIGZhc3RSZXNwb25kZXJCb3R0b20uaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgICAgICAvLyDguKrguYjguKfguJnguJfguLXguYggMjogTG9naWMg4LmB4LiI4LmJ4LiH4LmA4LiV4Li34Lit4LiZ4LiE4LiZ4LiK4LmJ4LiyIChTbG93IFJlc3BvbmRlcikgLSDguK3guLHguJnguJnguLXguYnguITguLfguK3guK3guLHguJnguYDguJTguLTguKHguJfguLXguYjguKvguLLguKLguYTguJsKICAgICAgICAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAgICAgICAgICBjb25zdCBzaG93U2xvdyA9IGdhbWVEYXRhLnNob3dTbG93UmVzcG9uZGVycyAhPT0gZmFsc2U7CiAgICAgICAgICAgICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChnYW1lRGF0YS5zbG93UmVzcG9uZGVyQ291bnQgfHwgMywgMTApOwogICAgICAgICAgICAgICAgIGNvbnN0IHNsb3dDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2xvdy1yZXNwb25kZXItY29udGFpbmVyJyk7CiAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgaWYgKHNsb3dDb250YWluZXIpIHsKICAgICAgICAgICAgICAgICAgICAgLy8g4LmA4LiH4Li34LmI4Lit4LiZ4LmE4LiCOiDguYDguJvguLTguJTguYLguKvguKHguJTguYHguIjguYnguIfguYDguJXguLfguK3guJkgKyDguYDguKvguKXguLfguK3guITguJnguJnguYnguK3guKLguIHguKfguYjguLIgTGltaXQgKyDguKHguLXguITguJnguYDguKXguYjguJnguKHguLLguIHguIHguKfguYjguLLguITguJnguKPguK0gKOC5hOC4oeC5iOC5g+C4iuC5iOC5gOC4nuC4tOC5iOC4h+C5gOC4o+C4tOC5iOC4oSkKICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dTbG93ICYmIHdhaXRpbmdDb3VudCA+IDAgJiYgd2FpdGluZ0NvdW50IDw9IGxpbWl0ICYmIHRvdGFsQWN0aXZlID4gd2FpdGluZ0NvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gd2FpdGluZ1BsYXllcnMubWFwKHAgPT4gcC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgICAgICAgICAgICAgICAgICBzbG93Q29udGFpbmVyLmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXJlZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS00IHB4LTYgcm91bmRlZC14bCBzaGFkb3ctMnhsIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTQgYm9yZGVyLXJlZC04MDAgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIG10LTQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImFic29sdXRlIHRvcC0wIGxlZnQtMCB3LWZ1bGwgaC1mdWxsIGJnLXdoaXRlIG9wYWNpdHktMTAgdHJhbnNmb3JtIC1za2V3LXgtMTIiPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InJlbGF0aXZlIHotMTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBtYi0yIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc2hpcHBpbmctZmFzdCBmYS1sZyI+PC9pPiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPuC4o+C4reC4reC4teC4gSAke3dhaXRpbmdDb3VudH0g4LiE4LiZ4Liq4Li44LiU4LiX4LmJ4Liy4LiiITwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtM3hsIGZvbnQtZXh0cmFib2xkIHRleHQteWVsbG93LTMwMCB0cmFja2luZy13aWRlIGRyb3Atc2hhZG93LW1kIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7bmFtZXN9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXNtIG10LTIgb3BhY2l0eS05MCBmb250LW1lZGl1bSBiZy1ibGFjay8yMCBpbmxpbmUtYmxvY2sgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDguKPguLXguJrguJXguK3guJrguKvguJnguYjguK3guKLguIjguYnguLIhIOC5gOC4nuC4t+C5iOC4reC4meC4o+C4reC4reC4ouC4ueC5iAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3dDb250YWluZXIuaW5uZXJIVE1MID0gJyc7IAogICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUaW1lciBMb2dpYwogICAgICAgICAgICBjb25zdCBpc1RpbWVyT24gPSBnYW1lRGF0YS50aW1lck1vZGUgPT09ICdwZXJfcXVlc3Rpb24nICYmIGdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQ7CiAgICAgICAgICAgIGlmIChpc1RpbWVyT24pIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQudG9EYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBnYW1lRGF0YS50aW1lckR1cmF0aW9uICogMTAwMDsKICAgICAgICAgICAgICAgIGNvbnN0IGFkbWluRW5kVGltZSA9IHN0YXJ0VGltZSArIGR1cmF0aW9uOyAKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVyQmFyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdGltZXItYmFyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjb3VudGRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy10aW1lci1jb3VudGRvd24nKTsKCiAgICAgICAgICAgICAgICBzeW5jUXVlc3Rpb25UaW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxsUGxheWVyc0RvbmUgPSBwbGF5ZXJzSW5HYW1lLmxlbmd0aCA+IDAgJiYgcGxheWVyc0luR2FtZS5ldmVyeShwID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAuYW5zd2VyZWQpIHJldHVybiB0cnVlOyAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9udXMgPSBwLnRpbWVCb251c1RoaXNRdWVzdGlvbiB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKG5vdyA+PSBzdGFydFRpbWUgKyBkdXJhdGlvbiArIGJvbnVzKTsgCiAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChhbGxQbGF5ZXJzRG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHN5bmNRdWVzdGlvblRpbWVySW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAnc3VtbWFyeScgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWRtaW5SZW1haW5pbmcgPSBhZG1pbkVuZFRpbWUgLSBub3c7CiAgICAgICAgICAgICAgICAgICAgaWYgKGFkbWluUmVtYWluaW5nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWVyQmFyKSB0aW1lckJhci5zdHlsZS53aWR0aCA9ICcwJSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudGRvd24pIGNvdW50ZG93bi50ZXh0Q29udGVudCA9ICcwICjguKPguK3guYLguJrguJnguLHguKopJzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZXJCYXIgJiYgY291bnRkb3duKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50YWdlID0gKGFkbWluUmVtYWluaW5nIC8gZHVyYXRpb24pICogMTAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXJCYXIuc3R5bGUud2lkdGggPSBgJHtwZXJjZW50YWdlfSVgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRkb3duLnRleHRDb250ZW50ID0gTWF0aC5jZWlsKGFkbWluUmVtYWluaW5nIC8gMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdzdW1tYXJ5JzoKICAgICAgICAgICAgY29uc3QgcUluZGV4Rm9yU3VtbWFyeSA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICBjb25zdCBxdWVzdGlvbkZvclN1bW1hcnkgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zW3FJbmRleEZvclN1bW1hcnldOwogICAgICAgICAgICByZW5kZXJTeW5jU3VtbWFyeVZpZXcoZ2FtZURhdGEsIHF1ZXN0aW9uRm9yU3VtbWFyeSwgdHJ1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdyZXN1bHRzJzoKICAgICAgICAgICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgICAgICAgICAgaWYgKHZhcmlhbnQgPT09ICdyZXZlYWxfYXRfZW5kJyB8fCB2YXJpYW50ID09PSAnYW5vbnltb3VzX3JldmVhbF9lbmQnKSB7CiAgICAgICAgICAgICAgICByZW5kZXJBZG1pblN5bmNEYXNoYm9hcmQoZ2FtZURhdGEsIHRydWUsIGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Lin4LmI4Liy4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4Lij4Lit4Lia4LiZ4Li14LmJ4LmE4Lib4Lir4Lij4Li34Lit4Lii4Lix4LiHCiAgICAgICAgICAgICAgICBpZiAoZ2FtZURhdGEuc3RhdHVzID09PSAncmVzdWx0cycgJiYgIWdhbWVEYXRhLnNjb3Jlc0NhbGN1bGF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICAoYXN5bmMgKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ2FtZVJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgLCBjdXJyZW50TGl2ZUdhbWVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAxLiDguKXguYfguK3guITguKrguJbguLLguJnguLDguYDguJ7guLfguYjguK3guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguITguLPguJnguKfguJPguIvguYnguLMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHNjb3Jlc0NhbGN1bGF0ZWQ6IHRydWUgfSk7IAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllcnNUb0NhbGN1bGF0ZSA9IGNhY2hlZFBsYXllckRhdGEgfHwge307IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMi4g4Lij4Liw4Lia4Lia4LiE4Liz4LiZ4Lin4LiT4LiB4Lit4LiH4LiB4Lil4Liy4LiHIChUaGUgUG90IFN5c3RlbSkgLS0tCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcG90RnJvbUxvc2VycyA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3YWdlcldpbm5lcnMgPSBbXTsgCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMocGxheWVyc1RvQ2FsY3VsYXRlKS5mb3JFYWNoKChbcGlkLCBwbGF5ZXJdKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5zdGF0dXMgIT09ICdpbmFjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFucyA9IChwbGF5ZXIuYW5zd2VycyB8fCBbXSkuZmluZChhID0+IGEucXVlc3Rpb25JbmRleCA9PT0gY3VycmVudEluZGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zICYmIGN1cnJlbnRBbnMucG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB3YWdlciA9IGN1cnJlbnRBbnMud2FnZXJBbW91bnQgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhZ2VyV2lubmVycy5wdXNoKHBpZCk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3RGcm9tTG9zZXJzICs9IHdhZ2VyOyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzUG90ID0gZ2FtZURhdGEuY2VudHJhbFBvdCB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxQb3RUb0Rpc3RyaWJ1dGUgPSBwcmV2aW91c1BvdCArIHBvdEZyb21Mb3NlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzaGFyZVBlcldpbm5lciA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV3UmVtYWluZGVyID0gdG90YWxQb3RUb0Rpc3RyaWJ1dGU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdhZ2VyV2lubmVycy5sZW5ndGggPiAwICYmIHRvdGFsUG90VG9EaXN0cmlidXRlID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXJlUGVyV2lubmVyID0gTWF0aC5mbG9vcih0b3RhbFBvdFRvRGlzdHJpYnV0ZSAvIHdhZ2VyV2lubmVycy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1JlbWFpbmRlciA9IHRvdGFsUG90VG9EaXN0cmlidXRlICUgd2FnZXJXaW5uZXJzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdQdWJsaWNMZWFkZXJib2FyZCA9IFtdOyAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAzLiDguK3guLHguJvguYDguJTguJXguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJnguYHguJXguYjguKXguLDguITguJkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMocGxheWVyc1RvQ2FsY3VsYXRlKS5mb3JFYWNoKHBsYXllciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5zdGF0dXMgIT09ICdpbmFjdGl2ZScpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyTmFtZSA9IHBsYXllci5uYW1lOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4q+C4suC4hOC4s+C4leC4reC4muC4guC4reC4h+C4o+C4reC4muC4meC4teC5iQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5zID0gKHBsYXllci5hbnN3ZXJzIHx8IFtdKS5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBvaW50c1RvQWRkID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwZGF0ZWRBbnN3ZXJzID0gcGxheWVyLmFuc3dlcnM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBb4LmB4LiB4LmJ4LmE4LiC4LiI4Li44LiU4LiZ4Li14LmJXSDguJbguYnguLLguYTguKHguYjguKHguLXguITguLPguJXguK3guJogKOC4q+C4oeC4lOC5gOC4p+C4peC4sikg4LmD4Lir4LmJ4Lij4Li14LmA4LiL4LmH4LiVIFN0cmVhayDilrzilrzilrwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1N0cmVhayA9IHBsYXllci5jb3JyZWN0U3RyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnJlbnRBbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1N0cmVhayA9IDA7IC8vIOC5hOC4oeC5iOC4leC4reC4miA9IFN0cmVhayDguKvguKXguLjguJQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDilrLilrLilrIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3YWdlcldpbm5lcnMuaW5jbHVkZXMocGxheWVyTmFtZSkgJiYgc2hhcmVQZXJXaW5uZXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludHNUb0FkZCA9IHNoYXJlUGVyV2lubmVyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZEFuc3dlcnMgPSAocGxheWVyLmFuc3dlcnMgfHwgW10pLm1hcChhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5xdWVzdGlvbkluZGV4ID09PSBjdXJyZW50SW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgLi4uYSwgcG90Qm9udXM6IHNoYXJlUGVyV2lubmVyIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocGxheWVyUmVmLCB7IGFuc3dlcnM6IHVwZGF0ZWRBbnN3ZXJzIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByYXdTY29yZSA9IHBsYXllci5zY29yZSB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxQb2ludHMgPSBwbGF5ZXIudG90YWxQb2ludHMgfHwgMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxQb2ludHMgKz0gcG9pbnRzVG9BZGQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc09uZXRNb2RlID0gZ2FtZURhdGEuaXNPbmV0TW9kZSA9PT0gdHJ1ZTsgLy8g4LmA4LiK4LmH4LiE4LmC4Lir4Lih4LiUCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc09uZXRNb2RlICYmIHRvdGFsUXVlc3Rpb25zID4gMCAmJiByYXdTY29yZSA9PT0gdG90YWxRdWVzdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxQb2ludHMgKz0gMTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocGxheWVyUmVmLCB7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IHJhd1Njb3JlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IGZpbmFsUG9pbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiBmaW5hbFBvaW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IG5ld1N0cmVhayAvLyA8LS0g4Lia4Lix4LiZ4LiX4Li24LiBIFN0cmVhayDguYPguKvguKHguYjguKXguIcgREIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdQdWJsaWNMZWFkZXJib2FyZC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBsYXllciwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogcmF3U2NvcmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFBvaW50czogZmluYWxQb2ludHMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzTGFzdFJvdW5kOiBmaW5hbFBvaW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuc3dlcnM6IHVwZGF0ZWRBbnN3ZXJzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RTdHJlYWs6IG5ld1N0cmVhayAvLyA8LS0g4Liq4LmI4LiH4LiE4LmI4Liy4LmD4Lir4Lih4LmI4LmE4Lib4LmB4Liq4LiU4LiH4Lic4Lil4LiX4Li14LmI4Lir4LiZ4LmJ4Liy4LiI4Lit4LiX4Li44LiB4LiE4LiZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUoZ2FtZVJlZiwgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW50cmFsUG90OiBuZXdSZW1haW5kZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljTGVhZGVyYm9hcmQ6IG5ld1B1YmxpY0xlYWRlcmJvYXJkIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFBvdCBEaXN0cmlidXRlZC4gTGVhZGVyYm9hcmQgVXBkYXRlZC5gKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJFcnJvciBjYWxjdWxhdGluZyBmaW5hbCBzY29yZXMgd2l0aCBwb3Q6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlbmRlckFkbWluU3luY0Rhc2hib2FyZChnYW1lRGF0YSwgdHJ1ZSwgZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdwb2RpdW0nOgogICAgICAgICAgICBjb25zdCBoYXNQbGF5ZXJzVG9DaGVjayA9IE9iamVjdC5rZXlzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGNvbnN0IGlzQWxyZWFkeVNhdmVkID0gZ2FtZURhdGEucmVzdWx0c1NhdmVkID09PSB0cnVlOwogICAgICAgICAgICBjb25zdCBzaG91bGRTYXZlQ29uZmlnID0gZ2FtZURhdGEuc2hvdWxkU2F2ZVJlc3VsdHMgPT09IHRydWU7CgogICAgICAgICAgICBpZiAoc2hvdWxkU2F2ZUNvbmZpZyAmJiAhaXNBbHJlYWR5U2F2ZWQgJiYgaGFzUGxheWVyc1RvQ2hlY2spIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJEZXRlY3RpbmcgdW5zYXZlZCBnYW1lIHVwb24gcmVzdW1lLi4uIFNhdmluZyBub3cuIik7CiAgICAgICAgICAgICAgICBzYXZlR2FtZVJlc3VsdHNBc1N1Ym1pc3Npb25zKGdhbWVEYXRhKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnYWN0aXZlR2FtZVNlc3Npb24nKTsKICAgICAgICAgICAgY29uc3QgZmluYWxTY29yZXNBZG1pbiA9IGNhbGN1bGF0ZUZpbmFsUG9kaXVtU2NvcmVzKGdhbWVEYXRhKTsKICAgICAgICAgICAgc2hvd1BvZGl1bVZpZXcoZmluYWxTY29yZXNBZG1pbiwgJ3N5bmMnLCBnYW1lRGF0YSk7IAogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyQWRtaW5TeW5jUXVlc3Rpb25WaWV3KGdhbWVEYXRhKSB7CiAgICBjb25zdCBxSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgIGNvbnN0IHF1ZXN0aW9uID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uc1txSW5kZXhdOwogICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgIAogICAgLy8gMS4g4LiE4Liz4LiZ4Lin4LiT4LiV4Lix4Lin4LmA4Lil4LiCCiAgICBjb25zdCBwbGF5ZXJzSW5HYW1lID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KS5maWx0ZXIocCA9PiBwLnN0YXR1cyAhPT0gJ2luYWN0aXZlJyk7CiAgICBjb25zdCBhbnN3ZXJlZFBsYXllcnMgPSBwbGF5ZXJzSW5HYW1lLmZpbHRlcihwID0+IHAuYW5zd2VyZWQgPT09IHRydWUgfHwgcC5hbnN3ZXJlZEN1cnJlbnRRdWVzdGlvbiA9PT0gdHJ1ZSk7CiAgICBjb25zdCB3YWl0aW5nUGxheWVycyA9IHBsYXllcnNJbkdhbWUuZmlsdGVyKHAgPT4gIXAuYW5zd2VyZWQgJiYgIXAuYW5zd2VyZWRDdXJyZW50UXVlc3Rpb24pOwogICAgCiAgICBjb25zdCBhbnN3ZXJlZENvdW50ID0gYW5zd2VyZWRQbGF5ZXJzLmxlbmd0aDsKICAgIGNvbnN0IHRvdGFsQWN0aXZlID0gcGxheWVyc0luR2FtZS5sZW5ndGg7ICAgICAgCiAgICBjb25zdCB3YWl0aW5nQ291bnQgPSB3YWl0aW5nUGxheWVycy5sZW5ndGg7ICAgIAogICAgY29uc3QgYWxsQW5zd2VyZWQgPSBhbnN3ZXJlZENvdW50ID09PSB0b3RhbEFjdGl2ZSAmJiB0b3RhbEFjdGl2ZSA+IDA7CgogICAgLy8g4LiE4LmI4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZCiAgICBjb25zdCBzaG93U2xvd1Jlc3BvbmRlcnMgPSBnYW1lRGF0YS5zaG93U2xvd1Jlc3BvbmRlcnMgIT09IGZhbHNlOyAKICAgIGNvbnN0IHNsb3dMaW1pdCA9IHBhcnNlSW50KGdhbWVEYXRhLnNsb3dSZXNwb25kZXJDb3VudCB8fCAzLCAxMCk7CiAgICBjb25zdCBwb3RIVE1MID0gZ2V0Q2VudHJhbFBvdEhUTUwoZ2FtZURhdGEpOwoKICAgIC8vIE9wdGlvbnMgSFRNTAogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgIGxldCBvcHRpb25zSFRNTCA9ICcnOwogICAgaWYgKChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpICYmIHF1ZXN0aW9uLm9wdGlvbnMgJiYgcXVlc3Rpb24ub3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgb3B0aW9uc0hUTUwgPSBgPGRpdiBjbGFzcz0iY29sLXNwYW4tZnVsbCB0ZXh0LWNlbnRlciBwLTggYmctYmxhY2svMjAgcm91bmRlZC1sZyBib3JkZXItMiBib3JkZXItZGFzaGVkIGJvcmRlci13aGl0ZS8zMCI+PGkgY2xhc3M9ImZhcyBmYS1leWUtc2xhc2ggdGV4dC00eGwgdGV4dC15ZWxsb3ctMzAwIG1iLTQiPjwvaT48cCBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgdGV4dC13aGl0ZSI+4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiW4Li54LiB4LiL4LmI4Lit4LiZ4Lit4Lii4Li54LmIPC9wPjwvZGl2PmA7CiAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnNIVE1MID0gKHF1ZXN0aW9uLm9wdGlvbnMgfHwgW10pLm1hcChvcHQgPT4gYDxkaXYgY2xhc3M9InAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUvMzAgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1zbSI+JHtvcHR9PC9kaXY+YCkuam9pbignJyk7CiAgICB9CgogICAgbGV0IHRpbWVySFRNTCA9ICcnOwogICAgaWYgKGdhbWVEYXRhLnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbicpIHsKICAgICAgICB0aW1lckhUTUwgPSBgPGRpdiBjbGFzcz0ibXktNCI+PGRpdiBpZD0ic3luYy10aW1lci1iYXItY29udGFpbmVyIiBjbGFzcz0idy1mdWxsIGJnLWdyYXktMjAwLzUwIHJvdW5kZWQtZnVsbCBoLTIuNSI+PGRpdiBpZD0ic3luYy10aW1lci1iYXIiIGNsYXNzPSJiZy15ZWxsb3ctNDAwIGgtMi41IHJvdW5kZWQtZnVsbCIgc3R5bGU9IndpZHRoOiAxMDAlIj48L2Rpdj48L2Rpdj48cCBjbGFzcz0idGV4dC1jZW50ZXIgdGV4dC1zbSB0ZXh0LXllbGxvdy0zMDAgbXQtMSI+4LmA4Lir4Lil4Li34Lit4LmA4Lin4Lil4LiyIDxzcGFuIGlkPSJzeW5jLXRpbWVyLWNvdW50ZG93biIgY2xhc3M9ImZvbnQtYm9sZCI+JHtnYW1lRGF0YS50aW1lckR1cmF0aW9ufTwvc3Bhbj4g4Lin4Li04LiZ4Liy4LiX4Li1PC9wPjwvZGl2PmA7CiAgICB9CiAgICAKICAgIC8vIFBsYXllciBMaXN0IEhUTUwKICAgIGNvbnN0IHBsYXllckxpc3RIVE1MID0gcGxheWVyc0luR2FtZS5tYXAocGxheWVyID0+IHsKICAgICAgICAgY29uc3QgaGFzQW5zd2VyZWQgPSBwbGF5ZXIuYW5zd2VyZWQgPT09IHRydWUgfHwgcGxheWVyLmFuc3dlcmVkQ3VycmVudFF1ZXN0aW9uID09PSB0cnVlOwogICAgICAgICBjb25zdCBiZ0NvbG9yID0gaGFzQW5zd2VyZWQgPyAnYmctZ3JlZW4tNTAwJyA6ICdiZy1ncmF5LTYwMCc7CiAgICAgICAgIGNvbnN0IGljb24gPSBoYXNBbnN3ZXJlZCA/ICc8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSI+PC9pPicgOiAnPGkgY2xhc3M9ImZhcyBmYS1ob3VyZ2xhc3MtaGFsZiI+PC9pPic7CiAgICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgcHgtMyBweS0xIHJvdW5kZWQtZnVsbCB0ZXh0LXdoaXRlIHRleHQtc20gJHtiZ0NvbG9yfSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1zbSI+JHtpY29ufTxzcGFuPiR7cGxheWVyLm5hbWV9PC9zcGFuPjxidXR0b24gZGF0YS1wbGF5ZXItbmFtZT0iJHtwbGF5ZXIubmFtZX0iIGNsYXNzPSJraWNrLXBsYXllci1idG4tc3luYyB0ZXh0LXJlZC0yMDAgaG92ZXI6dGV4dC13aGl0ZSBmb250LWJvbGQgbWwtMSBob3ZlcjpiZy1yZWQtNTAwLzIwIHJvdW5kZWQtZnVsbCB3LTUgaC01IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIiB0aXRsZT0i4LiZ4Liz4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiZ4Li14LmJ4Lit4Lit4LiBIj4mdGltZXM7PC9idXR0b24+PC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwoKICAgIC8vIFNsb3cgUmVzcG9uZGVycyBIVE1MCiAgICBsZXQgc2xvd1Jlc3BvbmRlcnNIVE1MID0gJyc7CiAgICBpZiAoc2hvd1Nsb3dSZXNwb25kZXJzICYmIHdhaXRpbmdDb3VudCA+IDAgJiYgd2FpdGluZ0NvdW50IDw9IHNsb3dMaW1pdCAmJiB0b3RhbEFjdGl2ZSA+IHdhaXRpbmdDb3VudCkgewogICAgICAgIGNvbnN0IG5hbWVzID0gd2FpdGluZ1BsYXllcnMubWFwKHAgPT4gcC5uYW1lKS5qb2luKCcsICcpOwogICAgICAgIHNsb3dSZXNwb25kZXJzSFRNTCA9IGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibXQtNiB3LWZ1bGwgbWF4LXctNHhsIG14LWF1dG8gcHgtNCBmYWRlLWluIiBpZD0ic2xvdy1yZXNwb25kZXItY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLXJlZC02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0zIHB4LTYgcm91bmRlZC14bCBzaGFkb3ctMnhsIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTQgYm9yZGVyLXJlZC04MDAgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIj4KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZWxhdGl2ZSB6LTEwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1sZyBmb250LWJvbGQgbWItMSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXNoaXBwaW5nLWZhc3QiPjwvaT4gPHNwYW4+4Lij4Lit4Lit4Li14LiBICR7d2FpdGluZ0NvdW50fSDguITguJnguKrguLjguJTguJfguYnguLLguKIhPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC0yeGwgZm9udC1leHRyYWJvbGQgdGV4dC15ZWxsb3ctMzAwIGRyb3Atc2hhZG93LW1kIj4ke25hbWVzfTwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIGA7CiAgICB9IGVsc2UgewogICAgICAgIHNsb3dSZXNwb25kZXJzSFRNTCA9ICc8ZGl2IGlkPSJzbG93LXJlc3BvbmRlci1jb250YWluZXIiIGNsYXNzPSJtdC02IHctZnVsbCBtYXgtdy00eGwgbXgtYXV0byBweC00Ij48L2Rpdj4nOwogICAgfQoKICAgIC8vIOKWvOKWvOKWvCBb4LmA4Lie4Li04LmI4Lih4LmD4Lir4Lih4LmIXSDguKrguKPguYnguLLguIcgQ29udGFpbmVyIOC5gOC4m+C4peC5iOC4suC5hiDguKrguLPguKvguKPguLHguJrguITguJnguKrguYjguIfguITguJnguYHguKPguIEg4pa84pa84pa8CiAgICBjb25zdCBmYXN0UmVzcG9uZGVySFRNTCA9ICc8ZGl2IGlkPSJmYXN0LXJlc3BvbmRlci1jb250YWluZXIiIGNsYXNzPSJtdC0yIHctZnVsbCBtYXgtdy00eGwgbXgtYXV0byBweC00Ij48L2Rpdj4nOwogICAgLy8g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYDguJ7guLTguYjguKFdIOKWsuKWsuKWsgoKICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciB0ZXh0LWxnIGZsZXgtc2hyaW5rLTAiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgPHNwYW4+4LiC4LmJ4Lit4LiX4Li14LmIICR7cUluZGV4ICsgMX0gLyAke3RvdGFsUXVlc3Rpb25zfTwvc3Bhbj4KICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSBmb250LW1vbm8iPjxpIGNsYXNzPSJmYXMgZmEta2V5IG1yLTIgb3BhY2l0eS03MCI+PC9pPiR7Z2FtZURhdGEucGlufTwvc3Bhbj4KICAgICR7cG90SFRNTH0KICAgIDxkaXYgaWQ9ImhlYWRlci1mYXN0LXJlc3BvbmRlciIgY2xhc3M9InRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLTUwMCI+PC9kaXY+CjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJiZy13aGl0ZS8yMCBweC0zIHB5LTEgcm91bmRlZC1mdWxsIHRleHQtYmFzZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIOC4leC4reC4muC5geC4peC5ieC4pzogPHNwYW4gaWQ9ImFuc3dlci1jb3VudGVyIiBjbGFzcz0iZm9udC1ib2xkIj4ke2Fuc3dlcmVkQ291bnR9LyR7dG90YWxBY3RpdmV9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzeW5jLW1hbmFnZS1wbGF5ZXJzLWJ0biIgY2xhc3M9InRleHQteHMgYmctd2hpdGUvMjAgaG92ZXI6Ymctd2hpdGUvNDAgcHgtMiBweS0xIHJvdW5kZWQtbWQgYm9yZGVyIGJvcmRlci13aGl0ZS8zMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdXNlcnMtY29nIG1yLTEiPjwvaT4g4LiI4Lix4LiU4LiB4Liy4LijCiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iZW5kLXN5bmMtZ2FtZS1idG4iIGNsYXNzPSJiZy1yZWQtNjAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtbWQgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXNtIj7guIjguJrguYDguIHguKE8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgaWQ9InN5bmMtcGxheWVyLW1hbmFnZW1lbnQiIGNsYXNzPSJoaWRkZW4gdy1mdWxsIGJnLWJsYWNrLzIwIHAtNCByb3VuZGVkLWxnIG10LTQgdGV4dC1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzEwIHNoYWRvdy1pbm5lciI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIG1iLTMgcGItMiBib3JkZXItYiBib3JkZXItd2hpdGUvMTAgZ2FwLTQiPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC00Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBjdXJzb3ItcG9pbnRlciB0ZXh0LXllbGxvdy0zMDAgaG92ZXI6dGV4dC15ZWxsb3ctMjAwIHNlbGVjdC1ub25lIGJnLWJsYWNrLzIwIHB4LTIgcHktMSByb3VuZGVkIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9InRvZ2dsZS1zbG93LXJlc3BvbmRlcnMiIGNsYXNzPSJoLTQgdy00IHRleHQtaW5kaWdvLTYwMCByb3VuZGVkIiAke3Nob3dTbG93UmVzcG9uZGVycyA/ICdjaGVja2VkJyA6ICcnfT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJtbC0yIGZvbnQtc2VtaWJvbGQiPjxpIGNsYXNzPSJmYXMgZmEtYmVsbCI+PC9pPiDguYHguIjguYnguIfguYDguJXguLfguK3guJnguITguJnguIrguYnguLI8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiB0ZXh0LWdyYXktMzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPuC5gOC4leC4t+C4reC4meC5gOC4oeC4t+C5iOC4reC5gOC4q+C4peC4t+C4rTo8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0ibnVtYmVyIiBpZD0iaW5wdXQtc2xvdy1jb3VudCIgdmFsdWU9IiR7c2xvd0xpbWl0fSIgbWluPSIxIiBtYXg9IiR7TWF0aC5tYXgoMSwgdG90YWxBY3RpdmUgLSAxKX0iIGNsYXNzPSJ3LTEyIHAtMC41IHRleHQtYmxhY2sgdGV4dC1jZW50ZXIgcm91bmRlZCBmb250LWJvbGQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+4LiE4LiZPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJjbG9zZS1tYW5hZ2UtYnRuIiBjbGFzcz0idGV4dC1ncmF5LTQwMCBob3Zlcjp0ZXh0LXdoaXRlIHB4LTIiPjxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi11cCI+PC9pPiDguIvguYjguK3guJk8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgIDxkaXYgaWQ9InN5bmMtcGxheWVyLWxpc3QiIGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBqdXN0aWZ5LXN0YXJ0IGdhcC0yIG1heC1oLTMyIG92ZXJmbG93LXktYXV0byBjdXN0b20tc2Nyb2xsYmFyIj4KICAgICAgICAgICAgICAgICAgICAke3BsYXllckxpc3RIVE1MfQogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAke3RpbWVySFRNTH0gCiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcmVsYXRpdmUiPgogICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItOCB0ZXh0LWNlbnRlciBsZWFkaW5nLXRpZ2h0IG1heC13LTV4bCI+JHtxdWVzdGlvbi5xdWVzdGlvblRleHQgfHwgcXVlc3Rpb24uc3RlbX08L2gyPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LTR4bCBncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC00Ij4ke29wdGlvbnNIVE1MfTwvZGl2PgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAke2Zhc3RSZXNwb25kZXJIVE1MfQogICAgICAgICAgICAgICAgJHtzbG93UmVzcG9uZGVyc0hUTUx9CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbXQtOCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCBmbGV4LXNocmluay0wIj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9Im9wZW4tc3luYy1zY3JhdGNocGFkLWJ0biIgY2xhc3M9ImJnLXdoaXRlLzIwIGhvdmVyOmJnLXdoaXRlLzMwIHRleHQtd2hpdGUgZm9udC1ib2xkIHB5LTMgcHgtOCByb3VuZGVkLWxnIHRleHQteGwgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYmFja2Ryb3AtYmx1ci1zbSBib3JkZXIgYm9yZGVyLXdoaXRlLzIwIj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBlbmNpbC1hbHQiPjwvaT4g4LiX4LiU4LmA4Lil4LiCCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9InNob3ctcmVzdWx0cy1idG4iIGNsYXNzPSJiZy15ZWxsb3ctNTAwIGhvdmVyOmJnLXllbGxvdy02MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwgZGlzYWJsZWQ6YmctZ3JheS01MDAgZGlzYWJsZWQ6Y3Vyc29yLW5vdC1hbGxvd2VkIHNoYWRvdy1sZyIgJHshYWxsQW5zd2VyZWQgPyAnZGlzYWJsZWQnIDogJyd9PgogICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hhcnQtYmFyIG1yLTIiPjwvaT4g4LmB4Liq4LiU4LiH4Lic4Lil4Lil4Lix4Lie4LiY4LmMCiAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwoKICAgIGlmICh3aW5kb3cuTWF0aEpheCkgTWF0aEpheC50eXBlc2V0UHJvbWlzZSgpOwogICAgCiAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvdy1yZXN1bHRzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4geyBhd2FpdCB1cGRhdGVEb2MoZ2FtZVJlZiwgeyBzdGF0dXM6ICdzdW1tYXJ5JyB9KTsgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3Blbi1zeW5jLXNjcmF0Y2hwYWQtYnRuJykub25jbGljayA9ICgpID0+IHsgb3BlblNjcmF0Y2hwYWQocXVlc3Rpb24sIHF1ZXN0aW9uLm9wdGlvbnMgfHwgW10pOyB9OwogICAgCiAgICAvLyBUb2dnbGUgQXJlYQogICAgY29uc3QgbWFuYWdlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtcGxheWVyLW1hbmFnZW1lbnQnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLW1hbmFnZS1wbGF5ZXJzLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBtYW5hZ2VDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7IH0pOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb3NlLW1hbmFnZS1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsgbWFuYWdlQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9KTsKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9nZ2xlLXNsb3ctcmVzcG9uZGVycycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7CiAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc2hvd1Nsb3dSZXNwb25kZXJzOiBlLnRhcmdldC5jaGVja2VkIH0pOwogICAgfSk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5wdXQtc2xvdy1jb3VudCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKSA9PiB7CiAgICAgICAgbGV0IHZhbCA9IHBhcnNlSW50KGUudGFyZ2V0LnZhbHVlKTsgaWYgKHZhbCA8IDEpIHZhbCA9IDE7IGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHNsb3dSZXNwb25kZXJDb3VudDogdmFsIH0pOwogICAgfSk7CiAgICBjb25zdCBlbmRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW5kLXN5bmMtZ2FtZS1idG4nKTsKICAgIGlmIChlbmRCdG4pIHsgZW5kQnRuLm9uY2xpY2sgPSAoKSA9PiB7IHNob3dDb25maXJtYXRpb24oJ+C4hOC4uOC4k+C5geC4meC5iOC5g+C4iOC4q+C4o+C4t+C4reC5hOC4oeC5iOC4p+C5iOC4suC4leC5ieC4reC4h+C4geC4suC4o+C4iOC4muC5gOC4geC4oeC4meC4teC5iT8nLCBhc3luYyAoKSA9PiB7IGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IHN0YXR1czogJ3BvZGl1bScgfSk7IH0pOyB9OyB9Cn0KCmZ1bmN0aW9uIHJlbmRlclN5bmNMZWFkZXJib2FyZFZpZXcoZ2FtZURhdGEsIGlzQWRtaW4pIHsKCiAgICBjb25zdCBwbGF5ZXJzID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KTsKICAgIHBsYXllcnMuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpOwogICAgY29uc3QgdG9wNSA9IHBsYXllcnMuc2xpY2UoMCwgNSk7CgogICAgbGV0IGFjdGlvbkJ1dHRvbkhUTUwgPSAnJzsKICAgIGlmIChpc0FkbWluKSB7CiAgICAgICAgY29uc3QgaXNMYXN0UXVlc3Rpb24gPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA+PSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aCAtIDE7CiAgICAgICAgYWN0aW9uQnV0dG9uSFRNTCA9IGA8YnV0dG9uIGlkPSJuZXh0LXN5bmMtcXVlc3Rpb24tYnRuIiBjbGFzcz0iYmctZ3JheS04MDAgaG92ZXI6YmctYmxhY2sgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC0yeGwgbXQtOCI+JHtpc0xhc3RRdWVzdGlvbiA/ICfguJTguLnguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKInIDogJ+C4guC5ieC4reC4leC5iOC4reC5hOC4myd9IDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctcmlnaHQiPjwvaT48L2J1dHRvbj5gOwogICAgfSBlbHNlIHsKICAgICAgICBhY3Rpb25CdXR0b25IVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQtbGcgdGV4dC1pbmRpZ28tMjAwIj7guYDguJXguKPguLXguKLguKHguJXguLHguKfguKrguLPguKvguKPguLHguJrguILguYnguK3guJXguYjguK3guYTguJsuLi48L3A+YDsKICAgIH0KCiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgbWItNiI+4LiV4Liy4Lij4Liy4LiH4LiE4Liw4LmB4LiZ4LiZPC9oMj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIHNwYWNlLXktMyI+JHt0b3A1Lm1hcCgocGxheWVyLCBpbmRleCkgPT4gYDxkaXYgY2xhc3M9ImJnLWJsYWNrLzIwIHAtMyByb3VuZGVkLWxnIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciB0ZXh0LXhsIj48c3BhbiBjbGFzcz0iZm9udC1zZW1pYm9sZCI+JHtpbmRleCArIDF9LiAke3BsYXllci5uYW1lfTwvc3Bhbj48c3BhbiBjbGFzcz0iZm9udC1ib2xkIj4ke3BsYXllci5zY29yZX08L3NwYW4+PC9kaXY+YCkuam9pbignJyl9PC9kaXY+CiAgICAgICAgICAgICR7YWN0aW9uQnV0dG9uSFRNTH0KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgaWYgKGlzQWRtaW4pIHsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dC1zeW5jLXF1ZXN0aW9uLWJ0bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICAgICAgY29uc3QgbmV4dEluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggKyAxOwoKICAgICAgICAgICAgaWYgKG5leHRJbmRleCA8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJVcGRhdGVzID0ge307CiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhnYW1lRGF0YS5wbGF5ZXJzKS5mb3JFYWNoKG5hbWUgPT4geyBwbGF5ZXJVcGRhdGVzW2BwbGF5ZXJzLiR7bmFtZX0uYW5zd2VyZWRgXSA9IGZhbHNlOyB9KTsKICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZURvYyhnYW1lUmVmLCB7IAogICAgc3RhdHVzOiAncXVlc3Rpb24nLCAKICAgIGN1cnJlbnRRdWVzdGlvbkluZGV4OiBuZXh0SW5kZXgsCiAgICBxdWVzdGlvbkRpc3BsYXllZEF0OiBzZXJ2ZXJUaW1lc3RhbXAoKSwKICAgIHNjb3Jlc0NhbGN1bGF0ZWQ6IGZhbHNlIC8vIDwtLS0g4LmA4Lie4Li04LmI4Lih4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4LmA4Lie4Li34LmI4Lit4Lij4Li14LmA4LiL4LmH4LiV4LiE4LmI4Liy4LmA4Lih4Li34LmI4Lit4LmA4Lij4Li04LmI4Lih4LiC4LmJ4Lit4LmD4Lir4Lih4LmICn0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlRG9jKGdhbWVSZWYsIHsgc3RhdHVzOiAncG9kaXVtJyB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVKb2luU3luY0dhbWUoKSB7CiAgICBjb25zdCBwaW4gPSBwcm9tcHQoIuC4geC4o+C4uOC4k+C4suC4m+C5ieC4reC4meC4o+C4q+C4seC4qiBTeW5jIEdhbWUgKDIg4Lir4Lil4Lix4LiBKToiKTsKICAgIGlmICghcGluIHx8IHBpbi50cmltKCkubGVuZ3RoICE9PSAyKSB7CiAgICAgICAgc2hvd01lc3NhZ2UoIuC4o+C4q+C4seC4quC5hOC4oeC5iOC4luC4ueC4geC4leC5ieC4reC4hyIpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICB0cnkgewogICAgICAgIGNvbnN0IGdhbWVzUmVmID0gY29sbGVjdGlvbihkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXNgKTsKICAgICAgICBjb25zdCBxID0gcXVlcnkoZ2FtZXNSZWYsIHdoZXJlKCJwaW4iLCAiPT0iLCBwaW4udHJpbSgpKSwgd2hlcmUoInN0YXR1cyIsICI9PSIsICJsb2JieSIpKTsKICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldERvY3MocSk7CgogICAgICAgIGlmIChzbmFwc2hvdC5lbXB0eSkgewogICAgICAgICAgICBzaG93TWVzc2FnZSgi4LmE4Lih4LmI4Lie4LiaIFN5bmMgR2FtZSDguJTguYnguKfguKLguKPguKvguLHguKrguJnguLXguYkg4Lir4Lij4Li34Lit4LiB4Li04LiI4LiB4Lij4Lij4Lih4LmE4LiU4LmJ4LmA4Lij4Li04LmI4Lih4LmE4Lib4LmB4Lil4LmJ4LinIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGdhbWVEb2MgPSBzbmFwc2hvdC5kb2NzWzBdOwogICAgICAgIGN1cnJlbnRMaXZlR2FtZUlkID0gZ2FtZURvYy5pZDsgLy8g4LmD4LiK4LmJ4LiV4Lix4Lin4LmB4Lib4Lij4LiB4Lil4Liy4LiH4LmA4LiU4Li04LihCiAgICAgICAgY29uc3QgZ2FtZURhdGEgPSBnYW1lRG9jLmRhdGEoKTsKCiAgICAgICAgLy8g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54LilIFByb2plY3Qg4LiI4Liy4LiBIHF1aXpJZCDguJfguLXguYjguK3guKLguLnguYjguYPguJkgZ2FtZURhdGEKICAgICAgICBjb25zdCBxdWl6UmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3F1aXp6ZXNgLCBnYW1lRGF0YS5xdWl6SWQpOwogICAgICAgIGNvbnN0IHF1aXpTbmFwID0gYXdhaXQgZ2V0RG9jKHF1aXpSZWYpOwogICAgICAgIGlmICghcXVpelNuYXAuZXhpc3RzKCkpIHRocm93IG5ldyBFcnJvcigi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4LmB4Lia4Lia4LiX4LiU4Liq4Lit4Lia4LiX4Li14LmI4LmD4LiK4LmJ4LmD4LiZ4LmA4LiB4Lih4LiZ4Li14LmJIik7CiAgICAgICAgY29uc3QgcXVpekRhdGEgPSBxdWl6U25hcC5kYXRhKCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcHJvamVjdFJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9wcm9qZWN0c2AsIHF1aXpEYXRhLnByb2plY3RJZCk7CiAgICAgICAgY29uc3QgcHJvamVjdFNuYXAgPSBhd2FpdCBnZXREb2MocHJvamVjdFJlZik7CiAgICAgICAgaWYgKCFwcm9qZWN0U25hcC5leGlzdHMoKSkgdGhyb3cgbmV3IEVycm9yKCLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguYLguJvguKPguYDguIjguIQiKTsKCiAgICAgICAgY3VycmVudFF1aXpEYXRhID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6OyAvLyDguYPguIrguYnguILguYnguK3guKrguK3guJrguJfguLXguYjguKrguKXguLHguJrguYHguKXguYnguKfguIjguLLguIHguYPguJnguYDguIHguKEKICAgICAgICBjb25zdCBwcm9qZWN0RGF0YSA9IHByb2plY3RTbmFwLmRhdGEoKTsKCiAgICAgICAgLy8gKioqIOC4iOC4uOC4lOC5gOC4m+C4peC4teC5iOC4ouC4meC4quC4s+C4hOC4seC4jTog4LmA4Lij4Li14Lii4LiB4LmD4LiK4LmJ4Lir4LiZ4LmJ4Liy4LiI4Lit4LmA4Lil4Li34Lit4LiB4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiC4Lit4LiHIFRlYW0gTW9kZSAqKioKICAgICAgICBzaG93Vmlldygnc3R1ZGVudC10ZWFtLWpvaW4nKTsgLy8g4Liq4Lix4LmI4LiH4LmD4Lir4LmJ4LmB4Liq4LiU4LiH4Lir4LiZ4LmJ4Liy4LiI4LitIGNoZWNrYm94CiAgICAgICAgc2hvd1RlYW1QbGF5ZXJTZWxlY3Rpb24ocHJvamVjdERhdGEuc3R1ZGVudHMsIHF1aXpEYXRhLnRvcGljKTsKCiAgICAgICAgLy8g4LmA4Lib4Lil4Li14LmI4Lii4LiZIEV2ZW50IExpc3RlbmVyIOC4guC4reC4h+C4m+C4uOC5iOC4oeC4ouC4t+C4meC4ouC4seC4meC5g+C4q+C5ieC5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC4guC4reC4hyBTeW5jIE1vZGUKICAgICAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm0tdGVhbS1wbGF5ZXJzLWJ0bicpOwogICAgICAgIGNvbmZpcm1CdG4ub25jbGljayA9IGNvbmZpcm1BbmRKb2luU3luY0dhbWU7IC8vIOC5gOC4m+C4peC4teC5iOC4ouC4meC5g+C4q+C5ieC5hOC4m+C5gOC4o+C4teC4ouC4geC4n+C4seC4h+C4geC5jOC4iuC4seC4meC5g+C4q+C4oeC5iAoKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igam9pbmluZyBzeW5jIGdhbWU6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguYDguIHguLTguJTguILguYnguK3guJzguLTguJTguJ7guKXguLLguJQ6ICIgKyBlcnJvci5tZXNzYWdlKTsKICAgIH0KfQoKZnVuY3Rpb24gdXBkYXRlU3R1ZGVudFN5bmNWaWV3KGdhbWVEYXRhKSB7CiAgICBjb25zdCBteU5hbWUgPSBsb2NhbFRlYW1QbGF5ZXJzWzBdOwogICAgY29uc3QgbXlEYXRhID0gZ2FtZURhdGEucGxheWVyc1tteU5hbWVdIHx8IHt9OyAKCiAgICBpZiAoc3luY1F1ZXN0aW9uVGltZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChzeW5jUXVlc3Rpb25UaW1lckludGVydmFsKTsKICAgIAogICAgc3dpdGNoIChnYW1lRGF0YS5zdGF0dXMpIHsKICAgICAgICBjYXNlICdsb2JieSc6CiAgICAgICAgICAgIHNob3dWaWV3KCdsaXZlLWdhbWUnKTsKICAgICAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsIj48aDI+4LmA4LiC4LmJ4Liy4Lij4LmI4Lin4Lih4Liq4Liz4LmA4Lij4LmH4LiIITwvaDI+PHA+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmA4Lij4Li04LmI4Lih4LmA4LiB4LihLi4uPC9wPjwvZGl2PmA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgICBjYXNlICdxdWVzdGlvbic6CiAgICAgICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4oeC4teC4geC4suC4o+C5gOC4m+C4peC4teC5iOC4ouC4meC4guC5ieC4reC5g+C4q+C4oeC5iOC4q+C4o+C4t+C4reC5hOC4oeC5iAogICAgICAgICAgICBpZiAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggIT09IGxhc3RTZWVuUXVlc3Rpb25JbmRleCkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIk5ldyBxdWVzdGlvbiBkZXRlY3RlZC4gQ2xlYW5pbmcgdXAuIik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIC0tLSBb4LiI4Li44LiU4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCOiDguKLguYnguLLguKLguIHguLLguKPguKPguLXguYDguIvguYfguJXguKXguLPguJTguLHguJrguKHguLLguYTguKfguYnguJXguKPguIfguJnguLXguYldIC0tLQogICAgICAgICAgICAgICAgLy8g4LiI4Liw4Lij4Li14LmA4LiL4LmH4LiV4LmA4Lib4LmH4LiZ4LiE4LiZ4LmB4Lij4LiBIOC5gOC4ieC4nuC4suC4sOC5gOC4oeC4t+C5iOC4rSAi4LiC4Li24LmJ4LiZ4LiC4LmJ4Lit4LmD4Lir4Lih4LmIIiDguYDguJfguYjguLLguJnguLHguYnguJkKICAgICAgICAgICAgICAgIGxvY2FsUGxheWVyVHVybkluZGV4ID0gMDsgCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgogICAgICAgICAgICAgICAgLy8gMS4g4Lil4LmJ4Liy4LiHIFNlc3Npb25TdG9yYWdlCiAgICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdwb3dlcnVwVXNlZFRoaXNUdXJuJyk7IAogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnb25TZWNvbmRDaGFuY2UnKTsKICAgICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oJ3BvbGxVc2VkVGhpc1R1cm4nKTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG9sZE1hcmtldEZsYWdQcmVmaXggPSAnZnJlZU1hcmtldEVudHJ5VXNlZF9xJyArIGxhc3RTZWVuUXVlc3Rpb25JbmRleDsKICAgICAgICAgICAgICAgIGNvbnN0IG9sZFBvd2VydXBGbGFnUHJlZml4ID0gJ3Bvd2VydXBVc2VkX3EnICsgbGFzdFNlZW5RdWVzdGlvbkluZGV4OyAKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEhpZGRlbk9wdGlvbnNQcmVmaXggPSAnaGlkZGVuT3B0aW9uc19xJyArIGxhc3RTZWVuUXVlc3Rpb25JbmRleDsKCiAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhzZXNzaW9uU3RvcmFnZSkuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aChvbGRNYXJrZXRGbGFnUHJlZml4KSB8fCBrZXkuc3RhcnRzV2l0aChvbGRQb3dlcnVwRmxhZ1ByZWZpeCkgfHwga2V5LnN0YXJ0c1dpdGgob2xkSGlkZGVuT3B0aW9uc1ByZWZpeCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIDIuIOC4peC5ieC4suC4h+C4quC4luC4suC4meC4sOC4hOC5ieC4suC4h+C5g+C4mSBEYXRhYmFzZQogICAgICAgICAgICAgICAgaWYgKG15RGF0YS5pc0ppbnhlZCB8fCBteURhdGEuaXNGb3JjZWRDb25maWRlbnQgfHwgKG15RGF0YS50aW1lQm9udXNUaGlzUXVlc3Rpb24gfHwgMCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgbXlOYW1lKTsKICAgICAgICAgICAgICAgICAgICB1cGRhdGVEb2MocGxheWVyUmVmLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlzSmlueGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgaXNGb3JjZWRDb25maWRlbnQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lQm9udXNUaGlzUXVlc3Rpb246IDAKICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IGNvbnNvbGUuZXJyb3IoIkF1dG8tY2xlYW51cCBmYWlsZWQ6IiwgZSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxhc3RTZWVuUXVlc3Rpb25JbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAtLS0gW+C4iOC4uOC4lOC4l+C4teC5iOC5geC4geC5ieC5hOC4gjog4Lil4Lia4Lia4Lij4Lij4LiX4Lix4LiU4LiZ4Li14LmJ4Lit4Lit4LiBXSAtLS0KICAgICAgICAgICAgLy8gbG9jYWxQbGF5ZXJUdXJuSW5kZXggPSAwOyA8LS0tIOC4peC4muC4reC4reC4gSDguYDguJ7guKPguLLguLDguKHguLHguJnguJfguLPguYPguKvguYnguYDguJTguYnguIfguIHguKXguLHguJrguJfguLjguIHguITguKPguLHguYnguIfguJfguLXguYjguIvguLfguYnguK3guILguK3guIcKICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgICAgICAgICAgY29uc3QgYWxsTG9jYWxQbGF5ZXJzQW5zd2VyZWQgPSBsb2NhbFRlYW1QbGF5ZXJzLmV2ZXJ5KG5hbWUgPT4gZ2FtZURhdGEucGxheWVyc1tuYW1lXT8uYW5zd2VyZWQgPT09IHRydWUpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKGFsbExvY2FsUGxheWVyc0Fuc3dlcmVkKSB7CiAgICAgICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPjxoMj7guKrguYjguIfguITguLPguJXguK3guJrguITguKPguJrguYHguKXguYnguKchPC9oMj48cD7guKPguK3guJzguLnguYnguYDguKXguYjguJnguITguJnguK3guLfguYjguJnguKrguLHguIHguITguKPguLnguYguLi48L3A+PC9kaXY+YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRTeW5jUXVlc3Rpb25WaWV3KGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTG9naWMgVGltZXIgKOC5gOC4q+C4oeC4t+C4reC4meC5gOC4lOC4tOC4oSkKICAgICAgICAgICAgICAgIGlmIChnYW1lRGF0YS50aW1lck1vZGUgPT09ICdwZXJfcXVlc3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFnYW1lRGF0YS5xdWVzdGlvbkRpc3BsYXllZEF0KSByZXR1cm47IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IGdhbWVEYXRhLnF1ZXN0aW9uRGlzcGxheWVkQXQudG9EYXRlKCkuZ2V0VGltZSgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZ2FtZURhdGEudGltZXJEdXJhdGlvbiAqIDEwMDA7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IG15Qm9udXNlcyA9IGxvY2FsVGVhbVBsYXllcnMubWFwKG5hbWUgPT4gZ2FtZURhdGEucGxheWVyc1tuYW1lXT8udGltZUJvbnVzVGhpc1F1ZXN0aW9uIHx8IDApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2ZUJvbnVzTXMgPSBNYXRoLm1heCguLi5teUJvbnVzZXMsIDApOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVuZFRpbWUgPSBzdGFydFRpbWUgKyBkdXJhdGlvbiArIGFjdGl2ZUJvbnVzTXM7IAoKICAgICAgICAgICAgICAgICAgICBzeW5jUXVlc3Rpb25UaW1lckludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZW1haW5pbmcgPSBlbmRUaW1lIC0gRGF0ZS5ub3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXJCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy10aW1lci1iYXInKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY291bnRkb3duID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtdGltZXItY291bnRkb3duJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmcgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChzeW5jUXVlc3Rpb25UaW1lckludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lckJhcikgdGltZXJCYXIuc3R5bGUud2lkdGggPSAnMCUnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZG93bikgY291bnRkb3duLnRleHRDb250ZW50ID0gJzAnOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguYPguITguKPguJfguLXguYjguKLguLHguIfguYTguKHguYjguYTguJTguYnguJXguK3guJrguYDguKHguLfguYjguK3guYDguKfguKXguLLguKvguKHguJQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXIgPSBsb2NhbFRlYW1QbGF5ZXJzW2xvY2FsUGxheWVyVHVybkluZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChnYW1lRGF0YS5wbGF5ZXJzW2N1cnJlbnRQbGF5ZXJdPy5hbnN3ZXJlZCAhPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtOCB0ZXh0LWNlbnRlciBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jbG9jayBmYS0zeCB0ZXh0LXllbGxvdy0zMDAgbWItNCI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQiPuC4q+C4oeC4lOC5gOC4p+C4peC4siE8L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9Im10LTQgdGV4dC14bCB0ZXh0LWluZGlnby0yMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oS4uLiAo4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiT4LmE4Lih4LmI4LiW4Li54LiB4Lia4Lix4LiZ4LiX4Li24LiBKTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lckJhciAmJiBjb3VudGRvd24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbER1cmF0aW9uV2l0aEJvbnVzID0gZHVyYXRpb24gKyBhY3RpdmVCb251c01zOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSB0b3RhbER1cmF0aW9uV2l0aEJvbnVzID4gMCA/IChyZW1haW5pbmcgLyB0b3RhbER1cmF0aW9uV2l0aEJvbnVzKSAqIDEwMCA6IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZXJCYXIuc3R5bGUud2lkdGggPSBgJHtwZXJjZW50YWdlfSVgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZG93bi50ZXh0Q29udGVudCA9IE1hdGguY2VpbChyZW1haW5pbmcgLyAxMDAwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIAogICAgICAgIGNhc2UgJ3N1bW1hcnknOgogICAgICAgICAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IHRleHQtY2VudGVyIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGgtZnVsbCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibG9hZGVyIj48L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtdC00Ij7guJfguLjguIHguITguJnguJXguK3guJrguITguKPguJrguYHguKXguYnguKchPC9oMj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0ibXQtNCB0ZXh0LXhsIHRleHQtaW5kaWdvLTIwMCI+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmB4Liq4LiU4LiH4Lic4Lil4Lil4Lix4Lie4LiY4LmMLi4uPC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIGA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAKICAgICAgIGNhc2UgJ3Jlc3VsdHMnOgogICAgICAgICAgICBsb2NhbFBsYXllclR1cm5JbmRleCA9IDA7IC8vIOC4o+C4teC5gOC4i+C5h+C4leC4leC4reC4meC4q+C4meC5ieC4suC4quC4o+C4uOC4m+C4nOC4peC5hOC4lOC5iSAo4LmA4Lie4Li34LmI4Lit4LmA4LiV4Lij4Li14Lii4Lih4Lie4Lij4LmJ4Lit4Lih4Liq4Liz4Lir4Lij4Lix4Lia4Lij4Lit4Lia4Lir4LiZ4LmJ4LiyKQogICAgICAgICAgICBjb25zdCB2YXJpYW50ID0gZ2FtZURhdGEuZ2FtZVZhcmlhbnQgfHwgJ2NsYXNzaWMnOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHZhcmlhbnQgPT09ICdhbm9ueW1vdXMnIHx8IHZhcmlhbnQgPT09ICdhbm9ueW1vdXNfcmV2ZWFsX2VuZCcpIHsKICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRBbm9ueW1vdXNSZXN1bHRzVmlldyhnYW1lRGF0YSwgZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXgpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHZhcmlhbnQgPT09ICdjb21wZXRpdGlvbicpIHsKICAgICAgICAgICAgICAgIHJlbmRlclN0dWRlbnRDb21wZXRpdGlvblJlc3VsdHNWaWV3KGdhbWVEYXRhLCBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCk7IAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudFN5bmNSZXN1bHRzVmlldyhnYW1lRGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIAogICAgICAgIGNhc2UgJ3BvZGl1bSc6CiAgICAgICAgICAgIHJlbGVhc2VXYWtlTG9jaygpOwogICAgICAgICAgICBzdG9wRGltVGltZXIoKTsKICAgICAgICAgICAgZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgICAgICAgaXNRdWl6QWN0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBoYW5kbGVGdWxsc2NyZWVuQ2hhbmdlKTsKICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndmlzaWJpbGl0eWNoYW5nZScsIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKCdhY3RpdmVHYW1lU2Vzc2lvbicpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY3VycmVudEhUTUwgPSBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MOwogICAgICAgICAgICBjb25zdCBpc0FscmVhZHlTaG93aW5nUmVzdWx0cyA9IGN1cnJlbnRIVE1MLmluY2x1ZGVzKCfguKrguKPguLjguJvguITguLDguYHguJnguJnguILguK3guIfguITguLjguJMnKSB8fCBjdXJyZW50SFRNTC5pbmNsdWRlcygn4Liq4Lij4Li44Lib4Lit4Lix4LiZ4LiU4Lix4LiaJyk7CgogICAgICAgICAgICBpZiAoIWlzQWxyZWFkeVNob3dpbmdSZXN1bHRzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFZhcmlhbnQgPSBnYW1lRGF0YS5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICAgICAgICAgICAgICBjb25zdCBsYXN0UUluZGV4ID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGggLSAxOyAKCiAgICAgICAgICAgICAgICBpZiAoZmluYWxWYXJpYW50ID09PSAnYW5vbnltb3VzJyB8fCBmaW5hbFZhcmlhbnQgPT09ICdhbm9ueW1vdXNfcmV2ZWFsX2VuZCcpIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50QW5vbnltb3VzUmVzdWx0c1ZpZXcoZ2FtZURhdGEsIGxhc3RRSW5kZXgpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmaW5hbFZhcmlhbnQgPT09ICdjb21wZXRpdGlvbicpIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50Q29tcGV0aXRpb25SZXN1bHRzVmlldyhnYW1lRGF0YSwgbGFzdFFJbmRleCk7IAogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZW5kZXJTdHVkZW50U3luY1Jlc3VsdHNWaWV3KGdhbWVEYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYWxsUGFyYWdyYXBocyA9IGxpdmVHYW1lVmlldy5xdWVyeVNlbGVjdG9yQWxsKCdwJyk7CiAgICAgICAgICAgIGFsbFBhcmFncmFwaHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGlmIChwLnRleHRDb250ZW50LmluY2x1ZGVzKCfguYDguJXguKPguLXguKLguKHguJ7guJrguIHguLHguJrguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKInKSB8fCAKICAgICAgICAgICAgICAgICAgICBwLnRleHRDb250ZW50LmluY2x1ZGVzKCfguKPguK3guJzguLnguYnguITguKfguJrguITguLjguKEnKSkgewogICAgICAgICAgICAgICAgICAgIHAuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LWV4aXQtZ2FtZS1idG4nKSkgewogICAgICAgICAgICAgICAgY29uc3QgZXhpdEJ1dHRvbkhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIGZsZXgganVzdGlmeS1jZW50ZXIgbXQtOCBwYi04IGZhZGUtaW4iPgogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJzdHVkZW50LWV4aXQtZ2FtZS1idG4iIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKSIgY2xhc3M9ImJnLXJlZC02MDAgaG92ZXI6YmctcmVkLTcwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1mdWxsIHRleHQteGwgc2hhZG93LWxnIHRyYW5zaXRpb24tdHJhbnNmb3JtIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1zaWduLW91dC1hbHQiPjwvaT4g4LiI4Lia4LmA4LiB4Lih4LmB4Lil4Liw4LiB4Lil4Lix4Lia4Lir4LiZ4LmJ4Liy4Lir4Lil4Lix4LiBCiAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGlmIChsaXZlR2FtZVZpZXcuZmlyc3RFbGVtZW50Q2hpbGQpIHsKICAgICAgICAgICAgICAgICAgICBsaXZlR2FtZVZpZXcuZmlyc3RFbGVtZW50Q2hpbGQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBleGl0QnV0dG9uSFRNTCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxpdmVHYW1lVmlldy5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGV4aXRCdXR0b25IVE1MKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgIH0KfQoKZnVuY3Rpb24gcmVuZGVyU3R1ZGVudFN5bmNSZXN1bHRzVmlldyhnYW1lRGF0YSkgewoKaWYgKGdhbWVEYXRhLmdhbWVWYXJpYW50ID09PSAnZXhhbV9zdHJpY3QnKSB7CiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllci1jb250ZW50JykgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUtZ2FtZS12aWV3Jyk7CiAgICAgICAgCiAgICAgICAgLy8gMS4g4LiU4Li24LiH4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LiX4Lix4LmJ4LiH4Lir4Lih4LiU4LmA4Lie4Li34LmI4Lit4LiE4Liz4LiZ4Lin4LiT4Liq4LiW4Li04LiV4Li0CiAgICAgICAgbGV0IGFsbFBsYXllcnMgPSBbXTsKICAgICAgICBpZiAoZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQgJiYgZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQubGVuZ3RoID4gMCkgewogICAgICAgICAgICBhbGxQbGF5ZXJzID0gZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYWxsUGxheWVycyA9IE9iamVjdC52YWx1ZXMoZ2FtZURhdGEucGxheWVycyB8fCB7fSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnN0IHRvdGFsUGxheWVycyA9IGFsbFBsYXllcnMubGVuZ3RoOwoKICAgICAgICAvLyAyLiDguITguLPguJnguKfguJPguKrguJbguLTguJXguLQgKOC4hOC4sOC5geC4meC4meC4lOC4tOC4mikKICAgICAgICBjb25zdCBzY29yZXMgPSBhbGxQbGF5ZXJzLm1hcChwID0+IHAuc2NvcmUgfHwgMCk7IC8vIOC5g+C4iuC5ieC4hOC4sOC5geC4meC4meC4lOC4tOC4miAoc2NvcmUpCiAgICAgICAgY29uc3QgbWF4U2NvcmUgPSBzY29yZXMubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLnNjb3JlcykgOiAwOwogICAgICAgIGNvbnN0IG1pblNjb3JlID0gc2NvcmVzLmxlbmd0aCA+IDAgPyBNYXRoLm1pbiguLi5zY29yZXMpIDogMDsKICAgICAgICAKICAgICAgICBjb25zdCBtYXhDb3VudCA9IGFsbFBsYXllcnMuZmlsdGVyKHAgPT4gKHAuc2NvcmUgfHwgMCkgPT09IG1heFNjb3JlKS5sZW5ndGg7CiAgICAgICAgY29uc3QgbWluQ291bnQgPSBhbGxQbGF5ZXJzLmZpbHRlcihwID0+IChwLnNjb3JlIHx8IDApID09PSBtaW5TY29yZSkubGVuZ3RoOwoKICAgICAgICAvLyAzLiDguITguLPguJnguKfguJPguITguJnguYTguJTguYnguYDguJXguYfguKEgKExvZ2ljOiDguJXguYnguK3guIfguJXguK3guJrguJbguLnguIHguJfguLjguIHguILguYnguK3guIjguJnguJbguLbguIfguJvguLHguIjguIjguLjguJrguLHguJkpCiAgICAgICAgY29uc3QgY3VycmVudFFJZHggPSAoZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXggIT09IHVuZGVmaW5lZCkgPyBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA6IC0xOwogICAgICAgIAogICAgICAgIGNvbnN0IHBlcmZlY3RTY29yZXJzQ291bnQgPSBhbGxQbGF5ZXJzLmZpbHRlcihwID0+IHsKICAgICAgICAgICAgLy8g4LiV4LmJ4Lit4LiH4Lih4Li14Lib4Lij4Liw4Lin4Lix4LiV4Li04LiB4Liy4Lij4LiV4Lit4LiaCiAgICAgICAgICAgIGlmICghcC5hbnN3ZXJzIHx8IHAuYW5zd2Vycy5sZW5ndGggPT09IDApIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIOC4p+C4meC4peC4ueC4m+C5gOC4iuC5h+C4hOC4ouC5ieC4reC4meC4q+C4peC4seC4h+C4l+C4uOC4geC4guC5ieC4rSAoMCDguJbguLbguIcgY3VycmVudFFJZHgpCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGN1cnJlbnRRSWR4OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFucyA9IHAuYW5zd2Vycy5maW5kKGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBpKTsKICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC4q+C4suC4hOC4s+C4leC4reC4muC5hOC4oeC5iOC5gOC4iOC4rSDguKvguKPguLfguK0g4LiV4Lit4Lia4Lic4Li04LiUID0g4LmE4Lih4LmI4LmA4LiV4LmH4LihCiAgICAgICAgICAgICAgICBpZiAoIWFucyB8fCAhYW5zLmlzQ29ycmVjdCkgcmV0dXJuIGZhbHNlOyAKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9KS5sZW5ndGg7CgogICAgICAgIC8vIDQuIOC4quC4o+C5ieC4suC4hyBIVE1MIChEZXNpZ24g4LmA4LiU4Li14Lii4Lin4LiB4Lix4LiaIEFkbWluIOC5geC4leC5iOC4ouC5iOC4reC4quC5iOC4p+C4mSkKICAgICAgICBjb25zdCBkYXNoYm9hcmRIVE1MID0gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBoLWZ1bGwgdy1mdWxsIHAtNCB0ZXh0LXdoaXRlIGFuaW1hdGUtZmFkZS1pbiBiZy1ncmF5LTkwMCByb3VuZGVkLWxnIj4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1jZW50ZXIgbWItNiBtdC00Ij4KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LWdyYXktMjAwIG1iLTEiPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoYXJ0LXBpZSBtci0yIHRleHQtYmx1ZS00MDAiPjwvaT4g4Lig4Liy4Lie4Lij4Lin4Lih4LiB4Liy4Lij4Liq4Lit4LiaCiAgICAgICAgICAgICAgICAgICAgPC9oMj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNDAwIj7guJzguLnguYnguYDguILguYnguLLguKrguK3guJrguJfguLHguYnguIfguKvguKHguJQ6IDxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIGZvbnQtYm9sZCI+JHt0b3RhbFBsYXllcnN9PC9zcGFuPiDguITguJk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJncmlkIGdyaWQtY29scy0xIGdhcC00IHctZnVsbCBtYXgtdy1zbSI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JheS04MDAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci15ZWxsb3ctNTAwLzMwIHNoYWRvdy1sZyByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LVsxMHB4XSB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIgbWItMSI+4LiE4Liw4LmB4LiZ4LiZ4Liq4Li54LiH4Liq4Li44LiUPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNHhsIGZvbnQtYmxhY2sgdGV4dC15ZWxsb3ctNDAwIGxlYWRpbmctbm9uZSI+JHttYXhTY29yZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtWzEwcHhdIHRleHQtZ3JheS01MDAgYmxvY2siPuC4iOC4s+C4meC4p+C4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIj4ke21heENvdW50fTwvc3Bhbj4gPHNwYW4gY2xhc3M9InRleHQteHMiPuC4hOC4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdHJvcGh5IGFic29sdXRlIC1ib3R0b20tMiAtbGVmdC0yIHRleHQtNnhsIHRleHQteWVsbG93LTUwMC8xMCB6LTAiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmF5LTgwMCBwLTUgcm91bmRlZC14bCBib3JkZXIgYm9yZGVyLWdyZWVuLTUwMC8zMCBzaGFkb3ctbGcgcmVsYXRpdmUgb3ZlcmZsb3ctaGlkZGVuIGZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtZ3JheS00MDAgdGV4dC1bMTBweF0gdXBwZXJjYXNlIHRyYWNraW5nLXdpZGVyIG1iLTEiPuC4l+C4s+C5hOC4lOC5ieC5gOC4leC5h+C4oSAo4LiW4Li24LiH4LiC4LmJ4Lit4LiZ4Li14LmJKTwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJsYWNrIHRleHQtZ3JlZW4tNDAwIGxlYWRpbmctbm9uZSI+JHtwZXJmZWN0U2NvcmVyc0NvdW50fTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1yaWdodCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1bMTBweF0gdGV4dC1ncmF5LTUwMCBibG9jayI+4LiI4Liy4LiB4LiX4Lix4LmJ4LiH4Lir4Lih4LiUPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteGwgZm9udC1ib2xkIHRleHQtd2hpdGUiPiR7dG90YWxQbGF5ZXJzfTwvc3Bhbj4gPHNwYW4gY2xhc3M9InRleHQteHMiPuC4hOC4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtc3RhciBhYnNvbHV0ZSAtYm90dG9tLTIgLWxlZnQtMiB0ZXh0LTZ4bCB0ZXh0LWdyZWVuLTUwMC8xMCB6LTAiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctZ3JheS04MDAgcC01IHJvdW5kZWQteGwgYm9yZGVyIGJvcmRlci1yZWQtNTAwLzMwIHNoYWRvdy1sZyByZWxhdGl2ZSBvdmVyZmxvdy1oaWRkZW4gZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LVsxMHB4XSB1cHBlcmNhc2UgdHJhY2tpbmctd2lkZXIgbWItMSI+4LiE4Liw4LmB4LiZ4LiZ4LiV4LmI4Liz4Liq4Li44LiUPC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtNHhsIGZvbnQtYmxhY2sgdGV4dC1yZWQtNDAwIGxlYWRpbmctbm9uZSI+JHttaW5TY29yZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtWzEwcHhdIHRleHQtZ3JheS01MDAgYmxvY2siPuC4iOC4s+C4meC4p+C4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIj4ke21pbkNvdW50fTwvc3Bhbj4gPHNwYW4gY2xhc3M9InRleHQteHMiPuC4hOC4mTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtYXJyb3ctZG93biBhYnNvbHV0ZSAtYm90dG9tLTIgLWxlZnQtMiB0ZXh0LTZ4bCB0ZXh0LXJlZC01MDAvMTAgei0wIj48L2k+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC04IHRleHQtY2VudGVyIGFuaW1hdGUtcHVsc2UgcGItOCI+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgdGV4dC1ibHVlLTMwMCBmb250LWJvbGQiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIG10LTIiPirguKPguLDguJrguJrguIvguYjguK3guJnguITguLDguYHguJnguJnguKrguYjguKfguJnguJXguLHguKfguYDguJ7guLfguYjguK3guKXguJTguITguKfguLLguKHguIHguJTguJTguLHguJk8L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKCiAgICAgICAgaWYoY29udGFpbmVyKSBjb250YWluZXIuaW5uZXJIVE1MID0gZGFzaGJvYXJkSFRNTDsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgLy8gMS4g4LiU4Li24LiH4Lic4Li54LmJ4LmA4Lil4LmI4LiZICLguJfguLjguIHguITguJkiIOC5g+C4meC4q+C5ieC4reC4hwogICAgbGV0IGFsbFBsYXllcnNTb3VyY2UgPSBbXTsKICAgIGlmIChnYW1lRGF0YS5wdWJsaWNMZWFkZXJib2FyZCAmJiBBcnJheS5pc0FycmF5KGdhbWVEYXRhLnB1YmxpY0xlYWRlcmJvYXJkKSAmJiBnYW1lRGF0YS5wdWJsaWNMZWFkZXJib2FyZC5sZW5ndGggPiAwKSB7CiAgICAgICAgYWxsUGxheWVyc1NvdXJjZSA9IGdhbWVEYXRhLnB1YmxpY0xlYWRlcmJvYXJkOwogICAgfSBlbHNlIHsKICAgICAgICBhbGxQbGF5ZXJzU291cmNlID0gT2JqZWN0LnZhbHVlcyhnYW1lRGF0YS5wbGF5ZXJzIHx8IHt9KTsKICAgIH0KCiAgICBjb25zdCB2YXJpYW50ID0gZ2FtZURhdGEuZ2FtZVZhcmlhbnQgfHwgJ2NsYXNzaWMnOwogICAgY29uc3QgaXNSZXZlYWxBdEVuZE1vZGUgPSAodmFyaWFudCA9PT0gJ3JldmVhbF9hdF9lbmQnIHx8IHZhcmlhbnQgPT09ICdhbm9ueW1vdXNfcmV2ZWFsX2VuZCcpOwogICAgY29uc3QgcXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uczsKICAgIAogICAgY29uc3QgbGltaXRJbmRleCA9IChpc1JldmVhbEF0RW5kTW9kZSAmJiBnYW1lRGF0YS5yZXZpZXdRdWVzdGlvbkluZGV4ICE9PSB1bmRlZmluZWQpIAogICAgICAgICAgICAgICAgICAgICAgID8gZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCAKICAgICAgICAgICAgICAgICAgICAgICA6IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgCiAgICBjb25zdCBxdWVzdGlvbkluZGV4VG9DaGVjayA9IChpc1JldmVhbEF0RW5kTW9kZSkgPyBnYW1lRGF0YS5yZXZpZXdRdWVzdGlvbkluZGV4IDogZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CgogICAgLy8gMi4g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZCiAgICBjb25zdCBhbGxQbGF5ZXJzQ2FsY3VsYXRlZCA9IGFsbFBsYXllcnNTb3VyY2UubWFwKHAgPT4gewogICAgICAgIGNvbnN0IGFuc3dlcnNUb0NvbnNpZGVyID0gKHAuYW5zd2VycyB8fCBbXSkuZmlsdGVyKGFucyA9PiBhbnMucXVlc3Rpb25JbmRleCA8PSBsaW1pdEluZGV4KTsKICAgICAgICBsZXQgcmVhbFNjb3JlID0gMDsKICAgICAgICBsZXQgcG9pbnRzID0gMDsgCiAgICAgICAgaWYgKGlzUmV2ZWFsQXRFbmRNb2RlKSB7CiAgICAgICAgICAgIHJlYWxTY29yZSA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbHRlcihhID0+IGEuaXNDb3JyZWN0KS5sZW5ndGg7CiAgICAgICAgICAgIHBvaW50cyA9IGFuc3dlcnNUb0NvbnNpZGVyLnJlZHVjZSgoc3VtLCBhKSA9PiBzdW0gKyAoYS5wb2ludHNBd2FyZGVkIHx8IDApLCAwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWFsU2NvcmUgPSBwLnNjb3JlIHx8IDA7CiAgICAgICAgICAgIHBvaW50cyA9IHAudG90YWxQb2ludHMgfHwgMDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLS0tIFtGSVggTE9HSUMgU1RBUlRdIOC4hOC4s+C4meC4p+C4kyBTdHJlYWsg4LmB4Lia4Lia4LmA4LiC4LmJ4Lih4LiH4Lin4LiUICjguYDguKvguKHguLfguK3guJkgQWRtaW4pIC0tLQogICAgICAgIGxldCBkeW5hbWljU3RyZWFrID0gMDsKICAgICAgICAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBsaW1pdEluZGV4OyBpKyspIHsKICAgICAgICAgICAgIGNvbnN0IGFucyA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbmQoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IGkpOwogICAgICAgICAgICAgaWYgKGFucykgewogICAgICAgICAgICAgICAgY29uc3QgaXNDb21ib0JyZWFrZXIgPSAoYW5zLnBvd2VydXBVc2VkICYmIGFucy5wb3dlcnVwVXNlZCAhPT0gJ3dhZ2VyTXVsdGlwbGllcicpIHx8IGFucy51c2VkQnV5VGltZTsKICAgICAgICAgICAgICAgIGlmIChhbnMuaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSBpc0NvbWJvQnJlYWtlciA/IDAgOiBkeW5hbWljU3RyZWFrICsgMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIC8vIOC4luC5ieC4suC5hOC4oeC5iOC4oeC4teC4hOC4s+C4leC4reC4muC5g+C4meC4o+C4reC4muC4meC4teC5iSA9IOC4nOC4tOC4lCA9IOC4o+C4teC5gOC4i+C5h+C4lQogICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSAwOwogICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyAtLS0gW0ZJWCBMT0dJQyBFTkRdIC0tLQoKICAgICAgICByZXR1cm4geyAuLi5wLCByZWFsU2NvcmUsIHRvdGFsUG9pbnRzOiBwb2ludHMsIGFuc3dlcnM6IHAuYW5zd2VycywgY29ycmVjdFN0cmVhazogZHluYW1pY1N0cmVhayB9OwogICAgfSk7CgogICAgY29uc3QgbWF4UG9pbnRzID0gTWF0aC5tYXgoLi4uYWxsUGxheWVyc0NhbGN1bGF0ZWQubWFwKHAgPT4gcC50b3RhbFBvaW50cyksIC1JbmZpbml0eSk7CiAgICBjb25zdCBtYXhSYXdTY29yZSA9IE1hdGgubWF4KC4uLmFsbFBsYXllcnNDYWxjdWxhdGVkLm1hcChwID0+IHAucmVhbFNjb3JlKSwgLUluZmluaXR5KTsKICAgIGNvbnN0IGlzTWFya2V0TW9kZSA9IGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlOwoKICAgIC8vIOC4iOC4seC4lOC5gOC4o+C4teC4ouC4h+C5geC4peC4sOC4hOC4s+C4meC4p+C4k+C4reC4seC4meC4lOC4seC4mgogICAgY29uc3Qgc29ydGVkQWxsUGxheWVycyA9IFsuLi5hbGxQbGF5ZXJzQ2FsY3VsYXRlZF0uc29ydCgoYSwgYikgPT4gewogICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgY29uc3QgcG9pbnRzRGlmZiA9IGIudG90YWxQb2ludHMgLSBhLnRvdGFsUG9pbnRzOwogICAgICAgICAgICBpZiAocG9pbnRzRGlmZiAhPT0gMCkgcmV0dXJuIHBvaW50c0RpZmY7CiAgICAgICAgICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIucmVhbFNjb3JlIC0gYS5yZWFsU2NvcmU7CiAgICAgICAgICAgIGlmIChzY29yZURpZmYgIT09IDApIHJldHVybiBzY29yZURpZmY7CiAgICAgICAgICAgIHJldHVybiAoYS5uYW1lIHx8ICcnKS5sb2NhbGVDb21wYXJlKGIubmFtZSB8fCAnJywgJ3RoJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcG9pbnRzRGlmZiA9IGIudG90YWxQb2ludHMgLSBhLnRvdGFsUG9pbnRzOwogICAgICAgICAgICBpZiAocG9pbnRzRGlmZiAhPT0gMCkgcmV0dXJuIHBvaW50c0RpZmY7CiAgICAgICAgICAgIGNvbnN0IHNjb3JlRGlmZiA9IGIucmVhbFNjb3JlIC0gYS5yZWFsU2NvcmU7CiAgICAgICAgICAgIGlmIChzY29yZURpZmYgIT09IDApIHJldHVybiBzY29yZURpZmY7CiAgICAgICAgICAgIHJldHVybiAoYS5uYW1lIHx8ICcnKS5sb2NhbGVDb21wYXJlKGIubmFtZSB8fCAnJywgJ3RoJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgbGV0IGN1cnJlbnRSYW5rID0gMTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGVkQWxsUGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICBjb25zdCBwcmV2ID0gc29ydGVkQWxsUGxheWVyc1tpIC0gMV07CiAgICAgICAgICAgIGNvbnN0IGN1cnIgPSBzb3J0ZWRBbGxQbGF5ZXJzW2ldOwogICAgICAgICAgICBsZXQgaXNUaWVkID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgICAgICBpc1RpZWQgPSAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cykgJiYgKGN1cnIucmVhbFNjb3JlID09PSBwcmV2LnJlYWxTY29yZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWlzVGllZCkgewogICAgICAgICAgICAgICAgY3VycmVudFJhbmsgPSBpICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzb3J0ZWRBbGxQbGF5ZXJzW2ldLmRpc3BsYXlSYW5rID0gY3VycmVudFJhbms7CiAgICB9CgogICAgLy8g4LiB4Lij4Lit4LiH4LmA4LiJ4Lie4Liy4Liw4Lic4Li54LmJ4LmA4Lil4LmI4LiZ4LmD4LiZ4LmA4LiE4Lij4Li34LmI4Lit4LiH4LiZ4Li14LmJCiAgICBsZXQgbXlQbGF5ZXJzVG9SZW5kZXIgPSBzb3J0ZWRBbGxQbGF5ZXJzLmZpbHRlcihwID0+IGxvY2FsVGVhbVBsYXllcnMuaW5jbHVkZXMocC5uYW1lKSk7CiAgICBteVBsYXllcnNUb1JlbmRlci5zb3J0KChhLCBiKSA9PiAoYi50b3RhbFBvaW50cyB8fCAwKSAtIChhLnRvdGFsUG9pbnRzIHx8IDApKTsKCiAgICBsZXQgZm9vdGVyTWVzc2FnZUhUTUwgPSAnJzsKICAgIGNvbnN0IGlzTGFzdFF1ZXN0aW9uID0gKGlzUmV2ZWFsQXRFbmRNb2RlKSA/IChsaW1pdEluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKSA6IChnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCA+PSBxdWVzdGlvbnMubGVuZ3RoIC0gMSk7CiAgICAKICAgIGlmIChnYW1lRGF0YS5zdGF0dXMgPT09ICdwb2RpdW0nKSB7CiAgICAgICAgZm9vdGVyTWVzc2FnZUhUTUwgPSAnJzsgCiAgICB9IGVsc2UgaWYgKGlzTGFzdFF1ZXN0aW9uKSB7CiAgICAgICAgZm9vdGVyTWVzc2FnZUhUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC14bCBmb250LWJvbGQgdGV4dC15ZWxsb3ctMzAwIGFuaW1hdGUtcHVsc2UiPuC5gOC4leC4o+C4teC4ouC4oeC4nuC4muC4geC4seC4muC4nOC4peC4quC4o+C4uOC4m+C4quC4uOC4lOC4l+C5ieC4suC4oiE8L3A+YDsKICAgIH0gZWxzZSB7CiAgICAgICAgZm9vdGVyTWVzc2FnZUhUTUwgPSBgPHAgY2xhc3M9Im10LTggdGV4dC1sZyB0ZXh0LWluZGlnby0yMDAiPuC4o+C4reC4nOC4ueC5ieC4hOC4p+C4muC4hOC4uOC4oeC5hOC4m+C4guC5ieC4reC4leC5iOC4reC5hOC4my4uLjwvcD5gOwogICAgfQoKICAgIGNvbnN0IHBvdEhUTUwgPSBnZXRDZW50cmFsUG90SFRNTChnYW1lRGF0YSk7CgogICAgY29uc3QgcmVzdWx0c0hUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC02IGZsZXggZmxleC1jb2wgaC1mdWxsIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi00IHNjYWxlLTExMCI+JHtwb3RIVE1MfTwvZGl2PgoKICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTN4bCBmb250LWJvbGQgbWItNiB0ZXh0LWNlbnRlciI+4Liq4Lij4Li44Lib4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiE4Li44LiTPC9oMj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIHNwYWNlLXktMyI+CiAgICAgICAgICAgICAgICAke215UGxheWVyc1RvUmVuZGVyLm1hcCgocGxheWVyLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgICAgIGxldCBiZ0NsYXNzID0gJ2JnLXdoaXRlIHRleHQtZ3JheS04MDAnOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBbnN3ZXIgPSAocGxheWVyLmFuc3dlcnMgfHwgW10pLmZpbmQoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IHF1ZXN0aW9uSW5kZXhUb0NoZWNrKTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHBvdEJvbnVzSFRNTCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyICYmIGN1cnJlbnRBbnN3ZXIucG90Qm9udXMgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBvdEJvbnVzSFRNTCA9IGA8c3BhbiBjbGFzcz0idGV4dC14cyBiZy15ZWxsb3ctMTAwIHRleHQteWVsbG93LTgwMCBweC0yIHB5LTAuNSByb3VuZGVkLWZ1bGwgZm9udC1ib2xkIG1sLTEgc2hhZG93LXNtIGJvcmRlciBib3JkZXIteWVsbG93LTMwMCIgdGl0bGU9IuC4quC5iOC4p+C4meC5geC4muC5iOC4h+C4iOC4suC4geC4hOC4meC4leC4reC4muC4nOC4tOC4lCI+KyR7Y3VycmVudEFuc3dlci5wb3RCb251c30gUG90PC9zcGFuPmA7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBsZXQgdHVyblN0YXR1c0ljb25zSFRNTCA9ICcnOwogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyLndhc0ZvcmNlZCkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5guC4lOC4meC4muC4seC4h+C4hOC4seC4miI+8J+Ruzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFuc3dlci53YXNKaW54ZWQpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYLguJTguJnguITguLPguKrguLLguJsiPvCfmIg8L3NwYW4+JzsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBbnN3ZXIudXNlZEJ1eVRpbWUpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYPguIrguYnguYDguKfguKXguLIiPuKPszwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gY3VycmVudEFuc3dlci5wb3dlcnVwVXNlZDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpY29ucyA9IHsgJ3BvbGwnOiAn8J+TiicsICdjdXRPbmUnOiAn4pyC77iPJywgJ2luc3VyYW5jZSc6ICfwn5uh77iPJywgJ2ZpZnR5RmlmdHknOiAn8J+MlycsICd3YWdlck11bHRpcGxpZXInOiAn8J+SsCcsICdzZWNvbmRDaGFuY2UnOiAn8J+UgScsICdyZXZlYWxPcHRpb25zJzogJ/CfkYHvuI8nIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGljb25zW2l0ZW1dKSB0dXJuU3RhdHVzSWNvbnNIVE1MICs9IGA8c3BhbiB0aXRsZT0i4LmD4LiK4LmJICR7aXRlbX0iPiR7aWNvbnNbaXRlbV19PC9zcGFuPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50QW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29ycmVjdCA9IGN1cnJlbnRBbnN3ZXIuaXNDb3JyZWN0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NvbmZpZGVudCA9IChjdXJyZW50QW5zd2VyLndhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCBjdXJyZW50QW5zd2VyLndhc0NvbmZpZGVudCA9PT0gJ2NvbmZpZGVudCcpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwb3dlcnVwVXNlZCA9IGN1cnJlbnRBbnN3ZXIucG93ZXJ1cFVzZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJnQ2xhc3MgPSBpc0NvcnJlY3QgPyAnYmcteWVsbG93LTMwMCB0ZXh0LXllbGxvdy05MDAgZm9udC1ib2xkJyA6ICdiZy1yZWQtNzAwIHRleHQtd2hpdGUgZm9udC1ib2xkJzsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0NvbmZpZGVudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdDbGFzcyA9IGlzQ29ycmVjdCA/ICdiZy1bIzRBREU4MF0gdGV4dC1ncmVlbi05MDAgZm9udC1ib2xkJyA6ICdiZy1bI0VGNDQ0NF0gdGV4dC13aGl0ZSBmb250LWJvbGQnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdDbGFzcyA9ICdiZy1bI0RDRkNFN10gdGV4dC1ncmVlbi05MDAnOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmdDbGFzcyA9ICdiZy1yZWQtMTAwIHRleHQtcmVkLTkwMCc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBb4LmA4Lie4Li04LmI4LihXSDguJbguYnguLLguYTguKHguYjguYTguJTguYnguJXguK3guJogKOC4q+C4oeC4lOC5gOC4p+C4peC4sikg4LmD4Lir4LmJ4Lie4Li34LmJ4LiZ4Lir4Lil4Lix4LiH4LmA4Lib4LmH4LiZ4Liq4Li14LmB4LiU4LiHICjguJzguLTguJQpCiAgICAgICAgICAgICAgICAgICAgICAgIGJnQ2xhc3MgPSAnYmctcmVkLTEwMCB0ZXh0LXJlZC05MDAnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgcHVuaXNobWVudEhUTUwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFuc3dlciAmJiBjdXJyZW50QW5zd2VyLnBvd2VydXBVc2VkID09PSAnd2FnZXJNdWx0aXBsaWVyJyAmJiAhY3VycmVudEFuc3dlci5pc0NvcnJlY3QpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVuaXNobWVudEhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtdC0yIHAtMiBiZy1yZWQtNjAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyB0ZXh0LWNlbnRlciBhbmltYXRlLWJvdW5jZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1oYW5kLWhvbGRpbmctdXNkIGZhLTJ4IG1iLTEiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC1zbSBmb250LWJvbGQiPuC5gOC4lOC4tOC4oeC4nuC4seC4meC4nOC4tOC4lCE8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtbGcgZm9udC1leHRyYWJvbGQgdGV4dC15ZWxsb3ctMzAwIj7wn5K4IOC5gOC4h+C4tOC4meC4luC4ueC4geC4ouC4tuC4lOC5gOC4guC5ieC4suC4geC4reC4h+C4geC4peC4suC4hyE8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBvaW50c0Rpc3BsYXkgPSBwbGF5ZXIudG90YWxQb2ludHMgPj0gMCAKICAgICAgICAgICAgICAgICAgICAgICAgPyBgKCske3BsYXllci50b3RhbFBvaW50cy50b0xvY2FsZVN0cmluZygpfSlgIAogICAgICAgICAgICAgICAgICAgICAgICA6IGAoJHtwbGF5ZXIudG90YWxQb2ludHMudG9Mb2NhbGVTdHJpbmcoKX0pYDsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHN0YXR1c0ljb25IVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxBbnN3ZXJzU29GYXIgPSBwbGF5ZXIuYW5zd2Vycy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxRdWVzdGlvbnNBc2tlZCA9IGxpbWl0SW5kZXggKyAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxBbnN3ZXJzU29GYXIgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc01hcmtldE1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIudG90YWxQb2ludHMgPT09IG1heFBvaW50cyAmJiBtYXhQb2ludHMgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTUwMCBtbC0xIHRleHQtMnhsIGRyb3Atc2hhZG93LW1kIj7wn5GRPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyLnJlYWxTY29yZSA9PT0gbWF4UmF3U2NvcmUgJiYgbWF4UmF3U2NvcmUgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtYmx1ZS01MDAgbWwtMSB0ZXh0LTJ4bCBkcm9wLXNoYWRvdy1tZCI+8J+Okzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllci5yZWFsU2NvcmUgPT09IHRvdGFsUXVlc3Rpb25zQXNrZWQpIHN0YXR1c0ljb25IVE1MICs9ICc8c3BhbiBjbGFzcz0idGV4dC15ZWxsb3ctNDAwIG1sLTEgdGV4dC14bCBkcm9wLXNoYWRvdy1tZCI+4q2QPC9zcGFuPic7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhc0dvb2RJY29uID0gc3RhdHVzSWNvbkhUTUwuaW5jbHVkZXMoJ/CfkZEnKSB8fCBzdGF0dXNJY29uSFRNTC5pbmNsdWRlcygn8J+OkycpIHx8IHN0YXR1c0ljb25IVE1MLmluY2x1ZGVzKCfirZAnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNHb29kSWNvbiAmJiBwbGF5ZXIudG90YWxQb2ludHMgPCAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTUwMCBtbC0xIHRleHQteGwiPuKaoO+4jzwvc3Bhbj4nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgZmlyZUljb25IVE1MID0gJyc7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdHVyblVzZWRCdXlUaW1lID0gY3VycmVudEFuc3dlciAmJiBjdXJyZW50QW5zd2VyLnVzZWRCdXlUaW1lOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHR1cm5Vc2VkSXRlbSA9IGN1cnJlbnRBbnN3ZXIgJiYgY3VycmVudEFuc3dlci5wb3dlcnVwVXNlZCAmJiBjdXJyZW50QW5zd2VyLnBvd2VydXBVc2VkICE9PSAnd2FnZXJNdWx0aXBsaWVyJzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCF0dXJuVXNlZEJ1eVRpbWUgJiYgIXR1cm5Vc2VkSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gW+C5g+C4iuC5ieC4hOC5iOC4suC4l+C4teC5iOC4hOC4s+C4meC4p+C4k+C5g+C4q+C4oeC5iF0gLS0tCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBTdHJlYWsgPSBwbGF5ZXIuY29ycmVjdFN0cmVhayB8fCAwOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocFN0cmVhayA+PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJlSWNvbkhUTUwgPSBgPHNwYW4gY2xhc3M9Im1sLTIgdGV4dC1vcmFuZ2UtNTAwIGFuaW1hdGUtcHVsc2UgZm9udC1ib2xkIj7wn5SlIHgke3BTdHJlYWt9PC9zcGFuPmA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iJHtiZ0NsYXNzfSBwLTMgcm91bmRlZC1sZyBmbGV4IGZsZXgtY29sIGdhcC0yIGJvcmRlci0yIGJvcmRlci1ibGFjay8xMCBzaGFkb3ctc20gdHJhbnNpdGlvbi1hbGwiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIHNtOmZsZXgtcm93IHNtOml0ZW1zLWNlbnRlciBzbTpqdXN0aWZ5LWJldHdlZW4gZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyB3LWZ1bGwgc206dy1hdXRvIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LXNocmluay0wIHctOCBoLTggZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1mdWxsIGJnLWJsYWNrLzEwIGZvbnQtYm9sZCB0ZXh0LWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwbGF5ZXIuZGlzcGxheVJhbmt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LXdyYXAgaXRlbXMtY2VudGVyIGdhcC0xIG1pbi13LTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQtbGcgdHJ1bmNhdGUgYnJlYWstd29yZHMgbWF4LXctWzE4MHB4XSBzbTptYXgtdy14cyBsZWFkaW5nLXRpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR7cGxheWVyLm5hbWV9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0dXJuU3RhdHVzSWNvbnNIVE1MfSAke3N0YXR1c0ljb25IVE1MfSAke2ZpcmVJY29uSFRNTH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBzbTpqdXN0aWZ5LWVuZCB3LWZ1bGwgc206dy1hdXRvIHBsLTExIHNtOnBsLTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktNzAgc206aGlkZGVuIj7guITguLDguYHguJnguJnguKPguKfguKE6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtcmlnaHQgd2hpdGVzcGFjZS1ub3dyYXAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQteGwiPiR7cGxheWVyLnJlYWxTY29yZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktODAgbWwtMSBmb250LW1lZGl1bSI+JHtwb2ludHNEaXNwbGF5fTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwb3RCb251c0hUTUx9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAke3B1bmlzaG1lbnRIVE1MfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYH0pLmpvaW4oJycpfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgJHtmb290ZXJNZXNzYWdlSFRNTH0gCiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IHJlc3VsdHNIVE1MOwp9CgpmdW5jdGlvbiByZW5kZXJTdHVkZW50QW5vbnltb3VzUmVzdWx0c1ZpZXcoZ2FtZURhdGEsIHF1ZXN0aW9uSW5kZXhUb1Nob3cpIHsKICAgIGxldCBwbGF5ZXJzID0gW107CiAgICBpZiAoZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQpIHsKICAgICAgICBwbGF5ZXJzID0gZ2FtZURhdGEucHVibGljTGVhZGVyYm9hcmQ7CiAgICB9IGVsc2UgewogICAgICAgIHBsYXllcnMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pOwogICAgfQoKICAgIGNvbnN0IHZhcmlhbnQgPSBnYW1lRGF0YS5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICBjb25zdCBpc1JldmVhbEF0RW5kTW9kZSA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcgfHwgdmFyaWFudCA9PT0gJ2Fub255bW91c19yZXZlYWxfZW5kJyk7CiAgICBjb25zdCBpc1JldmVhbGVkID0gKGdhbWVEYXRhLmlzQW5vbnltb3VzUmV2ZWFsZWQgPT09IHRydWUpOwogICAgY29uc3QgcXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9uczsKICAgIGNvbnN0IGxpbWl0SW5kZXggPSAoaXNSZXZlYWxBdEVuZE1vZGUgJiYgZ2FtZURhdGEucmV2aWV3UXVlc3Rpb25JbmRleCAhPT0gdW5kZWZpbmVkKSA/IGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXggOiBxdWVzdGlvbkluZGV4VG9TaG93OwoKICAgIGNvbnN0IHBsYXllcnNXaXRoU2NvcmVzID0gcGxheWVycy5tYXAocCA9PiB7CiAgICAgICAgY29uc3QgYW5zd2Vyc1RvQ29uc2lkZXIgPSAocC5hbnN3ZXJzIHx8IFtdKS5maWx0ZXIoYW5zID0+IGFucy5xdWVzdGlvbkluZGV4IDw9IGxpbWl0SW5kZXgpOwogICAgICAgIGxldCByZWFsU2NvcmUgPSAwLCBwb2ludHMgPSAwOwogICAgICAgIGlmIChpc1JldmVhbEF0RW5kTW9kZSkgewogICAgICAgICAgICByZWFsU2NvcmUgPSBhbnN3ZXJzVG9Db25zaWRlci5maWx0ZXIoYSA9PiBhLmlzQ29ycmVjdCkubGVuZ3RoOwogICAgICAgICAgICBwb2ludHMgPSBhbnN3ZXJzVG9Db25zaWRlci5yZWR1Y2UoKHN1bSwgYSkgPT4gc3VtICsgKGEucG9pbnRzQXdhcmRlZCB8fCAwKSwgMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVhbFNjb3JlID0gcC5zY29yZSB8fCAwOwogICAgICAgICAgICBwb2ludHMgPSBwLnRvdGFsUG9pbnRzIHx8IDA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIFNUQVJUXSDguITguLPguJnguKfguJMgU3RyZWFrIOC5geC4muC4muC5gOC4guC5ieC4oeC4h+C4p+C4lOC4quC4s+C4q+C4o+C4seC4muC5guC4q+C4oeC4lCBBbm9ueW1vdXMgLS0tCiAgICAgICAgbGV0IGR5bmFtaWNTdHJlYWsgPSAwOwogICAgICAgIAogICAgICAgIC8vIOC4p+C4meC4peC4ueC4m+C4leC4seC5ieC4h+C5geC4leC5iOC4guC5ieC4reC5geC4o+C4geC4iOC4meC4luC4tuC4h+C4guC5ieC4reC4m+C4seC4iOC4iOC4uOC4muC4seC4mSDguYDguJ7guLfguYjguK3guKvguLLguIjguLjguJTguJfguLXguYggIuC5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4miIKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBsaW1pdEluZGV4OyBpKyspIHsKICAgICAgICAgICAgIGNvbnN0IGFucyA9IGFuc3dlcnNUb0NvbnNpZGVyLmZpbmQoYSA9PiBhLnF1ZXN0aW9uSW5kZXggPT09IGkpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICBpZiAoYW5zKSB7CiAgICAgICAgICAgICAgICAvLyDguKHguLXguITguLPguJXguK3guJo6IOC5gOC4iuC5h+C4hOC4p+C5iOC4suC4luC4ueC4geC5hOC4q+C4oSDguYHguKXguLDguYPguIrguYnguYTguK3guYDguJfguKHguJXguLHguJTguITguK3guKHguYLguJrguKvguKPguLfguK3guYTguKHguYgKICAgICAgICAgICAgICAgIGNvbnN0IGlzQ29tYm9CcmVha2VyID0gKGFucy5wb3dlcnVwVXNlZCAmJiBhbnMucG93ZXJ1cFVzZWQgIT09ICd3YWdlck11bHRpcGxpZXInKSB8fCBhbnMudXNlZEJ1eVRpbWU7CiAgICAgICAgICAgICAgICBpZiAoYW5zLmlzQ29ycmVjdCkgewogICAgICAgICAgICAgICAgICAgICBkeW5hbWljU3RyZWFrID0gaXNDb21ib0JyZWFrZXIgPyAwIDogZHluYW1pY1N0cmVhayArIDE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGR5bmFtaWNTdHJlYWsgPSAwOyAvLyDguJXguK3guJrguJzguLTguJQgPSDguKPguLXguYDguIvguYfguJUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgLy8g4LmE4Lih4LmI4Lih4Li14LiE4Liz4LiV4Lit4Lia4LmD4LiZ4LiC4LmJ4Lit4LiZ4Li14LmJICjguKvguKHguJTguYDguKfguKXguLIpID0g4Lij4Li14LmA4LiL4LmH4LiV4LiX4Lix4LiZ4LiX4Li1CiAgICAgICAgICAgICAgICAgZHluYW1pY1N0cmVhayA9IDA7CiAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIC0tLSBbRklYIExPR0lDIEVORF0gLS0tCgogICAgICAgIHJldHVybiB7IC4uLnAsIHJlYWxTY29yZSwgdG90YWxQb2ludHM6IHBvaW50cywgYW5zd2VyczogYW5zd2Vyc1RvQ29uc2lkZXIsIGNvcnJlY3RTdHJlYWs6IGR5bmFtaWNTdHJlYWsgfTsKICAgIH0pOwoKICAgIGNvbnN0IG1heFBvaW50cyA9IE1hdGgubWF4KC4uLnBsYXllcnNXaXRoU2NvcmVzLm1hcChwID0+IHAudG90YWxQb2ludHMpLCAtSW5maW5pdHkpOwogICAgY29uc3QgbWF4UmF3U2NvcmUgPSBNYXRoLm1heCguLi5wbGF5ZXJzV2l0aFNjb3Jlcy5tYXAocCA9PiBwLnJlYWxTY29yZSksIC1JbmZpbml0eSk7CiAgICBjb25zdCBpc01hcmtldE1vZGUgPSBnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICBjb25zdCBzb3J0ZWRQbGF5ZXJzID0gWy4uLnBsYXllcnNXaXRoU2NvcmVzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBpZiAoYi50b3RhbFBvaW50cyAhPT0gYS50b3RhbFBvaW50cykgcmV0dXJuIGIudG90YWxQb2ludHMgLSBhLnRvdGFsUG9pbnRzOwogICAgICAgICAgICBpZiAoYi5yZWFsU2NvcmUgIT09IGEucmVhbFNjb3JlKSByZXR1cm4gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoYi50b3RhbFBvaW50cyAhPT0gYS50b3RhbFBvaW50cykgcmV0dXJuIGIudG90YWxQb2ludHMgLSBhLnRvdGFsUG9pbnRzOwogICAgICAgICAgICBpZiAoYi5yZWFsU2NvcmUgIT09IGEucmVhbFNjb3JlKSByZXR1cm4gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgIH0pOwoKICAgIC8vIOC4hOC4s+C4meC4p+C4k+C4reC4seC4meC4lOC4seC4mgogICAgbGV0IGN1cnJlbnRSYW5rID0gMTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGVkUGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChpID4gMCkgewogICAgICAgICAgICBjb25zdCBwcmV2ID0gc29ydGVkUGxheWVyc1tpIC0gMV07CiAgICAgICAgICAgIGNvbnN0IGN1cnIgPSBzb3J0ZWRQbGF5ZXJzW2ldOwogICAgICAgICAgICBsZXQgaXNUaWVkID0gKGN1cnIudG90YWxQb2ludHMgPT09IHByZXYudG90YWxQb2ludHMpICYmIChjdXJyLnJlYWxTY29yZSA9PT0gcHJldi5yZWFsU2NvcmUpOwogICAgICAgICAgICBpZiAoIWlzVGllZCkgewogICAgICAgICAgICAgICAgY3VycmVudFJhbmsgPSBpICsgMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzb3J0ZWRQbGF5ZXJzW2ldLmRpc3BsYXlSYW5rID0gY3VycmVudFJhbms7CiAgICB9CgogICAgbGV0IHZpZXdlclBsYXllciA9IG51bGw7CiAgICBjb25zdCBsb2NhbFBsYXllckRhdGEgPSBwbGF5ZXJzV2l0aFNjb3Jlcy5maWx0ZXIocCA9PiBsb2NhbFRlYW1QbGF5ZXJzLmluY2x1ZGVzKHAubmFtZSkpOwogICAgdmlld2VyUGxheWVyID0gbG9jYWxQbGF5ZXJEYXRhLmxlbmd0aCA+IDAgPyBsb2NhbFBsYXllckRhdGEuc29ydCgoYSwgYikgPT4gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHMpWzBdIDogbnVsbDsKICAgIAogICAgaWYgKCF2aWV3ZXJQbGF5ZXIpIHsgCiAgICAgICAgbGl2ZUdhbWVWaWV3LmlubmVySFRNTCA9IGA8ZGl2IGNsYXNzPSJiZy1pbmRpZ28tNzAwIHRleHQtd2hpdGUgcm91bmRlZC1sZyBwLTggdGV4dC1jZW50ZXIgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgaC1mdWxsIj48aDI+4LiB4Liz4Lil4Lix4LiH4Lij4Lit4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZLi4uPC9oMj48L2Rpdj5gOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHZpZXdlclByaW1hcnlTY29yZSA9IGlzTWFya2V0TW9kZSA/IHZpZXdlclBsYXllci50b3RhbFBvaW50cyA6IHZpZXdlclBsYXllci50b3RhbFBvaW50czsKICAgIGNvbnN0IHRvdGFsUXVlc3Rpb25zQXNrZWRTb0ZhciA9IGxpbWl0SW5kZXggKyAxOwogICAgCiAgICBjb25zdCBzY29yZXNIdG1sID0gc29ydGVkUGxheWVycy5tYXAoKHAsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgcmVhbFNjb3JlU29GYXIgPSBwLnJlYWxTY29yZTsKICAgICAgICBjb25zdCBwb2ludHNWYWx1ZSA9IHAudG90YWxQb2ludHM7CiAgICAgICAgCiAgICAgICAgY29uc3QgY3VycmVudFR1cm5BbnN3ZXIgPSAocC5hbnN3ZXJzIHx8IFtdKS5maW5kKGFucyA9PiBhbnMucXVlc3Rpb25JbmRleCA9PT0gbGltaXRJbmRleCk7IAoKICAgICAgICBsZXQgcG90Qm9udXNIVE1MID0gJyc7CiAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyICYmIGN1cnJlbnRUdXJuQW5zd2VyLnBvdEJvbnVzID4gMCkgewogICAgICAgICAgICBwb3RCb251c0hUTUwgPSBgPHNwYW4gY2xhc3M9InRleHQteHMgYmcteWVsbG93LTEwMCB0ZXh0LXllbGxvdy04MDAgcHgtMiBweS0wLjUgcm91bmRlZC1mdWxsIGZvbnQtYm9sZCBtbC0xIHNoYWRvdy1zbSBib3JkZXIgYm9yZGVyLXllbGxvdy0zMDAiIHRpdGxlPSLguKrguYjguKfguJnguYHguJrguYjguIfguIjguLLguIHguITguJnguJXguK3guJrguJzguLTguJQiPiske2N1cnJlbnRUdXJuQW5zd2VyLnBvdEJvbnVzfSBQb3Q8L3NwYW4+YDsKICAgICAgICB9CgogICAgICAgIGxldCB0dXJuU3RhdHVzSWNvbnNIVE1MID0gJyc7CiAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlci53YXNGb3JjZWQpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYLguJTguJnguJrguLHguIfguITguLHguJoiPvCfkbs8L3NwYW4+JzsKICAgICAgICAgICAgaWYgKGN1cnJlbnRUdXJuQW5zd2VyLndhc0ppbnhlZCkgdHVyblN0YXR1c0ljb25zSFRNTCArPSAnPHNwYW4gdGl0bGU9IuC5guC4lOC4meC4hOC4s+C4quC4suC4myI+8J+YiDwvc3Bhbj4nOwogICAgICAgICAgICBpZiAoY3VycmVudFR1cm5BbnN3ZXIudXNlZEJ1eVRpbWUpIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gJzxzcGFuIHRpdGxlPSLguYPguIrguYnguYDguKfguKXguLIiPuKPszwvc3Bhbj4nOwogICAgICAgICAgICBjb25zdCBwb3dlcnVwVXNlZCA9IGN1cnJlbnRUdXJuQW5zd2VyLnBvd2VydXBVc2VkOwogICAgICAgICAgICBpZiAocG93ZXJ1cFVzZWQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGljb25zID0geyAncG9sbCc6ICfwn5OKJywgJ2N1dE9uZSc6ICfinILvuI8nLCAnaW5zdXJhbmNlJzogJ/Cfm6HvuI8nLCAnZmlmdHlGaWZ0eSc6ICfwn4yXJywgJ3dhZ2VyTXVsdGlwbGllcic6ICfwn5KwJywgJ3NlY29uZENoYW5jZSc6ICfwn5SBJywgJ2J1eVRpbWUnOiAn4o+zJywgJ3JldmVhbE9wdGlvbnMnOiAn8J+Rge+4jycgfTsKICAgICAgICAgICAgICAgIGlmIChpY29uc1twb3dlcnVwVXNlZF0pIHR1cm5TdGF0dXNJY29uc0hUTUwgKz0gYDxzcGFuIHRpdGxlPSLguYPguIrguYkgJHtwb3dlcnVwVXNlZH0iPiR7aWNvbnNbcG93ZXJ1cFVzZWRdfTwvc3Bhbj5gOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxldCBzdGF0dXNJY29uSFRNTCA9ICcnOyAKICAgICAgICBpZiAodG90YWxRdWVzdGlvbnNBc2tlZFNvRmFyID4gMCkgewogICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICBpZiAocG9pbnRzVmFsdWUgPT09IG1heFBvaW50cyAmJiBtYXhQb2ludHMgPiAwKSBzdGF0dXNJY29uSFRNTCArPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTMwMCBtbC0xIHRleHQtMnhsIGRyb3Atc2hhZG93LW1kIj7wn5GRPC9zcGFuPic7CiAgICAgICAgICAgICAgICBpZiAocmVhbFNjb3JlU29GYXIgPT09IG1heFJhd1Njb3JlICYmIG1heFJhd1Njb3JlID4gMCkgc3RhdHVzSWNvbkhUTUwgKz0gJzxzcGFuIGNsYXNzPSJ0ZXh0LWJsdWUtMzAwIG1sLTEgdGV4dC0yeGwgZHJvcC1zaGFkb3ctbWQiPvCfjpM8L3NwYW4+JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IGlzUGVyZmVjdFJlYWxTY29yZSA9IChwLnJlYWxTY29yZSA9PT0gdG90YWxRdWVzdGlvbnNBc2tlZFNvRmFyICYmIHRvdGFsUXVlc3Rpb25zQXNrZWRTb0ZhciA+IDApOwogICAgICAgICAgICAgICAgaWYgKGlzUGVyZmVjdFJlYWxTY29yZSkgc3RhdHVzSWNvbkhUTUwgPSAnPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTMwMCBtbC0xIj7irZA8L3NwYW4+JzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3RhdHVzSWNvbkhUTUwgPT09ICcnICYmIHBvaW50c1ZhbHVlIDwgMCkgc3RhdHVzSWNvbkhUTUwgPSAnPHNwYW4gY2xhc3M9InRleHQtcmVkLTQwMCBtbC0xIj7imqDvuI88L3NwYW4+JzsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGV0IGZpcmVJY29uSFRNTCA9ICcnOwogICAgICAgIGNvbnN0IHR1cm5Vc2VkQnV5VGltZSA9IGN1cnJlbnRUdXJuQW5zd2VyICYmIGN1cnJlbnRUdXJuQW5zd2VyLnVzZWRCdXlUaW1lOwogICAgICAgIGNvbnN0IHR1cm5Vc2VkSXRlbSA9IGN1cnJlbnRUdXJuQW5zd2VyICYmIGN1cnJlbnRUdXJuQW5zd2VyLnBvd2VydXBVc2VkICYmIGN1cnJlbnRUdXJuQW5zd2VyLnBvd2VydXBVc2VkICE9PSAnd2FnZXJNdWx0aXBsaWVyJzsKCiAgICAgICAgLy8g4LmD4LiK4LmJIGNvcnJlY3RTdHJlYWsg4LiX4Li14LmI4LiE4Liz4LiZ4Lin4LiT4LmD4Lir4Lih4LmI4LmB4Lil4LmJ4LinCiAgICAgICAgaWYgKCF0dXJuVXNlZEJ1eVRpbWUgJiYgIXR1cm5Vc2VkSXRlbSkgewogICAgICAgICAgICBjb25zdCBwU3RyZWFrID0gcC5jb3JyZWN0U3RyZWFrIHx8IDA7CiAgICAgICAgICAgIGlmIChwU3RyZWFrID49IDMpIHsKICAgICAgICAgICAgICAgIGZpcmVJY29uSFRNTCA9IGA8c3BhbiBjbGFzcz0ibWwtMSB0ZXh0LW9yYW5nZS01MDAgYW5pbWF0ZS1wdWxzZSBmb250LWJvbGQgdGV4dC1zbSI+8J+UpSB4JHtwU3RyZWFrfTwvc3Bhbj5gOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsZXQgaGlnaGxpZ2h0Q2xhc3MgPSAnYmctYmxhY2svMjAnOyAKICAgICAgICBsZXQgaXNXYWdlcldpbiA9IGZhbHNlOwogICAgICAgIGlmIChjdXJyZW50VHVybkFuc3dlcikgeyAKICAgICAgICAgICAgY29uc3QgaXNDb3JyZWN0ID0gY3VycmVudFR1cm5BbnN3ZXIuaXNDb3JyZWN0OwogICAgICAgICAgICBjb25zdCBpc0NvbmZpZGVudCA9IChjdXJyZW50VHVybkFuc3dlci53YXNDb25maWRlbnQgPT09IHRydWUgfHwgY3VycmVudFR1cm5BbnN3ZXIud2FzQ29uZmlkZW50ID09PSAnY29uZmlkZW50Jyk7CiAgICAgICAgICAgIGNvbnN0IHBvd2VydXBVc2VkID0gY3VycmVudFR1cm5BbnN3ZXIucG93ZXJ1cFVzZWQ7IAogICAgICAgICAgICBpZiAocG93ZXJ1cFVzZWQgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICAgICBpZiAoaXNDb3JyZWN0KSB7IGhpZ2hsaWdodENsYXNzID0gJ2JnLXllbGxvdy0zMDAgdGV4dC15ZWxsb3ctOTAwIGZvbnQtYm9sZCc7IGlzV2FnZXJXaW4gPSB0cnVlOyB9IAogICAgICAgICAgICAgICAgZWxzZSB7IGhpZ2hsaWdodENsYXNzID0gJ2JnLXJlZC03MDAgdGV4dC13aGl0ZSBmb250LWJvbGQnOyB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb25maWRlbnQpIHsKICAgICAgICAgICAgICAgIGhpZ2hsaWdodENsYXNzID0gaXNDb3JyZWN0ID8gJ2JnLVsjNEFERTgwXSB0ZXh0LWdyZWVuLTkwMCBmb250LWJvbGQnIDogJ2JnLVsjRUY0NDQ0XSB0ZXh0LXdoaXRlIGZvbnQtYm9sZCc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDb3JyZWN0KSB7CiAgICAgICAgICAgICAgICBoaWdobGlnaHRDbGFzcyA9ICdiZy1bI0RDRkNFN10gdGV4dC1ncmVlbi05MDAnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxldCBkaXNwbGF5TmFtZSA9ICcnOwogICAgICAgIGNvbnN0IHJlYWxOYW1lID0gcC5uYW1lOwogICAgICAgIGNvbnN0IG5pY2tuYW1lID0gZ2FtZURhdGEucGxheWVyTmlja25hbWVzW3AubmFtZV0gfHwgJz8/Pyc7CiAgICAgICAgY29uc3QgaXNTZWxmID0gbG9jYWxUZWFtUGxheWVycy5pbmNsdWRlcyhyZWFsTmFtZSk7IAogICAgICAgIGNvbnN0IG5pY2tuYW1lQ29sb3JDbGFzcyA9IGlzV2FnZXJXaW4gPyAndGV4dC15ZWxsb3ctODAwJyA6ICd0ZXh0LWdyYXktMzAwJzsKICAgICAgICAKICAgICAgICBjb25zdCB0YXJnZXRQcmltYXJ5U2NvcmUgPSBpc01hcmtldE1vZGUgPyBwLnRvdGFsUG9pbnRzIDogcC50b3RhbFBvaW50czsKICAgICAgICBjb25zdCBjYW5TZWVSZWFsTmFtZSA9IGlzUmV2ZWFsZWQgfHwgaXNTZWxmIHx8ICh2aWV3ZXJQcmltYXJ5U2NvcmUgPiB0YXJnZXRQcmltYXJ5U2NvcmUpOwoKICAgICAgICBpZiAoY2FuU2VlUmVhbE5hbWUpIHsKICAgICAgICAgICAgIGRpc3BsYXlOYW1lID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCI+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCI+JHtyZWFsTmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gJHtuaWNrbmFtZUNvbG9yQ2xhc3N9Ij4oJHtuaWNrbmFtZX0pPC9zcGFuPgogICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICB9IGVsc2UgeyAKICAgICAgICAgICAgIGRpc3BsYXlOYW1lID0gYDxzcGFuIGNsYXNzPSJmb250LWJvbGQiPiR7bmlja25hbWV9PC9zcGFuPmA7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmIChpc1NlbGYpIHsKICAgICAgICAgICAgZGlzcGxheU5hbWUgPSBgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxkaXY+JHtkaXNwbGF5TmFtZX08L2Rpdj48c3BhbiBjbGFzcz0idGV4dC14cyBiZy13aGl0ZS8yMCBweC0yIHB5LTAuNSByb3VuZGVkLWZ1bGwgd2hpdGVzcGFjZS1ub3dyYXAiPuC4hOC4uOC4kzwvc3Bhbj48L2Rpdj5gOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjb25zdCBhbGxJY29ucyA9IGA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtd3JhcCBnYXAtMSI+JHt0dXJuU3RhdHVzSWNvbnNIVE1MfSAke3N0YXR1c0ljb25IVE1MfSAke2ZpcmVJY29uSFRNTH08L2Rpdj5gOwogICAgICAgIGNvbnN0IHBvaW50c0Rpc3BsYXkgPSBwb2ludHNWYWx1ZSA+PSAwID8gYCgrJHsocG9pbnRzVmFsdWUpLnRvTG9jYWxlU3RyaW5nKCl9KWAgOiBgKCR7KHBvaW50c1ZhbHVlKS50b0xvY2FsZVN0cmluZygpfSlgOwoKICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1zdGFydCBwLTMgcm91bmRlZC1sZyB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0zMDAgJHtoaWdobGlnaHRDbGFzc30gZ2FwLTIiPgogICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgc206ZmxleC1yb3cgc206aXRlbXMtY2VudGVyIHctZnVsbCBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCBzbTppdGVtcy1jZW50ZXIgZ2FwLTMgZmxleC1ncm93IG1pbi13LTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1zaHJpbmstMCB3LTggaC04IGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtZnVsbCBiZy1ibGFjay8xMCBmb250LWJvbGQgdGV4dC1sZyBtdC0xIHNtOm10LTAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwLmRpc3BsYXlSYW5rfQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBzbTppdGVtcy1jZW50ZXIgZ2FwLTEgc206Z2FwLTMgbWluLXctMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2Rpc3BsYXlOYW1lfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHthbGxJY29uc30KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBzbTpqdXN0aWZ5LWVuZCB3LWZ1bGwgc206dy1hdXRvIHBsLTExIHNtOnBsLTAgbXQtMSBzbTptdC0wIj4KICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktNzAgc206aGlkZGVuIj7guITguLDguYHguJnguJnguKPguKfguKE6PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1yaWdodCB3aGl0ZXNwYWNlLW5vd3JhcCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQteGwiPiR7cmVhbFNjb3JlU29GYXJ9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtc20gb3BhY2l0eS04MCBtbC0xIGZvbnQtbWVkaXVtIj4ke3BvaW50c0Rpc3BsYXl9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwb3RCb251c0hUTUx9IDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+YDsKICAgIH0pLmpvaW4oJycpOwoKICAgIGxldCBmb290ZXJNZXNzYWdlSFRNTCA9ICcnOwogICAgY29uc3QgaXNMYXN0UXVlc3Rpb24gPSAoaXNSZXZlYWxBdEVuZE1vZGUpID8gKGxpbWl0SW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpIDogKGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKTsKICAgIAogICAgaWYgKGdhbWVEYXRhLnN0YXR1cyA9PT0gJ3BvZGl1bScpIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9ICcnOyAKICAgIH0gZWxzZSBpZiAoaXNMYXN0UXVlc3Rpb24pIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9IGA8cCBjbGFzcz0ibXQtOCB0ZXh0LXhsIGZvbnQtYm9sZCB0ZXh0LXllbGxvdy0zMDAgYW5pbWF0ZS1wdWxzZSI+4LmA4LiV4Lij4Li14Lii4Lih4Lie4Lia4LiB4Lix4Lia4Lic4Lil4Liq4Lij4Li44Lib4Liq4Li44LiU4LiX4LmJ4Liy4LiiITwvcD5gOwogICAgfSBlbHNlIHsKICAgICAgICBmb290ZXJNZXNzYWdlSFRNTCA9IGA8cCBjbGFzcz0ibXQtOCB0ZXh0LWxnIHRleHQtaW5kaWdvLTIwMCI+4Lij4Lit4Lic4Li54LmJ4LiE4Lin4Lia4LiE4Li44Lih4LmE4Lib4LiC4LmJ4Lit4LiV4LmI4Lit4LmE4LibLi4uPC9wPmA7CiAgICB9CgogICAgY29uc3QgcG90SFRNTCA9IGdldENlbnRyYWxQb3RIVE1MKGdhbWVEYXRhKTsKCiAgICBjb25zdCBkYXNoYm9hcmRIdG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtNiBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWItNCBzY2FsZS0xMTAiPiR7cG90SFRNTH08L2Rpdj4KCiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIG1iLTYgdGV4dC1jZW50ZXIiPuC4quC4o+C4uOC4m+C4reC4seC4meC4lOC4seC4miAo4Lij4Liy4Lii4Lia4Li44LiE4LiE4LilKTwvaDI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBzcGFjZS15LTIiPiR7c2NvcmVzSHRtbH08L2Rpdj4KICAgICAgICAgICAgJHtmb290ZXJNZXNzYWdlSFRNTH0KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gZGFzaGJvYXJkSHRtbDsKfQoKZnVuY3Rpb24gcmVuZGVyU3R1ZGVudENvbXBldGl0aW9uUmVzdWx0c1ZpZXcoZ2FtZURhdGEsIHF1ZXN0aW9uSW5kZXhUb1Nob3cpIHsKICAgIGNvbnN0IHBsYXllcnMgPSBPYmplY3QudmFsdWVzKGdhbWVEYXRhLnBsYXllcnMgfHwge30pOwogICAgY29uc3QgY3VycmVudFF1ZXN0aW9uSW5kZXggPSBxdWVzdGlvbkluZGV4VG9TaG93OyAKICAgIGNvbnN0IHZhcmlhbnQgPSBnYW1lRGF0YS5nYW1lVmFyaWFudCB8fCAnY2xhc3NpYyc7CiAgICBjb25zdCBxdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zOwoKICAgIGNvbnN0IHBsYXllcnNXaXRoU2NvcmVzID0gcGxheWVycy5tYXAocCA9PiB7CiAgICAgICAgY29uc3QgcmVhbFNjb3JlID0gcC5zY29yZSB8fCAwOyAKICAgICAgICBjb25zdCBwb2ludHMgPSBwLnRvdGFsUG9pbnRzIHx8IDA7IAogICAgICAgIGNvbnN0IGFuc3dlcnNUb0NvbnNpZGVyID0gKHAuYW5zd2VycyB8fCBbXSkuZmlsdGVyKGFucyA9PiAodmFyaWFudCA9PT0gJ3JldmVhbF9hdF9lbmQnKSA/IGFucy5xdWVzdGlvbkluZGV4IDw9IGN1cnJlbnRRdWVzdGlvbkluZGV4IDogdHJ1ZSk7CiAgICAgICAgcmV0dXJuIHsgLi4ucCwgcmVhbFNjb3JlOiByZWFsU2NvcmUsIHRvdGFsUG9pbnRzOiBwb2ludHMsIGFuc3dlcnM6IGFuc3dlcnNUb0NvbnNpZGVyIH07CiAgICB9KTsKCiAgICBjb25zdCBpc01hcmtldE1vZGUgPSBnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZTsKCiAgICBjb25zdCBzb3J0ZWRQbGF5ZXJzID0gWy4uLnBsYXllcnNXaXRoU2NvcmVzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgaWYgKGlzTWFya2V0TW9kZSkgewogICAgICAgICAgICBjb25zdCBzY29yZURpZmYgPSBiLnJlYWxTY29yZSAtIGEucmVhbFNjb3JlOwogICAgICAgICAgICBpZiAoc2NvcmVEaWZmICE9PSAwKSByZXR1cm4gc2NvcmVEaWZmOwogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwb2ludHNEaWZmID0gYi50b3RhbFBvaW50cyAtIGEudG90YWxQb2ludHM7CiAgICAgICAgICAgIGlmIChwb2ludHNEaWZmICE9PSAwKSByZXR1cm4gcG9pbnRzRGlmZjsKICAgICAgICAgICAgY29uc3Qgc2NvcmVEaWZmID0gYi5yZWFsU2NvcmUgLSBhLnJlYWxTY29yZTsKICAgICAgICAgICAgaWYgKHNjb3JlRGlmZiAhPT0gMCkgcmV0dXJuIHNjb3JlRGlmZjsKICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgfHwgJycpLmxvY2FsZUNvbXBhcmUoYi5uYW1lIHx8ICcnLCAndGgnKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyDilrzilrzilrwgW1NUQVJUXSDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJrguYHguJrguJogMSwgMSwgMyDilrzilrzilrwKICAgIGxldCBjdXJyZW50UmFuayA9IDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZFBsYXllcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoaSA+IDApIHsKICAgICAgICAgICAgY29uc3QgcHJldiA9IHNvcnRlZFBsYXllcnNbaSAtIDFdOwogICAgICAgICAgICBjb25zdCBjdXJyID0gc29ydGVkUGxheWVyc1tpXTsKICAgICAgICAgICAgLy8g4LmD4LiK4LmJ4LiV4Lij4Lij4LiB4Liw4LmA4LiU4Li14Lii4Lin4LiB4Lix4Lia4LiV4Lit4LiZIFNvcnQKICAgICAgICAgICAgbGV0IGlzVGllZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAoaXNNYXJrZXRNb2RlKSB7CiAgICAgICAgICAgICAgICBpc1RpZWQgPSAoY3Vyci5yZWFsU2NvcmUgPT09IHByZXYucmVhbFNjb3JlKSAmJiAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpc1RpZWQgPSAoY3Vyci50b3RhbFBvaW50cyA9PT0gcHJldi50b3RhbFBvaW50cykgJiYgKGN1cnIucmVhbFNjb3JlID09PSBwcmV2LnJlYWxTY29yZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghaXNUaWVkKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50UmFuayA9IGkgKyAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNvcnRlZFBsYXllcnNbaV0uZGlzcGxheVJhbmsgPSBjdXJyZW50UmFuazsKICAgIH0KICAgIC8vIOKWsuKWsuKWsiBbRU5EXSDguITguLPguJnguKfguJPguK3guLHguJnguJTguLHguJrguYDguKrguKPguYfguIjguKrguLTguYnguJkg4pay4pay4payCiAgICAKICAgIC8vIOC4quC4o+C5ieC4suC4hyBIVE1MCiAgICBjb25zdCBzY29yZXNIdG1sID0gc29ydGVkUGxheWVycy5tYXAoKHAsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgcGVyZmVjdFNjb3JlU3ltYm9sID0gJyc7IAogICAgICAgIGxldCBoaWdobGlnaHRDbGFzcyA9ICdiZy1ibGFjay8yMCc7IAogICAgICAgIGNvbnN0IHJlYWxOYW1lID0gcC5uYW1lOwogICAgICAgIGNvbnN0IGRpdlN0eWxlID0gImxpbmUtaGVpZ2h0OiAxLjM7IG1pbi13aWR0aDogMDsiOyAKICAgICAgICBjb25zdCBzcGFuU3R5bGUgPSAid29yZC1icmVhazogYnJlYWstYWxsOyI7IAogICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gYDxkaXYgc3R5bGU9IiR7ZGl2U3R5bGV9IiB0aXRsZT0iJHtyZWFsTmFtZX0iPjxzcGFuIHN0eWxlPSIke3NwYW5TdHlsZX0iPiR7cmVhbE5hbWV9PC9zcGFuPiR7cGVyZmVjdFNjb3JlU3ltYm9sfTwvZGl2PmA7CiAgICAgICAgY29uc3Qgc2NvcmVIVE1MID0gJyc7IAoKICAgICAgICAvLyDilrzilrzilrwgW+C5geC4geC5ieC5hOC4giBIVE1MXSDguYPguIrguYkgZGlzcGxheVJhbmsg4LmB4LiX4LiZIGluZGV4KzEg4pa84pa84pa8CiAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtc3RhcnQgcC0zIHJvdW5kZWQtbGcgdHJhbnNpdGlvbi1hbGwgZHVyYXRpb24tMzAwICR7aGlnaGxpZ2h0Q2xhc3N9IGdhcC0yIj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtbGVmdCIgc3R5bGU9ImZsZXgtc2hyaW5rOiAwOyBtaW4td2lkdGg6IDIuNXJlbTsiPiR7cC5kaXNwbGF5UmFua30uPC9zcGFuPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleC1ncm93Ij4ke2Rpc3BsYXlOYW1lfTwvZGl2PgogICAgICAgICAgICAgICAgJHtzY29yZUhUTUx9CiAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgLy8g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIJdIOKWsuKWsuKWsgogICAgfSkuam9pbignJyk7CgogICAgbGV0IGZvb3Rlck1lc3NhZ2VIVE1MID0gJyc7CiAgICBjb25zdCBpc0xhc3RRdWVzdGlvbiA9ICh2YXJpYW50ID09PSAncmV2ZWFsX2F0X2VuZCcpID8gKGdhbWVEYXRhLnJldmlld1F1ZXN0aW9uSW5kZXggPj0gcXVlc3Rpb25zLmxlbmd0aCAtIDEpIDogKGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4ID49IHF1ZXN0aW9ucy5sZW5ndGggLSAxKTsKICAgIGlmIChpc0xhc3RRdWVzdGlvbikgewogICAgICAgIGZvb3Rlck1lc3NhZ2VIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQteGwgZm9udC1ib2xkIHRleHQteWVsbG93LTMwMCBhbmltYXRlLXB1bHNlIj7guYDguJXguKPguLXguKLguKHguJ7guJrguIHguLHguJrguJzguKXguKrguKPguLjguJvguKrguLjguJTguJfguYnguLLguKIhPC9wPmA7CiAgICB9IGVsc2UgewogICAgICAgIGZvb3Rlck1lc3NhZ2VIVE1MID0gYDxwIGNsYXNzPSJtdC04IHRleHQtbGcgdGV4dC1pbmRpZ28tMjAwIj7guKPguK3guJzguLnguYnguITguKfguJrguITguLjguKHguYTguJvguILguYnguK3guJXguYjguK3guYTguJsuLi48L3A+YDsKICAgIH0KCiAgICBjb25zdCBkYXNoYm9hcmRIdG1sID0gYAogICAgICAgIDxkaXYgY2xhc3M9ImJnLWluZGlnby03MDAgdGV4dC13aGl0ZSByb3VuZGVkLWxnIHAtNiBmbGV4IGZsZXgtY29sIGgtZnVsbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICA8aDIgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCBtYi02Ij7guKrguKPguLjguJvguK3guLHguJnguJTguLHguJogKOC4o+C4suC4ouC4muC4uOC4hOC4hOC4pSk8L2gyPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0idy1mdWxsIG1heC13LWxnIHNwYWNlLXktMiI+CiAgICAgICAgICAgICAgICAke3Njb3Jlc0h0bWx9CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgJHtmb290ZXJNZXNzYWdlSFRNTH0KICAgICAgICA8L2Rpdj4KICAgIGA7CiAgICBsaXZlR2FtZVZpZXcuaW5uZXJIVE1MID0gZGFzaGJvYXJkSHRtbDsKfQoKZnVuY3Rpb24gcmVuZGVyU3R1ZGVudFN5bmNRdWVzdGlvblZpZXcoZ2FtZURhdGEpIHsKCmNvbnN0IGlzRXhhbU1vZGUgPSAoZ2FtZURhdGEuZ2FtZVZhcmlhbnQgPT09ICdleGFtX3N0cmljdCcpOwoKICAgIC8vIDEuIOC4q+C4suC4nOC4ueC5ieC5gOC4peC5iOC4meC4m+C4seC4iOC4iOC4uOC4muC4seC4meC5g+C4meC5gOC4hOC4o+C4t+C5iOC4reC4h+C4meC4teC5iQogICAgd2hpbGUobG9jYWxQbGF5ZXJUdXJuSW5kZXggPCBsb2NhbFRlYW1QbGF5ZXJzLmxlbmd0aCAmJiBnYW1lRGF0YS5wbGF5ZXJzW2xvY2FsVGVhbVBsYXllcnNbbG9jYWxQbGF5ZXJUdXJuSW5kZXhdXT8uYW5zd2VyZWQgPT09IHRydWUpIHsKICAgICAgICBsb2NhbFBsYXllclR1cm5JbmRleCsrOwogICAgfQogICAgCiAgICBpZiAobG9jYWxQbGF5ZXJUdXJuSW5kZXggPj0gbG9jYWxUZWFtUGxheWVycy5sZW5ndGgpIHsKICAgICAgICBsb2NhbFBsYXllclR1cm5JbmRleCA9IGxvY2FsVGVhbVBsYXllcnMuZmluZEluZGV4KG5hbWUgPT4gZ2FtZURhdGEucGxheWVyc1tuYW1lXT8uYW5zd2VyZWQgIT09IHRydWUpOwogICAgfQoKICAgIGNvbnN0IGN1cnJlbnRQbGF5ZXJPbkRldmljZSA9IGxvY2FsVGVhbVBsYXllcnNbbG9jYWxQbGF5ZXJUdXJuSW5kZXhdOwogICAgaWYgKCFjdXJyZW50UGxheWVyT25EZXZpY2UpIHJldHVybjsgCgogICAgY29uc3QgcGxheWVyRGF0YSA9IGdhbWVEYXRhLnBsYXllcnNbY3VycmVudFBsYXllck9uRGV2aWNlXTsKICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgY29uc3QgdG90YWxRdWVzdGlvbnMgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zLmxlbmd0aDsKICAgIGNvbnN0IHEgPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zW3FJbmRleF07CiAgICBjb25zdCBxdWVzdGlvblR5cGUgPSBxLnF1ZXN0aW9uVHlwZSB8fCBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVpelR5cGU7CiAgICAKICAgIGxldCBvcHRpb25zSFRNTCA9ICcnOwogICAgbGV0IGhhc1N1Ym1pdEJ1dHRvbiA9IGZhbHNlOwoKICAgIC8vIDIuIOC4leC4o+C4p+C4iOC4quC4reC4muC4quC4luC4suC4meC4sOC5hOC4reC5gOC4l+C4oeC5geC4peC4sCBGbGFnCiAgICBjb25zdCBwb3dlcnVwRmxhZ05hbWUgPSBgcG93ZXJ1cFVzZWRfcSR7cUluZGV4fV9wJHtjdXJyZW50UGxheWVyT25EZXZpY2V9YDsKICAgIGNvbnN0IGFjdGl2ZVBvd2VydXAgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHBvd2VydXBGbGFnTmFtZSk7CiAgICBjb25zdCBpc1JldmVhbGVkID0gKGFjdGl2ZVBvd2VydXAgPT09ICdyZXZlYWxPcHRpb25zJyk7IAoKICAgIGNvbnN0IGhpZGRlbkZsYWdOYW1lID0gYGhpZGRlbk9wdGlvbnNfcSR7cUluZGV4fV9wJHtjdXJyZW50UGxheWVyT25EZXZpY2V9YDsKICAgIGNvbnN0IGhpZGRlbkluZGljZXMgPSAoSlNPTi5wYXJzZShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGhpZGRlbkZsYWdOYW1lKSB8fCAnW10nKSkubWFwKFN0cmluZyk7CgogICAgLy8gLS0tIFvguKrguYjguKfguJnguIHguLLguKPguYHguKrguJTguIfguJzguKXguJXguLHguKfguYDguKXguLfguK3guIFdIC0tLQogICAgaWYgKChxdWVzdGlvblR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHF1ZXN0aW9uVHlwZSA9PT0gJ2ZpbGxfaW5fbm9fY2hvaWNlcycpICYmIGlzUmV2ZWFsZWQgJiYgcS5vcHRpb25zICYmIHEub3B0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgb3B0aW9uc0hUTUwgPSBxLm9wdGlvbnMubWFwKChvcHQsIGkpID0+IHsKICAgICAgICAgICAgaWYgKGhpZGRlbkluZGljZXMuaW5jbHVkZXMoU3RyaW5nKGkpKSkgcmV0dXJuICcnOwogICAgICAgICAgICByZXR1cm4gYDxidXR0b24gZGF0YS12YWx1ZT0iJHtvcHR9IiBkYXRhLWluZGV4PSIke2l9IiBjbGFzcz0ibGl2ZS1hbnN3ZXItYnRuIHAtNCByb3VuZGVkLWxnIHRleHQteGwgdGV4dC1jZW50ZXIgYmctd2hpdGUgdGV4dC1ncmF5LTgwMCBob3ZlcjpiZy1pbmRpZ28tMTAwIGJvcmRlci0yIGJvcmRlci1wdXJwbGUtMzAwIHNoYWRvdy1tZCB0cmFuc2Zvcm0gdHJhbnNpdGlvbi10cmFuc2Zvcm0gaG92ZXI6c2NhbGUtMTA1Ij4ke29wdH08L2J1dHRvbj5gOwogICAgICAgIH0pLmpvaW4oJycpOwogICAgfSAKICAgIGVsc2UgaWYgKHF1ZXN0aW9uVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcXVlc3Rpb25UeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgewogICAgICAgIGhhc1N1Ym1pdEJ1dHRvbiA9IHRydWU7CiAgICAgICAgY29uc3QgaXNOdW1lcmljQW5zd2VyID0gcS5pZGVhbEFuc3dlciAmJiAvXi0/W1xkLixdKyQvLnRlc3QoU3RyaW5nKHEuaWRlYWxBbnN3ZXIpLnRyaW0oKSk7CiAgICAgICAgbGV0IGlucHV0RmllbGRIVE1MID0gaXNOdW1lcmljQW5zd2VyIAogICAgICAgICAgICA/IGA8aW5wdXQgdHlwZT0idGV4dCIgaWQ9InN5bmMtc2hvcnQtYW5zd2VyLWlucHV0IiBpbnB1dG1vZGU9ImRlY2ltYWwiIGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgcC00IGJvcmRlci0yIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIHRleHQtZ3JheS04MDAgdGV4dC0zeGwgdGV4dC1jZW50ZXIgZm9udC1ib2xkIGZvY3VzOmJvcmRlci1pbmRpZ28tNTAwIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWluZGlnby0yMDAgb3V0bGluZS1ub25lIiBwbGFjZWhvbGRlcj0iMCIgYXV0b2NvbXBsZXRlPSJvZmYiPmAKICAgICAgICAgICAgOiBgPHRleHRhcmVhIGlkPSJzeW5jLXNob3J0LWFuc3dlci1pbnB1dCIgY2xhc3M9InctZnVsbCBtYXgtdy1sZyBwLTMgYm9yZGVyIHJvdW5kZWQtbGcgdGV4dC1ncmF5LTgwMCB0ZXh0LWxnIiByb3dzPSIzIiBwbGFjZWhvbGRlcj0i4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiC4Lit4LiH4LiE4Li44LiTLi4uIj48L3RleHRhcmVhPmA7CgogICAgICAgIG9wdGlvbnNIVE1MID0gYDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC00Ij4ke2lucHV0RmllbGRIVE1MfTxidXR0b24gaWQ9InN5bmMtc3VibWl0LWJ0biIgY2xhc3M9ImJnLWdyZWVuLTUwMCBob3ZlcjpiZy1ncmVlbi02MDAgdGV4dC13aGl0ZSBmb250LWJvbGQgcHktMyBweC04IHJvdW5kZWQtbGcgdGV4dC14bCI+PGkgY2xhc3M9ImZhcyBmYS1wYXBlci1wbGFuZSBtci0yIj48L2k+4Liq4LmI4LiH4LiE4Liz4LiV4Lit4LiaPC9idXR0b24+PC9kaXY+YDsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHN3aXRjaChxdWVzdGlvblR5cGUpIHsKICAgICAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgICAgICBjb25zdCBidG5ZZXMgPSBoaWRkZW5JbmRpY2VzLmluY2x1ZGVzKCcwJykgPyAnJyA6IGA8YnV0dG9uIGRhdGEtdmFsdWU9IjAiIGRhdGEtaW5kZXg9IjAiIGNsYXNzPSJsaXZlLWFuc3dlci1idG4gcC00IHJvdW5kZWQtbGcgdGV4dC14bCB0ZXh0LWNlbnRlciBiZy13aGl0ZSB0ZXh0LWdyYXktODAwIGhvdmVyOmJnLWluZGlnby0xMDAiPuC5g+C4iuC5iCAvIOC4luC4ueC4gTwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICBjb25zdCBidG5ObyA9IGhpZGRlbkluZGljZXMuaW5jbHVkZXMoJzEnKSA/ICcnIDogYDxidXR0b24gZGF0YS12YWx1ZT0iMSIgZGF0YS1pbmRleD0iMSIgY2xhc3M9ImxpdmUtYW5zd2VyLWJ0biBwLTQgcm91bmRlZC1sZyB0ZXh0LXhsIHRleHQtY2VudGVyIGJnLXdoaXRlIHRleHQtZ3JheS04MDAgaG92ZXI6YmctaW5kaWdvLTEwMCI+4LmE4Lih4LmI4LmD4LiK4LmIIC8g4Lic4Li04LiUPC9idXR0b24+YDsKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gYnRuWWVzICsgYnRuTm87CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBb4Liq4LmI4Lin4LiZ4LiX4Li14LmI4LmB4LiB4LmJ4LmE4LiCOiDguYPguIrguYkgZGF0YS12YWx1ZSDguYDguJ7guLfguYjguK3guKPguLHguIHguKnguLIgQmFja3NsYXNoXSDilrzilrzilrwKICAgICAgICAgICAgY2FzZSAnbWF0Y2hpbmdfaXRlbSc6CiAgICAgICAgICAgICAgICBoYXNTdWJtaXRCdXR0b24gPSB0cnVlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkcm9wZG93bkl0ZW1zID0gKHEuYWxsUmVzcG9uc2VzIHx8IFtdKS5tYXAob3B0ID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyDguYHguJvguKXguIcgIiDguYDguJvguYfguJkgSFRNTCBlbnRpdHkg4LmA4Lie4Li34LmI4Lit4LmE4Lih4LmI4LmD4Lir4LmJIEF0dHJpYnV0ZSDguJ7guLHguIcKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYWZlVmFsdWUgPSBvcHQucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJwLTMgYm9yZGVyLWIgYm9yZGVyLWdyYXktMTAwIGhvdmVyOmJnLWluZGlnby01MCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uLWNvbG9ycyB0ZXh0LWxnIHRleHQtZ3JheS04MDAiCiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhLXZhbHVlPSIke3NhZmVWYWx1ZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJ3aW5kb3cuc2VsZWN0U3luY09wdGlvbih0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS12YWx1ZScpKSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7b3B0fQogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcnKTsKCiAgICAgICAgICAgICAgICBvcHRpb25zSFRNTCA9IGAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtZDpjb2wtc3Bhbi0yIGZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC00IHN5bmMtY3VzdG9tLWRyb3Bkb3duIHJlbGF0aXZlIj4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iaGlkZGVuIiBpZD0ic3luYy1tYXRjaGluZy1pbnB1dCIgdmFsdWU9IiI+CgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id2luZG93LnRvZ2dsZVN5bmNEcm9wZG93bigpIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPSJ3LWZ1bGwgbWF4LXctbGcgcC00IGJvcmRlci0yIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIGJnLXdoaXRlIHRleHQtbGVmdCBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgaG92ZXI6Ym9yZGVyLWluZGlnby01MDAgZm9jdXM6cmluZy0yIGZvY3VzOnJpbmctaW5kaWdvLTIwMCB0cmFuc2l0aW9uLWFsbCBzaGFkb3ctc20iPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0ic3luYy1kcm9wZG93bi1kaXNwbGF5IiBjbGFzcz0idGV4dC1ncmF5LTQwMCB0ZXh0LWxnIj4tLSDguYDguKXguLfguK3guIHguITguLPguJXguK3guJrguJfguLXguYjguITguLnguYjguIHguLHguJkgLS08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2hldnJvbi1kb3duIHRleHQtZ3JheS00MDAiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ic3luYy1kcm9wZG93bi1saXN0IiBjbGFzcz0iaGlkZGVuIGFic29sdXRlIHRvcC0yMCB3LWZ1bGwgbWF4LXctbGcgYmctd2hpdGUgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCByb3VuZGVkLWxnIHNoYWRvdy14bCBtYXgtaC02MCBvdmVyZmxvdy15LWF1dG8gei01MCI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7ZHJvcGRvd25JdGVtc30KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3luYy1zdWJtaXQtYnRuIiBjbGFzcz0iYmctZ3JlZW4tNTAwIGhvdmVyOmJnLWdyZWVuLTYwMCB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBweS0zIHB4LTggcm91bmRlZC1sZyB0ZXh0LXhsIG10LTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXBhcGVyLXBsYW5lIG1yLTIiPjwvaT7guKrguYjguIfguITguLPguJXguK3guJoKICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8g4pay4pay4payIFvguKrguLTguYnguJnguKrguLjguJTguKrguYjguKfguJnguJfguLXguYjguYHguIHguYnguYTguIJdIOKWsuKWsuKWsgoKICAgICAgICAgICAgY2FzZSAnbXVsdGlwbGVfY2hvaWNlJzoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIG9wdGlvbnNIVE1MID0gKHEub3B0aW9ucyB8fCBbXSkubWFwKChvcHQsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoaGlkZGVuSW5kaWNlcy5pbmNsdWRlcyhTdHJpbmcoaSkpKSByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGA8YnV0dG9uIGRhdGEtdmFsdWU9IiR7aX0iIGRhdGEtaW5kZXg9IiR7aX0iIGNsYXNzPSJsaXZlLWFuc3dlci1idG4gcC00IHJvdW5kZWQtbGcgdGV4dC14bCB0ZXh0LWNlbnRlciBiZy13aGl0ZSB0ZXh0LWdyYXktODAwIGhvdmVyOmJnLWluZGlnby0xMDAiPiR7b3B0fTwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICB9KS5qb2luKCcnKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KCiAgICAvLyAtLS0gW+C4quC5iOC4p+C4mSBUaW1lcl0gLS0tCiAgICBsZXQgdGltZXJIVE1MID0gJyc7CiAgICBpZiAoZ2FtZURhdGEudGltZXJNb2RlID09PSAncGVyX3F1ZXN0aW9uJykgewogICAgICAgIHRpbWVySFRNTCA9IGA8ZGl2IGNsYXNzPSJteS00Ij48ZGl2IGlkPSJzeW5jLXRpbWVyLWJhci1jb250YWluZXIiIGNsYXNzPSJ3LWZ1bGwgYmctZ3JheS0yMDAvNTAgcm91bmRlZC1mdWxsIGgtMi41Ij48ZGl2IGlkPSJzeW5jLXRpbWVyLWJhciIgY2xhc3M9ImJnLXllbGxvdy00MDAgaC0yLjUgcm91bmRlZC1mdWxsIiBzdHlsZT0id2lkdGg6IDEwMCU7IHRyYW5zaXRpb246IHdpZHRoIDAuNXMgbGluZWFyIDBzOyI+PC9kaXY+PC9kaXY+PHAgY2xhc3M9InRleHQtY2VudGVyIHRleHQtc20gdGV4dC15ZWxsb3ctMzAwIG10LTEiPuC5gOC4q+C4peC4t+C4reC5gOC4p+C4peC4siA8c3BhbiBpZD0ic3luYy10aW1lci1jb3VudGRvd24iIGNsYXNzPSJmb250LWJvbGQiPiR7Z2FtZURhdGEudGltZXJEdXJhdGlvbn08L3NwYW4+IOC4p+C4tOC4meC4suC4l+C4tTwvcD48L2Rpdj5gOwogICAgfQogICAgCiAgICAvLyAtLS0gW01hcmtldCAmIEludmVudG9yeSBMb2dpY10gLS0tCiAgICBsZXQgbWFya2V0QW5kSW52ZW50b3J5SFRNTCA9ICcnOwogICAgY29uc3QgdmFyaWFudCA9IGdhbWVEYXRhLmdhbWVWYXJpYW50IHx8ICdjbGFzc2ljJzsKICAgIGNvbnN0IGlzU2VjcmV0U2NvcmVNb2RlID0gWydyZXZlYWxfYXRfZW5kJywgJ2Fub255bW91c19yZXZlYWxfZW5kJywgJ2NvbXBldGl0aW9uJ10uaW5jbHVkZXModmFyaWFudCk7CgogICAgaWYgKGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlICYmICFpc0V4YW1Nb2RlKSB7CiAgICAgICAgaWYgKGlzU2VjcmV0U2NvcmVNb2RlKSB7CiAgICAgICAgICAgIGlmICghYWN0aXZlUG93ZXJ1cCkgewogICAgICAgICAgICAgICAgIG1hcmtldEFuZEludmVudG9yeUhUTUwgPSBgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciBteS00Ij48YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC13YWdlck11bHRpcGxpZXItaW5zdGFudCIgY2xhc3M9ImJnLWdyYWRpZW50LXRvLXIgZnJvbS1yZWQtNTAwIHRvLXBpbmstNjAwIHRleHQtd2hpdGUgc2hhZG93LWxnIGJvcmRlci00IGJvcmRlci13aGl0ZS8yMCBhY3RpdmU6c2NhbGUtOTUgYW5pbWF0ZS1wdWxzZSBweS0zIHB4LTYgcm91bmRlZC1mdWxsIGZvbnQtYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBnYXAtMSI+PGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtcm9ja2V0Ij48L2k+IDxzcGFuPuC5gOC4lOC4tOC4oeC4nuC4seC4meC4q+C4oeC4lOC4q+C4meC5ieC4suC4leC4seC4gSEgKOC4p+C4seC4lOC4lOC4p+C4hyk8L3NwYW4+PC9kaXY+PHNwYW4gY2xhc3M9InRleHQtWzEwcHhdIG9wYWNpdHktOTAgZm9udC1ub3JtYWwiPijguJzguLTguJQ94LmC4LiU4LiU4LiV4LiaIDEwIOC4hOC4o+C4seC5ieC4hyEpPC9zcGFuPjwvYnV0dG9uPjwvZGl2PmA7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCBwbGF5ZXJQb2ludHMgPSBwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIHx8IDA7CiAgICAgICAgICAgIGNvbnN0IHBsYXllclBvd2VydXBzID0gcGxheWVyRGF0YS5wb3dlcnVwcyB8fCB7fTsKICAgICAgICAgICAgIGNvbnN0IGludmVudG9yeUJ1dHRvbnMgPSBbCiAgICAgICAgICAgICAgICBwbGF5ZXJQb3dlcnVwcy5idXlUaW1lID4gMCA/IGA8YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC1idXlUaW1lIiBjbGFzcz0icG93ZXJ1cC1idG4gYmctZ3JlZW4tNTAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIj7ij7Mg4LiL4Li34LmJ4Lit4LmA4Lin4Lil4LiyICgke3BsYXllclBvd2VydXBzLmJ1eVRpbWV9KTwvYnV0dG9uPmAgOiAnJywKICAgICAgICAgICAgICAgIHBsYXllclBvd2VydXBzLnJldmVhbE9wdGlvbnMgPiAwID8gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLXJldmVhbE9wdGlvbnMiIGNsYXNzPSJwb3dlcnVwLWJ0biBiZy1wdXJwbGUtNTAwIHRleHQtd2hpdGUgcHktMSBweC0zIHJvdW5kZWQtZnVsbCB0ZXh0LXhzIGZvbnQtYm9sZCBib3JkZXItMiBib3JkZXIteWVsbG93LTMwMCBzaGFkb3ctc20iPvCfkYHvuI8g4LmA4Lic4Lii4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBICgke3BsYXllclBvd2VydXBzLnJldmVhbE9wdGlvbnN9KTwvYnV0dG9uPmAgOiAnJywgCiAgICAgICAgICAgICAgICBwbGF5ZXJQb3dlcnVwcy5jdXRPbmUgPiAwID8gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLWN1dE9uZSIgY2xhc3M9InBvd2VydXAtYnRuIGJnLWdyZWVuLTUwMCB0ZXh0LXdoaXRlIHB5LTEgcHgtMyByb3VuZGVkLWZ1bGwgdGV4dC14cyI+4pyC77iPIOC4leC4seC4lCAxICgke3BsYXllclBvd2VydXBzLmN1dE9uZX0pPC9idXR0b24+YCA6ICcnLAogICAgICAgICAgICAgICAgcGxheWVyUG93ZXJ1cHMuaW5zdXJhbmNlID4gMCA/IGA8YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC1pbnN1cmFuY2UiIGNsYXNzPSJwb3dlcnVwLWJ0biBiZy1ncmVlbi01MDAgdGV4dC13aGl0ZSBweS0xIHB4LTMgcm91bmRlZC1mdWxsIHRleHQteHMiPvCfm6HvuI8g4Lib4Lij4Liw4LiB4Lix4LiZ4Lig4Lix4LiiICgke3BsYXllclBvd2VydXBzLmluc3VyYW5jZX0pPC9idXR0b24+YCA6ICcnLAogICAgICAgICAgICAgICAgcGxheWVyUG93ZXJ1cHMuZmlmdHlGaWZ0eSA+IDAgPyBgPGJ1dHRvbiBpZD0idXNlLXBvd2VydXAtZmlmdHlGaWZ0eSIgY2xhc3M9InBvd2VydXAtYnRuIGJnLWdyZWVuLTUwMCB0ZXh0LXdoaXRlIHB5LTEgcHgtMyByb3VuZGVkLWZ1bGwgdGV4dC14cyI+8J+MlyA1MDo1MCAoJHtwbGF5ZXJQb3dlcnVwcy5maWZ0eUZpZnR5fSk8L2J1dHRvbj5gIDogJycsCiAgICAgICAgICAgICAgICBwbGF5ZXJQb3dlcnVwcy5zZWNvbmRDaGFuY2UgPiAwID8gYDxidXR0b24gaWQ9InVzZS1wb3dlcnVwLXNlY29uZENoYW5jZSIgY2xhc3M9InBvd2VydXAtYnRuIGJnLWdyZWVuLTUwMCB0ZXh0LXdoaXRlIHB5LTEgcHgtMyByb3VuZGVkLWZ1bGwgdGV4dC14cyI+8J+UgSDguYHguIHguYnguJXguLHguKcgKCR7cGxheWVyUG93ZXJ1cHMuc2Vjb25kQ2hhbmNlfSk8L2J1dHRvbj5gIDogJycsCiAgICAgICAgICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJyAnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGZsYWdOYW1lTWFya2V0ID0gJ2ZyZWVNYXJrZXRFbnRyeVVzZWRfcScgKyBxSW5kZXggKyAnX3AnICsgY3VycmVudFBsYXllck9uRGV2aWNlOwogICAgICAgICAgICBjb25zdCBmcmVlRW50cnlVc2VkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZU1hcmtldCkgPT09ICd0cnVlJzsKICAgICAgICAgICAgY29uc3QgY2FuRW50ZXJNYXJrZXQgPSAocGxheWVyUG9pbnRzID4gMCkgJiYgKCFmcmVlRW50cnlVc2VkIHx8IHBsYXllclBvaW50cyA+PSAxKTsKICAgICAgICAgICAgY29uc3QgbWFya2V0QnRuVGV4dCA9IHBsYXllclBvaW50cyA9PT0gMCA/IGDguJXguKXguLLguJTguKHguLfguJQgKDAgUClgIDogKGZyZWVFbnRyeVVzZWQgPyBg4LiV4Lil4Liy4LiU4Lih4Li34LiUICgtMSBQKWAgOiBg4LiV4Lil4Liy4LiU4Lih4Li34LiUICgke3BsYXllclBvaW50c30gUClgKTsKICAgICAgICAgICAgY29uc3QgbWFya2V0QnRuQ2xhc3MgPSBjYW5FbnRlck1hcmtldCA/ICJiZy1wdXJwbGUtNjAwIHRleHQtd2hpdGUgaG92ZXI6YmctcHVycGxlLTcwMCBzaGFkb3ctbWQiIDogImJnLWdyYXktNDAwIHRleHQtZ3JheS0yMDAgY3Vyc29yLW5vdC1hbGxvd2VkIG9wYWNpdHktNzAiOwogICAgICAgICAgICBjb25zdCBtYXJrZXRCdG5EaXNhYmxlZCA9IGNhbkVudGVyTWFya2V0ID8gIiIgOiAiZGlzYWJsZWQiOwoKICAgICAgICAgICAgbGV0IG1haW5BY3Rpb25CdXR0b25zID0gYDxidXR0b24gaWQ9Im9wZW4tbWFya2V0LWJ0biIgY2xhc3M9IiR7bWFya2V0QnRuQ2xhc3N9IHB5LTIgcHgtNCByb3VuZGVkLWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1zbSBmbGV4IGl0ZW1zLWNlbnRlciBtaW4taC1bNTRweF0iICR7bWFya2V0QnRuRGlzYWJsZWR9PjxpIGNsYXNzPSJmYXMgZmEtc3RvcmUgbXItMiI+PC9pPiAke21hcmtldEJ0blRleHR9PC9idXR0b24+YDsKCiAgICAgICAgICAgIGlmICghYWN0aXZlUG93ZXJ1cCkgewogICAgICAgICAgICAgICAgIGNvbnN0IGNhbldhZ2VyID0gcGxheWVyUG9pbnRzID4gMDsKICAgICAgICAgICAgICAgICBjb25zdCB3YWdlckJ0bkNsYXNzID0gY2FuV2FnZXIgPyAiYmcteWVsbG93LTQwMCB0ZXh0LXllbGxvdy05MDAgaG92ZXI6YmcteWVsbG93LTUwMCBzaGFkb3ctbWQgYm9yZGVyLWItNCBib3JkZXIteWVsbG93LTYwMCBhY3RpdmU6Ym9yZGVyLWItMCBhY3RpdmU6dHJhbnNsYXRlLXktMSIgOiAiYmctZ3JheS00MDAgdGV4dC1ncmF5LTYwMCBjdXJzb3Itbm90LWFsbG93ZWQgYm9yZGVyLWItNCBib3JkZXItZ3JheS01MDAgb3BhY2l0eS03MCI7CiAgICAgICAgICAgICAgICAgY29uc3QgaW5zdGFudFdhZ2VyQnRuQ2xhc3MgPSBjYW5XYWdlciA/ICJiZy1ncmFkaWVudC10by1yIGZyb20tcmVkLTUwMCB0by1waW5rLTYwMCB0ZXh0LXdoaXRlIHNoYWRvdy1tZCBib3JkZXItYi00IGJvcmRlci1yZWQtODAwIGFjdGl2ZTpib3JkZXItYi0wIGFjdGl2ZTp0cmFuc2xhdGUteS0xIiA6ICJiZy1ncmF5LTQwMCB0ZXh0LWdyYXktMjAwIGN1cnNvci1ub3QtYWxsb3dlZCBib3JkZXItYi00IGJvcmRlci1ncmF5LTUwMCBvcGFjaXR5LTcwIjsKICAgICAgICAgICAgICAgICBjb25zdCB3YWdlckRpc2FibGVkQXR0ciA9IGNhbldhZ2VyID8gIiIgOiAiZGlzYWJsZWQiOwogICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIG1haW5BY3Rpb25CdXR0b25zICs9IGA8YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC13YWdlck11bHRpcGxpZXIiIGNsYXNzPSIke3dhZ2VyQnRuQ2xhc3N9IHB5LTEgcHgtMyByb3VuZGVkLWxnIGZvbnQtYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBtaW4taC1bNTRweF0iICR7d2FnZXJEaXNhYmxlZEF0dHJ9PjxzcGFuIGNsYXNzPSJ0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj7wn5KwIOC5gOC4lOC4tOC4oeC4nuC4seC4meC5gOC4peC4t+C4reC4geC5gOC4reC4hzwvc3Bhbj48L2J1dHRvbj48YnV0dG9uIGlkPSJ1c2UtcG93ZXJ1cC13YWdlck11bHRpcGxpZXItaW5zdGFudCIgY2xhc3M9IiR7aW5zdGFudFdhZ2VyQnRuQ2xhc3N9IHB5LTEgcHgtMyByb3VuZGVkLWxnIGZvbnQtYm9sZCB0cmFuc2l0aW9uLWFsbCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBtaW4taC1bNTRweF0iICR7d2FnZXJEaXNhYmxlZEF0dHJ9PjxzcGFuIGNsYXNzPSJ0ZXh0LXNtIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xIj48aSBjbGFzcz0iZmFzIGZhLXJvY2tldCI+PC9pPiDguYDguJTguLTguKHguJ7guLHguJnguJfguLjguYjguKHguKvguKHguJQ8L3NwYW4+PC9idXR0b24+YDsKICAgICAgICAgICAgfQogICAgICAgICAgICBtYXJrZXRBbmRJbnZlbnRvcnlIVE1MID0gYDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGdhcC0yIG15LTQgcC0yIGJnLWJsYWNrLzIwIHJvdW5kZWQtbGciPjxkaXYgY2xhc3M9ImZsZXggZmxleC13cmFwIGp1c3RpZnktY2VudGVyIGl0ZW1zLXN0cmV0Y2ggZ2FwLTIgdy1mdWxsIj4ke21haW5BY3Rpb25CdXR0b25zfTwvZGl2PjxkaXYgY2xhc3M9ImZsZXggZmxleC13cmFwIGdhcC0xIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBtdC0xIj4ke2ludmVudG9yeUJ1dHRvbnMgfHwgJyd9PC9kaXY+PC9kaXY+YDsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8vIC0tLSBbU3RhdHVzIEJhbm5lcnNdIC0tLQogICAgbGV0IGFjdGl2ZVBvd2VydXBIVE1MID0gJyc7CiAgICBpZiAocGxheWVyRGF0YS5pc0ppbnhlZCkgYWN0aXZlUG93ZXJ1cEhUTUwgKz0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20tcmVkLTcwMCB0by1yZWQtOTAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItcmVkLTQwMCI+PGRpdiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtc2t1bGwtY3Jvc3Nib25lcyI+PC9pPiA8c3Bhbj7guITguLjguJPguYLguJTguJnguITguLPguKrguLLguJshPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXhzIG9wYWNpdHktODAiPuC4hOC4sOC5geC4meC4meC4leC4tOC4lOC4peC4miB4MiDguJbguYnguLLguJXguK3guJrguJzguLTguJQ8L3A+PC9kaXY+YDsKICAgIGlmIChwbGF5ZXJEYXRhLmlzRm9yY2VkQ29uZmlkZW50KSBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1ncmF5LTcwMCB0by1ncmF5LTkwMCB0ZXh0LXdoaXRlIHRleHQtY2VudGVyIHB5LTIgcHgtNCByb3VuZGVkLWxnIG1iLTMgc2hhZG93LWxnIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTIgYm9yZGVyLWdyYXktNTAwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1naG9zdCI+PC9pPiA8c3Bhbj7guJbguLnguIHguJrguLHguIfguITguLHguJrguKHguLHguYjguJnguYPguIghPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXhzIG9wYWNpdHktODAiPuC4leC5ieC4reC4h+C5gOC4lOC4tOC4oeC4nuC4seC4meC4lOC5ieC4p+C4ouC4hOC4p+C4suC4oeC4oeC4seC5iOC4meC5g+C4iOC4quC4ueC4h+C4quC4uOC4lDwvcD48L2Rpdj5gOwogICAgaWYgKChwbGF5ZXJEYXRhLnRpbWVCb251c1RoaXNRdWVzdGlvbiB8fCAwKSA+IDApIGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLXllbGxvdy00MDAgdG8tb3JhbmdlLTUwMCB0ZXh0LXdoaXRlIHRleHQtY2VudGVyIHB5LTIgcHgtNCByb3VuZGVkLWxnIG1iLTMgc2hhZG93LWxnIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTIgYm9yZGVyLXdoaXRlLzMwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1jbG9jayBmYS1sZyI+PC9pPjxzcGFuPuC5gOC4p+C4peC4suC5guC4muC4meC4seC4quC4l+C4s+C4h+C4suC4mSE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQtc20gb3BhY2l0eS05MCI+KzI1JSDguYDguKfguKXguLLguITguLTguJTguYDguJ7guLTguYjguKHguJ7guLTguYDguKjguKk8L3A+PC9kaXY+YDsKICAgIGlmIChhY3RpdmVQb3dlcnVwKSB7CiAgICAgICAgaWYgKGFjdGl2ZVBvd2VydXAgPT09ICd3YWdlck11bHRpcGxpZXInKSB7CiAgICAgICAgICAgICBjb25zdCB3YWdlclRleHQgPSBpc1NlY3JldFNjb3JlTW9kZSA/ICfwn5qAIOC4hOC4uOC4k+C5gOC4lOC4tOC4oeC4nuC4seC4meC4q+C4oeC4lOC4q+C4meC5ieC4suC4leC4seC4gSEnIDogJ/CfkrAg4LmC4Lir4Lih4LiU4LmA4LiU4Li04Lih4Lie4Lix4LiZ4LiX4Liz4LiH4Liy4LiZ4Lit4Lii4Li54LmIISc7CiAgICAgICAgICAgICBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIHRleHQtY2VudGVyIHB5LTMgcHgtNCByb3VuZGVkLWxnIGJnLWdyYWRpZW50LXRvLXIgZnJvbS15ZWxsb3ctNDAwIHRvLXllbGxvdy02MDAgdGV4dC1ibGFjayBmb250LWV4dHJhYm9sZCBtYi0zIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTQgYm9yZGVyLXllbGxvdy0yMDAgc2hhZG93LWxnIHRleHQteGwgdHJhbnNmb3JtIHNjYWxlLTEwNSI+JHt3YWdlclRleHR9IDxzcGFuIGNsYXNzPSJibG9jayB0ZXh0LXNtIG10LTEgZm9udC1ub3JtYWwgdGV4dC1yZWQtOTAwIj4o4LiV4Lit4Lia4LiW4Li54LiBIHgyIC8g4LiV4Lit4Lia4Lic4Li04LiU4LmA4Liq4Li14Lii4LmA4LiH4Li04LiZ4LmA4LiC4LmJ4Liy4LiB4Lit4LiH4LiB4Lil4Liy4LiHISk8L3NwYW4+PC9kaXY+YDsKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVBvd2VydXAgPT09ICdjdXRPbmUnKSB7IGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLWdyZWVuLTQwMCB0by1lbWVyYWxkLTYwMCB0ZXh0LXdoaXRlIHRleHQtY2VudGVyIHB5LTIgcHgtNCByb3VuZGVkLWxnIG1iLTMgc2hhZG93LWxnIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTIgYm9yZGVyLXdoaXRlLzMwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1jdXQgZmEtbGciPjwvaT4gPHNwYW4+4LiV4Lix4LiU4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4LiX4Liz4LiH4Liy4LiZITwvc3Bhbj48L2Rpdj48cCBjbGFzcz0idGV4dC1zbSBvcGFjaXR5LTkwIj7guJXguLHguKfguYDguKXguLfguK3guIHguJfguLXguYjguJzguLTguJQgMSDguILguYnguK3guJbguLnguIHguJXguLHguJTguK3guK3guIHguYHguKXguYnguKc8L3A+PC9kaXY+YDsKICAgICAgICB9IGVsc2UgaWYgKGFjdGl2ZVBvd2VydXAgPT09ICdmaWZ0eUZpZnR5JykgeyBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1wdXJwbGUtNTAwIHRvLWluZGlnby02MDAgdGV4dC13aGl0ZSB0ZXh0LWNlbnRlciBweS0yIHB4LTQgcm91bmRlZC1sZyBtYi0zIHNoYWRvdy1sZyBhbmltYXRlLXB1bHNlIGJvcmRlci0yIGJvcmRlci13aGl0ZS8zMCI+PGRpdiBjbGFzcz0idGV4dC14bCBmb250LWJvbGQgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTIiPjxpIGNsYXNzPSJmYXMgZmEtYWRqdXN0IGZhLWxnIj48L2k+IDxzcGFuPjUwOjUwIOC4l+C4s+C4h+C4suC4mSE8L3NwYW4+PC9kaXY+PHAgY2xhc3M9InRleHQtc20gb3BhY2l0eS05MCI+4LiV4Lix4LiU4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiB4Lic4Li04LiU4Lit4Lit4LiBIDIg4LiC4LmJ4LitPC9wPjwvZGl2PmA7CiAgICAgICAgfSBlbHNlIGlmIChhY3RpdmVQb3dlcnVwID09PSAnc2Vjb25kQ2hhbmNlJykgeyBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIGJnLWdyYWRpZW50LXRvLXIgZnJvbS1ibHVlLTQwMCB0by1jeWFuLTUwMCB0ZXh0LXdoaXRlIHRleHQtY2VudGVyIHB5LTIgcHgtNCByb3VuZGVkLWxnIG1iLTMgc2hhZG93LWxnIGFuaW1hdGUtcHVsc2UgYm9yZGVyLTIgYm9yZGVyLXdoaXRlLzMwIj48ZGl2IGNsYXNzPSJ0ZXh0LXhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS11bmRvLWFsdCBmYS1sZyI+PC9pPiA8c3Bhbj7guYLguK3guIHguLLguKrguITguKPguLHguYnguIfguJfguLXguYjguKrguK3guIchPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktOTAiPuC4leC4reC4muC4nOC4tOC4lOC5hOC4lOC5iSAxIOC4hOC4o+C4seC5ieC4h+C5guC4lOC4ouC5hOC4oeC5iOC5gOC4quC4teC4ouC4hOC4sOC5geC4meC4mTwvcD48L2Rpdj5gOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlUG93ZXJ1cCA9PT0gJ3JldmVhbE9wdGlvbnMnKSB7IGFjdGl2ZVBvd2VydXBIVE1MICs9IGA8ZGl2IGNsYXNzPSJ3LWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLXBpbmstNTAwIHRvLXJvc2UtNjAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItd2hpdGUvMzAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLWV5ZSBmYS1sZyI+PC9pPiA8c3Bhbj7guYDguJzguKLguJXguLHguKfguYDguKXguLfguK3guIEhPC9zcGFuPjwvZGl2PjxwIGNsYXNzPSJ0ZXh0LXNtIG9wYWNpdHktOTAiPuC5geC4quC4lOC4h+C4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4teC5iOC4i+C5iOC4reC4meC4reC4ouC4ueC5iOC5gOC4o+C4teC4ouC4muC4o+C5ieC4reC4ojwvcD48L2Rpdj5gOwogICAgICAgIH0gZWxzZSBpZiAoYWN0aXZlUG93ZXJ1cCA9PT0gJ2luc3VyYW5jZScpIHsgYWN0aXZlUG93ZXJ1cEhUTUwgKz0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20tZ3JheS01MDAgdG8tc2xhdGUtNjAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItMyBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXItd2hpdGUvMzAiPjxkaXYgY2xhc3M9InRleHQteGwgZm9udC1ib2xkIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIj48aSBjbGFzcz0iZmFzIGZhLXNoaWVsZC1hbHQgZmEtbGciPjwvaT4gPHNwYW4+4Lib4Lij4Liw4LiB4Lix4LiZ4Lig4Lix4Lii4LiX4Liz4LiH4Liy4LiZITwvc3Bhbj48L2Rpdj48cCBjbGFzcz0idGV4dC1zbSBvcGFjaXR5LTkwIj7guJvguYnguK3guIfguIHguLHguJnguIHguLLguKPguYDguKrguLXguKLguITguLDguYHguJnguJnguKvguLLguIHguJXguK3guJrguJzguLTguJQ8L3A+PC9kaXY+YDsKICAgICAgICB9IGVsc2UgeyBhY3RpdmVQb3dlcnVwSFRNTCArPSBgPGRpdiBjbGFzcz0idy1mdWxsIHRleHQtY2VudGVyIHB5LTIgcHgtMyByb3VuZGVkLWxnIGJnLXllbGxvdy01MDAgdGV4dC1ibGFjayBmb250LWJvbGQgbWItMyBhbmltYXRlLXB1bHNlIHNoYWRvdy1tZCI+JHthY3RpdmVQb3dlcnVwfSDguJfguLPguIfguLLguJnguK3guKLguLnguYghPC9kaXY+YDsgfQogICAgfQoKICAgIGxldCBmaXJlQmFubmVySFRNTCA9ICcnOwogICAgaWYgKCFpc1NlY3JldFNjb3JlTW9kZSAmJiAhaXNFeGFtTW9kZSkgewogICAgICAgIGNvbnN0IGN1cnJlbnRTdHJlYWsgPSBwbGF5ZXJEYXRhLmNvcnJlY3RTdHJlYWsgfHwgMDsKICAgICAgICBpZiAoY3VycmVudFN0cmVhayA+PSAzKSB7CiAgICAgICAgICAgIGZpcmVCYW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InctZnVsbCBiZy1ncmFkaWVudC10by1yIGZyb20tb3JhbmdlLTUwMCB0by1yZWQtNjAwIHRleHQtd2hpdGUgdGV4dC1jZW50ZXIgcHktMiBweC00IHJvdW5kZWQtbGcgbWItNCBzaGFkb3ctbGcgYW5pbWF0ZS1wdWxzZSBib3JkZXItMiBib3JkZXIteWVsbG93LTMwMCI+PGRpdiBjbGFzcz0idGV4dC1sZyBmb250LWV4dHJhYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiI+PGkgY2xhc3M9ImZhcyBmYS1maXJlIHRleHQteWVsbG93LTIwMCB0ZXh0LTJ4bCI+PC9pPjxzcGFuPk9OIEZJUkUhIOC4hOC4sOC5geC4meC4mSB4Mjwvc3Bhbj48aSBjbGFzcz0iZmFzIGZhLWZpcmUgdGV4dC15ZWxsb3ctMjAwIHRleHQtMnhsIj48L2k+PC9kaXY+PC9kaXY+YDsKICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRTdHJlYWsgPiAwKSB7CiAgICAgICAgICAgIGZpcmVCYW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9InctZnVsbCB0ZXh0LWNlbnRlciBtYi00Ij48c3BhbiBjbGFzcz0idGV4dC14cyBmb250LWJvbGQgdGV4dC1vcmFuZ2UtNDAwIGJnLWJsYWNrLzIwIHB4LTIgcHktMSByb3VuZGVkLWZ1bGwiPvCflKUgQ29tYm86ICR7Y3VycmVudFN0cmVha30vMzwvc3Bhbj48L2Rpdj5gOwogICAgICAgIH0KICAgIH0KCiAgICBjb25zdCBwb3RIVE1MID0gZ2V0Q2VudHJhbFBvdEhUTUwoZ2FtZURhdGEpOwoKICAgIC8vIC0tLSBb4Lib4Li44LmI4Lih4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiE4LiZ4LiV4Lit4LiaXSAtLS0KICAgIGxldCBjaGFuZ2VSZXNwb25kZXJCdG5IVE1MID0gJyc7CiAgICBjb25zdCBwZW5kaW5nUGxheWVycyA9IGxvY2FsVGVhbVBsYXllcnMuZmlsdGVyKG5hbWUgPT4gZ2FtZURhdGEucGxheWVyc1tuYW1lXT8uYW5zd2VyZWQgIT09IHRydWUpOwogICAgaWYgKGxvY2FsVGVhbVBsYXllcnMubGVuZ3RoID4gMSAmJiBwZW5kaW5nUGxheWVycy5sZW5ndGggPiAxKSB7CiAgICAgICAgY2hhbmdlUmVzcG9uZGVyQnRuSFRNTCA9IGAKICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3dpdGNoLXJlc3BvbmRlci1idG4iIGNsYXNzPSJiZy13aGl0ZS8yMCBob3ZlcjpiZy13aGl0ZS8zMCB0ZXh0LXdoaXRlIHRleHQtc20gZm9udC1zZW1pYm9sZCBweC0zIHB5LTIgcm91bmRlZC1sZyBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiB0cmFuc2l0aW9uLWFsbCBib3JkZXIgYm9yZGVyLXdoaXRlLzMwIHNoYWRvdy1zbSI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXVzZXJzIj48L2k+IOC5gOC4m+C4peC4teC5iOC4ouC4mQogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICBgOwogICAgfQoKICAgIC8vIC0tLSBbUmVuZGVyIEhUTUwg4Lir4Lil4Lix4LiBXSAtLS0KICAgIGxpdmVHYW1lVmlldy5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTcwMCB0ZXh0LXdoaXRlIHJvdW5kZWQtbGcgcC04IGZsZXggZmxleC1jb2wgaC1mdWxsIj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdyaWQgZ3JpZC1jb2xzLTMgaXRlbXMtY2VudGVyIG1iLTQgcmVsYXRpdmUgei0yMCI+CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgganVzdGlmeS1zdGFydCI+CiAgICAgICAgICAgICAgICAgICAgJHtjaGFuZ2VSZXNwb25kZXJCdG5IVE1MfQogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctaW5kaWdvLTkwMC81MCBweC00IHB5LTEuNSByb3VuZGVkLWZ1bGwgYm9yZGVyIGJvcmRlci1pbmRpZ28tNDAwLzMwIGJhY2tkcm9wLWJsdXItc20gc2hhZG93LWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtbGcgZm9udC1ib2xkIHRleHQtd2hpdGUgd2hpdGVzcGFjZS1ub3dyYXAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAg4LiC4LmJ4Lit4LiX4Li14LmIIDxzcGFuIGNsYXNzPSJ0ZXh0LXllbGxvdy0zMDAiPiR7cUluZGV4ICsgMX08L3NwYW4+IC8gJHt0b3RhbFF1ZXN0aW9uc30KICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBqdXN0aWZ5LWVuZCB0cmFuc2Zvcm0gc2NhbGUtOTAgb3JpZ2luLXJpZ2h0Ij4KICAgICAgICAgICAgICAgICAgICAke3BvdEhUTUx9CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8cCBjbGFzcz0idGV4dC0yeGwgZm9udC1ib2xkIHRleHQtY2VudGVyIHRleHQteWVsbG93LTMwMCBteS0yIGRyb3Atc2hhZG93LW1kIj7guJXguLLguILguK3guIc6ICR7Y3VycmVudFBsYXllck9uRGV2aWNlfTwvcD4KICAgICAgICAgICAgCiAgICAgICAgICAgICR7ZmlyZUJhbm5lckhUTUx9IAogICAgICAgICAgICAke3RpbWVySFRNTH0gCiAgICAgICAgICAgICR7bWFya2V0QW5kSW52ZW50b3J5SFRNTH0gCiAgICAgICAgICAgIAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LWdyb3cgZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICAgICAgICAgICAgJHthY3RpdmVQb3dlcnVwSFRNTH0KICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC0zeGwgZm9udC1ib2xkIG1iLTggdGV4dC1jZW50ZXIgbGVhZGluZy10aWdodCI+JHtxLnF1ZXN0aW9uVGV4dCB8fCBxLnN0ZW19PC9oMj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy00eGwgZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBnYXAtNCI+JHtvcHRpb25zSFRNTH08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgCiAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoKTsKCiAgICAvLyAtLS0gW0Z1bmN0aW9uIOC4quC5iOC4h+C4hOC4s+C4leC4reC4ml0gLS0tCiAgICBmdW5jdGlvbiB0cmlnZ2VyU3VibWlzc2lvbihhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJOYW1lKSB7CiAgICAgICAgY29uc3QgY29uZmlkZW5jZUVuYWJsZWQgPSBnYW1lRGF0YS5pc0NvbmZpZGVuY2VTY29yaW5nRW5hYmxlZCA9PT0gdHJ1ZTsKICAgICAgICBjb25zdCBxSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgICAgICBjb25zdCBmbGFnTmFtZSA9IGBwb3dlcnVwVXNlZF9xJHtxSW5kZXh9X3Ake3BsYXllck5hbWV9YDsKICAgICAgICBjb25zdCBhY3RpdmVQb3dlcnVwID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZSk7CiAgICAgICAgY29uc3QgaXNXYWdlck1vZGUgPSBhY3RpdmVQb3dlcnVwID09PSAnd2FnZXJNdWx0aXBsaWVyJzsKICAgICAgICBjb25zdCBwbGF5ZXJEYXRhID0gZ2FtZURhdGEucGxheWVyc1twbGF5ZXJOYW1lXTsKCiAgICAgICAgaWYgKGlzV2FnZXJNb2RlKSB7CiAgICAgICAgICAgIGNvbnN0IGlzSW5zdGFudFdhZ2VyID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnaW5zdGFudFdhZ2VyJykgPT09ICd0cnVlJzsKICAgICAgICAgICAgaWYgKGlzU2VjcmV0U2NvcmVNb2RlIHx8IGlzSW5zdGFudFdhZ2VyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UG9pbnRzID0gcGxheWVyRGF0YS50b3RhbFBvaW50cyB8fCAwOwogICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnaW5zdGFudFdhZ2VyJyk7IAogICAgICAgICAgICAgICAgaGFuZGxlU3luY0Fuc3dlclN1Ym1pdChhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24sIGdhbWVEYXRhLCBwbGF5ZXJOYW1lLCBmYWxzZSwgY3VycmVudFBvaW50cyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zdCB3YWdlck1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLW1vZGFsJyk7CiAgICAgICAgICAgICAgICBjb25zdCBzbGlkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2FnZXItc2xpZGVyJyk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhZ2VyLWFtb3VudC1kaXNwbGF5Jyk7CiAgICAgICAgICAgICAgICBjb25zdCBtYXhQb2ludHNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YWdlci1tYXgtcG9pbnRzJyk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UG9pbnRzID0gcGxheWVyRGF0YS50b3RhbFBvaW50cyB8fCAwOwogICAgICAgICAgICAgICAgc2xpZGVyLm1heCA9IGN1cnJlbnRQb2ludHM7IHNsaWRlci52YWx1ZSA9IGN1cnJlbnRQb2ludHM7IGRpc3BsYXkudGV4dENvbnRlbnQgPSBjdXJyZW50UG9pbnRzOwogICAgICAgICAgICAgICAgbWF4UG9pbnRzRWwudGV4dENvbnRlbnQgPSBjdXJyZW50UG9pbnRzOwogICAgICAgICAgICAgICAgc2xpZGVyLm9uaW5wdXQgPSAoKSA9PiB7IGRpc3BsYXkudGV4dENvbnRlbnQgPSBzbGlkZXIudmFsdWU7IH07IAogICAgICAgICAgICAgICAgY29uc3QgaGlkZGVuSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsZWN0ZWQtYW5zd2VyLWluZGV4LWhpZGRlbi13YWdlcicpOwogICAgICAgICAgICAgICAgaGlkZGVuSW5wdXQuZGF0YXNldC5hbnN3ZXJWYWx1ZSA9IGFuc3dlclZhbHVlOwogICAgICAgICAgICAgICAgaGlkZGVuSW5wdXQuZGF0YXNldC5xdWVzdGlvbiA9IEpTT04uc3RyaW5naWZ5KHF1ZXN0aW9uKTsKICAgICAgICAgICAgICAgIGhpZGRlbklucHV0LmRhdGFzZXQuZ2FtZURhdGEgPSBKU09OLnN0cmluZ2lmeShnYW1lRGF0YSk7CiAgICAgICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LnBsYXllck5hbWUgPSBwbGF5ZXJOYW1lOwogICAgICAgICAgICAgICAgd2FnZXJNb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsgCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGNvbmZpZGVuY2VFbmFibGVkKSB7IAogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1tb2RhbCcpLmRhdGFzZXQuY3VycmVudE1vZGUgPSAnc3luYyc7CiAgICAgICAgICAgIGNvbnN0IGhpZGRlbklucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdGVkLWFuc3dlci1pbmRleC1oaWRkZW4nKTsKICAgICAgICAgICAgaGlkZGVuSW5wdXQuZGF0YXNldC5hbnN3ZXJWYWx1ZSA9IGFuc3dlclZhbHVlOwogICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LnF1ZXN0aW9uID0gSlNPTi5zdHJpbmdpZnkocXVlc3Rpb24pOwogICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LmdhbWVEYXRhID0gSlNPTi5zdHJpbmdpZnkoZ2FtZURhdGEpOwogICAgICAgICAgICBoaWRkZW5JbnB1dC5kYXRhc2V0LnBsYXllck5hbWUgPSBwbGF5ZXJOYW1lOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlkZW5jZS1tb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGhhbmRsZVN5bmNBbnN3ZXJTdWJtaXQoYW5zd2VyVmFsdWUsIHF1ZXN0aW9uLCBnYW1lRGF0YSwgcGxheWVyTmFtZSwgZmFsc2UsIDApOyAKICAgICAgICB9CiAgICB9CgogICAgaWYgKGhhc1N1Ym1pdEJ1dHRvbikgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLXN1Ym1pdC1idG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1zaG9ydC1hbnN3ZXItaW5wdXQnKSB8fCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1tYXRjaGluZy1zZWxlY3QnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSBb4Liq4LmI4Lin4LiZ4LmB4LiB4LmJ4LmE4LiCXSDguJXguKPguKfguIjguKrguK3guJrguITguYjguLLguIjguLLguIEgaW5wdXQg4LiX4Lix4LmJ4LiH4Liq4Lit4LiH4LmB4Lia4LiaIC0tLQogICAgICAgICAgICBsZXQgYW5zd2VyVmFsdWUgPSAnJzsKICAgICAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICAgICAgICBhbnN3ZXJWYWx1ZSA9IGlucHV0LnZhbHVlLnRyaW0oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoaW5nSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1tYXRjaGluZy1pbnB1dCcpOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoaW5nSW5wdXQpIGFuc3dlclZhbHVlID0gbWF0Y2hpbmdJbnB1dC52YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGFuc3dlclZhbHVlID09PSAnJykgeyBzaG93TWVzc2FnZSgi4LiB4Lij4Li44LiT4Liy4LmA4Lil4Li34Lit4LiB4Lir4Lij4Li34Lit4Lie4Li04Lih4Lie4LmM4LiE4Liz4LiV4Lit4Lia4LiB4LmI4Lit4LiZ4LiE4Lij4Lix4LiaIik7IHJldHVybjsgfQogICAgICAgICAgICB0cmlnZ2VyU3VibWlzc2lvbihhbnN3ZXJWYWx1ZSwgcSwgZ2FtZURhdGEsIGN1cnJlbnRQbGF5ZXJPbkRldmljZSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5saXZlLWFuc3dlci1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIHRyaWdnZXJTdWJtaXNzaW9uKGJ0bi5kYXRhc2V0LnZhbHVlLCBxLCBnYW1lRGF0YSwgY3VycmVudFBsYXllck9uRGV2aWNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgY29uc3Qgc3dpdGNoQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N3aXRjaC1yZXNwb25kZXItYnRuJyk7CiAgICBpZiAoc3dpdGNoQnRuKSB7CiAgICAgICAgc3dpdGNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBzaG93UmVzcG9uZGVyU2VsZWN0aW9uTW9kYWwoZ2FtZURhdGEpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIC0tLSBNYXJrZXQgTGlzdGVuZXJzIC0tLQogICAgaWYgKGdhbWVEYXRhLmlzQmxhY2tNYXJrZXRFbmFibGVkID09PSB0cnVlICYmICFpc1NlY3JldFNjb3JlTW9kZSkgewogICAgICAgIGNvbnN0IG1hcmtldEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcGVuLW1hcmtldC1idG4nKTsKICAgICAgICBpZiAobWFya2V0QnRuKSB7CiAgICAgICAgICAgIG1hcmtldEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgICBjb25zdCBmbGFnTmFtZSA9ICdmcmVlTWFya2V0RW50cnlVc2VkX3EnICsgcUluZGV4ICsgJ19wJyArIGN1cnJlbnRQbGF5ZXJPbkRldmljZTsKICAgICAgICAgICAgICAgICBjb25zdCBmcmVlRW50cnlVc2VkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZSkgPT09ICd0cnVlJzsKICAgICAgICAgICAgICAgICBpZiAoIWZyZWVFbnRyeVVzZWQpIHsKICAgICAgICAgICAgICAgICAgICAgb3BlbkJsYWNrTWFya2V0KGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsKICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShmbGFnTmFtZSwgJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgICAgcmVuZGVyU3R1ZGVudFN5bmNRdWVzdGlvblZpZXcoZ2FtZURhdGEpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIDwgMSkgeyBzaG93TWVzc2FnZSgi4LiE4Li44LiT4Lih4Li1IFBvaW50cyDguYTguKHguYjguJ7guK0gKOC4leC5ieC4reC4h+C5g+C4iuC5iSAxUCkiKTsgcmV0dXJuOyB9CiAgICAgICAgICAgICAgICAgICAgIHNob3dDb25maXJtYXRpb24oIuC5gOC4guC5ieC4suC4leC4peC4suC4lOC4oeC4t+C4lOC4hOC4o+C4seC5ieC4h+C4leC5iOC4reC5hOC4m+C5gOC4quC4teC4ouC4hOC5iOC4suC4mOC4o+C4o+C4oeC5gOC4meC4teC4ouC4oSAxIFBvaW50IOC4ouC4t+C4meC4ouC4seC4mT8iLCAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVQYXlGb3JNYXJrZXRFbnRyeShjdXJyZW50UGxheWVyT25EZXZpY2UsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsKICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLWJ1eVRpbWUnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4geyBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7IGhhbmRsZVVzZVBvd2VydXAoY3VycmVudFBsYXllck9uRGV2aWNlLCAnYnV5VGltZScsIHEsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsgfSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLWN1dE9uZScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICdjdXRPbmUnLCBxLCBnYW1lRGF0YSwgcGxheWVyRGF0YSk7IH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2UtcG93ZXJ1cC1pbnN1cmFuY2UnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4geyBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7IGhhbmRsZVVzZVBvd2VydXAoY3VycmVudFBsYXllck9uRGV2aWNlLCAnaW5zdXJhbmNlJywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtZmlmdHlGaWZ0eScpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICdmaWZ0eUZpZnR5JywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlLXBvd2VydXAtc2Vjb25kQ2hhbmNlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsgZS50YXJnZXQuZGlzYWJsZWQgPSB0cnVlOyBoYW5kbGVVc2VQb3dlcnVwKGN1cnJlbnRQbGF5ZXJPbkRldmljZSwgJ3NlY29uZENoYW5jZScsIHEsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsgfSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLXJldmVhbE9wdGlvbnMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4geyBlLnRhcmdldC5kaXNhYmxlZCA9IHRydWU7IGhhbmRsZVVzZVBvd2VydXAoY3VycmVudFBsYXllck9uRGV2aWNlLCAncmV2ZWFsT3B0aW9ucycsIHEsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKTsgfSk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZS1wb3dlcnVwLXdhZ2VyTXVsdGlwbGllcicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnaW5zdGFudFdhZ2VyJywgJ2ZhbHNlJyk7IGhhbmRsZVVzZVBvd2VydXAoY3VycmVudFBsYXllck9uRGV2aWNlLCAnd2FnZXJNdWx0aXBsaWVyJywgcSwgZ2FtZURhdGEsIHBsYXllckRhdGEpOyB9KTsKICAgIH0KICAgIGlmIChnYW1lRGF0YS5pc0JsYWNrTWFya2V0RW5hYmxlZCA9PT0gdHJ1ZSkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2UtcG93ZXJ1cC13YWdlck11bHRpcGxpZXItaW5zdGFudCcpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGUudGFyZ2V0LmRpc2FibGVkID0gdHJ1ZTsgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSgnaW5zdGFudFdhZ2VyJywgJ3RydWUnKTsgaGFuZGxlVXNlUG93ZXJ1cChjdXJyZW50UGxheWVyT25EZXZpY2UsICd3YWdlck11bHRpcGxpZXInLCBxLCBnYW1lRGF0YSwgcGxheWVyRGF0YSk7IH0pOwogICAgfQp9CgovLyAtLS0g4Lif4Lix4LiH4LiB4LmM4LiK4Lix4LiZ4Liq4Liz4Lir4Lij4Lix4LiaIEN1c3RvbSBEcm9wZG93biDguYPguJkgU3luYyBNb2RlIC0tLQp3aW5kb3cudG9nZ2xlU3luY0Ryb3Bkb3duID0gZnVuY3Rpb24oKSB7CiAgICBjb25zdCBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtZHJvcGRvd24tbGlzdCcpOwogICAgaWYgKGxpc3QpIGxpc3QuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7Cn07Cgp3aW5kb3cuc2VsZWN0U3luY09wdGlvbiA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAvLyAxLiDguK3guLHguJvguYDguJTguJXguITguYjguLLguKXguIfguYPguJkgSGlkZGVuIElucHV0CiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLW1hdGNoaW5nLWlucHV0Jyk7CiAgICBpZiAoaW5wdXQpIGlucHV0LnZhbHVlID0gdmFsdWU7CgogICAgLy8gMi4g4Lit4Lix4Lib4LmA4LiU4LiV4LiC4LmJ4Lit4LiE4Lin4Liy4Lih4Lia4LiZ4Lib4Li44LmI4Lih4LmB4Liq4LiU4LiH4Lic4LilCiAgICBjb25zdCBkaXNwbGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N5bmMtZHJvcGRvd24tZGlzcGxheScpOwogICAgaWYgKGRpc3BsYXkpIHsKICAgICAgICBkaXNwbGF5LmlubmVySFRNTCA9IHZhbHVlOwogICAgICAgIGRpc3BsYXkuY2xhc3NMaXN0LnJlbW92ZSgndGV4dC1ncmF5LTQwMCcpOwogICAgICAgIGRpc3BsYXkuY2xhc3NMaXN0LmFkZCgndGV4dC1ncmF5LTgwMCcsICdmb250LWJvbGQnKTsKICAgICAgICAvLyAzLiDguKrguLHguYjguIcgTWF0aEpheCDguYHguJvguKXguIfguKrguLnguJXguKPguJfguLHguJnguJfguLUKICAgICAgICBpZiAod2luZG93Lk1hdGhKYXgpIE1hdGhKYXgudHlwZXNldFByb21pc2UoW2Rpc3BsYXldKTsKICAgIH0KCiAgICAvLyA0LiDguJvguLTguJQgRHJvcGRvd24KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzeW5jLWRyb3Bkb3duLWxpc3QnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKfTsKCi8vIOC4m+C4tOC4lCBEcm9wZG93biDguYDguKHguLfguYjguK3guITguKXguLTguIHguJfguLXguYjguK3guLfguYjguJkKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgaWYgKCFlLnRhcmdldC5jbG9zZXN0KCcuc3luYy1jdXN0b20tZHJvcGRvd24nKSkgewogICAgICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3luYy1kcm9wZG93bi1saXN0Jyk7CiAgICAgICAgaWYgKGxpc3QpIGxpc3QuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICB9Cn0pOwoKZnVuY3Rpb24gc2hvd1Jlc3BvbmRlclNlbGVjdGlvbk1vZGFsKGdhbWVEYXRhKSB7CiAgICBjb25zdCBxSW5kZXggPSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleDsKICAgIGNvbnN0IHRvdGFsUXVlc3Rpb25zID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1ZXN0aW9ucy5sZW5ndGg7CiAgICAKICAgIC8vIOC4q+C4suC4nOC4ueC5ieC5gOC4peC5iOC4meC5g+C4meC5gOC4hOC4o+C4t+C5iOC4reC4h+C4l+C4teC5iOC4ouC4seC4h+C5hOC4oeC5iOC5hOC4lOC5ieC4leC4reC4mgogICAgY29uc3QgcGVuZGluZ1BsYXllcnMgPSBsb2NhbFRlYW1QbGF5ZXJzLmZpbHRlcihuYW1lID0+IGdhbWVEYXRhLnBsYXllcnNbbmFtZV0/LmFuc3dlcmVkICE9PSB0cnVlKTsKCiAgICBjb25zdCBsaXN0SFRNTCA9IHBlbmRpbmdQbGF5ZXJzLm1hcChuYW1lID0+IGAKICAgICAgICA8YnV0dG9uIGNsYXNzPSJ3LWZ1bGwgYmctd2hpdGUgdGV4dC1pbmRpZ28tNzAwIGZvbnQtYm9sZCBweS00IHB4LTYgcm91bmRlZC14bCBzaGFkb3ctbWQgaG92ZXI6c2hhZG93LWxnIHRyYW5zaXRpb24tYWxsIHRyYW5zZm9ybSBob3ZlcjpzY2FsZS0xMDUgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIGdyb3VwIHNlbGVjdC1yZXNwb25kZXItYnRuIiBkYXRhLW5hbWU9IiR7bmFtZX0iPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC14bCI+JHtuYW1lfTwvc3Bhbj4KICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1wbGF5LWNpcmNsZSB0ZXh0LTN4bCB0ZXh0LWluZGlnby00MDAgZ3JvdXAtaG92ZXI6dGV4dC1pbmRpZ28tNjAwIHRyYW5zaXRpb24tY29sb3JzIj48L2k+CiAgICAgICAgPC9idXR0b24+CiAgICBgKS5qb2luKCcnKTsKCiAgICBjb25zdCBtb2RhbEhUTUwgPSBgCiAgICAgICAgPGRpdiBpZD0icmVzcG9uZGVyLXNlbGVjdGlvbi1vdmVybGF5IiBjbGFzcz0iZml4ZWQgaW5zZXQtMCBiZy1pbmRpZ28tNzAwIHotWzk5OV0gZmxleCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcC02IGZhZGUtaW4iPgogICAgICAgICAgICAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctd2hpdGUvMjAgcHgtNCBweS0xIHJvdW5kZWQtZnVsbCBtYi02Ij4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXdoaXRlIHRleHQtc20iPuC4guC5ieC4reC4l+C4teC5iCAke3FJbmRleCArIDF9IC8gJHt0b3RhbFF1ZXN0aW9uc308L3NwYW4+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGgyIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgdGV4dC13aGl0ZSBtYi04IGRyb3Atc2hhZG93LW1kIj7guYPguITguKPguJ7guKPguYnguK3guKHguJXguK3guJo/PC9oMj4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxkaXYgY2xhc3M9InctZnVsbCBtYXgtdy1tZCBzcGFjZS15LTQiPgogICAgICAgICAgICAgICAgJHtsaXN0SFRNTH0KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8YnV0dG9uIGlkPSJjbG9zZS1yZXNwb25kZXItb3ZlcmxheSIgY2xhc3M9Im10LTEyIHRleHQtaW5kaWdvLTIwMCBob3Zlcjp0ZXh0LXdoaXRlIHVuZGVybGluZSB0ZXh0LXNtIHRyYW5zaXRpb24tY29sb3JzIj4KICAgICAgICAgICAgICAgIOC4geC4peC4seC4muC5hOC4m+C4leC4suC4oeC4peC4s+C4lOC4seC4muC4m+C4geC4leC4tAogICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICA8L2Rpdj4KICAgIGA7CgogICAgLy8g4LmB4LiX4Lij4LiBIEhUTUwg4LmA4LiC4LmJ4Liy4LmE4Lib4LmD4LiZIGJvZHkgKOC5gOC4nuC4t+C5iOC4reC5g+C4q+C5ieC4l+C4seC4muC4l+C4uOC4geC4reC4ouC5iOC4suC4hykKICAgIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBtb2RhbEhUTUwpOwoKICAgIC8vIEV2ZW50IExpc3RlbmVycwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlbGVjdC1yZXNwb25kZXItYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWROYW1lID0gYnRuLmRhdGFzZXQubmFtZTsKICAgICAgICAgICAgc3dpdGNoUGxheWVyT25EZXZpY2Uoc2VsZWN0ZWROYW1lLCBnYW1lRGF0YSk7CiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNwb25kZXItc2VsZWN0aW9uLW92ZXJsYXknKS5yZW1vdmUoKTsKICAgICAgICB9KTsKICAgIH0pOwoKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZS1yZXNwb25kZXItb3ZlcmxheScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNwb25kZXItc2VsZWN0aW9uLW92ZXJsYXknKS5yZW1vdmUoKTsKICAgIH0pOwp9CgovKioKICogW+C5g+C4q+C4oeC5iF0g4Liq4Lil4Lix4LiaIEluZGV4IOC4guC4reC4h+C4nOC4ueC5ieC5gOC4peC5iOC4meC5g+C4meC5gOC4hOC4o+C4t+C5iOC4reC4hyDguYHguKXguLDguKrguLHguYjguIcgUmVuZGVyIOC5g+C4q+C4oeC5iAogKi8KZnVuY3Rpb24gc3dpdGNoUGxheWVyT25EZXZpY2Uoc2VsZWN0ZWROYW1lLCBnYW1lRGF0YSkgewogICAgY29uc3QgbmV3SW5kZXggPSBsb2NhbFRlYW1QbGF5ZXJzLmluZGV4T2Yoc2VsZWN0ZWROYW1lKTsKICAgIGlmIChuZXdJbmRleCAhPT0gLTEpIHsKICAgICAgICBsb2NhbFBsYXllclR1cm5JbmRleCA9IG5ld0luZGV4OwogICAgICAgIC8vIOC5gOC4o+C4teC4ouC4gSByZW5kZXIg4LmD4Lir4Lih4LmI4LiX4Lix4LiZ4LiX4Li1CiAgICAgICAgcmVuZGVyU3R1ZGVudFN5bmNRdWVzdGlvblZpZXcoZ2FtZURhdGEpOwogICAgfQp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVTeW5jQW5zd2VyU3VibWl0KGFuc3dlclZhbHVlLCBxdWVzdGlvbiwgZ2FtZURhdGEsIHBsYXllck5hbWUsIGlzQ29uZmlkZW50LCB3YWdlckFtb3VudCA9IDApIHsKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5saXZlLWFuc3dlci1idG4sICNzeW5jLXN1Ym1pdC1idG4nKS5mb3JFYWNoKGIgPT4gYi5kaXNhYmxlZCA9IHRydWUpOwoKICAgIGNvbnN0IHFJbmRleCA9IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4OwogICAgY29uc3QgcGxheWVyRGF0YSA9IGdhbWVEYXRhLnBsYXllcnNbcGxheWVyTmFtZV0gfHwge307IAogICAgY29uc3QgaXNPbmV0TW9kZSA9IGdhbWVEYXRhLmlzT25ldE1vZGUgPT09IHRydWU7CgogICAgY29uc3QgcXVlc3Rpb25UeXBlID0gcXVlc3Rpb24ucXVlc3Rpb25UeXBlIHx8IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWl6VHlwZTsKICAgIGxldCBpc0NvcnJlY3QgPSBmYWxzZTsKICAgIGxldCBhbnN3ZXJUZXh0ID0gYW5zd2VyVmFsdWU7CgogICAgLy8g4LiV4Lij4Lin4LiI4LiE4Liz4LiV4Lit4LiaICjguYDguKvguKHguLfguK3guJnguYDguJTguLTguKEpCiAgICBzd2l0Y2gocXVlc3Rpb25UeXBlKSB7CiAgICAgICAgY2FzZSAndHJ1ZV9mYWxzZSc6CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckluZGV4VEYgPSBwYXJzZUludChhbnN3ZXJWYWx1ZSk7IAogICAgICAgICAgICBjb25zdCBjb3JyZWN0Qm9vbCA9IChxdWVzdGlvbi5jb3JyZWN0QW5zd2VyID09PSB0cnVlIHx8IFN0cmluZyhxdWVzdGlvbi5jb3JyZWN0QW5zd2VyKS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZScpOwogICAgICAgICAgICBpc0NvcnJlY3QgPSAoYW5zd2VySW5kZXhURiA9PT0gMCAmJiBjb3JyZWN0Qm9vbCkgfHwgKGFuc3dlckluZGV4VEYgPT09IDEgJiYgIWNvcnJlY3RCb29sKTsKICAgICAgICAgICAgYW5zd2VyVGV4dCA9IChhbnN3ZXJJbmRleFRGID09PSAwKSA/ICfguYPguIrguYggLyDguJbguLnguIEnIDogJ+C5hOC4oeC5iOC5g+C4iuC5iCAvIOC4nOC4tOC4lCc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ3Nob3J0X2Fuc3dlcic6CiAgICAgICAgY2FzZSAnZmlsbF9pbl9ub19jaG9pY2VzJzoKICAgICAgICAgICAgaXNDb3JyZWN0ID0gYXdhaXQgZ3JhZGVTaG9ydEFuc3dlcihhbnN3ZXJWYWx1ZSwgcXVlc3Rpb24pOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtYXRjaGluZ19pdGVtJzoKICAgICAgICAgICAgaXNDb3JyZWN0ID0gKGFuc3dlclZhbHVlID09PSBxdWVzdGlvbi5jb3JyZWN0UmVzcG9uc2UpOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtdWx0aXBsZV9jaG9pY2UnOgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnN0IGFuc3dlckluZGV4TUMgPSBwYXJzZUludChhbnN3ZXJWYWx1ZSk7CiAgICAgICAgICAgIGlzQ29ycmVjdCA9IChhbnN3ZXJJbmRleE1DID09PSBxdWVzdGlvbi5jb3JyZWN0QW5zd2VySW5kZXgpOwogICAgICAgICAgICBpZiAocXVlc3Rpb24ub3B0aW9ucyAmJiBxdWVzdGlvbi5vcHRpb25zW2Fuc3dlckluZGV4TUNdKSBhbnN3ZXJUZXh0ID0gcXVlc3Rpb24ub3B0aW9uc1thbnN3ZXJJbmRleE1DXTsKICAgICAgICAgICAgYnJlYWs7CiAgICB9CgogICAgLy8gLS0tIFtMT0dJQyDguIHguLLguKPguYPguKvguYnguITguLDguYHguJnguJnguYPguKvguKHguYhdIC0tLQogICAgbGV0IHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IDA7CiAgICBsZXQgYmFzZVN0cmVhayA9IHBsYXllckRhdGEuY29ycmVjdFN0cmVhayB8fCAwOwogICAgbGV0IG5ld1N0cmVhayA9IDA7CgogICAgLy8gMS4g4Lir4Liy4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LiE4Liw4LmB4LiZ4LiZ4LiC4Lit4LiH4LiC4LmJ4Lit4LiZ4Li14LmJCiAgICBjb25zdCB3ZWlnaHQgPSBnZXRRdWVzdGlvbldlaWdodChnYW1lRGF0YS5zaHVmZmxlZFF1aXosIHF1ZXN0aW9uVHlwZSk7CgogICAgLy8gMi4g4LiV4Lij4Lin4LiI4Liq4Lit4Lia4Liq4LiW4Liy4LiZ4Liw4LiV4LmI4Liy4LiH4LmGIChQb3dlcnVwcywgV2FnZXIsIGV0Yy4pCiAgICAvLyBPLU5FVCBNb2RlIOC4iOC4sOC5hOC4oeC5iOC4oeC4tSBQb3dlcnVwcyDguYHguJXguYjguKHguLUgV2FnZXIvQ29uZmlkZW5jZSDguYTguJTguYkKICAgIGNvbnN0IGZsYWdOYW1lID0gYHBvd2VydXBVc2VkX3Eke3FJbmRleH1fcCR7cGxheWVyTmFtZX1gOwogICAgY29uc3QgYWN0aXZlUG93ZXJ1cCA9IGlzT25ldE1vZGUgPyBudWxsIDogc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShmbGFnTmFtZSk7IC8vIE8tTkVUIOC5hOC4oeC5iOC4oeC4tSBpdGVtCiAgICBjb25zdCBpc1dhZ2VyTW9kZSA9IGFjdGl2ZVBvd2VydXAgPT09ICd3YWdlck11bHRpcGxpZXInIHx8IChpc09uZXRNb2RlICYmIHBhcnNlSW50KHdhZ2VyQW1vdW50KSA+IDApOyAvLyBPLU5FVCDguYDguJTguLTguKHguJ7guLHguJnguYTguJTguYkKICAgIAogICAgLy8gTG9naWMg4LiX4Lix4LmI4Lin4LmE4LibCiAgICBjb25zdCBpc0luc3VyYW5jZSA9ICFpc09uZXRNb2RlICYmIGFjdGl2ZVBvd2VydXAgPT09ICdpbnN1cmFuY2UnOwogICAgY29uc3QgaXNQb2xsID0gIWlzT25ldE1vZGUgJiYgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgncG9sbFVzZWRUaGlzVHVybicpID09PSAndHJ1ZSc7CiAgICBjb25zdCBpc0ppbnhlZCA9ICFpc09uZXRNb2RlICYmIChwbGF5ZXJEYXRhLmlzSmlueGVkID09PSB0cnVlKTsKICAgIGNvbnN0IGlzRm9yY2VkID0gIWlzT25ldE1vZGUgJiYgKHBsYXllckRhdGEuaXNGb3JjZWRDb25maWRlbnQgPT09IHRydWUpOwoKICAgIGlmIChhY3RpdmVQb3dlcnVwICYmIGFjdGl2ZVBvd2VydXAgIT09ICd3YWdlck11bHRpcGxpZXInKSBiYXNlU3RyZWFrID0gMDsKICAgIGNvbnN0IGlzRmlyZUFjdGl2ZSA9IGJhc2VTdHJlYWsgPj0gMzsgCgogICAgLy8gLS0tIOC4hOC4s+C4meC4p+C4kyBQb2ludHMgKOC5g+C4iuC5iSBMb2dpYyDguYDguJTguLXguKLguKfguIHguLHguJrguYLguKvguKHguJTguJvguIHguJXguLQpIC0tLQogICAgaWYgKGlzV2FnZXJNb2RlKSB7CiAgICAgICAgY29uc3QgYmV0QW1vdW50ID0gcGFyc2VJbnQod2FnZXJBbW91bnQsIDEwKSB8fCAwOwogICAgICAgIC8vIOC5gOC4lOC4tOC4oeC4nuC4seC4mTog4LiW4Li54LiB4LmE4LiU4LmJ4LmA4Lie4Li04LmI4LihIDIg4LmA4LiX4LmI4Liy4LiC4Lit4LiH4LmA4LiH4Li04LiZLCDguJzguLTguJTguYDguKrguLXguKLguYDguIfguLTguJnguYDguJTguLTguKHguJ7guLHguJkKICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSBpc0NvcnJlY3QgPyAoYmV0QW1vdW50ICogMikgOiAtYmV0QW1vdW50OwogICAgCiAgICB9IGVsc2UgaWYgKGlzUG9sbCAmJiAhaXNDb3JyZWN0KSB7CiAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gKGlzQ29uZmlkZW50IHx8IGlzRm9yY2VkKSA/IC0od2VpZ2h0ICogNCkgOiAtKHdlaWdodCAqIDIpOyAvLyDguJvguKPguLHguJogcGVuYWx0eSDguJXguLLguKHguJnguYnguLPguKvguJnguLHguIEKICAgIAogICAgfSBlbHNlIGlmIChpc0ZvcmNlZCkgewogICAgICAgIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IGlzQ29ycmVjdCA/ICh3ZWlnaHQgKiAyKSA6IC13ZWlnaHQ7CiAgICAKICAgIH0gZWxzZSBpZiAoZ2FtZURhdGEuaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQpIHsKICAgICAgICAvLyDguYPguIrguYnguKrguLnguJXguKMgUmF0aW86CiAgICAgICAgLy8g4LiW4Li54LiBK+C4oeC4seC5iOC4meC5g+C4iCA9IOC4meC5ieC4s+C4q+C4meC4seC4gSAqIDIKICAgICAgICAvLyDguJbguLnguIEr4LmE4Lih4LmI4Lih4Lix4LmI4LiZ4LmD4LiIID0g4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiBICogMQogICAgICAgIC8vIOC4nOC4tOC4lCvguKHguLHguYjguJnguYPguIggPSDguJnguYnguLPguKvguJnguLHguIEgKiAtMQogICAgICAgIC8vIOC4nOC4tOC4lCvguYTguKHguYjguKHguLHguYjguJnguYPguIggPSAwCiAgICAgICAgaWYgKGlzQ29ycmVjdCkgewogICAgICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSBpc0NvbmZpZGVudCA/ICh3ZWlnaHQgKiAyKSA6IHdlaWdodDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPSBpc0NvbmZpZGVudCA/IC13ZWlnaHQgOiAwOwogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgLy8g4LmC4Lir4Lih4LiU4LiY4Lij4Lij4Lih4LiU4LiyICjguYTguKHguYjguYDguJvguLTguJTguITguKfguLLguKHguKHguLHguYjguJnguYPguIgpCiAgICAgICAgcG9pbnRzRm9yVGhpc1F1ZXN0aW9uID0gaXNDb3JyZWN0ID8gd2VpZ2h0IDogMDsKICAgIH0KCiAgICAvLyBFZmZlY3Qg4Lie4Li04LmA4Lio4LipICjguJvguLTguJTguYPguJkgTy1ORVQpCiAgICBpZiAoIWlzT25ldE1vZGUpIHsKICAgICAgICBpZiAoaXNGaXJlQWN0aXZlICYmIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA+IDApIHBvaW50c0ZvclRoaXNRdWVzdGlvbiAqPSAyOyAKICAgICAgICBpZiAoaXNKaW54ZWQgJiYgIWlzQ29ycmVjdCAmJiBwb2ludHNGb3JUaGlzUXVlc3Rpb24gPCAwKSBwb2ludHNGb3JUaGlzUXVlc3Rpb24gKj0gMjsgCiAgICAgICAgaWYgKCFpc0NvcnJlY3QgJiYgaXNJbnN1cmFuY2UpIHBvaW50c0ZvclRoaXNRdWVzdGlvbiA9IDA7CiAgICB9CgogICAgY29uc3QgaXNDb21ib0JyZWFrZXIgPSBhY3RpdmVQb3dlcnVwICYmIGFjdGl2ZVBvd2VydXAgIT09ICd3YWdlck11bHRpcGxpZXInOwogICAgaWYgKGlzQ29ycmVjdCkgbmV3U3RyZWFrID0gaXNDb21ib0JyZWFrZXIgPyAwIDogKGJhc2VTdHJlYWsgKyAxKTsKCiAgICAvLyDguKrguKPguYnguLLguIcgT2JqZWN0IOC4muC4seC4meC4l+C4tuC4gQogICAgY29uc3QgYW5zd2VyUmVjb3JkID0gewogICAgICAgIHF1ZXN0aW9uSW5kZXg6IHFJbmRleCwKICAgICAgICBxdWVzdGlvbklkOiBxdWVzdGlvbi5pZCwKICAgICAgICBhbnN3ZXI6IGFuc3dlclZhbHVlLCAKICAgICAgICBhbnN3ZXJUZXh0OiBhbnN3ZXJUZXh0LAogICAgICAgIGlzQ29ycmVjdDogaXNDb3JyZWN0LAogICAgICAgIG9yaWdpbmFsUXVlc3Rpb25UZXh0OiBxdWVzdGlvbi5xdWVzdGlvblRleHQgfHwgcXVlc3Rpb24uc3RlbSwKICAgICAgICB3YXNDb25maWRlbnQ6IGlzQ29uZmlkZW50IHx8IGZhbHNlLAogICAgICAgIHBvaW50c0F3YXJkZWQ6IHBvaW50c0ZvclRoaXNRdWVzdGlvbiwKICAgICAgICBwb3dlcnVwVXNlZDogYWN0aXZlUG93ZXJ1cCwKICAgICAgICB3YWdlckFtb3VudDogcGFyc2VJbnQod2FnZXJBbW91bnQsIDEwKSB8fCAwLAogICAgICAgIAogICAgICAgIHdhc0ppbnhlZDogaXNKaW54ZWQsCiAgICAgICAgd2FzRm9yY2VkOiBpc0ZvcmNlZCwKICAgICAgICB1c2VkUG9sbDogaXNQb2xsLAogICAgICAgIHVzZWRCdXlUaW1lOiAhaXNPbmV0TW9kZSAmJiAoKHBsYXllckRhdGEudGltZUJvbnVzVGhpc1F1ZXN0aW9uIHx8IDApID4gMCksCiAgICAgICAgc3RyZWFrQWN0aXZlOiAhaXNPbmV0TW9kZSAmJiAoYmFzZVN0cmVhayA+PSAzKQogICAgfTsKCiAgICBjb25zdCBwbGF5ZXJSZWYgPSBkb2MoZGIsIGBhcnRpZmFjdHMvJHthcHBJZH0vcHVibGljL2RhdGEvc3luY0dhbWVzLyR7Y3VycmVudExpdmVHYW1lSWR9L3BsYXllcnNgLCBwbGF5ZXJOYW1lKTsKICAgIGNvbnN0IGV4aXN0aW5nQW5zd2VycyA9IHBsYXllckRhdGEuYW5zd2VycyB8fCBbXTsKICAgIGNvbnN0IG90aGVyQW5zd2VycyA9IGV4aXN0aW5nQW5zd2Vycy5maWx0ZXIoYW5zID0+IGFucy5xdWVzdGlvbkluZGV4ICE9PSBxSW5kZXgpOwogICAgY29uc3QgbmV3QW5zd2Vyc0FycmF5ID0gWy4uLm90aGVyQW5zd2VycywgYW5zd2VyUmVjb3JkXTsKICAgIAogICAgLy8g4LiE4Liz4LiZ4Lin4LiT4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4Lij4Lin4Lih4LmD4Lir4Lih4LmIIChSYXcgU2NvcmUgPSBTdW0gb2YgV2VpZ2h0cyBvZiBjb3JyZWN0IGFuc3dlcnMpCiAgICBsZXQgbmV3UmF3U2NvcmUgPSAwOwogICAgbmV3QW5zd2Vyc0FycmF5LmZvckVhY2goYW5zID0+IHsKICAgICAgICBpZiAoYW5zLmlzQ29ycmVjdCkgewogICAgICAgICAgICAvLyDguJXguYnguK3guIfguKvguLLguITguLPguJbguLLguKHguILguK3guIcgYW5zIOC4meC4seC5ieC4meC5hiDguYDguJ7guLfguYjguK3guKPguLnguYnguJnguYnguLPguKvguJnguLHguIEKICAgICAgICAgICAgY29uc3QgcU9iaiA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnNbYW5zLnF1ZXN0aW9uSW5kZXhdOwogICAgICAgICAgICBpZiAocU9iaikgewogICAgICAgICAgICAgICAgY29uc3QgdyA9IGdldFF1ZXN0aW9uV2VpZ2h0KGdhbWVEYXRhLnNodWZmbGVkUXVpeiwgcU9iai5xdWVzdGlvblR5cGUgfHwgZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1aXpUeXBlKTsKICAgICAgICAgICAgICAgIG5ld1Jhd1Njb3JlICs9IHc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBuZXdSYXdTY29yZSArPSAxOyAvLyBGYWxsYmFjawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgogICAgY29uc3QgdXBkYXRlUGF5bG9hZCA9IHsKICAgICAgICBhbnN3ZXJzOiBuZXdBbnN3ZXJzQXJyYXksCiAgICAgICAgc2NvcmU6IG5ld1Jhd1Njb3JlLCAvLyDguJrguLHguJnguJfguLbguIHguYDguJvguYfguJnguITguLDguYHguJnguJnguJXguLLguKHguJnguYnguLPguKvguJnguLHguIEKICAgICAgICB0b3RhbFBvaW50czogaW5jcmVtZW50KHBvaW50c0ZvclRoaXNRdWVzdGlvbiksCiAgICAgICAgYW5zd2VyZWQ6IHRydWUsCiAgICAgICAgbGFzdEFuc3dlckluZGV4OiAocXVlc3Rpb25UeXBlID09PSAnbXVsdGlwbGVfY2hvaWNlJyB8fCBxdWVzdGlvblR5cGUgPT09ICd0cnVlX2ZhbHNlJykgPyBwYXJzZUludChhbnN3ZXJWYWx1ZSkgOiBudWxsLAogICAgICAgIGxhc3RBbnN3ZXJWYWx1ZTogYW5zd2VyVGV4dCwKICAgICAgICBpc0ppbnhlZDogZmFsc2UsIGlzRm9yY2VkQ29uZmlkZW50OiBmYWxzZSwgdGltZUJvbnVzVGhpc1F1ZXN0aW9uOiAwLAogICAgICAgIGNvcnJlY3RTdHJlYWs6IG5ld1N0cmVhawogICAgfTsKCiAgICBpZiAoIWlzT25ldE1vZGUgJiYgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSgnb25TZWNvbmRDaGFuY2UnKSA9PT0gJ3RydWUnKSB7CiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbSgnb25TZWNvbmRDaGFuY2UnKTsKICAgIH0KICAgIAogICAgdHJ5IHsKICAgICAgICBhd2FpdCB1cGRhdGVEb2MocGxheWVyUmVmLCB1cGRhdGVQYXlsb2FkKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igc3VibWl0dGluZyBhbnN3ZXI6IiwgZXJyb3IpOwogICAgICAgIHNob3dNZXNzYWdlKCLguKrguYjguIfguITguLPguJXguK3guJrguYTguKHguYjguKrguLPguYDguKPguYfguIgg4LiB4Lij4Li44LiT4Liy4Lil4Lit4LiH4LmD4Lir4Lih4LmIIik7CiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpdmUtYW5zd2VyLWJ0biwgI3N5bmMtc3VibWl0LWJ0bicpLmZvckVhY2goYiA9PiBiLmRpc2FibGVkID0gZmFsc2UpOwogICAgfQp9CgkKCWNvbnN0IGFsbE1hcmtldEl0ZW1zID0gWwogICAgLy8gLS0tIFRpZXIgMTogVXRpbGl0aWVzICjguYTguK3guYDguJfguYfguKHguJ7guLfguYnguJnguJDguLLguJkpIC0tLQogICAgeyBpZDogJ2J1eVRpbWUnLCBuYW1lOiAn4o+zIOC4i+C4t+C5ieC4reC5gOC4p+C4peC4sicsIHByaWNlOiAxLCBkZXNjOiAn4LmA4Lie4Li04LmI4Lih4LmA4Lin4Lil4LiyICsyNSUg4LiC4Lit4LiH4LmA4Lin4Lil4Liy4LmA4Lij4Li04LmI4Lih4LiV4LmJ4LiZ4LmD4LiZ4LiC4LmJ4Lit4LiZ4Li14LmJICjguKrguLPguKvguKPguLHguJrguITguLjguJMpJyB9LAogICAgeyBpZDogJ2N1dE9uZScsIG5hbWU6ICfinILvuI8g4LiV4Lix4LiUIDEg4LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBJywgcHJpY2U6IDIsIGRlc2M6ICfguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIHguJfguLXguYggIuC4nOC4tOC4lCIg4Lit4Lit4LiBIDEg4LiC4LmJ4LitJyB9LAoKICAgIC8vIC0tLSBUaWVyIDI6IFN0cmF0ZWdpYyAo4LmE4Lit4LmA4LiX4LmH4Lih4LmA4LiK4Li04LiH4LiB4Lil4Lii4Li44LiX4LiY4LmMKSAtLS0KICAgIHsgaWQ6ICdmaWZ0eUZpZnR5JywgbmFtZTogJ/CfjJcgNTA6NTAnLCBwcmljZTogNSwgZGVzYzogJ+C4leC4seC4lOC4leC4seC4p+C5gOC4peC4t+C4reC4geC4l+C4teC5iCAi4Lic4Li04LiUIiDguK3guK3guIEgMiDguILguYnguK0gKOC5gOC4q+C4peC4t+C4rSAxIOC4luC4ueC4gSAxIOC4nOC4tOC4lCknIH0sCgogICAgLy8gLS0tIFRpZXIgMzogR2FtZSBDaGFuZ2VycyAo4LmE4Lit4LmA4LiX4LmH4Lih4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LmA4LiB4LihKSAtLS0KICAgIHsgaWQ6ICdzZWNvbmRDaGFuY2UnLCBuYW1lOiAn8J+UgSDguYLguK3guIHguLLguKrguITguKPguLHguYnguIfguJfguLXguYjguKrguK3guIcnLCBwcmljZTogNywgZGVzYzogJ+C4luC5ieC4suC4hOC4uOC4k+C4leC4reC4muC4guC5ieC4reC4meC4teC5ieC4nOC4tOC4lCDguITguLjguJPguIjguLDguYTguJTguYnguYDguKXguLfguK3guIHguJXguK3guJrguK3guLXguIEgMSDguITguKPguLHguYnguIcnIH0sCgkKICAgIC8vIFvguYDguJ7guLTguYjguKHguYPguKvguKHguYhdCgl7IGlkOiAncmV2ZWFsT3B0aW9ucycsIG5hbWU6ICfwn5GB77iPIOC5gOC4nOC4ouC4leC4seC4p+C5gOC4peC4t+C4reC4gScsIHByaWNlOiAxMiwgZGVzYzogJ+C5gOC4m+C4peC4teC5iOC4ouC4meC5guC4iOC4l+C4ouC5jOC5gOC4leC4tOC4oeC4hOC4syDguYPguKvguYnguIHguKXguLLguKLguYDguJvguYfguJnguYHguJrguJrguYDguKXguLfguK3guIHguJXguK3guJogKOC5gOC4ieC4nuC4suC4sOC4guC5ieC4reC4l+C4teC5iOC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4geC4i+C5iOC4reC4meC4reC4ouC4ueC5iCknIH0KXTsKCmZ1bmN0aW9uIG9wZW5CbGFja01hcmtldChnYW1lRGF0YSwgcGxheWVyRGF0YSkgewogICAgbGV0IG1hcmtldFRpbWVyID0gbnVsbDsKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsYWNrLW1hcmtldC1tb2RhbCcpOwogICAgY29uc3QgbGlzdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmtldC1pdGVtLWxpc3QnKTsKICAgIGNvbnN0IHBvaW50c0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcmtldC1jdXJyZW50LXBvaW50cycpOwogICAgY29uc3QgdGltZXJCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFya2V0LXRpbWVyLWJhcicpOwogICAgCiAgICBjb25zdCBwbGF5ZXJQb2ludHMgPSBwbGF5ZXJEYXRhLnRvdGFsUG9pbnRzIHx8IDA7CiAgICBwb2ludHNFbC50ZXh0Q29udGVudCA9IHBsYXllclBvaW50czsKICAgIAogICAgLy8gWzFdIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4hOC4s+C4luC4suC4oeC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4oeC4suC4leC4o+C4p+C4iOC4quC4reC4mgogICAgY29uc3QgcUluZGV4ID0gZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXg7CiAgICBjb25zdCBjdXJyZW50UXVlc3Rpb24gPSBnYW1lRGF0YS5zaHVmZmxlZFF1aXoucXVlc3Rpb25zW3FJbmRleF07CiAgICBjb25zdCBxVHlwZSA9IGN1cnJlbnRRdWVzdGlvbi5xdWVzdGlvblR5cGUgfHwgZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1aXpUeXBlOyAvLyDguJTguLbguIfguJvguKPguLDguYDguKDguJfguITguLPguJbguLLguKEKICAgIAogICAgLy8gWzJdIOC4leC4o+C4p+C4iOC4quC4reC4muC4p+C5iOC4suC4oeC4teC4geC4suC4o+C4iOC4seC4muC5gOC4p+C4peC4suC4q+C4o+C4t+C4reC5hOC4oeC5iCAo4Liq4Liz4Lir4Lij4Lix4LiaIEJ1eSBUaW1lKQogICAgY29uc3QgaXNUaW1lckFjdGl2ZSA9IGdhbWVEYXRhLnRpbWVyTW9kZSA9PT0gJ3Blcl9xdWVzdGlvbic7CgogICAgY29uc3QgaXRlbXNGb3JTYWxlID0gYWxsTWFya2V0SXRlbXM7IAogICAgCiAgICBsaXN0RWwuaW5uZXJIVE1MID0gaXRlbXNGb3JTYWxlLm1hcChpdGVtID0+IHsKICAgICAgICBjb25zdCBoYXNFbm91Z2hQb2ludHMgPSBwbGF5ZXJQb2ludHMgPj0gaXRlbS5wcmljZTsKICAgICAgICAKICAgICAgICAvLyA9PT0gMS4gTG9naWMg4Liq4Liz4Lir4Lij4Lix4Lia4LiB4Liy4Lij4LiL4Li34LmJ4Lit4LmA4Lin4Lil4LiyIChCdXkgVGltZSkgPT09CiAgICAgICAgaWYgKGl0ZW0uaWQgPT09ICdidXlUaW1lJykgewogICAgICAgICAgICBjb25zdCBtYXhCdXlhYmxlID0gaGFzRW5vdWdoUG9pbnRzID8gTWF0aC5mbG9vcihwbGF5ZXJQb2ludHMgLyBpdGVtLnByaWNlKSA6IDA7CiAgICAgICAgICAgIGNvbnN0IGNhbkJ1eUF0QWxsID0gaGFzRW5vdWdoUG9pbnRzICYmIGlzVGltZXJBY3RpdmU7CiAgICAgICAgICAgIAogICAgICAgICAgICBsZXQgYnRuVGV4dCA9IGDguIvguLfguYnguK0gKCR7aXRlbS5wcmljZX1QL+C4reC4seC4mSlgOwogICAgICAgICAgICBsZXQgYnRuQ2xhc3MgPSBjYW5CdXlBdEFsbCA/ICdiZy1pbmRpZ28tNjAwIGhvdmVyOmJnLWluZGlnby03MDAnIDogJ2JnLWdyYXktNDAwJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghaXNUaW1lckFjdGl2ZSkgewogICAgICAgICAgICAgICAgYnRuVGV4dCA9ICc8aSBjbGFzcz0iZmFzIGZhLWJhbiI+PC9pPiDguYTguKHguYjguYTguJTguYnguIjguLHguJrguYDguKfguKXguLInOwogICAgICAgICAgICAgICAgYnRuQ2xhc3MgPSAnYmctZ3JheS0zMDAgdGV4dC1ncmF5LTUwMCBjdXJzb3Itbm90LWFsbG93ZWQgYm9yZGVyIGJvcmRlci1ncmF5LTMwMCc7IAogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYAogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcC0zIGJvcmRlciByb3VuZGVkLWxnICR7IWNhbkJ1eUF0QWxsID8gJ2JnLWdyYXktMTAwIG9wYWNpdHktNzAnIDogJ2JnLXdoaXRlJ30iPgogICAgICAgICAgICAgICAgPGRpdj4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktODAwIj4ke2l0ZW0ubmFtZX08L3A+CiAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+JHtpdGVtLmRlc2N9PC9wPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBzaHJpbmstMCI+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9Im51bWJlciIgaWQ9ImJ1eS10aW1lLXF1YW50aXR5LWlucHV0IiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9InctMTYgcC0yIGJvcmRlciBib3JkZXItZ3JheS0zMDAgcm91bmRlZC1sZyB0ZXh0LXNtIHRleHQtY2VudGVyIiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9IjEiIG1pbj0iMSIgbWF4PSIke21heEJ1eWFibGV9IiAkeyFjYW5CdXlBdEFsbCA/ICdkaXNhYmxlZCcgOiAnJ30+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiAKICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImJ1eS10aW1lLWNvbmZpcm0tYnRuIHRleHQtd2hpdGUgZm9udC1zZW1pYm9sZCBweS0yIHB4LTQgcm91bmRlZC1sZyB0ZXh0LXNtICR7YnRuQ2xhc3N9IgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhLWl0ZW0taWQ9IiR7aXRlbS5pZH0iCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEtcHJpY2U9IiR7aXRlbS5wcmljZX0iCiAgICAgICAgICAgICAgICAgICAgICAgICR7IWNhbkJ1eUF0QWxsID8gJ2Rpc2FibGVkJyA6ICcnfT4KICAgICAgICAgICAgICAgICAgICAgICAgJHtidG5UZXh0fQogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgIH0gCiAgICAgICAgLy8gPT09IDIuIExvZ2ljIOC4quC4s+C4q+C4o+C4seC4muC5hOC4reC5gOC4l+C4oeC4l+C4seC5iOC4p+C5hOC4myA9PT0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbGV0IGlzRGlzYWJsZWQgPSAhaGFzRW5vdWdoUG9pbnRzOwogICAgICAgICAgICBsZXQgYnRuQ2xhc3MgPSBoYXNFbm91Z2hQb2ludHMgPyAnYmctaW5kaWdvLTYwMCBob3ZlcjpiZy1pbmRpZ28tNzAwJyA6ICdiZy1ncmF5LTQwMCc7CiAgICAgICAgICAgIGxldCBidG5UZXh0ID0gYOC4i+C4t+C5ieC4rSAoJHtpdGVtLnByaWNlfVApYDsKCiAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBMb2dpYzog4LmB4LiK4LmI4LmB4LiC4LmH4LiHICLguYDguJzguKLguJXguLHguKfguYDguKXguLfguK3guIEiICjguJbguYnguLLguYTguKHguYjguKHguLXguJXguLHguKfguYDguKXguLfguK3guIHguYPguKvguYnguYDguJzguKIpIOKWvOKWvOKWvAogICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gJ3JldmVhbE9wdGlvbnMnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBoYXNIaWRkZW5PcHRpb25zID0gY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMgJiYgY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMubGVuZ3RoID4gMDsKICAgICAgICAgICAgICAgIGNvbnN0IGlzRmlsbEluVHlwZSA9IChxVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcVR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKCFoYXNIaWRkZW5PcHRpb25zIHx8ICFpc0ZpbGxJblR5cGUpIHsKICAgICAgICAgICAgICAgICAgICBpc0Rpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBidG5DbGFzcyA9ICdiZy1ncmF5LTMwMCB0ZXh0LWdyYXktNTAwIGN1cnNvci1ub3QtYWxsb3dlZCBib3JkZXIgYm9yZGVyLWdyYXktMzAwJzsKICAgICAgICAgICAgICAgICAgICBidG5UZXh0ID0gJzxpIGNsYXNzPSJmYXMgZmEtYmFuIj48L2k+IOC5g+C4iuC5ieC5hOC4oeC5iOC5hOC4lOC5iSc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOKWvOKWvOKWvCBMb2dpYzog4LmB4LiK4LmI4LmB4LiC4LmH4LiHICLguJXguLHguJTguJXguLHguKfguYDguKXguLfguK3guIEiIOC5geC4peC4sCAiNTA6NTAiICjguJbguYnguLLguYDguJvguYfguJnguYLguIjguJfguKLguYzguYDguJXguLTguKHguITguLMpIOKWvOKWvOKWvAogICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gJ2N1dE9uZScgfHwgaXRlbS5pZCA9PT0gJ2ZpZnR5RmlmdHknKSB7CiAgICAgICAgICAgICAgICAvLyDguJbguYnguLLguYDguJvguYfguJnguYLguIjguJfguKLguYzguJ7guLTguKHguJ7guYzguJXguK3guJog4Lir4Lij4Li34LitIOC5hOC4oeC5iOC4oeC4teC4leC4seC4p+C5gOC4peC4t+C4reC4geC5g+C4meC4guC5ieC4reC4oeC4ueC4pSAtPiDguKvguYnguLLguKHguJXguLHguJQKICAgICAgICAgICAgICAgIGNvbnN0IGlzU2hvcnRBbnN3ZXIgPSAocVR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHFUeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJyk7CiAgICAgICAgICAgICAgICBjb25zdCBoYXNPcHRpb25zID0gY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMgJiYgY3VycmVudFF1ZXN0aW9uLm9wdGlvbnMubGVuZ3RoID4gMDsKCiAgICAgICAgICAgICAgICBpZiAoaXNTaG9ydEFuc3dlciB8fCAhaGFzT3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJ0bkNsYXNzID0gJ2JnLWdyYXktMzAwIHRleHQtZ3JheS01MDAgY3Vyc29yLW5vdC1hbGxvd2VkIGJvcmRlciBib3JkZXItZ3JheS0zMDAnOwogICAgICAgICAgICAgICAgICAgIGJ0blRleHQgPSAnPGkgY2xhc3M9ImZhcyBmYS1iYW4iPjwvaT4g4LmE4Lih4LmI4Lih4Li14LiV4Lix4Lin4LmA4Lil4Li34Lit4LiBJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGAKICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHAtMyBib3JkZXIgcm91bmRlZC1sZyAke2lzRGlzYWJsZWQgPyAnYmctZ3JheS0xMDAgb3BhY2l0eS03MCcgOiAnYmctd2hpdGUnfSI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LXNlbWlib2xkIHRleHQtZ3JheS04MDAiPiR7aXRlbS5uYW1lfTwvcD4KICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIj4ke2l0ZW0uZGVzY308L3A+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxidXR0b24gCiAgICAgICAgICAgICAgICAgICAgY2xhc3M9ImJ1eS1pdGVtLWJ0biB0ZXh0LXdoaXRlIGZvbnQtc2VtaWJvbGQgcHktMiBweC00IHJvdW5kZWQtbGcgdGV4dC1zbSBzaHJpbmstMCAke2J0bkNsYXNzfSIKICAgICAgICAgICAgICAgICAgICBkYXRhLWl0ZW0taWQ9IiR7aXRlbS5pZH0iCiAgICAgICAgICAgICAgICAgICAgZGF0YS1wcmljZT0iJHtpdGVtLnByaWNlfSIKICAgICAgICAgICAgICAgICAgICAke2lzRGlzYWJsZWQgPyAnZGlzYWJsZWQnIDogJyd9PgogICAgICAgICAgICAgICAgICAgICR7YnRuVGV4dH0KICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgYDsKICAgICAgICB9CiAgICB9KS5qb2luKCcnKTsKCiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTsKCiAgICB0aW1lckJhci5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnOwogICAgdGltZXJCYXIuc3R5bGUud2lkdGggPSAnMTAwJSc7CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aW1lckJhci5zdHlsZS50cmFuc2l0aW9uID0gJ3dpZHRoIDYwcyBsaW5lYXInOyAKICAgICAgICB0aW1lckJhci5zdHlsZS53aWR0aCA9ICcwJSc7CiAgICB9LCA1MCk7IAogICAgCiAgICBtYXJrZXRUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOwogICAgfSwgNjAwMDApOyAKCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvc2UtbWFya2V0LWJ0bicpLm9uY2xpY2sgPSAoKSA9PiB7CiAgICAgICAgY2xlYXJUaW1lb3V0KG1hcmtldFRpbWVyKTsKICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgIH07CiAgICAKICAgIGxpc3RFbC5xdWVyeVNlbGVjdG9yQWxsKCcuYnV5LWl0ZW0tYnRuJykuZm9yRWFjaChidG4gPT4gewogICAgICAgIGJ0bi5vbmNsaWNrID0gKGUpID0+IHsKICAgICAgICAgICAgY29uc3QgaXRlbUlkID0gZS50YXJnZXQuZGF0YXNldC5pdGVtSWQ7CiAgICAgICAgICAgIGNvbnN0IHByaWNlID0gcGFyc2VJbnQoZS50YXJnZXQuZGF0YXNldC5wcmljZSwgMTApOwogICAgICAgICAgICBjbGVhclRpbWVvdXQobWFya2V0VGltZXIpOwogICAgICAgICAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICAgICAgaGFuZGxlQnV5SXRlbShwbGF5ZXJEYXRhLm5hbWUsIGl0ZW1JZCwgcHJpY2UsIDEpOyAKICAgICAgICB9OwogICAgfSk7CiAgICAKICAgIGxpc3RFbC5xdWVyeVNlbGVjdG9yQWxsKCcuYnV5LXRpbWUtY29uZmlybS1idG4nKS5mb3JFYWNoKGJ0biA9PiB7CiAgICAgICAgYnRuLm9uY2xpY2sgPSAoZSkgPT4gewogICAgICAgICAgICBjb25zdCBpdGVtSWQgPSBlLnRhcmdldC5kYXRhc2V0Lml0ZW1JZDsKICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LnByaWNlLCAxMCk7CiAgICAgICAgICAgIGNvbnN0IHF1YW50aXR5SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnV5LXRpbWUtcXVhbnRpdHktaW5wdXQnKTsKICAgICAgICAgICAgY29uc3QgcXVhbnRpdHkgPSBwYXJzZUludChxdWFudGl0eUlucHV0LnZhbHVlLCAxMCk7CiAgICAgICAgICAgIGNvbnN0IG1heEJ1eWFibGUgPSBwYXJzZUludChxdWFudGl0eUlucHV0Lm1heCwgMTApOwoKICAgICAgICAgICAgaWYgKCFxdWFudGl0eSB8fCBxdWFudGl0eSA8IDEpIHsKICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKCLguIHguKPguLjguJPguLLguKPguLDguJrguLjguIjguLPguJnguKfguJnguJfguLXguYjguJbguLnguIHguJXguYnguK3guIcgKOC4reC4ouC5iOC4suC4h+C4meC5ieC4reC4oiAxIOC4iuC4tOC5ieC4mSkiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocXVhbnRpdHkgPiBtYXhCdXlhYmxlKSB7CiAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShg4LiE4Li44LiT4Lih4Li1IFBvaW50cyDguYTguKHguYjguJ7guK0gKOC4i+C4t+C5ieC4reC5hOC4lOC5ieC4quC4ueC4h+C4quC4uOC4lCAke21heEJ1eWFibGV9IOC4iuC4tOC5ieC4mSlgKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1hcmtldFRpbWVyKTsKICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7CiAgICAgICAgICAgIGhhbmRsZUJ1eUl0ZW0ocGxheWVyRGF0YS5uYW1lLCBpdGVtSWQsIHByaWNlLCBxdWFudGl0eSk7IAogICAgICAgIH07CiAgICB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQnV5SXRlbShwbGF5ZXJOYW1lLCBpdGVtSWQsIHByaWNlLCBxdWFudGl0eSA9IDEpIHsKICAgIC8vIFvguYHguIHguYnguYTguIJdIOC5gOC4m+C4peC4teC5iOC4ouC4meC5gOC4m+C5ieC4suC4q+C4oeC4suC4ouC5gOC4m+C5h+C4mSBQbGF5ZXIgU3ViY29sbGVjdGlvbgogICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgcGxheWVyTmFtZSk7CiAgICAKICAgIHRyeSB7CiAgICAgICAgYXdhaXQgcnVuVHJhbnNhY3Rpb24oZGIsIGFzeW5jICh0cmFuc2FjdGlvbikgPT4gewogICAgICAgICAgICBjb25zdCBwbGF5ZXJEb2MgPSBhd2FpdCB0cmFuc2FjdGlvbi5nZXQocGxheWVyUmVmKTsKICAgICAgICAgICAgaWYgKCFwbGF5ZXJEb2MuZXhpc3RzKCkpIHRocm93ICLguYTguKHguYjguJ7guJrguILguYnguK3guKHguLnguKXguJzguLnguYnguYDguKXguYjguJkiOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY3VycmVudFBvaW50cyA9IHBsYXllckRvYy5kYXRhKCkudG90YWxQb2ludHMgfHwgMDsKICAgICAgICAgICAgY29uc3QgdG90YWxDb3N0ID0gcHJpY2UgKiBxdWFudGl0eTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChjdXJyZW50UG9pbnRzIDwgdG90YWxDb3N0KSB7CiAgICAgICAgICAgICAgICB0aHJvdyAi4Lih4Li1IFBvaW50cyDguYTguKHguYjguYDguJ7guLXguKLguIfguJ7guK0iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB1cGRhdGVQYXlsb2FkID0ge307CiAgICAgICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4leC4seC4lCBwcmVmaXggJ3BsYXllcnMubmFtZScg4Lit4Lit4LiBCiAgICAgICAgICAgIHVwZGF0ZVBheWxvYWRbYHRvdGFsUG9pbnRzYF0gPSBpbmNyZW1lbnQoLXRvdGFsQ29zdCk7IAogICAgICAgICAgICB1cGRhdGVQYXlsb2FkW2Bwb3dlcnVwcy4ke2l0ZW1JZH1gXSA9IGluY3JlbWVudChxdWFudGl0eSk7IAogICAgICAgICAgICAKICAgICAgICAgICAgdHJhbnNhY3Rpb24udXBkYXRlKHBsYXllclJlZiwgdXBkYXRlUGF5bG9hZCk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgc2hvd01lc3NhZ2UoYOC4i+C4t+C5ieC4rSAiJHtpdGVtSWR9IiB4JHtxdWFudGl0eX0g4Liq4Liz4LmA4Lij4LmH4LiIIWApOwogICAgICAgIAogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJCdXkgSXRlbSBmYWlsZWQ6ICIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSh0eXBlb2YgZXJyb3IgPT09ICdzdHJpbmcnID8gZXJyb3IgOiAi4LmA4LiB4Li04LiU4LiC4LmJ4Lit4Lic4Li04LiU4Lie4Lil4Liy4LiU4LmD4LiZ4LiB4Liy4Lij4LiL4Li34LmJ4LitIik7CiAgICB9Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVBheUZvck1hcmtldEVudHJ5KHBsYXllck5hbWUsIGdhbWVEYXRhLCBwbGF5ZXJEYXRhKSB7CiAgICAvLyBb4LmB4LiB4LmJ4LmE4LiCXSDguYDguJvguKXguLXguYjguKLguJnguYDguJvguYnguLLguKvguKHguLLguKLguYDguJvguYfguJkgUGxheWVyIFN1YmNvbGxlY3Rpb24KICAgIGNvbnN0IHBsYXllclJlZiA9IGRvYyhkYiwgYGFydGlmYWN0cy8ke2FwcElkfS9wdWJsaWMvZGF0YS9zeW5jR2FtZXMvJHtjdXJyZW50TGl2ZUdhbWVJZH0vcGxheWVyc2AsIHBsYXllck5hbWUpOwogICAgCiAgICB0cnkgewogICAgICAgIGF3YWl0IHJ1blRyYW5zYWN0aW9uKGRiLCBhc3luYyAodHJhbnNhY3Rpb24pID0+IHsKICAgICAgICAgICAgY29uc3QgcGxheWVyRG9jID0gYXdhaXQgdHJhbnNhY3Rpb24uZ2V0KHBsYXllclJlZik7CiAgICAgICAgICAgIGlmICghcGxheWVyRG9jLmV4aXN0cygpKSB0aHJvdyAi4LmE4Lih4LmI4Lie4Lia4LiC4LmJ4Lit4Lih4Li54Lil4Lic4Li54LmJ4LmA4Lil4LmI4LiZIjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQb2ludHMgPSBwbGF5ZXJEb2MuZGF0YSgpLnRvdGFsUG9pbnRzIHx8IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY3VycmVudFBvaW50cyA8IDEpIHRocm93ICLguKHguLUgUG9pbnRzIOC5hOC4oeC5iOC5gOC4nuC4teC4ouC4h+C4nuC4rSAo4LiV4LmJ4Lit4LiH4LmD4LiK4LmJIDFQKSI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB1cGRhdGVQYXlsb2FkID0ge307CiAgICAgICAgICAgIC8vIFvguYHguIHguYnguYTguIJdIOC4leC4seC4lCBwcmVmaXggJ3BsYXllcnMubmFtZScg4Lit4Lit4LiBCiAgICAgICAgICAgIHVwZGF0ZVBheWxvYWRbYHRvdGFsUG9pbnRzYF0gPSBpbmNyZW1lbnQoLTEpOyAKICAgICAgICAgICAgdHJhbnNhY3Rpb24udXBkYXRlKHBsYXllclJlZiwgdXBkYXRlUGF5bG9hZCk7CiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc3QgdXBkYXRlZFBsYXllckRhdGEgPSB7IC4uLnBsYXllckRhdGEsIHRvdGFsUG9pbnRzOiAocGxheWVyRGF0YS50b3RhbFBvaW50cyB8fCAwKSAtIDEgfTsKICAgICAgICBvcGVuQmxhY2tNYXJrZXQoZ2FtZURhdGEsIHVwZGF0ZWRQbGF5ZXJEYXRhKTsgCiAgICAgICAgCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIk1hcmtldCBlbnRyeSBwYXltZW50IGZhaWxlZDoiLCBlcnJvcik7CiAgICAgICAgc2hvd01lc3NhZ2UodHlwZW9mIGVycm9yID09PSAnc3RyaW5nJyA/IGVycm9yIDogIuC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lOC5g+C4meC4geC4suC4o+C5gOC4guC5ieC4suC4leC4peC4suC4lOC4oeC4t+C4lCIpOwogICAgfQp9CgovLyAtLS0g4Lij4Liw4Lia4Lia4LmA4Liq4Li14Lii4LiHIChTb3VuZCBFZmZlY3RzKSDguYHguJrguJrguYTguKHguYjguJXguYnguK3guIfguYPguIrguYnguYTguJ/guKXguYwgLS0tCmNvbnN0IGF1ZGlvQ3R4ID0gbmV3ICh3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQpKCk7CgpmdW5jdGlvbiBwbGF5U3lzdGVtU291bmQodHlwZSkgewogICAgLy8g4LiV4LmJ4Lit4LiH4Liq4Lix4LmI4LiHIHJlc3VtZSDguYDguJ7guKPguLLguLDguJrguLLguIcgQnJvd3NlciDguJrguKXguYfguK3guIHguYDguKrguLXguKLguIfguK3guLHguJXguYLguJnguKHguLHguJXguLQKICAgIGlmIChhdWRpb0N0eC5zdGF0ZSA9PT0gJ3N1c3BlbmRlZCcpIGF1ZGlvQ3R4LnJlc3VtZSgpOwogICAgCiAgICBjb25zdCBvc2MgPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICBjb25zdCBnYWluID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwogICAgb3NjLmNvbm5lY3QoZ2Fpbik7CiAgICBnYWluLmNvbm5lY3QoYXVkaW9DdHguZGVzdGluYXRpb24pOwoKICAgIGNvbnN0IG5vdyA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lOwogICAgCiAgICBpZiAodHlwZSA9PT0gJ2NvcnJlY3QnKSB7CiAgICAgICAgLy8g4LmA4Liq4Li14Lii4LiH4LiV4Li04LmK4LiHISAo4Liq4Li54LiH4LmD4LiqKQogICAgICAgIG9zYy50eXBlID0gJ3NpbmUnOwogICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoNjAwLCBub3cpOwogICAgICAgIG9zYy5mcmVxdWVuY3kuZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgxMjAwLCBub3cgKyAwLjEpOwogICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjEsIG5vdyk7IC8vIOC4peC4lOC4hOC4p+C4suC4oeC4lOC4seC4h+C4peC4h+C4q+C4meC5iOC4reC4oiAoMC4xKQogICAgICAgIGdhaW4uZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDEsIG5vdyArIDAuNSk7CiAgICAgICAgb3NjLnN0YXJ0KG5vdyk7CiAgICAgICAgb3NjLnN0b3Aobm93ICsgMC41KTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2luY29ycmVjdCcpIHsKICAgICAgICAvLyDguYDguKrguLXguKLguIfguYHguK3guYrguJQuLi4gKOC4leC5iOC4s+C4l+C4uOC5ieC4oSkKICAgICAgICBvc2MudHlwZSA9ICdzYXd0b290aCc7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5zZXRWYWx1ZUF0VGltZSgxNTAsIG5vdyk7CiAgICAgICAgb3NjLmZyZXF1ZW5jeS5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDEwMCwgbm93ICsgMC4yKTsKICAgICAgICBnYWluLmdhaW4uc2V0VmFsdWVBdFRpbWUoMC4xLCBub3cpOwogICAgICAgIGdhaW4uZ2Fpbi5leHBvbmVudGlhbFJhbXBUb1ZhbHVlQXRUaW1lKDAuMDEsIG5vdyArIDAuMyk7CiAgICAgICAgb3NjLnN0YXJ0KG5vdyk7CiAgICAgICAgb3NjLnN0b3Aobm93ICsgMC4zKTsKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ3Bvd2VydXAnKSB7CiAgICAgICAgLy8g4LmA4Liq4Li14Lii4LiH4Lin4Li04LmJ4LiH4LmGICjguYPguIrguYnguYTguK3guYDguJfguKEpCiAgICAgICAgb3NjLnR5cGUgPSAndHJpYW5nbGUnOwogICAgICAgIG9zYy5mcmVxdWVuY3kuc2V0VmFsdWVBdFRpbWUoMzAwLCBub3cpOwogICAgICAgIG9zYy5mcmVxdWVuY3kubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoNjAwLCBub3cgKyAwLjEpOwogICAgICAgIGdhaW4uZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLjEsIG5vdyk7CiAgICAgICAgZ2Fpbi5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKDAuMDEsIG5vdyArIDAuMyk7CiAgICAgICAgb3NjLnN0YXJ0KG5vdyk7CiAgICAgICAgb3NjLnN0b3Aobm93ICsgMC4zKTsKICAgIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlRW1lcmdlbmN5QW5zd2VyRml4KG5ld0NvcnJlY3RWYWx1ZSwgZ2FtZURhdGEpIHsKICAgIGlmICghY3VycmVudExpdmVHYW1lSWQpIHJldHVybjsKCiAgICBjb25zdCBjdXJyZW50USA9IGdhbWVEYXRhLnNodWZmbGVkUXVpei5xdWVzdGlvbnNbZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXhdOwogICAgY29uc3QgcVR5cGUgPSBjdXJyZW50US5xdWVzdGlvblR5cGUgfHwgZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnF1aXpUeXBlOwogICAgY29uc3QgaXNTaG9ydEFuc3dlciA9IChxVHlwZSA9PT0gJ3Nob3J0X2Fuc3dlcicgfHwgcVR5cGUgPT09ICdmaWxsX2luX25vX2Nob2ljZXMnKTsKCiAgICAvLyDguJXguKPguKfguIjguKrguK3guJrguKfguYjguLLguIvguYnguLPguIHguLHguJrguILguK3guIfguYDguJTguLTguKHguYTguKvguKEKICAgIGlmIChpc1Nob3J0QW5zd2VyKSB7CiAgICAgICAgaWYgKGN1cnJlbnRRLmlkZWFsQW5zd2VyID09PSBuZXdDb3JyZWN0VmFsdWUpIHsgYWxlcnQoIuC4hOC4s+C4leC4reC4muC4meC4teC5ieC5gOC4m+C5h+C4meC5gOC4ieC4peC4ouC4m+C4seC4iOC4iOC4uOC4muC4seC4meC4reC4ouC4ueC5iOC5geC4peC5ieC4p+C4hOC4o+C4seC4miIpOyByZXR1cm47IH0KICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGN1cnJlbnRRLmNvcnJlY3RBbnN3ZXJJbmRleCA9PT0gbmV3Q29ycmVjdFZhbHVlKSB7IGFsZXJ0KCLguITguLPguJXguK3guJrguJnguLXguYnguYDguJvguYfguJnguYDguInguKXguKLguJvguLHguIjguIjguLjguJrguLHguJnguK3guKLguLnguYjguYHguKXguYnguKfguITguKPguLHguJoiKTsgcmV0dXJuOyB9CiAgICB9CgogICAgc2hvd01lc3NhZ2UoIuC4geC4s+C4peC4seC4h+C4hOC4s+C4meC4p+C4k+C5g+C4q+C4oeC5iC4uLiAo4Lib4Lij4Lix4Lia4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4LmB4Lil4LiwIFBvaW50cykg4LiB4Lij4Li44LiT4Liy4Lij4Lit4Liq4Lix4LiB4LiE4Lij4Li54LmIIik7CgogICAgdHJ5IHsKICAgICAgICBjb25zdCBnYW1lUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lc2AsIGN1cnJlbnRMaXZlR2FtZUlkKTsKICAgICAgICBjb25zdCBiYXRjaCA9IHdyaXRlQmF0Y2goZGIpOwoKICAgICAgICAvLyAxLiDguK3guLHguJvguYDguJTguJXguYDguInguKXguKLguYPguJkgUXVpeiDguKvguKXguLHguIEKICAgICAgICBjb25zdCB1cGRhdGVkUXVpeiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZ2FtZURhdGEuc2h1ZmZsZWRRdWl6KSk7CiAgICAgICAgaWYgKGlzU2hvcnRBbnN3ZXIpIHsKICAgICAgICAgICAgdXBkYXRlZFF1aXoucXVlc3Rpb25zW2dhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4XS5pZGVhbEFuc3dlciA9IG5ld0NvcnJlY3RWYWx1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB1cGRhdGVkUXVpei5xdWVzdGlvbnNbZ2FtZURhdGEuY3VycmVudFF1ZXN0aW9uSW5kZXhdLmNvcnJlY3RBbnN3ZXJJbmRleCA9IG5ld0NvcnJlY3RWYWx1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgbGV0IG5ldFBvdENoYW5nZSA9IDA7CgogICAgICAgIC8vIC0tLSBbQV0g4LiU4Li24LiH4LiZ4LmJ4Liz4Lir4LiZ4Lix4LiB4LiE4Liw4LmB4LiZ4LiZIChXZWlnaHQpIC0tLQogICAgICAgIGNvbnN0IHR5cGVTY29yaW5nID0gZ2FtZURhdGEuc2h1ZmZsZWRRdWl6LnNldHRpbmdzPy50eXBlU2NvcmluZyB8fCB7IG1jcTogMSwgc2E6IDEsIHRmOiAxIH07CiAgICAgICAgbGV0IG1heFNjb3JlID0gMTsKICAgICAgICBpZiAocVR5cGUgPT09ICdzaG9ydF9hbnN3ZXInIHx8IHFUeXBlID09PSAnZmlsbF9pbl9ub19jaG9pY2VzJykgbWF4U2NvcmUgPSB0eXBlU2NvcmluZy5zYTsKICAgICAgICBlbHNlIGlmIChxVHlwZSA9PT0gJ3RydWVfZmFsc2UnKSBtYXhTY29yZSA9IHR5cGVTY29yaW5nLnRmOwogICAgICAgIGVsc2UgbWF4U2NvcmUgPSB0eXBlU2NvcmluZy5tY3E7CgogICAgICAgIC8vIDIuIOC4lOC4tuC4h+C4guC5ieC4reC4oeC4ueC4peC4nOC4ueC5ieC5gOC4peC5iOC4mQogICAgICAgIGNvbnN0IHBsYXllcnNSZWYgPSBjb2xsZWN0aW9uKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCk7CiAgICAgICAgY29uc3QgcGxheWVyc1NuYXAgPSBhd2FpdCBnZXREb2NzKHBsYXllcnNSZWYpOwoKICAgICAgICBmb3IgKGNvbnN0IGRvY1NuYXAgb2YgcGxheWVyc1NuYXAuZG9jcykgewogICAgICAgICAgICBjb25zdCBwbGF5ZXIgPSBkb2NTbmFwLmRhdGEoKTsKICAgICAgICAgICAgY29uc3QgcGxheWVyUmVmID0gZG9jKGRiLCBgYXJ0aWZhY3RzLyR7YXBwSWR9L3B1YmxpYy9kYXRhL3N5bmNHYW1lcy8ke2N1cnJlbnRMaXZlR2FtZUlkfS9wbGF5ZXJzYCwgcGxheWVyLm5hbWUpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY3VycmVudEFuc0luZGV4ID0gcGxheWVyLmFuc3dlcnMuZmluZEluZGV4KGEgPT4gYS5xdWVzdGlvbkluZGV4ID09PSBnYW1lRGF0YS5jdXJyZW50UXVlc3Rpb25JbmRleCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY3VycmVudEFuc0luZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgY29uc3QgYW5zRGF0YSA9IHBsYXllci5hbnN3ZXJzW2N1cnJlbnRBbnNJbmRleF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIOC4leC4o+C4p+C4iOC4quC4reC4muC4hOC4s+C4leC4reC4mgogICAgICAgICAgICAgICAgbGV0IG1hdGNoZXNOZXdBbnN3ZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChpc1Nob3J0QW5zd2VyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbW9ja1F1ZXN0aW9uID0geyAuLi5jdXJyZW50USwgaWRlYWxBbnN3ZXI6IG5ld0NvcnJlY3RWYWx1ZSB9OwogICAgICAgICAgICAgICAgICAgIG1hdGNoZXNOZXdBbnN3ZXIgPSBhd2FpdCBncmFkZVNob3J0QW5zd2VyKGFuc0RhdGEuYW5zd2VyVGV4dCB8fCBhbnNEYXRhLmFuc3dlciwgbW9ja1F1ZXN0aW9uKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc05ld0Fuc3dlciA9IChwYXJzZUludChhbnNEYXRhLmFuc3dlcikgPT09IG5ld0NvcnJlY3RWYWx1ZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgaXNHcm91cEEgPSAhYW5zRGF0YS5pc0NvcnJlY3QgJiYgbWF0Y2hlc05ld0Fuc3dlcjsgLy8g4Lic4Li04LiUIC0+IOC4luC4ueC4gQogICAgICAgICAgICAgICAgY29uc3QgaXNHcm91cEMgPSBhbnNEYXRhLmlzQ29ycmVjdCAmJiAhbWF0Y2hlc05ld0Fuc3dlcjsgLy8g4LiW4Li54LiBIC0+IOC4nOC4tOC4lAoKICAgICAgICAgICAgICAgIGxldCBzaG91bGRVcGRhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGxldCBwb2ludEFkanVzdG1lbnQgPSAwOyAgICAgLy8g4Liq4Liz4Lir4Lij4Lix4LiaIEdhbWUgUG9pbnRzCiAgICAgICAgICAgICAgICBsZXQgb25ldEFkanVzdG1lbnQgPSAwOyAgICAgIC8vIOC4quC4s+C4q+C4o+C4seC4miBPLU5FVCAmIFJhdyBTY29yZQogICAgICAgICAgICAgICAgbGV0IG5ld1N0cmVhayA9IHBsYXllci5jb3JyZWN0U3RyZWFrOwogICAgICAgICAgICAgICAgbGV0IG5ld0lzQ29ycmVjdCA9IGFuc0RhdGEuaXNDb3JyZWN0OwoKICAgICAgICAgICAgICAgIC8vIC0tLSDguIHguKPguJPguLXguJfguLXguYggMTog4LmA4Lib4Lil4Li14LmI4Lii4LiZ4LiI4Liy4LiBIOC4nOC4tOC4lCDguYDguJvguYfguJkg4LiW4Li54LiBIC0tLQogICAgICAgICAgICAgICAgaWYgKGlzR3JvdXBBKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdWxkVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBuZXdJc0NvcnJlY3QgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAvLyBTdHJlYWsKICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdG9yZWRTdHJlYWsgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBwbGF5ZXIuYW5zd2Vycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gcGxheWVyLmFuc3dlcnNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhLnF1ZXN0aW9uSW5kZXggPT09IGdhbWVEYXRhLmN1cnJlbnRRdWVzdGlvbkluZGV4KSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGEuaXNDb3JyZWN0KSByZXN0b3JlZFN0cmVhaysrOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGJyZWFrOyAKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNGaXJlQWN0aXZlID0gcmVzdG9yZWRTdHJlYWsgPj0gMzsKICAgICAgICAgICAgICAgICAgICBuZXdTdHJlYWsgPSByZXN0b3JlZFN0cmVhayArIDE7CgogICAgICAgICAgICAgICAgICAgIC8vIEdhbWUgUG9pbnRzICjguKrguLnguJXguKM6IOC4oeC4seC5iOC4meC5g+C4iCA9IFdlaWdodCoyLCDguYTguKHguYjguKHguLHguYjguJkgPSBXZWlnaHQqMSkKICAgICAgICAgICAgICAgICAgICAvLyDguJXguYnguK3guIfguKXguJrguITguYjguLIgUGVuYWx0eSDguYDguJTguLTguKHguK3guK3guIHguJTguYnguKfguKIgKOC4luC5ieC4suC4oeC4tSkKICAgICAgICAgICAgICAgICAgICBjb25zdCB3YWdlciA9IGFuc0RhdGEud2FnZXJBbW91bnQgfHwgMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3YXNDb25maWRlbnQgPSBhbnNEYXRhLndhc0NvbmZpZGVudCA9PT0gdHJ1ZSB8fCBhbnNEYXRhLndhc0NvbmZpZGVudCA9PT0gJ2NvbmZpZGVudCc7CgogICAgICAgICAgICAgICAgICAgIGlmIChhbnNEYXRhLnBvd2VydXBVc2VkID09PSAnd2FnZXJNdWx0aXBsaWVyJykgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJvZml0ID0gKHdhZ2VyICogMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ZpcmVBY3RpdmUpIHByb2ZpdCAqPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgPSB3YWdlciArIHByb2ZpdDsKICAgICAgICAgICAgICAgICAgICAgICAgbmV0UG90Q2hhbmdlIC09IHdhZ2VyOyAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGdhbWVEYXRhLmlzQ29uZmlkZW5jZVNjb3JpbmdFbmFibGVkIHx8IGdhbWVEYXRhLmlzV2VpZ2h0ZWRNb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4hOC4s+C4meC4p+C4k+C4o+C4suC4h+C4p+C4seC4peC5g+C4q+C4oeC5iAogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmFzZVJld2FyZCA9IHdhc0NvbmZpZGVudCA/IChtYXhTY29yZSAqIDIpIDogbWF4U2NvcmU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0ZpcmVBY3RpdmUpIGJhc2VSZXdhcmQgKj0gMjsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4hOC4s+C4meC4p+C4k+C5guC4l+C4qeC5gOC4lOC4tOC4oeC4l+C4teC5iOC5gOC4hOC4ouC5guC4lOC4meC4q+C4seC4gQogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJldmlvdXNQZW5hbHR5ID0gd2FzQ29uZmlkZW50ID8gLW1heFNjb3JlIDogMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFuc0RhdGEud2FzSmlueGVkKSBwcmV2aW91c1BlbmFsdHkgKj0gMjsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOC4quC5iOC4p+C4meC4leC5iOC4suC4hyA9IOC4o+C4suC4h+C4p+C4seC4peC5g+C4q+C4oeC5iCAtICjguYLguJfguKnguYDguJTguLTguKEpCiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50QWRqdXN0bWVudCA9IGJhc2VSZXdhcmQgLSBwcmV2aW91c1BlbmFsdHk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGJhc2VSZXdhcmQgPSBtYXhTY29yZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRmlyZUFjdGl2ZSkgYmFzZVJld2FyZCAqPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgPSBiYXNlUmV3YXJkOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gTy1ORVQgJiBSYXcgU2NvcmUgKOC4muC4p+C4geC4meC5ieC4s+C4q+C4meC4seC4geC5gOC4leC5h+C4oSkKICAgICAgICAgICAgICAgICAgICBvbmV0QWRqdXN0bWVudCA9IG1heFNjb3JlOwogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLS0tIOC4geC4o+C4k+C4teC4l+C4teC5iCAyOiDguYDguJvguKXguLXguYjguKLguJnguIjguLLguIEg4LiW4Li54LiBIOC5gOC4m+C5h+C4mSDguJzguLTguJQgLS0tCiAgICAgICAgICAgICAgICBlbHNlIGlmIChpc0dyb3VwQykgewogICAgICAgICAgICAgICAgICAgIHNob3VsZFVwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgbmV3SXNDb3JyZWN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgbmV3U3RyZWFrID0gMDsKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkUG9pbnRzQXdhcmRlZCA9IGFuc0RhdGEucG9pbnRzQXdhcmRlZCB8fCAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhZ2VyID0gYW5zRGF0YS53YWdlckFtb3VudCB8fCAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhc0NvbmZpZGVudCA9IGFuc0RhdGEud2FzQ29uZmlkZW50ID09PSB0cnVlIHx8IGFuc0RhdGEud2FzQ29uZmlkZW50ID09PSAnY29uZmlkZW50JzsKCiAgICAgICAgICAgICAgICAgICAgcG9pbnRBZGp1c3RtZW50ID0gLW9sZFBvaW50c0F3YXJkZWQ7IC8vIOC4ouC4tuC4lOC4o+C4suC4h+C4p+C4seC4peC4hOC4t+C4meC4geC5iOC4reC4mQoKICAgICAgICAgICAgICAgICAgICBpZiAoYW5zRGF0YS5wb3dlcnVwVXNlZCA9PT0gJ3dhZ2VyTXVsdGlwbGllcicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRBZGp1c3RtZW50IC09IHdhZ2VyOyAKICAgICAgICAgICAgICAgICAgICAgICAgbmV0UG90Q2hhbmdlICs9IHdhZ2VyOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZ2FtZURhdGEuaXNDb25maWRlbmNlU2NvcmluZ0VuYWJsZWQgfHwgZ2FtZURhdGEuaXNXZWlnaHRlZE1vZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g4LiW4LmJ4Liy4Lih4Lix4LmI4LiZ4LmD4LiI4Lic4Li04LiUIOC4leC5ieC4reC4h+C5guC4lOC4meC4q+C4seC4geC5gOC4nuC4tOC5iOC4oeC4leC4suC4oeC4meC5ieC4s+C4q+C4meC4seC4gQogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2FzQ29uZmlkZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgLT0gbWF4U2NvcmU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBwb2ludEFkanVzdG1lbnQgLT0gMDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIOC4ouC4tuC4lCBPLU5FVCAmIFJhdyBTY29yZSDguITguLfguJkKICAgICAgICAgICAgICAgICAgICBvbmV0QWRqdXN0bWVudCA9IC1tYXhTY29yZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3QW5zd2VycyA9IFsuLi5wbGF5ZXIuYW5zd2Vyc107CiAgICAgICAgICAgICAgICAgICAgbmV3QW5zd2Vyc1tjdXJyZW50QW5zSW5kZXhdID0gewogICAgICAgICAgICAgICAgICAgICAgICAuLi5hbnNEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBpc0NvcnJlY3Q6IG5ld0lzQ29ycmVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgcG9pbnRzQXdhcmRlZDogKGFuc0RhdGEucG9pbnRzQXdhcmRlZCB8fCAwKSArIHBvaW50QWRqdXN0bWVudCwKICAgICAgICAgICAgICAgICAgICAgICAgb25ldFBvaW50c0F3YXJkZWQ6IChhbnNEYXRhLm9uZXRQb2ludHNBd2FyZGVkIHx8IDApICsgb25ldEFkanVzdG1lbnQKICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocGxheWVyUmVmLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFvguYHguIHguYnguYTguILguJXguKPguIfguJnguLXguYldIOC5g+C4iuC5iSBvbmV0QWRqdXN0bWVudCAoNC43NSkg4LmB4LiX4LiZIDEKICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IGluY3JlbWVudChvbmV0QWRqdXN0bWVudCksIAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQb2ludHM6IGluY3JlbWVudChwb2ludEFkanVzdG1lbnQpLAogICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE9uZXRTY29yZTogaW5jcmVtZW50KG9uZXRBZGp1c3RtZW50KSwKICAgICAgICAgICAgICAgICAgICAgICAgY29ycmVjdFN0cmVhazogbmV3U3RyZWFrLAogICAgICAgICAgICAgICAgICAgICAgICBhbnN3ZXJzOiBuZXdBbnN3ZXJzLAogICAgICAgICAgICAgICAgICAgICAgICBwb2ludHNMYXN0Um91bmQ6IChwbGF5ZXIucG9pbnRzTGFzdFJvdW5kIHx8IDApICsgcG9pbnRBZGp1c3RtZW50CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIDMuIOC4reC4seC4m+C5gOC4lOC4lSBHYW1lIERvYwogICAgICAgIGNvbnN0IGdhbWVVcGRhdGVQYXlsb2FkID0geyBzaHVmZmxlZFF1aXo6IHVwZGF0ZWRRdWl6IH07CiAgICAgICAgaWYgKG5ldFBvdENoYW5nZSAhPT0gMCkgewogICAgICAgICAgICBnYW1lVXBkYXRlUGF5bG9hZC5jZW50cmFsUG90ID0gaW5jcmVtZW50KG5ldFBvdENoYW5nZSk7CiAgICAgICAgfQogICAgICAgIGJhdGNoLnVwZGF0ZShnYW1lUmVmLCBnYW1lVXBkYXRlUGF5bG9hZCk7CgogICAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpOwogICAgICAgIHNob3dNZXNzYWdlKGDinIUg4LmB4LiB4LmJ4LmE4LiC4LmA4LiJ4Lil4Lii4Liq4Lih4Lia4Li54Lij4LiT4LmMISAo4LiE4Liw4LmB4LiZ4LiZ4LiU4Li04Lia4Lib4Lij4Lix4Lia4LmB4LiB4LmJICR7bWF4U2NvcmV9IOC5geC4leC5ieC4oSlgKTsKCiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkVtZXJnZW5jeSBmaXggZmFpbGVkOiIsIGVycm9yKTsKICAgICAgICBzaG93TWVzc2FnZSgi4p2MIOC5gOC4geC4tOC4lOC4guC5ieC4reC4nOC4tOC4lOC4nuC4peC4suC4lDogIiArIGVycm9yLm1lc3NhZ2UpOwogICAgfQp9CgkJCiAgICAgICAgaW5pdGlhbGl6ZSgpOwoKICAgIAogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaWRzVG9IaWRlID0gWyJhZG1pbi12aWV3IiwiYWRtaW4tcGFzc3dvcmQtbW9kYWwiLCJjcmVhdGUtcHJvamVjdC1tb2RhbCIsInF1aXotc2V0dGluZ3MtbW9kYWwiLCJxdWl6LWVkaXRvci1tb2RhbCIsImJsdWVwcmludC1wcm9qZWN0cy1tb2RhbCIsImJsdWVwcmludC1zZXR0aW5ncy1tb2RhbCIsIm1hbnVhbC1ibHVlcHJpbnQtbW9kYWwiLCJmaWxlLXNob3J0Y3V0LWVkaXRvci1tb2RhbCIsInNob3J0Y3V0LWVkaXRvci1tb2RhbCIsInF1aXotYmFuay1tb2RhbCIsInRvcGljLXF1aXotYmFuay1tb2RhbCIsImdsb2JhbC1hY3Rpdml0eS1tb2RhbCIsImxlc3Nvbi1wbGFuLW1vZGFsIiwiY29tcGFyaXNvbi1tb2RhbCIsImV4cG9ydC1wZGYtbW9kYWwiLCJsZXNzb24tdmlldy1tb2RhbCIsInF1aXotc3RhdHVzLW1vZGFsIiwicmVuYW1lLXF1aXotbW9kYWwiLCJtb3ZlLXF1aXotbW9kYWwiLCJidWxrLXF1aXotc2V0dGluZ3MtbW9kYWwiLCJtb2RlLXN3aXRjaGVyLWJ0biIsInZpZXctc3dpdGNoZXIiLCJzYXZlLXByb2plY3QtbmFtZS1idG4iLCJvcGVuLWdsb2JhbC1saXZlLWJ0biIsInVwZGF0ZS1vbGQtcXVpenplcy1idG4iLCJjcmVhdGUtcHJvamVjdC1idG4iLCJwcm9qZWN0LXNlYXJjaC1pbnB1dCIsInByb2plY3Qtc29ydC1zZWxlY3QiLCJhZG1pbi1sb2dpbi1idG4iLCJiYWNrLXRvLWFkbWluLWJ0biJdOwogICAgICAgICAgICAgICAgICAgICAgICBpZHNUb0hpZGUuZm9yRWFjaChpZCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVsKSB7IGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7IGVsLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpOyB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHVkZW50VmlldyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdHVkZW50LXZpZXcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3R1ZGVudFZpZXcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRWaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R1ZGVudFZpZXcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIHNob3dWaWV3ID09PSAnZnVuY3Rpb24nKSBzaG93Vmlldygnc3R1ZGVudCcpOwogICAgICAgICAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAg";
    function _decode(_s) { return decodeURIComponent(escape(window.atob(_s))); }

    try {
        eval(_decode(_secret));
        console.log("%cProtected by Code Armor", "color: lightgreen;");
    } catch (e) {
        console.error("Decryption Failed:", e);
        document.body.innerHTML = "<h1 style='color:red;padding:20px;'>Security Error</h1>";
    }
})();
            </script>
	

</body></html>
